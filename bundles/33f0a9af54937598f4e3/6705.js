"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[6705,6288,3998],{"./node_modules/matrix-react-sdk/res/img/element-icons/minus-button.svg":(e,t,o)=>{o.d(t,{I:()=>l});var r,n=o("./node_modules/react/index.js");function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)({}).hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},a.apply(null,arguments)}var s=function(e,t){return n.createElement("svg",a({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),r||(r=n.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 8c0-.432.35-.783.783-.783h10.434a.783.783 0 1 1 0 1.566H2.783A.783.783 0 0 1 2 8",clipRule:"evenodd"})))},l=(0,n.forwardRef)(s)},"./node_modules/matrix-react-sdk/src/components/views/location/LocationViewDialog.tsx":(e,t,o)=>{o.r(t),o.d(t,{default:()=>d});var r=o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=o("./node_modules/react/index.js"),a=o("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),s=o("./node_modules/matrix-react-sdk/src/utils/location/index.ts"),l=o("./node_modules/matrix-react-sdk/src/components/views/location/Map.tsx"),i=o("./node_modules/matrix-react-sdk/src/components/views/location/SmartMarker.tsx"),c=o("./node_modules/matrix-react-sdk/src/components/views/location/ZoomButtons.tsx");class d extends n.Component{constructor(e){super(e),(0,r.A)(this,"getBodyId",(()=>`mx_LocationViewDialog_${this.props.mxEvent.getId()}`)),(0,r.A)(this,"onError",(e=>{this.setState({error:e})})),this.state={error:void 0}}render(){const{mxEvent:e}=this.props,t=(0,s.qy)(e.getContent())&&e.sender||void 0,o=(0,s.jm)(e);return n.createElement(a.A,{className:"mx_LocationViewDialog",onFinished:this.props.onFinished,fixedWidth:!1},n.createElement(l.default,{id:this.getBodyId(),centerGeoUri:o,onError:this.onError,interactive:!0,className:"mx_LocationViewDialog_map",allowGeolocate:!0},(({map:e})=>n.createElement(n.Fragment,null,n.createElement(i.default,{map:e,id:`${this.getBodyId()}-marker`,geoUri:o,roomMember:t}),n.createElement(c.A,{map:e})))))}}},"./node_modules/matrix-react-sdk/src/components/views/location/Map.tsx":(e,t,o)=>{o.r(t),o.d(t,{default:()=>k});var r=o("./node_modules/react/index.js"),n=o("./node_modules/classnames/index.js"),a=o.n(n),s=o("./node_modules/maplibre-gl/dist/maplibre-gl.js"),l=o("./node_modules/matrix-js-sdk/src/matrix.ts"),i=o("./node_modules/matrix-js-sdk/src/logger.ts"),c=o("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),d=o("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts"),m=o("./node_modules/matrix-react-sdk/src/utils/location/index.ts"),u=o("./node_modules/matrix-react-sdk/src/utils/WellKnownUtils.ts"),_=o("./node_modules/matrix-react-sdk/src/utils/location/map.ts");var x=o("./node_modules/matrix-react-sdk/src/Modal.tsx"),p=o("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),v=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx");const g=({id:e,centerGeoUri:t,onError:o,interactive:n,bounds:a,allowGeolocate:x})=>{const p=`mx_Map_${e}`,v=(0,r.useContext)(c.Ay),g=(0,d.dF)(v,l.ClientEvent.ClientWellKnown,(e=>{var t;return null===(t=(0,u.XP)(e))||void 0===t?void 0:t.map_style_url})),k=(({interactive:e,bodyId:t,onError:o})=>{const n=(0,c.nH)(),[a,s]=(0,r.useState)();return(0,r.useEffect)((()=>{try{s((0,_.p)(n,!!e,t,o))}catch(e){console.error("Error encountered in useMap",e),e instanceof Error&&(null==o||o(e))}return()=>{a&&(a.remove(),s(void 0))}}),[e,t,o]),a})({interactive:n,bodyId:p,onError:o});(0,r.useEffect)((()=>{g&&k&&k.setStyle(g)}),[g,k]),(0,r.useEffect)((()=>{if(k&&t)try{const e=(0,m.XB)(t);if(!e)throw new Error("Invalid geo URI");k.setCenter({lon:e.longitude,lat:e.latitude})}catch(e){i.v.error("Could not set map center")}}),[k,t]),(0,r.useEffect)((()=>{if(k&&a)try{const e=new s.LngLatBounds([a.west,a.south],[a.east,a.north]);k.fitBounds(e,{padding:100,maxZoom:15})}catch(e){i.v.error("Invalid map bounds")}}),[k,a]);const[b,h]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(k){if(x&&!b){const e=new s.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1});h(e),k.addControl(e)}!x&&b&&(k.removeControl(b),h(null))}}),[k,b,x]),(0,r.useEffect)((()=>{if(b)return b.on("error",f),()=>{b.off("error",f)}}),[b]),{map:k,bodyId:p}},f=e=>{var t;i.v.error("Could not fetch location",e),x.Ay.createDialog(p.A,{title:(0,v._t)("location_sharing|error_fetch_location"),description:null!==(t=(0,m.Ff)(e.code))&&void 0!==t?t:""})},k=({bounds:e,centerGeoUri:t,children:o,className:n,allowGeolocate:s,id:l,interactive:i,onError:c,onClick:d})=>{const{map:m,bodyId:u}=g({centerGeoUri:t,onError:c,id:l,interactive:i,bounds:e,allowGeolocate:s});return r.createElement("div",{className:a()("mx_Map",n),id:u,onClick:e=>{e.target.classList.contains("maplibregl-ctrl-attrib-button")||d&&d()}},!!o&&!!m&&o({map:m}))}},"./node_modules/matrix-react-sdk/src/components/views/location/Marker.tsx":(e,t,o)=>{o.d(t,{A:()=>d});var r=o("./node_modules/react/index.js"),n=o("./node_modules/classnames/index.js"),a=o.n(n),s=o("./node_modules/matrix-react-sdk/res/img/element-icons/location.svg"),l=o("./node_modules/matrix-react-sdk/src/utils/FormattingUtils.ts"),i=o("./node_modules/matrix-react-sdk/src/components/views/avatars/MemberAvatar.tsx");const c=({tooltip:e,children:t})=>{const[o,n]=(0,r.useState)(!1);if(!e)return r.createElement(r.Fragment,null,t);return r.createElement("div",{onMouseEnter:()=>n(!0),onClick:e=>{e.stopPropagation(),n(!o)},onMouseLeave:()=>n(!1)},t,o&&e)},d=r.forwardRef((({id:e,roomMember:t,useMemberColor:o,tooltip:n},d)=>{const m=o&&t?(0,l.yJ)(t.userId):"";return r.createElement("div",{ref:d,id:e,className:a()("mx_Marker",m,{mx_Marker_defaultColor:!m})},r.createElement(c,{tooltip:n},r.createElement("div",{className:"mx_Marker_border"},t?r.createElement(i.A,{member:t,size:"36px",viewUserOnClick:!1,hideTitle:!!n}):r.createElement(s.I,{className:"mx_Marker_icon"}))))}))},"./node_modules/matrix-react-sdk/src/components/views/location/SmartMarker.tsx":(e,t,o)=>{o.r(t),o.d(t,{default:()=>l});var r=o("./node_modules/react/index.js"),n=o("./node_modules/matrix-react-sdk/src/utils/location/index.ts"),a=o("./node_modules/matrix-react-sdk/src/utils/location/map.ts"),s=o("./node_modules/matrix-react-sdk/src/components/views/location/Marker.tsx");const l=({id:e,map:t,geoUri:o,roomMember:l,useMemberColor:i,tooltip:c})=>{const{onElementRef:d}=((e,t)=>{const[o,s]=(0,r.useState)(),l=(0,r.useCallback)((r=>{if(o||!r)return;const l=(0,n.XB)(t);if(l){const t=(0,a.h)(l,r);t.addTo(e),s(t)}}),[o,t,e]);return(0,r.useEffect)((()=>{if(o){const e=(0,n.XB)(t);e&&o.setLngLat({lon:e.longitude,lat:e.latitude})}}),[o,t]),(0,r.useEffect)((()=>()=>{o&&o.remove()}),[o]),{marker:o,onElementRef:l}})(t,o);return r.createElement("span",null,r.createElement(s.A,{ref:d,id:e,roomMember:l,useMemberColor:i,tooltip:c}))}},"./node_modules/matrix-react-sdk/src/components/views/location/ZoomButtons.tsx":(e,t,o)=>{o.d(t,{A:()=>m});var r,n=o("./node_modules/react/index.js"),a=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),s=o("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx");function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)({}).hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},l.apply(null,arguments)}var i=function(e,t){return n.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),r||(r=n.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.783 2.783a.783.783 0 1 0-1.566 0v4.434H2.783a.783.783 0 0 0 0 1.566h4.434v4.435a.783.783 0 0 0 1.566 0V8.783h4.435a.783.783 0 0 0 0-1.566H8.783z",clipRule:"evenodd"})))},c=(0,n.forwardRef)(i);var d=o("./node_modules/matrix-react-sdk/res/img/element-icons/minus-button.svg");const m=({map:e})=>n.createElement("div",{className:"mx_ZoomButtons"},n.createElement(s.A,{onClick:()=>{e.zoomIn()},title:(0,a._t)("action|zoom_in"),className:"mx_ZoomButtons_button"},n.createElement(c,{className:"mx_ZoomButtons_icon"})),n.createElement(s.A,{onClick:()=>{e.zoomOut()},title:(0,a._t)("action|zoom_out"),className:"mx_ZoomButtons_button"},n.createElement(d.I,{className:"mx_ZoomButtons_icon"})))},"./node_modules/matrix-react-sdk/src/utils/location/map.ts":(e,t,o)=>{o.d(t,{h:()=>c,p:()=>i});var r=o("./node_modules/maplibre-gl/dist/maplibre-gl.js"),n=o("./node_modules/matrix-js-sdk/src/logger.ts"),a=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),s=o("./node_modules/matrix-react-sdk/src/utils/location/findMapStyleUrl.ts"),l=o("./node_modules/matrix-react-sdk/src/utils/location/LocationShareErrors.ts");const i=(e,t,o,i)=>{try{const c=(0,s.M)(e),d=new r.Map({container:o,style:c,zoom:15,interactive:t,attributionControl:!1,locale:{"AttributionControl.ToggleAttribution":(0,a._t)("location_sharing|toggle_attribution"),"AttributionControl.MapFeedback":(0,a._t)("location_sharing|map_feedback"),"FullscreenControl.Enter":(0,a._t)("action|enter_fullscreen"),"FullscreenControl.Exit":(0,a._t)("action|exit_fullscreeen"),"GeolocateControl.FindMyLocation":(0,a._t)("location_sharing|find_my_location"),"GeolocateControl.LocationNotAvailable":(0,a._t)("location_sharing|location_not_available"),"LogoControl.Title":(0,a._t)("location_sharing|mapbox_logo"),"NavigationControl.ResetBearing":(0,a._t)("location_sharing|reset_bearing"),"NavigationControl.ZoomIn":(0,a._t)("action|zoom_in"),"NavigationControl.ZoomOut":(0,a._t)("action|zoom_out")}});return d.addControl(new r.AttributionControl,"top-right"),d.on("error",(e=>{n.v.error("Failed to load map: check map_style_url in config.json has a valid URL and API key",e.error),null==i||i(new Error(l.$.MapStyleUrlNotReachable))})),d}catch(e){n.v.error("Failed to render map",e);if((null==e?void 0:e.message).includes("Failed to initialize WebGL"))throw new Error(l.$.WebGLNotEnabled);throw e}},c=(e,t)=>new r.Marker({element:t,anchor:"bottom",offset:[0,-1]}).setLngLat({lon:e.longitude,lat:e.latitude})}}]);
//# sourceMappingURL=6705.js.map