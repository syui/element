(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[6889],{"./node_modules/matrix-react-sdk/src/components/views/auth/PassphraseConfirmField.tsx":(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var r=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("./node_modules/react/index.js"),o=s("./node_modules/matrix-react-sdk/src/components/views/elements/Field.tsx"),n=s("./node_modules/matrix-react-sdk/src/components/views/elements/Validation.tsx"),i=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx");class l extends a.PureComponent{constructor(...e){super(...e),(0,r.A)(this,"validate",(0,n.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,i._t)(this.props.labelRequired)},{key:"match",test:({value:e})=>!e||e===this.props.password,invalid:()=>(0,i._t)(this.props.labelInvalid)}]})),(0,r.A)(this,"onValidate",(async e=>{const t=await this.validate(e);return this.props.onValidate&&this.props.onValidate(t),t}))}render(){return a.createElement(o.A,{id:this.props.id,ref:this.props.fieldRef,type:"password",label:(0,i._t)(this.props.label),autoComplete:this.props.autoComplete,value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate,autoFocus:this.props.autoFocus})}}(0,r.A)(l,"defaultProps",{label:(0,i.AO)("auth|change_password_confirm_label"),labelRequired:(0,i.AO)("auth|change_password_confirm_label"),labelInvalid:(0,i.AO)("auth|change_password_confirm_invalid")});const c=l},"./node_modules/matrix-react-sdk/src/components/views/auth/PassphraseField.tsx":(e,t,s)=>{"use strict";s.d(t,{A:()=>_});var r=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("./node_modules/react/index.js"),o=s("./node_modules/classnames/index.js"),n=s.n(o),i=s("./node_modules/matrix-react-sdk/src/SdkConfig.ts"),l=s("./node_modules/matrix-react-sdk/src/components/views/elements/Validation.tsx"),c=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),d=s("./node_modules/matrix-react-sdk/src/components/views/elements/Field.tsx"),u=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts");class p extends a.PureComponent{constructor(...e){super(...e),(0,r.A)(this,"validate",(0,l.A)({description:function(e){const t=e?e.score:0;return a.createElement("progress",{className:"mx_PassphraseField_progress",max:4,value:t})},deriveData:async({value:e})=>{if(!e)return null;const{scorePassword:t}=await s.e(344).then(s.bind(s,"./node_modules/matrix-react-sdk/src/utils/PasswordScorer.ts"));return t(u.J.get(),e,this.props.userInputs)},rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,c._t)(this.props.labelEnterPassword)},{key:"complexity",test:async function({value:e},t){if(!e||!t)return!1;const s=t.score>=this.props.minScore;return i.Ay.get("dangerously_allow_unsafe_and_insecure_passwords")||s},valid:function(e){return e&&e.score>=this.props.minScore?(0,c._t)(this.props.labelStrongPassword):(0,c._t)(this.props.labelAllowedButUnsafe)},invalid:function(e){if(!e)return null;const{feedback:t}=e;return t.warning||t.suggestions[0]||(0,c._t)("auth|password_field_keep_going_prompt")}}],memoize:!0})),(0,r.A)(this,"onValidate",(async e=>{const t=await this.validate(e);return this.props.onValidate&&this.props.onValidate(t),t}))}render(){return a.createElement(d.A,{id:this.props.id,autoFocus:this.props.autoFocus,className:n()("mx_PassphraseField",this.props.className),ref:this.props.fieldRef,type:"password",autoComplete:"new-password",label:(0,c._t)(this.props.label),value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate})}}(0,r.A)(p,"defaultProps",{label:(0,c.AO)("common|password"),labelEnterPassword:(0,c.AO)("auth|password_field_label"),labelStrongPassword:(0,c.AO)("auth|password_field_strong_label"),labelAllowedButUnsafe:(0,c.AO)("auth|password_field_weak_label")});const _=p},"./node_modules/matrix-react-sdk/src/components/views/dialogs/security/RestoreKeyBackupDialog.tsx":(e,t,s)=>{"use strict";s.d(t,{A:()=>y});var r=s("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=s("./node_modules/react/index.js"),o=s("./node_modules/matrix-js-sdk/src/matrix.ts"),n=s("./node_modules/matrix-js-sdk/src/logger.ts"),i=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),l=s("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),c=s("./node_modules/matrix-react-sdk/src/SecurityManager.ts"),d=s("./node_modules/matrix-react-sdk/src/components/views/elements/Spinner.tsx"),u=s("./node_modules/matrix-react-sdk/src/components/views/elements/DialogButtons.tsx"),p=s("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),_=s("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),h=function(e){return e.Passphrase="passphrase",e.RecoveryKey="recovery_key",e.SecretStorage="secret_storage",e}(h||{}),m=function(e){return e.PreFetch="prefetch",e.Fetch="fetch",e.LoadKeys="load_keys",e}(m||{});class y extends a.PureComponent{constructor(e){super(e),(0,r.A)(this,"onCancel",(()=>{this.props.onFinished(!1)})),(0,r.A)(this,"onDone",(()=>{this.props.onFinished(!0)})),(0,r.A)(this,"onUseRecoveryKeyClick",(()=>{this.setState({forceRecoveryKey:!0})})),(0,r.A)(this,"progressCallback",(e=>{this.setState({progress:e})})),(0,r.A)(this,"onResetRecoveryClick",(()=>{this.props.onFinished(!1),(0,c.cb)((async()=>{}),!0)})),(0,r.A)(this,"onRecoveryKeyChange",(e=>{this.setState({recoveryKey:e.target.value,recoveryKeyValid:i.J.safeGet().isValidRecoveryKey(e.target.value)})})),(0,r.A)(this,"onPassPhraseNext",(async()=>{if(this.state.backupInfo){this.setState({loading:!0,restoreError:null,restoreType:h.Passphrase});try{const e=await i.J.safeGet().restoreKeyBackupWithPassword(this.state.passPhrase,void 0,void 0,this.state.backupInfo,{progressCallback:this.progressCallback});if(this.props.keyCallback){const e=await i.J.safeGet().keyBackupKeyFromPassword(this.state.passPhrase,this.state.backupInfo);this.props.keyCallback(e)}if(!this.props.showSummary)return void this.props.onFinished(!0);this.setState({loading:!1,recoverInfo:e})}catch(e){n.v.log("Error restoring backup",e),this.setState({loading:!1,restoreError:e})}}})),(0,r.A)(this,"onRecoveryKeyNext",(async()=>{if(this.state.recoveryKeyValid&&this.state.backupInfo){this.setState({loading:!0,restoreError:null,restoreType:h.RecoveryKey});try{const e=await i.J.safeGet().restoreKeyBackupWithRecoveryKey(this.state.recoveryKey,void 0,void 0,this.state.backupInfo,{progressCallback:this.progressCallback});if(this.props.keyCallback){const e=i.J.safeGet().keyBackupKeyFromRecoveryKey(this.state.recoveryKey);this.props.keyCallback(e)}if(!this.props.showSummary)return void this.props.onFinished(!0);this.setState({loading:!1,recoverInfo:e})}catch(e){n.v.log("Error restoring backup",e),this.setState({loading:!1,restoreError:e})}}})),(0,r.A)(this,"onPassPhraseChange",(e=>{this.setState({passPhrase:e.target.value})})),this.state={backupInfo:null,backupKeyStored:null,loading:!1,loadError:null,restoreError:null,recoveryKey:"",recoverInfo:null,recoveryKeyValid:!1,forceRecoveryKey:!1,passPhrase:"",restoreType:null,progress:{stage:m.PreFetch}}}componentDidMount(){this.loadBackupStatus()}async restoreWithSecretStorage(){this.setState({loading:!0,restoreError:null,restoreType:h.SecretStorage});try{await(0,c.cb)((async()=>{this.state.backupInfo&&await i.J.safeGet().restoreKeyBackupWithSecretStorage(this.state.backupInfo,void 0,void 0,{progressCallback:this.progressCallback})})),this.setState({loading:!1})}catch(e){n.v.log("Error restoring backup",e),this.setState({restoreError:e,loading:!1})}}async restoreWithCachedKey(e){if(!e)return!1;try{const t=await i.J.safeGet().restoreKeyBackupWithCache(void 0,void 0,e,{progressCallback:this.progressCallback});return this.setState({recoverInfo:t}),!0}catch(e){return n.v.log("restoreWithCachedKey failed:",e),!1}}async loadBackupStatus(){this.setState({loading:!0,loadError:null});try{const e=i.J.safeGet(),t=await e.getKeyBackupVersion(),s=await e.hasSecretStorageKey()?await e.isKeyBackupKeyStored():null;this.setState({backupInfo:t,backupKeyStored:s});if(await this.restoreWithCachedKey(t))return n.v.log("RestoreKeyBackupDialog: found cached backup key"),void this.setState({loading:!1});if(s)return this.restoreWithSecretStorage();this.setState({loadError:null,loading:!1})}catch(e){n.v.log("Error loading backup status",e),this.setState({loadError:!0,loading:!1})}}render(){const e=this.state.backupInfo&&this.state.backupInfo.auth_data&&this.state.backupInfo.auth_data.private_key_salt&&this.state.backupInfo.auth_data.private_key_iterations;let t,s;if(this.state.loading){let e;if(s=(0,l._t)("encryption|access_secret_storage_dialog|restoring"),this.state.progress.stage===m.Fetch)e=(0,l._t)("restore_key_backup_dialog|key_fetch_in_progress");else if(this.state.progress.stage===m.LoadKeys){const{total:t,successes:s,failures:r}=this.state.progress;e=(0,l._t)("restore_key_backup_dialog|load_keys_progress",{total:t,completed:(null!=s?s:0)+(null!=r?r:0)})}else this.state.progress.stage===m.PreFetch&&(e=(0,l._t)("restore_key_backup_dialog|key_fetch_in_progress"));t=a.createElement("div",null,a.createElement("div",null,e),a.createElement(d.A,null))}else if(this.state.loadError)s=(0,l._t)("common|error"),t=(0,l._t)("restore_key_backup_dialog|load_error_content");else if(this.state.restoreError)this.state.restoreError instanceof o.MatrixError&&this.state.restoreError.errcode===o.MatrixClient.RESTORE_BACKUP_ERROR_BAD_KEY?this.state.restoreType===h.RecoveryKey?(s=(0,l._t)("restore_key_backup_dialog|recovery_key_mismatch_title"),t=a.createElement("div",null,a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|recovery_key_mismatch_description")))):(s=(0,l._t)("restore_key_backup_dialog|incorrect_security_phrase_title"),t=a.createElement("div",null,a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|incorrect_security_phrase_dialog")))):(s=(0,l._t)("common|error"),t=(0,l._t)("restore_key_backup_dialog|restore_failed_error"));else if(null===this.state.backupInfo)s=(0,l._t)("common|error"),t=(0,l._t)("restore_key_backup_dialog|no_backup_error");else if(this.state.recoverInfo){let e;s=(0,l._t)("restore_key_backup_dialog|keys_restored_title"),this.state.recoverInfo.total>this.state.recoverInfo.imported&&(e=a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|count_of_decryption_failures",{failedCount:this.state.recoverInfo.total-this.state.recoverInfo.imported}))),t=a.createElement("div",null,a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|count_of_successfully_restored_keys",{sessionCount:this.state.recoverInfo.imported})),e,a.createElement(u.A,{primaryButton:(0,l._t)("action|ok"),onPrimaryButtonClick:this.onDone,hasCancel:!1,focus:!0}))}else if(e&&!this.state.forceRecoveryKey)s=(0,l._t)("restore_key_backup_dialog|enter_phrase_title"),t=a.createElement("div",null,a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|key_backup_warning",{},{b:e=>a.createElement("b",null,e)})),a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|enter_phrase_description")),a.createElement("form",{className:"mx_RestoreKeyBackupDialog_primaryContainer"},a.createElement("input",{type:"password",className:"mx_RestoreKeyBackupDialog_passPhraseInput",onChange:this.onPassPhraseChange,value:this.state.passPhrase,autoFocus:!0}),a.createElement(u.A,{primaryButton:(0,l._t)("action|next"),onPrimaryButtonClick:this.onPassPhraseNext,primaryIsSubmit:!0,hasCancel:!0,onCancel:this.onCancel,focus:!1})),(0,l._t)("restore_key_backup_dialog|phrase_forgotten_text",{},{button1:e=>a.createElement(p.A,{kind:"link_inline",onClick:this.onUseRecoveryKeyClick},e),button2:e=>a.createElement(p.A,{kind:"link_inline",onClick:this.onResetRecoveryClick},e)}));else{let e;s=(0,l._t)("restore_key_backup_dialog|enter_key_title"),e=0===this.state.recoveryKey.length?a.createElement("div",{className:"mx_RestoreKeyBackupDialog_keyStatus"}):this.state.recoveryKeyValid?a.createElement("div",{className:"mx_RestoreKeyBackupDialog_keyStatus"},"👍 ",(0,l._t)("restore_key_backup_dialog|key_is_valid")):a.createElement("div",{className:"mx_RestoreKeyBackupDialog_keyStatus"},"👎 ",(0,l._t)("restore_key_backup_dialog|key_is_invalid")),t=a.createElement("div",null,a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|key_backup_warning",{},{b:e=>a.createElement("b",null,e)})),a.createElement("p",null,(0,l._t)("restore_key_backup_dialog|enter_key_description")),a.createElement("div",{className:"mx_RestoreKeyBackupDialog_primaryContainer"},a.createElement("input",{className:"mx_RestoreKeyBackupDialog_recoveryKeyInput",onChange:this.onRecoveryKeyChange,value:this.state.recoveryKey,autoFocus:!0}),e,a.createElement(u.A,{primaryButton:(0,l._t)("action|next"),onPrimaryButtonClick:this.onRecoveryKeyNext,hasCancel:!0,onCancel:this.onCancel,focus:!1,primaryDisabled:!this.state.recoveryKeyValid})),(0,l._t)("restore_key_backup_dialog|key_forgotten_text",{},{button:e=>a.createElement(p.A,{kind:"link_inline",onClick:this.onResetRecoveryClick},e)}))}return a.createElement(_.A,{className:"mx_RestoreKeyBackupDialog",onFinished:this.props.onFinished,title:s},a.createElement("div",{className:"mx_RestoreKeyBackupDialog_content"},t))}}(0,r.A)(y,"defaultProps",{showSummary:!0})},"./node_modules/matrix-react-sdk/src/utils/device/dehydration.ts":(e,t,s)=>{"use strict";s.d(t,{b:()=>o});var r=s("./node_modules/matrix-js-sdk/src/logger.ts"),a=s("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts");async function o(e=!1){const t=a.J.safeGet().getCrypto();await async function(e){if(!e)return!1;if(!await e.isDehydrationSupported())return!1;const t=await a.J.safeGet().waitForClientWellKnown();return!(null==t||!t["org.matrix.msc3814"])}(t)&&(r.v.log("Device dehydration enabled"),await t.startDehydration(e))}},"./node_modules/file-saver/dist/FileSaver.min.js":function(e,t,s){var r,a,o;a=[],void 0===(o="function"==typeof(r=function(){"use strict";function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,s){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){l(r.response,t,s)},r.onerror=function(){console.error("could not download file")},r.send()}function a(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(s){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,i=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,t,s){var i=n.URL||n.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?o(l):a(l.href)?r(e,t,s):o(l,l.target="_blank")):(l.href=i.createObjectURL(e),setTimeout((function(){i.revokeObjectURL(l.href)}),4e4),setTimeout((function(){o(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,s,n){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,n),s);else if(a(e))r(e,s,n);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){o(i)}))}}:function(e,t,s,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,s);var o="application/octet-stream"===e.type,l=/constructor/i.test(n.HTMLElement)||n.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||o&&l||i)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},d.readAsDataURL(e)}else{var u=n.URL||n.webkitURL,p=u.createObjectURL(e);a?a.location=p:location.href=p,a=null,setTimeout((function(){u.revokeObjectURL(p)}),4e4)}});n.saveAs=l.saveAs=l,e.exports=l})?r.apply(t,a):r)||(e.exports=o)}}]);
//# sourceMappingURL=6889.js.map