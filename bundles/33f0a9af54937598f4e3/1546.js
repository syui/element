/*! For license information please see 1546.js.LICENSE.txt */
(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[1546],{"./node_modules/@matrix-org/react-sdk-module-api/lib/lifecycles/WidgetLifecycle.js":(e,t)=>{"use strict";var n;t.Z=void 0,t.Z=n,function(e){e.CapabilitiesRequest="capabilities_request",e.PreLoadRequest="preload_request",e.IdentityRequest="identity_request"}(n||(t.Z=n={}))},"./node_modules/@matrix-org/react-sdk-module-api/lib/lifecycles/WrapperLifecycle.js":(e,t)=>{"use strict";var n;t.m=void 0,t.m=n,function(e){e.Wrapper="wrapper"}(n||(t.m=n={}))},"./node_modules/@vector-im/compound-design-tokens/icons/threads-solid.svg":(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var i,r=n("./node_modules/react/index.js");function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(null,arguments)}var s=function(e,t){return r.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),i||(i=r.createElement("path",{d:"M4 3h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6l-2.293 2.293c-.63.63-1.707.184-1.707-.707V5a2 2 0 0 1 2-2m3 7h10a.97.97 0 0 0 .712-.287A.97.97 0 0 0 18 9a.97.97 0 0 0-.288-.713A.97.97 0 0 0 17 8H7a.97.97 0 0 0-.713.287A.97.97 0 0 0 6 9q0 .424.287.713Q6.575 10 7 10m0 4h6q.424 0 .713-.287A.97.97 0 0 0 14 13a.97.97 0 0 0-.287-.713A.97.97 0 0 0 13 12H7a.97.97 0 0 0-.713.287A.97.97 0 0 0 6 13q0 .424.287.713Q6.575 14 7 14"})))},a=(0,r.forwardRef)(s)},"./node_modules/@vector-im/compound-design-tokens/icons/unpin.svg":(e,t,n)=>{"use strict";n.d(t,{I:()=>l});var i,r,o=n("./node_modules/react/index.js");function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(null,arguments)}var a=function(e,t){return o.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),i||(i=o.createElement("path",{fillRule:"evenodd",d:"M5.457 2.083a1 1 0 0 0-1.414 1.414L8.04 7.494v2.25a.5.5 0 0 1-.15.356l-3.7 3.644a.5.5 0 0 0-.15.356v1.4a.5.5 0 0 0 .5.5h6.5v6a1 1 0 0 0 2 0v-6h3.506l4.497 4.497a1 1 0 0 0 1.414-1.414zM14.546 14 10.04 9.494v.25a2.5 2.5 0 0 1-.746 1.781L6.78 14z",clipRule:"evenodd"})),r||(r=o.createElement("path",{d:"M14.04 4v3.85l2.015 2.015a.5.5 0 0 1-.015-.12V5.257a.5.5 0 0 1 .15-.357l2.081-2.043a.5.5 0 0 0-.35-.857h-9.73l2 2z"})))},l=(0,o.forwardRef)(a)},"./node_modules/matrix-react-sdk/res/img/e2e/verified-deprecated.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/e2e/verified-deprecated.9030dfd.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/brands/apple.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/brands/apple.734de1e.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/brands/facebook.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/brands/facebook.2061182.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/brands/github.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/brands/github.a229f06.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/brands/gitlab.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/brands/gitlab.9958062.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/brands/google.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/brands/google.1573797.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/brands/twitter.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/brands/twitter.b825e3c.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/context-menu.svg":(e,t,n)=>{"use strict";n.d(t,{I:()=>c});var i,r,o,s=n("./node_modules/react/index.js");function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a.apply(null,arguments)}var l=function(e,t){return s.createElement("svg",a({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),i||(i=s.createElement("circle",{cx:4.25,cy:9,r:1.25,fill:"currentColor"})),r||(r=s.createElement("circle",{cx:9,cy:9,r:1.25,fill:"currentColor"})),o||(o=s.createElement("circle",{cx:13.75,cy:9,r:1.25,fill:"currentColor"})))},c=(0,s.forwardRef)(l)},"./node_modules/matrix-react-sdk/res/img/element-icons/minus-button.svg":(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var i,r=n("./node_modules/react/index.js");function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(null,arguments)}var s=function(e,t){return r.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),i||(i=r.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 8c0-.432.35-.783.783-.783h10.434a.783.783 0 1 1 0 1.566H2.783A.783.783 0 0 1 2 8",clipRule:"evenodd"})))},a=(0,r.forwardRef)(s)},"./node_modules/matrix-react-sdk/res/img/element-icons/room/default_app.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/room/default_app.79b63ba.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/room/default_cal.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/room/default_cal.6bea887.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/room/default_clock.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/room/default_clock.d7c6411.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/room/default_doc.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/room/default_doc.a42767c.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/room/default_video.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/room/default_video.f29df7d.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/roomlist/dark-light-mode.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/element-icons/roomlist/dark-light-mode.328ce0f.svg"},"./node_modules/matrix-react-sdk/res/img/element-icons/settings/inactive.svg":(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var i,r=n("./node_modules/react/index.js");function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(null,arguments)}var s=function(e,t){return r.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 8 14",role:"presentation","aria-hidden":!0,ref:t},e),i||(i=r.createElement("path",{fill:"currentColor",d:"M1.333.333C.6.333 0 .933 0 1.666l.007 2.12c0 .354.14.687.386.94L2.667 7 .393 9.286a1.33 1.33 0 0 0-.386.94L0 12.333c0 .733.6 1.333 1.333 1.333h5.334c.733 0 1.333-.6 1.333-1.333v-2.107c0-.353-.14-.693-.387-.94L5.333 7l2.274-2.267C7.86 4.48 8 4.14 8 3.786v-2.12C8 .933 7.4.333 6.667.333zm5.334 9.94v1.393c0 .367-.3.667-.667.667H2a.67.67 0 0 1-.667-.667v-1.393c0-.18.074-.347.194-.473L4 7.333l2.473 2.473c.12.12.194.294.194.467"})))},a=(0,r.forwardRef)(s)},"./node_modules/matrix-react-sdk/res/img/ellipsis.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/ellipsis.8a92914.svg"},"./node_modules/matrix-react-sdk/res/img/image-view/close.svg":(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var i,r=n("./node_modules/react/index.js");function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(null,arguments)}var s=function(e,t){return r.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 12 12",role:"presentation","aria-hidden":!0,ref:t},e),i||(i=r.createElement("path",{fill:"#A9B2BC",fillRule:"evenodd",d:"M11.468 2.04A1 1 0 0 0 10.054.627L6.047 4.633 1.811.398A1 1 0 1 0 .397 1.812l4.236 4.236-4.007 4.006A1 1 0 1 0 2.04 11.47l4.007-4.007 3.778 3.778a1 1 0 0 0 1.415-1.414L7.46 6.048z",clipRule:"evenodd"})))},a=(0,r.forwardRef)(s)},"./node_modules/matrix-react-sdk/res/img/matrix.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/matrix.9166e4b.svg"},"./node_modules/matrix-react-sdk/res/img/plus.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/plus.9014602.svg"},"./node_modules/matrix-react-sdk/res/img/room_replaced.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/room_replaced.4ac105f.svg"},"./node_modules/matrix-react-sdk/res/img/upload-big.svg":(e,t,n)=>{"use strict";n.d(t,{A:()=>i});n("./node_modules/react/index.js");const i="img/upload-big.ade34b1.svg"},"./node_modules/matrix-js-sdk/src/browser-index.ts":(e,t,n)=>{"use strict";var i=n("./node_modules/matrix-js-sdk/src/matrix.ts");if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");let r;globalThis.__js_sdk_entrypoint=!0;try{r=globalThis.indexedDB}catch(e){}r&&i.setCryptoStoreFactory((()=>new i.IndexedDBCryptoStore(r,"matrix-js-sdk:crypto"))),globalThis.matrixcs=i},"./node_modules/matrix-react-sdk/src/DecryptionFailureTracker.ts":(e,t,n)=>{"use strict";n.d(t,{o:()=>h});var i,r=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("./node_modules/bloom-filters/dist/api.js"),s=n("./node_modules/matrix-js-sdk/src/matrix.ts"),a=n("./node_modules/matrix-js-sdk/src/crypto-api/index.ts"),l=n("./node_modules/matrix-react-sdk/src/PosthogAnalytics.ts"),c=n("./node_modules/matrix-react-sdk/src/utils/crypto/index.ts");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const u="mx_decryption_failure_event_ids";class m{constructor(e,t,n,i,o,s){(0,r.A)(this,"timeToDecryptMillis",void 0),this.failedEventId=e,this.errorCode=t,this.ts=n,this.isFederated=i,this.wasVisibleToUser=o,this.userTrustsOwnIdentity=s}}class h{constructor(e,t,n=!0){if((0,r.A)(this,"failures",new Map),(0,r.A)(this,"visibleEvents",new Set),(0,r.A)(this,"reportedEvents",new o.ScalableBloomFilter),(0,r.A)(this,"checkInterval",null),(0,r.A)(this,"trackInterval",null),(0,r.A)(this,"baseProperties",{}),(0,r.A)(this,"userDomain",void 0),(0,r.A)(this,"userTrustsOwnIdentity",void 0),(0,r.A)(this,"checkingVerificationStatus",!1),(0,r.A)(this,"retryVerificationStatus",!1),this.fn=e,this.errorCodeMapFn=t,this.checkReportedEvents=n,!e||"function"!=typeof e)throw new Error("DecryptionFailureTracker requires tracking function");if("function"!=typeof t)throw new Error("DecryptionFailureTracker second constructor argument should be a function")}static get instance(){return h.internalInstance}loadReportedEvents(){const e=localStorage.getItem(u);this.reportedEvents=e?o.ScalableBloomFilter.fromJSON(JSON.parse(e)):new o.ScalableBloomFilter}saveReportedEvents(){localStorage.setItem(u,JSON.stringify(this.reportedEvents.saveAsJSON()))}eventDecrypted(e,t){if(e.getWireContent().algorithm!=c.Q)return;const n=e.decryptionFailureReason;if(null===n)return void this.removeDecryptionFailuresForEvent(e,t);const i=e.getId();if(this.reportedEvents.has(i)&&this.checkReportedEvents)return;const r=this.failures.get(i),o=r?r.ts:t,s=e.getSender(),a=null==s?void 0:s.replace(/^.*?:/,"");let l;void 0!==this.userDomain&&void 0!==a&&(l=this.userDomain!==a);const d=this.visibleEvents.has(i);this.failures.set(i,new m(i,n,o,l,d,this.userTrustsOwnIdentity))}addVisibleEvent(e){const t=e.getId();if(this.reportedEvents.has(t)&&this.checkReportedEvents)return;const n=this.failures.get(t);n&&(n.wasVisibleToUser=!0),this.visibleEvents.add(t)}removeDecryptionFailuresForEvent(e,t){const n=e.getId(),i=this.failures.get(n);if(i){this.failures.delete(n);const e=t-i.ts;if(e<h.GRACE_PERIOD_MS)return;e<=h.MAXIMUM_LATE_DECRYPTION_PERIOD&&(i.timeToDecryptMillis=e),this.reportFailure(i)}}async handleKeysChanged(e){if(this.checkingVerificationStatus)this.retryVerificationStatus=!0;else{this.checkingVerificationStatus=!0;try{do{this.retryVerificationStatus=!1,this.userTrustsOwnIdentity=(await e.getCrypto().getUserVerificationStatus(e.getUserId())).isCrossSigningVerified()}while(this.retryVerificationStatus)}finally{this.checkingVerificationStatus=!1}}}async start(e){this.loadReportedEvents(),await this.calculateClientProperties(e),this.registerHandlers(e),this.checkInterval=window.setInterval((()=>this.checkFailures(Date.now())),h.CHECK_INTERVAL_MS)}async calculateClientProperties(e){var t;const n={};this.baseProperties=n,this.userDomain=null!==(t=e.getDomain())&&void 0!==t?t:void 0,"matrix.org"===this.userDomain?n.isMatrixDotOrg=!0:void 0!==this.userDomain&&(n.isMatrixDotOrg=!1);const i=e.getCrypto();if(i){i.getVersion().startsWith("Rust SDK")?n.cryptoSDK="Rust":n.cryptoSDK="Legacy",this.userTrustsOwnIdentity=(await i.getUserVerificationStatus(e.getUserId())).isCrossSigningVerified()}}registerHandlers(e){const t=e=>this.eventDecrypted(e,Date.now()),n=()=>{this.handleKeysChanged(e).catch((e=>{console.log("Error handling KeysChanged event",e)}))},i=()=>{e.removeListener(s.MatrixEventEvent.Decrypted,t),e.removeListener(s.CryptoEvent.KeysChanged,n),e.removeListener(s.HttpApiEvent.SessionLoggedOut,i),this.stop()};e.on(s.MatrixEventEvent.Decrypted,t),e.on(s.CryptoEvent.KeysChanged,n),e.on(s.HttpApiEvent.SessionLoggedOut,i)}stop(){this.checkInterval&&clearInterval(this.checkInterval),this.trackInterval&&clearInterval(this.trackInterval),this.userTrustsOwnIdentity=void 0,this.failures=new Map,this.visibleEvents=new Set}checkFailures(e){const t=new Map;for(const[n,i]of this.failures)void 0!==i.timeToDecryptMillis||e>i.ts+h.MAXIMUM_LATE_DECRYPTION_PERIOD?this.reportFailure(i):t.set(n,i);this.failures=t,this.saveReportedEvents()}reportFailure(e){var t;const n=e.errorCode,i=this.errorCodeMapFn(n),r={timeToDecryptMillis:null!==(t=e.timeToDecryptMillis)&&void 0!==t?t:-1,wasVisibleToUser:e.wasVisibleToUser};void 0!==e.isFederated&&(r.isFederated=e.isFederated),void 0!==e.userTrustsOwnIdentity&&(r.userTrustsOwnIdentity=e.userTrustsOwnIdentity),this.baseProperties&&Object.assign(r,this.baseProperties),this.fn(i,n,r),this.reportedEvents.add(e.failedEventId),this.visibleEvents.delete(e.failedEventId)}}i=h,(0,r.A)(h,"internalInstance",new i(((e,t,n)=>{const i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({eventName:"Error",domain:"E2EE",name:e,context:`mxc_crypto_error_type_${t}`},n);l.Vo.instance.trackEvent(i)}),(e=>{switch(e){case a.DecryptionFailureCode.MEGOLM_UNKNOWN_INBOUND_SESSION_ID:case a.DecryptionFailureCode.MEGOLM_KEY_WITHHELD:return"OlmKeysNotSentError";case a.DecryptionFailureCode.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:return"RoomKeysWithheldForUnverifiedDevice";case a.DecryptionFailureCode.OLM_UNKNOWN_MESSAGE_INDEX:return"OlmIndexError";case a.DecryptionFailureCode.HISTORICAL_MESSAGE_NO_KEY_BACKUP:case a.DecryptionFailureCode.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED:case a.DecryptionFailureCode.HISTORICAL_MESSAGE_WORKING_BACKUP:return"HistoricalMessage";case a.DecryptionFailureCode.HISTORICAL_MESSAGE_USER_NOT_JOINED:return"ExpectedDueToMembership";default:return"UnknownError"}}))),(0,r.A)(h,"CHECK_INTERVAL_MS",4e4),(0,r.A)(h,"GRACE_PERIOD_MS",4e3),(0,r.A)(h,"MAXIMUM_LATE_DECRYPTION_PERIOD",6e4)},"./node_modules/matrix-react-sdk/src/Lifecycle.ts":(e,t,n)=>{"use strict";n.d(t,{AK:()=>wn,hP:()=>bn,yl:()=>Cn,E9:()=>Tn,kQ:()=>Fn,b:()=>Un,L6:()=>En,ri:()=>On,MV:()=>_n,Vi:()=>Rn,QC:()=>In,hF:()=>Ln,NN:()=>Hn});var i=n("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),r=n("./node_modules/matrix-js-sdk/src/matrix.ts"),o=n("./node_modules/matrix-js-sdk/src/logger.ts"),s=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),a=n("./node_modules/matrix-react-sdk/src/modules/ModuleRunner.ts"),l=n("./node_modules/matrix-react-sdk/src/indexing/EventIndexPeg.ts"),c=n("./node_modules/matrix-react-sdk/src/utils/createMatrixClient.ts"),d=n("./node_modules/matrix-react-sdk/src/Notifier.ts"),u=n("./node_modules/matrix-react-sdk/src/UserActivity.ts"),m=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),h=n("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),p=n("./node_modules/matrix-react-sdk/src/utils/Timer.ts");const g=new class{constructor(){(0,m.A)(this,"unavailableTimer",null),(0,m.A)(this,"dispatcherRef",null),(0,m.A)(this,"state",null),(0,m.A)(this,"onAction",(e=>{var t;"user_activity"===e.action&&(this.setState(r.SetPresence.Online),null===(t=this.unavailableTimer)||void 0===t||t.restart())}))}async start(){for(this.unavailableTimer=new p.A(18e4),this.dispatcherRef=h.Ay.register(this.onAction);this.unavailableTimer;)try{await this.unavailableTimer.finished(),this.setState(r.SetPresence.Unavailable)}catch(e){}}stop(){this.dispatcherRef&&(h.Ay.unregister(this.dispatcherRef),this.dispatcherRef=null),this.unavailableTimer&&(this.unavailableTimer.abort(),this.unavailableTimer=null)}getState(){return this.state}async setState(e){if(e===this.state)return;const t=this.state;if(this.state=e,!s.J.safeGet().isGuest())try{await s.J.safeGet().setSyncPresence(this.state),o.v.debug("Presence:",e)}catch(e){o.v.error("Failed to set presence:",e),this.state=t}}};var v=n("./node_modules/matrix-react-sdk/src/utils/DMRoomMap.ts"),_=n("./node_modules/matrix-react-sdk/src/Modal.tsx"),f=n("./node_modules/matrix-react-sdk/src/stores/ActiveWidgetStore.ts"),y=n("./node_modules/matrix-react-sdk/src/PlatformPeg.ts"),E=n("./node_modules/matrix-react-sdk/src/Login.ts"),b=n("./node_modules/matrix-react-sdk/src/utils/StorageManager.ts"),w=n("./node_modules/matrix-react-sdk/src/utils/StorageAccess.ts"),x=n("./node_modules/matrix-react-sdk/src/settings/SettingsStore.ts"),A=n("./node_modules/matrix-react-sdk/src/settings/SettingLevel.ts"),S=n("./node_modules/matrix-react-sdk/src/stores/ToastStore.ts"),C=n("./node_modules/matrix-react-sdk/src/integrations/IntegrationManagers.ts"),k=n("./node_modules/matrix-react-sdk/src/mjolnir/Mjolnir.ts"),R=n("./node_modules/matrix-js-sdk/src/crypto/index.ts"),I=n("./node_modules/matrix-react-sdk/src/PosthogAnalytics.ts"),T=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),P=n("./node_modules/matrix-react-sdk/src/components/views/toasts/GenericToast.tsx"),N=n("./node_modules/matrix-react-sdk/src/dispatcher/actions.ts");const D="mx_snooze_bulk_unverified_device_nag",M="reviewsessions",O=e=>{S.A.sharedInstance().addOrReplaceToast({key:M,title:(0,T._t)("encryption|verification|unverified_sessions_toast_title"),icon:"verification_warning",props:{description:(0,T._t)("encryption|verification|unverified_sessions_toast_description"),primaryLabel:(0,T._t)("action|review"),onPrimaryClick:()=>{de.sharedInstance().dismissUnverifiedSessions(e),h.Ay.dispatch({action:N.r.ViewUserDeviceSettings})},secondaryLabel:(0,T._t)("encryption|verification|unverified_sessions_toast_reject"),onSecondaryClick:()=>{de.sharedInstance().dismissUnverifiedSessions(e),(()=>{try{localStorage.setItem(D,String(Date.now()))}catch(e){o.v.error("Failed to persist bulk unverified device nag snooze",e)}})()}},component:P.A,priority:50})};var L=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/security/SetupEncryptionDialog.tsx"),U=n("./node_modules/matrix-react-sdk/src/SecurityManager.ts"),F=n("./node_modules/matrix-react-sdk/src/stores/SetupEncryptionStore.ts"),j=n("./node_modules/matrix-react-sdk/src/components/views/elements/Spinner.tsx");const B="setupencryption",V=e=>{switch(e){case G.SET_UP_ENCRYPTION:return(0,T._t)("encryption|set_up_toast_title");case G.UPGRADE_ENCRYPTION:return(0,T._t)("encryption|upgrade_toast_title");case G.VERIFY_THIS_SESSION:return(0,T._t)("encryption|verify_toast_title")}},H=e=>{switch(e){case G.SET_UP_ENCRYPTION:case G.UPGRADE_ENCRYPTION:return"secure_backup";case G.VERIFY_THIS_SESSION:return"verification_warning"}},z=e=>{switch(e){case G.SET_UP_ENCRYPTION:return(0,T._t)("action|continue");case G.UPGRADE_ENCRYPTION:return(0,T._t)("action|upgrade");case G.VERIFY_THIS_SESSION:return(0,T._t)("action|verify")}},W=e=>{switch(e){case G.SET_UP_ENCRYPTION:case G.UPGRADE_ENCRYPTION:return(0,T._t)("encryption|set_up_toast_description");case G.VERIFY_THIS_SESSION:return(0,T._t)("encryption|verify_toast_description")}};let G=function(e){return e.SET_UP_ENCRYPTION="set_up_encryption",e.UPGRADE_ENCRYPTION="upgrade_encryption",e.VERIFY_THIS_SESSION="verify_this_session",e}({});const K=()=>{de.sharedInstance().dismissEncryptionSetup()},J=e=>{if(a.r.instance.extensions.cryptoSetup.setupEncryptionNeeded({kind:e,storeProvider:{getInstance:()=>F.s.sharedInstance()}}))return;S.A.sharedInstance().addOrReplaceToast({key:B,title:V(e),icon:H(e),props:{description:W(e),primaryLabel:z(e),onPrimaryClick:async()=>{if(e===G.VERIFY_THIS_SESSION)_.Ay.createDialog(L.A,{},void 0,!1,!0);else{const e=_.Ay.createDialog(j.A,void 0,"mx_Dialog_spinner",!1,!0);try{await(0,U.cb)()}finally{e.close()}}},secondaryLabel:(0,T._t)("encryption|verification|unverified_sessions_toast_reject"),onSecondaryClick:K,destructive:"secondary"},component:P.A,priority:e===G.VERIFY_THIS_SESSION?95:40})},q=()=>{S.A.sharedInstance().dismissToast(B)};var $=n("./node_modules/react/index.js"),Y=n("./node_modules/matrix-react-sdk/src/utils/device/isDeviceVerified.ts"),Q=n("./node_modules/matrix-react-sdk/src/utils/device/parseUserAgent.ts"),Z=n("./node_modules/matrix-react-sdk/src/components/views/settings/devices/DeviceMetaData.tsx");function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,m.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function te(e){return"unverified_session_"+e}const ne=async e=>{const t=s.J.safeGet(),n=await t.getDevice(e),i=ee(ee({},n),{},{isVerified:await(0,Y.z)(t,e),deviceType:Q.b.Unknown});S.A.sharedInstance().addOrReplaceToast({key:te(e),title:(0,T._t)("encryption|verification|unverified_session_toast_title"),icon:"verification_warning",props:{description:n.display_name,detail:$.createElement(Z.e,{device:i}),primaryLabel:(0,T._t)("encryption|verification|unverified_session_toast_accept"),onPrimaryClick:()=>{de.sharedInstance().dismissUnverifiedSessions([e])},secondaryLabel:(0,T._t)("action|no"),onSecondaryClick:()=>{de.sharedInstance().dismissUnverifiedSessions([e]),h.Ay.dispatch({action:N.r.ViewUserDeviceSettings})},destructive:"secondary"},component:P.A,priority:80})},ie=e=>{S.A.sharedInstance().dismissToast(te(e))};var re=n("./node_modules/matrix-react-sdk/src/utils/WellKnownUtils.ts"),oe=n("./node_modules/matrix-react-sdk/src/Views.ts");var se=n("./node_modules/matrix-react-sdk/src/SdkConfig.ts"),ae=n("./node_modules/matrix-react-sdk/src/utils/device/clientInformation.ts"),le=n("./node_modules/matrix-react-sdk/src/settings/UIFeature.ts"),ce=n("./node_modules/matrix-react-sdk/src/utils/crypto/deviceInfo.ts");class de{constructor(){(0,m.A)(this,"dispatcherRef",void 0),(0,m.A)(this,"dismissed",new Set),(0,m.A)(this,"dismissedThisDeviceToast",!1),(0,m.A)(this,"keyBackupInfo",null),(0,m.A)(this,"keyBackupFetchedAt",null),(0,m.A)(this,"ourDeviceIdsAtStart",null),(0,m.A)(this,"displayingToastsForDeviceIds",new Set),(0,m.A)(this,"running",!1),(0,m.A)(this,"client",void 0),(0,m.A)(this,"shouldRecordClientInformation",!1),(0,m.A)(this,"enableBulkUnverifiedSessionsReminder",!0),(0,m.A)(this,"deviceClientInformationSettingWatcherRef",void 0),(0,m.A)(this,"analyticsVerificationState",void 0),(0,m.A)(this,"analyticsRecoveryState",void 0),(0,m.A)(this,"onWillUpdateDevices",(async(e,t)=>{if(!this.client)return;if(t)return;const n=this.client.getSafeUserId();e.includes(n)&&await this.ensureDeviceIdsAtStartPopulated()})),(0,m.A)(this,"onDevicesUpdated",(e=>{this.client&&e.includes(this.client.getSafeUserId())&&this.recheck()})),(0,m.A)(this,"onDeviceVerificationChanged",(e=>{this.client&&e===this.client.getUserId()&&this.recheck()})),(0,m.A)(this,"onUserTrustStatusChanged",(e=>{this.client&&e===this.client.getUserId()&&this.recheck()})),(0,m.A)(this,"onCrossSingingKeysChanged",(()=>{this.recheck()})),(0,m.A)(this,"onAccountData",(e=>{(e.getType().startsWith("m.secret_storage.")||e.getType().startsWith("m.cross_signing.")||"m.megolm_backup.v1"===e.getType())&&this.recheck()})),(0,m.A)(this,"onSync",((e,t)=>{"PREPARED"===e&&null===t&&this.recheck()})),(0,m.A)(this,"onRoomStateEvents",(e=>{e.getType()===r.EventType.RoomEncryption&&this.recheck()})),(0,m.A)(this,"onAction",(({action:e})=>{e===N.r.OnLoggedIn&&(this.recheck(),this.updateClientInformation())})),(0,m.A)(this,"checkKeyBackupStatus",(async()=>{var e;if(this.keyBackupStatusChecked||!this.client)return;const t=await(null===(e=this.client.getCrypto())||void 0===e?void 0:e.getActiveSessionBackupVersion());this.keyBackupStatusChecked=!!t,t||h.Ay.dispatch({action:N.r.ReportKeyBackupNotEnabled})})),(0,m.A)(this,"keyBackupStatusChecked",!1),(0,m.A)(this,"onRecordClientInformationSettingChange",((e,t,n,i,r)=>{const o=this.shouldRecordClientInformation;this.shouldRecordClientInformation=!!r,this.shouldRecordClientInformation!==o&&this.updateClientInformation()})),(0,m.A)(this,"updateClientInformation",(async()=>{if(this.client)try{var e;if(this.shouldRecordClientInformation)await(0,ae.Zx)(this.client,se.Ay.get(),null!==(e=y.A.get())&&void 0!==e?e:void 0);else await(0,ae.BW)(this.client)}catch(e){o.v.error("Failed to update client information",e)}}))}static sharedInstance(){return window.mxDeviceListener||(window.mxDeviceListener=new de),window.mxDeviceListener}start(e){this.running=!0,this.client=e,this.client.on(R.cr.WillUpdateDevices,this.onWillUpdateDevices),this.client.on(R.cr.DevicesUpdated,this.onDevicesUpdated),this.client.on(R.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.client.on(R.cr.UserTrustStatusChanged,this.onUserTrustStatusChanged),this.client.on(R.cr.KeysChanged,this.onCrossSingingKeysChanged),this.client.on(r.ClientEvent.AccountData,this.onAccountData),this.client.on(r.ClientEvent.Sync,this.onSync),this.client.on(r.RoomStateEvent.Events,this.onRoomStateEvents),this.shouldRecordClientInformation=x.A.getValue("deviceClientInformationOptIn"),this.enableBulkUnverifiedSessionsReminder=x.A.getValue(le.f.BulkUnverifiedSessionsReminder),this.deviceClientInformationSettingWatcherRef=x.A.watchSetting("deviceClientInformationOptIn",null,this.onRecordClientInformationSettingChange),this.dispatcherRef=h.Ay.register(this.onAction),this.recheck(),this.updateClientInformation()}stop(){this.running=!1,this.client&&(this.client.removeListener(R.cr.WillUpdateDevices,this.onWillUpdateDevices),this.client.removeListener(R.cr.DevicesUpdated,this.onDevicesUpdated),this.client.removeListener(R.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.client.removeListener(R.cr.UserTrustStatusChanged,this.onUserTrustStatusChanged),this.client.removeListener(R.cr.KeysChanged,this.onCrossSingingKeysChanged),this.client.removeListener(r.ClientEvent.AccountData,this.onAccountData),this.client.removeListener(r.ClientEvent.Sync,this.onSync),this.client.removeListener(r.RoomStateEvent.Events,this.onRoomStateEvents)),this.deviceClientInformationSettingWatcherRef&&x.A.unwatchSetting(this.deviceClientInformationSettingWatcherRef),this.dispatcherRef&&(h.Ay.unregister(this.dispatcherRef),this.dispatcherRef=void 0),this.dismissed.clear(),this.dismissedThisDeviceToast=!1,this.keyBackupInfo=null,this.keyBackupFetchedAt=null,this.keyBackupStatusChecked=!1,this.ourDeviceIdsAtStart=null,this.displayingToastsForDeviceIds=new Set,this.client=void 0}async dismissUnverifiedSessions(e){o.v.log("Dismissing unverified sessions: "+Array.from(e).join(","));for(const t of e)this.dismissed.add(t);this.recheck()}dismissEncryptionSetup(){this.dismissedThisDeviceToast=!0,this.recheck()}async ensureDeviceIdsAtStartPopulated(){null===this.ourDeviceIdsAtStart&&(this.ourDeviceIdsAtStart=await this.getDeviceIds())}async getDeviceIds(){const e=this.client;return e?await(0,ce.a)(e,e.getSafeUserId()):new Set}async getKeyBackupInfo(){if(!this.client)return null;const e=(new Date).getTime();return(!this.keyBackupInfo||!this.keyBackupFetchedAt||this.keyBackupFetchedAt<e-3e5)&&(this.keyBackupInfo=await this.client.getKeyBackupVersion(),this.keyBackupFetchedAt=e),this.keyBackupInfo}shouldShowSetupEncryptionToast(){var e;if((0,U.kq)())return!1;const t=this.client;return null!==(e=null==t?void 0:t.getRooms().some((e=>t.isRoomEncrypted(e.roomId))))&&void 0!==e&&e}recheck(){this.doRecheck().catch((e=>{e instanceof r.ClientStoppedError||o.v.error("Error during `DeviceListener.recheck`",e)}))}async doRecheck(){var e;if(!this.running||!this.client)return;const t=this.client;if(!await t.isVersionSupported("v1.1"))return;const n=t.getCrypto();if(!n)return;if(!t.isInitialSyncComplete())return;const i=await n.isCrossSigningReady(),r=await n.isSecretStorageReady(),s=i&&r;if(await this.reportCryptoSessionStateToAnalytics(t),this.dismissedThisDeviceToast||s)q(),this.checkKeyBackupStatus();else if(this.shouldShowSetupEncryptionToast())if(await n.getUserDeviceInfo([t.getSafeUserId()]),!await n.getCrossSigningKeyId()&&await n.userHasCrossSigningKeys())J(G.VERIFY_THIS_SESSION),this.checkKeyBackupStatus();else{await this.getKeyBackupInfo()?J(G.UPGRADE_ENCRYPTION):(await t.waitForClientWellKnown(),(0,re.R$)(t)&&function(){const e=window.matrixChat;return(null==e?void 0:e.state.view)===oe.A.LOGGED_IN}()?(q(),(0,U.cb)()):J(G.SET_UP_ENCRYPTION))}await this.ensureDeviceIdsAtStartPopulated();const a=new Set,l=new Set,c=i&&Boolean(null===(e=await n.getDeviceVerificationStatus(t.getSafeUserId(),t.deviceId))||void 0===e?void 0:e.crossSigningVerified);if(i){const e=await this.getDeviceIds();for(const i of e){if(i===t.deviceId)continue;const e=await n.getDeviceVerificationStatus(t.getSafeUserId(),i);var d;if(!(null!=e&&e.crossSigningVerified||this.dismissed.has(i)))null!==(d=this.ourDeviceIdsAtStart)&&void 0!==d&&d.has(i)?a.add(i):l.add(i)}}o.v.debug("Old unverified sessions: "+Array.from(a).join(",")),o.v.debug("New unverified sessions: "+Array.from(l).join(",")),o.v.debug("Currently showing toasts for: "+Array.from(this.displayingToastsForDeviceIds).join(","));const u=(()=>{try{const e=localStorage.getItem(D),t=Number.parseInt(e||"",10);return Number.isInteger(t)&&t+6048e5>Date.now()}catch(e){return!1}})();a.size>0&&c&&this.enableBulkUnverifiedSessionsReminder&&!u?O(a):S.A.sharedInstance().dismissToast(M);for(const e of l)ne(e);for(const e of this.displayingToastsForDeviceIds)l.has(e)||(o.v.debug("Hiding unverified session toast for "+e),ie(e));this.displayingToastsForDeviceIds=l}async reportCryptoSessionStateToAnalytics(e){const t=e.getCrypto(),n=await t.isSecretStorageReady(),i=await t.getCrossSigningStatus(),r=await this.getKeyBackupInfo(),o=null!=await e.secretStorage.getDefaultKeyId(),s=await t.getDeviceVerificationStatus(e.getUserId(),e.getDeviceId()),a=null!=s&&s.signedByOwner&&null!=s&&s.crossSigningVerified?"Verified":"NotVerified";let l;if(o){const e=i.privateKeysCachedLocally.masterKey&&i.privateKeysCachedLocally.selfSigningKey&&i.privateKeysCachedLocally.userSigningKey;if(null!=r){const i=null!=await t.getSessionBackupPrivateKey();l=n&&e&&i?"Enabled":"Incomplete"}else l=n&&e?"Enabled":"Incomplete"}else l="Disabled";this.analyticsVerificationState===a&&this.analyticsRecoveryState===l||(this.analyticsRecoveryState=l,this.analyticsVerificationState=a,I.Vo.instance.setProperty("recoveryState",l),I.Vo.instance.setProperty("verificationState",a),I.Vo.instance.trackEvent({eventName:"CryptoSessionState",verificationState:a,recoveryState:l}))}}var ue=n("./node_modules/matrix-react-sdk/src/widgets/Jitsi.ts"),me=n("./node_modules/matrix-react-sdk/src/BasePlatform.ts"),he=n("./node_modules/matrix-react-sdk/src/stores/ThreepidInviteStore.ts"),pe=n("./node_modules/matrix-react-sdk/src/LegacyCallHandler.tsx");const ge={};var ve=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),_e=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/QuestionDialog.tsx"),fe=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BugReportDialog.tsx"),ye=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),Ee=n("./node_modules/matrix-react-sdk/src/components/views/elements/DialogButtons.tsx");class be extends $.Component{constructor(...e){super(...e),(0,m.A)(this,"sendBugReport",(()=>{_.Ay.createDialog(fe.A,{error:this.props.error})})),(0,m.A)(this,"onClearStorageClick",(()=>{_.Ay.createDialog(_e.A,{title:(0,T._t)("action|sign_out"),description:$.createElement("div",null,(0,T._t)("error|session_restore|clear_storage_description")),button:(0,T._t)("action|sign_out"),danger:!0,onFinished:this.props.onFinished})})),(0,m.A)(this,"onRefreshClick",(()=>{window.location.reload()}))}render(){const e=se.Ay.get().brand,t=$.createElement("button",{onClick:this.onClearStorageClick,className:"danger"},(0,T._t)("error|session_restore|clear_storage_button"));let n;return n=se.Ay.get().bug_report_endpoint_url?$.createElement(Ee.A,{primaryButton:(0,T._t)("bug_reporting|send_logs"),onPrimaryButtonClick:this.sendBugReport,focus:!0,hasCancel:!1},t):$.createElement(Ee.A,{primaryButton:(0,T._t)("action|refresh"),onPrimaryButtonClick:this.onRefreshClick,focus:!0,hasCancel:!1},t),$.createElement(ye.A,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:(0,T._t)("error|session_restore|title"),contentId:"mx_Dialog_content",hasCancel:!1},$.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},$.createElement("p",null,(0,T._t)("error|session_restore|description_1")),$.createElement("p",null,(0,T._t)("error|session_restore|description_2",{brand:e})),$.createElement("p",null,(0,T._t)("error|session_restore|description_3"))),n)}}var we=n("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx");class xe extends $.Component{constructor(...e){super(...e),(0,m.A)(this,"sendBugReport",(e=>{e.preventDefault(),_.Ay.createDialog(fe.A,{})})),(0,m.A)(this,"onSignOutClick",(()=>{this.props.onFinished(!0)}))}render(){let e;return se.Ay.get().bug_report_endpoint_url&&(e=(0,T._t)("bug_reporting|log_request",{},{a:e=>$.createElement(we.A,{kind:"link_inline",onClick:this.sendBugReport},e)})),$.createElement(ye.A,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:(0,T._t)("error|storage_evicted_title"),contentId:"mx_Dialog_content",hasCancel:!1},$.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},$.createElement("p",null,(0,T._t)("error|storage_evicted_description_1")),$.createElement("p",null,(0,T._t)("error|storage_evicted_description_2")," ",e)),$.createElement(Ee.A,{primaryButton:(0,T._t)("action|sign_out"),onPrimaryButtonClick:this.onSignOutClick,focus:!0,hasCancel:!1}))}}var Ae=n("./node_modules/matrix-react-sdk/src/sentry.ts"),Se=n("./node_modules/classnames/index.js"),Ce=n.n(Se),ke=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/RoomSettingsDialog.tsx"),Re=n("./node_modules/matrix-js-sdk/src/types.ts"),Ie=n("./node_modules/matrix-react-sdk/src/hooks/useSettings.ts"),Te=n("./node_modules/matrix-react-sdk/src/settings/enums/Layout.ts"),Pe=n("./node_modules/matrix-react-sdk/src/Avatar.ts"),Ne=n("./node_modules/matrix-react-sdk/src/components/views/rooms/EventTile.tsx"),De=n("./node_modules/matrix-react-sdk/src/components/structures/SearchBox.tsx"),Me=n("./node_modules/matrix-react-sdk/src/components/views/avatars/DecoratedRoomAvatar.tsx"),Oe=n("./node_modules/matrix-react-sdk/src/components/structures/AutoHideScrollbar.tsx"),Le=n("./node_modules/matrix-react-sdk/src/stores/notifications/StaticNotificationState.ts"),Ue=n("./node_modules/matrix-react-sdk/src/components/views/rooms/NotificationBadge.tsx"),Fe=n("./node_modules/matrix-react-sdk/src/stores/room-list/algorithms/tag-sorting/RecentAlgorithm.ts"),je=n("./node_modules/matrix-react-sdk/src/autocomplete/QueryMatcher.ts"),Be=n("./node_modules/matrix-react-sdk/src/components/views/elements/TruncatedList.tsx"),Ve=n("./node_modules/matrix-react-sdk/src/components/views/rooms/EntityTile.tsx"),He=n("./node_modules/matrix-react-sdk/src/components/views/avatars/BaseAvatar.tsx"),ze=n("./node_modules/matrix-react-sdk/src/utils/EventUtils.ts"),We=n("./node_modules/matrix-react-sdk/src/utils/location/index.ts"),Ge=n("./node_modules/matrix-react-sdk/src/components/views/rooms/RoomContextDetails.tsx"),Ke=n("./node_modules/matrix-react-sdk/src/utils/arrays.ts"),Je=n("./node_modules/matrix-react-sdk/src/accessibility/RovingTabIndex.tsx"),qe=n("./node_modules/matrix-react-sdk/src/KeyBindingsManager.ts"),$e=n("./node_modules/matrix-react-sdk/src/accessibility/KeyboardShortcuts.ts");const Ye=["m.relates_to"];function Qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(n),!0).forEach((function(t){(0,m.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xe=function(e){return e[e.CanSend=0]="CanSend",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent",e[e.Failed=3]="Failed",e}(Xe||{});const et=({room:e,type:t,content:n,matrixClient:i,onFinished:r})=>{const[o,s]=(0,$.useState)(Xe.CanSend),[a,l,c]=(0,Je.A9)();let d,u,m,p=!1;o===Xe.CanSend?(d="mx_ForwardList_canSend",e.maySendMessage()||(p=!0,u=(0,T._t)("forward|no_perms_title"))):o===Xe.Sending?(d="mx_ForwardList_sending",p=!0,u=(0,T._t)("forward|sending"),m=$.createElement("div",{className:"mx_ForwardList_sendIcon","aria-label":u})):o===Xe.Sent?(d="mx_ForwardList_sent",p=!0,u=(0,T._t)("forward|sent"),m=$.createElement("div",{className:"mx_ForwardList_sendIcon","aria-label":u})):(d="mx_ForwardList_sendFailed",p=!0,u=(0,T._t)("timeline|send_state_failed"),m=$.createElement(Ue.A,{notification:Le.d.RED_EXCLAMATION}));const g=`mx_ForwardDialog_entry_${e.roomId}`;return $.createElement("div",{className:Ce()("mx_ForwardList_entry",{mx_ForwardList_entry_active:l}),"aria-labelledby":`${g}_name`,"aria-describedby":`${g}_send`,role:"listitem",ref:c,onFocus:a,id:g},$.createElement(we.A,{className:"mx_ForwardList_roomButton",onClick:t=>{h.Ay.dispatch({action:N.r.ViewRoom,room_id:e.roomId,metricsTrigger:"WebForwardShortcut",metricsViaKeyboard:"click"!==t.type}),r(!0)},title:(0,T._t)("forward|open_room"),placement:"top",tabIndex:l?0:-1},$.createElement(Me.A,{room:e,size:"32px",tooltipProps:{tabIndex:l?0:-1}}),$.createElement("span",{className:"mx_ForwardList_entry_name",id:`${g}_name`},e.name),$.createElement(Ge.n,{component:"span",className:"mx_ForwardList_entry_detail",room:e})),$.createElement(we.A,{kind:o===Xe.Failed?"danger_outline":"primary_outline",className:`mx_ForwardList_sendButton ${d}`,onClick:async()=>{s(Xe.Sending);try{await i.sendEvent(e.roomId,t,n),s(Xe.Sent)}catch(e){s(Xe.Failed)}},disabled:p,title:u,placement:"top",tabIndex:l?0:-1,id:`${g}_send`},$.createElement("div",{className:"mx_ForwardList_sendLabel"},(0,T._t)("forward|send_label")),m))},tt=({matrixClient:e,event:t,permalinkCreator:o,onFinished:s})=>{const a=e.getSafeUserId(),[l,c]=(0,$.useState)({});(0,$.useEffect)((()=>{e.getProfileInfo(a).then((e=>c(e)))}),[e,a]);const{type:d,content:u}=(e=>{const t=e.getContent(),{"m.relates_to":n}=t,o=(0,i.A)(t,Ye),s=r.M_BEACON.matches(e.getType())?r.EventType.RoomMessage:e.getType();if((0,ze.wq)(e)&&(0,We.qy)(o)||r.M_BEACON.matches(e.getType())){const t=r.M_TIMESTAMP.findIn(o),n=(0,We.jm)(e);return{type:s,content:Ze(Ze({},o),r.ContentHelpers.makeLocationContent(void 0,n,t||Date.now(),void 0,r.LocationAssetType.Pin))}}return{type:s,content:o}})(t),m=new r.MatrixEvent({type:"m.room.message",sender:a,content:u,unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:t.getRoomId(),origin_server_ts:t.getTs()});m.sender={name:l.displayname||a,rawDisplayName:l.displayname,userId:a,getAvatarUrl:(...e)=>(0,Pe.r4)({avatarUrl:l.avatar_url},30,30,"crop"),getMxcAvatarUrl:()=>l.avatar_url};const[h,p]=(0,$.useState)(""),g=h.toLowerCase(),v=(0,Ie.ti)("layout"),_=(0,Ie.ti)("feature_dynamic_room_predecessors");let f=(0,$.useMemo)((()=>(0,Fe.pP)(e.getVisibleRooms(_).filter((e=>e.getMyMembership()===Re.O.Join&&!e.isSpaceRoom())))),[e,_]);g&&(f=new je.A(f,{keys:["name"],funcs:[e=>(0,Ke.Bo)([e.getCanonicalAlias(),...e.getAltAliases()])],shouldMatchWordsOnly:!1}).match(g));const[y,E]=(0,$.useState)(20);function b(e,t){const i=(0,T._t)("common|and_n_others",{count:e});return $.createElement(Ve.A,{className:"mx_EntityTile_ellipsis",avatarJsx:$.createElement(He.A,{url:n("./node_modules/matrix-react-sdk/res/img/ellipsis.svg").A,name:"...",size:"36px"}),name:i,showPresence:!1,onClick:()=>E(t)})}return $.createElement(ye.A,{title:(0,T._t)("common|forward_message"),className:"mx_ForwardDialog",contentId:"mx_ForwardList",onFinished:s,fixedWidth:!1},$.createElement("h3",null,(0,T._t)("forward|message_preview_heading")),$.createElement("div",{className:Ce()("mx_ForwardDialog_preview",{mx_IRCLayout:v==Te.P.IRC})},$.createElement(Ne.Ay,{mxEvent:m,layout:v,permalinkCreator:o,as:"div",inhibitInteraction:!0})),$.createElement("hr",null),$.createElement(Je.Se,{handleUpDown:!0,handleInputFields:!0,onKeyDown:(e,t)=>{let n=!0;var i;(0,qe.zM)().getAccessibilityAction(e)===$e.bY.Enter?null===(i=t.activeRef)||void 0===i||null===(i=i.current)||void 0===i||null===(i=i.querySelector(".mx_ForwardList_sendButton"))||void 0===i||i.click():n=!1;n&&(e.preventDefault(),e.stopPropagation())},scrollIntoView:{block:"center"}},(({onKeyDownHandler:t})=>$.createElement("div",{className:"mx_ForwardList",id:"mx_ForwardList"},$.createElement(Je.ui.Consumer,null,(e=>{var n;return $.createElement(De.A,{className:"mx_textinput_icon mx_textinput_search",placeholder:(0,T._t)("forward|filter_placeholder"),onSearch:t=>{p(t),setTimeout((()=>{const t=e.state.refs[0];var n,i;t&&(e.dispatch({type:Je.ZU.SetFocus,payload:{ref:t}}),null===(n=t.current)||void 0===n||null===(i=n.scrollIntoView)||void 0===i||i.call(n,{block:"nearest"}))}))},autoFocus:!0,onKeyDown:t,"aria-activedescendant":null===(n=e.state.activeRef)||void 0===n||null===(n=n.current)||void 0===n?void 0:n.id,"aria-owns":"mx_ForwardDialog_resultsList"})})),$.createElement(Oe.A,{className:"mx_ForwardList_content"},f.length>0?$.createElement("div",{className:"mx_ForwardList_results"},$.createElement(Be.A,{id:"mx_ForwardDialog_resultsList",className:"mx_ForwardList_resultsList",truncateAt:y,createOverflowElement:b,getChildren:(t,n)=>f.slice(t,n).map((t=>$.createElement(et,{key:t.roomId,room:t,type:d,content:u,matrixClient:e,onFinished:s}))),getChildCount:()=>f.length})):$.createElement("span",{className:"mx_ForwardList_noResults"},(0,T._t)("common|no_results")))))))};var nt=n("./node_modules/matrix-react-sdk/src/createRoom.ts"),it=n("./node_modules/matrix-react-sdk/src/Markdown.ts"),rt=n("./node_modules/matrix-react-sdk/src/components/views/elements/StyledRadioButton.tsx"),ot=n("./node_modules/matrix-react-sdk/src/components/views/elements/Field.tsx"),st=n("./node_modules/matrix-react-sdk/src/components/views/elements/LabelledCheckbox.tsx");const at=["org.matrix.msc3215.room.moderation.moderated_by"];var lt=function(e){return e.Disagreement="org.matrix.msc3215.abuse.nature.disagreement",e.Toxic="org.matrix.msc3215.abuse.nature.toxic",e.Illegal="org.matrix.msc3215.abuse.nature.illegal",e.Spam="org.matrix.msc3215.abuse.nature.spam",e.Other="org.matrix.msc3215.abuse.nature.other",e}(lt||{}),ct=function(e){return e.Admin="non-standard.abuse.nature.admin",e}(ct||{});class dt extends $.Component{constructor(e){super(e),(0,m.A)(this,"moderation",void 0),(0,m.A)(this,"onIgnoreUserTooChanged",(e=>{this.setState({ignoreUserToo:e})})),(0,m.A)(this,"onReasonChange",(({target:{value:e}})=>{this.setState({reason:e})})),(0,m.A)(this,"onNatureChosen",(e=>{this.setState({nature:e.currentTarget.value})})),(0,m.A)(this,"onCancel",(()=>{this.props.onFinished(!1)})),(0,m.A)(this,"onSubmit",(async()=>{let e=this.state.reason||"";if(e=e.trim(),this.moderation){if(!this.state.nature||(this.state.nature==lt.Other||this.state.nature==ct.Admin)&&!e)return void this.setState({err:(0,T._t)("report_content|missing_reason")})}else if(!e)return void this.setState({err:(0,T._t)("report_content|missing_reason")});this.setState({busy:!0,err:void 0});try{const e=s.J.safeGet(),t=this.props.mxEvent;if(this.moderation&&this.state.nature!==ct.Admin){const n=this.state.nature,i=await(0,nt.EP)(e,this.moderation.moderationBotUserId);if(!i)throw new T.P7("report_content|error_create_room_moderation_bot");await e.sendEvent(i,"org.matrix.msc3215.abuse.report",{event_id:t.getId(),room_id:t.getRoomId(),moderated_by_id:this.moderation.moderationRoomId,nature:n,reporter:e.getUserId(),comment:this.state.reason.trim()})}else await e.reportEvent(t.getRoomId(),t.getId(),-100,this.state.reason.trim());this.state.ignoreUserToo&&await e.setIgnoredUsers([...e.getIgnoredUsers(),t.getSender()]),this.props.onFinished(!0)}catch(e){o.v.error(e),this.setState({busy:!1,err:e instanceof Error?e.message:String(e)})}}));let t=null,n=null;if(x.A.getValue("feature_report_to_moderators")){const i=s.J.safeGet().getRoom(e.mxEvent.getRoomId());for(const e of at){const r=null==i?void 0:i.currentState.getStateEvents(e,e);if(!r)continue;if(Array.isArray(r))throw new TypeError(`getStateEvents(${e}, ${e}) should return at most one state event`);const o=r.event;if(!("content"in o)||"object"!=typeof o.content){console.debug("Moderation error","state event",e,"should have an object field `content`, got",o);continue}const s=o.content;"room_id"in s&&"string"==typeof s.room_id?"user_id"in s&&"string"==typeof s.user_id?(t=s.room_id,n=s.user_id):console.debug("Moderation error","state event",e,"should have a string field `content.user_id`, got",o):console.debug("Moderation error","state event",e,"should have a string field `content.room_id`, got",o)}t&&n&&(this.moderation={moderationRoomId:t,moderationBotUserId:n})}this.state={reason:"",busy:!1,err:void 0,nature:void 0,ignoreUserToo:!1}}render(){var e;let t,n;this.state.err&&(t=$.createElement("div",{className:"error"},this.state.err)),this.state.busy&&(n=$.createElement("div",{className:"progress"},$.createElement(j.A,null)));const i=$.createElement(st.A,{value:this.state.ignoreUserToo,label:(0,T._t)("report_content|ignore_user"),byline:(0,T._t)("report_content|hide_messages_from_user"),onChange:this.onIgnoreUserTooChanged,disabled:this.state.busy}),r=null===(e=se.Ay.getObject("report_event"))||void 0===e?void 0:e.get("admin_message_md","adminMessageMD");let o;if(r){const e=new it.A(r).toHTML({externalLinks:!0});o=$.createElement("p",{dangerouslySetInnerHTML:{__html:e}})}if(this.moderation){const e=s.J.safeGet(),r=se.Ay.get("validated_server_config").hsName;let o;switch(this.state.nature){case lt.Disagreement:o=(0,T._t)("report_content|nature_disagreement");break;case lt.Toxic:o=(0,T._t)("report_content|nature_toxic");break;case lt.Illegal:o=(0,T._t)("report_content|nature_illegal");break;case lt.Spam:o=(0,T._t)("report_content|nature_spam");break;case ct.Admin:o=e.isRoomEncrypted(this.props.mxEvent.getRoomId())?(0,T._t)("report_content|nature_nonstandard_admin_encrypted",{homeserver:r}):(0,T._t)("report_content|nature_nonstandard_admin",{homeserver:r});break;case lt.Other:o=(0,T._t)("report_content|nature_other");break;default:o=(0,T._t)("report_content|nature")}return $.createElement(ye.A,{className:"mx_ReportEventDialog",onFinished:this.props.onFinished,title:(0,T._t)("action|report_content"),contentId:"mx_ReportEventDialog"},$.createElement("div",null,$.createElement(rt.A,{name:"nature",value:lt.Disagreement,checked:this.state.nature==lt.Disagreement,onChange:this.onNatureChosen},(0,T._t)("report_content|disagree")),$.createElement(rt.A,{name:"nature",value:lt.Toxic,checked:this.state.nature==lt.Toxic,onChange:this.onNatureChosen},(0,T._t)("report_content|toxic_behaviour")),$.createElement(rt.A,{name:"nature",value:lt.Illegal,checked:this.state.nature==lt.Illegal,onChange:this.onNatureChosen},(0,T._t)("report_content|illegal_content")),$.createElement(rt.A,{name:"nature",value:lt.Spam,checked:this.state.nature==lt.Spam,onChange:this.onNatureChosen},(0,T._t)("report_content|spam_or_propaganda")),$.createElement(rt.A,{name:"nature",value:ct.Admin,checked:this.state.nature==ct.Admin,onChange:this.onNatureChosen},(0,T._t)("report_content|report_entire_room")),$.createElement(rt.A,{name:"nature",value:lt.Other,checked:this.state.nature==lt.Other,onChange:this.onNatureChosen},(0,T._t)("report_content|other_label")),$.createElement("p",null,o),$.createElement(ot.A,{className:"mx_ReportEventDialog_reason",element:"textarea",label:(0,T._t)("room_settings|permissions|ban_reason"),rows:5,onChange:this.onReasonChange,value:this.state.reason,disabled:this.state.busy}),n,t,i),$.createElement(Ee.A,{primaryButton:(0,T._t)("action|send_report"),onPrimaryButtonClick:this.onSubmit,focus:!0,onCancel:this.onCancel,disabled:this.state.busy}))}return $.createElement(ye.A,{className:"mx_ReportEventDialog",onFinished:this.props.onFinished,title:(0,T._t)("report_content|report_content_to_homeserver"),contentId:"mx_ReportEventDialog"},$.createElement("div",{className:"mx_ReportEventDialog",id:"mx_ReportEventDialog"},$.createElement("p",null,(0,T._t)("report_content|description")),o,$.createElement(ot.A,{className:"mx_ReportEventDialog_reason",element:"textarea",label:(0,T._t)("room_settings|permissions|ban_reason"),rows:5,onChange:this.onReasonChange,value:this.state.reason,disabled:this.state.busy}),n,t,i),$.createElement(Ee.A,{primaryButton:(0,T._t)("action|send_report"),onPrimaryButtonClick:this.onSubmit,focus:!0,onCancel:this.onCancel,disabled:this.state.busy}))}}var ut=n("./node_modules/matrix-react-sdk/src/components/structures/TabbedView.tsx"),mt=n("./node_modules/matrix-react-sdk/src/components/views/elements/StyledCheckbox.tsx"),ht=n("./node_modules/matrix-react-sdk/src/components/views/elements/RoomName.tsx");let pt=function(e){return e.Appearance="SPACE_PREFERENCE_APPEARANCE_TAB",e}({});var gt=n("./node_modules/matrix-react-sdk/src/components/views/settings/tabs/SettingsTab.tsx"),vt=n("./node_modules/matrix-react-sdk/src/components/views/settings/shared/SettingsSection.tsx"),_t=n("./node_modules/matrix-react-sdk/src/components/views/settings/shared/SettingsSubsection.tsx");const ft=({space:e})=>{const t=(0,Ie.ti)("Spaces.showPeopleInSpace",e.roomId);return $.createElement(gt.A,null,$.createElement(vt.X,{heading:(0,T._t)("space|preferences|sections_section")},$.createElement(_t.Ay,null,$.createElement(mt.A,{checked:!!t,onChange:n=>{x.A.setValue("Spaces.showPeopleInSpace",e.roomId,A.p.ROOM_ACCOUNT,!t)}},(0,T._t)("common|people")),$.createElement(_t.sS,null,(0,T._t)("space|preferences|show_people_in_space",{spaceName:e.name})))))},yt=({space:e,onFinished:t})=>{const n=[new ut.oz(pt.Appearance,(0,T.AO)("common|appearance"),"mx_SpacePreferencesDialog_appearanceIcon",$.createElement(ft,{space:e}))];return $.createElement(ye.A,{className:"mx_SpacePreferencesDialog",hasCancel:!0,onFinished:t,title:(0,T._t)("common|preferences"),fixedWidth:!1},$.createElement("h4",null,$.createElement(ht.A,{room:e})),$.createElement("div",{className:"mx_SettingsDialog_content"},$.createElement(ut.Ay,{tabs:n,activeTabId:pt.Appearance,onChange:()=>{}})))};var Et=n("./node_modules/matrix-react-sdk/src/hooks/useDispatcher.ts"),bt=n("./node_modules/matrix-react-sdk/src/components/views/spaces/SpaceBasicSettings.tsx"),wt=n("./node_modules/matrix-react-sdk/src/editor/serialize.ts"),xt=n("./node_modules/matrix-react-sdk/src/utils/leave-behaviour.ts"),At=n("./node_modules/matrix-react-sdk/src/hooks/room/useTopic.ts");const St=({matrixClient:e,space:t})=>{var n,i,s;const[a,l]=(0,$.useState)(!1),[c,d]=(0,$.useState)(""),u=e.getUserId(),[m,h]=(0,$.useState)(null),p=t.currentState.maySendStateEvent(r.EventType.RoomAvatar,u),g=null!==m,[v,_]=(0,$.useState)(t.name),f=t.currentState.maySendStateEvent(r.EventType.RoomName,u),y=v!==t.name,E=null!==(n=null===(i=(0,At.e)(t))||void 0===i?void 0:i.text)&&void 0!==n?n:"",[b,w]=(0,$.useState)(E),x=t.currentState.maySendStateEvent(r.EventType.RoomTopic,u),A=b!==E;return $.createElement(gt.A,null,$.createElement(vt.X,{heading:(0,T._t)("common|general")},$.createElement("div",null,$.createElement("div",null,(0,T._t)("room_settings|general|description_space")),c&&$.createElement("div",{className:"mx_SpaceRoomView_errorText"},c),$.createElement(bt.A,{avatarUrl:null!==(s=(0,Pe.ze)(t,80,80,"crop"))&&void 0!==s?s:void 0,avatarDisabled:a||!p,setAvatar:h,name:v,nameDisabled:a||!f,setName:_,topic:b,topicDisabled:a||!x,setTopic:w}),$.createElement(we.A,{onClick:()=>{h(null),_(t.name),w(E)},disabled:a||!(g||y||A),kind:"link"},(0,T._t)("action|cancel")),$.createElement(we.A,{onClick:async()=>{l(!0);const n=[];if(g&&(m?n.push((async()=>{const{content_uri:n}=await e.uploadContent(m);await e.sendStateEvent(t.roomId,r.EventType.RoomAvatar,{url:n},"")})()):n.push(e.sendStateEvent(t.roomId,r.EventType.RoomAvatar,{},""))),y&&n.push(e.setRoomName(t.roomId,v)),A){const i=(0,wt.Ro)(b,{forceHTML:!1});n.push(e.setRoomTopic(t.roomId,b,i))}const i=await Promise.allSettled(n);l(!1);const s=i.filter((e=>"rejected"===e.status));s.length>0&&(o.v.error("Failed to save space settings: ",s),d((0,T._t)("room_settings|general|error_save_space_settings")))},disabled:a,kind:"primary"},a?(0,T._t)("common|saving"):(0,T._t)("room_settings|general|save"))),$.createElement(_t.Ay,{heading:(0,T._t)("room_settings|general|leave_space")},$.createElement(we.A,{kind:"danger",onClick:()=>{(0,xt.e)(t)}},(0,T._t)("room_settings|general|leave_space")))))};var Ct=n("./node_modules/matrix-react-sdk/src/components/views/room_settings/AliasSettings.tsx"),kt=n("./node_modules/matrix-react-sdk/src/hooks/useStateToggle.ts"),Rt=n("./node_modules/matrix-react-sdk/src/components/views/elements/LabelledToggleSwitch.tsx"),It=n("./node_modules/matrix-react-sdk/src/hooks/useLocalEcho.ts"),Tt=n("./node_modules/matrix-react-sdk/src/components/views/settings/JoinRuleSettings.tsx"),Pt=n("./node_modules/matrix-react-sdk/src/hooks/useRoomState.ts"),Nt=n("./node_modules/matrix-react-sdk/src/components/views/settings/SettingsFieldset.tsx"),Dt=n("./node_modules/matrix-react-sdk/src/hooks/useAsyncMemo.ts");const Mt=({matrixClient:e,space:t,closeSettingsFn:n})=>{const[i,o]=(0,$.useState)(""),s=(0,Dt.e)((async()=>e.isVersionSupported("v1.4").then((t=>t||e.doesServerSupportUnstableFeature("org.matrix.msc3827.stable")))),[e],!1),a=e.getUserId(),l=(0,Pt.U)(t,(e=>e.getJoinRule())),[c,d]=(0,It.W)((()=>{var e;return(null===(e=t.currentState.getStateEvents(r.EventType.RoomGuestAccess,""))||void 0===e||null===(e=e.getContent())||void 0===e?void 0:e.guest_access)===r.GuestAccess.CanJoin}),(n=>e.sendStateEvent(t.roomId,r.EventType.RoomGuestAccess,{guest_access:n?r.GuestAccess.CanJoin:r.GuestAccess.Forbidden},"")),(()=>o((0,T._t)("room_settings|visibility|error_update_guest_access")))),[u,m]=(0,It.W)((()=>{var e;return(null===(e=t.currentState.getStateEvents(r.EventType.RoomHistoryVisibility,""))||void 0===e||null===(e=e.getContent())||void 0===e?void 0:e.history_visibility)||r.HistoryVisibility.Shared}),(n=>e.sendStateEvent(t.roomId,r.EventType.RoomHistoryVisibility,{history_visibility:n},"")),(()=>o((0,T._t)("room_settings|visibility|error_update_history_visibility")))),[h,p]=(0,kt.X)(),g=t.currentState.maySendStateEvent(r.EventType.RoomGuestAccess,a),v=t.currentState.maySendStateEvent(r.EventType.RoomHistoryVisibility,a),_=t.currentState.mayClientSendStateEvent(r.EventType.RoomCanonicalAlias,e),f=t.currentState.getStateEvents(r.EventType.RoomCanonicalAlias,"");let y,E;return l===r.JoinRule.Public&&(y=$.createElement("div",null,$.createElement(we.A,{onClick:p,kind:"link",className:"mx_SettingsTab_showAdvanced","aria-expanded":h},h?(0,T._t)("action|hide_advanced"):(0,T._t)("action|show_advanced")),h&&$.createElement("div",{className:"mx_SettingsTab_toggleWithDescription"},$.createElement(Rt.A,{value:c,onChange:d,disabled:!g,label:(0,T._t)("room_settings|visibility|guest_access_label")}),$.createElement("p",null,(0,T._t)("room_settings|visibility|guest_access_explainer"),$.createElement("br",null),(0,T._t)("room_settings|visibility|guest_access_explainer_public_space"))))),t.getJoinRule()===r.JoinRule.Public&&(E=$.createElement(vt.X,{heading:(0,T._t)("room_settings|visibility|alias_section")},$.createElement(Ct.A,{roomId:t.roomId,canSetCanonicalAlias:_,canSetAliases:!0,canonicalAliasEvent:null!=f?f:void 0,hidePublishSetting:!s}))),$.createElement(gt.A,null,$.createElement(vt.X,{heading:(0,T._t)("room_settings|visibility|title")},i&&$.createElement("div",{className:"mx_SpaceRoomView_errorText"},i),$.createElement(Nt.A,{legend:(0,T._t)("room_settings|access|title"),description:(0,T._t)("room_settings|access|description_space",{spaceName:t.name})},$.createElement(Tt.A,{room:t,onError:()=>o((0,T._t)("room_settings|visibility|error_failed_save")),closeSettingsFn:n}),y,$.createElement("div",{className:"mx_SettingsTab_toggleWithDescription"},$.createElement(Rt.A,{value:u===r.HistoryVisibility.WorldReadable,onChange:e=>{m(e?r.HistoryVisibility.WorldReadable:r.HistoryVisibility.Shared)},disabled:!v,label:(0,T._t)("room_settings|visibility|history_visibility_anyone_space")}),$.createElement("p",null,(0,T._t)("room_settings|visibility|history_visibility_anyone_space_description"),$.createElement("br",null),$.createElement("b",null,(0,T._t)("room_settings|visibility|history_visibility_anyone_space_recommendation"))))),E))};var Ot=n("./node_modules/matrix-react-sdk/src/components/views/settings/tabs/room/AdvancedRoomSettingsTab.tsx"),Lt=n("./node_modules/matrix-react-sdk/src/components/views/settings/tabs/room/RolesRoomSettingsTab.tsx");let Ut=function(e){return e.General="SPACE_GENERAL_TAB",e.Visibility="SPACE_VISIBILITY_TAB",e.Roles="SPACE_ROLES_TAB",e.Advanced="SPACE_ADVANCED_TAB",e}({});const Ft=({matrixClient:e,space:t,onFinished:n})=>{(0,Et.F)(h.Ay,(e=>{e.action===N.r.AfterLeaveRoom&&e.room_id===t.roomId&&n()}));const i=(0,$.useMemo)((()=>[new ut.oz(Ut.General,(0,T.AO)("common|general"),"mx_SpaceSettingsDialog_generalIcon",$.createElement(St,{matrixClient:e,space:t})),new ut.oz(Ut.Visibility,(0,T.AO)("room_settings|visibility|title"),"mx_SpaceSettingsDialog_visibilityIcon",$.createElement(Mt,{matrixClient:e,space:t,closeSettingsFn:n})),new ut.oz(Ut.Roles,(0,T.AO)("room_settings|permissions|title"),"mx_RoomSettingsDialog_rolesIcon",$.createElement(Lt.A,{room:t})),x.A.getValue(le.f.AdvancedSettings)?new ut.oz(Ut.Advanced,(0,T.AO)("common|advanced"),"mx_RoomSettingsDialog_warningIcon",$.createElement(Ot.A,{room:t,closeSettingsFn:n})):null].filter(Boolean)),[e,t,n]),[r,o]=$.useState(Ut.General);return $.createElement(ye.A,{title:(0,T._t)("space_settings|title",{spaceName:t.name||(0,T._t)("common|unnamed_space")}),className:"mx_SpaceSettingsDialog",contentId:"mx_SpaceSettingsDialog",onFinished:n,fixedWidth:!1},$.createElement("div",{className:"mx_SpaceSettingsDialog_content",id:"mx_SpaceSettingsDialog"},$.createElement(ut.Ay,{tabs:i,activeTabId:r,onChange:o})))};var jt,Bt=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/InviteDialog.tsx"),Vt=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/AddExistingToSpaceDialog.tsx"),Ht=n("./node_modules/matrix-react-sdk/src/PosthogTrackers.ts"),zt=n("./node_modules/matrix-react-sdk/src/utils/space.tsx"),Wt=n("./node_modules/matrix-react-sdk/src/contexts/SDKContext.ts");class Gt{constructor(){(0,m.A)(this,"isRegistered",!1),(0,m.A)(this,"matrixClient",void 0),(0,m.A)(this,"onDispatch",(e=>{if(this.matrixClient)switch(e.action){case"open_room_settings":_.Ay.createDialog(ke.A,{roomId:e.room_id||Wt.M.instance.roomViewStore.getRoomId(),initialTabId:e.initial_tab_id},void 0,!1,!0);break;case N.r.OpenForwardDialog:_.Ay.createDialog(tt,{matrixClient:this.matrixClient,event:e.event,permalinkCreator:e.permalinkCreator});break;case N.r.OpenReportEventDialog:_.Ay.createDialog(dt,{mxEvent:e.event},"mx_Dialog_reportEvent");break;case N.r.OpenSpacePreferences:_.Ay.createDialog(yt,{space:e.space},void 0,!1,!0);break;case N.r.OpenSpaceSettings:_.Ay.createDialog(Ft,{matrixClient:e.space.client,space:e.space},void 0,!1,!0);break;case N.r.OpenInviteDialog:_.Ay.createDialog(Bt.A,{kind:e.kind,call:e.call,roomId:e.roomId},Ce()("mx_InviteDialog_flexWrapper",e.className),!1,!0).finished.then((t=>{var n;null===(n=e.onFinishedCallback)||void 0===n||n.call(e,t)}));break;case N.r.OpenAddToExistingSpaceDialog:{const t=e.space;_.Ay.createDialog(Vt.Ay,{onCreateRoomClick:e=>{(0,zt.PT)(t),Ht.A.trackInteraction("WebAddExistingToSpaceDialogCreateRoomButton",e)},onAddSubspaceClick:()=>(0,zt.K1)(t),space:t,onFinished:e=>{e&&Wt.M.instance.roomViewStore.getRoomId()===t.roomId&&h.Ay.fire(N.r.UpdateSpaceHierarchy)}},"mx_AddExistingToSpaceDialog_wrapper");break}}}))}prepare(e){this.matrixClient=e,this.isRegistered||(h.Ay.register(this.onDispatch),this.isRegistered=!0)}}jt=Gt,(0,m.A)(Gt,"instance",new jt);var Kt=n("./node_modules/matrix-react-sdk/src/utils/ErrorUtils.tsx"),Jt=n("./node_modules/matrix-react-sdk/src/utils/oidc/authorize.ts"),qt=n("./node_modules/matrix-react-sdk/src/utils/oidc/error.ts"),$t=n("./node_modules/matrix-react-sdk/src/utils/oidc/persistOidcSettings.ts"),Yt=n("./node_modules/matrix-js-sdk/src/utils/encryptAESSecretStorageItem.ts"),Qt=n("./node_modules/matrix-js-sdk/src/utils/decryptAESSecretStorageItem.ts");n("./node_modules/matrix-js-sdk/src/secret-storage.ts");const Zt="mx_access_token",Xt="mx_refresh_token",en="access_token",tn="refresh_token",nn="mx_has_access_token",rn="mx_has_refresh_token";async function on(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);const n=await crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits"]);return t.fill(0),new Uint8Array(await crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(32),info:new Uint8Array(0)},n,256))}const sn=e=>!!e&&"string"!=typeof e;async function an(e,t,n){if(e&&sn(t)){const i=await on(e),r=await(0,Qt.A)(t,i,n);return i.fill(0),r}if("string"==typeof t)return t}async function ln(e,t,n,i,r){if(n?localStorage.setItem(r,"true"):localStorage.removeItem(r),i){let r;if(n)try{const e=await on(i);r=await(0,Yt.A)(n,e,t),e.fill(0)}catch(t){o.v.warn(`Could not encrypt token for ${e}`,t)}try{await w.x7("account",e,r||n)}catch(t){n?localStorage.setItem(e,n):localStorage.removeItem(e)}}else try{await w.x7("account",e,n)}catch(t){n?localStorage.setItem(e,n):localStorage.removeItem(e)}}async function cn(e,t){return ln(Zt,en,e,t,nn)}async function dn(e,t){return ln(Xt,tn,e,t,rn)}class un extends r.OidcTokenRefresher{constructor(e,t,n,i,r,o){super(e,t,i,n,r),(0,m.A)(this,"deviceId",void 0),this.userId=o,this.deviceId=i}async persistTokens({accessToken:e,refreshToken:t}){var n,i;const r=null!==(n=await(null===(i=y.A.get())||void 0===i?void 0:i.getPickleKey(this.userId,this.deviceId)))&&void 0!==n?n:void 0;await cn(e,r),await dn(t,r)}}var mn=n("./node_modules/matrix-react-sdk/src/SupportedBrowser.ts");const hn=["roomId"],pn="mx_hs_url",gn="mx_is_url";h.Ay.register((e=>{if(e.action===N.r.TriggerLogout)Bn();else if(e.action===N.r.OverwriteLogin){const t=e;Hn(!1),Pn(t.credentials,!0,!0).catch((e=>{o.v.warn("Failed to overwrite login",e)}))}}));let vn=!1;async function _n(){vn=!0,Hn()}function fn(){if(vn)throw new yn("session lock has been released")}class yn extends Error{}async function En(e={}){try{let t=e.enableGuest||!1;const n=e.guestHsUrl,i=e.guestIsUrl,s=e.fragmentQueryParams||{},a=e.defaultDeviceDisplayName;if(t&&!n&&(o.v.warn("Cannot enable guest access: can't determine HS URL to use"),t=!1),t&&n&&s.guest_user_id&&s.guest_access_token)return o.v.log("Using guest access credentials"),Pn({userId:s.guest_user_id,accessToken:s.guest_access_token,homeserverUrl:n,identityServerUrl:i,guest:!0},!0,!1).then((()=>!0));return!!await Rn({ignoreGuest:Boolean(e.ignoreGuest)})||!vn&&(!(!t||!n)&&function(e,t,n){o.v.log(`Doing guest login on ${e}`);return(0,r.createClient)({baseUrl:e}).registerGuest({body:{initial_device_display_name:n}}).then((n=>(o.v.log(`Registered as guest: ${n.user_id}`),Pn({userId:n.user_id,deviceId:n.device_id,accessToken:n.access_token,homeserverUrl:e,identityServerUrl:t,guest:!0},!0,!0).then((()=>!0)))),(e=>(o.v.error("Failed to register as guest",e),!1)))}(n,i,a))}catch(e){return!(e instanceof Nn)&&(!vn&&async function(e){o.v.error("Unable to load session",e);const t=_.Ay.createDialog(be,{error:e}),[n]=await t.finished;if(n)return await Vn(),!1;return En()}(e))}}async function bn(){const{hsUrl:e,userId:t,hasAccessToken:n,isGuest:i}=await Cn();return e&&t&&n?[t,!!i]:[null,null]}async function wn(e,t,n){return e.code&&e.state?(console.log("We have OIDC params - attempting OIDC login"),async function(e){try{const{accessToken:t,refreshToken:n,homeserverUrl:i,identityServerUrl:s,idToken:a,clientId:l,issuer:c}=await(0,Jt.Y)(e),{user_id:d,device_id:u,is_guest:m}=await async function(e,t,n){try{const i=(0,r.createClient)({baseUrl:t,accessToken:e,idBaseUrl:n});return await i.whoami()}catch(e){throw o.v.error("Failed to retrieve userId using accessToken",e),new Error("Failed to retrieve userId using accessToken")}}(t,i,s),h={accessToken:t,refreshToken:n,homeserverUrl:i,identityServerUrl:s,deviceId:u,userId:d,isGuest:m};return o.v.debug("Logged in via OIDC native flow"),await xn(h),(0,$t.UF)(l,c,a),!0}catch(e){return o.v.error("Failed to login via OIDC",e),await An((0,qt.v)(e)),!1}}(e)):function(e,t,n){var i;if(!e.loginToken)return Promise.resolve(!1);console.log("We have token login params - attempting token login");const s=localStorage.getItem(me.FL),a=null!==(i=localStorage.getItem(me.U7))&&void 0!==i?i:void 0;if(!s)return o.v.warn("Cannot log in with token: can't determine HS URL to use"),An((0,T._t)("auth|sso_failed_missing_storage")),Promise.resolve(!1);return(0,E.b)(s,a,"m.login.token",{token:e.loginToken,initial_device_display_name:t}).then((async function(e){return o.v.log("Logged in with token"),await xn(e),!0})).catch((e=>{const t=()=>{var e;const t=(0,r.createClient)({baseUrl:s,idBaseUrl:a}),i=localStorage.getItem(me.ot)||void 0;null===(e=y.A.get())||void 0===e||e.startSingleSignOn(t,"sso",n,i,r.SSOAction.LOGIN)};return An((0,Kt.Y0)(e,{hsUrl:s,hsName:s}),t),o.v.error("Failed to log in with login token:",e),!1}))}(e,t,n)}async function xn(e){await Vn(),await Dn(e),sessionStorage.setItem("mx_fresh_login",String(!0))}async function An(e,t){_.Ay.createDialog(ve.A,{title:(0,T._t)("auth|oidc|error_title"),description:e,button:(0,T._t)("action|try_again"),onFinished:t?e=>e&&t():void 0})}async function Sn(e){let t;try{t=await w.Gt("account",e)}catch(t){o.v.error(`StorageManager.idbLoad failed for account:${e}`,t)}var n;if(!t&&(t=null!==(n=localStorage.getItem(e))&&void 0!==n?n:void 0,t))try{await w.x7("account",e,t),localStorage.removeItem(e)}catch(t){o.v.error(`migration of token ${e} to IndexedDB failed`,t)}return t}async function Cn(){var e,t,n,i;const r=null!==(e=localStorage.getItem(pn))&&void 0!==e?e:void 0,o=null!==(t=localStorage.getItem(gn))&&void 0!==t?t:void 0,s=await Sn(Zt),a=await Sn(Xt),l="true"===localStorage.getItem(nn)||!!s,c="true"===localStorage.getItem(rn)||!!a,d=null!==(n=localStorage.getItem("mx_user_id"))&&void 0!==n?n:void 0,u=null!==(i=localStorage.getItem("mx_device_id"))&&void 0!==i?i:void 0;let m;return m=null!==localStorage.getItem("mx_is_guest")?"true"===localStorage.getItem("mx_is_guest"):"true"===localStorage.getItem("matrix-is-guest"),{hsUrl:r,isUrl:o,hasAccessToken:l,accessToken:s,refreshToken:a,hasRefreshToken:c,userId:d,deviceId:u,isGuest:m}}async function kn(){if(await async function(){const{finished:e}=_.Ay.createDialog(xe),[t]=await e;return!!t}())throw await Vn(),new Nn("Aborting login in progress because of storage inconsistency")}async function Rn(e){const t=null==e?void 0:e.ignoreGuest;if(!localStorage)return!1;const{hsUrl:n,isUrl:i,hasAccessToken:r,accessToken:s,refreshToken:a,userId:l,deviceId:c,isGuest:d}=await Cn();if(r&&!s&&await kn(),s&&l&&n){var u,m;if(t&&d)return o.v.log("Ignoring stored guest account: "+l),!1;const e=null!==(u=await(null===(m=y.A.get())||void 0===m?void 0:m.getPickleKey(l,null!=c?c:"")))&&void 0!==u?u:void 0;e?o.v.log(`Got pickle key for ${l}|${c}`):o.v.log("No pickle key available");const r=await an(e,s,en),h=await an(e,a,tn),p="true"===sessionStorage.getItem("mx_fresh_login");return sessionStorage.removeItem("mx_fresh_login"),o.v.log(`Restoring session for ${l}`),await Pn({userId:l,deviceId:c,accessToken:r,refreshToken:h,homeserverUrl:n,identityServerUrl:i,guest:d,pickleKey:null!=e?e:void 0,freshLogin:p},!1,!1),!0}return o.v.log("No previous session found."),!1}async function In(e){var t;e.freshLogin=!0,Hn();const n=e.userId&&e.deviceId?await(null===(t=y.A.get())||void 0===t?void 0:t.createPickleKey(e.userId,e.deviceId)):null;return n?o.v.log(`Created pickle key for ${e.userId}|${e.deviceId}`):o.v.log("Pickle key not created"),Pn(Object.assign({},e,{pickleKey:n}),!0,!0)}async function Tn(e){const t=s.J.safeGet().getUserId(),n=s.J.safeGet().getDeviceId();Hn(),localStorage.removeItem("mx_soft_logout"),Mn=!1;const i=e.userId!==t||e.deviceId!==n;var r,a;(i&&o.v.warn("Clearing all data: Old session belongs to a different user/session"),e.pickleKey||void 0===e.deviceId)||(o.v.info("Lifecycle#hydrateSession: Pickle key not provided - trying to get one"),e.pickleKey=null!==(r=await(null===(a=y.A.get())||void 0===a?void 0:a.getPickleKey(e.userId,e.deviceId)))&&void 0!==r?r:void 0);return Pn(e,i,!1)}async function Pn(e,t,n){fn(),e.guest=Boolean(e.guest);const i=Un();o.v.log("setLoggedIn: mxid: "+e.userId+" deviceId: "+e.deviceId+" guest: "+e.guest+" hs: "+e.homeserverUrl+" softLogout: "+i," freshLogin: "+e.freshLogin),t&&await Vn();const a=await b.zV();a.dataInLocalStorage&&a.cryptoInited&&!a.dataInCryptoStore&&await kn();const l=await async function(e){if(!e.refreshToken)return;const t=(0,$t.HB)();if(t)try{const n=(0,$t.rW)(),i=(0,$t.ag)(),r=y.A.get().getOidcCallbackUrl().href,o=e.deviceId;if(!o)throw new Error("Expected deviceId in user credentials.");const s=new un(t,n,r,o,i,e.userId);return await s.oidcClientReady,s}catch(e){o.v.error("Failed to initialise OIDC token refresher",e)}}(e);fn(),s.J.replaceUsingCreds(e,null==l?void 0:l.doRefreshAccessToken.bind(l));const c=s.J.safeGet();if((0,Ae.Tm)(e.userId),I.Vo.instance.isEnabled()&&I.Vo.instance.startListeningToSettingsChanges(c),e.freshLogin&&x.A.getValue("feature_dehydration")){const t=await c.rehydrateDevice();t&&(e.deviceId=t),delete e.freshLogin}if(localStorage)try{await Dn(e),sessionStorage.removeItem("mx_fresh_login")}catch(e){o.v.warn("Error using local storage: can't persist session!",e)}else o.v.warn("No local storage available: can't persist session!");fn(),h.Ay.fire(N.r.OnLoggedIn);const d={};e.pickleKey&&(43===e.pickleKey.length?d.rustCryptoStoreKey=(0,r.decodeBase64)(e.pickleKey):d.rustCryptoStorePassword=e.pickleKey);try{await jn(c,!i,d)}finally{var u;null===(u=d.rustCryptoStoreKey)||void 0===u||u.fill(0)}return x.A.runMigrations(n),c}class Nn extends Error{}async function Dn(e){var t;localStorage.setItem(pn,e.homeserverUrl),e.identityServerUrl&&localStorage.setItem(gn,e.identityServerUrl),localStorage.setItem("mx_user_id",e.userId),localStorage.setItem("mx_is_guest",JSON.stringify(e.guest)),await cn(e.accessToken,e.pickleKey),await dn(e.refreshToken,e.pickleKey),e.pickleKey?localStorage.setItem("mx_has_pickle_key",String(!0)):"true"===localStorage.getItem("mx_has_pickle_key")&&o.v.error("Expected a pickle key, but none provided.  Encryption may not work."),e.deviceId&&localStorage.setItem("mx_device_id",e.deviceId),null===(t=a.r.instance.extensions.cryptoSetup)||void 0===t||t.persistCredentials(e),o.v.log(`Session persisted for ${e.userId}`)}let Mn=!1;function On(e){var t,n;const i=s.J.get();i&&(I.Vo.instance.logout(),i.isGuest()?setTimeout(Bn,0):(Mn=!0,null===(t=y.A.get())||void 0===t||t.destroyPickleKey(i.getSafeUserId(),null!==(n=i.getDeviceId())&&void 0!==n?n:""),async function(e,t){if(null!=t&&t.isUserAuthenticatedWithOidc){var n,i;const r=null!==(n=e.getAccessToken())&&void 0!==n?n:void 0,o=null!==(i=e.getRefreshToken())&&void 0!==i?i:void 0;await t.revokeTokens(r,o)}else await e.logout(!0)}(i,e).then(Bn,(e=>{o.v.warn("Failed to call logout API: token will not be invalidated",e),Bn()}))))}function Ln(){s.J.get()&&(localStorage.setItem("mx_soft_logout","true"),o.v.log("Soft logout initiated"),Mn=!0,h.Ay.dispatch({action:"on_client_not_viable"}),Hn(!1))}function Un(){return"true"===localStorage.getItem("mx_soft_logout")}function Fn(){return Mn}async function jn(e,t,n){o.v.log("Lifecycle: Starting MatrixClient"),h.Ay.dispatch({action:"will_start_client"},!0),Wt.M.instance.typingStore.reset(),S.A.sharedInstance().reset(),Gt.instance.prepare(e),d.default.start(),u.A.sharedInstance().start(),v.A.makeShared(e).start(),C.J.sharedInstance().startWatching(),f.A.instance.start(),pe.Ay.instance.start(),(0,mn.o7)(),k.u.sharedInstance().start(),t?(await l.A.init(),await s.J.start(n)):(o.v.warn("Caller requested only auxiliary services be started"),await s.J.assign(n)),fn(),de.sharedInstance().start(e),x.A.getValue("lowBandwidth")||g.start(),ue.k.getInstance().start(),h.Ay.dispatch({action:"client_started"}),Un()&&Ln()}async function Bn(){var e,t;h.Ay.fire(N.r.OnLoggedOut,!0),Hn(),await Vn({deleteEverything:!0}),null===(e=ge.onLoggedOutAndStorageCleared)||void 0===e||e.call(ge),await(null===(t=y.A.get())||void 0===t?void 0:t.clearStorage()),x.A.reset(),se.Ay.get().logout_redirect_url&&(o.v.log("Redirecting to external provider to finish logout"),window.setTimeout((()=>{window.location.href=se.Ay.get().logout_redirect_url}),100)),Mn=!1}async function Vn(e){var t;if(window.localStorage){const t=x.A.getValueAt(A.p.DEVICE,"language",null,!0,!0),n=he.A.instance.getWireInvites(),r=window.localStorage.getItem("mx_registration_time");window.localStorage.clear();try{await w.N6("account",Zt)}catch(e){o.v.error("idbDelete failed for account:mx_access_token",e)}null!=e&&e.deleteEverything||(t&&await x.A.setValue("language",null,A.p.DEVICE,t),n.forEach((e=>{let{roomId:t}=e,n=(0,i.A)(e,hn);he.A.instance.storeInvite(t,n)})),r&&window.localStorage.setItem("mx_registration_time",r))}null===(t=window.sessionStorage)||void 0===t||t.clear();const n=(0,c.A)({baseUrl:""});await l.A.deleteEventIndex(),await n.clearStores()}function Hn(e=!0){var t;d.default.stop(),pe.Ay.instance.stop(),u.A.sharedInstance().stop(),Wt.M.instance.typingStore.reset(),g.stop(),f.A.instance.stop(),C.J.sharedInstance().stopWatching(),k.u.sharedInstance().stop(),de.sharedInstance().stop(),null===(t=v.A.shared())||void 0===t||t.stop(),l.A.stop();const n=s.J.get();n&&(n.stopClient(),n.removeAllListeners(),e&&(s.J.unset(),l.A.unset(),n.store.destroy()))}window.mxLoginWithAccessToken=async(e,t)=>{const n=(0,r.createClient)({baseUrl:e,accessToken:t}),{user_id:i}=await n.whoami();await Pn({homeserverUrl:e,accessToken:t,userId:i},!0,!1)}},"./node_modules/matrix-react-sdk/src/Login.ts":(e,t,n)=>{"use strict";n.d(t,{A:()=>c,b:()=>u});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/matrix-js-sdk/src/matrix.ts"),o=n("./node_modules/matrix-js-sdk/src/logger.ts"),s=n("./node_modules/matrix-react-sdk/src/modules/ModuleRunner.ts"),a=n("./node_modules/matrix-react-sdk/src/PlatformPeg.ts");var l=n("./node_modules/matrix-react-sdk/src/SdkConfig.ts");class c{constructor(e,t,n,r){(0,i.A)(this,"flows",[]),(0,i.A)(this,"defaultDeviceDisplayName",void 0),(0,i.A)(this,"delegatedAuthentication",void 0),(0,i.A)(this,"tempClient",null),this.hsUrl=e,this.isUrl=t,this.fallbackHsUrl=n,this.defaultDeviceDisplayName=r.defaultDeviceDisplayName,this.delegatedAuthentication=r.delegatedAuthentication}getHomeserverUrl(){return this.hsUrl}getIdentityServerUrl(){return this.isUrl}setHomeserverUrl(e){this.tempClient=null,this.hsUrl=e}setIdentityServerUrl(e){this.tempClient=null,this.isUrl=e}setDelegatedAuthentication(e){this.tempClient=null,this.delegatedAuthentication=e}createTemporaryClient(){return this.tempClient||(this.tempClient=(0,r.createClient)({baseUrl:this.hsUrl,idBaseUrl:this.isUrl})),this.tempClient}async getFlows(e){if(this.delegatedAuthentication)try{return[await d(this.delegatedAuthentication,l.Ay.get().oidc_static_clients,e)]}catch(e){o.v.error(e)}const t=this.createTemporaryClient(),{flows:n}=await t.loginFlows(),i=n.find((e=>"m.login.sso"===e.type&&r.DELEGATED_OIDC_COMPATIBILITY.findIn(e)));return this.flows=i?[i]:n,this.flows}loginViaPassword(e,t,n,i){const r=!!e&&e.indexOf("@")>0;let s;s=t&&n?{type:"m.id.phone",country:t,phone:n,number:n}:r?{type:"m.id.thirdparty",medium:"email",address:e}:{type:"m.id.user",user:e};const a={password:i,identifier:s,initial_device_display_name:this.defaultDeviceDisplayName},l=e=>u(this.fallbackHsUrl,this.isUrl,"m.login.password",a).catch((t=>{throw o.v.log("fallback HS login failed",t),e}));let c=null;return u(this.hsUrl,this.isUrl,"m.login.password",a).catch((e=>{if(c=e,403===e.httpStatus&&this.fallbackHsUrl)return l(c);throw c})).catch((e=>{throw o.v.log("Login failed",e),e}))}}const d=async(e,t,n)=>{if(n&&!(e=>{const t=e.metadata.prompt_values_supported;return Array.isArray(t)&&(null==t?void 0:t.includes("create"))})(e))throw new Error("Registration is not supported by OP");const i=await(async(e,t)=>{const n=((e,t)=>{var n;const i=e.endsWith("/")?e:e+"/";return null==t||null===(n=t[i])||void 0===n?void 0:n.client_id})(e.metadata.issuer,t);return n?(o.v.debug(`Using static clientId for issuer ${e.metadata.issuer}`),n):await(0,r.registerOidcClient)(e,await a.A.get().getOidcClientMetadata())})(e,t);return{type:"oidcNativeFlow",clientId:i}};async function u(e,t,n,i){const a=(0,r.createClient)({baseUrl:e,idBaseUrl:t}),l=await a.login(n,i),c=l.well_known;var d,u;c&&(null!==(d=c["m.homeserver"])&&void 0!==d&&d.base_url&&(e=c["m.homeserver"].base_url,o.v.log(`Overrode homeserver setting with ${e} from login response`)),null!==(u=c["m.identity_server"])&&void 0!==u&&u.base_url&&(t=c["m.identity_server"].base_url,o.v.log(`Overrode IS setting with ${t} from login response`)));const m={homeserverUrl:e,identityServerUrl:t,userId:l.user_id,deviceId:l.device_id,accessToken:l.access_token};return s.r.instance.extensions.cryptoSetup.examineLoginResponse(l,m),m}},"./node_modules/matrix-react-sdk/src/components/structures/ErrorMessage.tsx":(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-react-sdk/res/img/compound/error-16px.svg");const o=({message:e})=>{const t=e?i.createElement(r.I,{className:"mx_Icon mx_Icon_16"}):null;return i.createElement("div",{className:"mx_ErrorMessage"},t,e)}},"./node_modules/matrix-react-sdk/src/components/structures/MatrixChat.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>GS});var i=n("./node_modules/@babel/runtime/helpers/esm/extends.js"),r=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("./node_modules/react/index.js"),s=n("./node_modules/matrix-js-sdk/src/matrix.ts"),a=n("./node_modules/matrix-js-sdk/src/utils.ts"),l=n("./node_modules/matrix-js-sdk/src/logger.ts"),c=n("./node_modules/lodash/lodash.js"),d=n("./node_modules/matrix-js-sdk/src/crypto/index.ts"),u=(n("./node_modules/what-input/dist/what-input.js"),n("./node_modules/matrix-react-sdk/src/PosthogTrackers.ts")),m=n("./node_modules/matrix-react-sdk/src/DecryptionFailureTracker.ts"),h=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),p=n("./node_modules/matrix-react-sdk/src/PlatformPeg.ts"),g=n("./node_modules/matrix-react-sdk/src/SdkConfig.ts"),v=n("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),_=n("./node_modules/matrix-react-sdk/src/Notifier.ts"),f=n("./node_modules/matrix-react-sdk/src/Modal.tsx"),y=n("./node_modules/matrix-react-sdk/src/RoomInvite.tsx"),E=n("./node_modules/matrix-react-sdk/src/Rooms.ts"),b=n("./node_modules/matrix-react-sdk/src/Lifecycle.ts"),w=n("./node_modules/matrix-js-sdk/src/version-support.ts"),x=n("./node_modules/matrix-react-sdk/src/dispatcher/actions.ts"),A=n("./node_modules/matrix-react-sdk/src/stores/AsyncStore.ts"),S=n("./node_modules/matrix-react-sdk/src/stores/ToastStore.ts"),C=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),k=n("./node_modules/matrix-react-sdk/src/components/views/toasts/GenericToast.tsx");const R={deferredAction:null};class I extends A.y{constructor(){super(v.Ay,R)}onDispatch(e){switch(e.action){case x.r.DoAfterSyncPrepared:this.updateState({deferredAction:e.deferred_action});break;case"cancel_after_sync_prepared":this.updateState({deferredAction:null});break;case"MatrixActions.sync":{if(e.state===s.SyncState.Syncing&&e.prevState!==s.SyncState.Syncing&&async function(){try{const e=h.J.get();if(!e)return;for(const t of w.Hr)if(await e.isVersionSupported(t))return;const t="LEGACY_SERVER";S.A.sharedInstance().addOrReplaceToast({key:t,title:(0,C._t)("unsupported_server_title"),props:{description:(0,C._t)("unsupported_server_description",{version:w.eD,brand:g.Ay.get().brand}),primaryLabel:(0,C._t)("action|ok"),onPrimaryClick:()=>{S.A.sharedInstance().dismissToast(t)}},component:k.A,priority:98})}catch(e){l.v.warn("Failed to check server versions",e)}}(),"PREPARED"!==e.state)break;if(!this.state.deferredAction)break;const t=Object.assign({},this.state.deferredAction);this.updateState({deferredAction:null}),v.Ay.dispatch(t);break}case"on_client_not_viable":case x.r.OnLoggedOut:this.reset()}}}let T=null;T||(T=new I);var P,N=n("./node_modules/uuid/dist/esm-browser/v4.js"),D=n("./node_modules/matrix-react-sdk/src/rageshake/submit-rageshake.ts"),M=n("./node_modules/matrix-react-sdk/src/stores/AsyncStoreWithClient.ts"),O=n("./node_modules/matrix-react-sdk/src/settings/SettingsStore.ts");function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const F="im.vector.auto_rs_request";class j extends M.r{constructor(){super(v.Ay,{reportedSessionIds:new Set,lastRageshakeTime:0,initialSyncCompleted:!1}),this.onDecryptionAttempt=this.onDecryptionAttempt.bind(this),this.onDeviceMessage=this.onDeviceMessage.bind(this),this.onSyncStateChange=this.onSyncStateChange.bind(this)}static get instance(){return j.internalInstance}async onAction(e){if(e.action===x.r.ReportKeyBackupNotEnabled)this.onReportKeyBackupNotEnabled()}async onReady(){O.A.getValue("automaticDecryptionErrorReporting")&&this.matrixClient&&(this.matrixClient.on(s.MatrixEventEvent.Decrypted,this.onDecryptionAttempt),this.matrixClient.on(s.ClientEvent.ToDeviceEvent,this.onDeviceMessage),this.matrixClient.on(s.ClientEvent.Sync,this.onSyncStateChange))}async onNotReady(){this.matrixClient&&(this.matrixClient.removeListener(s.ClientEvent.ToDeviceEvent,this.onDeviceMessage),this.matrixClient.removeListener(s.MatrixEventEvent.Decrypted,this.onDecryptionAttempt),this.matrixClient.removeListener(s.ClientEvent.Sync,this.onSyncStateChange))}async onDecryptionAttempt(e){if(!this.state.initialSyncCompleted)return;const t=e.getWireContent(),n=t.session_id;if(e.isDecryptionFailure()&&!this.state.reportedSessionIds.has(n)){var i;if(await(0,a.yy)(5e3),!e.isDecryptionFailure())return;const r=new Set(this.state.reportedSessionIds);await this.updateState({reportedSessionIds:r.add(n)});const o=(new Date).getTime();if(o-this.state.lastRageshakeTime<6e4)return void l.v.info(`Not sending recipient-side autorageshake for event ${e.getId()}/session ${n}: last rageshake was too recent`);await this.updateState({lastRageshakeTime:o});const c=e.getSender(),d={event_id:e.getId(),room_id:e.getRoomId(),session_id:n,device_id:t.device_id,user_id:c,sender_key:t.sender_key};l.v.info(`Sending recipient-side autorageshake for event ${e.getId()}/session ${n}`);const u=await(0,D.Ay)(g.Ay.get().bug_report_endpoint_url,{userText:"Auto-reporting decryption error (recipient)",sendLogs:!0,labels:["Z-UISI","web","uisi-recipient"],customApp:g.Ay.get().uisi_autorageshake_app,customFields:{auto_uisi:JSON.stringify(d)}}),m=U(U({},d),{},{recipient_rageshake:u,[s.ToDeviceMessageId]:(0,N.A)()});null===(i=this.matrixClient)||void 0===i||i.sendToDevice(F,new Map([[c,new Map([[m.device_id,m]])]]))}}async onSyncStateChange(e,t,n){this.state.initialSyncCompleted||await this.updateState({initialSyncCompleted:!(null==n||!n.nextSyncToken)})}async onDeviceMessage(e){if(e.getType()!==F)return;const t=e.getContent(),n=t.recipient_rageshake||"",i=(new Date).getTime();i-this.state.lastRageshakeTime>6e4?(await this.updateState({lastRageshakeTime:i}),l.v.info(`Sending sender-side autorageshake for event ${t.event_id}/session ${t.session_id}`),await(0,D.Ay)(g.Ay.get().bug_report_endpoint_url,{userText:`Auto-reporting decryption error (sender)\nRecipient rageshake: ${n}`,sendLogs:!0,labels:["Z-UISI","web","uisi-sender"],customApp:g.Ay.get().uisi_autorageshake_app,customFields:{recipient_rageshake:n,auto_uisi:JSON.stringify(t)}})):l.v.info(`Not sending sender-side autorageshake for event ${t.event_id}/session ${t.session_id}: last rageshake was too recent`)}async onReportKeyBackupNotEnabled(){O.A.getValue("automaticKeyBackNotEnabledReporting")&&await(0,D.Ay)(g.Ay.get().bug_report_endpoint_url,{userText:"Auto-reporting key backup not enabled",sendLogs:!0,labels:["web",x.r.ReportKeyBackupNotEnabled]})}}P=j,(0,r.A)(j,"internalInstance",(()=>{const e=new P;return e.start(),e})()),window.mxAutoRageshakeStore=j.instance;var B=n("./node_modules/matrix-react-sdk/src/PageTypes.ts"),V=n("./node_modules/matrix-react-sdk/src/createRoom.ts"),H=n("./node_modules/matrix-react-sdk/src/settings/controllers/ThemeController.ts"),z=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/QuestionDialog.tsx"),W=n("./node_modules/matrix-react-sdk/src/settings/UIFeature.ts");const G=/^[a-z0-9=_\-./]+$/;var K=n("./node_modules/events/events.js");class J extends K.EventEmitter{constructor(...e){super(...e),(0,r.A)(this,"_isResizing",!1),(0,r.A)(this,"throttledMiddlePanel",(0,c.throttle)((()=>this.emit("middlePanelResized")),200))}get isResizing(){return this._isResizing}startResizing(){this._isResizing=!0,this.emit("isResizing",!0)}stopResizing(){this._isResizing=!1,this.emit("isResizing",!1)}noisyMiddlePanel(){this.emit("middlePanelResizedNoisy")}updateMiddlePanel(){this.throttledMiddlePanel(),this.noisyMiddlePanel()}notifyLeftHandleResized(){this.updateMiddlePanel()}notifyRightHandleResized(){this.updateMiddlePanel()}notifyTimelineHeightChanged(){this.updateMiddlePanel()}notifyWindowResized(){this.updateMiddlePanel()}}var q=n("./node_modules/matrix-react-sdk/src/utils/AutoDiscoveryUtils.tsx"),$=n("./node_modules/matrix-react-sdk/src/settings/watchers/ThemeWatcher.ts"),Y=n("./node_modules/matrix-react-sdk/src/settings/watchers/FontWatcher.ts"),Q=n("./node_modules/matrix-react-sdk/src/RoomAliasCache.ts"),Z=n("./node_modules/matrix-react-sdk/src/utils/StorageManager.ts"),X=n("./node_modules/classnames/index.js"),ee=n.n(X),te=n("./node_modules/matrix-react-sdk/src/Keyboard.ts"),ne=n("./node_modules/matrix-react-sdk/src/MediaDeviceHandler.ts"),ie=n("./node_modules/matrix-react-sdk/src/utils/FontManager.ts"),re=n("./node_modules/matrix-react-sdk/src/settings/SettingLevel.ts");const oe=({vertical:e,reverse:t,id:n,passRef:i})=>{const r=["mx_ResizeHandle"];return e?r.push("mx_ResizeHandle--vertical"):r.push("mx_ResizeHandle--horizontal"),t&&r.push("mx_ResizeHandle_reverse"),o.createElement("div",{ref:i,className:r.join(" "),"data-id":n},o.createElement("div",null))};class se{constructor(e,t,n,i){(0,r.A)(this,"domNode",void 0),(0,r.A)(this,"id",void 0),(0,r.A)(this,"reverse",void 0),this.resizer=t,this.sizer=n,this.container=i,this.reverse=t.isReverseResizeHandle(e),this.domNode=i||(this.reverse?e.nextElementSibling:e.previousElementSibling),this.id=e.getAttribute("data-id")}copyWith(e,t,n,i){return new(0,this.constructor)(e,t,n,i)}advance(e){let t=this.reverse?this.domNode.previousElementSibling:this.domNode.nextElementSibling;const n=e!==this.reverse;do{var i,r;if(n)t=null===(i=t)||void 0===i?void 0:i.nextElementSibling;else t=null===(r=t)||void 0===r?void 0:r.previousElementSibling}while(t&&!this.resizer.isResizeHandle(t));if(t){const e=this.copyWith(t,this.resizer,this.sizer);return e.reverse=this.reverse,e}}next(){return this.advance(!0)}previous(){return this.advance(!1)}size(){return this.sizer.getItemSize(this.domNode)}offset(){return this.sizer.getItemOffset(this.domNode)}start(){this.sizer.start(this.domNode)}finish(){this.sizer.finish(this.domNode)}getSize(){return this.sizer.getDesiredItemSize(this.domNode)}setRawSize(e){this.sizer.setItemSize(this.domNode,e)}setSize(e){var t,n;this.setRawSize(`${Math.round(e)}px`),null===(t=this.resizer.config)||void 0===t||null===(n=t.onResized)||void 0===n||n.call(t,e,this.id,this.domNode)}clearSize(){var e,t;this.sizer.clearItemSize(this.domNode),null===(e=this.resizer.config)||void 0===e||null===(t=e.onResized)||void 0===t||t.call(e,null,this.id,this.domNode)}first(){var e;if(null===(e=this.domNode.parentElement)||void 0===e||!e.children)return;const t=Array.from(this.domNode.parentElement.children).find((e=>this.resizer.isResizeHandle(e)));return t?this.copyWith(t,this.resizer,this.sizer):void 0}last(){var e;if(null===(e=this.domNode.parentElement)||void 0===e||!e.children)return;const t=Array.from(this.domNode.parentElement.children).reverse().find((e=>this.resizer.isResizeHandle(e)));return t?this.copyWith(t,this.resizer,this.sizer):void 0}}class ae{constructor(e,t,n){this.container=e,this.vertical=t,this.reverse=n}getItemOffset(e){const t=(this.vertical?e.offsetTop:e.offsetLeft)-this.getOffset();return this.reverse?this.getTotalSize()-(t+this.getItemSize(e)):t}getItemSize(e){return this.vertical?e.offsetHeight:e.offsetWidth}getTotalSize(){return this.vertical?this.container.offsetHeight:this.container.offsetWidth}getOffset(){return this.vertical?this.container.offsetTop:this.container.offsetLeft}getPageOffset(){let e=this.container,t=0;for(;e;){t+=this.vertical?e.offsetTop:e.offsetLeft,e=e.offsetParent}return t}getDesiredItemSize(e){return this.vertical?e.style.height:e.style.width}setItemSize(e,t){this.vertical?e.style.height=t:e.style.width=t}clearItemSize(e){this.vertical?e.style.removeProperty("height"):e.style.removeProperty("width")}start(e){}finish(e){}offsetFromEvent(e){const t=this.vertical?e.pageY:e.pageX;return this.reverse?this.getPageOffset()+this.getTotalSize()-t:t-this.getPageOffset()}}class le{static createSizer(e,t,n){return new ae(e,t,n)}constructor(e){(0,r.A)(this,"beforeOffset",void 0),this.item=e,this.beforeOffset=e.offset()}get size(){return this.item.getSize()}set size(e){this.item.setRawSize(e)}resize(e){this.item.setSize(e)}resizeFromContainerOffset(e){this.resize(e-this.beforeOffset)}start(){this.item.start()}finish(){this.item.finish()}}class ce extends le{static createItem(e,t,n){return new se(e,t,n)}}class de extends se{notifyCollapsed(e){var t,n;null===(t=this.resizer.config)||void 0===t||null===(n=t.onCollapsed)||void 0===n||n.call(t,e,this.id,this.domNode)}get isCollapsed(){var e,t,n;return null!==(e=null===(t=this.resizer.config)||void 0===t||null===(n=t.isItemCollapsed)||void 0===n?void 0:n.call(t,this.domNode))&&void 0!==e&&e}}class ue extends le{static createItem(e,t,n,i){return new de(e,t,n,i)}constructor(e){var t;super(e),(0,r.A)(this,"toggleSize",void 0),(0,r.A)(this,"isCollapsed",void 0),this.toggleSize=null===(t=e.resizer)||void 0===t||null===(t=t.config)||void 0===t?void 0:t.toggleSize,this.isCollapsed=e.isCollapsed}resize(e){const t=!!this.toggleSize&&e<this.toggleSize;t!==this.isCollapsed&&(this.isCollapsed=t,this.item.notifyCollapsed(t)),t||super.resize(e)}}class me{constructor(e,t,n){(0,r.A)(this,"classNames",void 0),(0,r.A)(this,"onMouseDown",(e=>{var t,n,i;if(0!==e.button)return;const r=e.target&&e.target.closest(`.${this.classNames.handle}`),o=null==this||null===(t=this.config)||void 0===t?void 0:t.handler;if(!r||!o&&r.parentElement!==this.container||o&&r!==o)return;var s;(e.preventDefault(),this.classNames.resizing)&&(null===(s=this.container)||void 0===s||null===(s=s.classList)||void 0===s||s.add(this.classNames.resizing));null===(n=this.config)||void 0===n||null===(i=n.onResizeStart)||void 0===i||i.call(n);const{sizer:a,distributor:l}=this.createSizerAndDistributor(r);l.start();const c=e=>{const t=a.offsetFromEvent(e);l.resizeFromContainerOffset(t)},d=document.body,u=()=>{var e,t,n;this.classNames.resizing&&(null===(n=this.container)||void 0===n||null===(n=n.classList)||void 0===n||n.remove(this.classNames.resizing));l.finish(),null===(e=this.config)||void 0===e||null===(t=e.onResizeStop)||void 0===t||t.call(e),d.removeEventListener("mouseup",u,!1),document.removeEventListener("mouseleave",u,!1),d.removeEventListener("mousemove",c,!1)};d.addEventListener("mouseup",u,!1),document.addEventListener("mouseleave",u,!1),d.addEventListener("mousemove",c,!1)})),(0,r.A)(this,"onResize",(0,c.throttle)((()=>{const e=this.getDistributors();e.forEach((e=>e.start())),e.forEach((e=>e.finish()))}),100,{trailing:!0,leading:!0})),(0,r.A)(this,"getDistributors",(()=>this.getResizeHandles().map((e=>{const{distributor:t}=this.createSizerAndDistributor(e);return t})))),this.container=e,this.distributorCtor=t,this.config=n,this.classNames={handle:"resizer-handle",reverse:"resizer-reverse",vertical:"resizer-vertical",resizing:"resizer-resizing"}}setClassNames(e){this.classNames=e}attach(){var e,t;const n=null!==(e=null==this||null===(t=this.config)||void 0===t||null===(t=t.handler)||void 0===t?void 0:t.parentElement)&&void 0!==e?e:this.container;null==n||n.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("resize",this.onResize)}detach(){var e,t;const n=null!==(e=null==this||null===(t=this.config)||void 0===t||null===(t=t.handler)||void 0===t?void 0:t.parentElement)&&void 0!==e?e:this.container;null==n||n.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("resize",this.onResize)}forHandleAt(e){const t=this.getResizeHandles()[e];if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}forHandleWithId(e){const t=this.getResizeHandles().find((t=>t.getAttribute("data-id")===e));if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}isReverseResizeHandle(e){return e.classList.contains(this.classNames.reverse)}isResizeHandle(e){return e.classList.contains(this.classNames.handle)}createSizerAndDistributor(e){var t;const n=e.classList.contains(this.classNames.vertical),i=this.isReverseResizeHandle(e),r=this.distributorCtor,o=null!==(t=this.config)&&void 0!==t&&t.handler?this.container:void 0,s=r.createSizer(this.container,n,i),a=r.createItem(e,this,s,null!=o?o:void 0);return{sizer:s,distributor:new r(a)}}getResizeHandles(){var e,t;return null!=this&&null!==(e=this.config)&&void 0!==e&&e.handler?[this.config.handler]:null!==(t=this.container)&&void 0!==t&&t.children?Array.from(this.container.querySelectorAll(`.${this.classNames.handle}`)):[]}}var he=n("./node_modules/matrix-react-sdk/src/stores/room-list/models.ts"),pe=n("./node_modules/matrix-react-sdk/src/utils/ErrorUtils.tsx");const ge="serverlimit",ve=()=>{S.A.sharedInstance().dismissToast(ge)};var _e=n("./node_modules/matrix-react-sdk/src/components/views/rooms/RoomList.tsx"),fe=n("./node_modules/matrix-react-sdk/src/LegacyCallHandler.tsx"),ye=n("./node_modules/matrix-react-sdk/src/components/views/rooms/RoomSublist.tsx"),Ee=n("./node_modules/matrix-react-sdk/src/accessibility/KeyboardShortcuts.ts"),be=n("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx");class we extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"onAction",(e=>{"focus_room_filter"===e.action&&this.openSpotlight()})),this.dispatcherRef=v.Ay.register(this.onAction)}componentWillUnmount(){v.Ay.unregister(this.dispatcherRef)}openSpotlight(){v.Ay.fire(x.r.OpenSpotlight)}render(){const e=ee()({mx_RoomSearch:!0,mx_RoomSearch_minimized:this.props.isMinimized},"mx_RoomSearch_spotlightTrigger"),t=o.createElement("div",{className:"mx_RoomSearch_icon"}),n=o.createElement("kbd",{className:"mx_RoomSearch_shortcutPrompt"},te.vL?"⌘ K":(0,C._t)(Ee.hm[te.Uz.CONTROL])+" K");return o.createElement(be.A,{onClick:this.openSpotlight,className:e},t,!this.props.isMinimized&&o.createElement("div",{className:"mx_RoomSearch_spotlightTriggerText"},(0,C._t)("action|search")),n)}}var xe=n("./node_modules/matrix-react-sdk/src/stores/spaces/SpaceStore.ts"),Ae=n("./node_modules/matrix-react-sdk/src/stores/spaces/index.ts"),Se=n("./node_modules/matrix-react-sdk/src/KeyBindingsManager.ts"),Ce=n("./node_modules/matrix-react-sdk/src/stores/UIStore.ts"),ke=n("./node_modules/@vector-im/compound-web/dist/compound-web.js"),Re=n("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),Ie=n("./node_modules/matrix-react-sdk/src/customisations/helpers/UIComponents.ts"),Te=n("./node_modules/matrix-react-sdk/src/hooks/useDispatcher.ts"),Pe=n("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts"),Ne=n("./node_modules/matrix-react-sdk/src/hooks/useSettings.ts"),De=n("./node_modules/matrix-react-sdk/src/utils/space.tsx"),Me=n("./node_modules/matrix-react-sdk/src/components/structures/ContextMenu.tsx"),Oe=n("./node_modules/matrix-react-sdk/src/components/views/beta/BetaCard.tsx"),Le=n("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx"),Ue=n("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),Fe=n("./node_modules/matrix-react-sdk/src/utils/leave-behaviour.ts");const je=["space","hideHeader","onFinished"],Be=e=>{let{space:t,hideHeader:n,onFinished:r}=e,a=(0,Ue.A)(e,je);const l=(0,o.useContext)(Re.Ay).getSafeUserId(),c=(0,Ne.ny)("feature_video_rooms"),d=(0,Ne.ny)("feature_element_call_video_rooms");if(!t)return null;let m=null;if("public"===t.getJoinRule()||t.canInvite(l)){const e=e=>{e.preventDefault(),e.stopPropagation(),(0,De.Lo)(t),r()};m=o.createElement(Le.R$,{className:"mx_SpacePanel_contextMenu_inviteButton",iconClassName:"mx_SpacePanel_iconInvite",label:(0,C._t)("action|invite"),onClick:e})}let h=null,p=null;if((0,De.Kv)(t)){const e=e=>{e.preventDefault(),e.stopPropagation(),(0,De.hL)(t),r()};h=o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconSettings",label:(0,C._t)("common|settings"),onClick:e})}else{const e=e=>{e.preventDefault(),e.stopPropagation(),(0,Fe.e)(t),r()};p=o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconLeave",className:"mx_IconizedContextMenu_option_red",label:(0,C._t)("space|leave_dialog_action"),onClick:e})}let g=null;if(O.A.getValue("developerMode")){const e=e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:x.r.ViewRoom,room_id:t.roomId,forceTimeline:!0,metricsTrigger:void 0}),r()};g=o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconSettings",label:(0,C._t)("space|context_menu|devtools_open_timeline"),onClick:e})}const _=t.currentState.maySendStateEvent(s.EventType.SpaceChild,l),f=_&&(0,Ie.g)(W.C.CreateRooms),y=f&&c,E=_&&(0,Ie.g)(W.C.CreateSpaces);let b=null;if(f||E){const e=e=>{e.preventDefault(),e.stopPropagation(),u.A.trackInteraction("WebSpaceContextMenuNewRoomItem",e),(0,De.PT)(t),r()},n=e=>{e.preventDefault(),e.stopPropagation(),(0,De.PT)(t,d?s.RoomType.UnstableCall:s.RoomType.ElementVideo),r()},i=e=>{e.preventDefault(),e.stopPropagation(),(0,De.Sl)(t),r()};b=o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_SpacePanel_contextMenu_separatorLabel"},(0,C._t)("action|add")),f&&o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconPlus",label:(0,C._t)("common|room"),onClick:e}),y&&o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconPlus",label:(0,C._t)("common|video_room"),onClick:n},o.createElement(Oe.s,null)),E&&o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconPlus",label:(0,C._t)("common|space"),onClick:i},o.createElement(Oe.s,null)))}const w=e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:x.r.ViewRoom,room_id:t.roomId,metricsTrigger:void 0}),r()};return o.createElement(Le.Ay,(0,i.A)({},a,{onFinished:r,className:"mx_SpacePanel_contextMenu",compact:!0}),!n&&o.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},t.name),o.createElement(Le.tx,{first:!0},o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconHome",label:(0,C._t)("space|context_menu|home"),onClick:e=>{u.A.trackInteraction("WebSpaceContextMenuHomeItem",e),w(e)}}),m,o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconExplore",label:f?(0,C._t)("space|context_menu|manage_and_explore"):(0,C._t)("space|context_menu|explore"),onClick:e=>{u.A.trackInteraction("WebSpaceContextMenuExploreRoomsItem",e),w(e)}}),o.createElement(Le.R$,{iconClassName:"mx_SpacePanel_iconPreferences",label:(0,C._t)("common|preferences"),onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,De.Wi)(t),r()}}),g,h,p,b))};var Ve=n("./node_modules/matrix-react-sdk/src/components/views/elements/InlineSpinner.tsx"),He=n("./node_modules/react-beautiful-dnd/dist/react-beautiful-dnd.cjs.js"),ze=n("./node_modules/matrix-react-sdk/src/components/views/spaces/SpaceCreateMenu.tsx"),We=n("./node_modules/matrix-js-sdk/src/types.ts"),Ge=n("./node_modules/matrix-react-sdk/src/components/views/avatars/RoomAvatar.tsx");const Ke=(e,t)=>{let n="";if(t)for(const e of t.entries())n+=e+"/";return`mx_space_collapsed_${n+e}`};class Je{static get instance(){return Je.internalInstance||(Je.internalInstance=new Je),Je.internalInstance}setSpaceCollapsedState(e,t,n){localStorage.setItem(Ke(e,t),n.toString())}getSpaceCollapsedState(e,t,n){const i=localStorage.getItem(Ke(e,t));return i?"true"===i:n}}(0,r.A)(Je,"internalInstance",void 0);var qe=n("./node_modules/matrix-react-sdk/src/components/views/rooms/NotificationBadge.tsx"),$e=n("./node_modules/matrix-react-sdk/src/accessibility/context_menu/ContextMenuTooltipButton.tsx"),Ye=n("./node_modules/matrix-react-sdk/src/stores/notifications/StaticNotificationState.ts"),Qe=n("./node_modules/matrix-react-sdk/src/stores/notifications/NotificationLevel.ts"),Ze=n("./node_modules/matrix-react-sdk/src/accessibility/RovingTabIndex.tsx");const Xe=["space","spaceKey","className","selected","label","contextMenuTooltip","notificationState","size","isNarrow","children","innerRef","ContextMenuComponent"],et=["space","activeSpaces","isNested","isPanelCollapsed","onExpand","parents","innerRef","dragHandleProps"],tt=["tabIndex"],nt=e=>{var t;let{space:n,spaceKey:r,className:s,selected:a,label:l,contextMenuTooltip:c,notificationState:d,size:u,isNarrow:m,children:h,innerRef:p,ContextMenuComponent:g}=e,_=(0,Ue.A)(e,Xe);const[f,y,E,b]=(0,Me.EF)(p),[w,A]=(0,Ze.A9)(y),S=A?0:-1,k=null!=r?r:null==n?void 0:n.roomId;let R,I,T=o.createElement("div",{className:"mx_SpaceButton_avatarPlaceholder"},o.createElement("div",{className:"mx_SpaceButton_icon"}));if(n&&(T=o.createElement(Ge.A,{size:u,room:n,type:"square"})),k&&d){let e=(0,C._t)("a11y_jump_first_unread_room");(null==n?void 0:n.getMyMembership())===We.O.Invite&&(e=(0,C._t)("a11y|jump_first_invite"));const t=e=>{e.stopPropagation(),e.preventDefault(),xe.Ay.instance.setActiveRoomInSpace(k)};R=o.createElement("div",{className:"mx_SpacePanel_badgeContainer"},o.createElement(qe.A,{onClick:t,notification:d,"aria-label":e,tabIndex:S,showUnsentTooltip:!0}))}f&&y.current&&g&&(I=o.createElement(g,(0,i.A)({},(0,Me.Dq)(y.current.getBoundingClientRect(),0),{space:n,onFinished:b})));const P=null!==(t=_.onClick)&&void 0!==t?t:a&&n?()=>v.Ay.dispatch({action:x.r.ViewRoom,room_id:n.roomId}):()=>{k&&xe.Ay.instance.setActiveSpace(k)};return o.createElement(be.A,(0,i.A)({},_,{className:ee()("mx_SpaceButton",s,{mx_SpaceButton_active:a,mx_SpaceButton_hasMenuOpen:f,mx_SpaceButton_narrow:m}),"aria-label":l,title:!m||f?void 0:l,onClick:P,onContextMenu:E,ref:y,tabIndex:S,onFocus:w}),h,o.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},o.createElement("div",{className:"mx_SpaceButton_avatarWrapper"},T,R),!m&&o.createElement("span",{className:"mx_SpaceButton_name"},l),g&&o.createElement($e.o,{className:"mx_SpaceButton_menuButton",onClick:E,title:c,isExpanded:f}),I))};class it extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"buttonRef",(0,o.createRef)()),(0,r.A)(this,"onSpaceUpdate",(()=>{this.setState({childSpaces:this.childSpaces})})),(0,r.A)(this,"onRoomNameChange",(()=>{this.setState({name:this.props.space.name})})),(0,r.A)(this,"toggleCollapse",(e=>{this.props.onExpand&&this.isCollapsed&&this.props.onExpand();const t=!this.isCollapsed;Je.instance.setSpaceCollapsedState(this.props.space.roomId,this.props.parents,t),this.setState({collapsed:t}),e.stopPropagation()})),(0,r.A)(this,"onKeyDown",(e=>{var t;let n=!0;const i=(0,Se.zM)().getRoomListAction(e),r=null===(t=this.state.childSpaces)||void 0===t?void 0:t.length;switch(i){case Ee.bY.CollapseRoomListSection:if(r&&!this.isCollapsed)this.toggleCollapse(e);else{var o;const e=null===(o=this.buttonRef)||void 0===o||null===(o=o.current)||void 0===o||null===(o=o.parentElement)||void 0===o?void 0:o.parentElement,t=null==e?void 0:e.previousElementSibling;null==t||t.focus()}break;case Ee.bY.ExpandRoomListSection:if(r)if(this.isCollapsed)this.toggleCollapse(e);else{var s,a;const e=null===(s=this.buttonRef)||void 0===s||null===(s=s.current)||void 0===s?void 0:s.nextElementSibling,t=null==e?void 0:e.querySelector(".mx_SpaceItem");null==t||null===(a=t.querySelector(".mx_SpaceButton"))||void 0===a||a.focus()}break;default:n=!1}n&&(e.stopPropagation(),e.preventDefault())}));const t=Je.instance.getSpaceCollapsedState(e.space.roomId,this.props.parents,!e.isNested);this.state={name:this.props.space.name,collapsed:t,childSpaces:this.childSpaces},xe.Ay.instance.on(this.props.space.roomId,this.onSpaceUpdate),this.props.space.on(s.RoomEvent.Name,this.onRoomNameChange)}componentWillUnmount(){xe.Ay.instance.off(this.props.space.roomId,this.onSpaceUpdate),this.props.space.off(s.RoomEvent.Name,this.onRoomNameChange)}get childSpaces(){return xe.Ay.instance.getChildSpaces(this.props.space.roomId).filter((e=>{var t;return!(null!==(t=this.props.parents)&&void 0!==t&&t.has(e.roomId))}))}get isCollapsed(){return this.state.collapsed||!!this.props.isPanelCollapsed}render(){var e,t;const n=this.props,{space:r,activeSpaces:s,isNested:a,isPanelCollapsed:l,onExpand:c,parents:d,innerRef:u,dragHandleProps:m}=n,h=(0,Ue.A)(n,et),p=this.isCollapsed,g=ee()(this.props.className,{mx_SpaceItem:!0,mx_SpaceItem_narrow:l,collapsed:p,hasSubSpaces:null===(e=this.state.childSpaces)||void 0===e?void 0:e.length}),v=r.getMyMembership()===We.O.Invite,_=v?Ye.d.forSymbol("!",Qe.S.Highlight):xe.Ay.instance.getNotificationState(r.roomId),f=null===(t=this.state.childSpaces)||void 0===t?void 0:t.length;let y;f&&!p&&(y=o.createElement(rt,{spaces:this.state.childSpaces,activeSpaces:s,isNested:!0,parents:new Set(d).add(r.roomId)}));const E=f?o.createElement(be.A,{className:"mx_SpaceButton_toggleCollapse",onClick:this.toggleCollapse,tabIndex:-1,"aria-label":p?(0,C._t)("action|expand"):(0,C._t)("action|collapse")}):null,b=m||{},{tabIndex:w}=b,x=(0,Ue.A)(b,tt),A=s.includes(r.roomId);return o.createElement("li",(0,i.A)({},h,{className:g,ref:u,"aria-expanded":f?!p:void 0,"aria-selected":A,role:"treeitem"}),o.createElement(nt,(0,i.A)({},x,{space:r,className:v?"mx_SpaceButton_invite":void 0,selected:A,label:this.state.name,contextMenuTooltip:(0,C._t)("space|context_menu|options"),notificationState:_,isNarrow:l,size:a?"24px":"32px",onKeyDown:this.onKeyDown,ContextMenuComponent:this.props.space.getMyMembership()===We.O.Join?Be:void 0}),E),y)}}const rt=({spaces:e,activeSpaces:t,isNested:n,parents:i})=>o.createElement("ul",{className:"mx_SpaceTreeLevel",role:"group"},e.map((e=>o.createElement(it,{key:e.roomId,activeSpaces:t,space:e,isNested:n,parents:i}))));var ot,st=n("./node_modules/matrix-react-sdk/src/stores/notifications/RoomNotificationStateStore.ts"),at=n("./node_modules/matrix-react-sdk/src/components/views/elements/StyledCheckbox.tsx"),lt=n("./node_modules/@vector-im/compound-design-tokens/icons/video-call-solid.svg");function ct(){return ct=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ct.apply(null,arguments)}var dt=function(e,t){return o.createElement("svg",ct({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),ot||(ot=o.createElement("path",{fill:"currentColor",d:"m20.28 7.9-7-5.833a2 2 0 0 0-2.56 0l-7 5.833A2 2 0 0 0 3 9.437V20.5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V16a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v4.5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V9.437a2 2 0 0 0-.72-1.537"})))},ut=(0,o.forwardRef)(dt);var mt;function ht(){return ht=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ht.apply(null,arguments)}var pt=function(e,t){return o.createElement("svg",ht({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),mt||(mt=o.createElement("path",{fill:"currentColor",d:"M8.414 1.432c.178-.576.994-.576 1.172 0l1.585 5.131h5.215c.586 0 .838.745.372 1.1l-4.244 3.243 1.604 5.194c.177.57-.483 1.03-.958.668L9 13.59l-4.16 3.178c-.475.363-1.135-.098-.959-.668l1.606-5.194-4.245-3.242c-.466-.356-.214-1.1.372-1.1H6.83z"})))},gt=(0,o.forwardRef)(pt);var vt,_t,ft;function yt(){return yt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},yt.apply(null,arguments)}var Et=function(e,t){return o.createElement("svg",yt({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),vt||(vt=o.createElement("mask",{id:"members_svg__a",fill:"#fff"},o.createElement("path",{fillRule:"evenodd",d:"M17.591 20.292A9.95 9.95 0 0 1 12 22a9.96 9.96 0 0 1-6-2 9.99 9.99 0 0 1-4-8C2 6.477 6.477 2 12 2s10 4.477 10 10a9.99 9.99 0 0 1-4.409 8.292M12 12.5c1.657 0 3-1.455 3-3.25S13.657 6 12 6 9 7.455 9 9.25s1.343 3.25 3 3.25m0 7.5a7.97 7.97 0 0 0 5.563-2.251 6.002 6.002 0 0 0-11.126 0A7.97 7.97 0 0 0 12 20",clipRule:"evenodd"}))),_t||(_t=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M17.591 20.292A9.95 9.95 0 0 1 12 22a9.96 9.96 0 0 1-6-2 9.99 9.99 0 0 1-4-8C2 6.477 6.477 2 12 2s10 4.477 10 10a9.99 9.99 0 0 1-4.409 8.292M12 12.5c1.657 0 3-1.455 3-3.25S13.657 6 12 6 9 7.455 9 9.25s1.343 3.25 3 3.25m0 7.5a7.97 7.97 0 0 0 5.563-2.251 6.002 6.002 0 0 0-11.126 0A7.97 7.97 0 0 0 12 20",clipRule:"evenodd"})),ft||(ft=o.createElement("path",{fill:"currentColor",d:"m17.591 20.292-1.12-1.657zM6 20.001 4.799 21.6zm11.563-2.252 1.391 1.437.97-.938-.507-1.25zm-11.126 0-1.854-.751-.506 1.25.969.938zM12 24c2.483 0 4.794-.756 6.71-2.05l-2.239-3.315A7.95 7.95 0 0 1 12 20zm-7.201-2.4A11.96 11.96 0 0 0 12 24v-4a7.96 7.96 0 0 1-4.799-1.598zM0 12c0 3.927 1.889 7.414 4.799 9.6L7.2 18.402A7.99 7.99 0 0 1 4 12zM12 0C5.373 0 0 5.373 0 12h4a8 8 0 0 1 8-8zm12 12c0-6.627-5.373-12-12-12v4a8 8 0 0 1 8 8zm-5.29 9.95A11.99 11.99 0 0 0 24 12h-4a7.99 7.99 0 0 1-3.529 6.635zM13 9.25c0 .844-.595 1.25-1 1.25v4c2.91 0 5-2.504 5-5.25zM12 8c.405 0 1 .406 1 1.25h4C17 6.504 14.91 4 12 4zm-1 1.25c0-.844.595-1.25 1-1.25V4C9.09 4 7 6.504 7 9.25zm1 1.25c-.405 0-1-.406-1-1.25H7c0 2.746 2.09 5.25 5 5.25zm4.172 5.812A5.97 5.97 0 0 1 12 18v4a9.97 9.97 0 0 0 6.954-2.814zM12 16a4 4 0 0 1 3.71 2.5l3.707-1.502A8 8 0 0 0 12 12zm-3.71 2.5A4 4 0 0 1 12 16v-4a8 8 0 0 0-7.417 4.998zM12 18a5.97 5.97 0 0 1-4.172-1.688l-2.782 2.874A9.97 9.97 0 0 0 12 22z",mask:"url(#members_svg__a)"})))},bt=(0,o.forwardRef)(Et);var wt,xt,At;function St(){return St=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},St.apply(null,arguments)}var Ct=function(e,t){return o.createElement("svg",St({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),wt||(wt=o.createElement("mask",{id:"hash-circle_svg__a",fill:"#fff"},o.createElement("path",{fillRule:"evenodd",d:"M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16M8.34 5.156A.75.75 0 0 0 6.848 5l-.16 1.531H5.656a.75.75 0 0 0 0 1.5h.875L6.328 9.97h-.937a.75.75 0 0 0 0 1.5h.78l-.151 1.453a.75.75 0 1 0 1.492.156l.168-1.61H9.5l-.152 1.454a.75.75 0 1 0 1.492.156l.168-1.61h1.289a.75.75 0 0 0 0-1.5h-1.132l.202-1.937h.93a.75.75 0 0 0 0-1.5h-.773l.144-1.375A.75.75 0 1 0 10.176 5l-.16 1.531h-1.82zM9.657 9.97h-1.82l.202-1.938h1.82z",clipRule:"evenodd"}))),xt||(xt=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16M8.34 5.156A.75.75 0 0 0 6.848 5l-.16 1.531H5.656a.75.75 0 0 0 0 1.5h.875L6.328 9.97h-.937a.75.75 0 0 0 0 1.5h.78l-.151 1.453a.75.75 0 1 0 1.492.156l.168-1.61H9.5l-.152 1.454a.75.75 0 1 0 1.492.156l.168-1.61h1.289a.75.75 0 0 0 0-1.5h-1.132l.202-1.937h.93a.75.75 0 0 0 0-1.5h-.773l.144-1.375A.75.75 0 1 0 10.176 5l-.16 1.531h-1.82zM9.657 9.97h-1.82l.202-1.938h1.82z",clipRule:"evenodd"})),At||(At=o.createElement("path",{fill:"currentColor",d:"m7.672 4.332-.139 1.326zm.668.824 1.326.139zM6.848 5l-1.326-.138zm-.16 1.531v1.334h1.201l.125-1.195zm-.157 1.5 1.326.139.154-1.472H6.53zM6.328 9.97v1.333H7.53l.125-1.195zm-.156 1.5 1.326.138.154-1.471h-1.48zm-.152 1.453-1.326-.139zm.668.824.138-1.326zm.824-.668 1.326.139zm.168-1.61v-1.332H6.479l-.125 1.194zm1.82 0 1.326.14.154-1.473H9.5zm-.152 1.454 1.326.139zm.668.824.138-1.326zm.824-.668 1.326.139zm.168-1.61v-1.332H9.807l-.125 1.194zm.157-1.5L9.839 9.83l-.154 1.472h1.48zm.202-1.937V6.698h-1.201l-.125 1.195zm.157-1.5-1.326-.138-.154 1.472h1.48zm.144-1.375-1.326-.138zM11 4.332l.139-1.326zM10.176 5 8.85 4.862zm-.16 1.531v1.334h1.201l.125-1.195zm-1.82 0L6.87 6.393l-.154 1.472h1.48zm-.36 3.438L6.51 9.83l-.153 1.472h1.48zm1.82 0v1.333h1.202l.125-1.195zM8.04 8.03V6.698H6.838l-.125 1.195zm1.82 0 1.326.139.154-1.472H9.86zM15.667 9A6.667 6.667 0 0 1 9 15.667v2.666A9.333 9.333 0 0 0 18.333 9zM9 2.333A6.667 6.667 0 0 1 15.667 9h2.666A9.333 9.333 0 0 0 9-.333zM2.333 9A6.667 6.667 0 0 1 9 2.333V-.333A9.333 9.333 0 0 0-.333 9zM9 15.667A6.667 6.667 0 0 1 2.333 9H-.333A9.333 9.333 0 0 0 9 18.333zM7.533 5.658a.583.583 0 0 1-.52-.64l2.653.277A2.083 2.083 0 0 0 7.81 3.006zm.64-.52a.583.583 0 0 1-.64.52l.277-2.652a2.083 2.083 0 0 0-2.288 1.856zm-.16 1.532.16-1.531-2.651-.277-.16 1.53zM5.657 7.865h1.032V5.198H5.656zm.584-.584a.583.583 0 0 1-.584.584V5.198c-1.15 0-2.083.933-2.083 2.083zm-.584-.583c.322 0 .584.261.584.583H3.573c0 1.15.933 2.084 2.083 2.084zm.875 0h-.875v2.667h.875zm1.124 3.41.202-1.938-2.652-.277-.203 1.937zM5.39 11.301h.937V8.635h-.937zm.583-.583a.583.583 0 0 1-.583.583V8.635c-1.151 0-2.084.933-2.084 2.084zm-.583-.583c.322 0 .583.26.583.583H3.307c0 1.15.933 2.083 2.084 2.083zm.78 0h-.78v2.666h.78zm1.175 2.925.152-1.454-2.652-.277-.152 1.454zm-.52-.641c.32.033.553.32.52.64l-2.652-.277a2.083 2.083 0 0 0 1.855 2.29zm-.64.52a.583.583 0 0 1 .64-.52l-.277 2.652a2.083 2.083 0 0 0 2.289-1.855zm.168-1.61-.169 1.61 2.653.277.168-1.61zM9.5 10.136H7.68v2.666H9.5zm1.174 2.925.152-1.454-2.652-.277-.152 1.454zm-.52-.641c.32.033.553.32.52.64l-2.652-.277a2.083 2.083 0 0 0 1.855 2.29zm-.64.52a.583.583 0 0 1 .64-.52l-.277 2.652a2.083 2.083 0 0 0 2.289-1.855zm.168-1.61-.168 1.61 2.652.277.168-1.61zm2.615-1.194h-1.29v2.666h1.29zm-.584.583c0-.322.262-.583.584-.583v2.666c1.15 0 2.083-.933 2.083-2.083zm.584.583a.583.583 0 0 1-.584-.583h2.667c0-1.15-.933-2.084-2.083-2.084zm-1.132 0h1.132V8.635h-1.132zm-1.124-3.41L9.84 9.83l2.652.277.202-1.937zm2.256-1.194h-.93v2.667h.93zm-.584.583c0-.322.262-.583.584-.583v2.667c1.15 0 2.083-.933 2.083-2.084zm.584.584a.583.583 0 0 1-.584-.584h2.667c0-1.15-.933-2.083-2.083-2.083zm-.773 0h.773V5.198h-.773zm-1.182-2.847-.144 1.375 2.652.277.144-1.375zm.52.64a.583.583 0 0 1-.52-.64l2.652.277a2.083 2.083 0 0 0-1.855-2.289zm.64-.52a.583.583 0 0 1-.64.52l.277-2.652a2.083 2.083 0 0 0-2.29 1.856zm-.16 1.532.16-1.531-2.652-.277-.16 1.53zM8.196 7.865h1.82V5.198h-1.82zM7.014 5.018 6.87 6.393l2.652.277.144-1.375zm.823 6.284h1.82V8.635h-1.82zm-1.124-3.41L6.51 9.83l2.653.277.202-1.937zm3.146-1.194H8.04v2.667h1.82zm1.124 3.41.202-1.938-2.652-.277L8.33 9.83z",mask:"url(#hash-circle_svg__a)"})))},kt=(0,o.forwardRef)(Ct);var Rt=n("./node_modules/matrix-react-sdk/src/components/views/settings/tabs/SettingsTab.tsx"),It=n("./node_modules/matrix-react-sdk/src/components/views/settings/shared/SettingsSection.tsx"),Tt=n("./node_modules/matrix-react-sdk/src/components/views/settings/shared/SettingsSubsection.tsx");function Pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Dt=(e,t)=>async n=>{const i=O.A.getValue("Spaces.enabledMetaSpaces");await O.A.setValue("Spaces.enabledMetaSpaces",null,re.p.ACCOUNT,Nt(Nt({},i),{},{[e]:n.target.checked})),u.A.trackInteraction(t,n,[Ae._b.Home,null,Ae._b.Favourites,Ae._b.People,Ae._b.Orphans,Ae._b.VideoRooms].indexOf(e))},Mt=()=>{const{[Ae._b.Home]:e,[Ae._b.Favourites]:t,[Ae._b.People]:n,[Ae._b.Orphans]:i,[Ae._b.VideoRooms]:r}=(0,Ne.ti)("Spaces.enabledMetaSpaces"),s=(0,Ne.ti)("Spaces.allRoomsInHome"),a=(0,o.useMemo)((()=>g.Ay.get("element_call").guest_spa_url),[]),l=(0,C._t)("settings|sidebar|metaspaces_video_rooms_description")+(a?" "+(0,C._t)("settings|sidebar|metaspaces_video_rooms_description_invite_extension"):"");return o.createElement(Rt.A,null,o.createElement(It.X,null,o.createElement(Tt.Ay,{heading:(0,C._t)("settings|sidebar|metaspaces_subsection"),description:(0,C._t)("settings|sidebar|spaces_explainer")},o.createElement(at.A,{checked:!!e,onChange:Dt(Ae._b.Home,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox",disabled:e},o.createElement(Tt.sS,null,o.createElement(ut,null),(0,C._t)("common|home")),o.createElement(Tt.sS,null,(0,C._t)("settings|sidebar|metaspaces_home_description"))),o.createElement(at.A,{checked:s,disabled:!e,onChange:async e=>{await O.A.setValue("Spaces.allRoomsInHome",null,re.p.ACCOUNT,e.target.checked),u.A.trackInteraction("WebSettingsSidebarTabSpacesCheckbox",e,1)},className:"mx_SidebarUserSettingsTab_checkbox mx_SidebarUserSettingsTab_homeAllRoomsCheckbox"},o.createElement(Tt.sS,null,(0,C._t)("settings|sidebar|metaspaces_home_all_rooms")),o.createElement(Tt.sS,null,(0,C._t)("settings|sidebar|metaspaces_home_all_rooms_description"))),o.createElement(at.A,{checked:!!t,onChange:Dt(Ae._b.Favourites,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},o.createElement(Tt.sS,null,o.createElement(gt,null),(0,C._t)("common|favourites")),o.createElement(Tt.sS,null,(0,C._t)("settings|sidebar|metaspaces_favourites_description"))),o.createElement(at.A,{checked:!!n,onChange:Dt(Ae._b.People,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},o.createElement(Tt.sS,null,o.createElement(bt,null),(0,C._t)("common|people")),o.createElement(Tt.sS,null,(0,C._t)("settings|sidebar|metaspaces_people_description"))),o.createElement(at.A,{checked:!!i,onChange:Dt(Ae._b.Orphans,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},o.createElement(Tt.sS,null,o.createElement(kt,null),(0,C._t)("settings|sidebar|metaspaces_orphans")),o.createElement(Tt.sS,null,(0,C._t)("settings|sidebar|metaspaces_orphans_description"))),O.A.getValue("feature_video_rooms")&&o.createElement(at.A,{checked:!!r,onChange:Dt(Ae._b.VideoRooms,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},o.createElement(Tt.sS,null,o.createElement(lt.I,null),(0,C._t)("settings|sidebar|metaspaces_video_rooms")),o.createElement(Tt.sS,null,l)))))};var Ot=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/UserTab.ts"),Lt=n("./node_modules/matrix-react-sdk/src/theme.ts"),Ut=n("./node_modules/matrix-react-sdk/src/components/views/elements/Dropdown.tsx");function Ft(){const e=(0,Ne.ti)("theme"),t=(0,Ne.wL)(re.p.DEVICE,"use_system_theme",null,!1,!0),n=(0,Ne.wL)(re.p.DEVICE,"theme",null,!1,!0),i=(0,Ne.ti)("use_system_theme");return t?{theme:e,systemThemeActivated:!0}:n?{theme:e,systemThemeActivated:!1}:{theme:e,systemThemeActivated:i}}const jt="MATCH_SYSTEM_THEME_ID",Bt=({requestClose:e})=>{const t=(0,o.useMemo)(Lt.E0,[]),n=Ft(),i=(0,Lt.kZ)(n.theme),r=i||n.theme,{systemThemeActivated:s}=n,a=[{id:jt,name:(0,C._t)("theme|match_system")},...t],l=s?jt:r;return o.createElement("div",{className:"mx_QuickThemeSwitcher"},o.createElement("h4",{className:"mx_QuickThemeSwitcher_heading"},(0,C._t)("common|theme")),o.createElement(Ut.A,{id:"mx_QuickSettingsButton_themePickerDropdown",onOptionChange:async t=>{u.A.trackInteraction("WebQuickSettingsThemeDropdown");try{t===jt?await O.A.setValue("use_system_theme",null,re.p.DEVICE,!0):(v.Ay.dispatch({action:x.r.RecheckTheme,forceTheme:t}),await Promise.all([O.A.setValue("theme",null,re.p.DEVICE,t),O.A.setValue("use_system_theme",null,re.p.DEVICE,!1)]))}catch(e){v.Ay.dispatch({action:x.r.RecheckTheme})}e()},value:l,label:(0,C._t)("common|theme")},a.map((e=>o.createElement("div",{key:e.id},e.name)))))};var Vt,Ht;function zt(){return zt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},zt.apply(null,arguments)}var Wt=function(e,t){return o.createElement("svg",zt({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Vt||(Vt=o.createElement("path",{fill:"#000",d:"M11 18.598V15h2v3.598C13 20.5 12.238 22 12 22s-1-1.5-1-3.402M9.5 6c-.325-.167-1.714-.8-2.883-2s-.495-2 .513-2H12v4zM14.5 6c.325-.167 1.714-.8 2.883-2s.495-2-.513-2H12v4zM9.429 6h5.142L15 10H9z"})),Ht||(Ht=o.createElement("path",{fill:"#000",d:"M12 9c-3.069 0-5.676 1.693-6.621 4.048C4.967 14.073 5.895 15 7 15h10c1.105 0 2.032-.927 1.621-1.952C17.677 10.693 15.07 9 12 9"})))},Gt=(0,o.forwardRef)(Wt);var Kt,Jt,qt;function $t(){return $t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$t.apply(null,arguments)}var Yt=function(e,t){return o.createElement("svg",$t({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0,ref:t},e),Kt||(Kt=o.createElement("circle",{cx:15.5,cy:10,r:1.5,fill:"currentColor",transform:"rotate(180 15.5 10)"})),Jt||(Jt=o.createElement("circle",{cx:10,cy:10,r:1.5,fill:"currentColor",transform:"rotate(180 10 10)"})),qt||(qt=o.createElement("circle",{cx:4.5,cy:10,r:1.5,fill:"currentColor",transform:"rotate(180 4.5 10)"})))},Qt=(0,o.forwardRef)(Yt);var Zt=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/DevtoolsDialog.tsx"),Xt=n("./node_modules/matrix-react-sdk/src/contexts/SDKContext.ts");const en=({isPanelCollapsed:e=!1})=>{const[t,n,r,s]=(0,Me.EF)(),{[Ae._b.Favourites]:a,[Ae._b.People]:l}=(0,Ne.ti)("Spaces.enabledMetaSpaces"),c=Xt.M.instance.roomViewStore.getRoomId(),d=(0,Ne.ti)("developerMode");let u;return t&&n.current&&(u=o.createElement(Me.Ay,(0,i.A)({},(0,Me.Gi)(n.current.getBoundingClientRect(),Me.t4.None,16),{wrapperClassName:"mx_QuickSettingsButton_ContextMenuWrapper",onFinished:s,managed:!1,focusLock:!0}),o.createElement("h2",null,(0,C._t)("quick_settings|title")),o.createElement(be.A,{onClick:()=>{s(),v.Ay.dispatch({action:x.r.ViewUserSettings})},kind:"primary_outline"},(0,C._t)("quick_settings|all_settings")),c&&d&&o.createElement(be.A,{onClick:()=>{s(),f.Ay.createDialog(Zt.A,{roomId:c},"mx_DevtoolsDialog_wrapper")},kind:"danger_outline"},(0,C._t)("devtools|title")),o.createElement("h4",{className:"mx_QuickSettingsButton_pinToSidebarHeading"},o.createElement(Gt,{className:"mx_QuickSettingsButton_icon"}),(0,C._t)("quick_settings|metaspace_section")),o.createElement(at.A,{className:"mx_QuickSettingsButton_favouritesCheckbox",checked:!!a,onChange:Dt(Ae._b.Favourites,"WebQuickSettingsPinToSidebarCheckbox")},o.createElement(gt,{className:"mx_QuickSettingsButton_icon"}),(0,C._t)("common|favourites")),o.createElement(at.A,{className:"mx_QuickSettingsButton_peopleCheckbox",checked:!!l,onChange:Dt(Ae._b.People,"WebQuickSettingsPinToSidebarCheckbox")},o.createElement(bt,{className:"mx_QuickSettingsButton_icon"}),(0,C._t)("common|people")),o.createElement(be.A,{className:"mx_QuickSettingsButton_moreOptionsButton",onClick:()=>{s(),v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Sidebar})}},o.createElement(Qt,{className:"mx_QuickSettingsButton_icon"}),(0,C._t)("quick_settings|sidebar_settings")),o.createElement(Bt,{requestClose:s}))),o.createElement(o.Fragment,null,o.createElement(be.A,{className:ee()("mx_QuickSettingsButton",{expanded:!e}),onClick:r,"aria-label":(0,C._t)("quick_settings|title"),title:e?(0,C._t)("quick_settings|title"):void 0,ref:n,"aria-expanded":!e},e?null:(0,C._t)("common|settings")),u)};var tn=n("./node_modules/matrix-react-sdk/src/components/views/elements/Field.tsx"),nn=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BugReportDialog.tsx"),rn=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/InfoDialog.tsx"),on=n("./node_modules/matrix-react-sdk/src/hooks/useStateToggle.ts"),sn=n("./node_modules/matrix-react-sdk/src/components/views/elements/ExternalLink.tsx");const an=e=>{const t=(0,o.useRef)(null),[n,i]=(0,o.useState)(""),[r,s]=(0,on.X)(!1);(0,o.useEffect)((()=>{var e;null===(e=t.current)||void 0===e||e.focus()}),[]);const a=()=>{e.onFinished(),f.Ay.createDialog(nn.A,{})},l=!!g.Ay.get().bug_report_endpoint_url;let c,d;l&&(c=o.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_rateApp"},o.createElement("h3",null,(0,C._t)("feedback|comment_label")),o.createElement("p",null,(0,C._t)("feedback|platform_username")),o.createElement(tn.A,{id:"feedbackComment",label:(0,C._t)("common|feedback"),type:"text",autoComplete:"off",value:n,element:"textarea",onChange:e=>{i(e.target.value)},ref:t}),o.createElement(at.A,{checked:r,onChange:s},(0,C._t)("feedback|may_contact_label")))),l&&(d=o.createElement("p",{className:"mx_FeedbackDialog_section_microcopy"},(0,C._t)("feedback|pro_type",{},{debugLogsLink:e=>o.createElement(be.A,{kind:"link_inline",onClick:a},e)})));const u=g.Ay.getObject("feedback").get("existing_issues_url"),m=g.Ay.getObject("feedback").get("new_issue_url");return o.createElement(z.A,{className:"mx_FeedbackDialog",hasCancelButton:l,title:(0,C._t)("common|feedback"),description:o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_reportBug"},o.createElement("h3",null,(0,C._t)("common|report_a_bug")),o.createElement("p",null,(0,C._t)("feedback|existing_issue_link",{},{existingIssuesLink:e=>o.createElement(sn.A,{target:"_blank",rel:"noreferrer noopener",href:u},e),newIssueLink:e=>o.createElement(sn.A,{target:"_blank",rel:"noreferrer noopener",href:m},e)})),d),c),button:l?(0,C._t)("feedback|send_feedback_action"):(0,C._t)("action|go_back"),buttonDisabled:l&&!n,onFinished:t=>{if(l&&t){const t=e.feature?`${e.feature}-feedback`:"feedback";(0,D.Wz)(t,n,r),f.Ay.createDialog(rn.A,{title:(0,C._t)("feedback|sent"),description:(0,C._t)("bug_reporting|thank_you")})}e.onFinished()}})};var ln=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/security/RestoreKeyBackupDialog.tsx"),cn=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),dn=n("./node_modules/matrix-react-sdk/src/components/views/elements/Spinner.tsx"),un=n("./node_modules/matrix-react-sdk/src/components/views/elements/DialogButtons.tsx"),mn=function(e){return e[e.LOADING=0]="LOADING",e[e.NO_CRYPTO=1]="NO_CRYPTO",e[e.BACKUP_ACTIVE=2]="BACKUP_ACTIVE",e[e.SERVER_BACKUP_BUT_DISABLED=3]="SERVER_BACKUP_BUT_DISABLED",e[e.NO_BACKUP=4]="NO_BACKUP",e[e.ERROR=5]="ERROR",e}(mn||{});async function hn(e){const t=null==e?void 0:e.getCrypto();if(!t)return!1;const n=e.getRooms();for(const e of n){if(await t.isEncryptionEnabledInRoom(e.roomId))return!0}return!1}class pn extends o.Component{constructor(e){super(e),(0,r.A)(this,"onExportE2eKeysClicked",(()=>{f.Ay.createDialogAsync(n.e(8297).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/ExportE2eKeysDialog.tsx")),{matrixClient:h.J.safeGet()})})),(0,r.A)(this,"onFinished",(e=>{e&&v.Ay.dispatch({action:"logout"}),this.props.onFinished(!!e)})),(0,r.A)(this,"onSetRecoveryMethodClick",(()=>{this.state.backupStatus===mn.SERVER_BACKUP_BUT_DISABLED?f.Ay.createDialog(ln.A,void 0,void 0,!1,!0):f.Ay.createDialogAsync(n.e(8366).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/CreateKeyBackupDialog.tsx")),void 0,void 0,!1,!0),this.props.onFinished(!0)})),(0,r.A)(this,"onLogoutConfirm",(()=>{v.Ay.dispatch({action:"logout"}),this.props.onFinished(!0)})),this.state={backupStatus:mn.LOADING},window.setTimeout((()=>this.startLoadBackupStatus()),0)}startLoadBackupStatus(){this.loadBackupStatus().catch((e=>{l.v.log("Unable to fetch key backup status",e),this.setState({backupStatus:mn.ERROR})}))}async loadBackupStatus(){const e=h.J.safeGet(),t=e.getCrypto();if(!t)return void this.setState({backupStatus:mn.NO_CRYPTO});if(null!==await t.getActiveSessionBackupVersion())return void this.setState({backupStatus:mn.BACKUP_ACTIVE});const n=await e.getKeyBackupVersion();this.setState({backupStatus:n?mn.SERVER_BACKUP_BUT_DISABLED:mn.NO_BACKUP})}renderSetupBackupDialog(){const e=o.createElement("div",null,o.createElement("p",null,(0,C._t)("auth|logout_dialog|setup_secure_backup_description_1")),o.createElement("p",null,(0,C._t)("auth|logout_dialog|setup_secure_backup_description_2")),o.createElement("p",null,(0,C._t)("encryption|setup_secure_backup|explainer")));let t;t=this.state.backupStatus===mn.SERVER_BACKUP_BUT_DISABLED?(0,C._t)("settings|security|key_backup_connect"):(0,C._t)("auth|logout_dialog|use_key_backup");const n=o.createElement("div",null,o.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},e),o.createElement(un.A,{primaryButton:t,hasCancel:!1,onPrimaryButtonClick:this.onSetRecoveryMethodClick,focus:!0},o.createElement("button",{onClick:this.onLogoutConfirm},(0,C._t)("auth|logout_dialog|skip_key_backup"))),o.createElement("details",null,o.createElement("summary",{className:"mx_LogoutDialog_ExportKeyAdvanced"},(0,C._t)("common|advanced")),o.createElement("p",null,o.createElement("button",{onClick:this.onExportE2eKeysClicked},(0,C._t)("auth|logout_dialog|megolm_export")))));return o.createElement(cn.A,{title:(0,C._t)("auth|logout_dialog|setup_key_backup_title"),contentId:"mx_Dialog_content",hasCancel:!0,onFinished:this.onFinished},n)}render(){switch(this.state.backupStatus){case mn.LOADING:return o.createElement(cn.A,{title:(0,C._t)("action|sign_out"),contentId:"mx_Dialog_content",hasCancel:!0,onFinished:this.onFinished},o.createElement(dn.A,null));case mn.NO_CRYPTO:case mn.BACKUP_ACTIVE:return o.createElement(z.A,{hasCancelButton:!0,title:(0,C._t)("action|sign_out"),description:(0,C._t)("auth|logout_dialog|description"),button:(0,C._t)("action|sign_out"),onFinished:this.onFinished});case mn.NO_BACKUP:case mn.SERVER_BACKUP_BUT_DISABLED:case mn.ERROR:return this.renderSetupBackupDialog()}}}(0,r.A)(pn,"defaultProps",{onFinished:function(){}});var gn=n("./node_modules/matrix-react-sdk/src/utils/WellKnownUtils.ts"),vn=n("./node_modules/matrix-react-sdk/src/utils/SnakedObject.ts");function _n(e,t){const n=new vn.Q(e).get("embedded_pages");let i=n?new vn.Q(n).get("home_url"):null;var r;(i||(i=e.welcomePageUrl,i&&l.v.warn("You are using a deprecated config option: `welcomePageUrl`. Please use `embedded_pages.home_url` instead, per https://github.com/vector-im/element-web/issues/21428")),i)||(i=null===(r=(0,gn.qh)(t))||void 0===r?void 0:r.home_url);return i}var fn,yn,En,bn,wn=n("./node_modules/matrix-react-sdk/src/stores/OwnProfileStore.ts"),xn=n("./node_modules/matrix-react-sdk/src/components/views/avatars/BaseAvatar.tsx"),An=n("./node_modules/matrix-react-sdk/src/customisations/UserIdentifier.ts");function Sn(){return Sn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Sn.apply(null,arguments)}var Cn=function(e,t){return o.createElement("svg",Sn({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 8 8",role:"presentation","aria-hidden":!0,ref:t},e),fn||(fn=o.createElement("path",{fill:"currentColor",d:"M6.73 1.395a.333.333 0 0 0-.527.41l.005.006.021.029q.03.04.081.121c.069.108.162.267.255.466.186.4.368.95.368 1.573 0 .622-.182 1.173-.368 1.573a4 4 0 0 1-.357.616l-.004.006h-.001a.333.333 0 0 0 .527.41L6.48 6.41l.249.194v-.001l.001-.002.003-.003.009-.012a2 2 0 0 0 .13-.19c.081-.128.189-.312.296-.542A4.4 4.4 0 0 0 7.599 4a4.4 4.4 0 0 0-.43-1.855 5 5 0 0 0-.426-.732L6.734 1.4l-.003-.004zl-.263.204z"})),yn||(yn=o.createElement("path",{fill:"currentColor",d:"M5.863 2.595a.333.333 0 0 0-.527.409l.001.001a1 1 0 0 1 .044.065c.032.049.074.122.117.214.087.186.169.437.169.716 0 .28-.082.53-.169.716a2 2 0 0 1-.16.279l-.002.002a.333.333 0 0 0 .527.408L5.6 5.2l.263.205v-.001l.002-.001.002-.003.005-.007a1 1 0 0 0 .072-.105c.044-.07.101-.168.158-.29.114-.243.232-.592.232-.998s-.118-.755-.232-.998a2.6 2.6 0 0 0-.23-.395L5.867 2.6l-.002-.003h-.001zL5.6 2.8zM1.204 6.605a.333.333 0 0 0 .526-.41l-.005-.006-.02-.029-.082-.121a4 4 0 0 1-.254-.466A3.8 3.8 0 0 1 1 4c0-.622.182-1.173.369-1.573a4 4 0 0 1 .356-.616l.005-.006a.333.333 0 0 0-.526-.41l.248.194-.248-.194-.001.001-.001.002L1.2 1.4l-.009.012a2 2 0 0 0-.13.19 5 5 0 0 0-.295.542A4.4 4.4 0 0 0 .333 4c0 .75.218 1.398.432 1.855a5 5 0 0 0 .425.732l.01.012.002.004h.001zl.264-.204z"})),En||(En=o.createElement("path",{fill:"currentColor",d:"M2.07 5.405a.333.333 0 0 0 .527-.409l-.001-.001a1 1 0 0 1-.044-.065 2 2 0 0 1-.117-.214A1.7 1.7 0 0 1 2.266 4c0-.28.082-.53.17-.716a2 2 0 0 1 .16-.279l.001-.002a.333.333 0 0 0-.527-.408l.263.205-.263-.205v.001l-.001.001-.002.003-.006.007a1 1 0 0 0-.072.105 3 3 0 0 0-.158.29A2.4 2.4 0 0 0 1.6 4c0 .406.118.755.231.998a2.6 2.6 0 0 0 .23.395l.006.007.002.003zl.264-.204z"})),bn||(bn=o.createElement("circle",{cx:4,cy:4,r:.667,fill:"currentColor"})))},kn=(0,o.forwardRef)(Cn);var Rn,In,Tn,Pn=n("./node_modules/matrix-react-sdk/src/voice-broadcast/index.ts"),Nn=n("./node_modules/matrix-react-sdk/src/utils/Feedback.ts");function Dn(){return Dn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Dn.apply(null,arguments)}var Mn=function(e,t){return o.createElement("svg",Dn({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Rn||(Rn=o.createElement("path",{fillRule:"evenodd",d:"M3 4a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1zm2 5V5h4v4zm-2 5a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1zm2 5v-4h4v4zm9-16a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm1 2v4h4V5z",clipRule:"evenodd"})),In||(In=o.createElement("path",{d:"M15 16v-3h-2v3z"})),Tn||(Tn=o.createElement("path",{d:"M17 16h-2v2h-2v3h2v-3h2v2h4v-2h-2v-5h-2z"})))},On=(0,o.forwardRef)(Mn);var Ln=n("./node_modules/matrix-react-sdk/src/settings/Settings.tsx");function Un(e,t,n,i,r){var o,a,l,c;const d=!(null==i||null===(o=i.unstable_features)||void 0===o||!o["org.matrix.msc4108"])||!(null==r||null===(a=r["io.element.rendezvous"])||void 0===a||!a.server);return(null==n||null===(l=n.metadata)||void 0===l?void 0:l.grant_types_supported.includes(s.DEVICE_CODE_SCOPE))&&d&&O.A.getValue(Ln.O5.OidcNativeFlow)&&!(null===(c=e.getCrypto())||void 0===c||!c.exportSecretsBundle)&&t}const Fn=({onShowQr:e,versions:t,capabilities:n,wellKnown:i,oidcClientConfig:r,isCrossSigningReady:a})=>{const l=(0,Re.nH)(),c=r?Un(l,!!a,r,t,i):function(e,t,n){var i,r,o;const a=s.GET_LOGIN_TOKEN_CAPABILITY.findIn(n),l=!(null==e||null===(i=e.unstable_features)||void 0===i||!i["org.matrix.msc3882"])||!(null==a||!a.enabled),c=!(null==e||null===(r=e.unstable_features)||void 0===r||!r["org.matrix.msc3886"])||!(null==t||null===(o=t["io.element.rendezvous"])||void 0===o||!o.server);return l&&c}(t,i,n);return c?o.createElement(Tt.Ay,{heading:(0,C._t)("settings|sessions|sign_in_with_qr")},o.createElement("div",{className:"mx_LoginWithQRSection"},o.createElement("p",{className:"mx_SettingsTab_subsectionText"},(0,C._t)("settings|sessions|sign_in_with_qr_description")),o.createElement(be.A,{onClick:e,kind:"primary"},o.createElement(On,{height:20,width:20}),(0,C._t)("settings|sessions|sign_in_with_qr_button")))):null};class jn extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"themeWatcherRef",void 0),(0,r.A)(this,"dndWatcherRef",void 0),(0,r.A)(this,"buttonRef",(0,o.createRef)()),(0,r.A)(this,"onCurrentVoiceBroadcastRecordingChanged",(e=>{this.setState({showLiveAvatarAddon:null!==e})})),(0,r.A)(this,"checkQrLoginSupport",(async()=>{if(!this.context.client||!O.A.getValue(Ln.O5.OidcNativeFlow))return;const{issuer:e}=await this.context.client.getAuthIssuer().catch((()=>({issuer:void 0})));if(e){var t;const[n,i,r,o]=await Promise.all([(0,s.discoverAndValidateOIDCIssuerWellKnown)(e),this.context.client.getVersions(),this.context.client.waitForClientWellKnown(),null===(t=this.context.client.getCrypto())||void 0===t?void 0:t.isCrossSigningReady()]),a=Un(this.context.client,!!o,n,i,r);this.setState({supportsQrLogin:a,showQrLogin:!0})}})),(0,r.A)(this,"onProfileUpdate",(async()=>{this.forceUpdate()})),(0,r.A)(this,"onSelectedSpaceUpdate",(async()=>{this.setState({selectedSpace:xe.Ay.instance.activeSpaceRoom})})),(0,r.A)(this,"onThemeChanged",(()=>{this.setState({isDarkTheme:this.isUserOnDarkTheme(),isHighContrast:this.isUserOnHighContrastTheme()})})),(0,r.A)(this,"onAction",(e=>{if(e.action===x.r.ToggleUserMenu)this.state.contextMenuPosition?this.setState({contextMenuPosition:null}):this.buttonRef.current&&this.buttonRef.current.click()})),(0,r.A)(this,"onOpenMenuClick",(e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:e.currentTarget.getBoundingClientRect()})})),(0,r.A)(this,"onContextMenu",(e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,width:20,height:0}})})),(0,r.A)(this,"onCloseMenu",(()=>{this.setState({contextMenuPosition:null})})),(0,r.A)(this,"onSwitchThemeClick",(e=>{e.preventDefault(),e.stopPropagation(),u.A.trackInteraction("WebUserMenuThemeToggleButton",e),O.A.setValue("use_system_theme",null,re.p.DEVICE,!1);let t=this.state.isDarkTheme?"light":"dark";if(this.state.isHighContrast){const e=(0,Lt.TJ)(t);e&&(t=e)}O.A.setValue("theme",null,re.p.DEVICE,t)})),(0,r.A)(this,"onSettingsOpen",((e,t,n)=>{e.preventDefault(),e.stopPropagation();const i={action:x.r.ViewUserSettings,initialTabId:t,props:n};v.Ay.dispatch(i),this.setState({contextMenuPosition:null})})),(0,r.A)(this,"onProvideFeedback",(e=>{e.preventDefault(),e.stopPropagation(),f.Ay.createDialog(an),this.setState({contextMenuPosition:null})})),(0,r.A)(this,"onSignOutClick",(async e=>{e.preventDefault(),e.stopPropagation(),await hn(h.J.safeGet())?f.Ay.createDialog(pn):v.Ay.dispatch({action:"logout"}),this.setState({contextMenuPosition:null})})),(0,r.A)(this,"onSignInClick",(()=>{v.Ay.dispatch({action:"start_login"}),this.setState({contextMenuPosition:null})})),(0,r.A)(this,"onRegisterClick",(()=>{v.Ay.dispatch({action:"start_registration"}),this.setState({contextMenuPosition:null})})),(0,r.A)(this,"onHomeClick",(e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:x.r.ViewHomePage}),this.setState({contextMenuPosition:null})})),(0,r.A)(this,"renderContextMenu",(()=>{if(!this.state.contextMenuPosition)return null;let e,t,r,s;if(h.J.safeGet().isGuest()&&(e=o.createElement("div",{className:"mx_UserMenu_contextMenu_header mx_UserMenu_contextMenu_guestPrompts"},(0,C._t)("auth|sign_in_prompt",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onSignInClick},e)}),O.A.getValue(W.f.Registration)?(0,C._t)("auth|create_account_prompt",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onRegisterClick},e)}):null)),this.hasHomePage&&(t=o.createElement(Le.R$,{iconClassName:"mx_UserMenu_iconHome",label:(0,C._t)("common|home"),onClick:this.onHomeClick})),(0,Nn.I)()&&(r=o.createElement(Le.R$,{iconClassName:"mx_UserMenu_iconMessage",label:(0,C._t)("common|feedback"),onClick:this.onProvideFeedback})),this.state.showQrLogin){const e={};this.state.supportsQrLogin||(e.disabled=!0,e.title=(0,C._t)("user_menu|link_new_device_not_supported"),e.caption=(0,C._t)("user_menu|link_new_device_not_supported_caption"),e.placement="right"),s=o.createElement(Le.R$,(0,i.A)({},e,{iconClassName:"mx_UserMenu_iconQr",label:(0,C._t)("user_menu|link_new_device"),onClick:e=>this.onSettingsOpen(e,Ot.v.SessionManager,{showMsc4108QrCode:!0})}))}let a=o.createElement(Le.tx,null,t,s,o.createElement(Le.R$,{iconClassName:"mx_UserMenu_iconBell",label:(0,C._t)("notifications|enable_prompt_toast_title"),onClick:e=>this.onSettingsOpen(e,Ot.v.Notifications)}),o.createElement(Le.R$,{iconClassName:"mx_UserMenu_iconLock",label:(0,C._t)("room_settings|security|title"),onClick:e=>this.onSettingsOpen(e,Ot.v.Security)}),o.createElement(Le.R$,{iconClassName:"mx_UserMenu_iconSettings",label:(0,C._t)("user_menu|settings"),onClick:e=>this.onSettingsOpen(e)}),r,o.createElement(Le.R$,{className:"mx_IconizedContextMenu_option_red",iconClassName:"mx_UserMenu_iconSignOut",label:(0,C._t)("action|sign_out"),onClick:this.onSignOutClick}));h.J.safeGet().isGuest()&&(a=o.createElement(Le.tx,null,t,o.createElement(Le.R$,{iconClassName:"mx_UserMenu_iconSettings",label:(0,C._t)("common|settings"),onClick:e=>this.onSettingsOpen(e)}),r));const l=this.props.isPanelCollapsed?{left:(c=this.state.contextMenuPosition).width+c.left+8,top:c.top,chevronFace:Me.t4.None}:(e=>({left:e.left,top:e.top+e.height,chevronFace:Me.t4.None}))(this.state.contextMenuPosition);var c;return o.createElement(Le.Ay,(0,i.A)({},l,{onFinished:this.onCloseMenu,className:"mx_UserMenu_contextMenu"}),o.createElement("div",{className:"mx_UserMenu_contextMenu_header"},o.createElement("div",{className:"mx_UserMenu_contextMenu_name"},o.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},wn.V.instance.displayName),o.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},An.A.getDisplayUserIdentifier(h.J.safeGet().getSafeUserId(),{withDisplayName:!0}))),o.createElement(Ze.k,{className:"mx_UserMenu_contextMenu_themeButton",onClick:this.onSwitchThemeClick,title:this.state.isDarkTheme?(0,C._t)("user_menu|switch_theme_light"):(0,C._t)("user_menu|switch_theme_dark")},o.createElement("img",{src:n("./node_modules/matrix-react-sdk/res/img/element-icons/roomlist/dark-light-mode.svg").A,role:"presentation",alt:"",width:16}))),e,a)})),this.state={contextMenuPosition:null,isDarkTheme:this.isUserOnDarkTheme(),isHighContrast:this.isUserOnHighContrastTheme(),selectedSpace:xe.Ay.instance.activeSpaceRoom,showLiveAvatarAddon:this.context.voiceBroadcastRecordingsStore.hasCurrent(),showQrLogin:!1,supportsQrLogin:!1},wn.V.instance.on(A.H,this.onProfileUpdate),xe.Ay.instance.on(Ae.tw,this.onSelectedSpaceUpdate)}get hasHomePage(){return!!_n(g.Ay.get(),this.context.client)}componentDidMount(){this.context.voiceBroadcastRecordingsStore.on(Pn.Ls.CurrentChanged,this.onCurrentVoiceBroadcastRecordingChanged),this.dispatcherRef=v.Ay.register(this.onAction),this.themeWatcherRef=O.A.watchSetting("theme",null,this.onThemeChanged),this.checkQrLoginSupport()}componentWillUnmount(){this.themeWatcherRef&&O.A.unwatchSetting(this.themeWatcherRef),this.dndWatcherRef&&O.A.unwatchSetting(this.dndWatcherRef),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef),wn.V.instance.off(A.H,this.onProfileUpdate),xe.Ay.instance.off(Ae.tw,this.onSelectedSpaceUpdate),this.context.voiceBroadcastRecordingsStore.off(Pn.Ls.CurrentChanged,this.onCurrentVoiceBroadcastRecordingChanged)}isUserOnDarkTheme(){if(O.A.getValue("use_system_theme"))return window.matchMedia("(prefers-color-scheme: dark)").matches;{const e=O.A.getValue("theme");return e.startsWith("custom-")?!!(0,Lt.TP)(e.substring(7)).is_dark:"dark"===e}}isUserOnHighContrastTheme(){if(O.A.getValue("use_system_theme"))return window.matchMedia("(prefers-contrast: more)").matches;{const e=O.A.getValue("theme");return!e.startsWith("custom-")&&(0,Lt.AZ)(e)}}render(){const e=h.J.safeGet().getSafeUserId(),t=wn.V.instance.displayName||e,n=wn.V.instance.getHttpAvatarUrl(32);let i;this.props.isPanelCollapsed||(i=o.createElement("div",{className:"mx_UserMenu_name"},t));const r=this.state.showLiveAvatarAddon?o.createElement("div",{className:"mx_UserMenu_userAvatarLive"},o.createElement(kn,{className:"mx_Icon_8"})):null;return o.createElement("div",{className:"mx_UserMenu"},o.createElement(Me.VJ,{className:"mx_UserMenu_contextMenuButton",onClick:this.onOpenMenuClick,ref:this.buttonRef,label:(0,C._t)("a11y|user_menu"),isExpanded:!!this.state.contextMenuPosition,onContextMenu:this.onContextMenu},o.createElement("div",{className:"mx_UserMenu_userAvatar"},o.createElement(xn.A,{idName:e,name:t,url:n,size:"32px",className:"mx_UserMenu_userAvatar_BaseAvatar"}),r),i,this.renderContextMenu()),this.props.children)}}(0,r.A)(jn,"contextType",Xt.A);var Bn=n("./node_modules/matrix-react-sdk/src/components/structures/AutoHideScrollbar.tsx");const Vn=["children","trackHorizontalOverflow","verticalScrollsHorizontally"];class Hn extends o.Component{constructor(e){super(e),(0,r.A)(this,"autoHideScrollbar",(0,o.createRef)()),(0,r.A)(this,"scrollElement",void 0),(0,r.A)(this,"likelyTrackpadUser",null),(0,r.A)(this,"checkAgainForTrackpad",0),(0,r.A)(this,"collectScroller",(e=>{var t,n;null===(t=(n=this.props).wrappedRef)||void 0===t||t.call(n,e),e&&!this.scrollElement&&(this.scrollElement=e,this.scrollElement.addEventListener("scroll",this.checkOverflow,{passive:!0}),this.checkOverflow())})),(0,r.A)(this,"checkOverflow",(()=>{if(!this.scrollElement)return;const e=this.scrollElement.scrollTop>0,t=this.scrollElement.scrollHeight>this.scrollElement.scrollTop+this.scrollElement.clientHeight,n=this.scrollElement.scrollLeft>0,i=this.scrollElement.scrollWidth>this.scrollElement.scrollLeft+this.scrollElement.clientWidth;e?this.scrollElement.classList.add("mx_IndicatorScrollbar_topOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_topOverflow"),t?this.scrollElement.classList.add("mx_IndicatorScrollbar_bottomOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_bottomOverflow"),n?this.scrollElement.classList.add("mx_IndicatorScrollbar_leftOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_leftOverflow"),i?this.scrollElement.classList.add("mx_IndicatorScrollbar_rightOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_rightOverflow"),this.props.trackHorizontalOverflow&&this.setState({leftIndicatorOffset:n?`${this.scrollElement.scrollLeft}px`:"0",rightIndicatorOffset:i?`-${this.scrollElement.scrollLeft}px`:"0"})})),(0,r.A)(this,"onMouseWheel",(e=>{if(this.props.verticalScrollsHorizontally&&this.scrollElement){const t=0,n=1,i=(new Date).getTime();if(Math.abs(e.deltaX)>0?(this.likelyTrackpadUser=!0,this.checkAgainForTrackpad=i+6e4):this.likelyTrackpadUser&&i>=this.checkAgainForTrackpad&&(this.likelyTrackpadUser=!1),this.likelyTrackpadUser)return;if(Math.abs(e.deltaX)<=t){const t=e.deltaY<0?-50:50,i=Math.abs(e.deltaY)<25?e.deltaY+t:e.deltaY;this.scrollElement.scrollLeft+=i*n}}})),this.state={leftIndicatorOffset:"0",rightIndicatorOffset:"0"}}componentDidUpdate(e){o.Children.count(e.children)!==o.Children.count(this.props.children)&&this.checkOverflow()}componentDidMount(){this.checkOverflow(),Ce.A.instance.on(Ce.x.Resize,this.checkOverflow)}componentWillUnmount(){var e;null===(e=this.scrollElement)||void 0===e||e.removeEventListener("scroll",this.checkOverflow),Ce.A.instance.off(Ce.x.Resize,this.checkOverflow)}render(){const e=this.props,{children:t,trackHorizontalOverflow:n,verticalScrollsHorizontally:r}=e,s=(0,Ue.A)(e,Vn),a={left:this.state.leftIndicatorOffset},l={right:this.state.rightIndicatorOffset},c=n?o.createElement("div",{className:"mx_IndicatorScrollbar_leftOverflowIndicator",style:a}):null,d=n?o.createElement("div",{className:"mx_IndicatorScrollbar_rightOverflowIndicator",style:l}):null;return o.createElement(Bn.A,(0,i.A)({},s,{ref:this.autoHideScrollbar,wrappedRef:this.collectScroller,onWheel:this.onMouseWheel}),c,t,d)}}var zn=n("./node_modules/@vector-im/compound-design-tokens/icons/threads-solid.svg"),Wn=n("./node_modules/matrix-react-sdk/src/utils/notifications.ts");const Gn=["displayLabel","notificationLevel","disableTooltip"],Kn=(0,o.forwardRef)((function(e,t){let{displayLabel:n,notificationLevel:r,disableTooltip:s}=e,a=(0,Ue.A)(e,Gn);const l=!s&&!n&&void 0;return o.createElement(ke.m_,{label:(0,C._t)("common|threads"),placement:"right",open:l},o.createElement(ke.K0,(0,i.A)({"aria-label":(0,C._t)("common|threads"),className:ee()("mx_ThreadsActivityCentreButton",{expanded:n}),indicator:(0,Wn.W7)(r)},a,{ref:t}),o.createElement(o.Fragment,null,o.createElement(zn.I,{className:"mx_ThreadsActivityCentreButton_Icon"}),n&&o.createElement(ke.EY,{className:"mx_ThreadsActivityCentreButton_Text",as:"span",size:"md",title:(0,C._t)("common|threads")},(0,C._t)("common|threads")))))}));var Jn=n("./node_modules/matrix-react-sdk/src/components/views/avatars/DecoratedRoomAvatar.tsx"),qn=n("./node_modules/matrix-react-sdk/src/stores/right-panel/RightPanelStore.ts"),$n=n("./node_modules/matrix-react-sdk/src/stores/right-panel/RightPanelStorePhases.ts"),Yn=n("./node_modules/matrix-react-sdk/src/Unread.ts"),Qn=n("./node_modules/matrix-react-sdk/src/stores/room-list/filters/VisibilityProvider.ts");const Zn=500;function Xn(e){const t=(0,Ne.ti)("feature_dynamic_room_predecessors"),n=(0,Ne.ti)("Notifications.tac_only_notifications"),i=(0,Re.nH)(),[r,a]=(0,o.useState)({greatestNotificationLevel:Qe.S.None,rooms:[]}),l=(0,o.useCallback)((()=>{a(function(e,t,n){const i=e.getVisibleRooms(t);let r=Qe.S.None;const o=[];for(const e of i)if(Qn.W.instance.isRoomVisible(e)&&(0,Yn.Nb)(e)){const t=(0,Wn.gM)(e);if(n&&t<=Qe.S.Activity)continue;t>r&&(r=t),o.push({room:e,notificationLevel:t})}const s=o.sort(((e,t)=>function(e,t){var n,i;const{notificationLevel:r,room:o}=e,{notificationLevel:s,room:a}=t,l=null===(n=o.getLastThread())||void 0===n||null===(n=n.events.at(-1))||void 0===n?void 0:n.getTs(),c=null===(i=a.getLastThread())||void 0===i||null===(i=i.events.at(-1))||void 0===i?void 0:i.getTs();return r>s?-1:s>r?1:l?c?c-l:-1:1}(e,t)));return{greatestNotificationLevel:r,rooms:s}}(i,t,n))}),[i,t,n]),d=(0,o.useCallback)((0,c.throttle)(l,Zn,{leading:!1,trailing:!0}),[l]);return(0,Pe.ml)(i,s.ClientEvent.Sync,d),(0,Pe.ml)(i,s.MatrixEventEvent.Decrypted,d),(0,o.useEffect)((()=>{e&&l()}),[l,e]),r}var ei=n("./node_modules/matrix-react-sdk/src/components/views/rooms/NotificationBadge/StatelessNotificationBadge.tsx");const ti=["threadsActivityCentre","newRoomHeader"];class ni extends s.TypedEventEmitter{static get instance(){return ni.internalInstance||(ni.internalInstance=new ni),ni.internalInstance}constructor(){super(),(0,r.A)(this,"index",0),O.A.watchSetting("releaseAnnouncementData",null,(()=>{this.emit("releaseAnnouncementChanged",this.getReleaseAnnouncement())}))}getViewedReleaseAnnouncements(){return(0,c.cloneDeep)(O.A.getValue("releaseAnnouncementData"))}isReleaseAnnouncementEnabled(){return O.A.getValue(Ln.O5.ReleaseAnnouncement)}getReleaseAnnouncement(){if(!this.isReleaseAnnouncementEnabled())return null;const e=this.getViewedReleaseAnnouncements();for(let t=this.index;t<ti.length;t++)if(!e[ti[t]])return this.index=t,ti[this.index];return null}async markReleaseAnnouncementAsViewed(){if(!this.isReleaseAnnouncementEnabled())return;const e=this.getViewedReleaseAnnouncements();if(!ti[this.index])return;e[ti[this.index]]=!0,this.index++;if(!O.A.isLevelSupported(re.p.ACCOUNT))return;if(O.A.canSetValue("releaseAnnouncementData",null,re.p.ACCOUNT))try{await O.A.setValue("releaseAnnouncementData",null,re.p.ACCOUNT,e)}catch(e){l.v.log("Failed to set release announcement settings",e)}}async nextReleaseAnnouncement(){await this.markReleaseAnnouncementAsViewed(),this.emit("releaseAnnouncementChanged",this.getReleaseAnnouncement())}}function ii(e){const t=function(){const[e,t]=(0,o.useState)(!1);return(0,Pe.YK)(f.Ay,f.XM.Opened,(()=>t(!0))),(0,Pe.YK)(f.Ay,f.XM.Closed,(()=>!f.Ay.hasDialogs()&&t(!1))),e}(),n=(0,Pe.DY)(ni.instance,"releaseAnnouncementChanged",(()=>ni.instance.getReleaseAnnouncement()===e));return!t&&n}(0,r.A)(ni,"internalInstance",void 0);const ri=["feature","children"];function oi(e){let{feature:t,children:n}=e,r=(0,Ue.A)(e,ri);const s=ii(t);return o.createElement(ke.lU,(0,i.A)({open:s,onClick:()=>ni.instance.nextReleaseAnnouncement()},r),n)}function si({displayButtonLabel:e}){const[t,n]=(0,o.useState)(!1),i=Xn(t),r=ii("threadsActivityCentre"),s=(0,Ne.ti)("Notifications.tac_only_notifications")?(0,C._t)("threads_activity_centre|no_rooms_with_threads_notifs"):(0,C._t)("threads_activity_centre|no_rooms_with_unread_threads");return o.createElement("div",{className:"mx_ThreadsActivityCentre_container",onKeyDown:e=>{if(!t)return;(0,Se.zM)().getNavigationAction(e)===Ee.bY.FilterRooms&&e.stopPropagation()}},r?o.createElement(oi,{feature:"threadsActivityCentre",header:(0,C._t)("threads_activity_centre|release_announcement_header"),description:(0,C._t)("threads_activity_centre|release_announcement_description"),closeLabel:(0,C._t)("action|ok")},o.createElement(Kn,{disableTooltip:!0,displayLabel:e,notificationLevel:i.greatestNotificationLevel,onClick:async()=>{n(!0),await ni.instance.nextReleaseAnnouncement()}})):o.createElement(ke.W1,{align:"start",side:"top",open:t,onOpenChange:e=>{e&&u.A.trackInteraction("WebThreadsActivityCentreButton"),n(e)},title:(0,C._t)("threads_activity_centre|header"),trigger:o.createElement(Kn,{displayLabel:e,notificationLevel:i.greatestNotificationLevel})},o.createElement("div",{className:"mx_ThreadsActivityCentre_rows"},i.rooms.map((({room:e,notificationLevel:t})=>o.createElement(ai,{key:e.roomId,room:e,notificationLevel:t,onClick:()=>n(!1)}))),0===i.rooms.length&&o.createElement("div",{className:"mx_ThreadsActivityCentre_emptyCaption"},s))))}function ai({room:e,onClick:t,notificationLevel:n}){return o.createElement(ke.Dr,{className:"mx_ThreadsActivityCentreRow",onSelect:n=>{t(),qn.A.instance.setCard({phase:$n.n.ThreadPanel},!0,e.roomId),u.A.trackInteraction("WebThreadsActivityCentreRoomItem",n),v.Ay.dispatch({action:x.r.ViewRoom,show_room_tile:!0,room_id:e.roomId,metricsTrigger:"WebThreadsActivityCentre",focusNext:"threadsPanel"})},label:e.name,Icon:o.createElement(Jn.A,{room:e,size:"32px"})},o.createElement(ei.V,{level:n,count:0,symbol:null,forceDot:!0}))}var li=n("./node_modules/matrix-react-sdk/src/accessibility/LandmarkNavigation.ts"),ci=n("./node_modules/matrix-react-sdk/src/components/views/settings/KeyboardShortcut.tsx");const di=["onFinished","hideHeader"],ui=["selected","isPanelCollapsed","size"],mi=["children","isPanelCollapsed","setPanelCollapsed","isDraggingOver","innerRef"],hi=e=>{let{onFinished:t,hideHeader:n}=e,r=(0,Ue.A)(e,di);const s=(0,Ne.ti)("Spaces.allRoomsInHome");return o.createElement(Le.Ay,(0,i.A)({},r,{onFinished:t,className:"mx_SpacePanel_contextMenu",compact:!0}),!n&&o.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},(0,C._t)("common|home")),o.createElement(Le.tx,{first:!0},o.createElement(Le.LS,{iconClassName:"mx_SpacePanel_noIcon",label:(0,C._t)("settings|sidebar|metaspaces_home_all_rooms"),active:s,onClick:()=>{t(),O.A.setValue("Spaces.allRoomsInHome",null,re.p.ACCOUNT,!s)}})))},pi=e=>{let{selected:t,isPanelCollapsed:n,size:r="32px"}=e,s=(0,Ue.A)(e,ui);return o.createElement("li",{className:ee()("mx_SpaceItem",{collapsed:n}),role:"treeitem","aria-selected":t},o.createElement(nt,(0,i.A)({},s,{selected:t,isNarrow:n,size:r})))},gi=()=>xe.Ay.instance.allRoomsInHome?st.n.instance.globalState:xe.Ay.instance.getNotificationState(Ae._b.Home),vi=({isPanelCollapsed:e,setPanelCollapsed:t})=>{const[n,i,r,s]=(0,Me.EF)();let a;(0,o.useEffect)((()=>{!e&&n&&s()}),[e]),n&&(a=o.createElement(ze.Ay,{onFinished:s}));const l=n?s:()=>{e||t(!0),r()};return o.createElement("li",{className:ee()("mx_SpaceItem mx_SpaceItem_new",{collapsed:e}),role:"treeitem","aria-selected":!1},o.createElement(nt,{className:ee()("mx_SpaceButton_new",{mx_SpaceButton_newCancel:n}),label:n?(0,C._t)("action|cancel"):(0,C._t)("create_space|label"),onClick:l,isNarrow:e,innerRef:i,size:"32px"}),a)},_i={[Ae._b.Home]:({selected:e,isPanelCollapsed:t})=>{const n=(0,Pe.dF)(xe.Ay.instance,Ae.EC,(()=>xe.Ay.instance.allRoomsInHome)),[i,r]=(0,o.useState)(gi()),s=(0,o.useCallback)((()=>{r(gi())}),[]);return(0,o.useEffect)(s,[s,n]),(0,Pe.ml)(st.n.instance,st.N,s),o.createElement(pi,{spaceKey:Ae._b.Home,className:"mx_SpaceButton_home",selected:e,isPanelCollapsed:t,label:(0,Ae.Ff)(Ae._b.Home,n),notificationState:i,ContextMenuComponent:hi,contextMenuTooltip:(0,C._t)("common|options"),size:"32px"})},[Ae._b.Favourites]:({selected:e,isPanelCollapsed:t})=>o.createElement(pi,{spaceKey:Ae._b.Favourites,className:"mx_SpaceButton_favourites",selected:e,isPanelCollapsed:t,label:(0,Ae.Ff)(Ae._b.Favourites),notificationState:xe.Ay.instance.getNotificationState(Ae._b.Favourites),size:"32px"}),[Ae._b.People]:({selected:e,isPanelCollapsed:t})=>o.createElement(pi,{spaceKey:Ae._b.People,className:"mx_SpaceButton_people",selected:e,isPanelCollapsed:t,label:(0,Ae.Ff)(Ae._b.People),notificationState:xe.Ay.instance.getNotificationState(Ae._b.People),size:"32px"}),[Ae._b.Orphans]:({selected:e,isPanelCollapsed:t})=>o.createElement(pi,{spaceKey:Ae._b.Orphans,className:"mx_SpaceButton_orphans",selected:e,isPanelCollapsed:t,label:(0,Ae.Ff)(Ae._b.Orphans),notificationState:xe.Ay.instance.getNotificationState(Ae._b.Orphans),size:"32px"}),[Ae._b.VideoRooms]:({selected:e,isPanelCollapsed:t})=>o.createElement(pi,{spaceKey:Ae._b.VideoRooms,className:"mx_SpaceButton_videoRooms",selected:e,isPanelCollapsed:t,label:(0,Ae.Ff)(Ae._b.VideoRooms),notificationState:xe.Ay.instance.getNotificationState(Ae._b.VideoRooms),size:"32px"})},fi=o.memo((e=>{let{children:t,isPanelCollapsed:n,setPanelCollapsed:r,isDraggingOver:s,innerRef:a}=e,l=(0,Ue.A)(e,mi);const[c,d,u,m]=(()=>{const e=(0,Pe.dF)(xe.Ay.instance,Ae.kQ,(()=>xe.Ay.instance.invitedSpaces)),[t,n]=(0,Pe.dF)(xe.Ay.instance,Ae.bZ,(()=>[xe.Ay.instance.enabledMetaSpaces,xe.Ay.instance.spacePanelSpaces]));return[e,t,n,(0,Pe.dF)(xe.Ay.instance,Ae.tw,(()=>xe.Ay.instance.activeSpace))]})(),h=m?[m]:[],p=d.filter((e=>!(e===Ae._b.VideoRooms&&!O.A.getValue("feature_video_rooms")))).map((e=>{const t=_i[e];return o.createElement(t,{key:e,selected:m===e,isPanelCollapsed:n})}));return o.createElement(Hn,(0,i.A)({},l,{wrappedRef:a,className:"mx_SpaceTreeLevel",style:s?{pointerEvents:"none"}:void 0,element:"ul",role:"tree","aria-label":(0,C._t)("common|spaces")}),p,c.map((e=>o.createElement(it,{key:e.roomId,space:e,activeSpaces:h,isPanelCollapsed:n,onExpand:()=>r(!1)}))),u.map(((e,t)=>o.createElement(He.sx,{key:e.roomId,draggableId:e.roomId,index:t},((t,s)=>o.createElement(it,(0,i.A)({},t.draggableProps,{dragHandleProps:t.dragHandleProps,key:e.roomId,innerRef:t.innerRef,className:s.isDragging?"mx_SpaceItem_dragging":void 0,space:e,activeSpaces:h,isPanelCollapsed:n,onExpand:()=>r(!1)})))))),t,(0,Ie.g)(W.C.CreateSpaces)&&o.createElement(vi,{isPanelCollapsed:n,setPanelCollapsed:r}))})),yi=()=>{const[e,t]=(0,o.useState)(!1),[n,r]=(0,o.useState)(!0),s=(0,o.useRef)(null);return(0,o.useLayoutEffect)((()=>(s.current&&Ce.A.instance.trackElementDimensions("SpacePanel",s.current),()=>Ce.A.instance.stopTrackingElementDimensions("SpacePanel"))),[]),(0,Te.F)(v.Ay,(e=>{e.action===x.r.ToggleSpacePanel&&r(!n)})),o.createElement(Ze.Se,{handleHomeEnd:!0,handleUpDown:!e},(({onKeyDownHandler:e,onDragEndHandler:a})=>o.createElement(He.JY,{onDragStart:()=>{t(!0)},onDragEnd:e=>{t(!1),e.destination&&(xe.Ay.instance.moveRootSpace(e.source.index,e.destination.index),a())}},o.createElement("nav",{className:ee()("mx_SpacePanel",{collapsed:n}),onKeyDown:t=>{const n=(0,Se.zM)().getNavigationAction(t);if(n===Ee.bY.NextLandmark||n===Ee.bY.PreviousLandmark)return li.r.findAndFocusNextLandmark(li.H.ACTIVE_SPACE_BUTTON,n===Ee.bY.PreviousLandmark),t.stopPropagation(),void t.preventDefault();e(t)},ref:s,"aria-label":(0,C._t)("common|spaces")},o.createElement(jn,{isPanelCollapsed:n},o.createElement(be.A,{className:ee()("mx_SpacePanel_toggleCollapse",{expanded:!n}),onClick:()=>r(!n),title:n?(0,C._t)("action|expand"):(0,C._t)("action|collapse"),caption:o.createElement(ci.S,{value:{ctrlOrCmdKey:!0,shiftKey:!0,key:"d"},className:"mx_SpacePanel_Tooltip_KeyboardShortcut"})})),o.createElement(He.gL,{droppableId:"top-level-spaces"},((e,t)=>o.createElement(fi,(0,i.A)({},e.droppableProps,{isPanelCollapsed:n,setPanelCollapsed:r,isDraggingOver:t.isDraggingOver,innerRef:e.innerRef}),e.placeholder))),o.createElement(si,{displayButtonLabel:!n}),o.createElement(en,{isPanelCollapsed:n})))))},Ei=e=>({left:e.left+window.scrollX,top:e.bottom+window.scrollY+12,chevronFace:Me.t4.None});var bi=function(e){return e[e.JoinRoom=0]="JoinRoom",e[e.BulkRedact=1]="BulkRedact",e}(bi||{});const wi=({onVisibilityChange:e})=>{var t;const n=(0,o.useContext)(Re.Ay),[r,a,l,c]=(0,Me.EF)(),[d,m,h,p]=(0,Me.EF)(),[g,_]=(0,Pe.dF)(xe.Ay.instance,Ae.tw,(()=>[xe.Ay.instance.activeSpace,xe.Ay.instance.activeSpaceRoom])),f=(0,Pe.dF)(xe.Ay.instance,Ae.EC,(()=>xe.Ay.instance.allRoomsInHome)),y=(0,Ne.ny)("feature_video_rooms"),E=(0,Ne.ny)("feature_element_call_video_rooms"),b=(()=>{const e=(0,o.useContext)(Re.Ay),[t,n]=(0,o.useState)(new Map),i=(e,i)=>{const r=new Set(t.get(e));r.add(i),n(new Map(t).set(e,r))},r=(e,i)=>{const r=new Set(t.get(e));r.delete(i)&&n(new Map(t).set(e,r))};return(0,Te.F)(v.Ay,(e=>{switch(e.action){case x.r.JoinRoom:i(bi.JoinRoom,e.roomId);break;case x.r.JoinRoomReady:case x.r.JoinRoomError:r(bi.JoinRoom,e.roomId);break;case x.r.BulkRedactStart:i(bi.BulkRedact,e.roomId);break;case x.r.BulkRedactEnd:r(bi.BulkRedact,e.roomId)}})),(0,Pe.YK)(e,s.ClientEvent.Room,(e=>r(bi.JoinRoom,e.roomId))),t})(),w=_||g===Ae._b.Home;(0,o.useEffect)((()=>{r&&!w&&c()}),[c,w,r]);const A=(0,Pe.DY)(null!=_?_:void 0,s.RoomEvent.Name,(()=>null==_?void 0:_.name));(0,o.useEffect)((()=>{null==e||e()}),[e]);const S=(0,Ie.g)(W.C.ExploreRooms),k=(0,Ie.g)(W.C.CreateRooms),R=(0,Ie.g)(W.C.CreateSpaces),I=null==_||null===(t=_.currentState)||void 0===t?void 0:t.maySendStateEvent(s.EventType.SpaceChild,n.getUserId()),T=I&&k,P=I&&R,N=k||S||R||_;let D,M;if(r&&a.current){let e;e=_?Be:hi,D=o.createElement(e,(0,i.A)({},Ei(a.current.getBoundingClientRect()),{space:_,onFinished:c,hideHeader:!0}))}else if(d&&_){let e,t;(0,De.MI)(_)&&(e=o.createElement(Le.R$,{label:(0,C._t)("action|invite"),iconClassName:"mx_RoomListHeader_iconInvite",onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,De.Lo)(_),p()}})),null!=_&&_.currentState.maySendStateEvent(s.EventType.RoomAvatar,n.getUserId())&&(t=o.createElement(o.Fragment,null,o.createElement(Le.R$,{iconClassName:"mx_RoomListHeader_iconNewRoom",label:(0,C._t)("action|new_room"),onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,De.PT)(_),u.A.trackInteraction("WebRoomListHeaderPlusMenuCreateRoomItem",e),p()}}),y&&o.createElement(Le.R$,{iconClassName:"mx_RoomListHeader_iconNewVideoRoom",label:(0,C._t)("action|new_video_room"),onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,De.PT)(_,E?s.RoomType.UnstableCall:s.RoomType.ElementVideo),p()}},o.createElement(Oe.s,null)))),D=o.createElement(Le.Ay,(0,i.A)({},Ei(m.current.getBoundingClientRect()),{onFinished:p,compact:!0}),o.createElement(Le.tx,{first:!0},e,t,o.createElement(Le.R$,{label:(0,C._t)("action|explore_rooms"),iconClassName:"mx_RoomListHeader_iconExplore",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:x.r.ViewRoom,room_id:_.roomId,metricsTrigger:void 0}),p(),u.A.trackInteraction("WebRoomListHeaderPlusMenuExploreRoomsItem",e)}}),o.createElement(Le.R$,{label:(0,C._t)("action|add_existing_room"),iconClassName:"mx_RoomListHeader_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,De.yV)(_),p()},disabled:!T,title:T?void 0:(0,C._t)("spaces|error_no_permission_add_room")}),R&&o.createElement(Le.R$,{label:(0,C._t)("room_list|add_space_label"),iconClassName:"mx_RoomListHeader_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),(0,De.Sl)(_),p()},disabled:!P,title:P?void 0:(0,C._t)("spaces|error_no_permission_add_space")},o.createElement(Oe.s,null))))}else if(d){let e,t;k&&(e=o.createElement(o.Fragment,null,o.createElement(Le.R$,{label:(0,C._t)("action|start_new_chat"),iconClassName:"mx_RoomListHeader_iconStartChat",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"view_create_chat"}),u.A.trackInteraction("WebRoomListHeaderPlusMenuCreateChatItem",e),p()}}),o.createElement(Le.R$,{label:(0,C._t)("action|new_room"),iconClassName:"mx_RoomListHeader_iconNewRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"view_create_room"}),u.A.trackInteraction("WebRoomListHeaderPlusMenuCreateRoomItem",e),p()}}),y&&o.createElement(Le.R$,{label:(0,C._t)("action|new_video_room"),iconClassName:"mx_RoomListHeader_iconNewVideoRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"view_create_room",type:E?s.RoomType.UnstableCall:s.RoomType.ElementVideo}),p()}},o.createElement(Oe.s,null)))),S&&(t=o.createElement(Le.R$,{label:(0,C._t)("room_list|join_public_room_label"),iconClassName:"mx_RoomListHeader_iconExplore",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:x.r.ViewRoomDirectory}),u.A.trackInteraction("WebRoomListHeaderPlusMenuExploreRoomsItem",e),p()}})),D=o.createElement(Le.Ay,(0,i.A)({},Ei(m.current.getBoundingClientRect()),{onFinished:p,compact:!0}),o.createElement(Le.tx,{first:!0},e,t))}M=_&&A?A:(0,Ae.Ff)(g,f);const O=[...b.entries()].filter((([e,t])=>t.size>0)).map((([e,t])=>{switch(e){case bi.JoinRoom:return(0,C._t)("room_list|joining_rooms_status",{count:t.size});case bi.BulkRedact:return(0,C._t)("room_list|redacting_messages_status",{count:t.size})}})).join("\n");let L=o.createElement("div",{className:"mx_RoomListHeader_contextLessTitle"},M);if(w){const e={ref:a,onClick:l,isExpanded:r,className:"mx_RoomListHeader_contextMenuButton",children:M};L=_?o.createElement(Me.VJ,(0,i.A)({},e,{label:(0,C._t)("room_list|space_menu_label",{spaceName:null!=A?A:_.name})})):o.createElement(Me.oW,(0,i.A)({},e,{title:(0,C._t)("room_list|home_menu_label")}))}return o.createElement("aside",{className:"mx_RoomListHeader","aria-label":(0,C._t)("room|context_menu|title")},L,O?o.createElement(ke.m_,{label:O,isTriggerInteractive:!1},o.createElement(Ve.A,null)):null,N&&o.createElement(Me.oW,{ref:m,onClick:h,isExpanded:d,className:"mx_RoomListHeader_plusButton",title:(0,C._t)("action|add")}),D)};var xi=n("./node_modules/matrix-react-sdk/src/stores/BreadcrumbsStore.ts"),Ai=n("./node_modules/matrix-react-sdk/src/stores/room-list/RoomListStore.ts"),Si=n("./node_modules/react-transition-group/cjs/index.js"),Ci=n("./node_modules/matrix-react-sdk/src/accessibility/Toolbar.tsx");const ki=({room:e,onClick:t})=>{const[n,i,r]=(0,Ze.A9)();return o.createElement(be.A,{className:"mx_RoomBreadcrumbs_crumb",onClick:t,"aria-label":(0,C._t)("a11y|room_name",{name:e.name}),title:e.name,onFocus:n,ref:r,tabIndex:i?0:-1,placement:"right"},o.createElement(Jn.A,{room:e,size:"32px",displayBadge:!0,hideIfDot:!0,tooltipProps:{tabIndex:i?0:-1}}))};class Ri extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"isMounted",!0),(0,r.A)(this,"onBreadcrumbsUpdate",(()=>{this.isMounted&&(this.setState({doAnimation:!1,skipFirst:!0}),window.setTimeout((()=>this.setState({doAnimation:!0,skipFirst:!1})),0))})),(0,r.A)(this,"viewRoom",((e,t,n=!1)=>{v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.roomId,metricsTrigger:"WebHorizontalBreadcrumbs",metricsViaKeyboard:n})})),this.state={doAnimation:!0,skipFirst:!1},xi.Y.instance.on(A.H,this.onBreadcrumbsUpdate)}componentWillUnmount(){this.isMounted=!1,xi.Y.instance.off(A.H,this.onBreadcrumbsUpdate)}render(){const e=xi.Y.instance.rooms.map(((e,t)=>o.createElement(ki,{key:e.roomId,room:e,onClick:n=>this.viewRoom(e,t,"click"!==n.type)})));return e.length>0?o.createElement(Si.B1,{appear:!0,in:this.state.doAnimation,timeout:640,classNames:"mx_RoomBreadcrumbs"},o.createElement(Ci.A,{className:"mx_RoomBreadcrumbs","aria-label":(0,C._t)("room_list|breadcrumbs_label")},e.slice(this.state.skipFirst?1:0))):o.createElement("div",{className:"mx_RoomBreadcrumbs"},o.createElement("div",{className:"mx_RoomBreadcrumbs_placeholder"},(0,C._t)("room_list|breadcrumbs_empty")))}}var Ii=n("./node_modules/matrix-react-sdk/src/components/views/typography/Heading.tsx");var Ti=n("./node_modules/matrix-react-sdk/src/utils/DMRoomMap.ts");const Pi=5e3;function Ni(e,t){const[n,i]=(0,o.useState)(e),r=(0,Re.nH)(),a=function(e){const t=(0,o.useRef)(e);return t.current=e,(0,o.useCallback)(((...e)=>t.current(...e)),[])}(t);return(0,o.useEffect)((()=>{if(n)return;let e=null,t=!0;const o=async()=>{null!==e&&(clearTimeout(e),e=null),i(await a(r)),t&&(e=window.setTimeout(o,Pi))};return o().catch((e=>l.v.warn("could not update user onboarding context",e))),r.on(s.ClientEvent.AccountData,o),()=>{t=!1,r.off(s.ClientEvent.AccountData,o),null!==e&&(clearTimeout(e),e=null)}}),[r,a,n]),n}function Di(){const e=Ni(!1,(async e=>{const t=await e.getProfileInfo(e.getUserId());return Boolean(null==t?void 0:t.avatar_url)})),t=Ni(!1,(async e=>{const t=e.getDeviceId(),n=await e.getDevices();return Boolean(n.devices.find((e=>e.device_id!==t)))})),n=Ni(!1,(async()=>{var e;const t=null!==(e=Ti.A.shared().getUniqueRoomsWithIndividuals())&&void 0!==e?e:{};return Boolean(Object.keys(t).length)})),i=function(){const[e,t]=(0,o.useState)(_.Notifier.shouldShowPrompt());(0,Pe.ml)(_.Notifier,_.NotifierEvent.NotificationHiddenChange,(()=>{t(_.Notifier.shouldShowPrompt())}));const n=(0,Ne.ti)("notificationsEnabled");return(0,o.useEffect)((()=>{t(_.Notifier.shouldShowPrompt())}),[n]),e}();return(0,o.useMemo)((()=>({hasAvatar:e,hasDevices:t,hasDmRooms:n,showNotificationsPrompt:i})),[e,t,n,i])}var Mi,Oi,Li,Ui,Fi,ji,Bi,Vi,Hi,zi,Wi,Gi,Ki,Ji,qi,$i,Yi,Qi,Zi,Xi,er,tr,nr,ir,rr,or,sr;function ar(){return ar=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ar.apply(null,arguments)}var lr=function(e,t){return o.createElement("svg",ar({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 564 168",role:"presentation","aria-hidden":!0,ref:t},e),Mi||(Mi=o.createElement("defs",null,o.createElement("radialGradient",{id:"f-droid_svg__a",cx:113,cy:-12.89,r:59.662,gradientTransform:"matrix(0 1.9611 -1.9778 0 5.51 -198.6)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#fff",stopOpacity:.098}),o.createElement("stop",{offset:1,stopColor:"#fff",stopOpacity:0})))),Oi||(Oi=o.createElement("path",{stroke:"#a6a6a6",strokeWidth:4,d:"M22 2h520c11.08 0 20 8.92 20 20v124c0 11.08-8.92 20-20 20H22c-11.08 0-20-8.92-20-20V22C2 10.92 10.92 2 22 2z"})),Li||(Li=o.createElement("path",{fill:"#fff",d:"M199.26 45.46v-6.682h-5.499v-2.766h8.831v10.681q-1.949 1.383-4.299 2.1-2.349.7-5.015.7-5.832 0-9.131-3.4-3.283-3.415-3.283-9.497 0-6.099 3.283-9.498 3.3-3.416 9.131-3.416 2.433 0 4.616.6 2.2.6 4.049 1.766v3.583q-1.867-1.583-3.966-2.383t-4.416-.8q-4.565 0-6.865 2.55-2.283 2.549-2.283 7.598 0 5.032 2.283 7.581 2.3 2.55 6.865 2.55 1.783 0 3.183-.3 1.4-.317 2.516-.967m9.48-21.33h15.729v2.833h-12.364v7.365h11.847v2.832h-11.847v9.015h12.664v2.832H208.74zm18.12 0h21.045v2.833h-8.831v22.045h-3.383V26.963h-8.83zm35.14 0h3.366v24.877H262zm6.61 0h21.045v2.833h-8.831v22.045h-3.383V26.963h-8.83zm45.24 2.28q-3.666 0-5.832 2.733-2.15 2.732-2.15 7.448 0 4.699 2.15 7.431 2.166 2.733 5.832 2.733t5.799-2.733q2.15-2.732 2.15-7.431 0-4.716-2.15-7.448-2.133-2.733-5.799-2.733m0-2.733q5.232 0 8.365 3.516 3.132 3.5 3.132 9.398 0 5.882-3.132 9.397-3.133 3.5-8.365 3.5-5.249 0-8.398-3.5-3.132-3.499-3.132-9.397t3.132-9.398q3.15-3.516 8.398-3.516m16.76.453h4.532l11.031 20.812V24.13h3.266v24.877h-4.532l-11.031-20.812v20.812h-3.266z","aria-label":"GET IT ON"})),Ui||(Ui=o.createElement("path",{fill:"#fff",d:"M180.81 136v-8.118l7.19-1.391V78.017l-7.19-1.392v-8.164h53.762v18.508h-10.391l-.603-8.071h-22.034v18.6h23.657v10.438h-23.657v18.555l7.236 1.391V136zm62.16-23.66v-10.437h26.162v10.437zM277.29 136v-8.118l7.283-1.53v-48.15l-7.283-1.577v-8.164h29.641q9.045 0 15.957 4.268 6.912 4.221 10.762 11.736 3.897 7.468 3.897 17.163v1.252q0 9.602-3.85 17.117-3.804 7.468-10.67 11.736t-15.91 4.268zm20.828-10.344h8.303q5.613 0 9.51-2.922 3.896-2.97 5.937-8.118 2.087-5.149 2.087-11.736v-1.299q0-6.68-2.087-11.782-2.041-5.149-5.938-8.025-3.896-2.922-9.509-2.922h-8.303zM344.79 136v-8.118l6.494-1.391V95.366l-7.19-1.392V85.81h19.807l.51 6.216.093 1.113q1.856-4.082 4.593-6.17t6.54-2.087q1.206 0 2.644.232 1.438.186 2.551.51l-1.438 12.478-6.726-.37q-2.876-.14-4.685.974-1.763 1.113-3.154 3.2v24.585l6.494 1.392V136zm63.08.98q-7.422 0-12.756-3.247t-8.164-9q-2.83-5.797-2.83-13.312v-.974q0-7.469 2.83-13.22 2.83-5.799 8.118-9.046 5.334-3.293 12.71-3.293 7.468 0 12.756 3.293 5.288 3.247 8.117 9t2.83 13.266v.974q0 7.515-2.83 13.313-2.83 5.752-8.117 9-5.289 3.247-12.664 3.247zm0-10.391q3.525 0 5.752-1.902t3.293-5.288q1.067-3.433 1.067-7.979v-.974q0-4.453-1.067-7.839-1.066-3.433-3.34-5.335-2.226-1.948-5.798-1.948-3.479 0-5.752 1.948-2.273 1.902-3.34 5.335-1.02 3.386-1.02 7.84v.973q0 4.546 1.02 7.979 1.067 3.433 3.34 5.334 2.273 1.856 5.845 1.856M437.1 136v-8.118l6.54-1.391V95.366l-7.236-1.392V85.81h20.781v40.681l6.494 1.392V136zm6.077-60.813v-11.55h14.009v11.55zm44.293 61.793q-5.984 0-10.298-3.062-4.268-3.107-6.54-8.627-2.273-5.567-2.273-12.988v-.975q0-7.932 2.273-13.87 2.319-5.937 6.586-9.23 4.268-3.34 10.205-3.34 4.129 0 7.237 1.67 3.108 1.623 5.38 4.638V73.198l-7.236-1.391v-8.164h20.781v62.854l6.494 1.391v8.118h-18.23l-1.02-6.123q-2.366 3.479-5.66 5.288-3.246 1.81-7.7 1.81zm4.036-10.53q2.83 0 4.963-1.206t3.572-3.479v-21.292q-1.392-2.412-3.526-3.71-2.133-1.346-4.917-1.346-3.386 0-5.566 2.04-2.134 1.995-3.154 5.567-.974 3.572-.974 8.303v.975q0 6.587 2.226 10.39 2.227 3.758 7.376 3.758","aria-label":"F-Droid"})),Fi||(Fi=o.createElement("path",{fill:"#8ab000",stroke:"#769616",strokeLinecap:"round",strokeWidth:6.579,d:"m146.34 25.898-11.184 14.474"})),ji||(ji=o.createElement("path",{fill:"#fff",fillOpacity:.298,d:"M146.29 22.477c1.192.032 2.003.497 2.579 1.182-5.332 6.34-6.232 7.344-13.513 16.37-2.684 3.472-5.479 1.677-2.795-1.794l11.184-14.474a3.26 3.26 0 0 1 2.545-1.284",color:"#000"})),Bi||(Bi=o.createElement("path",{fill:"#263238",fillOpacity:.2,d:"M148.89 23.793a3.29 3.29 0 0 1 .058 4.095l-11.184 14.474c-2.684 3.474-3.026-1.61-3.026-1.61s9.829-11.87 14.153-16.959z",color:"#000"})),Vi||(Vi=o.createElement("path",{fill:"#8ab000",d:"M147 23.003c1.153 0 2.526.374 2.168 2.103-.27 1.318-12.263 15.984-12.263 15.984-2.684 3.47-6.563 1.779-3.879-1.693l11.142-14.4c.685-.763 1.603-1.957 2.832-1.994",color:"#000"})),Hi||(Hi=o.createElement("path",{fill:"#8ab000",stroke:"#769616",strokeLinecap:"round",strokeWidth:6.579,d:"m33.653 25.898 11.184 14.474"})),zi||(zi=o.createElement("path",{fill:"#fff",fillOpacity:.298,d:"M33.711 22.477c-1.192.032-2.003.497-2.579 1.182 5.332 6.34 6.232 7.344 13.513 16.37 2.684 3.472 5.479 1.677 2.795-1.794L36.256 23.76a3.26 3.26 0 0 0-2.545-1.284z",color:"#000"})),Wi||(Wi=o.createElement("path",{fill:"#263238",fillOpacity:.2,d:"M31.108 23.793a3.29 3.29 0 0 0-.058 4.095l11.184 14.474c2.684 3.474 3.026-1.61 3.026-1.61s-9.829-11.87-14.153-16.959z",color:"#000"})),Gi||(Gi=o.createElement("path",{fill:"#8ab000",d:"M32.993 23.003c-1.153 0-2.526.374-2.168 2.103.27 1.318 12.263 15.984 12.263 15.984 2.684 3.47 6.563 1.779 3.879-1.693l-11.142-14.4c-.685-.763-1.603-1.957-2.832-1.994",color:"#000"})),Ki||(Ki=o.createElement("path",{fill:"#aeea00",d:"M47.893 35.109h84.211a7.88 7.88 0 0 1 7.895 7.894v18.211a7.88 7.88 0 0 1-7.895 7.895H47.893a7.88 7.88 0 0 1-7.895-7.895v-18.21a7.88 7.88 0 0 1 7.895-7.895"})),Ji||(Ji=o.createElement("path",{fill:"#263238",fillOpacity:.2,d:"M47.893 42.74h84.211a7.88 7.88 0 0 1 7.895 7.895v10.526a7.88 7.88 0 0 1-7.895 7.895H47.893a7.88 7.88 0 0 1-7.895-7.895V50.635a7.88 7.88 0 0 1 7.895-7.895"})),qi||(qi=o.createElement("path",{fill:"#fff",fillOpacity:.298,d:"M47.893 35.109h84.211a7.88 7.88 0 0 1 7.895 7.894V53.53a7.88 7.88 0 0 1-7.895 7.895H47.893a7.88 7.88 0 0 1-7.895-7.895V43.003a7.88 7.88 0 0 1 7.895-7.894"})),$i||($i=o.createElement("path",{fill:"#aeea00",d:"M47.893 38.003h84.211c4.374 0 7.895 2.883 7.895 6.462v15.079c0 3.58-3.521 6.462-7.895 6.462H47.893c-4.374 0-7.895-2.882-7.895-6.462V44.465c0-3.58 3.521-6.462 7.895-6.462"})),Yi||(Yi=o.createElement("path",{fill:"#1976d2",d:"M47.893 71.944h84.211a7.88 7.88 0 0 1 7.895 7.895v52.211a7.88 7.88 0 0 1-7.895 7.895H47.893a7.88 7.88 0 0 1-7.895-7.895V79.839a7.88 7.88 0 0 1 7.895-7.895"})),Qi||(Qi=o.createElement("path",{fill:"#263238",fillOpacity:.2,d:"M47.893 105.89h84.211a7.88 7.88 0 0 1 7.895 7.895v18.42a7.88 7.88 0 0 1-7.895 7.896H47.893a7.88 7.88 0 0 1-7.895-7.895v-18.421a7.88 7.88 0 0 1 7.895-7.895"})),Zi||(Zi=o.createElement("path",{fill:"#fff",fillOpacity:.2,d:"M47.893 71.681h84.211a7.88 7.88 0 0 1 7.895 7.895v18.421a7.88 7.88 0 0 1-7.895 7.895H47.893a7.88 7.88 0 0 1-7.895-7.895V79.576a7.88 7.88 0 0 1 7.895-7.895"})),Xi||(Xi=o.createElement("path",{fill:"#1976d2",d:"M47.893 75.102h84.211c4.374 0 7.895 3.19 7.895 7.154v47.693c0 3.963-3.521 7.153-7.895 7.153H47.893c-4.374 0-7.895-3.19-7.895-7.153V82.256c0-3.963 3.521-7.154 7.895-7.154"})),er||(er=o.createElement("path",{fill:"#0d47a1",d:"M89.998 89.714c-7.579 0-14 5.224-15.876 12.237h8.455a8.46 8.46 0 0 1 7.421-4.342 8.495 8.495 0 0 1 8.553 8.553 8.495 8.495 0 0 1-8.553 8.552 8.47 8.47 0 0 1-7.71-4.868h-8.3c1.69 7.279 8.242 12.763 16.01 12.763 9.038 0 16.449-7.41 16.449-16.448s-7.41-16.448-16.448-16.448z",color:"#000"})),tr||(tr=o.createElement("path",{fill:"none",stroke:"#0d47a1",strokeLinecap:"round",strokeWidth:5,d:"M115.13 106.16a25.13 25.13 0 0 1-25.132 25.132 25.13 25.13 0 0 1-25.131-25.132 25.13 25.13 0 0 1 25.131-25.132 25.13 25.13 0 0 1 25.132 25.132z"})),nr||(nr=o.createElement("path",{fill:"#263238",fillOpacity:.2,d:"M73.55 52.477a8.882 10.197 0 0 1-8.88 10.198 8.882 10.197 0 0 1-8.882-10.198 8.882 10.197 0 0 1 8.881-10.197 8.882 10.197 0 0 1 8.882 10.197z"})),ir||(ir=o.createElement("path",{fill:"#fff",d:"M73.55 53.793a8.88 8.88 0 0 1-8.88 8.882 8.88 8.88 0 0 1-8.882-8.882 8.88 8.88 0 0 1 8.881-8.882 8.88 8.88 0 0 1 8.882 8.882z"})),rr||(rr=o.createElement("path",{fill:"#263238",fillOpacity:.2,d:"M124.87 52.477a8.882 10.197 0 0 1-8.882 10.198 8.882 10.197 0 0 1-8.881-10.198 8.882 10.197 0 0 1 8.881-10.197 8.882 10.197 0 0 1 8.882 10.197"})),or||(or=o.createElement("path",{fill:"#fff",d:"M124.87 53.793a8.88 8.88 0 0 1-8.882 8.882 8.88 8.88 0 0 1-8.881-8.882 8.88 8.88 0 0 1 8.881-8.882 8.88 8.88 0 0 1 8.882 8.882"})),sr||(sr=o.createElement("path",{fill:"url(#f-droid_svg__a)",fillRule:"evenodd",d:"M33.71 22.47a3.29 3.29 0 0 0-2.662 5.336l9.474 12.262a7.9 7.9 0 0 0-.527 2.824v18.211a7.877 7.877 0 0 0 7.895 7.895h84.21a7.877 7.877 0 0 0 7.895-7.895v-18.21c0-1-.19-1.95-.525-2.827l9.472-12.26a3.29 3.29 0 0 0-2.433-5.334 3.29 3.29 0 0 0-2.772 1.31l-9.013 11.666a7.9 7.9 0 0 0-2.623-.45H47.89c-.922 0-1.8.163-2.621.45l-9.016-11.666a3.29 3.29 0 0 0-2.543-1.312m14.18 49.527a7.877 7.877 0 0 0-7.894 7.894v52.211a7.877 7.877 0 0 0 7.894 7.895h84.211a7.877 7.877 0 0 0 7.894-7.895v-52.21a7.877 7.877 0 0 0-7.894-7.895z",color:"#000"})))},cr=(0,o.forwardRef)(lr);var dr,ur,mr,hr,pr,gr,vr,_r,fr,yr,Er,br,wr,xr,Ar,Sr,Cr,kr,Rr,Ir,Tr,Pr;function Nr(){return Nr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Nr.apply(null,arguments)}var Dr=function(e,t){return o.createElement("svg",Nr({xmlns:"http://www.w3.org/2000/svg",xmlSpace:"preserve",viewBox:"0 0 180 53.332",role:"presentation","aria-hidden":!0,ref:t},e),dr||(dr=o.createElement("defs",null,o.createElement("linearGradient",{id:"google-play_svg__a",x2:1,gradientTransform:"scale(-31.64 31.64)rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#00a0ff"}),o.createElement("stop",{offset:.007,stopColor:"#00a1ff"}),o.createElement("stop",{offset:.26,stopColor:"#00beff"}),o.createElement("stop",{offset:.512,stopColor:"#00d2ff"}),o.createElement("stop",{offset:.76,stopColor:"#00dfff"}),o.createElement("stop",{offset:1,stopColor:"#00e3ff"})),o.createElement("linearGradient",{id:"google-play_svg__b",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#ffe000"}),o.createElement("stop",{offset:.409,stopColor:"#ffbd00"}),o.createElement("stop",{offset:.775,stopColor:"orange"}),o.createElement("stop",{offset:1,stopColor:"#ff9c00"})),o.createElement("linearGradient",{id:"google-play_svg__c",x2:1,gradientTransform:"scale(-42.903 42.903)rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#ff3a44"}),o.createElement("stop",{offset:1,stopColor:"#c31162"})),o.createElement("linearGradient",{id:"google-play_svg__d",x2:1,gradientTransform:"scale(19.156 -19.156)rotate(-44.998 .238 -.62)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#32a071"}),o.createElement("stop",{offset:.069,stopColor:"#2da771"}),o.createElement("stop",{offset:.476,stopColor:"#15cf74"}),o.createElement("stop",{offset:.801,stopColor:"#06e775"}),o.createElement("stop",{offset:1,stopColor:"#00f076"})),o.createElement("linearGradient",{id:"google-play_svg__e",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#ccb300"}),o.createElement("stop",{offset:.409,stopColor:"#cc9700"}),o.createElement("stop",{offset:.775,stopColor:"#cc8400"}),o.createElement("stop",{offset:1,stopColor:"#cc7d00"})),o.createElement("linearGradient",{id:"google-play_svg__f",x2:1,gradientTransform:"scale(-42.903 42.903)rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#cc2e36"}),o.createElement("stop",{offset:1,stopColor:"#9c0e4e"})),o.createElement("linearGradient",{id:"google-play_svg__g",x2:1,gradientTransform:"scale(-31.64 31.64)rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#008de0"}),o.createElement("stop",{offset:.007,stopColor:"#008de0"}),o.createElement("stop",{offset:.26,stopColor:"#00a7e0"}),o.createElement("stop",{offset:.512,stopColor:"#00b8e0"}),o.createElement("stop",{offset:.76,stopColor:"#00c4e0"}),o.createElement("stop",{offset:1,stopColor:"#00c7e0"})),o.createElement("linearGradient",{id:"google-play_svg__h",x2:1,gradientTransform:"scale(-42.903 42.903)rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#e0333c"}),o.createElement("stop",{offset:1,stopColor:"#ab0f56"})),o.createElement("linearGradient",{id:"google-play_svg__i",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#e0c500"}),o.createElement("stop",{offset:.409,stopColor:"#e0a600"}),o.createElement("stop",{offset:.775,stopColor:"#e09100"}),o.createElement("stop",{offset:1,stopColor:"#e08900"})),o.createElement("linearGradient",{id:"google-play_svg__j",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#ffe840"}),o.createElement("stop",{offset:.409,stopColor:"#ffce40"}),o.createElement("stop",{offset:.775,stopColor:"#ffbc40"}),o.createElement("stop",{offset:1,stopColor:"#ffb540"})),o.createElement("linearGradient",{id:"google-play_svg__k",x2:1,gradientTransform:"scale(-31.64 31.64)rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#40b8ff"}),o.createElement("stop",{offset:.007,stopColor:"#40b9ff"}),o.createElement("stop",{offset:.26,stopColor:"#40ceff"}),o.createElement("stop",{offset:.512,stopColor:"#40ddff"}),o.createElement("stop",{offset:.76,stopColor:"#40e7ff"}),o.createElement("stop",{offset:1,stopColor:"#40eaff"})),o.createElement("linearGradient",{id:"google-play_svg__l",x2:1,gradientTransform:"scale(19.156 -19.156)rotate(-44.998 .238 -.62)",gradientUnits:"userSpaceOnUse"},o.createElement("stop",{offset:0,stopColor:"#65b895"}),o.createElement("stop",{offset:.069,stopColor:"#62bd95"}),o.createElement("stop",{offset:.476,stopColor:"#50db97"}),o.createElement("stop",{offset:.801,stopColor:"#44ed98"}),o.createElement("stop",{offset:1,stopColor:"#40f498"})))),ur||(ur=o.createElement("path",{d:"M173.33 53.332H6.67c-3.667 0-6.667-3-6.667-6.667V6.668c0-3.667 3-6.667 6.667-6.667h166.66c3.667 0 6.667 3 6.667 6.667v39.997c0 3.666-3 6.666-6.667 6.666"})),mr||(mr=o.createElement("path",{fill:"#fff",d:"M101.93 17.465v-5.118l-.044-1.544-.202.074 4.107 6.588h1.28V9.199h-1.295v4.816l.044 1.544.202-.074-3.927-6.286h-1.458v8.266"})),hr||(hr=o.createElement("path",{fill:"#a6a6a6",d:"M173.33 0H6.67C3.003 0 .003 3 .003 6.666v40c0 3.666 3 6.666 6.667 6.666h166.66c3.667 0 6.667-3 6.667-6.667V6.668c0-3.667-3-6.667-6.667-6.667m0 1.067c3.088 0 5.6 2.512 5.6 5.6v39.997c0 3.087-2.512 5.6-5.6 5.6H6.67a5.607 5.607 0 0 1-5.6-5.6v-40c0-3.087 2.512-5.6 5.6-5.6h166.66"})),pr||(pr=o.createElement("path",{fill:"#fff",d:"M63.356 13.657q0-.303-.058-.628l-.02-.11h-4.121v1.229h3.038v-.134l-.133-.011c-.058.67-.272 1.176-.632 1.537-.573.571-1.276.853-2.14.854-.81 0-1.499-.28-2.092-.85-.587-.568-.88-1.294-.881-2.212.001-.917.294-1.643.881-2.21.593-.571 1.281-.85 2.092-.851.902.002 1.582.3 2.088.901l.094.112.806-.807.086-.087-.079-.093c-.327-.39-.764-.7-1.3-.93a4.3 4.3 0 0 0-1.695-.347c-1.185-.001-2.208.416-3.038 1.24-.833.823-1.252 1.857-1.251 3.072-.001 1.215.418 2.25 1.252 3.073.829.824 1.852 1.24 3.037 1.24 1.234 0 2.258-.41 3.036-1.226l-.003.002c.691-.69 1.034-1.622 1.033-2.764M69.502 9.2h-4.937v8.265h4.937v-1.25h-3.643v-2.27h3.286v-1.227h-3.286v-2.27h3.643m4.335 0h2.234v-1.25h-5.764v1.25h2.235v7.017h1.295m7.239 0V9.199h-1.294v8.266m5.853-7.017h2.235v-1.25h-5.764v1.25h2.234v7.017h1.295m6.652-4.132c0-.903.284-1.627.85-2.203.57-.575 1.252-.858 2.078-.86.825.002 1.509.285 2.078.86.566.576.85 1.3.85 2.203s-.284 1.627-.85 2.202c-.57.576-1.253.858-2.078.86-.826-.002-1.508-.284-2.076-.86s-.852-1.3-.852-2.202m5.957 3.058c.808-.83 1.217-1.86 1.216-3.058 0-1.193-.41-2.22-1.221-3.054-.813-.837-1.83-1.26-3.024-1.259-1.2-.001-2.221.42-3.028 1.254-.81.83-1.217 1.86-1.216 3.059-.001 1.199.406 2.228 1.214 3.06s1.83 1.253 3.03 1.251c1.2.002 2.22-.419 3.029-1.253m-7.387 12.612c-3.136 0-5.693 2.384-5.693 5.67 0 3.266 2.557 5.67 5.693 5.67s5.691-2.405 5.691-5.67c0-3.287-2.555-5.67-5.691-5.67m0 2.232c1.719 0 3.2 1.397 3.2 3.438 0 2.019-1.481 3.435-3.2 3.435-1.718 0-3.201-1.416-3.201-3.435 0-2.041 1.483-3.438 3.201-3.438m-12.422-2.232c-3.136 0-5.693 2.384-5.693 5.67 0 3.266 2.557 5.67 5.693 5.67s5.693-2.405 5.693-5.67c0-3.287-2.557-5.67-5.693-5.67m0 2.232c1.718 0 3.201 1.397 3.201 3.438 0 2.019-1.483 3.435-3.201 3.435-1.719 0-3.2-1.416-3.2-3.435 0-2.041 1.481-3.438 3.2-3.438m-14.772-.494v2.407h5.757c-.172 1.353-.623 2.34-1.31 3.028-.838.838-2.148 1.762-4.447 1.762-3.544 0-6.315-2.857-6.315-6.401s2.771-6.402 6.315-6.402c1.912 0 3.308.752 4.34 1.719l1.696-1.697c-1.439-1.375-3.35-2.427-6.036-2.427-4.854 0-8.935 3.952-8.935 8.807s4.08 8.806 8.935 8.806c2.621 0 4.597-.859 6.143-2.47 1.59-1.59 2.084-3.823 2.084-5.627 0-.56-.043-1.074-.129-1.504zm55.554-1.74c-2.921 0-5.348 2.3-5.348 5.672 0 3.179 2.405 5.67 5.627 5.67 2.6 0 4.105-1.59 4.727-2.514l-1.934-1.287c-.644.946-1.525 1.566-2.793 1.566-1.267 0-2.17-.578-2.75-1.716l7.582-3.137-.256-.645c-.472-1.268-1.912-3.609-4.855-3.609m.086 2.191c.989 0 1.826.495 2.105 1.203l-5.068 2.106c-.065-2.191 1.696-3.309 2.963-3.309m-9.126 8.807h2.493V23.332h-2.492zm-7.15-10.996c-2.835 0-5.434 2.49-5.434 5.691 0 3.18 2.599 5.65 5.434 5.65 1.353 0 2.428-.602 2.986-1.29h.086v.816c0 2.17-1.16 3.33-3.03 3.33-1.524 0-2.47-1.095-2.856-2.02l-2.17.903c.624 1.504 2.278 3.352 5.027 3.352 2.921 0 5.39-1.72 5.39-5.908v-10.18h-2.36v.921h-.087c-.558-.666-1.633-1.265-2.986-1.265m.215 2.232c1.697 0 3.03 1.461 3.03 3.46 0 1.975-1.333 3.414-3.03 3.414-1.72 0-3.158-1.439-3.158-3.415 0-1.997 1.44-3.459 3.158-3.459m26.545-7.904v16.668h2.486v-6.315h3.475c2.758 0 5.469-1.997 5.469-5.177s-2.711-5.176-5.47-5.176zm2.486 2.32h3.54c1.86 0 2.915 1.54 2.915 2.858 0 1.29-1.056 2.855-2.916 2.855h-3.539zm18.914 3.321c-1.8 0-3.667.792-4.44 2.55l2.21.923c.472-.922 1.349-1.223 2.273-1.223 1.286 0 2.594.773 2.615 2.144v.172c-.45-.257-1.414-.642-2.594-.642-2.38 0-4.804 1.308-4.804 3.752 0 2.23 1.951 3.668 4.138 3.668 1.673 0 2.596-.751 3.176-1.631h.084v1.287h2.402v-6.39c0-2.96-2.208-4.61-5.06-4.61m.385 5.938c1.095 0 1.608.236 2.273.558-.193 1.544-1.52 2.639-2.957 2.639l-.002-.002c-.815 0-1.951-.405-1.951-1.414 0-1.286 1.416-1.781 2.637-1.781m13.415-5.575-2.852 7.227h-.085l-2.96-7.227h-2.68l4.438 10.1-2.53 5.619h2.596l6.84-15.719zm-22.4 10.664h2.488V23.331h-2.488z"})),gr||(gr=o.createElement("path",{fill:"url(#google-play_svg__a)",d:"m14.007 43.191-.099-.095c-.388-.41-.617-1.047-.617-1.873v.194V11.93v.203c0-.894.267-1.567.714-1.97l16.516 16.515-16.515 16.515m-.71-31.48v-.004.003m0-.01"})),vr||(vr=o.createElement("path",{fill:"url(#google-play_svg__b)",d:"m36.025 32.378.126-.071 6.522-3.706c.622-.354 1.036-.782 1.243-1.236-.206.454-.621.883-1.243 1.236l-6.522 3.706zm.002-.195-5.506-5.507 5.505-5.506 6.647 3.776c.844.48 1.318 1.098 1.397 1.73v.002c-.08.63-.553 1.248-1.397 1.728z"})),_r||(_r=o.createElement("path",{fill:"url(#google-play_svg__c)",d:"M15.184 43.819a1.723 1.723 0 0 0 .002 0zm0-.195c-.46 0-.863-.15-1.177-.433l16.515-16.516 5.506 5.507L16.68 43.176c-.536.304-1.043.447-1.494.447m-1.182-.241-.086-.084z"})),fr||(fr=o.createElement("path",{fill:"url(#google-play_svg__d)",d:"M30.52 26.676 14.004 10.16a1.72 1.72 0 0 1 1.177-.433c.452 0 .96.145 1.496.449L36.025 21.17l-5.506 5.506m5.63-5.63L16.677 9.98c-.536-.304-1.044-.448-1.496-.448h-.005.007c.451 0 .959.144 1.494.448z"})),yr||(yr=o.createElement("path",{d:"M15.313 43.811c.42-.024.883-.168 1.371-.445l19.353-10.995-19.353 10.994c-.487.277-.952.42-1.371.445m-1.301-.43-.004-.004zm-.09-.088-.009-.008q.005.004.009.008"})),Er||(Er=o.createElement("path",{fill:"url(#google-play_svg__e)",d:"m36.025 32.378.126-.071z"})),br||(br=o.createElement("path",{fill:"url(#google-play_svg__f)",d:"M15.185 43.819c-.461 0-.864-.15-1.178-.434l-.005-.003-.086-.084-.008-.008.099-.1c.314.284.716.434 1.177.434.451 0 .958-.144 1.494-.448l19.348-10.994.124.124-.126.072L16.677 43.37c-.488.276-.952.42-1.37.444l-.123.004"})),wr||(wr=o.createElement("path",{d:"M13.914 43.285c-.388-.411-.617-1.049-.617-1.874 0 .825.23 1.462.617 1.873"})),xr||(xr=o.createElement("path",{fill:"url(#google-play_svg__g)",d:"M13.908 43.29c-.388-.41-.617-1.047-.617-1.873v-.194c0 .825.23 1.462.617 1.873l.099.095z"})),Ar||(Ar=o.createElement("path",{fill:"url(#google-play_svg__h)",d:"m13.908 43.29.099-.1v.001z"})),Sr||(Sr=o.createElement("path",{fill:"url(#google-play_svg__i)",d:"m36.151 32.307-.124-.124 6.646-3.777c.844-.48 1.318-1.098 1.397-1.728q0 .349-.154.688c-.207.453-.62.882-1.243 1.235z"})),Cr||(Cr=o.createElement("path",{fill:"#404040",d:"M44.083 26.667c0-.698-.467-1.395-1.398-1.924l-6.523-3.707 6.523 3.706c.932.53 1.399 1.228 1.398 1.925"})),kr||(kr=o.createElement("path",{fill:"url(#google-play_svg__j)",d:"M44.07 26.675c-.08-.632-.553-1.25-1.397-1.73l-6.647-3.775.124-.124 6.523 3.706c.93.529 1.397 1.226 1.397 1.923"})),Rr||(Rr=o.createElement("path",{fill:"#404040",d:"M13.297 11.917v-.002zm.006-.217v-.003zm0-.006v-.006zm0-.008c.077-1.37.822-2.16 1.876-2.165a1.72 1.72 0 0 0-1.166.433l-.004.003q-.049.045-.095.093c-.35.37-.57.925-.61 1.636"})),Ir||(Ir=o.createElement("path",{fill:"url(#google-play_svg__k)",d:"M13.291 12.132v-.204q0-.11.006-.215V11.7c.04-.71.261-1.265.61-1.635l.098.097c-.447.404-.714 1.077-.714 1.97m.712-2.16.003-.004z"})),Tr||(Tr=o.createElement("path",{fill:"#404040",d:"M15.178 9.521h.004z"})),Pr||(Pr=o.createElement("path",{fill:"url(#google-play_svg__l)",d:"M36.025 21.17 16.677 10.176c-.536-.304-1.044-.448-1.496-.448-.46 0-.863.15-1.177.432l-.097-.097a2 2 0 0 1 .095-.094l.003-.003c.312-.28.71-.43 1.166-.433h.01c.452 0 .96.144 1.496.448l19.472 11.064z"})))},Mr=(0,o.forwardRef)(Dr);var Or,Lr,Ur;function Fr(){return Fr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Fr.apply(null,arguments)}var jr=function(e,t){return o.createElement("svg",Fr({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 159.55 53.333",role:"presentation","aria-hidden":!0,ref:t},e),Or||(Or=o.createElement("path",{fill:"#b2b1b1",d:"M146.84.001H12.71c-.489 0-.972 0-1.46.003-.407.002-.812.01-1.224.016-.888.023-1.786.077-2.672.236a8.9 8.9 0 0 0-2.535.836A8.58 8.58 0 0 0 1.09 4.825a8.8 8.8 0 0 0-.833 2.538c-.16.883-.216 1.776-.24 2.669-.012.409-.013.82-.02 1.228v30.818c.007.414.008.815.02 1.23.024.893.08 1.786.24 2.669.155.893.418 1.73.833 2.539a8.3 8.3 0 0 0 1.571 2.152 8.4 8.4 0 0 0 2.158 1.571 9 9 0 0 0 2.535.842c.886.158 1.784.21 2.672.235.412.01.817.015 1.225.015.488.002.97.002 1.46.002h134.13c.48 0 .966 0 1.445-.002.408 0 .824-.006 1.23-.015.894-.025 1.79-.077 2.667-.235a9 9 0 0 0 2.544-.842 8.4 8.4 0 0 0 2.157-1.57 8.6 8.6 0 0 0 1.573-2.153c.41-.809.676-1.646.826-2.54.165-.882.216-1.775.249-2.669.004-.414.004-.815.004-1.229.01-.484.01-.966.01-1.458V12.715c0-.488 0-.972-.01-1.455q.001-.615-.004-1.228c-.033-.893-.084-1.786-.25-2.67a8.8 8.8 0 0 0-.825-2.537 8.6 8.6 0 0 0-1.573-2.162 8.6 8.6 0 0 0-2.157-1.57 9 9 0 0 0-2.544-.837c-.877-.159-1.773-.213-2.667-.236-.406-.006-.822-.014-1.23-.016C147.807 0 147.322 0 146.84 0"})),Lr||(Lr=o.createElement("path",{fill:"#040403",d:"M11.267 52.166c-.407 0-.803-.005-1.206-.014-.745-.021-1.63-.062-2.492-.217a7.9 7.9 0 0 1-2.21-.731 7.2 7.2 0 0 1-1.862-1.355 7.1 7.1 0 0 1-1.36-1.862 7.6 7.6 0 0 1-.724-2.21c-.163-.897-.205-1.807-.222-2.5-.01-.28-.02-1.217-.02-1.217v-30.8s.012-.922.02-1.193c.017-.698.059-1.607.22-2.495.143-.818.38-1.54.725-2.216.354-.7.808-1.325 1.353-1.864a7.4 7.4 0 0 1 1.87-1.363 7.8 7.8 0 0 1 2.204-.726c.898-.16 1.808-.2 2.5-.219l1.204-.016h137.02l1.217.017c.684.017 1.595.057 2.48.217.802.14 1.53.38 2.227.73.684.35 1.31.808 1.855 1.354a7.4 7.4 0 0 1 1.365 1.873c.344.681.577 1.403.715 2.198.153.841.2 1.705.23 2.517.004.377.004.783.004 1.187.012.5.012.975.012 1.455V40.62c0 .485 0 .957-.012 1.434 0 .434 0 .831-.005 1.24-.028.785-.076 1.648-.228 2.47a7.7 7.7 0 0 1-.72 2.228 7.3 7.3 0 0 1-1.353 1.847 7.3 7.3 0 0 1-1.866 1.363 7.9 7.9 0 0 1-2.225.733c-.853.155-1.737.197-2.492.218-.39.009-.8.014-1.197.014l-1.445.003-135.58-.003"})),Ur||(Ur=o.createElement("path",{fill:"#fff",d:"M33.032 27.068c-.034-3.668 3.002-5.452 3.141-5.536-1.72-2.507-4.385-2.85-5.321-2.877-2.239-.235-4.41 1.34-5.551 1.34-1.162 0-2.92-1.317-4.81-1.278-2.436.038-4.715 1.448-5.964 3.638-2.579 4.464-.656 11.026 1.814 14.633 1.236 1.769 2.68 3.742 4.57 3.672 1.85-.077 2.54-1.18 4.773-1.18 2.212 0 2.86 1.18 4.788 1.135 1.984-.032 3.235-1.775 4.427-3.559 1.428-2.026 2.002-4.02 2.024-4.123-.046-.016-3.854-1.469-3.891-5.865m-3.643-10.786c.994-1.244 1.675-2.936 1.486-4.654-1.44.064-3.24.995-4.276 2.213-.918 1.072-1.738 2.83-1.526 4.481 1.618.12 3.278-.816 4.316-2.04m21.362 17.839h5.002l-2.466-7.261h-.068zm5.658 2.066h-6.312l-1.515 4.475h-2.673l5.977-16.557h2.778l5.977 16.557h-2.718zm14.596-1.56c0-2.444-1.263-4.05-3.19-4.05-1.893 0-3.166 1.64-3.166 4.05 0 2.432 1.273 4.061 3.166 4.061 1.927 0 3.19-1.595 3.19-4.061m2.547 0c0 3.751-2.008 6.161-5.038 6.161-1.72 0-3.086-.77-3.798-2.112h-.057v5.98h-2.478V28.591h2.398v2.007h.046c.689-1.295 2.157-2.134 3.844-2.134 3.063 0 5.083 2.422 5.083 6.162m10.738.001c0-2.444-1.263-4.05-3.19-4.05-1.893 0-3.166 1.64-3.166 4.05 0 2.432 1.273 4.061 3.166 4.061 1.927 0 3.19-1.595 3.19-4.061m2.547 0c0 3.751-2.008 6.161-5.038 6.161-1.72 0-3.086-.77-3.798-2.112h-.057v5.98h-2.478V28.591h2.398v2.007h.046c.689-1.295 2.157-2.134 3.844-2.134 3.063 0 5.083 2.422 5.083 6.162m8.78 1.422c.184 1.642 1.78 2.72 3.96 2.72 2.088 0 3.59-1.078 3.59-2.558 0-1.285-.906-2.055-3.052-2.582l-2.146-.517c-3.04-.735-4.451-2.157-4.451-4.463 0-2.857 2.489-4.82 6.024-4.82 3.499 0 5.897 1.963 5.978 4.82h-2.501c-.15-1.653-1.516-2.65-3.512-2.65s-3.362 1.01-3.362 2.477c0 1.171.873 1.86 3.007 2.387l1.824.448c3.397.804 4.808 2.168 4.808 4.59 0 3.097-2.467 5.038-6.392 5.038-3.671 0-6.15-1.895-6.31-4.89zm15.514-10.314v2.857h2.296v1.962h-2.296v6.655c0 1.034.46 1.515 1.469 1.515.253 0 .655-.035.815-.057v1.95c-.274.07-.826.115-1.376.115-2.444 0-3.397-.918-3.397-3.26v-6.918h-1.755V28.59h1.755v-2.857h2.49m12.551 8.894c0-2.605-1.194-4.143-3.202-4.143s-3.2 1.55-3.2 4.143c0 2.616 1.193 4.142 3.2 4.142s3.202-1.526 3.202-4.142m-8.927 0c0-3.798 2.237-6.184 5.725-6.184 3.5 0 5.727 2.386 5.727 6.184 0 3.809-2.215 6.185-5.727 6.185-3.51 0-5.725-2.376-5.725-6.185m13.495-6.036h2.363v2.055h.058c.378-1.367 1.48-2.182 2.903-2.182.356 0 .653.047.85.093v2.318c-.197-.082-.633-.15-1.114-.15-1.595 0-2.582 1.079-2.582 2.777v7.16h-2.478zm9.218 4.922h6.035c-.058-1.847-1.239-3.064-2.96-3.064-1.71 0-2.948 1.24-3.075 3.064m8.376 3.603c-.333 2.192-2.467 3.696-5.197 3.696-3.512 0-5.692-2.353-5.692-6.128 0-3.786 2.192-6.242 5.588-6.242 3.34 0 5.44 2.294 5.44 5.954v.85h-8.527v.15c0 2.064 1.298 3.418 3.248 3.418 1.376 0 2.456-.654 2.788-1.698zM48.803 18.473h1.5c1.664 0 2.623-1.037 2.623-2.862 0-1.797-.975-2.845-2.623-2.845h-1.5zm1.638-6.831c2.36 0 3.744 1.45 3.744 3.953 0 2.542-1.374 4.003-3.744 4.003h-2.873v-7.956zm9.583 4.951c0-1.301-.584-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.026 0 1.61-.76 1.61-2.067m-4.443 0c0-1.936 1.08-3.115 2.833-3.115 1.748 0 2.829 1.18 2.829 3.115 0 1.946-1.076 3.12-2.83 3.12-1.758 0-2.832-1.174-2.832-3.12m13.188 3.005H67.54l-1.24-4.422h-.095l-1.235 4.422h-1.218l-1.654-6.004h1.201l1.076 4.581h.088l1.234-4.58h1.138l1.234 4.58h.094l1.07-4.58h1.185zm3.042-6.004h1.14v.954h.089c.291-.667.888-1.07 1.791-1.07 1.34 0 2.078.805 2.078 2.233v3.887h-1.184v-3.59c0-.965-.42-1.444-1.296-1.444s-1.434.585-1.434 1.522v3.512h-1.184zm6.986-2.344h1.185v8.347h-1.185zm7.276 5.343c0-1.301-.585-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.025 0 1.61-.76 1.61-2.067m-4.444 0c0-1.936 1.08-3.115 2.833-3.115 1.749 0 2.83 1.18 2.83 3.115 0 1.946-1.076 3.12-2.83 3.12-1.758 0-2.833-1.174-2.833-3.12m10.769.794v-.501l-1.466.093c-.827.056-1.202.337-1.202.866 0 .54.47.855 1.113.855.894 0 1.555-.569 1.555-1.313m-3.86.513c0-1.08.805-1.703 2.234-1.792l1.626-.094v-.518c0-.634-.42-.992-1.23-.992-.66 0-1.119.243-1.25.667h-1.147c.12-1.031 1.09-1.693 2.453-1.693 1.505 0 2.354.75 2.354 2.018v4.102h-1.14v-.844h-.095c-.357.601-1.014.943-1.803.943-1.158 0-2.001-.7-2.001-1.797m7.82-1.307c0 1.273.6 2.04 1.604 2.04 1 0 1.617-.778 1.617-2.035 0-1.251-.624-2.04-1.617-2.04-.997 0-1.604.772-1.604 2.035m-1.224 0c0-1.897.976-3.1 2.492-3.1.822 0 1.516.392 1.842 1.054h.088V11.25h1.185v8.347h-1.135v-.948h-.094c-.358.656-1.058 1.047-1.886 1.047-1.527 0-2.492-1.201-2.492-3.103m14.953 0c0-1.301-.584-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.026 0 1.61-.76 1.61-2.067m-4.443 0c0-1.936 1.08-3.115 2.833-3.115 1.748 0 2.829 1.18 2.829 3.115 0 1.946-1.076 3.12-2.83 3.12-1.757 0-2.832-1.174-2.832-3.12m7.252-2.999h1.141v.954h.089c.291-.667.888-1.07 1.791-1.07 1.34 0 2.078.805 2.078 2.233v3.887h-1.184v-3.59c0-.965-.42-1.444-1.296-1.444s-1.434.585-1.434 1.522v3.512h-1.184zm11.793-1.494v1.521h1.3v.999h-1.3v3.087c0 .629.258.904.849.904.182 0 .286-.011.451-.027v.987c-.193.032-.414.06-.644.06-1.318 0-1.843-.464-1.843-1.621v-3.39h-.953v-.999h.953V12.1zm2.919-.85h1.175v3.308h.094c.291-.673.925-1.075 1.83-1.075 1.279 0 2.068.81 2.068 2.238v3.876h-1.186v-3.583c0-.96-.447-1.445-1.284-1.445-.972 0-1.512.612-1.512 1.522v3.506h-1.185zm7.914 4.792h3.033c-.028-.943-.601-1.555-1.479-1.555-.876 0-1.488.617-1.554 1.555m4.168 1.935c-.27 1.075-1.23 1.737-2.602 1.737-1.72 0-2.773-1.18-2.773-3.1 0-1.918 1.076-3.136 2.768-3.136 1.67 0 2.679 1.142 2.679 3.026v.414h-4.24v.067c.04 1.052.652 1.72 1.598 1.72.719 0 1.21-.26 1.43-.728z"})))},Br=(0,o.forwardRef)(jr);var Vr=n("./node_modules/matrix-react-sdk/src/components/views/elements/QRCode.tsx");const Hr=({onFinished:e})=>{const t=g.Ay.get("brand"),n=g.Ay.getObject("desktop_builds"),i=g.Ay.getObject("mobile_builds"),r=null==i?void 0:i.get("ios"),s=null==i?void 0:i.get("android"),a=null==i?void 0:i.get("fdroid"),l=null!=s?s:a;return o.createElement(cn.A,{title:(0,C._t)("onboarding|download_brand",{brand:t}),className:"mx_AppDownloadDialog",fixedWidth:!0,onFinished:e},(null==n?void 0:n.get("available"))&&o.createElement("div",{className:"mx_AppDownloadDialog_desktop"},o.createElement(Ii.A,{size:"3"},(0,C._t)("onboarding|download_brand_desktop",{brand:t})),o.createElement(be.A,{kind:"primary",element:"a",href:null==n?void 0:n.get("url"),target:"_blank",onClick:()=>{}},(0,C._t)("onboarding|download_brand_desktop",{brand:t}))),o.createElement("div",{className:"mx_AppDownloadDialog_mobile"},r&&o.createElement("div",{className:"mx_AppDownloadDialog_app"},o.createElement(Ii.A,{size:"3"},(0,C._t)("common|ios")),o.createElement(Vr.A,{data:r,margin:0,width:172}),o.createElement("div",{className:"mx_AppDownloadDialog_info"},(0,C._t)("onboarding|qr_or_app_links",{appLinks:"",qrCode:""})),o.createElement("div",{className:"mx_AppDownloadDialog_links"},o.createElement(be.A,{element:"a",href:r,target:"_blank","aria-label":(0,C._t)("onboarding|download_app_store"),onClick:()=>{}},o.createElement(Br,null)))),l&&o.createElement("div",{className:"mx_AppDownloadDialog_app"},o.createElement(Ii.A,{size:"3"},(0,C._t)("common|android")),o.createElement(Vr.A,{data:l,margin:0,width:172}),o.createElement("div",{className:"mx_AppDownloadDialog_info"},(0,C._t)("onboarding|qr_or_app_links",{appLinks:"",qrCode:""})),o.createElement("div",{className:"mx_AppDownloadDialog_links"},s&&o.createElement(be.A,{element:"a",href:s,target:"_blank","aria-label":(0,C._t)("onboarding|download_google_play"),onClick:()=>{}},o.createElement(Mr,null)),a&&o.createElement(be.A,{element:"a",href:a,target:"_blank","aria-label":(0,C._t)("onboarding|download_f_droid"),onClick:()=>{}},o.createElement(cr,null))))),o.createElement("div",{className:"mx_AppDownloadDialog_legal"},o.createElement("p",null,(0,C._t)("onboarding|apple_trademarks")),o.createElement("p",null,(0,C._t)("onboarding|google_trademarks"))))};let zr=function(e){return e.PersonalMessaging="PersonalMessaging",e.WorkMessaging="WorkMessaging",e.CommunityMessaging="CommunityMessaging",e.Skip="Skip",e}({});function Wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Gr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wr(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Kr=e=>{u.A.trackInteraction("WebUserOnboardingTaskSendDm",e),v.Ay.dispatch({action:"view_create_chat"})},Jr=[{id:"create-account",title:(0,C._t)("auth|create_account_title"),description:(0,C._t)("onboarding|you_made_it"),completed:()=>!0},{id:"find-friends",title:(0,C._t)("onboarding|find_friends"),description:(0,C._t)("onboarding|find_friends_description"),completed:e=>e.hasDmRooms,relevant:[zr.PersonalMessaging,zr.Skip],action:{label:(0,C._t)("onboarding|find_friends_action"),onClick:Kr}},{id:"find-coworkers",title:(0,C._t)("onboarding|find_coworkers"),description:(0,C._t)("onboarding|get_stuff_done"),completed:e=>e.hasDmRooms,relevant:[zr.WorkMessaging],action:{label:(0,C._t)("onboarding|find_people"),onClick:Kr}},{id:"find-community-members",title:(0,C._t)("onboarding|find_community_members"),description:(0,C._t)("onboarding|get_stuff_done"),completed:e=>e.hasDmRooms,relevant:[zr.CommunityMessaging],action:{label:(0,C._t)("onboarding|find_people"),onClick:Kr}},{id:"download-apps",title:()=>(0,C._t)("onboarding|download_app",{brand:g.Ay.get("brand")}),description:()=>(0,C._t)("onboarding|download_app_description",{brand:g.Ay.get("brand")}),completed:e=>e.hasDevices,action:{label:(0,C._t)("onboarding|download_app_action"),onClick:e=>{u.A.trackInteraction("WebUserOnboardingTaskDownloadApps",e),f.Ay.createDialog(Hr,{},"mx_AppDownloadDialog_wrapper",!1,!0)}},disabled:()=>!(()=>{const e=g.Ay.getObject("desktop_builds"),t=g.Ay.getObject("mobile_builds");return!!(null!=e&&e.get("available")||null!=t&&t.get("ios")||null!=t&&t.get("android")||null!=t&&t.get("fdroid"))})()},{id:"setup-profile",title:(0,C._t)("onboarding|set_up_profile"),description:(0,C._t)("onboarding|set_up_profile_description"),completed:e=>e.hasAvatar,action:{label:(0,C._t)("onboarding|set_up_profile_action"),onClick:e=>{u.A.trackInteraction("WebUserOnboardingTaskSetupProfile",e),v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Account})}}},{id:"permission-notifications",title:(0,C._t)("onboarding|enable_notifications"),description:(0,C._t)("onboarding|enable_notifications_description"),completed:e=>!e.showNotificationsPrompt,action:{label:(0,C._t)("onboarding|enable_notifications_action"),onClick:e=>{u.A.trackInteraction("WebUserOnboardingTaskEnableNotifications",e),v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Notifications}),_.Notifier.setPromptHidden(!0)},hideOnComplete:!_.Notifier.isPossible()}}];function qr(e){var t;const n=null!==(t=(0,Ne.ti)("FTUE.useCaseSelection"))&&void 0!==t?t:zr.Skip;return(0,o.useMemo)((()=>Jr.filter((e=>{var t;return(null===(t=e.disabled)||void 0===t||!t.call(e))&&(!e.relevant||e.relevant.includes(n))})).map((t=>Gr(Gr({},t),{},{completed:t.completed(e)})))),[e,n])}var $r=n("./node_modules/sanitize-html/index.js"),Yr=n.n($r);class Qr extends o.PureComponent{constructor(e,t){super(e,t),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"dispatcherRef",null),(0,r.A)(this,"onAction",(e=>{"client_started"===e.action&&this.forceUpdate()})),this.state={page:""}}translate(e){return Yr()((0,C._t)(e))}async fetchEmbed(){let e;try{e=await fetch(this.props.url,{method:"GET"})}catch(e){if(this.unmounted)return;return l.v.warn(`Error loading page: ${e}`),void this.setState({page:(0,C._t)("cant_load_page")})}if(this.unmounted)return;if(!e.ok)return l.v.warn(`Error loading page: ${e.status}`),void this.setState({page:(0,C._t)("cant_load_page")});let t=(await e.text()).replace(/_t\(['"]([\s\S]*?)['"]\)/gm,((e,t)=>this.translate(t)));this.props.replaceMap&&Object.keys(this.props.replaceMap).forEach((e=>{t=t.split(e).join(this.props.replaceMap[e])})),this.setState({page:t})}componentDidMount(){this.unmounted=!1,this.props.url&&(this.fetchEmbed(),this.dispatcherRef=v.Ay.register(this.onAction))}componentWillUnmount(){this.unmounted=!0,null!==this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef)}render(){const e=this.context||h.J.get(),t=!e||e.isGuest(),n=this.props.className,i=ee()(n,{[`${n}_guest`]:t,[`${n}_loggedIn`]:!!e}),r=o.createElement("div",{className:`${n}_body`,dangerouslySetInnerHTML:{__html:this.state.page}});return this.props.scrollbar?o.createElement(Bn.A,{className:i},r):o.createElement("div",{className:i},r)}}(0,r.A)(Qr,"contextType",Re.Ay);var Zr=n("./node_modules/matrix-react-sdk/src/contexts/RoomContext.ts"),Xr=n("./node_modules/matrix-react-sdk/src/hooks/useTimeout.ts"),eo=n("./node_modules/matrix-react-sdk/src/utils/BrowserWorkarounds.ts");const to="52px",no=({hasAvatar:e,hasAvatarLabel:t,noAvatarLabel:n,setAvatarUrl:i,isUserAvatar:r,children:a,onClick:l})=>{var c;const d=(0,o.useContext)(Re.Ay),[u,m]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!1),[g,v]=(0,o.useState)(!1);(0,Xr.Z3)((()=>{v(!0)}),3e3),(0,Xr.Z3)((()=>{v(!1)}),13e3);const _=(0,o.useRef)(null),f=e||u?t:n,{room:y}=(0,o.useContext)(Zr.Ay);if(!(r||(null==y||null===(c=y.currentState)||void 0===c?void 0:c.maySendStateEvent(s.EventType.RoomAvatar,d.getSafeUserId()))))return o.createElement(o.Fragment,null,a);const E=!!f&&(h||g);return o.createElement(o.Fragment,null,o.createElement("input",{type:"file",ref:_,className:"mx_MiniAvatarUploader_input",onClick:e=>{(0,eo.e)(e),null==l||l(e)},onChange:async e=>{var t;if(null===(t=e.target.files)||void 0===t||!t.length)return;m(!0);const n=e.target.files[0],{content_uri:r}=await d.uploadContent(n);await i(r),m(!1)},accept:"image/*"}),o.createElement(be.A,{className:ee()("mx_MiniAvatarUploader",{mx_MiniAvatarUploader_busy:u,mx_MiniAvatarUploader_hasAvatar:e}),disabled:u,onClick:()=>{var e;null===(e=_.current)||void 0===e||e.click()},onMouseOver:()=>p(!0),onMouseLeave:()=>p(!1)},a,o.createElement("div",{className:"mx_MiniAvatarUploader_indicator"},u?o.createElement(dn.A,{w:20,h:20}):o.createElement("div",{className:"mx_MiniAvatarUploader_cameraIcon"})),o.createElement("div",{className:ee()("mx_Tooltip",{mx_Tooltip_visible:E,mx_Tooltip_invisible:!E})},o.createElement("div",{className:"mx_Tooltip_chevron"}),f)))},io=e=>{u.A.trackInteraction("WebHomeCreateChatButton",e),v.Ay.dispatch({action:"view_create_chat"})},ro=e=>{u.A.trackInteraction("WebHomeExploreRoomsButton",e),v.Ay.fire(x.r.ViewRoomDirectory)},oo=e=>{u.A.trackInteraction("WebHomeCreateRoomButton",e),v.Ay.dispatch({action:"view_create_room"})},so=e=>{var t;return{displayName:wn.V.instance.displayName||e,avatarUrl:null!==(t=wn.V.instance.getHttpAvatarUrl(parseInt(to,10)))&&void 0!==t?t:void 0}},ao=()=>{const e=(0,o.useContext)(Re.Ay),t=e.getUserId(),[n,i]=(0,o.useState)(so(t));return(0,Pe.ml)(wn.V.instance,A.H,(()=>{i(so(t))})),o.createElement("div",null,o.createElement(no,{hasAvatar:!!n.avatarUrl,hasAvatarLabel:(0,C._3)("onboarding|has_avatar_label"),noAvatarLabel:(0,C._3)("onboarding|no_avatar_label"),setAvatarUrl:t=>e.setAvatarUrl(t),isUserAvatar:!0,onClick:e=>u.A.trackInteraction("WebHomeMiniAvatarUploadButton",e)},o.createElement(xn.A,{idName:t,name:n.displayName,url:n.avatarUrl,size:to})),o.createElement("h1",null,(0,C._3)("onboarding|welcome_user",{name:n.displayName})),o.createElement("h2",null,(0,C._3)("onboarding|welcome_detail")))},lo=({justRegistered:e=!1})=>{const t=(0,Re.nH)(),n=g.Ay.get(),i=_n(n,t);if(i)return o.createElement(Qr,{className:"mx_HomePage",url:i,scrollbar:!0});let r;if(e||!wn.V.instance.getHttpAvatarUrl(parseInt(to,10)))r=o.createElement(ao,null);else{var s;const e=g.Ay.getObject("branding"),t=null!==(s=null==e?void 0:e.get("auth_header_logo_url"))&&void 0!==s?s:"themes/element/img/logos/element-logo.svg";r=o.createElement(o.Fragment,null,o.createElement("img",{src:t,alt:n.brand}),o.createElement("h1",null,(0,C._3)("onboarding|intro_welcome",{appName:n.brand})),o.createElement("h2",null,(0,C._3)("onboarding|intro_byline")))}return o.createElement(Bn.A,{className:"mx_HomePage mx_HomePage_default",element:"main"},o.createElement("div",{className:"mx_HomePage_default_wrapper"},r,o.createElement("div",{className:"mx_HomePage_default_buttons"},o.createElement(be.A,{onClick:io,className:"mx_HomePage_button_sendDm"},(0,C._3)("onboarding|send_dm")),o.createElement(be.A,{onClick:ro,className:"mx_HomePage_button_explore"},(0,C._3)("onboarding|explore_rooms")),o.createElement(be.A,{onClick:oo,className:"mx_HomePage_button_createGroup"},(0,C._3)("onboarding|create_room")))))},co=e=>{u.A.trackInteraction("WebUserOnboardingHeaderSendDm",e),v.Ay.dispatch({action:"view_create_chat"})};function uo({useCase:e}){let t,i,r,s=(0,C._t)("onboarding|free_e2ee_messaging_unlimited_voip",{brand:g.Ay.get("brand")});switch(e){case zr.PersonalMessaging:t=(0,C._t)("onboarding|personal_messaging_title"),i=n("./node_modules/matrix-react-sdk/res/img/user-onboarding/PersonalMessaging.png"),r=(0,C._t)("onboarding|personal_messaging_action");break;case zr.WorkMessaging:t=(0,C._t)("onboarding|work_messaging_title"),s=(0,C._t)("onboarding|free_e2ee_messaging_unlimited_voip",{brand:g.Ay.get("brand")}),i=n("./node_modules/matrix-react-sdk/res/img/user-onboarding/WorkMessaging.png"),r=(0,C._t)("onboarding|work_messaging_action");break;case zr.CommunityMessaging:t=(0,C._t)("onboarding|community_messaging_title"),s=(0,C._t)("onboarding|community_messaging_description"),i=n("./node_modules/matrix-react-sdk/res/img/user-onboarding/CommunityMessaging.png"),r=(0,C._t)("onboarding|community_messaging_action");break;default:t=(0,C._t)("onboarding|welcome_to_brand",{brand:g.Ay.get("brand")}),i=n("./node_modules/matrix-react-sdk/res/img/user-onboarding/PersonalMessaging.png"),r=(0,C._t)("onboarding|personal_messaging_action")}return o.createElement("div",{className:"mx_UserOnboardingHeader"},o.createElement("div",{className:"mx_UserOnboardingHeader_content"},o.createElement(Ii.A,{size:"1"},t,o.createElement("span",{className:"mx_UserOnboardingHeader_dot"},".")),o.createElement("p",null,s),o.createElement(be.A,{onClick:co,kind:"primary"},r)),o.createElement("img",{className:"mx_UserOnboardingHeader_image",src:i,alt:""}))}var mo=n("./node_modules/matrix-react-sdk/src/components/views/elements/ProgressBar.tsx");function ho({task:e,completed:t=!1}){var n;const i="function"==typeof e.title?e.title():e.title,r="function"==typeof e.description?e.description():e.description;return o.createElement("li",{className:ee()("mx_UserOnboardingTask",{mx_UserOnboardingTask_completed:t})},o.createElement("div",{className:"mx_UserOnboardingTask_number",role:"checkbox","aria-disabled":"true","aria-checked":t,"aria-labelledby":`mx_UserOnboardingTask_${e.id}`}),o.createElement("div",{id:`mx_UserOnboardingTask_${e.id}`,className:"mx_UserOnboardingTask_content"},o.createElement(Ii.A,{size:"4",className:"mx_UserOnboardingTask_title"},i),o.createElement("div",{className:"mx_UserOnboardingTask_description"},r)),e.action&&(!e.action.hideOnComplete||!t)&&o.createElement(be.A,{element:"a",className:"mx_UserOnboardingTask_action",kind:"primary_outline",href:e.action.href,target:"_blank",onClick:null!==(n=e.action.onClick)&&void 0!==n?n:null},e.action.label))}const po=e=>{const t=e.filter((e=>!0===e.completed)).length,n=e.filter((e=>!1===e.completed)).length;return{completed:t,waiting:n,total:t+n}};function go({tasks:e}){const{completed:t,waiting:n,total:i}=po(e);return o.createElement("div",{className:"mx_UserOnboardingList"},o.createElement("div",{className:"mx_UserOnboardingList_header"},o.createElement(Ii.A,{size:"3",className:"mx_UserOnboardingList_title"},n>0?(0,C._t)("onboarding|only_n_steps_to_go",{count:n}):(0,C._t)("onboarding|you_did_it")),o.createElement("div",{className:"mx_UserOnboardingList_hint"},(0,C._t)("onboarding|complete_these",{brand:g.Ay.get("brand")}))),o.createElement("div",{className:"mx_UserOnboardingList_progress"},o.createElement(mo.A,{value:t,max:i,animated:!0})),o.createElement("ol",{className:"mx_UserOnboardingList_list"},e.map((e=>o.createElement(ho,{key:e.id,completed:e.completed,task:e})))))}const vo=new Date(1656633600);function _o(e){return null!==e||h.J.userRegisteredAfter(vo)}function fo({justRegistered:e=!1}){const t=(0,Re.nH)(),n=_n(g.Ay.get(),t),i=(0,Ne.ti)("FTUE.useCaseSelection"),r=qr(Di()),a=function(){const e=(0,Re.nH)();return(0,Pe.dF)(e,s.ClientEvent.Sync,(()=>e.isInitialSyncComplete()))}(),[l,c]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(a){const e=window.setTimeout((()=>{c(!0)}),2800);return()=>{clearTimeout(e)}}c(!1)}),[a,c]),_o(i)?n?o.createElement(Qr,{className:"mx_HomePage",url:n,scrollbar:!0}):o.createElement(Bn.A,{className:"mx_UserOnboardingPage"},o.createElement(uo,{useCase:i}),l&&o.createElement(go,{tasks:r})):o.createElement(lo,{justRegistered:e})}function yo({selected:e,minimized:t}){const n=(0,Ne.ti)("FTUE.useCaseSelection");return(0,Ne.ti)("FTUE.userOnboardingButton")&&!t&&_o(n)?o.createElement(Eo,{selected:e,minimized:t}):o.createElement(o.Fragment,null)}function Eo({selected:e,minimized:t}){const n=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),u.A.trackInteraction("WebRoomListUserOnboardingIgnoreButton",e),O.A.setValue("FTUE.userOnboardingButton",null,re.p.ACCOUNT,!1)}),[]),i=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),u.A.trackInteraction("WebRoomListUserOnboardingButton",e),v.Ay.fire(x.r.ViewHomePage)}),[]);return o.createElement(be.A,{className:ee()("mx_UserOnboardingButton",{mx_UserOnboardingButton_selected:e,mx_UserOnboardingButton_minimized:t}),onClick:i},!t&&o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_UserOnboardingButton_content"},o.createElement(Ii.A,{size:"4",className:"mx_Heading_h4"},(0,C._t)("common|welcome")),o.createElement(be.A,{className:"mx_UserOnboardingButton_close",onClick:n,"aria-label":(0,C._t)("action|dismiss")}))))}var bo=function(e){return e[e.Disabled=0]="Disabled",e[e.Legacy=1]="Legacy",e}(bo||{});class wo extends o.Component{constructor(e){super(e),(0,r.A)(this,"listContainerRef",(0,o.createRef)()),(0,r.A)(this,"roomListRef",(0,o.createRef)()),(0,r.A)(this,"focusedElement",null),(0,r.A)(this,"isDoingStickyHeaders",!1),(0,r.A)(this,"updateActiveSpace",(e=>{this.setState({activeSpace:e})})),(0,r.A)(this,"onDialPad",(()=>{v.Ay.fire(x.r.OpenDialPad)})),(0,r.A)(this,"onExplore",(e=>{v.Ay.fire(x.r.ViewRoomDirectory),u.A.trackInteraction("WebLeftPanelExploreRoomsButton",e)})),(0,r.A)(this,"refreshStickyHeaders",(()=>{this.listContainerRef.current&&this.handleStickyHeaders(this.listContainerRef.current)})),(0,r.A)(this,"onBreadcrumbsUpdate",(()=>{const e=wo.breadcrumbsMode;if(e!==this.state.showBreadcrumbs){if(this.setState({showBreadcrumbs:e}),!this.listContainerRef.current)return;this.handleStickyHeaders(this.listContainerRef.current)}})),(0,r.A)(this,"onScroll",(e=>{const t=e.target;this.handleStickyHeaders(t)})),(0,r.A)(this,"onFocus",(e=>{this.focusedElement=e.target})),(0,r.A)(this,"onBlur",(()=>{this.focusedElement=null})),(0,r.A)(this,"onKeyDown",((e,t)=>{if(!this.focusedElement)return;var n;(0,Se.zM)().getRoomListAction(e)===Ee.bY.NextRoom&&(t||(e.stopPropagation(),e.preventDefault(),null===(n=this.roomListRef.current)||void 0===n||n.focus()));const i=(0,Se.zM)().getNavigationAction(e);i!==Ee.bY.PreviousLandmark&&i!==Ee.bY.NextLandmark||(e.stopPropagation(),e.preventDefault(),li.r.findAndFocusNextLandmark(li.H.ROOM_SEARCH,i===Ee.bY.PreviousLandmark))})),this.state={activeSpace:xe.Ay.instance.activeSpace,showBreadcrumbs:wo.breadcrumbsMode},xi.Y.instance.on(A.H,this.onBreadcrumbsUpdate),Ai.Ay.instance.on(Ai.lA,this.onBreadcrumbsUpdate),xe.Ay.instance.on(Ae.tw,this.updateActiveSpace)}static get breadcrumbsMode(){return xi.Y.instance.visible?bo.Legacy:bo.Disabled}componentDidMount(){this.listContainerRef.current&&(Ce.A.instance.trackElementDimensions("ListContainer",this.listContainerRef.current),this.listContainerRef.current.addEventListener("scroll",this.onScroll,{passive:!0})),Ce.A.instance.on("ListContainer",this.refreshStickyHeaders)}componentWillUnmount(){var e;xi.Y.instance.off(A.H,this.onBreadcrumbsUpdate),Ai.Ay.instance.off(Ai.lA,this.onBreadcrumbsUpdate),xe.Ay.instance.off(Ae.tw,this.updateActiveSpace),Ce.A.instance.stopTrackingElementDimensions("ListContainer"),Ce.A.instance.removeListener("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.removeEventListener("scroll",this.onScroll)}componentDidUpdate(e,t){t.activeSpace!==this.state.activeSpace&&this.refreshStickyHeaders()}handleStickyHeaders(e){this.isDoingStickyHeaders||(this.isDoingStickyHeaders=!0,window.requestAnimationFrame((()=>{this.doStickyHeaders(e),this.isDoingStickyHeaders=!1})))}doStickyHeaders(e){if(!e.parentElement)return;const t=e.scrollTop,n=e.offsetHeight+e.scrollTop,i=e.querySelectorAll(".mx_RoomSublist:not(.mx_RoomSublist_hidden)"),r=new Map;let o,s;for(const e of i){const a=e.querySelector(".mx_RoomSublist_stickable");if(!a)continue;a.style.removeProperty("display");const l=.4,c=e.offsetTop+l*ye.u<=t,d=e.offsetTop+l*ye.u>=n;c||e===i[0]?(r.set(a,{stickyTop:!0}),o&&(o.style.display="none",r.set(o,{makeInvisible:!0})),o=a):d&&!s?(r.set(a,{stickyBottom:!0}),s=a):r.set(a,{})}for(const t of r.keys()){const n=r.get(t);if(n.makeInvisible)t.style.display="none";else{if(n.stickyTop){t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")||t.classList.add("mx_RoomSublist_headerContainer_stickyTop");const n=`${e.parentElement.offsetTop}px`;t.style.top!==n&&(t.style.top=n)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyTop"),t.style.top&&t.style.removeProperty("top");if(n.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")||t.classList.add("mx_RoomSublist_headerContainer_stickyBottom");const n=`${Ce.A.instance.windowHeight-(e.parentElement.offsetTop+e.parentElement.offsetHeight)}px`;t.style.bottom!==n&&(t.style.bottom=n)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyBottom"),t.style.bottom&&t.style.removeProperty("bottom");if(n.stickyTop||n.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_sticky")||t.classList.add("mx_RoomSublist_headerContainer_sticky");const e=Ce.A.instance.getElementDimensions("ListContainer");if(e){const n=15,i=`${e.width-n}px`;t.style.width!==i&&(t.style.width=i)}}else n.stickyTop||n.stickyBottom||(t.classList.contains("mx_RoomSublist_headerContainer_sticky")&&t.classList.remove("mx_RoomSublist_headerContainer_sticky"),t.style.width&&t.style.removeProperty("width"))}}const a=e.parentElement;a&&(o?a.classList.add("mx_LeftPanel_roomListWrapper_stickyTop"):a.classList.remove("mx_LeftPanel_roomListWrapper_stickyTop"),s?a.classList.add("mx_LeftPanel_roomListWrapper_stickyBottom"):a.classList.remove("mx_LeftPanel_roomListWrapper_stickyBottom"))}renderBreadcrumbs(){if(this.state.showBreadcrumbs===bo.Legacy&&!this.props.isMinimized)return o.createElement(Hn,{role:"navigation","aria-label":(0,C._t)("a11y|recent_rooms"),className:"mx_LeftPanel_breadcrumbsContainer mx_AutoHideScrollbar",verticalScrollsHorizontally:!0},o.createElement(Ri,null))}renderSearchDialExplore(){let e,t;return fe.Ay.instance.getSupportsPstnProtocol()&&(e=o.createElement(be.A,{className:ee()("mx_LeftPanel_dialPadButton",{}),onClick:this.onDialPad,title:(0,C._t)("left_panel|open_dial_pad")})),this.state.activeSpace===Ae._b.Home&&(0,Ie.g)(W.C.ExploreRooms)&&(t=o.createElement(be.A,{className:"mx_LeftPanel_exploreButton",onClick:this.onExplore,title:(0,C._t)("action|explore_rooms")})),o.createElement("div",{className:"mx_LeftPanel_filterContainer",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,role:"search"},o.createElement(we,{isMinimized:this.props.isMinimized}),e,t)}render(){const e=o.createElement(_e.A,{onKeyDown:this.onKeyDown,resizeNotifier:this.props.resizeNotifier,onFocus:this.onFocus,onBlur:this.onBlur,isMinimized:this.props.isMinimized,activeSpace:this.state.activeSpace,onResize:this.refreshStickyHeaders,onListCollapse:this.refreshStickyHeaders,ref:this.roomListRef}),t=ee()({mx_LeftPanel:!0,mx_LeftPanel_minimized:this.props.isMinimized}),n=ee()("mx_LeftPanel_actualRoomListContainer","mx_AutoHideScrollbar");return o.createElement("div",{className:t},o.createElement("div",{className:"mx_LeftPanel_roomListContainer"},(0,Ie.g)(W.C.FilterContainer)&&this.renderSearchDialExplore(),this.renderBreadcrumbs(),!this.props.isMinimized&&o.createElement(wi,{onVisibilityChange:this.refreshStickyHeaders}),o.createElement(yo,{selected:this.props.pageType===B.A.HomePage,minimized:this.props.isMinimized}),o.createElement("nav",{className:"mx_LeftPanel_roomListWrapper","aria-label":(0,C._t)("common|rooms")},o.createElement("div",{className:n,ref:this.listContainerRef,tabIndex:-1},e))))}}var xo=n("./node_modules/matrix-react-sdk/src/stores/NonUrgentToastStore.ts");class Ao extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"onUpdateToasts",(()=>{this.setState({toasts:xo.A.instance.components})})),this.state={toasts:xo.A.instance.components},xo.A.instance.on(A.H,this.onUpdateToasts)}componentWillUnmount(){xo.A.instance.off(A.H,this.onUpdateToasts)}render(){const e=this.state.toasts.map(((e,t)=>o.createElement("div",{className:"mx_NonUrgentToastContainer_toast",key:`toast-${t}`},o.createElement(e,{}))));return o.createElement("div",{className:"mx_NonUrgentToastContainer",role:"alert"},e)}}var So=n("./node_modules/matrix-js-sdk/src/webrtc/call.ts"),Co=n("./node_modules/matrix-js-sdk/src/webrtc/callFeed.ts");class ko extends o.Component{constructor(e){super(e),(0,r.A)(this,"element",(0,o.createRef)()),(0,r.A)(this,"onAudioOutputChanged",(e=>{const t=this.element.current;if(e)try{t.setSinkId(e)}catch(e){l.v.error("Couldn't set requested audio output device: using default",e),l.v.warn("Couldn't set requested audio output device: using default",e)}})),(0,r.A)(this,"onNewStream",(()=>{this.setState({audioMuted:this.props.feed.isAudioMuted()}),this.playMedia()})),this.state={audioMuted:this.props.feed.isAudioMuted()}}componentDidMount(){ne.Ay.instance.addListener(ne.hW.AudioOutputChanged,this.onAudioOutputChanged),this.props.feed.addListener(Co.BL.NewStream,this.onNewStream),this.playMedia()}componentWillUnmount(){ne.Ay.instance.removeListener(ne.hW.AudioOutputChanged,this.onAudioOutputChanged),this.props.feed.removeListener(Co.BL.NewStream,this.onNewStream),this.stopMedia()}async playMedia(){const e=this.element.current;if(e){this.onAudioOutputChanged(ne.Ay.getAudioOutput()),e.muted=!1,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{await e.load()}catch(e){l.v.info(`Failed to play media element with feed for userId ${this.props.feed.userId} with purpose ${this.props.feed.purpose}`,e)}}}stopMedia(){const e=this.element.current;e&&(e.pause(),e.removeAttribute("src"))}render(){return this.state.audioMuted?null:o.createElement("audio",{ref:this.element})}}class Ro extends o.Component{constructor(e){super(e),(0,r.A)(this,"onFeedsChanged",(()=>{this.setState({feeds:this.props.call.getRemoteFeeds()})})),this.state={feeds:this.props.call.getRemoteFeeds()}}componentDidMount(){this.props.call.addListener(So.$E.FeedsChanged,this.onFeedsChanged)}componentWillUnmount(){this.props.call.removeListener(So.$E.FeedsChanged,this.onFeedsChanged)}render(){return this.state.feeds.map(((e,t)=>o.createElement(ko,{feed:e,key:t})))}}var Io=n("./node_modules/matrix-react-sdk/src/shouldHideEvent.ts"),To=n("./node_modules/matrix-react-sdk/src/TimezoneHandler.ts"),Po=n("./node_modules/matrix-react-sdk/src/utils/permalinks/Permalinks.ts"),No=n("./node_modules/matrix-react-sdk/src/ContentMessages.ts"),Do=n("./node_modules/re-resizable/lib/index.es5.js");class Mo extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"onResizeStart",(()=>{this.props.resizeNotifier.startResizing()})),(0,r.A)(this,"onResize",(()=>{this.props.resizeNotifier.notifyRightHandleResized()})),(0,r.A)(this,"onResizeStop",((e,t,n,i)=>{this.props.resizeNotifier.stopResizing(),window.localStorage.setItem(this.sizeSettingStorageKey,(this.loadSidePanelSize().width+i.width).toString())}))}get sizeSettingStorageKey(){let e="mx_rhs_size";return this.props.sizeKey&&(e+=`_${this.props.sizeKey}`),e}loadSidePanelSize(){let e=parseInt(window.localStorage.getItem(this.sizeSettingStorageKey),10);return isNaN(e)&&(e=this.props.defaultSize),{height:"100%",width:e}}render(){const e=o.Children.only(this.props.children),t=this.props.panel;let n;return!this.props.collapsedRhs&&t&&(n=o.createElement(Do.c,{key:this.props.sizeKey,defaultSize:this.loadSidePanelSize(),minWidth:264,maxWidth:"50%",enable:{top:!1,right:!1,bottom:!1,left:!0,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_RightPanel_ResizeWrapper",handleClasses:{left:"mx_ResizeHandle--horizontal"}},t)),o.createElement("div",{className:"mx_MainSplit"},e,n)}}(0,r.A)(Mo,"defaultProps",{defaultSize:350});var Oo=n("./node_modules/react/jsx-runtime.js");function Lo(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M13.905 9.378 12 5.52l-1.905 3.86-4.259.618 3.082 3.004-.727 4.242L12 15.24l3.81 2.003-.728-4.242 3.082-3.004-4.26-.619ZM8.767 7.55l2.336-4.733a1 1 0 0 1 1.794 0l2.336 4.733 5.223.76a1 1 0 0 1 .555 1.705L17.23 13.7l.892 5.202a1 1 0 0 1-1.45 1.054L12 17.5l-4.672 2.456a1 1 0 0 1-1.451-1.054l.892-5.202-3.78-3.685a1 1 0 0 1 .555-1.706l5.223-.759Z"})})}Lo.displayName="FavouriteIcon";const Uo=(0,o.forwardRef)(Lo);var Fo=n("./node_modules/@vector-im/compound-design-tokens/icons/user-add.svg");function jo(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M12 19.071c-.978.978-2.157 1.467-3.536 1.467-1.378 0-2.557-.489-3.535-1.467-.978-.978-1.467-2.157-1.467-3.536 0-1.378.489-2.557 1.467-3.535L7.05 9.879c.2-.2.436-.3.707-.3.271 0 .507.1.707.3.2.2.301.436.301.707 0 .27-.1.506-.3.707l-2.122 2.121a2.893 2.893 0 0 0-.884 2.122c0 .824.295 1.532.884 2.12.59.59 1.296.885 2.121.885s1.533-.295 2.122-.884l2.121-2.121c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707L12 19.07Zm-1.414-4.243c-.2.2-.436.3-.707.3a.967.967 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l4.243-4.242c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707l-4.242 4.242Zm6.364-.707c-.2.2-.436.3-.707.3a.968.968 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l2.122-2.121c.59-.59.884-1.297.884-2.122s-.295-1.532-.884-2.12a2.893 2.893 0 0 0-2.121-.885c-.825 0-1.532.295-2.122.884l-2.121 2.121c-.2.2-.436.301-.707.301a.968.968 0 0 1-.707-.3.97.97 0 0 1-.3-.708c0-.27.1-.506.3-.707L12 4.93c.978-.978 2.157-1.467 3.536-1.467 1.378 0 2.557.489 3.535 1.467.978.978 1.467 2.157 1.467 3.535 0 1.38-.489 2.558-1.467 3.536l-2.121 2.121Z"})})}jo.displayName="LinkIcon";const Bo=(0,o.forwardRef)(jo);function Vo(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Zm-2 0a2 2 0 1 0-4 0 2 2 0 0 0 4 0Z"}),(0,Oo.jsx)("path",{d:"M11.312 2h1.376A2.312 2.312 0 0 1 15 4.312v.247l.002.003c.01.014.031.033.064.047.03.013.056.013.07.01h.002l.177-.177a2.312 2.312 0 0 1 3.27 0l.973.974a2.312 2.312 0 0 1 0 3.269l-.177.177v.003a.134.134 0 0 0 .01.07.153.153 0 0 0 .047.063l.003.002h.247A2.312 2.312 0 0 1 22 11.312v1.376A2.312 2.312 0 0 1 19.688 15h-.247l-.003.002a.152.152 0 0 0-.047.064.134.134 0 0 0-.01.07v.002l.177.177a2.312 2.312 0 0 1 0 3.27l-.974.973a2.312 2.312 0 0 1-3.269 0l-.177-.177h-.003a.134.134 0 0 0-.07.01.152.152 0 0 0-.063.047l-.002.003v.247A2.312 2.312 0 0 1 12.688 22h-1.376A2.312 2.312 0 0 1 9 19.688v-.247l-.002-.003a.153.153 0 0 0-.064-.047.134.134 0 0 0-.07-.01h-.002l-.177.177a2.312 2.312 0 0 1-3.27 0l-.973-.974a2.312 2.312 0 0 1 0-3.269l.177-.177v-.003a.135.135 0 0 0-.01-.07.152.152 0 0 0-.047-.063L4.559 15h-.247A2.312 2.312 0 0 1 2 12.688v-1.376A2.312 2.312 0 0 1 4.312 9h.247l.003-.002a.153.153 0 0 0 .047-.064.135.135 0 0 0 .01-.07v-.002l-.177-.177a2.312 2.312 0 0 1 0-3.27l.974-.973a2.312 2.312 0 0 1 3.269 0l.177.177h.003a.135.135 0 0 0 .07-.01.153.153 0 0 0 .063-.047L9 4.559v-.247A2.312 2.312 0 0 1 11.312 2ZM11 4.312v.257c0 .893-.59 1.593-1.299 1.887-.716.297-1.622.21-2.248-.418l-.182-.182a.312.312 0 0 0-.441 0l-.974.974a.312.312 0 0 0 0 .44l.182.183c.627.626.715 1.531.418 2.248C6.162 10.41 5.462 11 4.569 11h-.257a.312.312 0 0 0-.312.312v1.376c0 .172.14.312.312.312h.257c.893 0 1.593.59 1.887 1.299.297.716.21 1.622-.418 2.248l-.182.182a.312.312 0 0 0 0 .441l.974.973a.31.31 0 0 0 .44 0l.183-.181c.626-.627 1.532-.715 2.248-.418.709.294 1.299.994 1.299 1.887v.257c0 .172.14.312.312.312h1.376c.172 0 .312-.14.312-.312v-.257c0-.893.59-1.593 1.299-1.887.716-.297 1.622-.21 2.248.418l.182.181c.122.122.32.122.441 0l.973-.973a.312.312 0 0 0 0-.44l-.181-.183c-.627-.627-.715-1.532-.418-2.248.294-.709.994-1.299 1.887-1.299h.257c.172 0 .312-.14.312-.312v-1.376a.312.312 0 0 0-.312-.312h-.257c-.893 0-1.593-.59-1.887-1.299-.297-.717-.21-1.622.418-2.248l.181-.182a.312.312 0 0 0 0-.441l-.973-.974a.312.312 0 0 0-.44 0l-.183.182c-.627.627-1.532.715-2.248.418C13.59 6.162 13 5.462 13 4.569v-.257A.312.312 0 0 0 12.688 4h-1.376a.312.312 0 0 0-.312.312Z"})]})}Vo.displayName="SettingsIcon";const Ho=(0,o.forwardRef)(Vo);var zo;function Wo(){return Wo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Wo.apply(null,arguments)}var Go=function(e,t){return o.createElement("svg",Wo({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),zo||(zo=o.createElement("path",{d:"M5 21q-.824 0-1.413-.587A1.93 1.93 0 0 1 3 19V6.5q0-.375.125-.675t.325-.575l1.4-1.7q.2-.274.5-.412T6 3h12q.35 0 .65.138.3.137.5.412l1.4 1.7q.2.275.325.575T21 6.5V19q0 .824-.587 1.413A1.93 1.93 0 0 1 19 21zm.4-15h13.2l-.85-1H6.25zM5 19h14V8H5zm7-1.425q.2 0 .375-.063a.9.9 0 0 0 .325-.212l2.6-2.6a.95.95 0 0 0 .275-.7.95.95 0 0 0-.275-.7.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275l-.9.9V11a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 10a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 11v3.2l-.9-.9a.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275.95.95 0 0 0-.275.7.95.95 0 0 0 .275.7l2.6 2.6q.15.15.325.212.175.063.375.063"})))},Ko=(0,o.forwardRef)(Go);var Jo=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/leave.js");function qo(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M6 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 20V4c0-.55.196-1.02.588-1.413A1.926 1.926 0 0 1 6 2h7.175a1.975 1.975 0 0 1 1.4.575l4.85 4.85a1.975 1.975 0 0 1 .575 1.4V20c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 22H6Zm7-14V4H6v16h12V9h-4a.968.968 0 0 1-.713-.287A.967.967 0 0 1 13 8Z"})})}qo.displayName="FilesIcon";const $o=(0,o.forwardRef)(qo);function Yo(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M16 10a.97.97 0 0 0 .712-.287A.967.967 0 0 0 17 9a.967.967 0 0 0-.288-.713A.968.968 0 0 0 16 8h-3a.968.968 0 0 0-.713.287A.967.967 0 0 0 12 9c0 .283.096.52.287.713.192.191.43.287.713.287h3Zm0 6a.97.97 0 0 0 .712-.287A.968.968 0 0 0 17 15a.968.968 0 0 0-.288-.713A.968.968 0 0 0 16 14h-3a.968.968 0 0 0-.713.287A.968.968 0 0 0 12 15c0 .283.096.52.287.713.192.191.43.287.713.287h3Zm-7-5c.55 0 1.02-.196 1.412-.588C10.804 10.021 11 9.55 11 9c0-.55-.196-1.02-.588-1.412A1.926 1.926 0 0 0 9 7c-.55 0-1.02.196-1.412.588A1.926 1.926 0 0 0 7 9c0 .55.196 1.02.588 1.412.391.392.862.588 1.412.588Zm0 6c.55 0 1.02-.196 1.412-.587.392-.392.588-.863.588-1.413s-.196-1.02-.588-1.412A1.926 1.926 0 0 0 9 13c-.55 0-1.02.196-1.412.588A1.926 1.926 0 0 0 7 15c0 .55.196 1.02.588 1.413.391.391.862.587 1.412.587Zm-4 4c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 3 19V5c0-.55.196-1.02.587-1.413A1.926 1.926 0 0 1 5 3h14c.55 0 1.02.196 1.413.587.39.393.587.863.587 1.413v14c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 19 21H5Zm0-2h14V5H5v14Z"})})}Yo.displayName="PollsIcon";const Qo=(0,o.forwardRef)(Yo);function Zo(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{fillRule:"evenodd",d:"M6.119 2a.5.5 0 0 0-.35.857L7.85 4.9a.5.5 0 0 1 .15.357v4.487a.5.5 0 0 1-.15.356l-3.7 3.644A.5.5 0 0 0 4 14.1v1.4a.5.5 0 0 0 .5.5H11v6a1 1 0 1 0 2 0v-6h6.5a.5.5 0 0 0 .5-.5v-1.4a.5.5 0 0 0-.15-.356l-3.7-3.644a.5.5 0 0 1-.15-.356V5.257a.5.5 0 0 1 .15-.357l2.081-2.043a.5.5 0 0 0-.35-.857H6.119ZM10 4h4v5.744a2.5 2.5 0 0 0 .746 1.781L17.26 14H6.74l2.514-2.475A2.5 2.5 0 0 0 10 9.744V4Z",clipRule:"evenodd"})})}Zo.displayName="PinIcon";const Xo=(0,o.forwardRef)(Zo);var es;function ts(){return ts=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ts.apply(null,arguments)}var ns=function(e,t){return o.createElement("svg",ts({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),es||(es=o.createElement("path",{d:"M6 22q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412A1.93 1.93 0 0 1 6 8h1V6q0-2.075 1.463-3.538Q9.925 1 12 1c2.075 0 2.563.488 3.537 1.462Q17 3.926 17 6v2h1q.824 0 1.413.588Q20 9.175 20 10v10q0 .824-.587 1.413A1.93 1.93 0 0 1 18 22zM9 8h6V6q0-1.25-.875-2.125A2.9 2.9 0 0 0 12 3q-1.25 0-2.125.875A2.9 2.9 0 0 0 9 6z"})))},is=(0,o.forwardRef)(ns);var rs;function os(){return os=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},os.apply(null,arguments)}var ss=function(e,t){return o.createElement("svg",os({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),rs||(rs=o.createElement("path",{d:"M6 22q-.824 0-1.413-.587A1.93 1.93 0 0 1 4 20V10q0-.825.587-1.412.318-.318.703-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 0 1-1.414 1.414l-.896-.896A1.94 1.94 0 0 1 18 22zm14-4.834V10q0-.825-.587-1.412A1.93 1.93 0 0 0 18 8h-1V6q0-2.075-1.463-3.538Q14.075 1 12 1c-2.075 0-2.563.488-3.538 1.462A4.9 4.9 0 0 0 7.243 4.41L9 6.166V6q0-1.25.875-2.125A2.9 2.9 0 0 1 12 3q1.25 0 2.125.875C15 4.75 15 5.167 15 6v2h-4.166z"})))},as=(0,o.forwardRef)(ss);function ls(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M12 22a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Zm-1-2.05V18c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 9 16v-1l-4.8-4.8c-.05.3-.096.6-.138.9-.041.3-.062.6-.062.9 0 2.017.662 3.783 1.987 5.3 1.325 1.517 2.996 2.4 5.013 2.65Zm6.9-2.55c.333-.367.633-.762.9-1.188a7.45 7.45 0 0 0 .662-1.325c.175-.458.309-.929.4-1.412.092-.483.138-.975.138-1.475a7.845 7.845 0 0 0-1.363-4.475A7.701 7.701 0 0 0 15 4.6V5c0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 13 7h-2v2c0 .283-.096.52-.287.713A.968.968 0 0 1 10 10H8v2h6c.283 0 .52.096.713.287.191.192.287.43.287.713v3h1c.433 0 .825.13 1.175.387.35.259.592.596.725 1.013Z"})})}ls.displayName="PublicIcon";const cs=(0,o.forwardRef)(ls);var ds,us=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/error.js");function ms(){return ms=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ms.apply(null,arguments)}var hs=function(e,t){return o.createElement("svg",ms({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),ds||(ds=o.createElement("path",{d:"M12 14.95q-.2 0-.375-.063a.9.9 0 0 1-.325-.212l-4.6-4.6a.95.95 0 0 1-.275-.7.95.95 0 0 1 .275-.7.95.95 0 0 1 .7-.275.95.95 0 0 1 .7.275l3.9 3.9 3.9-3.9a.95.95 0 0 1 .7-.275.95.95 0 0 1 .7.275.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7l-4.6 4.6q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})))},ps=(0,o.forwardRef)(hs);var gs=n("./node_modules/matrix-react-sdk/src/hooks/useIsEncrypted.ts"),vs=n("./node_modules/matrix-react-sdk/src/components/views/right_panel/BaseCard.tsx"),_s=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/ShareDialog.tsx"),fs=n("./node_modules/matrix-react-sdk/src/utils/ShieldUtils.ts"),ys=n("./node_modules/matrix-react-sdk/src/components/views/elements/RoomName.tsx"),Es=n("./node_modules/matrix-react-sdk/src/components/views/elements/StyledRadioGroup.tsx");let bs=function(e){return e.Html="Html",e.PlainText="PlainText",e.Json="Json",e}({}),ws=function(e){return e.Timeline="Timeline",e.Beginning="Beginning",e.LastNMessages="LastNMessages",e}({});const xs=e=>{switch(e){case bs.Html:return(0,C._t)("export_chat|html");case bs.Json:return(0,C._t)("export_chat|json");case bs.PlainText:return(0,C._t)("export_chat|text");default:throw new Error("Unknown format")}};var As=n("./node_modules/matrix-react-sdk/src/components/views/elements/Validation.tsx"),Ss=n("./node_modules/react-dom/index.js"),Cs=n("./node_modules/react-dom/server.browser.js"),ks=n("./node_modules/escape-html/index.js"),Rs=n.n(ks),Is=n("./node_modules/file-saver/dist/FileSaver.min.js"),Ts=n("./node_modules/sanitize-filename/index.js"),Ps=n.n(Ts),Ns=n("./node_modules/matrix-react-sdk/src/utils/DecryptFile.ts"),Ds=n("./node_modules/matrix-react-sdk/src/customisations/Media.ts"),Ms=n("./node_modules/matrix-react-sdk/src/DateUtils.ts"),Os=n("./node_modules/matrix-react-sdk/src/utils/EventUtils.ts");class Ls{constructor(e,t,n,i){if((0,r.A)(this,"files",[]),(0,r.A)(this,"cancelled",!1),this.room=e,this.exportType=t,this.exportOptions=n,this.setProgressText=i,n.maxSize<1048576||n.maxSize>8388608e3||n.numberOfMessages&&n.numberOfMessages>10**8||t===ws.LastNMessages&&!n.numberOfMessages)throw new Error("Invalid export options");window.addEventListener("beforeunload",this.onBeforeUnload)}get destinationFileName(){return this.makeFileNameNoExtension(g.Ay.get().brand)+".zip"}onBeforeUnload(e){return e.preventDefault(),e.returnValue=(0,C._t)("export_chat|unload_confirm")}updateProgress(e,t=!0,n=!0){t&&l.v.log(e),n&&this.setProgressText(e)}addFile(e,t){const n={name:e,blob:t};this.files.push(n)}makeFileNameNoExtension(e="matrix"){var t;const n=Ps()(null!==(t=this.room.name)&&void 0!==t?t:(0,C._t)("common|unnamed_room")).trim()||"Unnamed Room",i=(0,Ms.td)(new Date).replace(/:/g,"-");return`${Ps()(e)} - ${n} - Chat Export - ${i}`}async downloadZIP(){const e=this.destinationFileName,t=e.substring(0,e.lastIndexOf(".")),{default:i}=await n.e(1710).then(n.t.bind(n,"./node_modules/jszip/dist/jszip.min.js",23)),r=new i;if(this.cancelled)return this.cleanUp();this.updateProgress((0,C._t)("export_chat|generating_zip"));for(const e of this.files)r.file(t+"/"+e.name,e.blob);const o=await r.generateAsync({type:"blob"});(0,Is.saveAs)(o,t+".zip")}cleanUp(){return l.v.log("Cleaning up..."),window.removeEventListener("beforeunload",this.onBeforeUnload),""}async cancelExport(){l.v.log("Cancelling export..."),this.cancelled=!0}downloadPlainText(e,t){const n=new Blob([t],{type:"text/plain"});(0,Is.saveAs)(n,e)}setEventMetadata(e){const t=this.room.currentState,n=e.getSender();var i;(e.sender=!!n&&(null==t?void 0:t.getSentinelMember(n))||null,"m.room.member"===e.getType())&&(e.target=null!==(i=null==t?void 0:t.getSentinelMember(e.getStateKey()))&&void 0!==i?i:null);return e}getLimit(){let e;if(this.exportType===ws.LastNMessages)e=this.exportOptions.numberOfMessages;else e=10**8;return e}async getRequiredEvents(){const e=this.room.client.getEventMapper();let t=null,n=[];if(this.exportType===ws.Timeline)n=this.room.getLiveTimeline().getEvents();else{let r=this.getLimit();for(;r;){var i;const o=Math.min(r,1e3),a=await this.room.client.createMessagesRequest(this.room.roomId,t,o,s.Direction.Backward);if(this.cancelled)return this.cleanUp(),[];if(0===a.chunk.length)break;r-=a.chunk.length;const l=a.chunk.map(e);for(const e of l)n.push(e);this.exportType===ws.LastNMessages?this.updateProgress((0,C._t)("export_chat|fetched_n_events_with_total",{count:n.length,total:this.exportOptions.numberOfMessages})):this.updateProgress((0,C._t)("export_chat|fetched_n_events",{count:n.length})),t=null!==(i=a.end)&&void 0!==i?i:null}n.reverse()}const r=n.filter((e=>e.isEncrypted())).map((e=>this.room.client.decryptEventIfNeeded(e,{emit:!1})));await Promise.all(r);for(let e=0;e<n.length;e++)this.setEventMetadata(n[e]);return n}async getMediaBlob(e){let t;try{const n=e.isEncrypted(),i=e.getContent();if(n&&i.hasOwnProperty("file")&&"m.sticker"!==e.getType())t=await(0,Ns.It)(i.file);else{const e=(0,Ds.mA)(i);if(!e.srcHttp)throw new Error("Cannot fetch without srcHttp");const n=await fetch(e.srcHttp);t=await n.blob()}}catch(e){l.v.log("Error decrypting media")}if(!t)throw new Error("Unable to fetch file");return t}splitFileName(e){const t=e.lastIndexOf(".");if(-1===t)return[e,""];return[e.slice(0,t),"."+e.slice(t+1)]}getFilePath(e){let t;switch(e.getContent().msgtype){case"m.image":t="images";break;case"m.video":t="videos";break;case"m.audio":t="audio";break;default:t="m.sticker"===e.getType()?"stickers":"files"}const n=(0,Ms.ej)(new Date(e.getTs()));let[i,r]=this.splitFileName(e.getContent().body);return"m.sticker"===e.getType()&&(r=".png"),(0,Os.Mp)(e)&&(r=".ogg"),t+"/"+i+"-"+n+r}isReply(e){const t=(e.isEncrypted()?e.event.content:e.getContent())["m.relates_to"];return!(!t||!t["m.in_reply_to"])}isAttachment(e){const t=["m.sticker","m.image","m.file","m.video","m.audio"];return e.getType()===t[0]||t.includes(e.getContent().msgtype)}}var Us=n("./node_modules/matrix-react-sdk/src/settings/enums/Layout.ts"),Fs=n("./node_modules/matrix-react-sdk/src/components/views/rooms/EventTile.tsx");class js extends o.Component{constructor(e){super(e),(0,r.A)(this,"onMouseDown",(e=>{this.setState({location:{currentX:e.clientX,currentY:e.clientY}}),document.addEventListener("mousemove",this.state.onMouseMove),document.addEventListener("mouseup",this.state.onMouseUp)})),(0,r.A)(this,"onMouseUp",(e=>{document.removeEventListener("mousemove",this.state.onMouseMove),document.removeEventListener("mouseup",this.state.onMouseUp),this.props.onMouseUp(e)})),this.state={onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),location:{currentX:0,currentY:0}}}onMouseMove(e){const t=this.props.dragFunc(this.state.location,e);this.setState({location:t})}render(){return o.createElement("div",{className:this.props.className,onMouseDown:this.onMouseDown})}}class Bs extends o.Component{constructor(e){super(e),(0,r.A)(this,"dragFunc",((e,t)=>{const n=t.clientX-e.currentX,i=this.state.width+n;return i<this.props.minWidth||i>this.props.maxWidth?e:(this.setState({width:i}),this.updateCSSWidth.bind(this)(i),{currentX:t.clientX,currentY:e.currentY})})),(0,r.A)(this,"onMoueUp",(()=>{this.props.roomId&&O.A.setValue("ircDisplayNameWidth",this.props.roomId,re.p.ROOM_DEVICE,this.state.width)})),this.state={width:O.A.getValue("ircDisplayNameWidth",this.props.roomId),IRCLayoutRoot:null}}componentDidMount(){this.setState({IRCLayoutRoot:document.querySelector(".mx_IRCLayout")},(()=>this.updateCSSWidth(this.state.width)))}updateCSSWidth(e){var t;null===(t=this.state.IRCLayoutRoot)||void 0===t||t.style.setProperty("--name-width",e+"px")}render(){return o.createElement(js,{className:"mx_ProfileResizer",dragFunc:this.dragFunc,onMouseUp:this.onMoueUp})}}function Vs(e){return Hs(e,[e.client.getSafeUserId()].concat(e.client.getIgnoredUsers()))}function Hs(e,t=[]){const n=[],i=Object.keys(e.currentState.members);for(const r of i)e.currentState.members[r].typing&&-1===t.indexOf(r)&&n.push(e.currentState.members[r]);return n}var zs=n("./node_modules/matrix-react-sdk/src/utils/Timer.ts"),Ws=n("./node_modules/matrix-react-sdk/src/components/views/avatars/MemberAvatar.tsx");class Gs extends o.Component{constructor(...e){var t;super(...e),(0,r.A)(this,"state",{usersTyping:(t=this.props.room,Hs(t,[t.client.getSafeUserId()])),delayedStopTypingTimers:{}}),(0,r.A)(this,"isVisible",(()=>Gs.isVisible(this.state))),(0,r.A)(this,"onRoomTimeline",((e,t)=>{if((null==t?void 0:t.roomId)===this.props.room.roomId){const t=e.getSender(),n=this.state.usersTyping.filter((e=>e.userId!==t));n.length!==this.state.usersTyping.length&&this.setState({usersTyping:n}),this.abortUserTimer(t)}})),(0,r.A)(this,"onRoomMemberTyping",(()=>{const e=Vs(this.props.room);this.setState({delayedStopTypingTimers:this.updateDelayedStopTypingTimers(e),usersTyping:e})}))}componentDidMount(){h.J.safeGet().on(s.RoomMemberEvent.Typing,this.onRoomMemberTyping),h.J.safeGet().on(s.RoomEvent.Timeline,this.onRoomTimeline)}componentDidUpdate(e,t){const n=Gs.isVisible(t),i=Gs.isVisible(this.state);this.props.onShown&&!n&&i?this.props.onShown():this.props.onHidden&&n&&!i&&this.props.onHidden()}componentWillUnmount(){const e=h.J.get();e&&(e.removeListener(s.RoomMemberEvent.Typing,this.onRoomMemberTyping),e.removeListener(s.RoomEvent.Timeline,this.onRoomTimeline)),Object.values(this.state.delayedStopTypingTimers).forEach((e=>e.abort()))}static isVisible(e){return 0!==e.usersTyping.length||0!==Object.keys(e.delayedStopTypingTimers).length}updateDelayedStopTypingTimers(e){const t=this.state.usersTyping.filter((t=>!e.some((e=>t.userId===e.userId)))),n=e.filter((e=>!this.state.usersTyping.some((t=>e.userId===t.userId))));n.forEach((e=>{const t=this.state.delayedStopTypingTimers[e.userId];t&&t.abort()}));let i=Object.assign({},this.state.delayedStopTypingTimers);return i=n.reduce(((e,t)=>(delete e[t.userId],e)),i),i=t.reduce(((e,t)=>{if(!e[t.userId]){const n=new zs.A(5e3);e[t.userId]=n,n.start(),n.finished().then((()=>this.removeUserTimer(t.userId)),(()=>{}))}return e}),i),i}abortUserTimer(e){const t=this.state.delayedStopTypingTimers[e];t&&(t.abort(),this.removeUserTimer(e))}removeUserTimer(e){if(this.state.delayedStopTypingTimers[e]){const t=Object.assign({},this.state.delayedStopTypingTimers);delete t[e],this.setState({delayedStopTypingTimers:t})}}renderTypingIndicatorAvatars(e,t){let n=0;e.length>t&&(n=e.length-t+1,e=e.slice(0,t-1));const i=e.map((e=>o.createElement(Ws.A,{key:e.userId,member:e,size:"24px",resizeMethod:"crop",viewUserOnClick:!0,"aria-live":"off"})));return n>0&&i.push(o.createElement("span",{className:"mx_WhoIsTypingTile_remainingAvatarPlaceholder",key:"others"},"+",n)),i}render(){const e=[...this.state.usersTyping];for(const t in this.state.delayedStopTypingTimers){const n=this.props.room.getMember(t);n&&e.push(n)}const t=new Intl.Collator;e.sort(((e,n)=>t.compare(e.name,n.name)));const n=function(e,t){let n=0;if(e.length>t&&(n=e.length-t+1),0===e.length)return"";if(1===e.length)return(0,C._t)("timeline|typing_indicator|one_user",{displayName:e[0].name});const i=e.map((e=>e.name));if(n>=1)return(0,C._t)("timeline|typing_indicator|more_users",{names:i.slice(0,t-1).join(", "),count:n});{const e=i.pop();return(0,C._t)("timeline|typing_indicator|two_users",{names:i.join(", "),lastPerson:e})}}(e,this.props.whoIsTypingLimit);return n?o.createElement("li",{className:"mx_WhoIsTypingTile","aria-atomic":"true"},o.createElement("div",{className:"mx_WhoIsTypingTile_avatars"},this.renderTypingIndicatorAvatars(e,this.props.whoIsTypingLimit)),o.createElement("div",{className:"mx_WhoIsTypingTile_label"},n)):null}}(0,r.A)(Gs,"defaultProps",{whoIsTypingLimit:3});var Ks=n("./node_modules/matrix-react-sdk/src/components/structures/ScrollPanel.tsx"),Js=n("./node_modules/matrix-react-sdk/src/components/views/messages/DateSeparator.tsx"),qs=n("./node_modules/matrix-react-sdk/src/components/views/messages/TimelineSeparator.tsx"),$s=n("./node_modules/matrix-react-sdk/src/components/views/elements/ErrorBoundary.tsx"),Ys=n("./node_modules/matrix-react-sdk/src/utils/EventRenderingUtils.ts"),Qs=n("./node_modules/matrix-react-sdk/src/events/EventTileFactory.tsx"),Zs=n("./node_modules/matrix-react-sdk/src/Editing.ts");class Xs{constructor(e,t,n,i,o,s){(0,r.A)(this,"events",[]),(0,r.A)(this,"ejectedEvents",[]),(0,r.A)(this,"readMarker",void 0),this.panel=e,this.firstEventAndShouldShow=t,this.prevEvent=n,this.lastShownEvent=i,this.nextEvent=o,this.nextEventTile=s,this.readMarker=e.readMarkerForEvent(t.event.getId(),t.event===i)}}(0,r.A)(Xs,"canStartGroup",((e,t)=>!0));var ea=n("./node_modules/matrix-react-sdk/src/TextForEvent.tsx"),ta=n("./node_modules/matrix-react-sdk/src/components/views/messages/EventTileBubble.tsx");const na=()=>{var e;const{room:t}=(0,o.useContext)(Zr.Ay),n=null==t?void 0:t.getLiveTimeline().getState(s.EventTimeline.BACKWARDS),i=null==n||null===(e=n.getStateEvents("m.room.history_visibility")[0])||void 0===e?void 0:e.getContent().history_visibility;let r;return"invited"==i?r=(0,C._t)("timeline|no_permission_messages_before_invite"):"joined"==i&&(r=(0,C._t)("timeline|no_permission_messages_before_join")),o.createElement(ta.A,{className:"mx_HistoryTile",title:(0,C._t)("timeline|historical_messages_unavailable"),subtitle:r})};var ia=n("./node_modules/matrix-react-sdk/src/utils/FormattingUtils.ts");const ra=({events:e,children:t,threshold:n=3,onToggle:i,startExpanded:r=!1,summaryMembers:s=[],summaryText:a,layout:d=Us.P.Group})=>{const[u,m]=(0,on.X)(r);(0,o.useEffect)((()=>{i&&i()}),[u]);const h=e.map((e=>e.getId())).join(",");if(e.length<n)return o.createElement("li",{className:"mx_GenericEventListSummary","data-scroll-tokens":h,"data-expanded":!0,"data-layout":d},o.createElement("ol",{className:"mx_GenericEventListSummary_unstyledList"},t));let p;if(u)p=o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_GenericEventListSummary_spacer"}," "),o.createElement("ol",{className:"mx_GenericEventListSummary_unstyledList"},t));else{const e=(0,c.uniqBy)(s.filter((e=>!(null==e||!e.getMxcAvatarUrl)||(l.v.error("EventListSummary given null summaryMember, termites may be afoot eating event senders",s),!1))),(e=>e.getMxcAvatarUrl())).map((e=>o.createElement(Ws.A,{key:e.userId,member:e,size:"14px"})));p=o.createElement("div",{className:"mx_EventTile_line"},o.createElement("div",{className:"mx_EventTile_info"},o.createElement("span",{className:"mx_GenericEventListSummary_avatars",onClick:m},e),o.createElement("span",{className:"mx_TextualEvent mx_GenericEventListSummary_summary"},a)))}return o.createElement("li",{className:"mx_GenericEventListSummary","data-scroll-tokens":h,"data-expanded":u+"","data-layout":d},o.createElement(be.A,{kind:"link_inline",className:"mx_GenericEventListSummary_toggle",onClick:m,"aria-expanded":u},u?(0,C._t)("action|collapse"):(0,C._t)("action|expand")),p)};var oa=n("./node_modules/matrix-react-sdk/src/utils/ReactUtils.tsx");const sa=()=>{qn.A.instance.setCard({phase:$n.n.PinnedMessages},!1)},aa=[s.EventType.RoomMember];var la=function(e){return e.Joined="joined",e.Left="left",e.JoinedAndLeft="joined_and_left",e.LeftAndJoined="left_and_joined",e.InviteReject="invite_reject",e.InviteWithdrawal="invite_withdrawal",e.Invited="invited",e.Banned="banned",e.Unbanned="unbanned",e.Kicked="kicked",e.ChangedName="changed_name",e.ChangedAvatar="changed_avatar",e.NoChange="no_change",e.ServerAcl="server_acl",e.ChangedPins="pinned_messages",e.MessageRemoved="message_removed",e.HiddenEvent="hidden_event",e}(la||{});class ca extends o.Component{shouldComponentUpdate(e){return e.events.length!==this.props.events.length||e.events.length<this.props.threshold||e.layout!==this.props.layout}generateSummary(e,t){const n=t.map((t=>{const n=e[t],i=this.renderNameList(n),r=t.split(","),o=ca.getCanonicalTransitions(r),s=ca.coalesceRepeatedTransitions(o).map((e=>ca.getDescriptionForTransition(e.transitionType,n.length,e.repeats))),a=(0,ia.ki)(s);return(0,C._t)("timeline|summary|format",{nameList:i,transitionList:a})}));return n?(0,oa.i)(n,", "):null}renderNameList(e){return(0,ia.ki)(e,this.props.summaryLength)}static getCanonicalTransitions(e){const t={[la.Joined]:{after:la.Left,newTransition:la.JoinedAndLeft},[la.Left]:{after:la.Joined,newTransition:la.LeftAndJoined}},n=[];for(let i=0;i<e.length;i++){const r=e[i],o=e[i+1];let s=r;i<e.length-1&&t[r]&&t[r].after===o&&(s=t[r].newTransition,i++),n.push(s)}return n}static coalesceRepeatedTransitions(e){const t=[];for(const n of e)t.length>0&&t[t.length-1].transitionType===n?t[t.length-1].repeats+=1:t.push({transitionType:n,repeats:1});return t}static getDescriptionForTransition(e,t,n){var i;let r;switch(e){case la.Joined:r=t>1?(0,C._t)("timeline|summary|joined_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|joined",{oneUser:"",count:n});break;case la.Left:r=t>1?(0,C._t)("timeline|summary|left_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|left",{oneUser:"",count:n});break;case la.JoinedAndLeft:r=t>1?(0,C._t)("timeline|summary|joined_and_left_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|joined_and_left",{oneUser:"",count:n});break;case la.LeftAndJoined:r=t>1?(0,C._t)("timeline|summary|rejoined_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|rejoined",{oneUser:"",count:n});break;case la.InviteReject:r=t>1?(0,C._t)("timeline|summary|rejected_invite_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|rejected_invite",{oneUser:"",count:n});break;case la.InviteWithdrawal:r=t>1?(0,C._t)("timeline|summary|invite_withdrawn_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|invite_withdrawn",{oneUser:"",count:n});break;case la.Invited:r=t>1?(0,C._t)("timeline|summary|invited_multiple",{count:n}):(0,C._t)("timeline|summary|invited",{count:n});break;case la.Banned:r=t>1?(0,C._t)("timeline|summary|banned_multiple",{count:n}):(0,C._t)("timeline|summary|banned",{count:n});break;case la.Unbanned:r=t>1?(0,C._t)("timeline|summary|unbanned_multiple",{count:n}):(0,C._t)("timeline|summary|unbanned",{count:n});break;case la.Kicked:r=t>1?(0,C._t)("timeline|summary|kicked_multiple",{count:n}):(0,C._t)("timeline|summary|kicked",{count:n});break;case la.ChangedName:r=t>1?(0,C._t)("timeline|summary|changed_name_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|changed_name",{oneUser:"",count:n});break;case la.ChangedAvatar:r=t>1?(0,C._t)("timeline|summary|changed_avatar_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|changed_avatar",{oneUser:"",count:n});break;case la.NoChange:r=t>1?(0,C._t)("timeline|summary|no_change_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|no_change",{oneUser:"",count:n});break;case la.ServerAcl:r=t>1?(0,C._t)("timeline|summary|server_acls_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|server_acls",{oneUser:"",count:n});break;case la.ChangedPins:r=t>1?(0,C._t)("timeline|summary|pinned_events_multiple",{severalUsers:"",count:n},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:sa},e)}):(0,C._t)("timeline|summary|pinned_events",{oneUser:"",count:n},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:sa},e)});break;case la.MessageRemoved:r=t>1?(0,C._t)("timeline|summary|redacted_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|redacted",{oneUser:"",count:n});break;case la.HiddenEvent:r=t>1?(0,C._t)("timeline|summary|hidden_event_multiple",{severalUsers:"",count:n}):(0,C._t)("timeline|summary|hidden_event",{oneUser:"",count:n})}return null!==(i=r)&&void 0!==i?i:null}static getTransitionSequence(e){return e.map(ca.getTransition)}static getTransition(e){if(e.mxEvent.isRedacted())return la.MessageRemoved;switch(e.mxEvent.getType()){case s.EventType.RoomThirdPartyInvite:return(0,y.Qo)(e.mxEvent)?la.Invited:la.InviteWithdrawal;case s.EventType.RoomServerAcl:return la.ServerAcl;case s.EventType.RoomPinnedEvents:return la.ChangedPins;case s.EventType.RoomMember:switch(e.mxEvent.getContent().membership){case We.O.Invite:return la.Invited;case We.O.Ban:return la.Banned;case We.O.Join:return e.mxEvent.getPrevContent().membership===We.O.Join?e.mxEvent.getContent().displayname!==e.mxEvent.getPrevContent().displayname?la.ChangedName:e.mxEvent.getContent().avatar_url!==e.mxEvent.getPrevContent().avatar_url?la.ChangedAvatar:la.NoChange:la.Joined;case We.O.Leave:if(e.mxEvent.getSender()===e.mxEvent.getStateKey())return e.mxEvent.getPrevContent().membership===We.O.Invite?la.InviteReject:la.Left;switch(e.mxEvent.getPrevContent().membership){case We.O.Invite:return la.InviteWithdrawal;case We.O.Ban:return la.Unbanned;default:return la.Kicked}default:return null}default:return la.HiddenEvent}}getAggregate(e){const t={},n={};return Object.keys(e).forEach((i=>{const r=e[i][0],o=r.displayName,s=ca.getTransitionSequence(e[i]).join(",");t[s]||(t[s]=[],n[s]=-1),t[s].push(o),(-1===n[s]||r.index<n[s])&&(n[s]=r.index)})),{names:t,indices:n}}render(){const e=this.props.events,t=new Map,n={};e.forEach(((e,i)=>{var r;const o=e.getType();let a=e.getSender();e.isState()&&o===s.EventType.RoomThirdPartyInvite?a=e.getContent().display_name:e.isState()&&o===s.EventType.RoomMember?a=e.getStateKey():e.isRedacted()&&null!==(r=e.getUnsigned())&&void 0!==r&&r.redacted_because&&(a=e.getUnsigned().redacted_because.sender),n[a]||(n[a]=[]);let l=a;if(e.isRedacted()){var c;const e=null===(c=this.context)||void 0===c||null===(c=c.room)||void 0===c?void 0:c.getMember(a);e&&(l=e.name,t.set(a,e))}else e.target&&aa.includes(o)?(l=e.target.name,t.set(a,e.target)):e.sender&&o!==s.EventType.RoomThirdPartyInvite&&(l=e.sender.name,t.set(a,e.sender));n[a].push({mxEvent:e,displayName:l,index:i})}));const i=this.getAggregate(n),r=Object.keys(i.names).sort(((e,t)=>i.indices[e]-i.indices[t]));return o.createElement(ra,{events:this.props.events,threshold:this.props.threshold,onToggle:this.props.onToggle,startExpanded:this.props.startExpanded,children:this.props.children,summaryMembers:[...t.values()],layout:this.props.layout,summaryText:this.generateSummary(i.names,r)})}}(0,r.A)(ca,"contextType",Zr.Ay),(0,r.A)(ca,"defaultProps",{summaryLength:1,threshold:3,avatarsMaxLength:5,layout:Us.P.Group});const da=[s.EventType.RoomMember,s.EventType.RoomThirdPartyInvite,s.EventType.RoomServerAcl,s.EventType.RoomPinnedEvents];class ua extends Xs{constructor(e,t,n,i,r,o){super(e,t,n,i,r,o),this.panel=e,this.firstEventAndShouldShow=t,this.prevEvent=n,this.lastShownEvent=i,this.events=[t]}shouldGroup({event:e,shouldShow:t}){return!t||this.panel.wantsSeparator(this.events[0].event,e)!==qs.W.Date&&(!(!e.isState()||!da.includes(e.getType()))||(!!e.isRedacted()||!(!this.panel.showHiddenEvents||this.panel.shouldShowEvent(e,!0))))}add(e){const{event:t,shouldShow:n}=e;(t.getType()!==s.EventType.RoomMember||(0,ea.I3)(t,h.J.safeGet(),this.panel.showHiddenEvents))&&(this.readMarker=this.readMarker||this.panel.readMarkerForEvent(t.getId(),t===this.lastShownEvent),(this.panel.showHiddenEvents||n)&&(t.getType()!==s.EventType.RoomPinnedEvents||O.A.getValue("feature_pinning"))&&this.events.push(e))}generateKey(){return"eventlistsummary-"+this.events[0].event.getId()}getTiles(){var e;if(null===(e=this.events)||void 0===e||!e.length)return[];const t=this.panel,n=this.lastShownEvent,i=[];if(t.wantsSeparator(this.prevEvent,this.events[0].event)===qs.W.Date){const e=this.events[0].event.getTs();i.push(o.createElement("li",{key:e+"~"},o.createElement(Js.A,{roomId:this.events[0].event.getRoomId(),ts:e})))}const r=this.events.find((e=>this.panel.grouperKeyMap.get(e.event))),s=r&&this.panel.grouperKeyMap.has(r.event)?this.panel.grouperKeyMap.get(r.event):this.generateKey();r||this.panel.grouperKeyMap.set(this.events[0].event,s);let a=!1,l=this.events.map(((e,i)=>(e.event.getId()===t.props.highlightedEventId&&(a=!0),t.getTilesForEvent(0===i?this.prevEvent:this.events[i-1].event,e,e.event===n,true,this.nextEvent,this.nextEventTile)))).reduce(((e,t)=>e.concat(t)),[]);return 0===l.length&&(l=null),this.panel.props.canBackPaginate||this.prevEvent||i.push(o.createElement(na,{key:"historytile"})),i.push(o.createElement(ca,{key:s,events:this.events.map((e=>e.event)),onToggle:t.onHeightChanged,startExpanded:a,layout:this.panel.props.layout},l)),this.readMarker&&i.push(this.readMarker),i}getNewPrevEvent(){return this.events[this.events.length-1].event}}(0,r.A)(ua,"canStartGroup",(function(e,{event:t,shouldShow:n}){return!!n&&(!(!t.isState()||!da.includes(t.getType()))||(!!t.isRedacted()||!(!e.showHiddenEvents||e.shouldShowEvent(t,!0))))}));var ma=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/RoomSettingsDialog.tsx"),ha=n("./node_modules/matrix-react-sdk/src/utils/rooms.ts"),pa=n("./node_modules/matrix-react-sdk/src/models/LocalRoom.ts");const ga=e=>{if(!(0,ha.u)(e.client))return{shouldEncrypt:!1};if(!Ti.A.shared().getRoomIds().has(e.roomId))return{shouldEncrypt:!1};if(1!==e.getInvitedAndJoinedMemberCount())return{shouldEncrypt:!1};const t=e.currentState.getStateEvents("m.room.third_party_invite")||[];return 1===t.length?{shouldEncrypt:!0,inviteEvent:t[0]}:{shouldEncrypt:!1}};const va=()=>{var e;const t=(0,o.useContext)(Re.Ay),{room:n,roomId:i}=(0,o.useContext)(Zr.Ay);if(!n||!i)throw new Error("Unable to create a NewRoomIntro without room and roomId");const r=n instanceof pa.Np,a=r?null===(e=n.targets[0])||void 0===e?void 0:e.userId:Ti.A.shared().getUserIdForRoomId(i);let l;if(a){const{shouldEncrypt:e}=ga(n),t=((e,t)=>e instanceof pa.Np?(0,C.AO)("room|intro|send_message_start_dm"):t?(0,C.AO)("room|intro|encrypted_3pid_dm_pending_join"):(0,C.AO)("room|intro|start_of_dm_history"))(n,e);let i;n instanceof pa.Np||e||n.getJoinedMemberCount()+n.getInvitedMemberCount()!==2||(i=(0,C._t)("room|intro|dm_caption"));const r=null==n?void 0:n.getMember(a),s=(null==n?void 0:n.name)||(null==r?void 0:r.rawDisplayName)||a;l=o.createElement(o.Fragment,null,o.createElement(Ge.A,{room:n,size:to,onClick:()=>{v.Ay.dispatch({action:x.r.ViewUser,member:r||{userId:a}})}}),o.createElement("h2",null,n.name),o.createElement("p",null,(0,C._t)(t,{},{displayName:()=>o.createElement("b",null,s)})),i&&o.createElement("p",null,i))}else{var c,d,u,m,p;const e=n&&n.getMyMembership()===We.O.Join,r=null===(c=n.currentState.getStateEvents(s.EventType.RoomTopic,""))||void 0===c||null===(c=c.getContent())||void 0===c?void 0:c.topic,a=e&&n.currentState.maySendStateEvent(s.EventType.RoomTopic,t.getSafeUserId()),h=()=>{v.Ay.dispatch({action:"open_room_settings",room_id:i},!0),setTimeout((()=>{var e;null===(e=window.document.getElementById("profileTopic"))||void 0===e||e.focus()}))};let g;a&&r?g=(0,C._t)("room|intro|topic_edit",{topic:r},{a:e=>o.createElement(be.A,{element:"a",kind:"link_inline",onClick:h},e)}):r?g=(0,C._t)("room|intro|topic",{topic:r}):a&&(g=(0,C._t)("room|intro|no_topic",{},{a:e=>o.createElement(be.A,{element:"a",kind:"link_inline",onClick:h},e)}));const _=null===(d=n.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===d?void 0:d.getSender(),f=_&&(null==n||null===(u=n.getMember(_))||void 0===u?void 0:u.rawDisplayName)||_;let y,E,b;y=_===t.getUserId()?(0,C._t)("room|intro|you_created"):(0,C._t)("room|intro|user_created",{displayName:f}),null!==(m=xe.Ay.instance.activeSpaceRoom)&&void 0!==m&&m.canInvite(t.getSafeUserId())&&xe.Ay.instance.isRoomInSpace(xe.Ay.instance.activeSpace,n.roomId)&&(E=xe.Ay.instance.activeSpaceRoom),E&&(0,Ie.g)(W.C.InviteUsers)?b=o.createElement("div",{className:"mx_NewRoomIntro_buttons"},o.createElement(be.A,{className:"mx_NewRoomIntro_inviteButton",kind:"primary",onClick:()=>{(0,De.Lo)(E)}},(0,C._t)("invite|to_space",{spaceName:E.name})),n.canInvite(t.getSafeUserId())&&o.createElement(be.A,{className:"mx_NewRoomIntro_inviteButton",kind:"primary_outline",onClick:()=>{v.Ay.dispatch({action:"view_invite",roomId:i})}},(0,C._t)("room|intro|room_invite"))):n.canInvite(t.getSafeUserId())&&(0,Ie.g)(W.C.InviteUsers)&&(b=o.createElement("div",{className:"mx_NewRoomIntro_buttons"},o.createElement(be.A,{className:"mx_NewRoomIntro_inviteButton",kind:"primary",onClick:()=>{v.Ay.dispatch({action:"view_invite",roomId:i})}},(0,C._t)("room|invite_this_room"))));const w=null===(p=n.currentState.getStateEvents(s.EventType.RoomAvatar,""))||void 0===p||null===(p=p.getContent())||void 0===p?void 0:p.url;let x=o.createElement(Ge.A,{room:n,size:to,viewAvatarOnClick:!!w});w||(x=o.createElement(no,{hasAvatar:!1,noAvatarLabel:(0,C._t)("room|intro|no_avatar_label"),setAvatarUrl:e=>t.sendStateEvent(i,s.EventType.RoomAvatar,{url:e},"")},x)),l=o.createElement(o.Fragment,null,x,o.createElement("h2",null,n.name),o.createElement("p",null,y," ",(0,C._t)("room|intro|start_of_room",{},{roomName:()=>o.createElement("b",null,n.name)})),o.createElement("p",null,g),b)}const g=(0,C._t)("room|intro|private_unencrypted_warning");let _;n.currentState.mayClientSendStateEvent(s.EventType.RoomEncryption,h.J.safeGet())&&!r&&(_=o.createElement(be.A,{kind:"link_inline",onClick:function(e){e.preventDefault(),v.Ay.dispatch({action:"open_room_settings",initial_tab_id:ma.e.Security})}},(0,C._t)("room|intro|enable_encryption_prompt")));const f=o.createElement("span",null," ",g," ",_," ");return o.createElement("li",{className:"mx_NewRoomIntro"},!function(e,t){const n=e.isRoomEncrypted(t.roomId);return"public"===t.getJoinRule()||!(0,ha.u)(e)||n}(t,n)&&o.createElement(ta.A,{className:"mx_cryptoEvent mx_cryptoEvent_icon_warning",title:(0,C._t)("room|intro|unencrypted_warning"),subtitle:f}),l)};class _a extends Xs{shouldGroup({event:e,shouldShow:t}){const n=this.panel,i=this.firstEventAndShouldShow.event;if(!t)return!0;if(n.wantsSeparator(this.firstEventAndShouldShow.event,e)===qs.W.Date)return!1;const r=e.getType();return(r!==s.EventType.RoomMember||e.getStateKey()===i.getSender()&&e.getContent().membership===We.O.Join)&&(!s.M_BEACON_INFO.matches(r)&&(Pn.I$!==r&&!(!e.isState()||e.getSender()!==i.getSender())))}add(e){const{event:t,shouldShow:n}=e,i=this.panel;this.readMarker=this.readMarker||i.readMarkerForEvent(t.getId(),t===this.lastShownEvent),n&&(t.getType()===s.EventType.RoomEncryption?this.ejectedEvents.push(e):this.events.push(e))}getTiles(){var e,t;if(!this.events||!this.events.length)return[];const n=this.panel,i=[],r=!0,s=this.firstEventAndShouldShow,a=this.lastShownEvent;if(n.wantsSeparator(this.prevEvent,s.event)===qs.W.Date){const e=s.event.getTs();i.push(o.createElement("li",{key:e+"~"},o.createElement(Js.A,{roomId:s.event.getRoomId(),ts:e})))}s.shouldShow&&i.push(...n.getTilesForEvent(s.event,s));for(const e of this.ejectedEvents)i.push(...n.getTilesForEvent(s.event,e,s.event===a,r));const l=this.events.map((e=>n.getTilesForEvent(e.event,e,e.event===a,r))).reduce(((e,t)=>e.concat(t)),[]),c=this.events[this.events.length-1].event;let d;const u=c.getRoomId(),m=null!==(e=null===(t=c.sender)||void 0===t?void 0:t.name)&&void 0!==e?e:c.getSender();return d=u&&Ti.A.shared().getUserIdForRoomId(u)?(0,C._t)("timeline|creation_summary_dm",{creator:m}):(0,C._t)("timeline|creation_summary_room",{creator:m}),i.push(o.createElement(va,{key:"newroomintro"})),i.push(o.createElement(ra,{key:"roomcreationsummary",events:this.events.map((e=>e.event)),onToggle:n.onHeightChanged,summaryMembers:c.sender?[c.sender]:void 0,summaryText:d,layout:this.panel.props.layout},l)),this.readMarker&&i.push(this.readMarker),i}getNewPrevEvent(){return this.firstEventAndShouldShow.event}}(0,r.A)(_a,"canStartGroup",(function(e,{event:t}){return t.getType()===s.EventType.RoomCreate}));var fa=n("./node_modules/matrix-react-sdk/src/components/structures/grouper/LateEventGrouper.ts");const ya=[s.EventType.Sticker,s.EventType.RoomMessage];function Ea(e,t,n,i,r){return r!==Zr.Ae.ThreadsList&&(!(null==e||!e.sender||!t.sender)&&(!(t.getTs()-e.getTs()>3e5)&&(t.isRedacted()===e.isRedacted()&&(!!(t.getType()===e.getType()||ya.includes(t.getType())&&ya.includes(e.getType()))&&(t.sender.userId===e.sender.userId&&t.sender.name===e.sender.name&&t.sender.getMxcAvatarUrl()===e.sender.getMxcAvatarUrl()&&((!(0,Os.zr)(t)&&!(0,Os.zr)(e)||r===Zr.Ae.Thread)&&!!(0,Qs.bN)(e,n,i)))))))}class ba extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"readReceiptMap",{}),(0,r.A)(this,"readReceiptsByEvent",new Map),(0,r.A)(this,"readReceiptsByUserId",new Map),(0,r.A)(this,"_showHiddenEvents",void 0),(0,r.A)(this,"isMounted",!1),(0,r.A)(this,"readMarkerNode",(0,o.createRef)()),(0,r.A)(this,"whoIsTyping",(0,o.createRef)()),(0,r.A)(this,"scrollPanel",(0,o.createRef)()),(0,r.A)(this,"showTypingNotificationsWatcherRef",void 0),(0,r.A)(this,"eventTiles",{}),(0,r.A)(this,"grouperKeyMap",new WeakMap),(0,r.A)(this,"calculateRoomMembersCount",(()=>{this.setState({hideSender:this.shouldHideSender()})})),(0,r.A)(this,"onShowTypingNotificationsChange",(()=>{this.setState({showTypingNotifications:O.A.getValue("showTypingNotifications")})})),(0,r.A)(this,"isUnmounting",(()=>!this.isMounted)),(0,r.A)(this,"collectGhostReadMarker",(e=>{e&&requestAnimationFrame((()=>{e.style.width="10%",e.style.opacity="0"}))})),(0,r.A)(this,"onGhostTransitionEnd",(e=>{const t=e.target.dataset.eventid;this.setState({ghostReadMarkers:this.state.ghostReadMarkers.filter((e=>e!==t))})})),(0,r.A)(this,"collectEventTile",((e,t)=>{this.eventTiles[e]=t})),(0,r.A)(this,"onHeightChanged",(()=>{const e=this.scrollPanel.current;e&&e.checkScroll()})),(0,r.A)(this,"onTypingShown",(()=>{const e=this.scrollPanel.current;null==e||e.checkScroll(),e&&e.getScrollState().stuckAtBottom&&e.preventShrinking()})),(0,r.A)(this,"onTypingHidden",(()=>{const e=this.scrollPanel.current;e&&(e.updatePreventShrinking(),e.checkScroll())})),this.state={ghostReadMarkers:[],showTypingNotifications:O.A.getValue("showTypingNotifications"),hideSender:this.shouldHideSender()},this._showHiddenEvents=O.A.getValue("showHiddenEventsInTimeline"),this.showTypingNotificationsWatcherRef=O.A.watchSetting("showTypingNotifications",null,this.onShowTypingNotificationsChange)}componentDidMount(){var e;this.calculateRoomMembersCount(),null===(e=this.props.room)||void 0===e||e.currentState.on(s.RoomStateEvent.Update,this.calculateRoomMembersCount),this.isMounted=!0}componentWillUnmount(){var e;this.isMounted=!1,null===(e=this.props.room)||void 0===e||e.currentState.off(s.RoomStateEvent.Update,this.calculateRoomMembersCount),O.A.unwatchSetting(this.showTypingNotificationsWatcherRef),this.readReceiptMap={}}componentDidUpdate(e,t){if(e.layout!==this.props.layout&&this.calculateRoomMembersCount(),e.readMarkerVisible&&e.readMarkerEventId&&this.props.readMarkerEventId!==e.readMarkerEventId){const t=this.state.ghostReadMarkers;t.push(e.readMarkerEventId),this.setState({ghostReadMarkers:t})}const n=this.pendingEditItem;if(!this.props.editState&&this.props.room&&n){const e=this.props.room.findEventById(n);v.Ay.dispatch({action:x.r.EditEvent,event:null!=e&&e.isRedacted()?null:e,timelineRenderingType:this.context.timelineRenderingType})}}shouldHideSender(){return!!this.props.room&&this.props.room.getInvitedAndJoinedMemberCount()<=2&&this.props.layout===Us.P.Bubble}getNodeForEventId(e){var t,n;if(this.eventTiles)return null!==(t=null===(n=this.eventTiles[e])||void 0===n||null===(n=n.ref)||void 0===n?void 0:n.current)&&void 0!==t?t:void 0}getTileForEventId(e){if(this.eventTiles&&e)return this.eventTiles[e]}isAtBottom(){var e;return null===(e=this.scrollPanel.current)||void 0===e?void 0:e.isAtBottom()}getScrollState(){var e,t;return null!==(e=null===(t=this.scrollPanel.current)||void 0===t?void 0:t.getScrollState())&&void 0!==e?e:null}getReadMarkerPosition(){const e=this.readMarkerNode.current,t=this.scrollPanel.current;if(!e||!t)return null;const n=Ss.findDOMNode(t).getBoundingClientRect(),i=e.getBoundingClientRect();return i.bottom+2<n.top?-1:i.top<n.bottom?0:1}scrollToTop(){var e;null===(e=this.scrollPanel.current)||void 0===e||e.scrollToTop()}scrollToBottom(){var e;null===(e=this.scrollPanel.current)||void 0===e||e.scrollToBottom()}handleScrollKey(e){var t;null===(t=this.scrollPanel.current)||void 0===t||t.handleScrollKey(e)}scrollToEvent(e,t,n){var i;null===(i=this.scrollPanel.current)||void 0===i||i.scrollToToken(e,t,n)}scrollToEventIfNeeded(e){const t=this.getNodeForEventId(e);t&&t.scrollIntoView({block:"nearest",behavior:"instant"})}get showHiddenEvents(){var e,t;return null!==(e=null===(t=this.context)||void 0===t?void 0:t.showHiddenEvents)&&void 0!==e?e:this._showHiddenEvents}shouldShowEvent(e,t=!1){if(this.props.hideThreadedMessages&&this.props.room){const{shouldLiveInRoom:t}=this.props.room.eventShouldLiveIn(e,this.props.events);if(!t)return!1}return!h.J.safeGet().isUserIgnored(e.getSender())&&(!(!this.showHiddenEvents||t)||!!(0,Qs.bN)(e,h.J.safeGet(),this.showHiddenEvents)&&(this.props.highlightedEventId===e.getId()||!(0,Io.A)(e,this.context)))}readMarkerForEvent(e,t){const n=!t&&this.props.readMarkerVisible;if(this.props.readMarkerEventId===e){let t;return n&&(t=o.createElement("hr",{style:{opacity:1,width:"99%"}})),o.createElement("li",{key:"readMarker_"+e,ref:this.readMarkerNode,className:"mx_MessagePanel_myReadMarker","data-scroll-tokens":e},t)}if(this.state.ghostReadMarkers.includes(e)){const t=o.createElement("hr",{ref:this.collectGhostReadMarker,onTransitionEnd:this.onGhostTransitionEnd,"data-eventid":e});return o.createElement("li",{key:"_readuptoghost_"+e,className:"mx_MessagePanel_myReadMarker"},t)}return null}getNextEventInfo(e,t){const n=t<e.length-1?e[t+1]:null,i=function(e,t){for(let n=e+1;n<t.length;n++){const{event:e,shouldShow:i}=t[n];if(i)return e}return null}(t,e);return{nextEventAndShouldShow:n,nextTile:i}}get pendingEditItem(){if(!this.props.room)return null;try{return localStorage.getItem((0,Zs.O)(this.props.room.roomId,this.context.timelineRenderingType))}catch(e){return l.v.error(e),null}}isSentState(e){const t=e.getAssociatedStatus();return!t||t===s.EventStatus.SENT}getEventTiles(){let e;const t=this.props.events.map((e=>({event:e,shouldShow:this.shouldShowEvent(e)}))),n=h.J.safeGet().getSafeUserId();let i=!1,r=-1;for(let o=t.length-1;o>=0;o--){const{event:s,shouldShow:a}=t[o];if(a&&(void 0===e&&(e=s),!i&&this.isSentState(s)&&(0,Fs.CH)(s)&&(i=!0,s.getSender()===n&&(t[o].lastSuccessfulWeSent=!0)),r<0&&!s.status&&(r=o),r>=0&&i))break}const o=[];let s=null;this.readReceiptsByEvent=new Map,this.props.showReadReceipts&&(this.readReceiptsByEvent=this.getReadReceiptsByShownEvent(t));let a=null;for(let n=0;n<t.length;n++){const i=t[n],{event:l,shouldShow:c}=i,d=l.getId(),u=l===e,{nextEventAndShouldShow:m,nextTile:h}=this.getNextEventInfo(t,n);if(a){if(a.shouldGroup(i)){a.add(i);continue}o.push(...a.getTiles()),s=a.getNewPrevEvent(),a=null}for(const t of wa)if(t.canStartGroup(this,i)&&!this.props.disableGrouping){a=new t(this,i,s,e,m,h);break}if(!a){c&&(o.push(...this.getTilesForEvent(s,i,u,!1,m,h)),s=l);const e=this.readMarkerForEvent(d,n>=r);e&&o.push(e)}}return a&&o.push(...a.getTiles()),o}getTilesForEvent(e,t,n=!1,i=!1,r=null,s=null){var a,l,c;const d=t.event,u=[],m=(null===(a=this.props.editState)||void 0===a?void 0:a.getEvent().getId())===d.getId(),p=null!==(l=d.getTs())&&void 0!==l?l:Date.now(),g=this.wantsSeparator(e,d);if(!i&&this.props.room)if(g===qs.W.Date)u.push(o.createElement("li",{key:p},o.createElement(Js.A,{key:p,roomId:this.props.room.roomId,ts:p})));else if(g===qs.W.LateEvent){var v;const e=(0,C._t)("timeline|late_event_separator",{dateTime:(0,Ms.Yq)(null!==(v=d.getDate())&&void 0!==v?v:new Date)});u.push(o.createElement("li",{key:p},o.createElement(qs.A,{key:p,label:e},e)))}const _=h.J.safeGet();let f=!0;if(s){const e=s;f=this.wantsSeparator(d,e)===qs.W.Date||d.getSender()!==e.getSender()||(0,Ys.v)(_,e,this.showHiddenEvents).isInfoMessage||!Ea(d,e,_,this.showHiddenEvents,this.context.timelineRenderingType)}const y=g===qs.W.None&&Ea(e,d,_,this.showHiddenEvents,this.context.timelineRenderingType),E=d.getId(),b=E===this.props.highlightedEventId,w=this.readReceiptsByEvent.get(E),x=this.props.callEventGroupers.get(d.getContent().call_id);return u.push(o.createElement(Fs.Ay,{key:d.getTxnId()||E,as:"li",ref:this.collectEventTile.bind(this,E),alwaysShowTimestamps:this.props.alwaysShowTimestamps,mxEvent:d,continuation:y,isRedacted:d.isRedacted(),replacingEventId:d.replacingEventId(),editState:m?this.props.editState:void 0,onHeightChanged:this.onHeightChanged,readReceipts:w,readReceiptMap:this.readReceiptMap,showUrlPreview:this.props.showUrlPreview,checkUnmounting:this.isUnmounting,eventSendStatus:null!==(c=d.getAssociatedStatus())&&void 0!==c?c:void 0,isTwelveHour:this.props.isTwelveHour,permalinkCreator:this.props.permalinkCreator,last:n,lastInSection:f,lastSuccessful:t.lastSuccessfulWeSent,isSelectedEvent:b,getRelationsForEvent:this.props.getRelationsForEvent,showReactions:this.props.showReactions,layout:this.props.layout,showReadReceipts:this.props.showReadReceipts,callEventGrouper:x,hideSender:this.state.hideSender})),u}wantsSeparator(e,t){var n;if(this.context.timelineRenderingType===Zr.Ae.ThreadsList)return qs.W.None;if(null!==e){var i;const n=(0,fa.R)(t);if((null==n?void 0:n.group_id)!==(null===(i=(0,fa.R)(e))||void 0===i?void 0:i.group_id))return void 0!==n?qs.W.LateEvent:qs.W.Date}if(null===e&&!this.props.canBackPaginate)return qs.W.Date;const r=null!==(n=t.getDate())&&void 0!==n?n:new Date;return null!==e&&(0,Ms.fq)(e.getDate()||void 0,r)?qs.W.Date:qs.W.None}getReadReceiptsForEvent(e){const t=h.J.safeGet().credentials.userId,{room:n}=this.props;if(!n)return null;const i=this.context.threadId?n.getThread(this.context.threadId):n,r=[];return i?(i.getReceiptsForEvent(e).forEach((e=>{if(!e.userId||!(0,a.ll)(e.type)||e.userId===t)return;if(h.J.safeGet().isUserIgnored(e.userId))return;const i=n.getMember(e.userId);r.push({userId:e.userId,roomMember:i,ts:e.data?e.data.ts:0})})),r):(l.v.debug("Discarding request, could not find the receiptDestination for event: "+this.context.threadId),r)}getReadReceiptsByShownEvent(e){const t=new Map,n=new Map;let i;for(const e of this.props.events){if(this.shouldShowEvent(e)&&(i=e.getId()),!i)continue;const r=t.get(i)||[],o=this.getReadReceiptsForEvent(e);if(o){t.set(i,r.concat(o));for(const e of o)n.set(e.userId,{lastShownEventId:i,receipt:e})}}for(const e of this.readReceiptsByUserId.keys()){if(n.get(e))continue;const{lastShownEventId:i,receipt:r}=this.readReceiptsByUserId.get(e),o=t.get(i)||[];t.set(i,o.concat(r)),n.set(e,{lastShownEventId:i,receipt:r})}this.readReceiptsByUserId=n;for(const e of t.values())e.sort(((e,t)=>t.ts-e.ts));return t}updateTimelineMinHeight(){const e=this.scrollPanel.current;if(e){const t=e.isAtBottom(),n=this.whoIsTyping.current,i=n&&n.isVisible();t&&i&&e.preventShrinking()}}onTimelineReset(){const e=this.scrollPanel.current;e&&e.clearPreventShrinking()}render(){let e,t;this.props.backPaginating&&(e=o.createElement("li",{key:"_topSpinner"},o.createElement(dn.A,null))),this.props.forwardPaginating&&(t=o.createElement("li",{key:"_bottomSpinner"},o.createElement(dn.A,null)));const n=this.props.hidden?{display:"none"}:{};let i,r;var s,a;(this.props.room&&this.state.showTypingNotifications&&this.context.timelineRenderingType===Zr.Ae.Room&&(i=o.createElement(Gs,{room:this.props.room,onShown:this.onTypingShown,onHidden:this.onTypingHidden,ref:this.whoIsTyping})),this.props.layout==Us.P.IRC)&&(r=o.createElement(Bs,{minWidth:20,maxWidth:600,roomId:null!==(s=null===(a=this.props.room)||void 0===a?void 0:a.roomId)&&void 0!==s?s:null}));const l=ee()(this.props.className,{mx_MessagePanel_narrow:this.context.narrow});return o.createElement($s.A,null,o.createElement(Ks.A,{ref:this.scrollPanel,className:l,onScroll:this.props.onScroll,onFillRequest:this.props.onFillRequest,onUnfillRequest:this.props.onUnfillRequest,style:n,stickyBottom:this.props.stickyBottom,resizeNotifier:this.props.resizeNotifier,fixedChildren:r},e,this.getEventTiles(),i,t))}}(0,r.A)(ba,"contextType",Zr.Ay),(0,r.A)(ba,"defaultProps",{disableGrouping:!1});const wa=[_a,ua];var xa=n("./node_modules/matrix-react-sdk/src/Avatar.ts"),Aa=n("./node_modules/raw-loader/dist/cjs.js!./node_modules/matrix-react-sdk/src/utils/exportUtils/exportCustomCSS.css");const Sa=/\.[\w-]+/g;function Ca(e){const t="-apple-system, BlinkMacSystemFont, avenir next,\n            avenir, segoe ui, helvetica neue, helvetica, Ubuntu, roboto, noto, arial, sans-serif";return e.replace(/font-family: ?(Inter|'Inter'|"Inter")/g,`font-family: ${t}`).replace(/--cpd-font-family-sans: ?(Inter|'Inter'|"Inter")/g,`--cpd-font-family-sans: ${t}`).replace(/font-family: ?Inconsolata/g,"font-family: Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace")}function ka(e,t){return"Raw"!==e.prelude.type||!e.block.children.isEmpty&&e.prelude.value.split(",").some((e=>{const n=e.trim().match(Sa);return!(n&&!n.every((e=>t.has(e.substring(1)))))}))}const Ra=async e=>{const t=await n.e(1607).then(n.bind(n,"./node_modules/css-tree/lib/index.js")),i=["bundle.css","theme-light.css"].map((e=>{var t;return null===(t=document.querySelector(`link[rel="stylesheet"][href$="${e}"]`))||void 0===t?void 0:t.href}));let r="";for(const n of i){if(!n)continue;const i=await fetch(n),o=await i.text(),s=t.parse(o,{context:"stylesheet",parseAtrulePrelude:!1,parseRulePrelude:!1,parseValue:!1,parseCustomProperty:!1});for(const n of s.children)"Atrule"===n.type&&"font-face"===n.name||("Rule"!==n.type||ka(n,e))&&(r+=Ca(t.generate(n)))}return r+Aa.A};var Ia=n("./node_modules/buffer/index.js").hp;class Ta extends Ls{constructor(e,t,n,i){super(e,t,n,i),(0,r.A)(this,"avatars",void 0),(0,r.A)(this,"permalinkCreator",void 0),(0,r.A)(this,"totalSize",void 0),(0,r.A)(this,"mediaOmitText",void 0),this.avatars=new Map,this.permalinkCreator=new Po.pE(this.room),this.totalSize=0,this.mediaOmitText=this.exportOptions.attachmentsIncluded?(0,C._t)("export_chat|media_omitted_file_size"):(0,C._t)("export_chat|media_omitted")}async getRoomAvatar(){let e;const t=xa.ze(this.room,32,32,"crop"),n="room.png";if(t)try{const i=await fetch(t);e=await i.blob(),this.totalSize+=e.size,this.addFile(n,e)}catch(e){l.v.log("Failed to fetch room's avatar"+e)}const i=o.createElement(xn.A,{size:"32px",name:this.room.name,title:this.room.name,url:e?n:""});return(0,Cs.renderToStaticMarkup)(i)}async wrapHTML(e,t,n){var i,r,a,l;const c=await this.getRoomAvatar(),d=(0,Ms.Ah)(new Date),u=null===(i=this.room.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===i?void 0:i.getSender(),m=(u?null===(r=this.room.getMember(u))||void 0===r?void 0:r.rawDisplayName:u)||u,h=this.room.client.getSafeUserId(),p=null===(a=this.room.getMember(h))||void 0===a?void 0:a.rawDisplayName,g=(null===(l=this.room.currentState.getStateEvents(s.EventType.RoomTopic,""))||void 0===l||null===(l=l.getContent())||void 0===l?void 0:l.topic)||"",v=Rs()((0,C._t)("export_chat|creator_summary",{creatorName:m})),_=Rs()(h),f=Rs()(this.room.name),y=Rs()(g),E=(0,Cs.renderToStaticMarkup)(o.createElement("p",null,(0,C._t)("export_chat|export_info",{exportDate:d},{roomName:()=>o.createElement("b",null,f),exporterDetails:()=>o.createElement("a",{href:`https://matrix.to/#/${encodeURIComponent(h)}`,target:"_blank",rel:"noopener noreferrer"},p?o.createElement(o.Fragment,null,o.createElement("b",null,Rs()(p)),"I "," ("+_+")"):o.createElement("b",null,_))}))),b=g?(0,C._t)("export_chat|topic",{topic:y}):"",w=(0,Cs.renderToStaticMarkup)(0!==t?o.createElement("div",{style:{textAlign:"center"}},o.createElement("a",{href:`./messages${1===t?"":t}.html`,style:{fontWeight:"bold"}},(0,C._t)("export_chat|previous_page"))):o.createElement(o.Fragment,null)),x=(0,Cs.renderToStaticMarkup)(t<n-1?o.createElement("div",{style:{textAlign:"center",margin:"10px"}},o.createElement("a",{href:"./messages"+(t+2)+".html",style:{fontWeight:"bold"}},(0,C._t)("export_chat|next_page"))):o.createElement(o.Fragment,null));return`\n          <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8" />\n                <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n                <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n                <link href="css/style.css" rel="stylesheet" />\n                <script src="js/script.js"><\/script>\n                <title>${(0,C._t)("export_chat|html_title")}</title>\n            </head>\n            <body style="height: 100vh;" class="cpd-theme-light">\n                <div id="matrixchat" style="height: 100%; overflow: auto">\n                    <div class="mx_MatrixChat_wrapper" aria-hidden="false">\n                        <div class="mx_MatrixChat">\n                        <main class="mx_RoomView">\n                            <div class="mx_LegacyRoomHeader light-panel">\n                            <div class="mx_LegacyRoomHeader_wrapper" aria-owns="mx_RightPanel">\n                                <div class="mx_LegacyRoomHeader_avatar">\n                                <div class="mx_DecoratedRoomAvatar">\n                                   ${c}\n                                </div>\n                                </div>\n                                <div class="mx_LegacyRoomHeader_name">\n                                <div\n                                    dir="auto"\n                                    class="mx_LegacyRoomHeader_nametext"\n                                    title="${f}"\n                                >\n                                    ${f}\n                                </div>\n                                </div>\n                                <div class="mx_LegacyRoomHeader_topic" dir="auto"> ${y} </div>\n                            </div>\n                            </div>\n                            ${w}\n                            <div class="mx_MainSplit">\n                            <div class="mx_RoomView_body">\n                                <div\n                                class="mx_RoomView_timeline mx_RoomView_timeline_rr_enabled"\n                                >\n                                <div\n                                    class="\n                                    mx_AutoHideScrollbar\n                                    mx_ScrollPanel\n                                    mx_RoomView_messagePanel\n                                    "\n                                >\n                                    <div class="mx_RoomView_messageListWrapper">\n                                    <ol\n                                        class="mx_RoomView_MessageList"\n                                        aria-live="polite"\n                                        role="list"\n                                    >\n                                    ${0==t?`<div class="mx_NewRoomIntro">\n                                            ${c}\n                                            <h2> ${f} </h2>\n                                            <p> ${v} <br/><br/> ${E} </p>\n                                            <br/>\n                                            <p> ${b} </p>\n                                        </div>`:""}\n                                    ${e}\n                                    </ol>\n                                    </div>\n                                </div>\n                                </div>\n                                <div class="mx_RoomView_statusArea">\n                                <div class="mx_RoomView_statusAreaBox">\n                                    <div class="mx_RoomView_statusAreaBox_line"></div>\n                                </div>\n                                </div>\n                            </div>\n                            </div>\n                            ${x}\n                        </main>\n                        </div>\n                    </div>\n                </div>\n                <div id="snackbar"/>\n            </body>\n        </html>`}getAvatarURL(e){const t=e.sender,n=null==t?void 0:t.getMxcAvatarUrl();return n?(0,Ds.lH)(n).getThumbnailOfSourceHttp(30,30,"crop"):null}async saveAvatarIfNeeded(e){const t=e.sender;if(!this.avatars.has(t.userId))try{const n=this.getAvatarURL(e);this.avatars.set(t.userId,!0);const i=await fetch(n),r=await i.blob();this.addFile(`users/${t.userId.replace(/:/g,"-")}.png`,r)}catch(e){l.v.log("Failed to fetch user's avatar"+e)}}getDateSeparator(e){const t=e.getTs(),n=o.createElement("li",{key:t},o.createElement(Js.A,{forExport:!0,key:t,roomId:e.getRoomId(),ts:t}));return(0,Cs.renderToStaticMarkup)(n)}needsDateSeparator(e,t){return!t||(0,Ms.fq)(t.getDate()||void 0,e.getDate()||void 0)}getEventTile(e,t){return o.createElement("div",{className:"mx_Export_EventWrapper",id:e.getId()},o.createElement(Re.Ay.Provider,{value:this.room.client},o.createElement(Fs.Ay,{mxEvent:e,continuation:t,isRedacted:e.isRedacted(),replacingEventId:e.replacingEventId(),forExport:!0,alwaysShowTimestamps:!0,showUrlPreview:!1,checkUnmounting:()=>!1,isTwelveHour:!1,last:!1,lastInSection:!1,permalinkCreator:this.permalinkCreator,lastSuccessful:!1,isSelectedEvent:!1,showReactions:!1,layout:Us.P.Group,showReadReceipts:!1})))}async getEventTileMarkup(e,t,n){const i=this.getAvatarURL(e),r=!!i;r&&await this.saveAvatarIfNeeded(e);const o=this.getEventTile(e,t);let a;if(e.getContent().msgtype==s.MsgType.Emote||e.getContent().msgtype==s.MsgType.Notice||e.getContent().msgtype===s.MsgType.Text){const e=document.createElement("div");Ss.render(o,e),a=e.innerHTML}else a=(0,Cs.renderToStaticMarkup)(o);if(n){var l,c;const t=null!==(l=e.getContent().url)&&void 0!==l?l:null===(c=e.getContent().file)||void 0===c?void 0:c.url;a=a.split(t).join(n)}return a=a.replace(/<span class="mx_MFileBody_info_icon".*?>.*?<\/span>/,""),r&&(a=a.replace(encodeURI(i).replace(/&/g,"&amp;"),`users/${e.sender.userId.replace(/:/g,"-")}.png`)),a}createModifiedEvent(e,t,n=!0){const i={msgtype:s.MsgType.Text,body:`${e}`,format:"org.matrix.custom.html",formatted_body:`${e}`};n&&(i.formatted_body="<em>"+i.formatted_body+"</em>",i.body="*"+i.body+"*");const r=new s.MatrixEvent;return r.event=t.event,r.sender=t.sender,r.event.type="m.room.message",r.event.content=i,r}async createMessageBody(e,t=!1){let n;try{if(this.isAttachment(e))if(this.exportOptions.attachmentsIncluded)try{const i=await this.getMediaBlob(e);if(this.totalSize+i.size>this.exportOptions.maxSize)n=await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText,e),t);else{this.totalSize+=i.size;const r=this.getFilePath(e);n=await this.getEventTileMarkup(e,t,r),this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1),this.addFile(r,i)}}catch(i){l.v.log("Error while fetching file"+i),n=await this.getEventTileMarkup(this.createModifiedEvent((0,C._t)("export_chat|error_fetching_file"),e),t)}else n=await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText,e),t);else n=await this.getEventTileMarkup(e,t)}catch(i){l.v.error(i),n=await this.getEventTileMarkup(this.createModifiedEvent((0,ea.Rd)(e,this.room.client),e,!1),t)}return n}async createHTML(e,t,n,i){let r="",o=null;for(let n=t;n<Math.min(t+1e3,e.length);n++){const t=e[n];if(this.updateProgress((0,C._t)("export_chat|processing_event_n",{number:n+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();if(!(0,Qs.bN)(t,this.room.client,!1))continue;r+=this.needsDateSeparator(t,o)?this.getDateSeparator(t):"";const i=!this.needsDateSeparator(t,o)&&Ea(o,t,this.room.client,!1),s=await this.createMessageBody(t,i);this.totalSize+=Ia.byteLength(s),r+=s,o=t}return this.wrapHTML(r,n,i)}async export(){this.updateProgress((0,C._t)("export_chat|starting_export"));const e=performance.now(),t=await this.getRequiredEvents(),n=performance.now();this.updateProgress((0,C._t)("export_chat|fetched_n_events_in_time",{count:t.length,seconds:(n-e)/1e3}),!0,!1),this.updateProgress((0,C._t)("export_chat|creating_html"));const i=new Set;for(let e=0;e<t.length/1e3;e++){const n=await this.createHTML(t,1e3*e,e,t.length/1e3);(new DOMParser).parseFromString(n,"text/html").querySelectorAll("*").forEach((e=>{e.classList.forEach((e=>i.add(e)))})),this.addFile(`messages${e?e+1:""}.html`,new Blob([n]))}const r=await Ra(i);this.addFile("css/style.css",new Blob([r])),this.addFile("js/script.js",new Blob(['/*\nCopyright 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the "License");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\nhttp://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n// This file is raw-imported (imported as plain text) for the export bundle, which is why this is in JS\nfunction showToastIfNeeded(replyId) {\n    const el = document.getElementById(replyId);\n    if (!el) {\n        showToast("The message you\'re looking for wasn\'t exported");\n        return;\n    }\n}\n\nfunction showToast(text) {\n    const el = document.getElementById("snackbar");\n    el.innerHTML = text;\n    el.className = "mx_show";\n    window.setTimeout(() => {\n        el.className = el.className.replace("mx_show", "");\n    }, 2000);\n}\n\nwindow.onload = () => {\n    document.querySelectorAll(".mx_reply_anchor").forEach((element) => {\n        element.addEventListener("click", (event) => {\n            showToastIfNeeded(event.target.dataset.scrollTo);\n        });\n    });\n};\n'])),await this.downloadZIP();const o=performance.now();this.cancelled?l.v.info("Export cancelled successfully"):(this.updateProgress((0,C._t)("export_chat|export_successful")),this.updateProgress((0,C._t)("export_chat|exported_n_events_in_time",{count:t.length,seconds:(o-e)/1e3}))),this.cleanUp()}}class Pa extends Ls{constructor(e,t,n,i){super(e,t,n,i),(0,r.A)(this,"totalSize",0),(0,r.A)(this,"messages",[])}get destinationFileName(){return this.makeFileNameNoExtension()+".json"}createJSONString(){var e,t,n,i;const r=(0,Ms.Ah)(new Date),o=null===(e=this.room.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===e?void 0:e.getSender(),a=o&&(null===(t=this.room)||void 0===t||null===(t=t.getMember(o))||void 0===t?void 0:t.rawDisplayName)||o,l=(null===(n=this.room.currentState.getStateEvents(s.EventType.RoomTopic,""))||void 0===n||null===(n=n.getContent())||void 0===n?void 0:n.topic)||"",c=this.room.client.getUserId(),d=(null===(i=this.room)||void 0===i||null===(i=i.getMember(c))||void 0===i?void 0:i.rawDisplayName)||c,u={room_name:this.room.name,room_creator:a,topic:l,export_date:r,exported_by:d,messages:this.messages};return JSON.stringify(u,null,2)}async getJSONString(e){if(this.exportOptions.attachmentsIncluded&&this.isAttachment(e))try{const t=await this.getMediaBlob(e);if(this.totalSize+t.size<this.exportOptions.maxSize){this.totalSize+=t.size;const n=this.getFilePath(e);this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1),this.addFile(n,t)}}catch(e){l.v.log("Error fetching file: "+e)}return e.getEffectiveEvent()}async createOutput(e){for(let t=0;t<e.length;t++){const n=e[t];if(this.updateProgress((0,C._t)("export_chat|processing_event_n",{number:t+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();(0,Qs.bN)(n,this.room.client,!1)&&this.messages.push(await this.getJSONString(n))}return this.createJSONString()}async export(){l.v.info("Starting export process..."),l.v.info("Fetching events...");const e=performance.now(),t=await this.getRequiredEvents(),n=performance.now();l.v.log(`Fetched ${t.length} events in ${(n-e)/1e3}s`),l.v.info("Creating output...");const i=await this.createOutput(t);if(this.files.length)this.addFile("export.json",new Blob([i])),await this.downloadZIP();else{const e=this.destinationFileName;this.downloadPlainText(e,i)}const r=performance.now();this.cancelled?l.v.info("Export cancelled successfully"):(l.v.info("Export successful!"),l.v.log(`Exported ${t.length} events in ${(r-e)/1e3} seconds`)),this.cleanUp()}}class Na extends Ls{constructor(e,t,n,i){super(e,t,n,i),(0,r.A)(this,"totalSize",void 0),(0,r.A)(this,"mediaOmitText",void 0),(0,r.A)(this,"textForReplyEvent",(e=>{const t=/> <(.*?)>(.*?)\n\n(.*)/s.exec(e.body);if(!t)return e.body;let n;const i=t[1],r=t[3];n=t[2].substring(1);const o=n.split("\n").filter((e=>!/^\s*$/.test(e)));return o.length>0?(n=o[0].substring(0,32),o[0].length>32&&(n+="..."),n=` "${n}"`):n="",`<${i}${n}> ${r}`})),(0,r.A)(this,"plainTextForEvent",(async e=>{const t=e.sender&&e.sender.name?e.sender.name:e.getSender();let n="";if(this.isAttachment(e))if(this.exportOptions.attachmentsIncluded)try{const t=await this.getMediaBlob(e);if(this.totalSize+t.size>this.exportOptions.maxSize)n=` (${this.mediaOmitText})`;else{this.totalSize+=t.size;const i=this.getFilePath(e);n=" ("+(0,C._t)("export_chat|file_attached")+")",this.addFile(i,t),this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1)}}catch(e){n=" ("+(0,C._t)("export_chat|error_fetching_file")+")",l.v.log("Error fetching file "+e)}else n=` (${this.mediaOmitText})`;return this.isReply(e)?t+": "+this.textForReplyEvent(e.getContent())+n:(0,ea.Rd)(e,this.room.client)+n})),this.totalSize=0,this.mediaOmitText=this.exportOptions.attachmentsIncluded?(0,C._t)("export_chat|media_omitted_file_size"):(0,C._t)("export_chat|media_omitted")}get destinationFileName(){return this.makeFileNameNoExtension()+".txt"}async createOutput(e){let t="";for(let n=0;n<e.length;n++){const i=e[n];if(this.updateProgress((0,C._t)("export_chat|processing_event_n",{number:n+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();if(!(0,Qs.bN)(i,this.room.client,!1))continue;const r=await this.plainTextForEvent(i);t+=r&&`${(0,Ms.Lu)(new Date(i.getTs()),O.A.getValue("showTwelveHourTimestamps"))} - ${r}\n`}return t}async export(){this.updateProgress((0,C._t)("export_chat|starting_export")),this.updateProgress((0,C._t)("export_chat|fetching_events"));const e=performance.now(),t=await this.getRequiredEvents(),n=performance.now();l.v.log(`Fetched ${t.length} events in ${(n-e)/1e3}s`),this.updateProgress((0,C._t)("export_chat|creating_output"));const i=await this.createOutput(t);if(this.files.length)this.addFile("export.txt",new Blob([i])),await this.downloadZIP();else{const e=this.destinationFileName;this.downloadPlainText(e,i)}const r=performance.now();this.cancelled?l.v.info("Export cancelled successfully"):(l.v.info("Export successful!"),l.v.log(`Exported ${t.length} events in ${(r-e)/1e3} seconds`)),this.cleanUp()}}const Da=()=>({}),Ma=(e,t)=>n=>"number"==typeof n&&!(isNaN(n)||e>n||n>t),Oa=({room:e,onFinished:t})=>{const{exportFormat:n,exportType:i,includeAttachments:r,numberOfMessages:s,sizeLimit:a,setExportFormat:c,setExportType:d,setNumberOfMessages:u,setSizeLimit:m,setAttachments:h}=(()=>{var e,t,n,i,r;const s=Da(),[a,l]=(0,o.useState)(null!==(e=s.format)&&void 0!==e?e:bs.Html),[c,d]=(0,o.useState)(null!==(t=s.range)&&void 0!==t?t:ws.Timeline),[u,m]=(0,o.useState)(null!==(n=s.includeAttachments)&&void 0!==n&&n),[h,p]=(0,o.useState)(null!==(i=s.numberOfMessages)&&void 0!==i?i:100),[g,v]=(0,o.useState)(null!==(r=s.sizeMb)&&void 0!==r?r:8);return{exportFormat:a,exportType:c,includeAttachments:u,numberOfMessages:h,sizeLimit:g,setExportFormat:s.format?void 0:l,setExportType:s.range?void 0:d,setNumberOfMessages:s.numberOfMessages?void 0:p,setSizeLimit:s.sizeMb?void 0:v,setAttachments:void 0===s.includeAttachments?m:void 0}})(),[p,g]=(0,o.useState)(!1),v=(0,o.useRef)(null),_=(0,o.useRef)(null),[f,y]=(0,o.useState)((0,C._t)("export_chat|processing")),[E,b]=(0,o.useState)(!1),[w,x]=(0,o.useState)(!1),[A,S]=(0,o.useState)(!1),[k,R]=((e,t)=>{const[n,i]=(0,o.useState)(e);return[n,e=>{i(e),t(e)}]})(null,(async e=>{await(null==e?void 0:e.export().then((()=>{w||S(!0)})))})),I=async()=>{var t;if(!m||await(null===(t=v.current)||void 0===t?void 0:t.validate({focused:!1}))){if(i===ws.LastNMessages){var o;var c;if(!await(null===(o=_.current)||void 0===o?void 0:o.validate({focused:!1})))return void(null===(c=_.current)||void 0===c||c.validate({focused:!0}))}g(!0),await(async()=>{const t={numberOfMessages:s,attachmentsIncluded:r,maxSize:1024*a*1024};switch(n){case bs.Html:R(new Ta(e,ws[i],t,y));break;case bs.Json:R(new Pa(e,ws[i],t,y));break;case bs.PlainText:R(new Na(e,ws[i],t,y));break;default:return void l.v.error("Unknown export format")}})()}else{var d;null===(d=v.current)||void 0===d||d.validate({focused:!0})}},T=(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("export_chat|enter_number_between_min_max",{min:1,max:2e3})},{key:"number",test:({value:e})=>{const t=parseInt(e,10);return Ma(1,2e3)(t)},invalid:()=>(0,C._t)("export_chat|size_limit_min_max",{min:1,max:2e3})}]}),P=async e=>await T(e),N=(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("export_chat|enter_number_between_min_max",{min:1,max:10**8})},{key:"number",test:({value:e})=>{const t=parseInt(e,10);return Ma(1,10**8)(t)},invalid:()=>(0,C._t)("export_chat|num_messages_min_max",{min:1,max:10**8})}]}),D=async e=>await N(e),M=async()=>{p?b(!0):t(!1)},O=async()=>{await(null==k?void 0:k.cancelExport()),x(!0),g(!1),R(null)},L=Object.values(bs).map((e=>({value:e,label:xs(e)}))),U=Object.values(ws).map((e=>o.createElement("option",{key:ws[e],value:e},(e=>{switch(e){case ws.Beginning:return(0,C._t)("export_chat|from_the_beginning");case ws.LastNMessages:return(0,C._t)("export_chat|number_of_messages");case ws.Timeline:return(0,C._t)("export_chat|current_timeline");default:throw new Error("Unknown type: "+e)}})(e))));let F;i===ws.LastNMessages&&u&&(F=o.createElement(tn.A,{id:"message-count",element:"input",type:"number",value:s.toString(),ref:_,onValidate:D,label:(0,C._t)("export_chat|num_messages"),onChange:e=>{u(parseInt(e.target.value))}}));const j=o.createElement("span",null,(0,C._t)("export_chat|size_limit_postfix"));return w?o.createElement(rn.A,{title:(0,C._t)("export_chat|cancelled"),description:(0,C._t)("export_chat|cancelled_detail"),hasCloseButton:!0,onFinished:t}):A?o.createElement(rn.A,{title:(0,C._t)("export_chat|successful"),description:(0,C._t)("export_chat|successful_detail"),hasCloseButton:!0,onFinished:t}):E?o.createElement(cn.A,{title:(0,C._t)("common|warning"),className:"mx_ExportDialog",contentId:"mx_Dialog_content",onFinished:t,fixedWidth:!0},o.createElement("p",null,(0,C._t)("export_chat|confirm_stop")),o.createElement(un.A,{primaryButton:(0,C._t)("action|stop"),primaryButtonClass:"danger",hasCancel:!0,cancelButton:(0,C._t)("action|continue"),onCancel:()=>b(!1),onPrimaryButtonClick:O})):o.createElement(cn.A,{title:p?(0,C._t)("export_chat|exporting_your_data"):(0,C._t)("export_chat|title"),className:`mx_ExportDialog ${p&&"mx_ExportDialog_Exporting"}`,contentId:"mx_Dialog_content",hasCancel:!0,onFinished:t,fixedWidth:!0},p?null:o.createElement("p",null,(0,C._t)("export_chat|select_option")),o.createElement("div",{className:"mx_ExportDialog_options"},!!c&&o.createElement(o.Fragment,null,o.createElement("span",{className:"mx_ExportDialog_subheading"},(0,C._t)("export_chat|format")),o.createElement(Es.A,{name:"exportFormat",value:n,onChange:e=>c(bs[e]),definitions:L})),!!d&&o.createElement(o.Fragment,null,o.createElement("span",{className:"mx_ExportDialog_subheading"},(0,C._t)("export_chat|messages")),o.createElement(tn.A,{id:"export-type",element:"select",value:i,onChange:e=>{d(ws[e.target.value])}},U),F),m&&o.createElement(o.Fragment,null,o.createElement("span",{className:"mx_ExportDialog_subheading"},(0,C._t)("export_chat|size_limit")),o.createElement(tn.A,{id:"size-limit",type:"number",autoComplete:"off",onValidate:P,element:"input",ref:v,value:a.toString(),postfixComponent:j,onChange:e=>m(parseInt(e.target.value))})),h&&o.createElement(o.Fragment,null,o.createElement(at.A,{className:"mx_ExportDialog_attachments-checkbox",id:"include-attachments",checked:r,onChange:e=>h(e.target.checked)},(0,C._t)("export_chat|include_attachments")))),p?o.createElement("div",{className:"mx_ExportDialog_progress"},o.createElement(dn.A,{w:24,h:24}),o.createElement("p",null,f),o.createElement(un.A,{primaryButton:(0,C._t)("action|cancel"),primaryButtonClass:"danger",hasCancel:!1,onPrimaryButtonClick:M})):o.createElement(un.A,{primaryButton:(0,C._t)("action|export"),onPrimaryButtonClick:I,onCancel:()=>t(!1)}))};var La=n("./node_modules/matrix-react-sdk/src/components/views/polls/pollHistory/PollHistory.tsx");const Ua=({room:e,matrixClient:t,permalinkCreator:n,onFinished:i})=>o.createElement(cn.A,{onFinished:i},o.createElement(La.a,{room:e,matrixClient:t,permalinkCreator:n,onFinished:i}));var Fa=n("./node_modules/matrix-react-sdk/src/components/utils/Flex.tsx"),ja=n("./node_modules/matrix-react-sdk/src/actions/RoomListActions.ts");function Ba(e,t){if(t===he.zO.Favourite||t===he.zO.LowPriority){const n=t===he.zO.Favourite?he.zO.LowPriority:he.zO.Favourite,i=Ai.Ay.instance.getTagsForRoom(e).includes(t),r=i?t:n,o=i?null:t;v.Ay.dispatch(ja.A.tagRoom(e.client,e,r,o,0))}else l.v.warn(`Unexpected tag ${t} applied to ${e.roomId}`)}function Va(e){const t=e.client;return(!!e.canInvite(t.getSafeUserId())||!(!e.isSpaceRoom()||e.getJoinRule()!==s.JoinRule.Public))&&e.getMyMembership()===We.O.Join&&(0,Ie.g)(W.C.InviteUsers)}function Ha(e){e.client.isGuest()?v.Ay.dispatch({action:"require_registration"}):v.Ay.dispatch({action:"view_invite",roomId:e.roomId})}var za=n("./node_modules/matrix-react-sdk/src/hooks/useRoomState.ts"),Wa=n("./node_modules/matrix-react-sdk/src/hooks/room/useTopic.ts"),Ga=n("./node_modules/matrix-react-sdk/src/HtmlUtils.tsx");const Ka=["as","flex","shrink","grow","className","children"];function Ja(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function qa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ja(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $a(e,t,n){const i=e.current.style;n?i.setProperty(t,n):i.removeProperty(t)}function Ya(e){let{as:t="div",flex:n=null,shrink:i=null,grow:r=null,className:s,children:a}=e,l=(0,Ue.A)(e,Ka);const c=(0,o.useRef)();return(0,o.useEffect)((()=>{$a(c,"--mx-box-flex",n),$a(c,"--mx-box-shrink",i),$a(c,"--mx-box-grow",r)}),[n,r,i]),o.createElement(t,qa(qa({},l),{},{className:ee()("mx_Box",s,{"mx_Box--flex":!!n,"mx_Box--shrink":!!i,"mx_Box--grow":!!r}),ref:c}),a)}const Qa=["room","className"];function Za(e){const t=e.target,n=(0,Po.uK)(t.href);n!==t.href&&(e.preventDefault(),window.location.hash=n)}function Xa(e){let{room:t,className:n}=e,r=(0,Ue.A)(e,Qa);const a=(0,o.useContext)(Re.Ay),[l,c]=(0,o.useState)(!1),d=(0,Wa.B)(t),u=(0,Ga.sH)(null==d?void 0:d.text,null==d?void 0:d.html),m=(0,o.useCallback)((e=>{var t;null===(t=r.onClick)||void 0===t||t.call(r,e);"A"===e.target.tagName.toUpperCase()?Za(e):v.Ay.fire(x.r.ShowRoomTopic)}),[r]),h=e=>{c("A"===e.target.tagName.toUpperCase())};return(0,Te.F)(v.Ay,(e=>{if(e.action===x.r.ShowRoomTopic){const e=t.currentState.maySendStateEvent(s.EventType.RoomTopic,a.getSafeUserId()),n=(0,Ga.sH)(null==d?void 0:d.text,null==d?void 0:d.html,void 0,!0),i=f.Ay.createDialog(rn.A,{title:t.name,description:o.createElement("div",null,o.createElement(Ga.XZ,{options:{attributes:{onClick(e){m(e),i.close()}}},as:"p"},n),e&&o.createElement(be.A,{kind:"primary_outline",onClick:()=>{i.close(),v.Ay.dispatch({action:"open_room_settings"})}},(0,C._t)("room|edit_topic"))),hasCloseButton:!0,button:!1})}})),u?o.createElement(ke.m_,{label:(0,C._t)("room|read_topic"),disabled:l},o.createElement("div",(0,i.A)({},r,{tabIndex:0,role:"button",onClick:m,className:ee()(n,"mx_RoomTopic"),onMouseOver:h,onFocus:h,"aria-label":(0,C._t)("room|read_topic")}),o.createElement(Ga.XZ,null,u))):o.createElement("div",{className:ee()(n,"mx_RoomTopic")})}var el=n("./node_modules/matrix-react-sdk/src/utils/video-rooms.ts"),tl=n("./node_modules/matrix-react-sdk/src/components/views/right_panel/types.ts"),nl=n("./node_modules/matrix-react-sdk/src/hooks/useAsyncMemo.ts"),il=n("./node_modules/matrix-react-sdk/src/utils/PinningUtils.ts");function rl(e){var t,n;return null!==(t=null==e||null===(n=e.getLiveTimeline().getState(s.EventTimeline.FORWARDS))||void 0===n||null===(n=n.getStateEvents(s.EventType.RoomPinnedEvents,""))||void 0===n||null===(n=n.getContent())||void 0===n?void 0:n.pinned)&&void 0!==t?t:[]}const ol=e=>{const[t,n]=(0,o.useState)(rl(e)),i=(0,o.useCallback)((t=>{t&&t.getType()!==s.EventType.RoomPinnedEvents||n(rl(e))}),[e]);return(0,Pe.YK)(null==e?void 0:e.getLiveTimeline().getState(s.EventTimeline.FORWARDS),s.RoomStateEvent.Events,i),(0,o.useEffect)((()=>(n(rl(e)),()=>{n([])})),[e]),t};function sl(e){var t,n;return new Set(null!==(t=null==e||null===(n=e.getAccountData(tl.M))||void 0===n||null===(n=n.getContent())||void 0===n?void 0:n.event_ids)&&void 0!==t?t:[])}const al=e=>{const[t,n]=(0,o.useState)(new Set),i=(0,o.useCallback)((t=>{t&&t.getType()!==tl.M||n(sl(e))}),[e]);return(0,Pe.YK)(e,s.RoomEvent.AccountData,i),(0,o.useEffect)((()=>(n(sl(e)),()=>{n(new Set)})),[e]),t};function ll(e,t){const n=(0,Re.nH)();return(0,nl.e)((()=>Promise.all(t.map((async t=>async function(e,t,n){var i;const r=e.getUnfilteredTimelineSet(),o=null==r||null===(i=r.getTimelineForEvent(t))||void 0===i?void 0:i.getEvents().find((e=>e.getId()===t));if(null!=o&&o.isEncrypted()&&await n.decryptEventIfNeeded(o,{emit:!1}),o)return il.A.isUnpinnable(o)?o:null;try{const[i,{events:[r]}]=await Promise.all([n.fetchRoomEvent(e.roomId,t),n.relations(e.roomId,t,s.RelationType.Replace,null,{limit:1})]),o=new s.MatrixEvent(i);o.isEncrypted()&&await n.decryptEventIfNeeded(o,{emit:!1}),await e.processPollEvents([o]);const a=o.getSender();if(a&&il.A.isUnpinnable(o))return o.sender=e.getMember(a),r&&o.makeReplaced(r),o}catch(n){l.v.error(`Error looking up pinned event ${t} in room ${e.roomId}`),l.v.error(n)}return null}(e,t,n))))),[n,e,t],null)}function cl(e,t){const n=ll(e,t);return(0,o.useMemo)((()=>n?n.sort(((e,t)=>e?t?e.getTs()-t.getTs():1:-1)):[]),[n])}const dl=()=>{qn.A.instance.pushCard({phase:$n.n.FilePanel},!0)},ul=()=>{u.A.trackInteraction("PinnedMessageRoomInfoButton"),qn.A.instance.pushCard({phase:$n.n.PinnedMessages},!0)},ml=e=>{v.Ay.dispatch({action:"open_room_settings"}),u.A.trackInteraction("WebRightPanelRoomInfoSettingsButton",e)},hl=({room:e})=>{const[t,n]=(0,o.useState)(!0),i=(0,Wa.B)(e),r=(0,Ga.sH)(null==i?void 0:i.text,null==i?void 0:i.html),a=(0,za.U)(e,(t=>t.maySendStateEvent(s.EventType.RoomTopic,e.client.getSafeUserId()))),l=e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"open_room_settings"})};if(!r&&!a)return null;if(!r)return o.createElement(Fa.s,{as:"section",direction:"column",justify:"center",gap:"var(--cpd-space-2x)",className:"mx_RoomSummaryCard_topic"},o.createElement(Ya,{flex:"1"},o.createElement(ke.N_,{kind:"primary",onClick:l},o.createElement(ke.EY,{size:"sm",weight:"regular"},(0,C._t)("right_panel|add_topic")))));const c=t?o.createElement(Ga.XZ,null,r):r;return o.createElement(Fa.s,{as:"section",direction:"column",justify:"center",gap:"var(--cpd-space-2x)",className:ee()("mx_RoomSummaryCard_topic",{mx_RoomSummaryCard_topic_collapsed:!t})},o.createElement(Ya,{flex:"1",className:"mx_RoomSummaryCard_topic_container"},o.createElement(ke.EY,{size:"sm",weight:"regular",onClick:e=>{e.target instanceof HTMLAnchorElement&&Za(e)}},c),o.createElement(ke.K0,{className:"mx_RoomSummaryCard_topic_chevron",size:"24px",onClick:()=>n(!t)},o.createElement(ps,null))),t&&a&&o.createElement(Ya,{flex:"1",className:"mx_RoomSummaryCard_topic_edit"},o.createElement(ke.N_,{kind:"primary",onClick:l},o.createElement(ke.EY,{size:"sm",weight:"regular"},(0,C._t)("action|edit")))))},pl=({room:e,permalinkCreator:t,onSearchChange:n,onSearchCancel:i,focusRoomSearch:r})=>{var a;const l=(0,o.useContext)(Re.Ay),c=(0,gs.g)(l,e),d=(0,o.useContext)(Zr.Ay),u=d.e2eStatus,m=(0,el.u)(e),h=(0,za.U)(e),p=((e,t)=>{const[n,i]=(0,o.useState)((()=>{return null==(n=e.getAccountData(t))?void 0:n.getContent();var n})),r=(0,o.useCallback)((e=>{e.getType()===t&&i(e.getContent())}),[t]);return(0,Pe.YK)(e,s.ClientEvent.AccountData,r),n||{}})(e.client,s.EventType.Direct),[g,_]=(0,o.useState)(!1);(0,o.useEffect)((()=>{for(const[,n]of Object.entries(p)){var t;if(n.includes(null!==(t=null==e?void 0:e.roomId)&&void 0!==t?t:"")){_(!0);break}}}),[e,p]);const y=(0,o.useRef)(null);(0,Te.F)(v.Ay,(e=>{var t;e.action===x.r.FocusMessageSearch&&(null===(t=y.current)||void 0===t||t.focus())})),((e,t)=>{const n=(0,o.useRef)(e);(0,o.useEffect)((()=>{n.current=e}),[e]);const i=(0,o.useRef)(null);(0,o.useEffect)((()=>{null!==i.current&&n.current(...i.current),i.current=t}),t)})((e=>{e===Zr.Ae.Search&&d.timelineRenderingType!==Zr.Ae.Search&&y.current&&(y.current.value="")}),[d.timelineRenderingType]);const E=e.getCanonicalAlias()||e.getAltAliases()[0]||"",b=o.createElement("header",{className:"mx_RoomSummaryCard_container"},o.createElement(Ge.A,{room:e,size:"80px",viewAvatarOnClick:!0}),o.createElement(ys.A,{room:e},(e=>o.createElement(ke.DZ,{as:"h1",size:"md",weight:"semibold",className:"mx_RoomSummaryCard_roomName text-primary",title:e},e))),o.createElement(ke.EY,{as:"div",size:"sm",weight:"semibold",className:"mx_RoomSummaryCard_alias text-secondary",title:E},E),o.createElement(Fa.s,{as:"section",justify:"center",gap:"var(--cpd-space-2x)",className:"mx_RoomSummaryCard_badges"},!g&&h.getJoinRule()===s.JoinRule.Public&&o.createElement(ke.Ex,{kind:"default"},o.createElement(cs,{width:"1em"}),(0,C._t)("common|public_room")),c&&u!==fs.z.Warning&&o.createElement(ke.Ex,{kind:"success"},o.createElement(is,{width:"1em"}),(0,C._t)("common|encrypted")),!u&&o.createElement(ke.Ex,{kind:"default"},o.createElement(as,{width:"1em"}),(0,C._t)("common|unencrypted")),u===fs.z.Warning&&o.createElement(ke.Ex,{kind:"critical"},o.createElement(us.A,{width:"1em"}),(0,C._t)("common|not_trusted"))),o.createElement(hl,{room:e})),w=(0,Ne.ny)("feature_pinning"),A=null===(a=ol(w?e:void 0))||void 0===a?void 0:a.length,S=(0,Pe.dF)(Ai.Ay.instance,Ai.lA,(()=>Ai.Ay.instance.getTagsForRoom(e))),k=(0,Pe.dF)(e,s.RoomStateEvent.Update,(()=>Va(e))),R=S.includes(he.zO.Favourite);return o.createElement(vs.A,{hideHeaderButtons:!0,id:"room-summary-panel",className:"mx_RoomSummaryCard",ariaLabelledBy:"room-summary-panel-tab",role:"tabpanel"},o.createElement(Fa.s,{as:"header",className:"mx_RoomSummaryCard_header",gap:"var(--cpd-space-3x)",align:"center",justify:"space-between"},n&&o.createElement(ke.lV.Root,{className:"mx_RoomSummaryCard_search",onSubmit:e=>e.preventDefault()},o.createElement(ke.vj,{placeholder:(0,C._t)("room|search|placeholder"),name:"room_message_search",onChange:n,className:"mx_no_textinput",ref:y,autoFocus:r,onKeyDown:e=>{y.current&&e.key===te.Uz.ESCAPE&&(y.current.value="",null==i||i())}}))),b,o.createElement(ke.wv,null),o.createElement("div",{role:"menubar","aria-orientation":"vertical"},o.createElement(ke.XJ,{Icon:Uo,label:(0,C._t)("room|context_menu|favourite"),checked:R,onChange:()=>Ba(e,he.zO.Favourite),onSelect:()=>{}}),o.createElement(ke.Dr,{Icon:Fo.I,label:(0,C._t)("action|invite"),disabled:!k,onSelect:()=>Ha(e)}),o.createElement(ke.wv,null),!m&&o.createElement(o.Fragment,null,w&&o.createElement(ke.Dr,{Icon:Xo,label:(0,C._t)("right_panel|pinned_messages_button"),onSelect:ul},o.createElement(ke.EY,{as:"span",size:"sm"},A)),o.createElement(ke.Dr,{Icon:$o,label:(0,C._t)("right_panel|files_button"),onSelect:dl})),o.createElement(ke.wv,null),o.createElement(ke.Dr,{Icon:Bo,label:(0,C._t)("action|copy_link"),onSelect:()=>{f.Ay.createDialog(_s.A,{target:e})}}),!m&&o.createElement(o.Fragment,null,o.createElement(ke.Dr,{Icon:Qo,label:(0,C._t)("right_panel|polls_button"),onSelect:()=>{f.Ay.createDialog(Ua,{room:e,matrixClient:l,permalinkCreator:t})}}),o.createElement(ke.Dr,{Icon:Ko,label:(0,C._t)("export_chat|title"),onSelect:async()=>{f.Ay.createDialog(Oa,{room:e})}})),o.createElement(ke.Dr,{Icon:Ho,label:(0,C._t)("common|settings"),onSelect:ml}),o.createElement(ke.wv,null),o.createElement(ke.Dr,{Icon:Jo.A,kind:"critical",label:(0,C._t)("action|leave_room"),onSelect:()=>{v.Ay.dispatch({action:"leave_room",room_id:e.roomId})}})))};var gl,vl=n("./node_modules/matrix-react-sdk/src/utils/WidgetUtils.ts"),_l=n("./node_modules/matrix-widget-api/lib/index.js"),fl=n("./node_modules/@matrix-org/react-sdk-module-api/lib/lifecycles/WidgetLifecycle.js"),yl=n("./node_modules/matrix-react-sdk/src/utils/UrlUtils.ts");function El(){return El=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},El.apply(null,arguments)}var bl=function(e,t){return o.createElement("svg",El({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14",role:"presentation","aria-hidden":!0,ref:t},e),gl||(gl=o.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(1 1)"},o.createElement("circle",{cx:6,cy:6,r:6}),o.createElement("path",{d:"M4.254 4.2a1.8 1.8 0 0 1 3.498.6c0 1.2-1.8 1.8-1.8 1.8M6 8.991"}))))},wl=(0,o.forwardRef)(bl);function xl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}class Al extends o.Component{constructor(e){super(e);const t=this.parseWidgetUrl(),n=h.J.safeGet().getRoom(this.props.roomId);let i=null;n&&(i=n.getMember(this.props.creatorUserId)),this.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xl(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({roomMember:i},t)}parseWidgetUrl(){const e=(0,yl.Dl)(this.props.url);if(vl.A.isScalarUrl(this.props.url)&&e.searchParams.has("url")){const t=(0,yl.Dl)(e.searchParams.get("url"));return{widgetDomain:t.host||t.hostname,isWrapped:!0}}return{widgetDomain:e.host||e.hostname,isWrapped:!1}}render(){const e=g.Ay.get().brand,t=this.state.roomMember?this.state.roomMember.name:this.props.creatorUserId,n=t===this.props.creatorUserId?null:this.props.creatorUserId,i=this.state.roomMember?o.createElement(Ws.A,{member:this.state.roomMember,size:"38px"}):o.createElement(xn.A,{name:this.props.creatorUserId,size:"38px"}),r=o.createElement(ke.m_,{label:(0,C._t)("analytics|shared_data_heading"),caption:o.createElement("ul",null,o.createElement("li",null,(0,C._t)("widget|shared_data_name")),o.createElement("li",null,(0,C._t)("widget|shared_data_avatar")),o.createElement("li",null,(0,C._t)("widget|shared_data_mxid")),o.createElement("li",null,(0,C._t)("widget|shared_data_device_id")),o.createElement("li",null,(0,C._t)("widget|shared_data_theme")),o.createElement("li",null,(0,C._t)("widget|shared_data_lang")),o.createElement("li",null,(0,C._t)("widget|shared_data_url",{brand:e})),o.createElement("li",null,(0,C._t)("widget|shared_data_room_id")),o.createElement("li",null,(0,C._t)("widget|shared_data_widget_id")))},o.createElement("div",{className:"mx_TextWithTooltip_target mx_TextWithTooltip_target--helpIcon"},o.createElement(wl,{className:"mx_Icon mx_Icon_12"}))),s=this.state.isWrapped?(0,C._t)("widget|shared_data_warning_im",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>r}):(0,C._t)("widget|shared_data_warning",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>r}),a=this.props.isRoomEncrypted?(0,C._t)("widget|unencrypted_warning"):null;return o.createElement("div",{className:"mx_AppPermission"},o.createElement("div",{className:"mx_AppPermission_content"},o.createElement("div",{className:"mx_AppPermission_content_bolder"},(0,C._t)("widget|added_by")),o.createElement("div",null,i,o.createElement(Ii.A,{size:"4"},t),o.createElement("div",null,n)),o.createElement("div",null,s),o.createElement("div",null,(0,C._t)("widget|cookie_warning")," ",a),o.createElement("div",null,o.createElement(be.A,{kind:"primary_sm",onClick:this.props.onPermissionGranted},(0,C._t)("action|continue")))))}}(0,r.A)(Al,"defaultProps",{onPermissionGranted:()=>{}});const Sl=e=>o.createElement("div",{className:"mx_AppWarning"},o.createElement("div",null,o.createElement("img",{src:n("./node_modules/matrix-react-sdk/res/img/warning.svg").A,alt:""})),o.createElement("div",null,o.createElement("span",null,e.errorMsg||"Error")));var Cl=n("./node_modules/matrix-react-sdk/src/stores/ActiveWidgetStore.ts");function kl(e){return document.getElementById(e)}function Rl(e){let t=kl(e);return t||(t=document.createElement("div"),t.id=e,function(){let e=kl("mx_PersistedElement_container");return e||(e=document.createElement("div"),e.id="mx_PersistedElement_container",document.body.appendChild(e)),e}().appendChild(t)),t}class Il extends o.Component{constructor(e){super(e),(0,r.A)(this,"resizeObserver",void 0),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"childContainer",void 0),(0,r.A)(this,"child",void 0),(0,r.A)(this,"collectChildContainer",(e=>{this.childContainer&&this.resizeObserver.unobserve(this.childContainer),this.childContainer=e,e&&this.resizeObserver.observe(e)})),(0,r.A)(this,"collectChild",(e=>{this.child=e,this.updateChild()})),(0,r.A)(this,"onAction",(e=>{"timeline_resize"===e.action?this.repositionChild():"logout"===e.action&&Il.destroyElement(this.props.persistKey)})),(0,r.A)(this,"repositionChild",(()=>{this.updateChildPosition(this.child,this.childContainer)})),this.resizeObserver=new ResizeObserver(this.repositionChild),window.addEventListener("resize",this.repositionChild),this.dispatcherRef=v.Ay.register(this.onAction),this.props.moveRef&&(this.props.moveRef.current=this.repositionChild)}static destroyElement(e){const t=kl("mx_persistedElement_"+e);t&&t.remove()}static isMounted(e){return Boolean(kl("mx_persistedElement_"+e))}componentDidMount(){this.updateChild(),this.renderApp()}componentDidUpdate(){this.updateChild(),this.renderApp()}componentWillUnmount(){this.updateChildVisibility(this.child,!1),this.resizeObserver.disconnect(),window.removeEventListener("resize",this.repositionChild),v.Ay.unregister(this.dispatcherRef)}updateChild(){this.updateChildPosition(this.child,this.childContainer),this.updateChildVisibility(this.child,!0)}renderApp(){const e=o.createElement(Re.Ay.Provider,{value:h.J.safeGet()},o.createElement("div",{ref:this.collectChild,style:this.props.style},this.props.children));Ss.render(e,Rl("mx_persistedElement_"+this.props.persistKey))}updateChildVisibility(e,t=!1){e&&(e.style.display=t?"block":"none")}updateChildPosition(e,t){if(!e||!t)return;const n=t.getBoundingClientRect();Object.assign(e.style,{zIndex:(0,a.hX)(this.props.zIndex)?9:this.props.zIndex,position:"absolute",top:"0",left:"0",transform:`translateX(${n.left}px) translateY(${n.top}px)`,width:n.width+"px",height:n.height+"px"})}render(){return o.createElement("div",{ref:this.collectChildContainer})}}var Tl=n("./node_modules/matrix-react-sdk/src/widgets/WidgetType.ts"),Pl=n("./node_modules/matrix-react-sdk/src/utils/arrays.ts");var Nl=n("./node_modules/matrix-react-sdk/src/components/views/elements/LabelledToggleSwitch.tsx"),Dl=n("./node_modules/matrix-react-sdk/src/stores/widgets/WidgetPermissionStore.ts");class Ml extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"onAllow",(()=>{this.onPermissionSelection(!0)})),(0,r.A)(this,"onDeny",(()=>{this.onPermissionSelection(!1)})),(0,r.A)(this,"onRememberSelectionChange",(e=>{this.setState({rememberSelection:e})})),this.state={rememberSelection:!1}}onPermissionSelection(e){this.state.rememberSelection&&(l.v.log(`Remembering ${this.props.widget.id} as allowed=${e} for OpenID`),Xt.M.instance.widgetPermissionStore.setOIDCState(this.props.widget,this.props.widgetKind,this.props.inRoomId,e?Dl.R.Allowed:Dl.R.Denied)),this.props.onFinished(e)}render(){return o.createElement(cn.A,{className:"mx_WidgetOpenIDPermissionsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:(0,C._t)("widget|open_id_permissions_dialog|title")},o.createElement("div",{className:"mx_WidgetOpenIDPermissionsDialog_content"},o.createElement("p",null,(0,C._t)("widget|open_id_permissions_dialog|starting_text")),o.createElement("p",{className:"text-muted"},this.props.widget.templateUrl.split("?")[0].split("#")[0])),o.createElement(un.A,{primaryButton:(0,C._t)("action|continue"),onPrimaryButtonClick:this.onAllow,onCancel:this.onDeny,additive:o.createElement(Nl.A,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:(0,C._t)("widget|open_id_permissions_dialog|remember_selection")})}))}}var Ol=n("./node_modules/matrix-react-sdk/src/utils/objects.ts");let Ll=function(e){return e.CanChangeViewedRoom="io.element.view_room",e.RequiresClient="io.element.requires_client",e}({});var Ul=n("./node_modules/matrix-react-sdk/src/components/views/elements/TextWithTooltip.tsx");const Fl="generic";class jl{static bylineFor(e){return e.kind===_l.EventKind.State?e.keyStr?(0,C._t)("widget|capability|byline_state_key",{stateKey:e.keyStr}):(0,C._t)("widget|capability|byline_empty_state_key"):null}static for(e,t){if(jl.simpleCaps[e]){const n=jl.simpleCaps[e];if(n[t])return{primary:(0,C._t)(n[t])};if(n[Fl])return{primary:(0,C._t)(n[Fl])}}if((0,_l.isTimelineCapability)(e)){if((0,_l.isTimelineCapabilityFor)(e,_l.Symbols.AnyRoom))return{primary:(0,C._t)("widget|capability|any_room")};{const t=(0,_l.getTimelineRoomIDFromCapability)(e),n=h.J.safeGet().getRoom(t);return{primary:(0,C._t)("widget|capability|specific_room",{},{Room:()=>{var e;return n?o.createElement(Ul.A,{tooltip:null!==(e=n.getCanonicalAlias())&&void 0!==e?e:t},o.createElement("b",null,n.name)):o.createElement("b",null,o.createElement("code",null,t))}})}}}const[n]=_l.WidgetEventCapability.findEventCapabilities([e]);if(n){if(n.kind===_l.EventKind.Event&&n.eventType===s.EventType.RoomMessage)return jl.forRoomMessageCap(n,t);const e=n.kind===_l.EventKind.State?jl.stateSendRecvCaps:jl.nonStateSendRecvCaps;if(e[n.eventType]){const i=e[n.eventType],r=(null==i?void 0:i[t])||(null==i?void 0:i[Fl]);if(null!=r&&r[n.direction])return{primary:(0,C._t)(r[n.direction])}}return t===_l.WidgetKind.Room?n.direction===_l.EventDirection.Send?{primary:(0,C._t)("widget|capability|send_event_type_this_room",{eventType:n.eventType},{b:e=>o.createElement("b",null,e)}),byline:jl.bylineFor(n)}:{primary:(0,C._t)("widget|capability|see_event_type_sent_this_room",{eventType:n.eventType},{b:e=>o.createElement("b",null,e)}),byline:jl.bylineFor(n)}:n.direction===_l.EventDirection.Send?{primary:(0,C._t)("widget|capability|send_event_type_active_room",{eventType:n.eventType},{b:e=>o.createElement("b",null,e)}),byline:jl.bylineFor(n)}:{primary:(0,C._t)("widget|capability|see_event_type_sent_active_room",{eventType:n.eventType},{b:e=>o.createElement("b",null,e)}),byline:jl.bylineFor(n)}}return{primary:(0,C._t)("widget|capability|capability",{capability:e},{b:e=>o.createElement("b",null,e)})}}static forRoomMessageCap(e,t){if(!e.keyStr)return e.direction===_l.EventDirection.Send?{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_messages_this_room"):(0,C._t)("widget|capability|send_messages_active_room")}:{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_messages_sent_this_room"):(0,C._t)("widget|capability|see_messages_sent_active_room")};switch(e.keyStr){case s.MsgType.Text:return e.direction===_l.EventDirection.Send?{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_text_messages_this_room"):(0,C._t)("widget|capability|send_text_messages_active_room")}:{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_text_messages_sent_this_room"):(0,C._t)("widget|capability|see_text_messages_sent_active_room")};case s.MsgType.Emote:return e.direction===_l.EventDirection.Send?{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_emotes_this_room"):(0,C._t)("widget|capability|send_emotes_active_room")}:{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_sent_emotes_this_room"):(0,C._t)("widget|capability|see_sent_emotes_active_room")};case s.MsgType.Image:return e.direction===_l.EventDirection.Send?{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_images_this_room"):(0,C._t)("widget|capability|send_images_active_room")}:{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_images_sent_this_room"):(0,C._t)("widget|capability|see_images_sent_active_room")};case s.MsgType.Video:return e.direction===_l.EventDirection.Send?{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_videos_this_room"):(0,C._t)("widget|capability|send_videos_active_room")}:{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_videos_sent_this_room"):(0,C._t)("widget|capability|see_videos_sent_active_room")};case s.MsgType.File:return e.direction===_l.EventDirection.Send?{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_files_this_room"):(0,C._t)("widget|capability|send_files_active_room")}:{primary:t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_sent_files_this_room"):(0,C._t)("widget|capability|see_sent_files_active_room")};default:{let n;return n=e.direction===_l.EventDirection.Send?t===_l.WidgetKind.Room?(0,C._t)("widget|capability|send_msgtype_this_room",{msgtype:e.keyStr},{b:e=>o.createElement("b",null,e)}):(0,C._t)("widget|capability|send_msgtype_active_room",{msgtype:e.keyStr},{b:e=>o.createElement("b",null,e)}):t===_l.WidgetKind.Room?(0,C._t)("widget|capability|see_msgtype_sent_this_room",{msgtype:e.keyStr},{b:e=>o.createElement("b",null,e)}):(0,C._t)("widget|capability|see_msgtype_sent_active_room",{msgtype:e.keyStr},{b:e=>o.createElement("b",null,e)}),{primary:n}}}}}(0,r.A)(jl,"simpleCaps",{[_l.MatrixCapabilities.AlwaysOnScreen]:{[_l.WidgetKind.Room]:(0,C.AO)("widget|capability|always_on_screen_viewing_another_room"),[Fl]:(0,C.AO)("widget|capability|always_on_screen_generic")},[_l.MatrixCapabilities.StickerSending]:{[_l.WidgetKind.Room]:(0,C.AO)("widget|capability|send_stickers_this_room"),[Fl]:(0,C.AO)("widget|capability|send_stickers_active_room")},[Ll.CanChangeViewedRoom]:{[Fl]:(0,C.AO)("widget|capability|switch_room")},[_l.MatrixCapabilities.MSC2931Navigate]:{[Fl]:(0,C.AO)("widget|capability|switch_room_message_user")}}),(0,r.A)(jl,"stateSendRecvCaps",{[s.EventType.RoomTopic]:{[_l.WidgetKind.Room]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|change_topic_this_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_topic_change_this_room")},[Fl]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|change_topic_active_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_topic_change_active_room")}},[s.EventType.RoomName]:{[_l.WidgetKind.Room]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|change_name_this_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_name_change_this_room")},[Fl]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|change_name_active_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_name_change_active_room")}},[s.EventType.RoomAvatar]:{[_l.WidgetKind.Room]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|change_avatar_this_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_avatar_change_this_room")},[Fl]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|change_avatar_active_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_avatar_change_active_room")}},[s.EventType.RoomMember]:{[_l.WidgetKind.Room]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|remove_ban_invite_leave_this_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|receive_membership_this_room")},[Fl]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|remove_ban_invite_leave_active_room"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|receive_membership_active_room")}}}),(0,r.A)(jl,"nonStateSendRecvCaps",{[s.EventType.Sticker]:{[_l.WidgetKind.Room]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|send_stickers_this_room_as_you"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_sticker_posted_this_room")},[Fl]:{[_l.EventDirection.Send]:(0,C.AO)("widget|capability|send_stickers_active_room_as_you"),[_l.EventDirection.Receive]:(0,C.AO)("widget|capability|see_sticker_posted_active_room")}}});class Bl extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"eventPermissionsMap",new Map),(0,r.A)(this,"onToggle",(e=>{const t=(0,Ol.tn)(this.state.booleanStates);t[e]=!t[e],this.setState({booleanStates:t})})),(0,r.A)(this,"onRememberSelectionChange",(e=>{this.setState({rememberSelection:e})})),(0,r.A)(this,"onSubmit",(async()=>{this.closeAndTryRemember(Object.entries(this.state.booleanStates).filter((([e,t])=>t)).map((([e])=>e)))})),(0,r.A)(this,"onReject",(async()=>{this.closeAndTryRemember([])}));_l.WidgetEventCapability.findEventCapabilities(this.props.requestedCapabilities).forEach((e=>this.eventPermissionsMap.set(e.raw,e)));const t={};this.props.requestedCapabilities.forEach((e=>t[e]=!0)),this.state={booleanStates:t,rememberSelection:!0}}closeAndTryRemember(e){this.props.onFinished({approved:e,remember:this.state.rememberSelection})}render(){const e=Object.entries(this.state.booleanStates).sort((([e],[t])=>{const n=(0,_l.isTimelineCapability)(e),i=(0,_l.isTimelineCapability)(t);return n||i?n&&!i?1:!n&&i?-1:n&&i?(0,a.aw)(e,t):0:(0,a.aw)(e,t)})).map((([e,t],n)=>{const i=jl.for(e,this.props.widgetKind),r=i.byline?o.createElement("span",{className:"mx_WidgetCapabilitiesPromptDialog_byline"},i.byline):null;return o.createElement("div",{className:"mx_WidgetCapabilitiesPromptDialog_cap",key:e+n},o.createElement(at.A,{checked:t,onChange:()=>this.onToggle(e)},i.primary),r)}));return o.createElement(cn.A,{className:"mx_WidgetCapabilitiesPromptDialog",onFinished:this.props.onFinished,title:(0,C._t)("widget|capabilities_dialog|title")},o.createElement("form",{onSubmit:this.onSubmit},o.createElement("div",{className:"mx_Dialog_content"},o.createElement("div",{className:"text-muted"},(0,C._t)("widget|capabilities_dialog|content_starting_text")),e,o.createElement(un.A,{primaryButton:(0,C._t)("action|approve"),cancelButton:(0,C._t)("widget|capabilities_dialog|decline_all_permission"),onPrimaryButtonClick:this.onSubmit,onCancel:this.onReject,additive:o.createElement(Nl.A,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:(0,C._t)("widget|capabilities_dialog|remember_Selection")})}))))}}const Vl={};var Hl=n("./node_modules/matrix-react-sdk/src/effects/index.ts"),zl=n("./node_modules/matrix-react-sdk/src/effects/utils.ts"),Wl=n("./node_modules/matrix-react-sdk/src/utils/permalinks/navigator.ts"),Gl=n("./node_modules/matrix-react-sdk/src/modules/ModuleRunner.ts");function Kl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const Jl=({urls:e,username:t,credential:n})=>({uris:e,username:t,password:n});class ql extends _l.WidgetDriver{constructor(e,t,n,i,o){var a;if(super(),(0,r.A)(this,"allowedCapabilities",void 0),this.forWidget=t,this.forWidgetKind=n,this.inRoomId=o,this.allowedCapabilities=new Set([...e,_l.MatrixCapabilities.Screenshots,Ll.RequiresClient]),Tl.x.JITSI.matches(this.forWidget.type)&&n===_l.WidgetKind.Room)this.allowedCapabilities.add(_l.MatrixCapabilities.AlwaysOnScreen);else if(Tl.x.STICKERPICKER.matches(this.forWidget.type)&&n===_l.WidgetKind.Account){const e=_l.WidgetEventCapability.forRoomEvent(_l.EventDirection.Send,s.EventType.Sticker).raw;this.allowedCapabilities.add(_l.MatrixCapabilities.StickerSending),this.allowedCapabilities.add(e),this.allowedCapabilities.add("visibility")}else if(i&&new URL(null!==(a=g.Ay.get("element_call").url)&&void 0!==a?a:g.zY.element_call.url).origin===this.forWidget.origin){this.allowedCapabilities.add(_l.MatrixCapabilities.AlwaysOnScreen),this.allowedCapabilities.add(_l.MatrixCapabilities.MSC3846TurnServers),this.allowedCapabilities.add(`org.matrix.msc2762.timeline:${o}`),this.allowedCapabilities.add(_l.MatrixCapabilities.MSC4157SendDelayedEvent),this.allowedCapabilities.add(_l.MatrixCapabilities.MSC4157UpdateDelayedEvent),this.allowedCapabilities.add(_l.WidgetEventCapability.forRoomEvent(_l.EventDirection.Send,"org.matrix.rageshake_request").raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forRoomEvent(_l.EventDirection.Receive,"org.matrix.rageshake_request").raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Receive,s.EventType.RoomMember).raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Receive,"org.matrix.msc3401.call").raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Receive,s.EventType.RoomEncryption).raw);const e=h.J.safeGet().getSafeUserId();this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Send,"org.matrix.msc3401.call.member",e).raw);const i=h.J.safeGet().getDeviceId();null!==i&&(this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Send,"org.matrix.msc3401.call.member",`_${e}_${i}`).raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Send,"org.matrix.msc3401.call.member",`${e}_${i}`).raw)),this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Receive,"org.matrix.msc3401.call.member").raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forStateEvent(_l.EventDirection.Receive,s.EventType.RoomCreate).raw);const r=["io.element.call.encryption_keys"];for(const e of r)this.allowedCapabilities.add(_l.WidgetEventCapability.forRoomEvent(_l.EventDirection.Send,e).raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forRoomEvent(_l.EventDirection.Receive,e).raw);const a=[s.EventType.CallInvite,s.EventType.CallCandidates,s.EventType.CallAnswer,s.EventType.CallHangup,s.EventType.CallReject,s.EventType.CallSelectAnswer,s.EventType.CallNegotiate,s.EventType.CallSDPStreamMetadataChanged,s.EventType.CallSDPStreamMetadataChangedPrefix,s.EventType.CallReplaces];for(const e of a)this.allowedCapabilities.add(_l.WidgetEventCapability.forToDeviceEvent(_l.EventDirection.Send,e).raw),this.allowedCapabilities.add(_l.WidgetEventCapability.forToDeviceEvent(_l.EventDirection.Receive,e).raw);Xt.M.instance.widgetPermissionStore.setOIDCState(t,n,o,Dl.R.Allowed)}}async validateCapabilities(e){const t=(n=e,i=this.allowedCapabilities,(0,Pl.ZQ)(Array.from(n),Array.from(i)));var n,i;const r=new Set(t.removed),o=new Set(this.allowedCapabilities);var s;let a;if((s=this.forWidget,JSON.parse(localStorage.getItem(`widget_${s.id}_approved_caps`)||"[]")).forEach((e=>{o.add(e),r.delete(e)})),Vl.preapproveCapabilities)a=await Vl.preapproveCapabilities(this.forWidget,e);else{const t={approvedCapabilities:void 0};Gl.r.instance.invoke(fl.Z.CapabilitiesRequest,t,this.forWidget,e),a=t.approvedCapabilities}a&&a.forEach((e=>{o.add(e),r.delete(e)}));let c=!1;if(r.size>0)try{var d;const[e]=await f.Ay.createDialog(Bl,{requestedCapabilities:r,widget:this.forWidget,widgetKind:this.forWidgetKind}).finished;null==e||null===(d=e.approved)||void 0===d||d.forEach((e=>o.add(e))),c=!(null==e||!e.remember)}catch(e){l.v.error("Non-fatal error getting capabilities: ",e)}const u=new Set(function(e,t){return(0,Pl.LY)(Array.from(e),Array.from(t))}(o,e));return c&&function(e,t){localStorage.setItem(`widget_${e.id}_approved_caps`,JSON.stringify(t))}(this.forWidget,Array.from(u)),u}async sendEvent(e,t,n=null,i=null){const r=h.J.get(),o=i||Xt.M.instance.roomViewStore.getRoomId();if(!r||!o)throw new Error("Not in a room or not attached to a client");let a;return null!==n?a=await r.sendStateEvent(o,e,t,n):e===s.EventType.RoomRedaction?a=await r.redactEvent(o,t.redacts):(a=await r.sendEvent(o,e,t),e===s.EventType.RoomMessage&&Hl.y.forEach((e=>{if((0,zl._)(t,e.emojis)){var n;(null===(n=t["m.relates_to"])||void 0===n?void 0:n.rel_type)!==s.THREAD_RELATION_TYPE.name&&v.Ay.dispatch({action:`effects.${e.command}`})}}))),{roomId:o,eventId:a.event_id}}async sendDelayedEvent(e,t,n,i,o=null,s=null){const a=h.J.get(),l=s||Xt.M.instance.roomViewStore.getRoomId();if(!a||!l)throw new Error("Not in a room or not attached to a client");let c,d;if(null!==e)c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kl(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({delay:e},null!==t&&{parent_delay_id:t});else{if(null===t)throw new Error("Must provide at least one of delay or parentDelayId");c={parent_delay_id:t}}return d=null!==o?await a._unstable_sendDelayedStateEvent(l,c,n,i,o):await a._unstable_sendDelayedEvent(l,c,null,n,i),{roomId:l,delayId:d.delay_id}}async updateDelayedEvent(e,t){const n=h.J.get();if(!n)throw new Error("Not in a room or not attached to a client");await n._unstable_updateDelayedEvent(e,t)}async sendToDevice(e,t,n){const i=h.J.safeGet();if(t){const e=await i.crypto.deviceList.downloadKeys(Object.keys(n),!1);await Promise.all(Object.entries(n).flatMap((([t,n])=>Object.entries(n).map((async([n,r])=>{const o=e.get(t);o&&("*"===n?await i.encryptAndSendToDevices(Array.from(o.values()).map((e=>({userId:t,deviceInfo:e}))),r):o.has(n)&&await i.encryptAndSendToDevices([{userId:t,deviceInfo:o.get(n)}],r))})))))}else await i.queueToDevice({eventType:e,batch:Object.entries(n).flatMap((([e,t])=>Object.entries(t).map((([t,n])=>({userId:e,deviceId:t,payload:n})))))})}pickRooms(e){const t=h.J.get();if(!t)throw new Error("Not attached to a client");return(e?e.includes(_l.Symbols.AnyRoom)?t.getVisibleRooms(O.A.getValue("feature_dynamic_room_predecessors")):e.map((e=>t.getRoom(e))):[t.getRoom(Xt.M.instance.roomViewStore.getRoomId())]).filter((e=>!!e))}async readRoomEvents(e,t,n,i){n=n>0?Math.min(n,Number.MAX_SAFE_INTEGER):Number.MAX_SAFE_INTEGER;const r=this.pickRooms(i),o=[];for(const i of r){const r=[],a=i.getLiveTimeline().getEvents();for(let i=a.length-1;i>0&&!(r.length>=n);i--){const n=a[i];n.getType()!==e||n.isState()||e===s.EventType.RoomMessage&&t&&t!==n.getContent().msgtype||r.push(n)}r.forEach((e=>o.push(e.getEffectiveEvent())))}return o}async readStateEvents(e,t,n,i){n=n>0?Math.min(n,Number.MAX_SAFE_INTEGER):Number.MAX_SAFE_INTEGER;const r=this.pickRooms(i),o=[];for(const i of r){const r=[],s=i.currentState.events.get(e);if(s)if(""===t||t){const e=s.get(t);e&&r.push(e)}else r.push(...Array.from(s.values()));r.slice(0,n).forEach((e=>o.push(e.getEffectiveEvent())))}return o}async askOpenID(e){const t={approved:void 0};if(Gl.r.instance.invoke(fl.Z.IdentityRequest,t,this.forWidget),t.approved)return e.update({state:_l.OpenIDRequestState.Allowed,token:await h.J.safeGet().getOpenIdToken()});const n=Xt.M.instance.widgetPermissionStore.getOIDCState(this.forWidget,this.forWidgetKind,this.inRoomId),i=()=>h.J.safeGet().getOpenIdToken();return n===Dl.R.Denied?e.update({state:_l.OpenIDRequestState.Blocked}):n===Dl.R.Allowed?e.update({state:_l.OpenIDRequestState.Allowed,token:await i()}):(e.update({state:_l.OpenIDRequestState.PendingUserConfirmation}),void f.Ay.createDialog(Ml,{widget:this.forWidget,widgetKind:this.forWidgetKind,inRoomId:this.inRoomId,onFinished:async t=>t?e.update({state:_l.OpenIDRequestState.Allowed,token:await i()}):e.update({state:_l.OpenIDRequestState.Blocked})}))}async navigate(e){(0,Wl.O)(e)}async*getTurnServers(){const e=h.J.safeGet();if(!e.pollingTurnServers||!e.getTurnServers().length)return;let t,n;const i=([e])=>t(Jl(e)),r=(e,t)=>{t&&n(e)};e.on(s.ClientEvent.TurnServers,i),e.on(s.ClientEvent.TurnServersError,r);try{const i=e.getTurnServers()[0];for(yield Jl(i);;)yield await new Promise(((e,i)=>{t=e,n=i}))}finally{e.off(s.ClientEvent.TurnServers,i),e.off(s.ClientEvent.TurnServersError,r)}}async readEventRelations(e,t,n,i,r,o,s,a){var l,c;const d=h.J.safeGet(),u=a;if("string"!=typeof(t=null!==(l=null!==(c=t)&&void 0!==c?c:Xt.M.instance.roomViewStore.getRoomId())&&void 0!==l?l:void 0))throw new Error("Error while reading the current room");const{events:m,nextBatch:p,prevBatch:g}=await d.relations(t,e,null!=n?n:null,null!=i?i:null,{from:r,to:o,limit:s,dir:u});return{chunk:m.map((e=>e.getEffectiveEvent())),nextBatch:null!=p?p:void 0,prevBatch:null!=g?g:void 0}}async searchUserDirectory(e,t){const n=h.J.safeGet(),{limited:i,results:r}=await n.searchUserDirectory({term:e,limit:t});return{limited:i,results:r.map((e=>({userId:e.user_id,displayName:e.display_name,avatarUrl:e.avatar_url})))}}async getMediaConfig(){const e=h.J.safeGet();return await e.getMediaConfig()}async uploadFile(e){const t=h.J.safeGet();return{contentUri:(await t.uploadContent(e)).content_uri}}async downloadFile(e){const t=h.J.safeGet(),n=new Ds.$U({mxc:e},t),i=await n.downloadSource();return{file:await i.blob()}}}var $l=n("./node_modules/matrix-react-sdk/src/stores/widgets/WidgetMessagingStore.ts"),Yl=n("./node_modules/matrix-react-sdk/src/integrations/IntegrationManagers.ts"),Ql=n("./node_modules/matrix-react-sdk/src/stores/widgets/ElementWidgetActions.ts");const Zl="io.element.web";function Xl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ec(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xl(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class tc extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"widget",void 0),(0,r.A)(this,"possibleButtons",void 0),(0,r.A)(this,"appFrame",o.createRef()),(0,r.A)(this,"state",{disabledButtonIds:(this.props.widgetDefinition.buttons||[]).filter((e=>e.disabled)).map((e=>e.id))}),(0,r.A)(this,"onReady",(()=>{var e;null===(e=this.state.messaging)||void 0===e||e.sendWidgetConfig(this.props.widgetDefinition)})),(0,r.A)(this,"onLoad",(()=>{this.state.messaging&&(this.state.messaging.once("ready",this.onReady),this.state.messaging.on(`action:${_l.WidgetApiFromWidgetAction.CloseModalWidget}`,this.onWidgetClose),this.state.messaging.on(`action:${_l.WidgetApiFromWidgetAction.SetModalButtonEnabled}`,this.onButtonEnableToggle))})),(0,r.A)(this,"onWidgetClose",(e=>{this.props.onFinished(!0,e.detail.data)})),(0,r.A)(this,"onButtonEnableToggle",(e=>{var t;e.preventDefault();var n;if(e.detail.data.button===_l.BuiltInModalButtonID.Close||!this.possibleButtons.includes(e.detail.data.button))return null===(n=this.state.messaging)||void 0===n?void 0:n.transport.reply(e.detail,{error:{message:"Invalid button"}});let i;if(e.detail.data.enabled)i=(0,Pl.PF)(this.state.disabledButtonIds).filter((t=>t!==e.detail.data.button));else{const t=new Set(this.state.disabledButtonIds);t.add(e.detail.data.button),i=Array.from(t)}this.setState({disabledButtonIds:i}),null===(t=this.state.messaging)||void 0===t||t.transport.reply(e.detail,{})})),this.widget=new uc(ec(ec({},this.props.widgetDefinition),{},{creatorUserId:h.J.safeGet().getSafeUserId(),id:`modal_${this.props.sourceWidgetId}`})),this.possibleButtons=(this.props.widgetDefinition.buttons||[]).map((e=>e.id))}componentDidMount(){const e=new ql([],this.widget,_l.WidgetKind.Modal,!1),t=new _l.ClientWidgetApi(this.widget,this.appFrame.current,e);this.setState({messaging:t})}componentWillUnmount(){this.state.messaging&&(this.state.messaging.off("ready",this.onReady),this.state.messaging.off(`action:${_l.WidgetApiFromWidgetAction.CloseModalWidget}`,this.onWidgetClose),this.state.messaging.stop())}render(){var e,t,i;const r=this.widget.getCompleteUrl({widgetRoomId:this.props.widgetRoomId,currentUserId:h.J.safeGet().getSafeUserId(),userDisplayName:null!==(e=wn.V.instance.displayName)&&void 0!==e?e:void 0,userHttpAvatarUrl:null!==(t=wn.V.instance.getHttpAvatarUrl())&&void 0!==t?t:void 0,clientId:Zl,clientTheme:O.A.getValue("theme"),clientLanguage:(0,C.mf)(),baseUrl:h.J.safeGet().baseUrl}),s=new URL(r);s.searchParams.set("widgetId",this.widget.id),s.searchParams.set("parentUrl",window.location.href.split("#",2)[0]);const a=s.toString().replace(/%24/g,"$");let l;return this.props.widgetDefinition.buttons&&(l=this.props.widgetDefinition.buttons.slice(0,3).reverse().map((e=>{let t="secondary";switch(e.kind){case _l.ModalButtonKind.Primary:t="primary";break;case _l.ModalButtonKind.Secondary:t="primary_outline";break;case _l.ModalButtonKind.Danger:t="danger"}const n=this.state.disabledButtonIds.includes(e.id);return o.createElement(be.A,{key:e.id,kind:t,onClick:()=>{var t;null===(t=this.state.messaging)||void 0===t||t.notifyModalWidgetButtonClicked(e.id)},disabled:n},e.label)}))),o.createElement(cn.A,{title:this.props.widgetDefinition.name||(0,C._t)("widget|modal_title_default"),className:"mx_ModalWidgetDialog",contentId:"mx_Dialog_content",onFinished:this.props.onFinished},o.createElement("div",{className:"mx_ModalWidgetDialog_warning"},o.createElement("img",{src:n("./node_modules/matrix-react-sdk/res/img/element-icons/warning-badge.svg").A,height:"16",width:"16",alt:""}),(0,C._t)("widget|modal_data_warning",{widgetDomain:s.hostname})),o.createElement("div",null,o.createElement("iframe",{title:null!==(i=this.widget.name)&&void 0!==i?i:void 0,ref:this.appFrame,sandbox:"allow-forms allow-scripts allow-same-origin",src:a,onLoad:this.onLoad})),o.createElement("div",{className:"mx_ModalWidgetDialog_buttons"},l))}}var nc;function ic(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function rc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ic(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ic(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class oc extends M.r{constructor(){super(v.Ay,{}),(0,r.A)(this,"modalInstance",null),(0,r.A)(this,"openSourceWidgetId",null),(0,r.A)(this,"openSourceWidgetRoomId",null),(0,r.A)(this,"canOpenModalWidget",(()=>!this.modalInstance)),(0,r.A)(this,"openModalWidget",((e,t,n)=>{this.modalInstance||(this.openSourceWidgetId=t.id,this.openSourceWidgetRoomId=null!=n?n:null,this.modalInstance=f.Ay.createDialog(tc,{widgetDefinition:rc({},e),widgetRoomId:n,sourceWidgetId:t.id,onFinished:(e,i)=>{this.closeModalWidget(t,n,e&&i?i:{"m.exited":!0}),this.openSourceWidgetId=null,this.openSourceWidgetRoomId=null,this.modalInstance=null}},void 0,!1,!0))})),(0,r.A)(this,"closeModalWidget",((e,t,n)=>{if(this.modalInstance&&this.openSourceWidgetId===e.id&&this.openSourceWidgetRoomId===t){this.openSourceWidgetId=null,this.openSourceWidgetRoomId=null,this.modalInstance.close(),this.modalInstance=null;const i=$l.c.instance.getMessaging(e,t);if(!i)return void l.v.error("No source widget messaging for modal widget");i.notifyModalWidgetClose(n)}}))}static get instance(){return oc.internalInstance}async onAction(e){}}nc=oc,(0,r.A)(oc,"internalInstance",(()=>{const e=new nc;return e.start(),e})()),window.mxModalWidgetStore=oc.instance;var sc=n("./node_modules/matrix-react-sdk/src/stores/WidgetStore.ts");const ac={};var lc=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx");function cc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function dc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cc(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class uc extends _l.Widget{constructor(e){super(e),this.rawDefinition=e}get templateUrl(){var e;return Tl.x.JITSI.matches(this.type)?vl.A.getLocalJitsiWrapperUrl({forLocalRender:!0,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):super.templateUrl}get popoutTemplateUrl(){var e;return Tl.x.JITSI.matches(this.type)?vl.A.getLocalJitsiWrapperUrl({forLocalRender:!1,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):this.templateUrl}get rawData(){let e=super.rawData.conferenceId;if(void 0===e){e=new URL(super.templateUrl).searchParams.get("confId")}let t=super.rawData.domain;void 0===t&&(t="meet.element.io");let n=(new $.A).getEffectiveTheme();if(n.startsWith("custom-")){const e=(0,Lt.TP)(n.slice(7));n=e.is_dark?"dark":"light"}return n=n.includes("light")?"light":"dark",dc(dc({},super.rawData),{},{theme:n,conferenceId:e,domain:t})}getCompleteUrl(e,t=!1){return(0,_l.runTemplate)(t?this.popoutTemplateUrl:this.templateUrl,dc(dc({},this.rawDefinition),{},{data:this.rawData}),e)}}class mc extends K.EventEmitter{constructor(e){var t;super(),(0,r.A)(this,"client",void 0),(0,r.A)(this,"messaging",null),(0,r.A)(this,"mockWidget",void 0),(0,r.A)(this,"scalarToken",void 0),(0,r.A)(this,"roomId",void 0),(0,r.A)(this,"kind",void 0),(0,r.A)(this,"virtual",void 0),(0,r.A)(this,"readUpToMap",{}),(0,r.A)(this,"stickyPromise",void 0),(0,r.A)(this,"onOpenModal",(async e=>{var t,n;(e.preventDefault(),oc.instance.canOpenModalWidget())?(oc.instance.openModalWidget(e.detail.data,this.mockWidget,this.roomId),null===(t=this.messaging)||void 0===t||t.transport.reply(e.detail,{})):null===(n=this.messaging)||void 0===n||n.transport.reply(e.detail,{error:{message:"Unable to open modal at this time"}})})),(0,r.A)(this,"onEvent",(e=>{this.client.decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()||this.feedEvent(e)})),(0,r.A)(this,"onEventDecrypted",(e=>{e.isDecryptionFailure()||this.feedEvent(e)})),(0,r.A)(this,"onToDeviceEvent",(async e=>{var t;await this.client.decryptEventIfNeeded(e),e.isDecryptionFailure()||await(null===(t=this.messaging)||void 0===t?void 0:t.feedToDevice(e.getEffectiveEvent(),e.isEncrypted()))})),this.appTileProps=e,this.client=h.J.safeGet();let n=e.app;n.creatorUserId||(n=(0,Ol.tn)(n),n.creatorUserId=this.client.getUserId()),this.mockWidget=new uc(n),this.roomId=null===(t=e.room)||void 0===t?void 0:t.roomId,this.kind=e.userWidget?_l.WidgetKind.Account:_l.WidgetKind.Room,this.virtual=(0,sc.Sw)(n)&&void 0===n.eventId,this.stickyPromise=e.stickyPromise}get eventListenerRoomId(){return this.roomId?this.roomId:Xt.M.instance.roomViewStore.getRoomId()}get widgetApi(){return this.messaging}get embedUrl(){return this.runUrlTemplate({asPopout:!1})}get popoutUrl(){return this.runUrlTemplate({asPopout:!0})}runUrlTemplate(e={asPopout:!1}){var t,n,i,r,o;const s=null!==(t=null==ac||null===(n=ac.provideVariables)||void 0===n?void 0:n.call(ac))&&void 0!==t?t:{},a={widgetRoomId:this.roomId,currentUserId:this.client.getUserId(),userDisplayName:null!==(i=wn.V.instance.displayName)&&void 0!==i?i:void 0,userHttpAvatarUrl:null!==(r=wn.V.instance.getHttpAvatarUrl())&&void 0!==r?r:void 0,clientId:Zl,clientTheme:O.A.getValue("theme"),clientLanguage:(0,C.mf)(),deviceId:null!==(o=this.client.getDeviceId())&&void 0!==o?o:void 0,baseUrl:this.client.baseUrl},l=this.mockWidget.getCompleteUrl(Object.assign(a,s),null==e?void 0:e.asPopout),c=new URL(l);return null!=e&&e.asPopout||(c.searchParams.set("widgetId",this.mockWidget.id),c.searchParams.set("parentUrl",window.location.href.split("#",2)[0]),this.scalarToken&&c.searchParams.set("scalar_token",this.scalarToken)),c.toString().replace(/%24/g,"$")}get started(){return!!this.messaging}startMessaging(e){if(this.started)return;const t=this.appTileProps.whitelistCapabilities||[],n=new ql(t,this.mockWidget,this.kind,this.virtual,this.roomId);this.messaging=new _l.ClientWidgetApi(this.mockWidget,e,n),this.messaging.on("preparing",(()=>this.emit("preparing"))),this.messaging.on("error:preparing",(e=>this.emit("error:preparing",e))),this.messaging.on("ready",(()=>{$l.c.instance.storeMessaging(this.mockWidget,this.roomId,this.messaging),this.emit("ready")})),this.messaging.on("capabilitiesNotified",(()=>this.emit("capabilitiesNotified"))),this.messaging.on(`action:${_l.WidgetApiFromWidgetAction.OpenModalWidget}`,this.onOpenModal),this.messaging.on(`action:${Ql.k.JoinCall}`,(()=>{var e;null===(e=Xt.M.instance.voiceBroadcastRecordingsStore.getCurrent())||void 0===e||e.pause()})),this.messaging.on(`action:${Ql.k.ViewRoom}`,(e=>{var t;e.preventDefault();const n=(e.detail.data||{}).room_id;var i,r;return n?null!==(t=this.messaging)&&void 0!==t&&t.hasCapability(Ll.CanChangeViewedRoom)?(v.Ay.dispatch({action:x.r.ViewRoom,room_id:n,metricsTrigger:"Widget"}),void this.messaging.transport.reply(e.detail,{})):null===(r=this.messaging)||void 0===r?void 0:r.transport.reply(e.detail,{error:{message:"This widget does not have permission for this action (denied)."}}):null===(i=this.messaging)||void 0===i?void 0:i.transport.reply(e.detail,{error:{message:"Room ID not supplied."}})}));for(const e of this.client.getRooms()){var i;const t=(null===(i=e.getLiveTimeline())||void 0===i?void 0:i.getEvents())||[],n=t[t.length-1];n&&(this.readUpToMap[e.roomId]=n.getId())}this.client.on(s.ClientEvent.Event,this.onEvent),this.client.on(s.MatrixEventEvent.Decrypted,this.onEventDecrypted),this.client.on(s.ClientEvent.ToDeviceEvent,this.onToDeviceEvent),this.messaging.on(`action:${_l.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen}`,(async e=>{var t,n;null!==(t=this.messaging)&&void 0!==t&&t.hasCapability(_l.MatrixCapabilities.AlwaysOnScreen)&&(e.preventDefault(),e.detail.data.value&&this.stickyPromise&&await this.stickyPromise(),Cl.A.instance.setWidgetPersistence(this.mockWidget.id,null!==(n=this.roomId)&&void 0!==n?n:null,e.detail.data.value),this.messaging.transport.reply(e.detail,{}))})),this.messaging.on(`action:${_l.WidgetApiFromWidgetAction.SendSticker}`,(e=>{var t;null!==(t=this.messaging)&&void 0!==t&&t.hasCapability(_l.MatrixCapabilities.StickerSending)&&(e.preventDefault(),this.messaging.transport.reply(e.detail,{}),v.Ay.dispatch({action:"m.sticker",data:e.detail.data,widgetId:this.mockWidget.id}))})),Tl.x.STICKERPICKER.matches(this.mockWidget.type)&&this.messaging.on(`action:${Ql.k.OpenIntegrationManager}`,(e=>{var t,n;e.preventDefault(),null===(t=this.messaging)||void 0===t||t.transport.reply(e.detail,{}),v.Ay.dispatch({action:"stickerpicker_close"});const i=e.detail.data,r=null==i?void 0:i.integType,o=null==i?void 0:i.integId,s=Xt.M.instance.roomViewStore.getRoomId(),a=s?this.client.getRoom(s):void 0;a&&(null===(n=Yl.J.sharedInstance())||void 0===n||null===(n=n.getPrimaryManager())||void 0===n||n.open(a,`type_${r}`,o))})),Tl.x.JITSI.matches(this.mockWidget.type)&&this.messaging.on(`action:${Ql.k.HangupCall}`,(e=>{var t,n;e.preventDefault(),null!==(t=e.detail.data)&&void 0!==t&&t.errorMessage&&f.Ay.createDialog(lc.A,{title:(0,C._t)("widget|error_hangup_title"),description:(0,C._t)("widget|error_hangup_description",{message:e.detail.data.errorMessage})}),null===(n=this.messaging)||void 0===n||n.transport.reply(e.detail,{})}))}async prepare(){var e,t;if(await(null!==(e=null==ac||null===(t=ac.isReady)||void 0===t?void 0:t.call(ac))&&void 0!==e?e:Promise.resolve()),this.scalarToken)return;const n=$l.c.instance.getMessaging(this.mockWidget,this.roomId);n&&(this.messaging=n);try{if(vl.A.isScalarUrl(this.mockWidget.templateUrl)){const e=Yl.J.sharedInstance();if(e.hasManager()){const t=e.getPrimaryManager();if(t&&vl.A.isScalarUrl(t.apiUrl)){const e=t.getScalarClient();this.scalarToken=await e.getScalarToken()}}}}catch(e){l.v.error("Error preparing widget communications: ",e)}}stopMessaging(e={forceDestroy:!1}){var t;null!=e&&e.forceDestroy||!Cl.A.instance.getWidgetPersistence(this.mockWidget.id,null!==(t=this.roomId)&&void 0!==t?t:null)?this.started&&($l.c.instance.stopMessaging(this.mockWidget,this.roomId),this.messaging=null,this.client.off(s.ClientEvent.Event,this.onEvent),this.client.off(s.MatrixEventEvent.Decrypted,this.onEventDecrypted),this.client.off(s.ClientEvent.ToDeviceEvent,this.onToDeviceEvent)):l.v.log("Skipping destroy - persistent widget")}feedEvent(e){if(!this.messaging)return;let t;const n=this.readUpToMap[e.getRoomId()];if(n){if(n===e.getId())return;let i=!1;const r=this.client.getRoom(e.getRoomId());if(!r)return;const o=r.getLiveTimeline(),s=(0,Pl.PF)(o.getEvents()).reverse().slice(0,100);for(const t of s){if(t.getId()===n)break;if(t.getId()===e.getId()){i=!0;break}}if(!i&&(t=!e.replyEventId&&!!e.relationEventId&&!r.findEventById(e.relationEventId),!t))return}const i=e.getRoomId(),r=e.getId();if(i&&r){const e=this.client.getRoom(i);e&&e.getMyMembership()===We.O.Join&&!t&&(this.readUpToMap[i]=r)}const o=e.getEffectiveEvent();this.messaging.feedEvent(o,this.eventListenerRoomId).catch((e=>{l.v.error("Error sending event to widget: ",e)}))}}var hc=n("./node_modules/matrix-react-sdk/src/stores/widgets/WidgetLayoutStore.ts");function pc(){return g.Ay.get("audio_stream_url")}async function gc(e,t,n){const i=await async function(e,t){const n=await e.getOpenIdToken(),i=pc()+"/createStream",r=await window.fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:t,openid_token:n})});return(await r.json()).stream_id}(e,n);await t.transport.send(Ql.k.StartLiveStream,{rtmpStreamKey:"rtmp://audiostream.dummy/"+i})}const vc=["onFinished","app","userWidget","onDeleteClick","onEditClick","showUnpin"],_c=e=>!!pc()&&Tl.x.JITSI.matches(e.type),fc=(e,t)=>t&&vl.A.isManagedByManager(e),yc=(e,t,n,i)=>{var r;const o=(0,sc.Sw)(n)&&void 0!==n.eventId&&null!==(r=O.A.getValue("allowedWidgets",t)[n.eventId])&&void 0!==r&&r||n.creatorUserId===(null==e?void 0:e.getUserId()),s=Tl.x.JITSI.matches(n.type);return!i&&!s&&o},Ec=(e,t)=>!!t||e,bc=e=>O.A.getValue("enableWidgetScreenshots")&&!(null==e||!e.hasCapability(_l.MatrixCapabilities.Screenshots)),wc=(e,t,n)=>{if(!n)return[!1,!1];const i=t?hc.aK.instance.getContainerWidgets(t,hc.mc.Top):[],r=i.findIndex((t=>t.id===e.id));return[r>0,r<i.length-1]},xc=(e,t,n,i,r,o)=>{const s=i||vl.A.canUserModifyWidgets(e,null==t?void 0:t.roomId),a=$l.c.instance.getMessagingForUid(vl.A.getWidgetUid(n));return _c(n)||fc(n,s)||yc(e,null==t?void 0:t.roomId,n,i)||Ec(s,o)||bc(a)||wc(n,t,r).some(Boolean)},Ac=e=>{let{onFinished:t,app:n,userWidget:r,onDeleteClick:s,onEditClick:a,showUnpin:c}=e,d=(0,Ue.A)(e,vc);const u=(0,o.useContext)(Re.Ay),{room:m,roomId:h}=(0,o.useContext)(Zr.Ay),p=$l.c.instance.getMessagingForUid(vl.A.getWidgetUid(n)),g=r||vl.A.canUserModifyWidgets(u,h);let _,y,E,b,w;if(h&&_c(n)){const e=async()=>{try{await gc(u,p,h)}catch(e){l.v.error("Failed to start livestream",e);const t=e instanceof Error?e.message:(0,C._t)("widget|error_unable_start_audio_stream_description");f.Ay.createDialog(lc.A,{title:(0,C._t)("widget|error_unable_start_audio_stream_title"),description:t})}t()};_=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("widget|context_menu|start_audio_stream")})}if(fc(n,g)){const e=()=>{a?a():m&&vl.A.editWidget(m,n),t()};y=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("action|edit")})}if(bc(p)){const e=()=>{null==p||p.takeScreenshot().then((e=>{v.Ay.dispatch({action:"picture_snapshot",file:e.screenshot})})).catch((e=>{l.v.error("Failed to take screenshot: ",e)})),t()};E=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("widget|context_menu|screenshot")})}if(Ec(g,s)){const e=()=>{s?s():h&&f.Ay.createDialog(z.A,{title:(0,C._t)("widget|context_menu|delete"),description:(0,C._t)("widget|context_menu|delete_warning"),button:(0,C._t)("widget|context_menu|delete"),onFinished:e=>{e&&vl.A.setRoomWidget(u,h,n.id)}}),t()};b=o.createElement(Le.R$,{onClick:e,label:r?(0,C._t)("action|remove"):(0,C._t)("widget|context_menu|remove")})}if(yc(u,h,n,r)){const e={approved:void 0};if(Gl.r.instance.invoke(fl.Z.PreLoadRequest,e,new uc(n)),!e.approved){const e=()=>{const e=(0,sc.Sw)(n)?n.eventId:void 0;l.v.info("Revoking permission for widget to load: "+e);const i=O.A.getValue("allowedWidgets",h);void 0!==e&&(i[e]=!1);const r=O.A.firstSupportedLevel("allowedWidgets");if(!r)throw new Error("level must be defined");O.A.setValue("allowedWidgets",null!=h?h:null,r,i).catch((e=>{l.v.error(e)})),t()};w=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("widget|context_menu|revoke")})}}const[x,A]=wc(n,m,c);let S,k;if(x){const e=()=>{if(!m)throw new Error("room must be defined");hc.aK.instance.moveWithinContainer(m,hc.mc.Top,n,-1),t()};S=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("widget|context_menu|move_left")})}if(A){const e=()=>{if(!m)throw new Error("room must be defined");hc.aK.instance.moveWithinContainer(m,hc.mc.Top,n,1),t()};k=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("widget|context_menu|move_right")})}return o.createElement(Le.Ay,(0,i.A)({},d,{chevronFace:Me.t4.None,onFinished:t}),o.createElement(Le.tx,null,_,y,w,b,E,S,k))},Sc=["app","className","size"],Cc=e=>{let{app:t,className:r,size:s="20px"}=e,a=(0,Ue.A)(e,Sc),l=[n("./node_modules/matrix-react-sdk/res/img/element-icons/room/default_app.svg").A];return t.type.includes("jitsi")?l=[n("./node_modules/matrix-react-sdk/res/img/element-icons/room/default_video.svg").A]:t.type.includes("meeting")||t.type.includes("calendar")?l=[n("./node_modules/matrix-react-sdk/res/img/element-icons/room/default_cal.svg").A]:t.type.includes("pad")||t.type.includes("doc")||t.type.includes("calc")?l=[n("./node_modules/matrix-react-sdk/res/img/element-icons/room/default_doc.svg").A]:t.type.includes("clock")&&(l=[n("./node_modules/matrix-react-sdk/res/img/element-icons/room/default_clock.svg").A]),o.createElement(xn.A,(0,i.A)({},a,{name:t.id,className:ee()("mx_WidgetAvatar",r),url:(0,sc.Sw)(t)&&t.avatar_url?(0,Ds.lH)(t.avatar_url).getSquareThumbnailHttp(20):null,urls:l,size:s}))};var kc;function Rc(){return Rc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Rc.apply(null,arguments)}var Ic=function(e,t){return o.createElement("svg",Rc({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",role:"presentation","aria-hidden":!0,ref:t},e),kc||(kc=o.createElement("path",{fill:"currentColor",d:"m13.786 1.25-3.351 3.351 1.16 1.161c.46.46.132 1.248-.518 1.248H7.733a.73.73 0 0 1-.73-.73V2.922c0-.65.789-.978 1.249-.518l1.16 1.16 3.351-3.35a.727.727 0 0 1 1.03 0 .743.743 0 0 1-.007 1.036M1.25 13.786l3.351-3.351 1.161 1.16c.46.46 1.248.132 1.248-.518V7.733a.73.73 0 0 0-.73-.73H2.922c-.65 0-.978.789-.518 1.249l1.16 1.16-3.35 3.351a.727.727 0 0 0 0 1.03.743.743 0 0 0 1.036-.007"})))},Tc=(0,o.forwardRef)(Ic);var Pc;function Nc(){return Nc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Nc.apply(null,arguments)}var Dc=function(e,t){return o.createElement("svg",Nc({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",role:"presentation","aria-hidden":!0,ref:t},e),Pc||(Pc=o.createElement("path",{fill:"currentColor",d:"M14 4.348V.778A.78.78 0 0 0 13.222 0h-3.57C8.96 0 8.61.84 9.1 1.33l1.237 1.237-7.778 7.777-1.237-1.236C.84 8.618 0 8.96 0 9.652v3.57c0 .428.35.778.778.778h3.57c.692 0 1.042-.84.552-1.33l-1.237-1.237 7.778-7.777 1.237 1.236c.482.49 1.322.148 1.322-.544"})))},Mc=(0,o.forwardRef)(Dc);var Oc,Lc=n("./node_modules/matrix-react-sdk/res/img/element-icons/minus-button.svg");function Uc(){return Uc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Uc.apply(null,arguments)}var Fc=function(e,t){return o.createElement("svg",Uc({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 11 11",role:"presentation","aria-hidden":!0,ref:t},e),Oc||(Oc=o.createElement("path",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",d:"M8.5 6v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h3M7 1h3v3M4.5 6.5 10 1"})))},jc=(0,o.forwardRef)(Fc);function Bc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Vc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bc(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Hc extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"contextMenuButton",(0,o.createRef)()),(0,r.A)(this,"iframe",void 0),(0,r.A)(this,"allowedWidgetsWatchRef",void 0),(0,r.A)(this,"persistKey",void 0),(0,r.A)(this,"sgWidget",void 0),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"watchUserReady",(()=>{wn.V.instance.isProfileInfoFetched||wn.V.instance.once(A.H,this.onUserReady)})),(0,r.A)(this,"onUserReady",(()=>{this.setState({isUserProfileReady:!0})})),(0,r.A)(this,"hasPermissionToLoad",(e=>{var t;if(this.usingLocalWidget())return!0;if(!e.room)return!0;const n={approved:void 0};if(Gl.r.instance.invoke(fl.Z.PreLoadRequest,n,new uc(this.props.app)),n.approved)return!0;const i=O.A.getValue("allowedWidgets",e.room.roomId);return(0,sc.Sw)(e.app)&&void 0!==e.app.eventId&&null!==(t=i[e.app.eventId])&&void 0!==t&&t||e.userId===e.creatorUserId})),(0,r.A)(this,"onMyMembership",((e,t)=>{var n;t!==We.O.Leave&&t!==We.O.Ban||e.roomId!==(null===(n=this.props.room)||void 0===n?void 0:n.roomId)||this.onUserLeftRoom()})),(0,r.A)(this,"onAllowedWidgetsChange",(()=>{const e=this.hasPermissionToLoad(this.props);var t;this.state.hasPermissionToLoad&&!e&&(Cl.A.instance.destroyPersistentWidget(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null),Il.destroyElement(this.persistKey),null===(t=this.sgWidget)||void 0===t||t.stopMessaging());this.setState({hasPermissionToLoad:e})})),(0,r.A)(this,"iframeRefChange",(e=>{this.iframe=e,this.unmounted||(e?this.startMessaging():this.resetWidget(this.props))})),(0,r.A)(this,"onWidgetReady",(()=>{this.setState({loading:!1})})),(0,r.A)(this,"updateRequiresClient",(()=>{var e;this.setState({requiresClient:!(null===(e=this.sgWidget)||void 0===e||null===(e=e.widgetApi)||void 0===e||!e.hasCapability(Ll.RequiresClient))})})),(0,r.A)(this,"onAction",(e=>{var t,n;switch(e.action){case"m.sticker":e.widgetId===this.props.app.id&&null!==(t=this.sgWidget)&&void 0!==t&&null!==(t=t.widgetApi)&&void 0!==t&&t.hasCapability(_l.MatrixCapabilities.StickerSending)?(v.Ay.dispatch({action:"post_sticker_message",data:Vc(Vc({},e.data),{},{threadId:this.props.threadId})}),v.Ay.dispatch({action:"stickerpicker_close"})):l.v.warn("Ignoring sticker message. Invalid capability");break;case x.r.AfterLeaveRoom:e.room_id===(null===(n=this.props.room)||void 0===n?void 0:n.roomId)&&this.onUserLeftRoom()}})),(0,r.A)(this,"grantWidgetPermission",(()=>{var e;const t=null===(e=this.props.room)||void 0===e?void 0:e.roomId,n=(0,sc.Sw)(this.props.app)?this.props.app.eventId:void 0;l.v.info("Granting permission for widget to load: "+n);const i=O.A.getValue("allowedWidgets",t);void 0!==n&&(i[n]=!0);const r=O.A.firstSupportedLevel("allowedWidgets");O.A.setValue("allowedWidgets",null!=t?t:null,r,i).then((()=>{this.setState({hasPermissionToLoad:!0}),this.startWidget()})).catch((e=>{l.v.error(e)}))})),(0,r.A)(this,"onPopoutWidgetClick",(()=>{var e;Tl.x.JITSI.matches(this.props.app.type)&&this.reload(),Object.assign(document.createElement("a"),{target:"_blank",href:null===(e=this.sgWidget)||void 0===e?void 0:e.popoutUrl,rel:"noreferrer noopener"}).click()})),(0,r.A)(this,"onToggleMaximisedClick",(()=>{if(!this.props.room)return;const e=hc.aK.instance.isInContainer(this.props.room,this.props.app,hc.mc.Center)?hc.mc.Top:hc.mc.Center;hc.aK.instance.moveToContainer(this.props.room,this.props.app,e)})),(0,r.A)(this,"onMinimiseClicked",(()=>{this.props.room&&hc.aK.instance.moveToContainer(this.props.room,this.props.app,hc.mc.Right)})),(0,r.A)(this,"onContextMenuClick",(()=>{this.setState({menuDisplayed:!0})})),(0,r.A)(this,"closeContextMenu",(()=>{this.setState({menuDisplayed:!1})})),this.props.miniMode||Cl.A.instance.dockWidget(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null),this.persistKey="widget_"+vl.A.getWidgetUid(this.props.app);try{this.sgWidget=new mc(this.props),this.setupSgListeners()}catch(e){l.v.log("Failed to construct widget",e),this.sgWidget=null}this.state=this.getNewState(e)}onUserLeftRoom(){Cl.A.instance.getWidgetPersistence(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null)&&(this.props.room&&Xt.M.instance.roomViewStore.getRoomId()!==this.props.room.roomId?this.endWidgetActions():Tl.x.JITSI.matches(this.props.app.type)?this.reload():Cl.A.instance.destroyPersistentWidget(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null))}determineInitialRequiresClientState(){try{var e;const t=new uc(this.props.app),n=$l.c.instance.getMessaging(t,null===(e=this.props.room)||void 0===e?void 0:e.roomId);if(n)return n.hasCapability(Ll.RequiresClient)}catch{}return!0}getNewState(e){return{initialising:!0,loading:!this.props.waitForIframeLoad&&!Il.isMounted(this.persistKey),hasPermissionToLoad:this.hasPermissionToLoad(e),isUserProfileReady:wn.V.instance.isProfileInfoFetched,error:null,menuDisplayed:!1,requiresClient:this.determineInitialRequiresClientState(),hasContextMenuOptions:xc(this.context,this.props.room,e.app,e.userWidget,!e.userWidget,e.onDeleteClick)}}isMixedContent(){const e=window.location.protocol,t=(0,yl.Dl)(this.props.app.url).protocol;return"https:"===e&&"https:"!==t&&(l.v.warn("Refusing to load mixed-content app:",e,t,window.location,this.props.app.url),!0)}componentDidMount(){this.sgWidget&&this.state.hasPermissionToLoad&&this.startWidget(),this.watchUserReady(),this.props.room&&this.context.on(s.RoomEvent.MyMembership,this.onMyMembership),this.allowedWidgetsWatchRef=O.A.watchSetting("allowedWidgets",null,this.onAllowedWidgetsChange),this.dispatcherRef=v.Ay.register(this.onAction)}componentWillUnmount(){this.unmounted=!0,this.props.miniMode||Cl.A.instance.undockWidget(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null),Cl.A.instance.isLive(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null)||this.endWidgetActions(),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef),this.props.room&&this.context.off(s.RoomEvent.MyMembership,this.onMyMembership),this.allowedWidgetsWatchRef&&O.A.unwatchSetting(this.allowedWidgetsWatchRef),wn.V.instance.removeListener(A.H,this.onUserReady)}setupSgListeners(){var e,t,n;null===(e=this.sgWidget)||void 0===e||e.on("ready",this.onWidgetReady),null===(t=this.sgWidget)||void 0===t||t.on("error:preparing",this.updateRequiresClient),null===(n=this.sgWidget)||void 0===n||n.on("capabilitiesNotified",this.updateRequiresClient)}stopSgListeners(){var e;this.sgWidget&&(null===(e=this.sgWidget)||void 0===e||e.off("ready",this.onWidgetReady),this.sgWidget.off("error:preparing",this.updateRequiresClient),this.sgWidget.off("capabilitiesNotified",this.updateRequiresClient))}resetWidget(e){var t;null===(t=this.sgWidget)||void 0===t||t.stopMessaging(),this.stopSgListeners();try{this.sgWidget=new mc(e),this.setupSgListeners(),this.startWidget()}catch(e){l.v.error("Failed to construct widget",e),this.sgWidget=null}}startWidget(){var e;null===(e=this.sgWidget)||void 0===e||e.prepare().then((()=>{this.unmounted||this.setState({initialising:!1})}))}startMessaging(){try{var e;null===(e=this.sgWidget)||void 0===e||e.startMessaging(this.iframe)}catch(e){l.v.error("Failed to start widget",e)}}componentDidUpdate(e){e.app.url!==this.props.app.url&&(this.getNewState(this.props),this.state.hasPermissionToLoad&&this.resetWidget(this.props))}async endWidgetActions(){var e;this.iframe&&(this.iframe.src="about:blank"),Tl.x.JITSI.matches(this.props.app.type)&&this.props.room&&fe.Ay.instance.hangupCallApp(this.props.room.roomId),Il.destroyElement(this.persistKey),Cl.A.instance.destroyPersistentWidget(this.props.app.id,(0,sc.Sw)(this.props.app)?this.props.app.roomId:null),null===(e=this.sgWidget)||void 0===e||e.stopMessaging({forceDestroy:!0})}formatAppTileName(){let e="No name";return this.props.app.name&&this.props.app.name.trim()&&(e=this.props.app.name.trim()),e}usingLocalWidget(){return Tl.x.JITSI.matches(this.props.app.type)}getTileTitle(){const e=this.formatAppTileName(),t=o.createElement("span",null," - ");let n="";return this.props.widgetPageTitle&&this.props.widgetPageTitle!==this.formatAppTileName()&&(n=this.props.widgetPageTitle),o.createElement("span",null,o.createElement(Cc,{app:this.props.app,size:"20px"}),o.createElement("h3",null,e),o.createElement("span",null,n?t:"",n))}reload(){this.endWidgetActions().then((()=>{this.resetWidget(this.props),this.startMessaging(),this.iframe&&this.sgWidget&&(this.iframe.src=this.sgWidget.embedUrl)}))}render(){let e;const t=ee()({mx_AppTileBody:!0,"mx_AppTileBody--large":!this.props.miniMode,"mx_AppTileBody--mini":this.props.miniMode,"mx_AppTileBody--loading":this.state.loading,"mx_AppTileBody--call":this.props.app.type===Tl.x.CALL.preferred}),n={};this.props.pointerEvents&&(n.pointerEvents=this.props.pointerEvents);const r=o.createElement("div",{className:"mx_AppTileBody_fadeInSpinner"},o.createElement(dn.A,{message:(0,C._t)("common|loading")})),s=vl.A.getWidgetName(this.props.app);if(null===this.sgWidget)e=o.createElement("div",{className:t,style:n},o.createElement(Sl,{errorMsg:(0,C._t)("widget|error_loading")}));else if(!this.state.hasPermissionToLoad&&this.props.room){const i=this.context.isRoomEncrypted(this.props.room.roomId);e=o.createElement("div",{className:t,style:n},o.createElement(Al,{roomId:this.props.room.roomId,creatorUserId:this.props.creatorUserId,url:this.sgWidget.embedUrl,isRoomEncrypted:i,onPermissionGranted:this.grantWidgetPermission}))}else if(this.state.initialising||!this.state.isUserProfileReady)e=o.createElement("div",{className:t,style:n},r);else if(this.isMixedContent())e=o.createElement("div",{className:t,style:n},o.createElement(Sl,{errorMsg:(0,C._t)("widget|error_mixed_content")}));else if(e=o.createElement(o.Fragment,null,o.createElement("div",{className:t,style:n},this.state.loading&&r,o.createElement("iframe",{title:s,allow:"microphone; camera; encrypted-media; autoplay; display-capture; clipboard-write; clipboard-read;",ref:this.iframeRefChange,src:this.sgWidget.embedUrl,allowFullScreen:!0,sandbox:"allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-presentation allow-downloads"})),this.props.overlay),!this.props.userWidget){const t=101;e=o.createElement("div",{className:"mx_AppTile_persistedWrapper"},o.createElement(Il,{zIndex:this.props.miniMode?t:9,persistKey:this.persistKey,moveRef:this.props.movePersistedElement},e))}let a,l;a=this.props.miniMode?{mx_AppTile_mini:!0}:this.props.fullWidth?{mx_AppTileFullWidth:!0}:{mx_AppTile:!0},a=ee()(a),this.state.menuDisplayed&&(l=o.createElement(Ac,(0,i.A)({},(0,Me.qv)(this.contextMenuButton.current.getBoundingClientRect()),{app:this.props.app,onFinished:this.closeContextMenu,showUnpin:!this.props.userWidget,userWidget:this.props.userWidget,onEditClick:this.props.onEditClick,onDeleteClick:this.props.onDeleteClick})));const c=[];if(this.props.showLayoutButtons){const e=this.props.room&&hc.aK.instance.isInContainer(this.props.room,this.props.app,hc.mc.Center);c.push(o.createElement(be.A,{key:"toggleMaximised",className:"mx_AppTileMenuBar_widgets_button",title:e?(0,C._t)("widget|unmaximise"):(0,C._t)("action|maximise"),onClick:this.onToggleMaximisedClick},e?o.createElement(Tc,{className:"mx_Icon mx_Icon_12"}):o.createElement(Mc,{className:"mx_Icon mx_Icon_12"}))),c.push(o.createElement(be.A,{key:"minimise",className:"mx_AppTileMenuBar_widgets_button",title:(0,C._t)("action|minimise"),onClick:this.onMinimiseClicked},o.createElement(Lc.I,{className:"mx_Icon mx_Icon_12"})))}return o.createElement(o.Fragment,null,o.createElement("div",{className:a,id:this.props.app.id},this.props.showMenubar&&o.createElement("div",{className:"mx_AppTileMenuBar"},o.createElement("span",{className:"mx_AppTileMenuBar_title",style:{pointerEvents:this.props.handleMinimisePointerEvents?"all":"none"}},this.props.showTitle&&this.getTileTitle()),o.createElement("span",{className:"mx_AppTileMenuBar_widgets"},c,this.props.showPopout&&!this.state.requiresClient&&o.createElement(be.A,{className:"mx_AppTileMenuBar_widgets_button",title:(0,C._t)("widget|popout"),onClick:this.onPopoutWidgetClick},o.createElement(jc,{className:"mx_Icon mx_Icon_12 mx_Icon--stroke"})),this.state.hasContextMenuOptions&&o.createElement(Me.VJ,{className:"mx_AppTileMenuBar_widgets_button",label:(0,C._t)("common|options"),isExpanded:this.state.menuDisplayed,ref:this.contextMenuButton,onClick:this.onContextMenuClick},o.createElement(Qt,{className:"mx_Icon mx_Icon_12"})))),e),l)}}(0,r.A)(Hc,"contextType",Re.Ay),(0,r.A)(Hc,"defaultProps",{waitForIframeLoad:!0,showMenubar:!0,showTitle:!0,showPopout:!0,handleMinimisePointerEvents:!1,userWidget:!1,miniMode:!1,threadId:null,showLayoutButtons:!0});const zc=({room:e,widgetId:t,onClose:n})=>{const i=(0,o.useContext)(Re.Ay),r=(0,vl.X)(e).find((e=>e.id===t)),s=r&&hc.aK.instance.isInContainer(e,r,hc.mc.Right),[a,l,c,d]=(0,Me.EF)();if((0,o.useEffect)((()=>{r&&s||qn.A.instance.popCard()}),[r,s]),!r||!s)return null;let u;if(a){var m;const e=null===(m=l.current)||void 0===m?void 0:m.getBoundingClientRect(),t=e?e.right:0,n=e?e.bottom:0;u=o.createElement(Ac,{chevronFace:Me.t4.None,right:Ce.A.instance.windowWidth-t-12,top:n+12,onFinished:d,app:r})}const h=o.createElement("div",{className:"mx_BaseCard_header_title"},o.createElement(Ii.A,{size:"4",className:"mx_BaseCard_header_title_heading"},vl.A.getWidgetName(r)),o.createElement(Me.VJ,{className:"mx_BaseCard_header_title_button--option",ref:l,onClick:c,isExpanded:a,label:(0,C._t)("common|options")}),u);return o.createElement(vs.A,{header:h,className:"mx_WidgetCard",onClose:n,withoutScrollContainer:!0},o.createElement(Hc,{app:r,fullWidth:!0,showMenubar:!1,room:e,userId:i.getSafeUserId(),creatorUserId:r.creatorUserId,widgetPageTitle:vl.A.getWidgetDataTitle(r),waitForIframeLoad:r.waitForIframeLoad}))};var Wc;function Gc(){return Gc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Gc.apply(null,arguments)}var Kc=function(e,t){return o.createElement("svg",Gc({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Wc||(Wc=o.createElement("path",{d:"M10 12q-1.65 0-2.825-1.175T6 8c0-1.65.392-2.042 1.175-2.825Q8.35 4 10 4c1.65 0 2.042.392 2.825 1.175Q14 6.35 14 8c0 1.65-.392 2.042-1.175 2.825Q11.65 12 10 12m-8 6v-.8q0-.85.438-1.563A2.9 2.9 0 0 1 3.6 14.55a14.8 14.8 0 0 1 3.15-1.163A13.8 13.8 0 0 1 10 13q1.65 0 3.25.387 1.6.388 3.15 1.163.724.375 1.163 1.087Q18 16.35 18 17.2v.8q0 .824-.587 1.413A1.93 1.93 0 0 1 16 20H4q-.824 0-1.413-.587A1.93 1.93 0 0 1 2 18m15-7h2v2q0 .424.288.713.287.287.712.287c.425 0 .52-.096.712-.287A.97.97 0 0 0 21 13v-2h2a.97.97 0 0 0 .712-.287A.97.97 0 0 0 24 10a.97.97 0 0 0-.288-.713A.97.97 0 0 0 23 9h-2V7a.97.97 0 0 0-.288-.713A.97.97 0 0 0 20 6a.97.97 0 0 0-.712.287A.97.97 0 0 0 19 7v2h-2a.97.97 0 0 0-.712.287A.97.97 0 0 0 16 10q0 .424.288.713A.97.97 0 0 0 17 11"})))},Jc=(0,o.forwardRef)(Kc);var qc=n("./node_modules/matrix-react-sdk/src/components/views/elements/TruncatedList.tsx"),$c=n("./node_modules/matrix-react-sdk/src/components/structures/SearchBox.tsx"),Yc=n("./node_modules/matrix-react-sdk/src/components/views/rooms/EntityTile.tsx"),Qc=n("./node_modules/matrix-react-sdk/src/components/views/messages/DisambiguatedProfile.tsx"),Zc=n("./node_modules/matrix-react-sdk/src/components/views/rooms/E2EIcon.tsx"),Xc=n("./node_modules/matrix-react-sdk/src/utils/crypto/deviceInfo.ts");class ed extends o.Component{constructor(e){super(e),(0,r.A)(this,"userLastModifiedTime",void 0),(0,r.A)(this,"memberLastModifiedTime",void 0),(0,r.A)(this,"onRoomStateEvents",(e=>{if(e.getType()!==s.EventType.RoomEncryption)return;const{roomId:t}=this.props.member;if(e.getRoomId()!==t)return;h.J.safeGet().removeListener(s.RoomStateEvent.Events,this.onRoomStateEvents),this.setState({isRoomEncrypted:!0}),this.updateE2EStatus()})),(0,r.A)(this,"onUserTrustStatusChanged",((e,t)=>{e===this.props.member.userId&&this.updateE2EStatus()})),(0,r.A)(this,"onDeviceVerificationChanged",((e,t,n)=>{e===this.props.member.userId&&this.updateE2EStatus()})),(0,r.A)(this,"onClick",(()=>{v.Ay.dispatch({action:x.r.ViewUser,member:this.props.member,push:!0})})),this.state={isRoomEncrypted:!1}}componentDidMount(){const e=h.J.safeGet(),{roomId:t}=this.props.member;if(t){const n=e.isRoomEncrypted(t);this.setState({isRoomEncrypted:n}),n?(e.on(d.cr.UserTrustStatusChanged,this.onUserTrustStatusChanged),e.on(d.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.updateE2EStatus()):e.on(s.RoomStateEvent.Events,this.onRoomStateEvents)}}componentWillUnmount(){const e=h.J.get();e&&(e.removeListener(s.RoomStateEvent.Events,this.onRoomStateEvents),e.removeListener(d.cr.UserTrustStatusChanged,this.onUserTrustStatusChanged),e.removeListener(d.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged))}async updateE2EStatus(){var e;const t=h.J.safeGet(),{userId:n}=this.props.member,i=n===t.getUserId(),r=await(null===(e=t.getCrypto())||void 0===e?void 0:e.getUserVerificationStatus(n));if(null==r||!r.isCrossSigningVerified())return void this.setState({e2eStatus:null!=r&&r.wasCrossSigningVerified()?Zc.a.Warning:Zc.a.Normal});const o=await(0,Xc.a)(t,n),s=await(0,Pl.rm)(o,(async e=>{var r;const o=await(null===(r=t.getCrypto())||void 0===r?void 0:r.getDeviceVerificationStatus(n,e));return!o||(i?!o.crossSigningVerified:!o.isVerified())}));this.setState({e2eStatus:s?Zc.a.Warning:Zc.a.Verified})}shouldComponentUpdate(e,t){return void 0===this.memberLastModifiedTime||this.memberLastModifiedTime<e.member.getLastModifiedTime()||(!(!e.member.user||!(void 0===this.userLastModifiedTime||this.userLastModifiedTime<e.member.user.getLastModifiedTime()))||(t.isRoomEncrypted!==this.state.isRoomEncrypted||t.e2eStatus!==this.state.e2eStatus))}getDisplayName(){return this.props.member.name}getPowerLabel(){return(0,C._t)("member_list|power_label",{userName:An.A.getDisplayUserIdentifier(this.props.member.userId,{roomId:this.props.member.roomId}),powerLevelNumber:this.props.member.powerLevel}).trim()}render(){var e;const t=this.props.member,n=this.getDisplayName(),r=null===(e=t.user)||void 0===e?void 0:e.presence,s=o.createElement(Ws.A,{member:t,size:"36px","aria-hidden":"true"});t.user&&(this.userLastModifiedTime=t.user.getLastModifiedTime()),this.memberLastModifiedTime=t.getLastModifiedTime();const a=new Map([[100,Yc.C.Admin],[50,Yc.C.Moderator]]);let l=this.props.member.powerLevel;for(const[e]of a)if(this.props.member.powerLevel>=e){l=e;break}const c=a.get(l);let d;this.state.isRoomEncrypted&&(d=this.state.e2eStatus);const u=o.createElement(Qc.A,{member:t,fallbackName:n||""});return o.createElement(Yc.A,(0,i.A)({},this.props,{presenceState:r,presenceLastActiveAgo:t.user?t.user.lastActiveAgo:0,presenceLastTs:t.user?t.user.lastPresenceTs:0,presenceCurrentlyActive:!!t.user&&t.user.currentlyActive,avatarJsx:s,title:this.getPowerLabel(),name:n,nameJSX:u,powerStatus:c,showPresence:this.props.showPresence,e2eStatus:d,onClick:this.onClick}))}}(0,r.A)(ed,"defaultProps",{showPresence:!0});class td extends o.Component{constructor(e,t){var i;super(e,t),(0,r.A)(this,"showPresence",void 0),(0,r.A)(this,"mounted",!1),(0,r.A)(this,"tiles",new Map),(0,r.A)(this,"onUserPresenceChange",((e,t)=>{this.tiles.get(t.userId)&&this.updateList()})),(0,r.A)(this,"onRoom",(e=>{e.roomId===this.props.roomId&&this.updateListNow(!0)})),(0,r.A)(this,"onMyMembership",((e,t,n)=>{e.roomId===this.props.roomId&&t===We.O.Join&&n!==We.O.Join&&this.updateListNow(!0)})),(0,r.A)(this,"onRoomStateUpdate",(e=>{e.roomId===this.props.roomId&&this.updateList()})),(0,r.A)(this,"onRoomMemberName",((e,t)=>{t.roomId===this.props.roomId&&this.updateList()})),(0,r.A)(this,"onRoomStateEvent",(e=>{e.getRoomId()===this.props.roomId&&e.getType()===s.EventType.RoomThirdPartyInvite&&this.updateList(),this.canInvite!==this.state.canInvite&&this.setState({canInvite:this.canInvite})})),(0,r.A)(this,"updateList",(0,c.throttle)((()=>{this.updateListNow(!1)}),500,{leading:!0,trailing:!0})),(0,r.A)(this,"createOverflowTileJoined",((e,t)=>this.createOverflowTile(e,t,this.showMoreJoinedMemberList))),(0,r.A)(this,"createOverflowTileInvited",((e,t)=>this.createOverflowTile(e,t,this.showMoreInvitedMemberList))),(0,r.A)(this,"createOverflowTile",((e,t,i)=>{const r=(0,C._t)("common|and_n_others",{count:e});return o.createElement(Yc.A,{className:"mx_EntityTile_ellipsis",avatarJsx:o.createElement(xn.A,{url:n("./node_modules/matrix-react-sdk/res/img/ellipsis.svg").A,name:"...",size:"36px"}),name:r,showPresence:!1,onClick:i})})),(0,r.A)(this,"showMoreJoinedMemberList",(()=>{this.setState({truncateAtJoined:this.state.truncateAtJoined+100})})),(0,r.A)(this,"showMoreInvitedMemberList",(()=>{this.setState({truncateAtInvited:this.state.truncateAtInvited+100})})),(0,r.A)(this,"onSearchQueryChanged",(e=>{this.props.onSearchQueryChanged(e)})),(0,r.A)(this,"onPending3pidInviteClick",(e=>{v.Ay.dispatch({action:x.r.View3pidInvite,event:e})})),(0,r.A)(this,"getChildrenJoined",((e,t)=>this.makeMemberTiles(this.state.filteredJoinedMembers.slice(e,t)))),(0,r.A)(this,"getChildCountJoined",(()=>this.state.filteredJoinedMembers.length)),(0,r.A)(this,"getChildrenInvited",((e,t)=>{let n=this.state.filteredInvitedMembers;return t>this.state.filteredInvitedMembers.length&&(n=n.concat(this.getPending3PidInvites())),this.makeMemberTiles(n.slice(e,t))})),(0,r.A)(this,"getChildCountInvited",(()=>this.state.filteredInvitedMembers.length+(this.getPending3PidInvites()||[]).length)),(0,r.A)(this,"onInviteButtonClick",(e=>{u.A.trackInteraction("WebRightPanelMemberListInviteButton",e);Ha(h.J.safeGet().getRoom(this.props.roomId))})),this.state=this.getMembersState([],[]),this.showPresence=null===(i=null==t?void 0:t.memberListStore.isPresenceEnabled())||void 0===i||i,this.mounted=!0,this.listenForMembersChanges()}listenForMembersChanges(){const e=h.J.safeGet();e.on(s.RoomStateEvent.Update,this.onRoomStateUpdate),e.on(s.RoomMemberEvent.Name,this.onRoomMemberName),e.on(s.RoomStateEvent.Events,this.onRoomStateEvent),e.on(s.UserEvent.LastPresenceTs,this.onUserPresenceChange),e.on(s.UserEvent.Presence,this.onUserPresenceChange),e.on(s.UserEvent.CurrentlyActive,this.onUserPresenceChange),e.on(s.ClientEvent.Room,this.onRoom),e.on(s.RoomEvent.MyMembership,this.onMyMembership)}componentDidMount(){this.updateListNow(!0)}componentWillUnmount(){this.mounted=!1;const e=h.J.get();e&&(e.removeListener(s.RoomStateEvent.Update,this.onRoomStateUpdate),e.removeListener(s.RoomMemberEvent.Name,this.onRoomMemberName),e.removeListener(s.RoomEvent.MyMembership,this.onMyMembership),e.removeListener(s.RoomStateEvent.Events,this.onRoomStateEvent),e.removeListener(s.ClientEvent.Room,this.onRoom),e.removeListener(s.UserEvent.LastPresenceTs,this.onUserPresenceChange),e.removeListener(s.UserEvent.Presence,this.onUserPresenceChange),e.removeListener(s.UserEvent.CurrentlyActive,this.onUserPresenceChange)),this.updateList.cancel()}get canInvite(){const e=h.J.safeGet().getRoom(this.props.roomId);return!!e&&Va(e)}getMembersState(e,t){return{loading:!1,filteredJoinedMembers:t,filteredInvitedMembers:e,canInvite:this.canInvite,truncateAtJoined:30,truncateAtInvited:5}}async updateListNow(e){if(!this.mounted)return;e&&this.setState({loading:!0});const{joined:t,invited:n}=await this.context.memberListStore.loadMemberList(this.props.roomId,this.props.searchQuery);this.mounted&&this.setState({loading:!1,filteredJoinedMembers:t,filteredInvitedMembers:n})}componentDidUpdate(e,t,n){e.searchQuery!==this.props.searchQuery&&this.updateListNow(!1)}getPending3PidInvites(){const e=h.J.safeGet().getRoom(this.props.roomId);return e?e.currentState.getStateEvents("m.room.third_party_invite").filter((function(t){if(!(0,y.Qo)(t))return!1;return!e.currentState.getInviteForThreePidToken(t.getStateKey())})):[]}makeMemberTiles(e){return e.map((e=>e instanceof s.RoomMember?o.createElement(ed,{key:e.userId,member:e,ref:t=>{t?this.tiles.set(e.userId,t):this.tiles.delete(e.userId)},showPresence:this.showPresence}):o.createElement(Yc.A,{key:e.getStateKey(),name:e.getContent().display_name,showPresence:!1,onClick:()=>this.onPending3pidInviteClick(e)})))}render(){if(this.state.loading)return o.createElement(vs.A,{id:"memberlist-panel",className:"mx_MemberList",ariaLabelledBy:"memberlist-panel-tab",role:"tabpanel",hideHeaderButtons:this.props.hideHeaderButtons,onClose:this.props.onClose},o.createElement(dn.A,null));const e=h.J.safeGet().getRoom(this.props.roomId);let t,n,i;if((null==e?void 0:e.getMyMembership())===We.O.Join&&(0,Ie.g)(W.C.InviteUsers)){const n=e.isSpaceRoom()?(0,C._t)("space|invite_this_space"):(0,C._t)("room|invite_this_room"),i=o.createElement(ke.$n,{size:"sm",kind:"secondary",className:"mx_MemberList_invite",onClick:this.onInviteButtonClick,disabled:!this.state.canInvite},o.createElement(Jc,{width:"1em",height:"1em"}),n);t=this.state.canInvite?i:o.createElement(ke.m_,{label:(0,C._t)("member_list|invite_button_no_perms_tooltip")},i)}this.getChildCountInvited()>0&&(n=o.createElement("h2",null,(0,C._t)("member_list|invited_list_heading")),i=o.createElement(qc.A,{className:"mx_MemberList_section mx_MemberList_invited",truncateAt:this.state.truncateAtInvited,createOverflowElement:this.createOverflowTileInvited,getChildren:this.getChildrenInvited,getChildCount:this.getChildCountInvited}));const r=o.createElement($c.A,{className:"mx_MemberList_query mx_textinput_icon mx_textinput_search",placeholder:(0,C._t)("member_list|filter_placeholder"),onSearch:this.onSearchQueryChanged,initialValue:this.props.searchQuery});return o.createElement(vs.A,{id:"memberlist-panel",className:"mx_MemberList",ariaLabelledBy:"memberlist-panel-tab",role:"tabpanel",hideHeaderButtons:this.props.hideHeaderButtons,footer:r,onClose:this.props.onClose},t,o.createElement("div",{className:"mx_MemberList_wrapper"},o.createElement(qc.A,{className:"mx_MemberList_section mx_MemberList_joined",truncateAt:this.state.truncateAtJoined,createOverflowElement:this.createOverflowTileJoined,getChildren:this.getChildrenJoined,getChildCount:this.getChildCountJoined}),n,i))}}(0,r.A)(td,"contextType",Xt.A);var nd=n("./node_modules/matrix-react-sdk/src/components/views/right_panel/UserInfo.tsx");class id extends o.Component{constructor(e){var t,n,i,o;super(e),(0,r.A)(this,"room",void 0),(0,r.A)(this,"onRoomStateEvents",(e=>{if(e.getType()===s.EventType.RoomThirdPartyInvite&&e.getStateKey()===this.state.stateKey){const t=e.getContent().display_name,n={invited:(0,y.Qo)(e)};t&&(n.displayName=t),this.setState(n)}})),(0,r.A)(this,"onCancel",(()=>{v.Ay.dispatch({action:x.r.View3pidInvite,event:null})})),(0,r.A)(this,"onKickClick",(()=>{h.J.safeGet().sendStateEvent(this.state.roomId,s.EventType.RoomThirdPartyInvite,{},this.state.stateKey).catch((e=>{l.v.error(e),this.setState({invited:!0}),f.Ay.createDialog(lc.A,{title:(0,C._t)("user_info|error_revoke_3pid_invite_title"),description:(0,C._t)("user_info|error_revoke_3pid_invite_description")})})),this.setState({invited:!1})})),this.room=h.J.safeGet().getRoom(this.props.event.getRoomId());const a=null===(t=this.room)||void 0===t?void 0:t.getMember(h.J.safeGet().getSafeUserId()),c=null===(n=this.room)||void 0===n?void 0:n.currentState.getStateEvents("m.room.power_levels",""),d=this.props.event.getSender();let u=c?c.getContent().kick:50;"number"!=typeof u&&(u=50);const m=null===(i=this.room)||void 0===i?void 0:i.getMember(d);this.state={stateKey:this.props.event.getStateKey(),roomId:this.props.event.getRoomId(),displayName:this.props.event.getContent().display_name,invited:!0,canKick:!!a&&a.powerLevel>u,senderName:null!==(o=null==m?void 0:m.name)&&void 0!==o?o:d}}componentDidMount(){h.J.safeGet().on(s.RoomStateEvent.Events,this.onRoomStateEvents)}componentWillUnmount(){const e=h.J.get();e&&e.removeListener(s.RoomStateEvent.Events,this.onRoomStateEvents)}render(){let e;return this.state.canKick&&this.state.invited&&(e=o.createElement(Fa.s,{direction:"column",as:"section",justify:"start",gap:"var(--cpd-space-2x)"},o.createElement(ke.EY,{as:"span",role:"heading",size:"lg",weight:"semibold"},(0,C._t)("user_info|admin_tools_section")),o.createElement(ke.$n,{size:"sm",kind:"destructive",className:"mx_MemberInfo_field",onClick:this.onKickClick},(0,C._t)("user_info|revoke_invite")))),o.createElement(vs.A,{onClose:this.props.onClose},o.createElement(Fa.s,{className:"mx_ThirdPartyMemberInfo",direction:"column",gap:"var(--cpd-space-4x)"},o.createElement(Fa.s,{direction:"column",as:"section",justify:"start",gap:"var(--cpd-space-2x)"},o.createElement(ke.EY,{as:"span",role:"heading",size:"lg",weight:"semibold"},this.state.displayName),o.createElement(ke.EY,{as:"span"},(0,C._t)("user_info|invited_by",{sender:this.state.senderName}))),e))}}var rd=n("./node_modules/matrix-react-sdk/src/indexing/EventIndexPeg.ts");let od=function(e){return e[e.Files=0]="Files",e[e.Search=1]="Search",e}({});function sd({isRoomEncrypted:e,kind:t,showLogo:n=!0}){if(!e)return o.createElement(o.Fragment,null);if(rd.A.get())return o.createElement(o.Fragment,null);if(rd.A.error)return o.createElement("div",{className:"mx_SearchWarning"},(0,C._t)("seshat|error_initialising",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:e=>{e.preventDefault(),v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Security})}},e)}));const i=g.Ay.get("brand"),r=g.Ay.getObject("desktop_builds");let s,a;if(null!=r&&r.get("available")){a=o.createElement("img",{alt:"",src:r.get("logo"),width:"32px"});const e=r.get("url");switch(t){case od.Files:s=(0,C._t)("seshat|warning_kind_files_app",{},{a:t=>o.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)});break;case od.Search:s=(0,C._t)("seshat|warning_kind_search_app",{},{a:t=>o.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)})}}else switch(t){case od.Files:s=(0,C._t)("seshat|warning_kind_files",{brand:i});break;case od.Search:s=(0,C._t)("seshat|warning_kind_search",{brand:i})}return s?o.createElement("div",{className:"mx_SearchWarning"},n?a:null,o.createElement("span",null,s)):(l.v.warn("Unknown desktop builds warning kind: ",t),o.createElement(o.Fragment,null))}var ad=n("./node_modules/matrix-react-sdk/src/UserActivity.ts"),ld=n("./node_modules/matrix-react-sdk/src/components/structures/LegacyCallEventGrouper.ts");const cd=(...e)=>{O.A.getValue("debug_timeline_panel")&&l.v.log.call(console,"TimelinePanel debuglog:",...e)},dd=(e,t)=>e.localTimestamp<t.localTimestamp,ud=(e,t)=>e.localTimestamp>=t.localTimestamp;class md extends o.Component{constructor(e,t){var n;if(super(e,t),(0,r.A)(this,"lastRRSentEventId",void 0),(0,r.A)(this,"lastRMSentEventId",void 0),(0,r.A)(this,"messagePanel",(0,o.createRef)()),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"timelineWindow",void 0),(0,r.A)(this,"overlayTimelineWindow",void 0),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"readReceiptActivityTimer",null),(0,r.A)(this,"readMarkerActivityTimer",null),(0,r.A)(this,"callEventGroupers",new Map),(0,r.A)(this,"initialReadMarkerId",null),(0,r.A)(this,"onDumpDebugLogs",(()=>{var e,t,n,i,r,o;const a=null===(e=this.props.timelineSet)||void 0===e?void 0:e.room,c=null===(t=this.state)||void 0===t||null===(t=t.events)||void 0===t?void 0:t.map((e=>e.getId()));let d,u,m;try{const e=this.messagePanel.current;if(e){const t=Ss.findDOMNode(e);if(t){d=[...t.querySelectorAll("[data-event-id]")].map((e=>e.getAttribute("data-event-id")))}}}catch(e){l.v.error("onDumpDebugLogs: Failed to get the actual event ID's in the DOM",e)}const h={};if(a){const e=a.getTimelineSets(),t=a.threadsTimelineSets;try{u=hd(e),m=hd(t)}catch(e){l.v.error("onDumpDebugLogs: Failed to serialize event IDs from timelinesets",e)}try{a.getThreads().forEach((e=>{var t,n;h[e.id]={events:e.events.map((e=>e.getId())),numTimelines:e.timelineSet.getTimelines().length,liveTimeline:e.timelineSet.getLiveTimeline().getEvents().length,prevTimeline:null===(t=e.timelineSet.getLiveTimeline().getNeighbouringTimeline(s.Direction.Backward))||void 0===t?void 0:t.getEvents().length,nextTimeline:null===(n=e.timelineSet.getLiveTimeline().getNeighbouringTimeline(s.Direction.Forward))||void 0===n?void 0:n.getEvents().length}}))}catch(e){l.v.error("onDumpDebugLogs: Failed to serialize event IDs from the threads",e)}}let p,g;try{var v;p=null===(v=this.timelineWindow)||void 0===v?void 0:v.getEvents().map((e=>e.getId()))}catch(e){l.v.error("onDumpDebugLogs: Failed to get event IDs from the timelineWindow",e)}try{g=this.props.timelineSet.getPendingEvents().map((e=>e.getId()))}catch(e){l.v.error("onDumpDebugLogs: Failed to get pending event IDs",e)}l.v.debug(`TimelinePanel(${this.context.timelineRenderingType}): Debugging info for ${null==a?void 0:a.roomId}\n\tevents(${c.length})=${JSON.stringify(c)}\n\trenderedEventIds(${null!==(n=null===(i=d)||void 0===i?void 0:i.length)&&void 0!==n?n:0})=${JSON.stringify(d)}\n\tserializedEventIdsFromTimelineSets=${JSON.stringify(u)}\n\tserializedEventIdsFromThreadsTimelineSets=${JSON.stringify(m)}\n\tserializedThreadsMap=${JSON.stringify(h)}\n\ttimelineWindowEventIds(${null===(r=p)||void 0===r?void 0:r.length})=${JSON.stringify(p)}\n\tpendingEventIds(${null===(o=g)||void 0===o?void 0:o.length})=${JSON.stringify(g)}`)})),(0,r.A)(this,"onMessageListUnfillRequest",((e,t)=>{var n,i;const r=e?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS;cd("unpaginating events in direction",r);const o=t,a=this.timelineWindow.getEvents(),l=null!==(n=null===(i=this.overlayTimelineWindow)||void 0===i?void 0:i.getEvents())&&void 0!==n?n:[];let d,u,m,h=a.findIndex((e=>e.getId()===o));-1===h?(d=l.findIndex((e=>e.getId()===o)),h=e?(0,c.findLastIndex)(a,(e=>ud(l[d],e))):a.findIndex((e=>dd(l[d],e)))):d=e?(0,c.findLastIndex)(l,(e=>dd(e,a[h]))):l.findIndex((e=>ud(e,a[h]))),u=-1===h?0:e?h+1:a.length-h,m=-1===d?0:e?d+1:l.length-d,u>0&&(cd("Unpaginating",u,"in direction",r),this.timelineWindow.unpaginate(u,e)),m>0&&(cd("Unpaginating",u,"from overlay timeline in direction",r),this.overlayTimelineWindow.unpaginate(m,e));const{events:p,liveEvents:g}=this.getEvents();this.buildLegacyCallEventGroupers(p),this.setState({events:p,liveEvents:g}),e?this.setState({canBackPaginate:!0}):this.setState({canForwardPaginate:!0})})),(0,r.A)(this,"onPaginationRequest",((e,t,n)=>this.props.onPaginationRequest?this.props.onPaginationRequest(e,t,n):e.paginate(t,n))),(0,r.A)(this,"onMessageListFillRequest",(e=>{var t;if(!this.shouldPaginate())return Promise.resolve(!1);const n=e?s.EventTimeline.BACKWARDS:s.EventTimeline.FORWARDS,i=e?"canBackPaginate":"canForwardPaginate",r=e?"backPaginating":"forwardPaginating";return this.state[i]?null!==(t=this.timelineWindow)&&void 0!==t&&t.canPaginate(n)?(cd("Initiating paginate; backwards:"+e),this.setState({[r]:!0}),this.onPaginationRequest(this.timelineWindow,n,50).then((async t=>{var n;if(this.unmounted)return!1;this.overlayTimelineWindow&&await this.extendOverlayWindowToCoverMainWindow(),cd("paginate complete backwards:"+e+"; success:"+t);const{events:o,liveEvents:a}=this.getEvents();this.buildLegacyCallEventGroupers(o);const l={[r]:!1,[i]:t,events:o,liveEvents:a},c=e?s.EventTimeline.FORWARDS:s.EventTimeline.BACKWARDS,d=e?"canForwardPaginate":"canBackPaginate";return!this.state[d]&&null!==(n=this.timelineWindow)&&void 0!==n&&n.canPaginate(c)&&(cd("can now",c,"paginate again"),l[d]=!0),new Promise((e=>{this.setState(l,(()=>{e(t)}))}))}))):(cd("can't",n,"paginate any further"),this.setState({[i]:!1}),Promise.resolve(!1)):(cd("have given up",n,"paginating this timeline"),Promise.resolve(!1))})),(0,r.A)(this,"onMessageListScroll",(e=>{var t,n;null===(t=(n=this.props).onScroll)||void 0===t||t.call(n,e),this.props.manageReadMarkers&&this.doManageReadMarkers()})),(0,r.A)(this,"doManageReadMarkers",(0,c.debounce)((()=>{var e;const t=this.getReadMarkerPosition();if(null===t)return;t<0&&this.setState({readMarkerVisible:!0});const n=this.readMarkerTimeout(t);null===(e=this.readMarkerActivityTimer)||void 0===e||e.changeTimeout(n)}),100,{leading:!1,trailing:!0})),(0,r.A)(this,"onAction",(e=>{switch(e.action){case"ignore_state_changed":this.forceUpdate();break;case x.r.DumpDebugLogs:this.onDumpDebugLogs()}})),(0,r.A)(this,"onRoomTimeline",((e,t,n,i,r)=>{var o,a;r.timeline.getTimelineSet()!==this.props.timelineSet&&r.timeline.getTimelineSet()!==this.props.overlayTimelineSet||(s.Thread.hasServerSideSupport||this.context.timelineRenderingType!==Zr.Ae.Thread||(n&&!this.state.canBackPaginate&&this.setState({canBackPaginate:!0}),n||this.state.canForwardPaginate||this.setState({canForwardPaginate:!0})),!n&&r&&r.liveEvent&&null!==(o=this.messagePanel.current)&&void 0!==o&&o.getScrollState()&&(null!==(a=this.messagePanel.current.getScrollState())&&void 0!==a&&a.stuckAtBottom?this.timelineWindow.paginate(s.EventTimeline.FORWARDS,1,!1).then((()=>{if(this.overlayTimelineWindow)return this.overlayTimelineWindow.paginate(s.EventTimeline.FORWARDS,1,!1)})).then((()=>{if(this.unmounted)return;const{events:t,liveEvents:n}=this.getEvents();this.buildLegacyCallEventGroupers(t);const i=n[n.length-1],r={events:t,liveEvents:n};let o=!1;if(this.props.manageReadMarkers){const t=h.J.safeGet().credentials.userId;if(o=!1,e.getSender()===t||ad.A.sharedInstance().userActiveRecently()){if(i&&0===this.getReadMarkerPosition()){var s;this.setReadMarker(null!==(s=i.getId())&&void 0!==s?s:null,i.getTs(),!0),r.readMarkerVisible=!1,r.readMarkerEventId=i.getId(),o=!0}}else r.readMarkerVisible=!0}this.setState(r,(()=>{var e,t,n;(null===(e=this.messagePanel.current)||void 0===e||e.updateTimelineMinHeight(),o)&&(null===(t=(n=this.props).onReadMarkerUpdated)||void 0===t||t.call(n))}))})):this.setState({canForwardPaginate:!0})))})),(0,r.A)(this,"onRoomTimelineReset",((e,t)=>{t!==this.props.timelineSet&&t!==this.props.overlayTimelineSet||this.canResetTimeline()&&this.loadTimeline()})),(0,r.A)(this,"canResetTimeline",(()=>{var e;return!0===(null===(e=this.messagePanel)||void 0===e||null===(e=e.current)||void 0===e?void 0:e.isAtBottom())})),(0,r.A)(this,"onRoomRedaction",((e,t)=>{this.unmounted||this.hasTimelineSetFor(t.roomId)&&this.forceUpdate()})),(0,r.A)(this,"onThreadUpdate",(e=>{var t;if(this.unmounted)return;if(!this.hasTimelineSetFor(e.roomId))return;const n=null===(t=this.messagePanel.current)||void 0===t?void 0:t.getTileForEventId(e.id);n&&n.forceUpdate()})),(0,r.A)(this,"onEventVisibilityChange",(e=>{var t;if(this.unmounted)return;if(!this.hasTimelineSetFor(e.getRoomId()))return;const n=null===(t=this.messagePanel.current)||void 0===t?void 0:t.getTileForEventId(e.getId());n&&n.forceUpdate()})),(0,r.A)(this,"onVisibilityPowerLevelChange",((e,t)=>{var n;if(!this.unmounted&&this.hasTimelineSetFor(t.roomId)&&t.userId==(null===(n=h.J.safeGet().credentials)||void 0===n?void 0:n.userId)){for(const e of this.state.events){var i;const t=null===(i=this.messagePanel.current)||void 0===i?void 0:i.getTileForEventId(e.getId());t&&t.forceUpdate()}this.forceUpdate()}})),(0,r.A)(this,"onEventReplaced",(e=>{this.unmounted||this.hasTimelineSetFor(e.getRoomId())&&this.forceUpdate()})),(0,r.A)(this,"onRoomReceipt",((e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()})),(0,r.A)(this,"onLocalEchoUpdated",((e,t,n)=>{this.unmounted||this.hasTimelineSetFor(t.roomId)&&this.reloadEvents()})),(0,r.A)(this,"onAccountData",((e,t)=>{this.unmounted||t===this.props.timelineSet.room&&e.getType()===s.EventType.FullyRead&&this.setState({readMarkerEventId:e.getContent().event_id},this.props.onReadMarkerUpdated)})),(0,r.A)(this,"onEventDecrypted",(e=>{this.props.timelineSet.room&&this.hasTimelineSetFor(e.getRoomId())&&this.state.events.includes(e)&&(this.buildLegacyCallEventGroupers(this.state.events),this.forceUpdate())})),(0,r.A)(this,"onSync",((e,t,n)=>{this.unmounted||this.setState({clientSyncState:e})})),(0,r.A)(this,"sendReadReceipts",(async()=>{var e,t;if(O.A.getValue("lowBandwidth"))return;if(!this.messagePanel.current)return;if(!this.props.manageReadReceipts)return;const n=h.J.get();if(!n||n.isGuest())return;const i=this.getCurrentReadReceipt(!0),r=this.indexForEventId(i),o=this.getLastDisplayedEventIndex({ignoreOwn:!0}),s=null!==(e=this.state.events[null!=o?o:this.state.events.length-1])&&void 0!==e?e:null,a=this.shouldSendReadReceipt(i,r,s,o),l=this.state.readMarkerEventId,c=this.shouldSendFullyReadMarker(l),d=null===(t=this.props.timelineSet.room)||void 0===t?void 0:t.roomId;cd(`Sending Read Markers for ${d}: `,{shouldSendReadReceipt:a,shouldSendFullyReadMarker:c,currentReadReceiptEventId:i,currentReadReceiptEventIndex:r,lastReadEventId:null==s?void 0:s.getId(),lastReadEventIndex:o,readMarkerEventId:this.state.readMarkerEventId});const u=[];if(a&&u.push(this.sendReadReceipt(n,s)),c){this.props.timelineSet.findEventById(l)&&u.push(this.sendFullyReadMarker(n,null!=d?d:"",l))}await Promise.all(u)})),(0,r.A)(this,"updateReadMarker",(async()=>{if(!this.props.manageReadMarkers)return;if(1===this.getReadMarkerPosition())return;const e=this.getLastDisplayedEventIndex({allowPartial:!0});if(null===e)return;const t=this.state.events[e];this.setReadMarker(t.getId(),t.getTs()),this.state.readMarkerVisible&&this.setState({readMarkerVisible:!1}),await this.sendReadReceipts()})),(0,r.A)(this,"jumpToLiveTimeline",(()=>{var e,t;null!==(e=this.timelineWindow)&&void 0!==e&&e.canPaginate(s.EventTimeline.FORWARDS)?this.loadTimeline():null===(t=this.messagePanel.current)||void 0===t||t.scrollToBottom()})),(0,r.A)(this,"scrollToEventIfNeeded",(e=>{var t;null===(t=this.messagePanel.current)||void 0===t||t.scrollToEventIfNeeded(e)})),(0,r.A)(this,"jumpToReadMarker",(()=>{if(!this.props.manageReadMarkers)return;if(!this.messagePanel.current)return;if(!this.state.readMarkerEventId)return;null===this.messagePanel.current.getReadMarkerPosition()?this.loadTimeline(this.state.readMarkerEventId,0,1/3):this.messagePanel.current.scrollToEvent(this.state.readMarkerEventId,0,1/3)})),(0,r.A)(this,"forgetReadMarker",(async()=>{if(!this.props.manageReadMarkers)return;const e=this.getCurrentReadReceipt(),t=this.props.timelineSet.getTimelineForEvent(null!=e?e:"");let n;if(t){const i=t.getEvents().find((t=>t.getId()==e));i&&(n=i.getTs())}this.setReadMarker(e,n),await this.sendReadReceipts()})),(0,r.A)(this,"isAtEndOfLiveTimeline",(()=>{var e;return(null===(e=this.messagePanel.current)||void 0===e?void 0:e.isAtBottom())&&this.timelineWindow&&!this.timelineWindow.canPaginate(s.EventTimeline.FORWARDS)})),(0,r.A)(this,"getScrollState",(()=>this.messagePanel.current?this.messagePanel.current.getScrollState():null)),(0,r.A)(this,"getReadMarkerPosition",(()=>{if(!this.props.manageReadMarkers)return null;if(!this.messagePanel.current)return null;if(!this.props.timelineSet.room)return null;const e=this.messagePanel.current.getReadMarkerPosition();if(null!==e)return e;const t=md.roomReadMarkerTsMap[this.props.timelineSet.room.roomId];return t&&this.state.events.length>0?t<this.state.events[0].getTs()?-1:1:null})),(0,r.A)(this,"canJumpToReadMarker",(()=>{const e=this.getReadMarkerPosition();return null!==this.state.readMarkerEventId&&(null===e||e<0)})),(0,r.A)(this,"handleScrollKey",(e=>{if(!this.messagePanel.current)return;(0,Se.zM)().getRoomAction(e)===Ee.bY.JumpToLatestMessage?this.jumpToLiveTimeline():this.messagePanel.current.handleScrollKey(e)})),(0,r.A)(this,"getRelationsForEvent",((e,t,n)=>{var i;return null===(i=this.props.timelineSet.relations)||void 0===i?void 0:i.getChildEventsForEvent(e,t,n)})),cd("mounting"),this.props.manageReadMarkers){var i;const e=null===(i=this.props.timelineSet.room)||void 0===i?void 0:i.getAccountData("m.fully_read");this.initialReadMarkerId=e?e.getContent().event_id:this.getCurrentReadReceipt()}this.state={events:[],liveEvents:[],timelineLoading:!0,canBackPaginate:!1,canForwardPaginate:!1,readMarkerVisible:!0,readMarkerEventId:this.initialReadMarkerId,backPaginating:!1,forwardPaginating:!1,clientSyncState:h.J.safeGet().getSyncState(),isTwelveHour:O.A.getValue("showTwelveHourTimestamps"),alwaysShowTimestamps:O.A.getValue("alwaysShowTimestamps"),readMarkerInViewThresholdMs:O.A.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:O.A.getValue("readMarkerOutOfViewThresholdMs")},this.dispatcherRef=v.Ay.register(this.onAction);const a=h.J.safeGet();a.on(s.RoomEvent.Timeline,this.onRoomTimeline),a.on(s.RoomEvent.TimelineReset,this.onRoomTimelineReset),a.on(s.RoomEvent.Redaction,this.onRoomRedaction),O.A.getValue("feature_msc3531_hide_messages_pending_moderation")&&(a.on(s.MatrixEventEvent.VisibilityChange,this.onEventVisibilityChange),a.on(s.RoomMemberEvent.PowerLevel,this.onVisibilityPowerLevelChange)),a.on(s.RoomEvent.RedactionCancelled,this.onRoomRedaction),a.on(s.RoomEvent.Receipt,this.onRoomReceipt),a.on(s.RoomEvent.LocalEchoUpdated,this.onLocalEchoUpdated),a.on(s.RoomEvent.AccountData,this.onAccountData),a.on(s.MatrixEventEvent.Decrypted,this.onEventDecrypted),a.on(s.MatrixEventEvent.Replaced,this.onEventReplaced),a.on(s.ClientEvent.Sync,this.onSync),null===(n=this.props.timelineSet.room)||void 0===n||n.on(s.ThreadEvent.Update,this.onThreadUpdate)}componentDidMount(){this.props.manageReadReceipts&&this.updateReadReceiptOnUserActivity(),this.props.manageReadMarkers&&this.updateReadMarkerOnUserActivity(),this.initTimeline(this.props)}componentDidUpdate(e){var t,n;e.timelineSet!==this.props.timelineSet&&l.v.warn("Replacing timelineSet on a TimelinePanel - confusion may ensue"),null===(t=this.props.timelineSet.room)||void 0===t||t.off(s.ThreadEvent.Update,this.onThreadUpdate),null===(n=this.props.timelineSet.room)||void 0===n||n.on(s.ThreadEvent.Update,this.onThreadUpdate);const i=e.eventId!=this.props.eventId,r=e.highlightedEventId!=this.props.highlightedEventId,o=e.eventScrollIntoView&&!this.props.eventScrollIntoView,a=e.overlayTimelineSet!==this.props.overlayTimelineSet;i||r||o?(l.v.log(`TimelinePanel switching to eventId ${this.props.eventId} (was ${e.eventId}), scrollIntoView: ${this.props.eventScrollIntoView} (was ${e.eventScrollIntoView})`),this.initTimeline(this.props)):a&&(l.v.log("TimelinePanel updating overlay timeline."),this.initTimeline(this.props))}componentWillUnmount(){this.unmounted=!0,this.readReceiptActivityTimer&&(this.readReceiptActivityTimer.abort(),this.readReceiptActivityTimer=null),this.readMarkerActivityTimer&&(this.readMarkerActivityTimer.abort(),this.readMarkerActivityTimer=null),v.Ay.unregister(this.dispatcherRef);const e=h.J.get();var t;e&&(e.removeListener(s.RoomEvent.Timeline,this.onRoomTimeline),e.removeListener(s.RoomEvent.TimelineReset,this.onRoomTimelineReset),e.removeListener(s.RoomEvent.Redaction,this.onRoomRedaction),e.removeListener(s.RoomEvent.RedactionCancelled,this.onRoomRedaction),e.removeListener(s.RoomEvent.Receipt,this.onRoomReceipt),e.removeListener(s.RoomEvent.LocalEchoUpdated,this.onLocalEchoUpdated),e.removeListener(s.RoomEvent.AccountData,this.onAccountData),e.removeListener(s.RoomMemberEvent.PowerLevel,this.onVisibilityPowerLevelChange),e.removeListener(s.MatrixEventEvent.Decrypted,this.onEventDecrypted),e.removeListener(s.MatrixEventEvent.Replaced,this.onEventReplaced),e.removeListener(s.MatrixEventEvent.VisibilityChange,this.onEventVisibilityChange),e.removeListener(s.ClientEvent.Sync,this.onSync),null===(t=this.props.timelineSet.room)||void 0===t||t.removeListener(s.ThreadEvent.Update,this.onThreadUpdate))}hasTimelineSetFor(e){var t,n;return void 0!==e&&e===(null===(t=this.props.timelineSet.room)||void 0===t?void 0:t.roomId)||e===(null===(n=this.props.overlayTimelineSet)||void 0===n||null===(n=n.room)||void 0===n?void 0:n.roomId)}readMarkerTimeout(e){var t,n,i,r;return 0===e?null!==(t=null===(n=this.context)||void 0===n?void 0:n.readMarkerInViewThresholdMs)&&void 0!==t?t:this.state.readMarkerInViewThresholdMs:null!==(i=null===(r=this.context)||void 0===r?void 0:r.readMarkerOutOfViewThresholdMs)&&void 0!==i?i:this.state.readMarkerOutOfViewThresholdMs}async updateReadMarkerOnUserActivity(){const e=this.readMarkerTimeout(this.getReadMarkerPosition());for(this.readMarkerActivityTimer=new zs.A(e);this.readMarkerActivityTimer;){ad.A.sharedInstance().timeWhileActiveRecently(this.readMarkerActivityTimer);try{await this.readMarkerActivityTimer.finished()}catch(e){continue}await this.updateReadMarker()}}async updateReadReceiptOnUserActivity(){for(this.readReceiptActivityTimer=new zs.A(500);this.readReceiptActivityTimer;){ad.A.sharedInstance().timeWhileActiveNow(this.readReceiptActivityTimer);try{await this.readReceiptActivityTimer.finished()}catch(e){continue}await this.sendReadReceipts()}}async determineReceiptType(e){var t,n;const i=null!==(t=null===(n=this.props.timelineSet.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null;return O.A.getValue("sendReadReceipts",i)?s.ReceiptType.Read:await e.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")||await e.isVersionSupported("v1.4")?s.ReceiptType.ReadPrivate:(l.v.warn("Falling back to public instead of private receipts because the homeserver does not support them"),s.ReceiptType.Read)}shouldSendFullyReadMarker(e){return!!this.state.readMarkerEventId&&((!this.lastRMSentEventId||this.lastRMSentEventId!==this.state.readMarkerEventId)&&((!this.state.readMarkerEventId||this.state.readMarkerEventId!==this.initialReadMarkerId)&&!this.props.timelineSet.thread))}shouldSendReadReceipt(e,t,n,i){var r;return!!n&&((!e||null!==t||null===(r=this.timelineWindow)||void 0===r||!r.canPaginate(s.EventTimeline.FORWARDS))&&((null===i||null===t||i>t)&&(!this.lastRRSentEventId||this.lastRRSentEventId!==(null==n?void 0:n.getId()))))}async sendReadReceipt(e,t){this.lastRRSentEventId=t.getId();const n=await this.determineReceiptType(e);try{await e.sendReadReceipt(t,n)}catch(e){var i;this.lastRRSentEventId=void 0,l.v.error("Error sending receipt",{room:null===(i=this.props.timelineSet.room)||void 0===i?void 0:i.roomId,error:e})}}async sendFullyReadMarker(e,t,n){this.lastRMSentEventId=this.state.readMarkerEventId;try{await e.setRoomReadMarkers(t,n)}catch(e){this.lastRMSentEventId=void 0,l.v.error("Error sending fully_read",{roomId:t,error:e})}}advanceReadMarkerPastMyEvents(){if(!this.props.manageReadMarkers||!this.timelineWindow)return;const e=this.timelineWindow.getEvents();let t;for(t=0;t<e.length&&e[t].getId()!=this.state.readMarkerEventId;t++);if(t>=e.length)return;const n=h.J.safeGet().credentials.userId;for(t++;t<e.length;t++){if(e[t].getSender()!==n)break}t--;const i=e[t];this.setReadMarker(i.getId(),i.getTs())}initTimeline(e){const t=e.eventId,n=e.eventPixelOffset;let i=1;return null==n&&(i=.5),this.loadTimeline(t,n,i,e.eventScrollIntoView)}scrollIntoView(e,t,n){var i,r;const o=()=>{this.messagePanel.current&&(e?(cd("TimelinePanel scrolling to eventId "+e+" at position "+100*n+"% + "+t),this.messagePanel.current.scrollToEvent(e,t,n)):(cd("TimelinePanel scrolling to bottom"),this.messagePanel.current.scrollToBottom()))};cd("TimelinePanel scheduling scroll to event"),null===(i=(r=this.props).onEventScrolledIntoView)||void 0===i||i.call(r,e),o(),window.requestAnimationFrame((()=>{o()}))}async extendOverlayWindowToCoverMainWindow(){const e=this.timelineWindow,t=this.overlayTimelineWindow,n=e.getEvents();if(n.length>0){let i;do{i=[];const r=t.getEvents();!t.canPaginate(s.EventTimeline.BACKWARDS)||0!==r.length&&!ud(r[0],n[0])&&e.canPaginate(s.EventTimeline.BACKWARDS)||i.push(this.onPaginationRequest(t,s.EventTimeline.BACKWARDS,50)),!t.canPaginate(s.EventTimeline.FORWARDS)||0!==r.length&&!dd(r.at(-1),n.at(-1))&&e.canPaginate(s.EventTimeline.FORWARDS)||i.push(this.onPaginationRequest(t,s.EventTimeline.FORWARDS,50)),await Promise.all(i)}while(i.length>0)}}loadTimeline(e,t,n,i=!0){const r=h.J.safeGet();this.timelineWindow=new s.TimelineWindow(r,this.props.timelineSet,{windowLimit:this.props.timelineCap}),this.overlayTimelineWindow=this.props.overlayTimelineSet?new s.TimelineWindow(r,this.props.overlayTimelineSet,{windowLimit:this.props.timelineCap}):void 0;const o=()=>{var r,o,a,c,d,u,m;this.unmounted||(null===(r=this.messagePanel.current)||void 0===r||r.onTimelineReset(),this.reloadEvents(),this.advanceReadMarkerPastMyEvents(),this.setState({canBackPaginate:null!==(o=(null===(a=this.timelineWindow)||void 0===a?void 0:a.canPaginate(s.EventTimeline.BACKWARDS))||(null===(c=this.overlayTimelineWindow)||void 0===c?void 0:c.canPaginate(s.EventTimeline.BACKWARDS)))&&void 0!==o&&o,canForwardPaginate:null!==(d=(null===(u=this.timelineWindow)||void 0===u?void 0:u.canPaginate(s.EventTimeline.FORWARDS))||(null===(m=this.overlayTimelineWindow)||void 0===m?void 0:m.canPaginate(s.EventTimeline.FORWARDS)))&&void 0!==d&&d,timelineLoading:!1},(()=>{this.messagePanel.current?(i&&this.scrollIntoView(e,t,n),this.props.sendReadReceiptOnLoad&&this.sendReadReceipts().catch((e=>{l.v.warn("Error sending receipts on load",e)}))):l.v.log("can't initialise scroll state because messagePanel didn't load")})))};if(this.props.timelineSet.getTimelineForEvent(e)&&!this.overlayTimelineWindow)return this.timelineWindow.load(e,30),void o();const a=this.timelineWindow.load(e,30).then((async()=>{this.overlayTimelineWindow&&(await this.overlayTimelineWindow.load(void 0,30),await this.extendOverlayWindowToCoverMainWindow())}));this.buildLegacyCallEventGroupers(),this.setState({events:[],liveEvents:[],canBackPaginate:!1,canForwardPaginate:!1,timelineLoading:!0}),a.then(o,(t=>{var n;if(this.unmounted)return;let i,r;this.setState({timelineLoading:!1}),l.v.error(`Error loading timeline panel at ${null===(n=this.props.timelineSet.room)||void 0===n?void 0:n.roomId}/${e}`,t),e&&this.props.timelineSet.room&&(i=()=>{v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.props.timelineSet.room.roomId,metricsTrigger:void 0})}),r="M_FORBIDDEN"==t.errcode?(0,C._t)("timeline|load_error|no_permission"):(0,C._t)("timeline|load_error|unable_to_find"),f.Ay.createDialog(lc.A,{title:(0,C._t)("timeline|load_error|title"),description:r,onFinished:i})}))}reloadEvents(){if(this.unmounted)return;const e=this.getEvents();this.buildLegacyCallEventGroupers(e.events),this.setState(e)}refreshTimeline(e){this.loadTimeline(e,void 0,void 0,!1),this.reloadEvents()}getEvents(){var e,t;const n=this.timelineWindow.getEvents();let i=null!==(e=null===(t=this.overlayTimelineWindow)||void 0===t?void 0:t.getEvents())&&void 0!==e?e:[];void 0!==this.props.overlayTimelineSetFilter&&(i=i.filter(this.props.overlayTimelineSetFilter));const r=i.reduce(((e,t)=>{const n=e.findIndex((e=>dd(t,e)));return-1===n?this.timelineWindow.canPaginate(s.EventTimeline.FORWARDS)||e.push(t):0===n?this.timelineWindow.canPaginate(s.EventTimeline.BACKWARDS)||e.unshift(t):e.splice(n,0,t),e}),[...n]),o=h.J.safeGet();for(let e=r.length-1;e>=0;--e)o.decryptEventIfNeeded(r[e]);const a=[...r];if(!this.timelineWindow.canPaginate(s.EventTimeline.FORWARDS)){const e=this.props.timelineSet.getPendingEvents();r.push(...e.filter((t=>{const{shouldLiveInRoom:n,threadId:i}=this.props.timelineSet.room.eventShouldLiveIn(t,e);return this.context.timelineRenderingType===Zr.Ae.Thread?i===this.context.threadId:n})))}return{events:r,liveEvents:a}}indexForEventId(e){if(null===e)return null;if(this.context.timelineRenderingType===Zr.Ae.Thread)return 0;const t=this.state.events.findIndex((t=>t.getId()===e));return t>-1?t:null}getVisibleDecryptionFailures(e){const t=this.messagePanel.current;if(!t)return null;const n=Ss.findDOMNode(t);if(!n)return null;const i=n.getBoundingClientRect(),r=e?100:0,o=i.top-r,s=i.bottom+r,a=[];for(const e of this.state.liveEvents){const n=e.getId();if(!n)continue;const i=t.getNodeForEventId(n);if(!i)continue;const r=i.getBoundingClientRect();if(r.top>s)break;r.bottom>=o&&e.isDecryptionFailure()&&a.push(e)}return a}getLastDisplayedEventIndex(e={}){const t=e.ignoreOwn||!1,n=e.allowPartial||!1,i=this.messagePanel.current;if(!i)return null;const r=Ss.findDOMNode(i);if(!r)return null;const o=r.getBoundingClientRect(),s=h.J.safeGet().credentials.userId,a=e=>{if(e){const t=e.getBoundingClientRect();if(n&&t.top<=o.bottom||!n&&t.bottom<=o.bottom)return!0}return!1};let l=0;for(let e=this.state.liveEvents.length-1;e>=0;--e){var c;const n=this.state.liveEvents[e],r=i.getNodeForEventId(n.getId()),o=a(r);if(o&&0!==l)return e+l;r&&!o&&(l=0);const d=!!n.status||t&&n.getSender()===s;if(!(!(0,Qs.bN)(n,h.J.safeGet(),null===(c=this.context)||void 0===c?void 0:c.showHiddenEvents)||(0,Io.A)(n,this.context))&&r){if(!d&&o)return e}else(!d||d&&0!==l)&&++l}return null}getCurrentReadReceipt(e=!1){var t,n;const i=h.J.get();if(null==i)return null;const r=i.getSafeUserId(),o=null!==(t=this.props.timelineSet.thread)&&void 0!==t?t:this.props.timelineSet.room;return null!==(n=null==o?void 0:o.getEventReadUpTo(r,e))&&void 0!==n?n:null}setReadMarker(e,t,n=!1){var i;const r=null===(i=this.props.timelineSet.room)||void 0===i?void 0:i.roomId;e!==this.state.readMarkerEventId&&null!==e&&(void 0!==t?md.roomReadMarkerTsMap[null!=r?r:""]=t:delete md.roomReadMarkerTsMap[null!=r?r:""],n||this.setState({readMarkerEventId:e},this.props.onReadMarkerUpdated))}shouldPaginate(){return!this.state.events.some((e=>e.isBeingDecrypted()))}buildLegacyCallEventGroupers(e){this.callEventGroupers=(0,ld.fN)(this.callEventGroupers,e)}render(){var e,t,n,i,r,a;if(this.state.timelineLoading)return o.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},o.createElement(dn.A,null));if(0==this.state.events.length&&!this.state.canBackPaginate&&this.props.empty)return o.createElement("div",{className:this.props.className+" mx_RoomView_messageListWrapper"},o.createElement("div",{className:"mx_RoomView_empty"},this.props.empty));const l=!(null!==(e=this.timelineWindow)&&void 0!==e&&e.canPaginate(s.EventTimeline.FORWARDS)),c=this.state.forwardPaginating||["PREPARED","CATCHUP"].includes(this.state.clientSyncState),d=this.state.events;return o.createElement(ba,{ref:this.messagePanel,room:this.props.timelineSet.room,permalinkCreator:this.props.permalinkCreator,hidden:this.props.hidden,backPaginating:this.state.backPaginating,forwardPaginating:c,events:d,highlightedEventId:this.props.highlightedEventId,readMarkerEventId:this.state.readMarkerEventId,readMarkerVisible:this.state.readMarkerVisible,canBackPaginate:this.state.canBackPaginate,showUrlPreview:this.props.showUrlPreview,showReadReceipts:this.props.showReadReceipts,ourUserId:h.J.safeGet().getSafeUserId(),stickyBottom:l,onScroll:this.onMessageListScroll,onFillRequest:this.onMessageListFillRequest,onUnfillRequest:this.onMessageListUnfillRequest,isTwelveHour:null!==(t=null===(n=this.context)||void 0===n?void 0:n.showTwelveHourTimestamps)&&void 0!==t?t:this.state.isTwelveHour,alwaysShowTimestamps:null!==(i=null!==(r=this.props.alwaysShowTimestamps)&&void 0!==r?r:null===(a=this.context)||void 0===a?void 0:a.alwaysShowTimestamps)&&void 0!==i?i:this.state.alwaysShowTimestamps,className:this.props.className,resizeNotifier:this.props.resizeNotifier,getRelationsForEvent:this.getRelationsForEvent,editState:this.props.editState,showReactions:this.props.showReactions,layout:this.props.layout,hideThreadedMessages:this.props.hideThreadedMessages,disableGrouping:this.props.disableGrouping,callEventGroupers:this.callEventGroupers})}}function hd(e){return e.map((e=>{const t={},n=e.getTimelines(),i=e.getLiveTimeline();return n.forEach(((e,n)=>{t[e===i?"liveTimeline":`${n}`]=e.getEvents().map((e=>e.getId()))})),t}))}(0,r.A)(md,"contextType",Zr.Ay),(0,r.A)(md,"roomReadMarkerTsMap",{}),(0,r.A)(md,"defaultProps",{timelineCap:Number.MAX_VALUE,className:"mx_RoomView_messagePanel",sendReadReceiptOnLoad:!0,hideThreadedMessages:!0,disableGrouping:!1});const pd=md;class gd extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"instanceId",void 0),(0,r.A)(this,"onResize",((e,t)=>{e===Ce.x.Resize&&this.props.onMeasurement(t.contentRect.width<=this.props.breakpoint)})),this.instanceId=gd.instanceCount++}componentDidMount(){Ce.A.instance.on(`Measured${this.instanceId}`,this.onResize)}componentDidUpdate(e){const t=e.sensor,n=this.props.sensor;t!==n&&(t&&Ce.A.instance.stopTrackingElementDimensions(`Measured${this.instanceId}`),n&&Ce.A.instance.trackElementDimensions(`Measured${this.instanceId}`,this.props.sensor))}componentWillUnmount(){Ce.A.instance.off(`Measured${this.instanceId}`,this.onResize),Ce.A.instance.stopTrackingElementDimensions(`Measured${this.instanceId}`)}render(){return null}}(0,r.A)(gd,"instanceCount",0),(0,r.A)(gd,"defaultProps",{breakpoint:500});const vd=({Icon:e,title:t,description:n})=>o.createElement(Fa.s,{className:"mx_EmptyState",direction:"column",gap:"var(--cpd-space-4x)",align:"center",justify:"center"},o.createElement(e,{width:"32px",height:"32px"}),o.createElement(ke.EY,{size:"lg",weight:"semibold"},t),o.createElement(ke.EY,{size:"md",weight:"regular"},n));function _d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function fd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_d(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class yd extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"decryptingEvents",new Set),(0,r.A)(this,"noRoom",!1),(0,r.A)(this,"card",(0,o.createRef)()),(0,r.A)(this,"state",{timelineSet:null,narrow:!1}),(0,r.A)(this,"onRoomTimeline",((e,t,n,i,r)=>{if((null==t?void 0:t.roomId)!==this.props.roomId)return;if(n||!r||!r.liveEvent||e.isRedacted())return;h.J.safeGet().decryptEventIfNeeded(e),e.isBeingDecrypted()?this.decryptingEvents.add(e.getId()):this.addEncryptedLiveEvent(e)})),(0,r.A)(this,"onEventDecrypted",((e,t)=>{if(e.getRoomId()!==this.props.roomId)return;const n=e.getId();this.decryptingEvents.delete(n)&&(t||this.addEncryptedLiveEvent(e))})),(0,r.A)(this,"onPaginationRequest",((e,t,n)=>{const i=h.J.safeGet(),r=rd.A.get(),o=this.props.roomId,s=i.getRoom(o);return s&&i.isRoomEncrypted(o)&&null!==r?r.paginateTimelineWindow(s,e,t,n):e.paginate(t,n)})),(0,r.A)(this,"onMeasurement",(e=>{this.setState({narrow:e})}))}addEncryptedLiveEvent(e){if(!this.state.timelineSet)return;const t=this.state.timelineSet.getLiveTimeline();"m.room.message"===e.getType()&&["m.file","m.image","m.video","m.audio"].includes(e.getContent().msgtype)&&(this.state.timelineSet.eventIdToTimeline(e.getId())||this.state.timelineSet.addEventToTimeline(e,t,!1))}async componentDidMount(){const e=h.J.safeGet();await this.updateTimelineSet(this.props.roomId),e.isRoomEncrypted(this.props.roomId)&&null!==rd.A.get()&&(e.on(s.RoomEvent.Timeline,this.onRoomTimeline),e.on(s.MatrixEventEvent.Decrypted,this.onEventDecrypted))}componentWillUnmount(){const e=h.J.get();null!==e&&e.isRoomEncrypted(this.props.roomId)&&null!==rd.A.get()&&(e.removeListener(s.RoomEvent.Timeline,this.onRoomTimeline),e.removeListener(s.MatrixEventEvent.Decrypted,this.onEventDecrypted))}async fetchFileEventsServer(e){const t=h.J.safeGet(),n=new s.Filter(t.getSafeUserId());return n.setDefinition({room:{timeline:{contains_url:!0,types:["m.room.message"]}}}),n.filterId=await t.getOrCreateFilter("FILTER_FILES_"+t.credentials.userId,n),e.getOrCreateFilteredTimelineSet(n)}async updateTimelineSet(e){const t=h.J.safeGet(),n=t.getRoom(e),i=rd.A.get();if(this.noRoom=!n,n){let r;try{if(r=await this.fetchFileEventsServer(n),t.isRoomEncrypted(e)&&null!==i){const e=r.getLiveTimeline();await i.populateFileTimeline(r,e,n,10)}this.setState({timelineSet:r})}catch(e){l.v.error("Failed to get or create file panel filter",e)}}else l.v.error("Failed to add filtered timelineSet for FilePanel as no room!")}render(){if(h.J.safeGet().isGuest())return o.createElement(vs.A,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose},o.createElement("div",{className:"mx_RoomView_empty"},(0,C._t)("file_panel|guest_note",{},{a:e=>o.createElement("a",{href:"#/register",key:"sub"},e)})));if(this.noRoom)return o.createElement(vs.A,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose},o.createElement("div",{className:"mx_RoomView_empty"},(0,C._t)("file_panel|peek_note")));const e=o.createElement(vd,{Icon:$o,title:(0,C._t)("file_panel|empty_heading"),description:(0,C._t)("file_panel|empty_description")}),t=!this.noRoom&&h.J.safeGet().isRoomEncrypted(this.props.roomId);return this.state.timelineSet?o.createElement(Zr.Ay.Provider,{value:fd(fd({},this.context),{},{timelineRenderingType:Zr.Ae.File,narrow:this.state.narrow})},o.createElement(vs.A,{className:"mx_FilePanel",onClose:this.props.onClose,withoutScrollContainer:!0,ref:this.card},this.card.current&&o.createElement(gd,{sensor:this.card.current,onMeasurement:this.onMeasurement}),o.createElement(sd,{isRoomEncrypted:t,kind:od.Files}),o.createElement(pd,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:this.state.timelineSet,showUrlPreview:!1,onPaginationRequest:this.onPaginationRequest,resizeNotifier:this.props.resizeNotifier,empty:e,layout:Us.P.Group}))):o.createElement(Zr.Ay.Provider,{value:fd(fd({},this.context),{},{timelineRenderingType:Zr.Ae.File})},o.createElement(vs.A,{className:"mx_FilePanel",onClose:this.props.onClose},o.createElement(dn.A,null)))}}(0,r.A)(yd,"contextType",Zr.Ay);const Ed=yd;class bd extends o.Component{constructor(e){super(e),(0,r.A)(this,"resize",(()=>{this.props.onResize&&this.props.onResize()}))}componentDidMount(){window.addEventListener("resize",this.resize)}componentWillUnmount(){window.removeEventListener("resize",this.resize)}render(){return o.createElement("div",null,this.props.element)}}const wd="stickerPicker";class xd extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"prevSentVisibility",void 0),(0,r.A)(this,"popoverWidth",300),(0,r.A)(this,"popoverHeight",300),(0,r.A)(this,"scalarClient",null),(0,r.A)(this,"removeStickerpickerWidgets",(async()=>{const e=await this.acquireScalarClient();l.v.log("Removing Stickerpicker widgets"),this.state.widgetId?e?e.disableWidgetAssets(Tl.x.STICKERPICKER,this.state.widgetId).then((()=>{l.v.log("Assets disabled")})).catch((()=>{l.v.error("Failed to disable assets")})):l.v.error("Cannot disable assets: no scalar client"):l.v.warn("No widget ID specified, not disabling assets"),this.props.setStickerPickerOpen(!1),vl.A.removeStickerpickerWidgets(this.props.room.client).then((()=>{this.forceUpdate()})).catch((e=>{l.v.error("Failed to remove sticker picker widget",e)}))})),(0,r.A)(this,"updateWidget",(()=>{var e,t,n,i;const r=vl.A.getStickerpickerWidgets(this.props.room.client)[0];if(!r)return xd.currentWidget=void 0,void this.setState({stickerpickerWidget:null,widgetId:null});const o=xd.currentWidget,s=null!==(e=null==o||null===(t=o.content)||void 0===t?void 0:t.url)&&void 0!==e?e:null;(null!==(n=null==r||null===(i=r.content)||void 0===i?void 0:i.url)&&void 0!==n?n:null)!==s&&Il.destroyElement(wd),xd.currentWidget=r,this.setState({stickerpickerWidget:r,widgetId:r?r.id:null})})),(0,r.A)(this,"onAction",(e=>{switch(e.action){case"user_widget_updated":this.forceUpdate();break;case"stickerpicker_close":case"show_left_panel":case"hide_left_panel":this.props.setStickerPickerOpen(!1)}})),(0,r.A)(this,"onRightPanelStoreUpdate",(()=>{this.props.setStickerPickerOpen(!1)})),(0,r.A)(this,"onResize",(()=>{this.props.isStickerPickerOpen&&this.props.setStickerPickerOpen(!1)})),(0,r.A)(this,"onFinished",(()=>{this.props.isStickerPickerOpen&&this.props.setStickerPickerOpen(!1)})),(0,r.A)(this,"launchManageIntegrations",(()=>{var e,t;null===(e=Yl.J.sharedInstance())||void 0===e||null===(e=e.getPrimaryManager())||void 0===e||e.open(this.props.room,`type_${Tl.x.STICKERPICKER.preferred}`,null!==(t=this.state.widgetId)&&void 0!==t?t:void 0)})),this.state={imError:null,stickerpickerWidget:null,widgetId:null}}async acquireScalarClient(){return this.scalarClient?Promise.resolve(this.scalarClient):Yl.J.sharedInstance().hasManager()?(this.scalarClient=null!==(e=null===(t=Yl.J.sharedInstance().getPrimaryManager())||void 0===t?void 0:t.getScalarClient())&&void 0!==e?e:null,null===(n=this.scalarClient)||void 0===n?void 0:n.connect().then((()=>(this.forceUpdate(),this.scalarClient))).catch((e=>{this.imError((0,C.AO)("integration_manager|error_connecting_heading"),e)}))):void Yl.J.sharedInstance().openNoManagerDialog();var e,t,n}componentDidMount(){window.addEventListener("resize",this.onResize),this.dispatcherRef=v.Ay.register(this.onAction),h.J.safeGet().on(s.ClientEvent.AccountData,this.updateWidget),qn.A.instance.on(A.H,this.onRightPanelStoreUpdate),this.updateWidget()}componentWillUnmount(){const e=h.J.get();e&&e.removeListener(s.ClientEvent.AccountData,this.updateWidget),qn.A.instance.off(A.H,this.onRightPanelStoreUpdate),window.removeEventListener("resize",this.onResize),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef)}componentDidUpdate(){this.sendVisibilityToWidget(this.props.isStickerPickerOpen)}imError(e,t){l.v.error(e,t),this.setState({imError:(0,C._t)(e)}),this.props.setStickerPickerOpen(!1)}defaultStickerpickerContent(){return o.createElement(be.A,{onClick:this.launchManageIntegrations,className:"mx_Stickers_contentPlaceholder"},o.createElement("p",null,(0,C._t)("stickers|empty")),o.createElement("p",{className:"mx_Stickers_addLink"},(0,C._t)("stickers|empty_add_prompt")),o.createElement("img",{src:n("./node_modules/matrix-react-sdk/res/img/stickerpack-placeholder.png"),alt:""}))}errorStickerpickerContent(){return o.createElement("div",{style:{textAlign:"center"},className:"error"},o.createElement("p",null," ",this.state.imError," "))}sendVisibilityToWidget(e){if(!this.state.stickerpickerWidget)return;const t=$l.c.instance.getMessagingForUid(vl.A.calcWidgetUid(this.state.stickerpickerWidget.id));t&&e!==this.prevSentVisibility&&(t.updateVisibility(e).catch((e=>{l.v.error("Error updating widget visibility: ",e)})),this.prevSentVisibility=e)}getStickerpickerContent(){var e;if(this.state.imError)return this.errorStickerpickerContent();const t=this.state.stickerpickerWidget;let n;if(null!=t&&null!==(e=t.content)&&void 0!==e&&e.url){t.content.name=t.content.name||(0,C._t)("common|stickerpack");const e={id:t.id,url:t.content.url,name:t.content.name,type:t.content.type,data:t.content.data,creatorUserId:t.content.creatorUserId||t.sender};n=o.createElement("div",{className:"mx_Stickers_content_container"},o.createElement("div",{id:"stickersContent",className:"mx_Stickers_content",style:{border:"none",height:this.popoverHeight,width:this.popoverWidth}},o.createElement(Il,{persistKey:wd,zIndex:3500},o.createElement(Hc,{app:e,room:this.props.room,threadId:this.props.threadId,fullWidth:!0,userId:h.J.safeGet().credentials.userId,creatorUserId:t.sender||h.J.safeGet().credentials.userId,waitForIframeLoad:!0,showMenubar:!0,onEditClick:this.launchManageIntegrations,onDeleteClick:this.removeStickerpickerWidgets,showTitle:!1,showPopout:!1,handleMinimisePointerEvents:!0,userWidget:!0,showLayoutButtons:!1}))))}else n=this.defaultStickerpickerContent();return n}render(){return this.props.isStickerPickerOpen?o.createElement(Me.Ay,(0,i.A)({chevronFace:Me.t4.Bottom,menuWidth:this.popoverWidth,menuHeight:this.popoverHeight,onFinished:this.onFinished,menuPaddingTop:0,menuPaddingLeft:0,menuPaddingRight:0,zIndex:3500,mountAsChild:!0},this.props.menuPosition),o.createElement(bd,{element:this.getStickerpickerContent(),onResize:this.onFinished})):null}}(0,r.A)(xd,"defaultProps",{threadId:null}),(0,r.A)(xd,"currentWidget",void 0);var Ad=n("./node_modules/matrix-react-sdk/src/components/views/rooms/ReplyTile.tsx");class Sd extends o.Component{render(){return this.props.replyToEvent?o.createElement("div",{className:"mx_ReplyPreview"},o.createElement("div",{className:"mx_ReplyPreview_section"},o.createElement("div",{className:"mx_ReplyPreview_header"},o.createElement("span",null,(0,C._t)("composer|replying_title")),o.createElement(be.A,{className:"mx_ReplyPreview_header_cancel",onClick:()=>{return e=this.context.timelineRenderingType,void v.Ay.dispatch({action:"reply_to_event",event:null,context:e});var e}})),o.createElement(Ad.A,{mxEvent:this.props.replyToEvent,permalinkCreator:this.props.permalinkCreator}))):null}}(0,r.A)(Sd,"contextType",Zr.Ay);var Cd=n("./node_modules/matrix-react-sdk/src/audio/VoiceRecording.ts"),kd=n("./node_modules/matrix-react-sdk/src/components/views/audio_messages/Waveform.tsx"),Rd=n("./node_modules/matrix-react-sdk/src/utils/MarkedExecution.ts");class Id extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"waveform",[]),(0,r.A)(this,"scheduledUpdate",new Rd.L((()=>this.updateWaveform()),(()=>requestAnimationFrame((()=>this.scheduledUpdate.trigger()))))),this.state={waveform:(0,Pl.DG)(0,Cd.IZ)}}componentDidMount(){this.props.recorder.liveData.onUpdate((e=>{this.waveform=(0,Pl.$S)(Array.from(e.waveform),Cd.IZ),this.scheduledUpdate.mark()}))}updateWaveform(){this.setState({waveform:this.waveform})}render(){return o.createElement(kd.A,{relHeights:this.state.waveform})}}(0,r.A)(Id,"defaultProps",{progress:1});var Td=n("./node_modules/matrix-react-sdk/src/components/views/audio_messages/Clock.tsx");class Pd extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"seconds",0),(0,r.A)(this,"scheduledUpdate",new Rd.L((()=>this.updateClock()),(()=>requestAnimationFrame((()=>this.scheduledUpdate.trigger()))))),this.state={seconds:0}}componentDidMount(){this.props.recorder.liveData.onUpdate((e=>{this.seconds=e.timeSeconds,this.scheduledUpdate.mark()}))}updateClock(){this.setState({seconds:this.seconds})}render(){return o.createElement(Td.A,{seconds:this.state.seconds,"aria-live":"off"})}}var Nd=n("./node_modules/matrix-react-sdk/src/utils/Singleflight.ts"),Dd=n("./node_modules/matrix-react-sdk/src/audio/Playback.ts");class Md{constructor(e,t){(0,r.A)(this,"lastUpload",void 0),(0,r.A)(this,"buffer",new Uint8Array(0)),(0,r.A)(this,"playback",void 0),(0,r.A)(this,"onDataAvailable",(e=>{const t=new Uint8Array(e);this.buffer=(0,Pl.xW)(this.buffer,t)})),this.matrixClient=e,this.voiceRecording=t,this.voiceRecording.onDataAvailable=this.onDataAvailable}async start(){if(this.lastUpload||this.hasRecording)throw new Error("Recording already prepared");return this.voiceRecording.start()}async stop(){return await this.voiceRecording.stop(),this.audioBuffer}on(e,t){return this.voiceRecording.on(e,t),this}off(e,t){return this.voiceRecording.off(e,t),this}emit(e,...t){return this.voiceRecording.emit(e,...t)}get hasRecording(){return this.buffer.length>0}get isRecording(){return this.voiceRecording.isRecording}getPlayback(){return this.playback=Nd.j.for(this,"playback").do((()=>new Dd.Y(this.audioBuffer.buffer,this.voiceRecording.amplitudes))),this.playback}async upload(e){if(!this.hasRecording)throw new Error("No recording available to upload");if(this.lastUpload)return this.lastUpload;try{this.emit(Cd.$T.Uploading);const{url:t,file:n}=await(0,No.QM)(this.matrixClient,e,new Blob([this.audioBuffer],{type:this.contentType}));this.lastUpload={mxc:t,encrypted:n},this.emit(Cd.$T.Uploaded)}catch(e){throw this.emit(Cd.$T.Ended),e}return this.lastUpload}get durationSeconds(){return this.voiceRecording.durationSeconds}get contentType(){return this.voiceRecording.contentType}get contentLength(){return this.buffer.length}get liveData(){return this.voiceRecording.liveData}get isSupported(){return this.voiceRecording.isSupported}destroy(){var e;null===(e=this.playback)||void 0===e||e.destroy(),this.voiceRecording.destroy()}get audioBuffer(){return this.buffer.slice(0)}}function Od(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function Ld(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ud(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ld(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ld(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Fd extends M.r{constructor(){super(v.Ay,{})}static get instance(){return this.internalInstance||(this.internalInstance=new Fd,this.internalInstance.start()),this.internalInstance}async onAction(e){}static getVoiceRecordingId(e,t){return"io.element.thread"===(null==t?void 0:t.rel_type)||(null==t?void 0:t.rel_type)===s.RelationType.Thread?e.roomId+"|"+t.event_id:e.roomId}getActiveRecording(e){return this.state[e]}startRecording(e){if(!this.matrixClient)throw new Error("Cannot start a recording without a MatrixClient");if(!e)throw new Error("Recording must be associated with a room");if(this.state[e])throw new Error("A recording is already in progress");const t=(n=this.matrixClient,new Md(n,new Cd.Qj));var n;return this.updateState(Ud(Ud({},this.state),{},{[e]:t})),t}disposeRecording(e){var t;null===(t=this.state[e])||void 0===t||t.destroy();const n=this.state,{[e]:i}=n,r=(0,Ue.A)(n,[e].map(Od));return this.reset(r)}}(0,r.A)(Fd,"internalInstance",void 0),window.mxVoiceRecordingStore=Fd.instance;var jd=n("./node_modules/matrix-react-sdk/src/components/views/audio_messages/RecordingPlayback.tsx"),Bd=n("./node_modules/matrix-react-sdk/src/audio/PlaybackManager.ts"),Vd=n("./node_modules/matrix-react-sdk/src/utils/local-room.ts"),Hd=n("./node_modules/matrix-react-sdk/src/components/views/rooms/SendMessageComposer.tsx"),zd=n("./node_modules/matrix-react-sdk/src/utils/Reply.ts"),Wd=n("./node_modules/matrix-react-sdk/src/utils/createVoiceMessageContent.ts");class Gd extends o.PureComponent{constructor(e,t){super(e,t),(0,r.A)(this,"voiceRecordingId",void 0),(0,r.A)(this,"onCancel",(async()=>{await this.disposeRecording()})),(0,r.A)(this,"onRecordStartEndClick",(async()=>{if(this.state.recorder)return void await this.state.recorder.stop();const e=()=>{f.Ay.createDialog(lc.A,{title:(0,C._t)("voip|unable_to_access_audio_input_title"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("voip|unable_to_access_audio_input_description")))})};try{var t;const e=await ne.Ay.getDevices();if(null==e||null===(t=e[ne.cm.AudioInput])||void 0===t||!t.length)return void f.Ay.createDialog(lc.A,{title:(0,C._t)("voip|no_audio_input_title"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("voip|no_audio_input_description")))})}catch(t){return l.v.error("Error getting devices: ",t),void e()}try{Bd.T.instance.pauseAllExcept();const e=Fd.instance.startRecording(this.voiceRecordingId);await e.start(),this.bindNewRecorder(e),this.setState({recorder:e,recordingPhase:Cd.$T.Started})}catch(t){l.v.error("Error starting recording: ",t),e(),Fd.instance.disposeRecording(this.voiceRecordingId)}})),(0,r.A)(this,"onRecordingUpdate",(e=>{e!==Cd.$T.EndingSoon&&this.setState({recordingPhase:e})})),this.state={},this.voiceRecordingId=Fd.getVoiceRecordingId(this.props.room,this.props.relation)}componentDidMount(){const e=Fd.instance.getActiveRecording(this.voiceRecordingId);e&&(!e.isRecording&&e.hasRecording||l.v.warn("Cached recording hasn't ended yet and might cause issues"),this.bindNewRecorder(e),this.setState({recorder:e,recordingPhase:Cd.$T.Ended}))}async componentWillUnmount(){const e=Fd.instance.getActiveRecording(this.voiceRecordingId);await(null==e?void 0:e.stop()),this.bindNewRecorder(null)}async send(){if(!this.state.recorder)throw new Error("No recording started - cannot send anything");const{replyToEvent:e,relation:t,permalinkCreator:n}=this.props;let i;await this.state.recorder.stop();try{i=await this.state.recorder.upload(this.voiceRecordingId)}catch(e){return l.v.error("Error uploading voice message:",e),void this.setState({didUploadFail:!0})}try{const r=(0,Wd.r)(i.mxc,this.state.recorder.contentType,Math.round(1e3*this.state.recorder.durationSeconds),this.state.recorder.contentLength,i.encrypted,this.state.recorder.getPlayback().thumbnailWaveform.map((e=>Math.round(1024*e))));(0,Hd.LO)(h.J.safeGet().getSafeUserId(),r,null,e),(0,Hd.gV)(r,t),e&&((0,zd.fh)(r,e,{permalinkCreator:n,includeLegacyFallback:!0}),v.Ay.dispatch({action:"reply_to_event",event:null,context:this.context.timelineRenderingType})),(0,Vd.Y)(this.props.room.roomId,(e=>h.J.safeGet().sendMessage(e,r)),this.props.room.client)}catch(e){l.v.error("Error sending voice message:",e)}await this.disposeRecording()}async disposeRecording(){await Fd.instance.disposeRecording(this.voiceRecordingId),this.setState({recorder:void 0,recordingPhase:void 0,didUploadFail:!1})}bindNewRecorder(e){this.state.recorder&&this.state.recorder.off(A.H,this.onRecordingUpdate),e&&e.on(A.H,this.onRecordingUpdate)}renderWaveformArea(){return this.state.recorder?this.state.recordingPhase!==Cd.$T.Started?o.createElement(jd.A,{playback:this.state.recorder.getPlayback(),layout:jd._.Composer}):o.createElement("div",{className:"mx_MediaBody mx_VoiceMessagePrimaryContainer mx_VoiceRecordComposerTile_recording"},o.createElement(Pd,{recorder:this.state.recorder}),o.createElement(Id,{recorder:this.state.recorder})):null}render(){if(!this.state.recordingPhase)return null;let e,t,n;if(this.state.recordingPhase===Cd.$T.Started){var i;let t=(0,C._t)("composer|send_voice_message");this.state.recorder&&(t=(0,C._t)("composer|stop_voice_message")),e=o.createElement(be.A,{className:"mx_VoiceRecordComposerTile_stop",onClick:this.onRecordStartEndClick,title:t}),!this.state.recorder||null!==(i=this.state.recorder)&&void 0!==i&&i.isRecording||(e=null)}return this.state.recorder&&this.state.recordingPhase!==Cd.$T.Uploading&&(t=o.createElement(be.A,{className:"mx_VoiceRecordComposerTile_delete",title:(0,C._t)("action|delete"),onClick:this.onCancel})),this.state.recordingPhase===Cd.$T.Uploading?n=o.createElement("span",{className:"mx_VoiceRecordComposerTile_uploadingState"},o.createElement(Ve.A,{w:16,h:16})):this.state.didUploadFail&&this.state.recordingPhase===Cd.$T.Ended&&(n=o.createElement("span",{className:"mx_VoiceRecordComposerTile_failedState"},o.createElement("span",{className:"mx_VoiceRecordComposerTile_uploadState_badge"},o.createElement(qe.A,{notification:Ye.d.forSymbol("!",Qe.S.Highlight)})),o.createElement("span",{className:"text-warning"},(0,C._t)("timeline|send_state_failed")))),o.createElement(o.Fragment,null,n,t,e,this.renderWaveformArea())}}(0,r.A)(Gd,"contextType",Zr.Ay);var Kd=n("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx"),Jd=n("./node_modules/matrix-react-sdk/src/utils/localRoom/isLocalRoom.ts"),qd=n("./node_modules/matrix-react-sdk/src/components/views/rooms/wysiwyg_composer/index.ts");const $d="mx_wysiwyg_state_";let Yd=0;function Qd(e){var t;return o.createElement(be.A,{className:"mx_MessageComposer_sendMessage",onClick:e.onClick,title:null!==(t=e.title)&&void 0!==t?t:(0,C._t)("composer|send_button_title")})}class Zd extends o.Component{constructor(e,t){var n;super(e,t),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"messageComposerInput",(0,o.createRef)()),(0,r.A)(this,"voiceRecordingButton",(0,o.createRef)()),(0,r.A)(this,"ref",(0,o.createRef)()),(0,r.A)(this,"instanceId",void 0),(0,r.A)(this,"_voiceRecording",void 0),(0,r.A)(this,"saveWysiwygEditorState",(()=>{if(this.shouldSaveWysiwygEditorState()){const{isRichTextEnabled:e,composerContent:t}=this.state,n={content:t,isRichText:e,replyEventId:this.props.replyToEvent?this.props.replyToEvent.getId():void 0};localStorage.setItem(this.editorStateKey,JSON.stringify(n))}else this.clearStoredEditorState()})),(0,r.A)(this,"shouldSaveWysiwygEditorState",(()=>{const{isWysiwygLabEnabled:e,isComposerEmpty:t}=this.state;return e&&(!t||!!this.props.replyToEvent)})),(0,r.A)(this,"onResize",((e,t)=>{if(e===Ce.x.Resize){const{narrow:e}=this.context;this.setState({isMenuOpen:!!e&&this.state.isMenuOpen,isStickerPickerOpen:!1})}})),(0,r.A)(this,"onAction",(e=>{switch(e.action){case"reply_to_event":e.context===this.context.timelineRenderingType&&window.setTimeout((()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()}),100);break;case x.r.SettingUpdated:{const t=e;switch(t.settingName){case"MessageComposerInput.showStickersButton":{const e=O.A.getValue("MessageComposerInput.showStickersButton");this.state.showStickersButton!==e&&this.setState({showStickersButton:e});break}case"MessageComposerInput.showPollsButton":{const e=O.A.getValue("MessageComposerInput.showPollsButton");this.state.showPollsButton!==e&&this.setState({showPollsButton:e});break}case Ln.O5.VoiceBroadcast:this.state.showVoiceBroadcastButton!==t.newValue&&this.setState({showVoiceBroadcastButton:!!t.newValue});break;case"feature_wysiwyg_composer":this.state.isWysiwygLabEnabled!==t.newValue&&this.setState({isWysiwygLabEnabled:Boolean(t.newValue)})}}}})),(0,r.A)(this,"onTombstoneClick",(e=>{var t,n;e.preventDefault();const i=null===(t=this.context.tombstone)||void 0===t?void 0:t.getContent().replacement_room,r=h.J.safeGet().getRoom(i);let o;if(r){const e=r.currentState.getStateEvents(s.EventType.RoomCreate,"");null!=e&&e.getId()&&(o=e.getId())}const a=null===(n=this.context.tombstone)||void 0===n?void 0:n.getSender(),l=a?[a.split(":").slice(1).join(":")]:void 0;v.Ay.dispatch({action:x.r.ViewRoom,highlighted:!0,event_id:o,room_id:i,auto_join:!0,via_servers:l,metricsTrigger:"Tombstone",metricsViaKeyboard:"click"!==e.type})})),(0,r.A)(this,"renderPlaceholderText",(()=>{if(this.props.replyToEvent){var e;const t=(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===s.THREAD_RELATION_TYPE.name;return t&&this.props.e2eStatus?(0,C._t)("composer|placeholder_thread_encrypted"):t?(0,C._t)("composer|placeholder_thread"):this.props.e2eStatus?(0,C._t)("composer|placeholder_reply_encrypted"):(0,C._t)("composer|placeholder_reply")}return this.props.e2eStatus?(0,C._t)("composer|placeholder_encrypted"):(0,C._t)("composer|placeholder")})),(0,r.A)(this,"addEmoji",(e=>(v.Ay.dispatch({action:x.r.ComposerInsert,text:e,timelineRenderingType:this.context.timelineRenderingType}),!0))),(0,r.A)(this,"sendMessage",(async()=>{var e,t;if(this.state.haveRecording&&this.voiceRecordingButton.current)await(null===(t=this.voiceRecordingButton.current)||void 0===t?void 0:t.send());else if(null===(e=this.messageComposerInput.current)||void 0===e||e.sendMessage(),this.state.isWysiwygLabEnabled){const{permalinkCreator:e,relation:t,replyToEvent:n}=this.props,i=this.state.composerContent;this.setState({composerContent:"",initialComposerContent:""}),v.Ay.dispatch({action:x.r.ClearAndFocusSendMessageComposer,timelineRenderingType:this.context.timelineRenderingType}),await(0,qd._z)(i,this.state.isRichTextEnabled,{mxClient:this.props.mxClient,roomContext:this.context,permalinkCreator:e,relation:t,replyToEvent:n})}})),(0,r.A)(this,"onChange",(e=>{this.setState({isComposerEmpty:e.isEmpty})})),(0,r.A)(this,"onWysiwygChange",(e=>{this.setState({composerContent:e,isComposerEmpty:0===(null==e?void 0:e.length)})})),(0,r.A)(this,"onRichTextToggle",(async()=>{const{richToPlain:e,plainToRich:t}=await(0,qd.Os)(),{isRichTextEnabled:n,composerContent:i}=this.state,r=n?await e(i,!1):await t(i,!1);this.setState({isRichTextEnabled:!n,composerContent:r,initialComposerContent:r})})),(0,r.A)(this,"onVoiceStoreUpdate",(()=>{this.updateRecordingState()})),(0,r.A)(this,"onRecordingStarted",(()=>{const e=Fd.getVoiceRecordingId(this.props.room,this.props.relation);this.voiceRecording=Fd.instance.getActiveRecording(e),this.setState({haveRecording:!!this.voiceRecording})})),(0,r.A)(this,"onRecordingEndingSoon",(({secondsLeft:e})=>{this.setState({recordingTimeLeftSeconds:e}),window.setTimeout((()=>this.setState({recordingTimeLeftSeconds:void 0})),3e3)})),(0,r.A)(this,"setStickerPickerOpen",(e=>{this.setState({isStickerPickerOpen:e,isMenuOpen:!1})})),(0,r.A)(this,"toggleStickerPickerOpen",(()=>{this.setStickerPickerOpen(!this.state.isStickerPickerOpen)})),(0,r.A)(this,"toggleButtonMenu",(()=>{this.setState({isMenuOpen:!this.state.isMenuOpen})})),(0,r.A)(this,"onRecordStartEndClick",(()=>{const e=Xt.M.instance.voiceBroadcastRecordingsStore.getCurrent();var t;e&&e.getState()!==Pn.HF.Stopped?f.Ay.createDialog(rn.A,{title:(0,C._t)("voice_message|cant_start_broadcast_title"),description:o.createElement("p",null,(0,C._t)("voice_message|cant_start_broadcast_description")),hasCloseButton:!0}):null===(t=this.voiceRecordingButton.current)||void 0===t||t.onRecordStartEndClick();this.context.narrow&&this.toggleButtonMenu()})),this.context=t,Fd.instance.on(A.H,this.onVoiceStoreUpdate),window.addEventListener("beforeunload",this.saveWysiwygEditorState);const i=O.A.getValue("feature_wysiwyg_composer");let a=!0,l="";if(i){const e=this.restoreWysiwygEditorState();e&&(a=e.isRichText,l=e.content,e.replyEventId&&v.Ay.dispatch({action:"reply_to_event",event:this.props.room.findEventById(e.replyEventId),context:this.context.timelineRenderingType}))}this.state={isComposerEmpty:0===(null===(n=l)||void 0===n?void 0:n.length),composerContent:l,haveRecording:!1,recordingTimeLeftSeconds:void 0,isMenuOpen:!1,isStickerPickerOpen:!1,showStickersButton:O.A.getValue("MessageComposerInput.showStickersButton"),showPollsButton:O.A.getValue("MessageComposerInput.showPollsButton"),showVoiceBroadcastButton:O.A.getValue(Ln.O5.VoiceBroadcast),isWysiwygLabEnabled:i,isRichTextEnabled:a,initialComposerContent:l},this.instanceId=Yd++,O.A.monitorSetting("MessageComposerInput.showStickersButton",null),O.A.monitorSetting("MessageComposerInput.showPollsButton",null),O.A.monitorSetting(Ln.O5.VoiceBroadcast,null),O.A.monitorSetting("feature_wysiwyg_composer",null)}get editorStateKey(){var e;let t=$d+this.props.room.roomId;return(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===s.THREAD_RELATION_TYPE.name&&(t+=`_${this.props.relation.event_id}`),t}restoreWysiwygEditorState(){const e=localStorage.getItem(this.editorStateKey);if(e)try{return JSON.parse(e)}catch(e){l.v.error(e)}}clearStoredEditorState(){localStorage.removeItem(this.editorStateKey)}get voiceRecording(){return this._voiceRecording}set voiceRecording(e){this._voiceRecording&&(this._voiceRecording.off(Cd.$T.Started,this.onRecordingStarted),this._voiceRecording.off(Cd.$T.EndingSoon,this.onRecordingEndingSoon)),this._voiceRecording=e,e&&(e.on(Cd.$T.Started,this.onRecordingStarted),e.on(Cd.$T.EndingSoon,this.onRecordingEndingSoon))}componentDidMount(){this.dispatcherRef=v.Ay.register(this.onAction),this.waitForOwnMember(),Ce.A.instance.trackElementDimensions(`MessageComposer${this.instanceId}`,this.ref.current),Ce.A.instance.on(`MessageComposer${this.instanceId}`,this.onResize),this.updateRecordingState()}waitForOwnMember(){const e=this.props.room.getMember(h.J.safeGet().getUserId());e?this.setState({me:e}):this.props.room.loadMembersIfNeeded().then((()=>{var e;const t=null!==(e=this.props.room.getMember(h.J.safeGet().getSafeUserId()))&&void 0!==e?e:void 0;this.setState({me:t})}))}componentWillUnmount(){Fd.instance.off(A.H,this.onVoiceStoreUpdate),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef),Ce.A.instance.stopTrackingElementDimensions(`MessageComposer${this.instanceId}`),Ce.A.instance.removeListener(`MessageComposer${this.instanceId}`,this.onResize),window.removeEventListener("beforeunload",this.saveWysiwygEditorState),this.saveWysiwygEditorState(),this.voiceRecording=null}updateRecordingState(){const e=Fd.getVoiceRecordingId(this.props.room,this.props.relation);this.voiceRecording=Fd.instance.getActiveRecording(e),this.voiceRecording?this.voiceRecording.hasRecording&&!this.voiceRecording.isRecording&&this.setState({haveRecording:!0}):this.setState({haveRecording:!1})}get showStickersButton(){return this.state.showStickersButton&&!(0,Jd.F)(this.props.room)}getMenuPosition(){if(this.ref.current){const e=this.state.isWysiwygLabEnabled&&this.state.isRichTextEnabled,t=this.ref.current.getBoundingClientRect(),n=e?36:0,i=new DOMRect(t.x,t.y+n,t.width,t.height-n);return(0,Me.qv)(i)}}render(){var e;const t=Boolean(!this.state.isWysiwygLabEnabled&&this.props.e2eStatus),i=t&&o.createElement("div",{className:"mx_MessageComposer_e2eIconWrapper"},o.createElement(Zc.A,{key:"e2eIcon",status:this.props.e2eStatus,className:"mx_MessageComposer_e2eIcon"})),r=[],a=this.getMenuPosition(),l=this.context.canSendMessages&&!this.context.tombstone;let c;if(l)c=this.state.isWysiwygLabEnabled&&a?o.createElement(qd.W1,{key:"controls_input",disabled:this.state.haveRecording,onChange:this.onWysiwygChange,onSend:this.sendMessage,isRichTextEnabled:this.state.isRichTextEnabled,initialContent:this.state.initialComposerContent,e2eStatus:this.props.e2eStatus,menuPosition:a,placeholder:this.renderPlaceholderText(),eventRelation:this.props.relation}):o.createElement(Hd.Ay,{ref:this.messageComposerInput,key:"controls_input",room:this.props.room,placeholder:this.renderPlaceholderText(),permalinkCreator:this.props.permalinkCreator,relation:this.props.relation,replyToEvent:this.props.replyToEvent,onChange:this.onChange,disabled:this.state.haveRecording,toggleStickerPickerOpen:this.toggleStickerPickerOpen}),r.push(o.createElement(Gd,{key:"controls_voice_record",ref:this.voiceRecordingButton,room:this.props.room,permalinkCreator:this.props.permalinkCreator,relation:this.props.relation,replyToEvent:this.props.replyToEvent}));else if(this.context.tombstone){const e=this.context.tombstone.getContent().replacement_room,t=e?o.createElement("a",{href:(0,Po.B4)(h.J.safeGet(),e),className:"mx_MessageComposer_roomReplaced_link",onClick:this.onTombstoneClick},(0,C._t)("composer|room_upgraded_link")):"";r.push(o.createElement("div",{className:"mx_MessageComposer_replaced_wrapper",key:"room_replaced"},o.createElement("div",{className:"mx_MessageComposer_replaced_valign"},o.createElement("img",{"aria-hidden":!0,alt:"",className:"mx_MessageComposer_roomReplaced_icon",src:n("./node_modules/matrix-react-sdk/res/img/room_replaced.svg").A}),o.createElement("span",{className:"mx_MessageComposer_roomReplaced_header"},(0,C._t)("composer|room_upgraded_notice")),o.createElement("br",null),t)))}else r.push(o.createElement("div",{key:"controls_error",className:"mx_MessageComposer_noperm_error"},(0,C._t)("composer|no_perms_notice")));const d=Boolean(this.state.recordingTimeLeftSeconds),u=this.state.recordingTimeLeftSeconds?Math.round(this.state.recordingTimeLeftSeconds):0,m=(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===s.THREAD_RELATION_TYPE.name?this.props.relation.event_id:null;r.push(o.createElement(xd,{room:this.props.room,threadId:m,isStickerPickerOpen:this.state.isStickerPickerOpen,setStickerPickerOpen:this.setStickerPickerOpen,menuPosition:a,key:"stickers"}));const p=l&&(!this.state.isComposerEmpty||this.state.haveRecording),g=ee()({mx_MessageComposer:!0,"mx_MessageComposer--compact":this.props.compact,mx_MessageComposer_e2eStatus:t,mx_MessageComposer_wysiwyg:this.state.isWysiwygLabEnabled});return o.createElement(ke.m_,{open:d,label:(0,Ms.U)(u),placement:"top"},o.createElement("div",{className:g,ref:this.ref,role:"region","aria-label":(0,C._t)("a11y|message_composer")},undefined,o.createElement("div",{className:"mx_MessageComposer_wrapper"},o.createElement(Sd,{replyToEvent:this.props.replyToEvent,permalinkCreator:this.props.permalinkCreator}),o.createElement("div",{className:"mx_MessageComposer_row"},i,c,o.createElement("div",{className:"mx_MessageComposer_actions"},r,l&&o.createElement(Kd.Ay,{addEmoji:this.addEmoji,haveRecording:this.state.haveRecording,isMenuOpen:this.state.isMenuOpen,isStickerPickerOpen:this.state.isStickerPickerOpen,menuPosition:a,relation:this.props.relation,onRecordStartEndClick:this.onRecordStartEndClick,setStickerPickerOpen:this.setStickerPickerOpen,showLocationButton:!window.electron&&O.A.getValue(W.f.LocationSharing),showPollsButton:this.state.showPollsButton,showStickersButton:this.showStickersButton,isRichTextEnabled:this.state.isRichTextEnabled,onComposerModeClick:this.onRichTextToggle,toggleButtonMenu:this.toggleButtonMenu,showVoiceBroadcastButton:this.state.showVoiceBroadcastButton,onStartVoiceBroadcastClick:()=>{(async(e,t,n,i,r)=>{var o;if(!await(0,Pn.nR)(e,t,i))return null;const s=t.getUserId();if(!s)return null;const a=e.getMember(s);if(!a)return null;null===(o=n.getCurrent())||void 0===o||o.pause(),n.clearCurrent();const l=new Pn.wB(e,a,t,n,i);r.setCurrent(l)})(this.props.room,h.J.safeGet(),Xt.M.instance.voiceBroadcastPlaybacksStore,Xt.M.instance.voiceBroadcastRecordingsStore,Xt.M.instance.voiceBroadcastPreRecordingStore),this.toggleButtonMenu()}}),p&&o.createElement(Qd,{key:"controls_send",onClick:this.sendMessage,title:this.state.haveRecording?(0,C._t)("composer|send_button_voice_message"):void 0}))))))}}(0,r.A)(Zd,"contextType",Zr.Ay),(0,r.A)(Zd,"defaultProps",{compact:!1,showVoiceBroadcastButton:!1,isRichTextEnabled:!0});const Xd=(0,Re.dt)(Zd);class eu{constructor(e){(0,r.A)(this,"serializedParts",null),(0,r.A)(this,"caret",null),this.event=e}setEditorState(e,t){this.caret=e,this.serializedParts=t}hasEditorState(){return!!this.serializedParts}getSerializedParts(){return this.serializedParts}getCaret(){return this.caret}getEvent(){return this.event}}var tu=n("./node_modules/matrix-react-sdk/src/utils/FileUtils.ts");class nu extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"mounted",!1),(0,r.A)(this,"onAction",(e=>{this.mounted&&function(e){return[x.r.UploadStarted,x.r.UploadProgress,x.r.UploadFailed,x.r.UploadFinished,x.r.UploadCanceled].includes(e.action)}(e)&&this.setState(this.calculateState())})),(0,r.A)(this,"onCancelClick",(e=>{e.preventDefault(),No.Ay.sharedInstance().cancelUpload(this.state.currentUpload)})),this.state=this.calculateState()}componentDidMount(){this.dispatcherRef=v.Ay.register(this.onAction),this.mounted=!0}componentWillUnmount(){this.mounted=!1,v.Ay.unregister(this.dispatcherRef)}getUploadsInRoom(){return No.Ay.sharedInstance().getCurrentUploads(this.props.relation).filter((e=>e.roomId===this.props.room.roomId))}calculateState(){const[e,...t]=this.getUploadsInRoom();return{currentUpload:e,currentFile:null==e?void 0:e.fileName,currentLoaded:null==e?void 0:e.loaded,currentTotal:null==e?void 0:e.total,countFiles:t.length+1}}render(){if(!this.state.currentFile)return null;let e;e=this.state.countFiles>1?(0,C._t)("room|upload|uploading_multiple_file",{filename:this.state.currentFile,count:this.state.countFiles-1}):(0,C._t)("room|upload|uploading_single_file",{filename:this.state.currentFile});const t=(0,tu.O)(this.state.currentTotal);return o.createElement("div",{className:"mx_UploadBar"},o.createElement("div",{className:"mx_UploadBar_filename"},e," (",t,")"),o.createElement(be.A,{onClick:this.onCancelClick,className:"mx_UploadBar_cancel"}),o.createElement(mo.A,{value:this.state.currentLoaded,max:this.state.currentTotal}))}}var iu=n("./node_modules/matrix-react-sdk/src/utils/strings.ts");const ru=["mxEvent","permalinkCreator","onMenuToggle"],ou=e=>{let{mxEvent:t,permalinkCreator:n,onMenuToggle:r}=e,s=(0,Ue.A)(e,ru);const[a,l,c,d]=(0,Me.EF)(),u=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:x.r.ViewRoom,event_id:t.getId(),highlighted:!0,room_id:t.getRoomId(),metricsTrigger:void 0}),d()}),[t,d]),m=(0,o.useCallback)((async e=>{if(n){null==e||e.preventDefault(),null==e||e.stopPropagation();const i=n.forEvent(t.getId());await(0,iu.nC)(i),d()}}),[t,d,n]);(0,o.useEffect)((()=>{null==r||r(a)}),[a,r]);const p=h.J.safeGet().getRoom(t.getRoomId()),g=!!p&&!hc.aK.instance.hasMaximisedWidget(p);return o.createElement(o.Fragment,null,o.createElement(Me.oW,(0,i.A)({},s,{className:"mx_BaseCard_header_title_button--option",onClick:c,title:(0,C._t)("right_panel|thread_list|context_menu_label"),isExpanded:a,ref:l})),a&&o.createElement(Le.Ay,(0,i.A)({onFinished:d,className:"mx_RoomTile_contextMenu",compact:!0,rightAligned:!0},{left:(_=l.current.getBoundingClientRect()).left+window.scrollX+_.width,top:_.bottom+window.scrollY,chevronFace:Me.t4.None}),o.createElement(Le.tx,null,g&&o.createElement(Le.R$,{onClick:e=>u(e),label:(0,C._t)("timeline|mab|view_in_room"),iconClassName:"mx_ThreadPanel_viewInRoom"}),n&&o.createElement(Le.R$,{onClick:e=>m(e),label:(0,C._t)("timeline|mab|copy_link_thread"),iconClassName:"mx_ThreadPanel_copyLinkToThread"}))));var _},su=({parent:e,onFileDrop:t})=>{const[i,r]=(0,o.useState)({dragging:!1,counter:0});return(0,o.useEffect)((()=>{if(!e||e.ondrop)return;const n=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer&&r((t=>({counter:t.counter+1,dragging:!(!e.dataTransfer.types.includes("Files")&&!e.dataTransfer.types.includes("application/x-moz-file"))||t.dragging})))},i=e=>{e.stopPropagation(),e.preventDefault(),r((e=>({counter:e.counter-1,dragging:!(e.counter<=1)&&e.dragging})))},o=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none",(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&(e.dataTransfer.dropEffect="copy"))},s=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(t(e.dataTransfer),r((e=>({dragging:!1,counter:e.counter-1}))))};return null==e||e.addEventListener("drop",s),null==e||e.addEventListener("dragover",o),null==e||e.addEventListener("dragenter",n),null==e||e.addEventListener("dragleave",i),()=>{null==e||e.removeEventListener("drop",s),null==e||e.removeEventListener("dragover",o),null==e||e.removeEventListener("dragenter",n),null==e||e.removeEventListener("dragleave",i)}}),[e,t]),i.dragging?o.createElement("div",{className:"mx_FileDropTarget"},o.createElement("img",{src:n("./node_modules/matrix-react-sdk/res/img/upload-big.svg").A,className:"mx_FileDropTarget_image",alt:""}),(0,C._t)("room|drop_file_prompt")):null};var au=n("./node_modules/matrix-react-sdk/src/dispatcher/payloads/ComposerInsertPayload.ts");function lu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function cu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lu(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class du extends o.Component{constructor(e,t){var n;super(e,t),(0,r.A)(this,"dispatcherRef",null),(0,r.A)(this,"layoutWatcherRef",void 0),(0,r.A)(this,"timelinePanel",(0,o.createRef)()),(0,r.A)(this,"card",(0,o.createRef)()),(0,r.A)(this,"eventId",void 0),(0,r.A)(this,"onAction",(e=>{switch(e.phase==$n.n.ThreadView&&e.event&&this.setupThread(e.event),e.action){case x.r.ComposerInsert:if(e.composerType)break;if(e.timelineRenderingType!==Zr.Ae.Thread)break;v.Ay.dispatch(cu(cu({},e),{},{composerType:this.state.editState?au.D.Edit:au.D.Send}));break;case x.r.EditEvent:if(e.timelineRenderingType!==Zr.Ae.Thread)return;if(e.event&&!e.event.getThread())return;this.setState({editState:e.event?new eu(e.event):void 0},(()=>{var t;e.event&&(null===(t=this.timelinePanel.current)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))}));break;case"reply_to_event":e.context===Zr.Ae.Thread&&this.setState({replyToEvent:e.event})}})),(0,r.A)(this,"setupThread",(e=>{const t=e.getId();let n=this.props.room.getThread(t);if(!n){const i=[];null===e.status&&i.push(e),n=this.props.room.createThread(t,e,i,!0)}this.updateThread(n)})),(0,r.A)(this,"onNewThread",(e=>{e.id===this.props.mxEvent.getId()&&this.setupThread(this.props.mxEvent)})),(0,r.A)(this,"updateThreadRelation",(()=>{this.setState({lastReply:this.threadLastReply})})),(0,r.A)(this,"updateThread",(e=>{this.state.thread!==e&&(this.setupThreadListeners(e,this.state.thread),e&&this.setState({thread:e,lastReply:this.threadLastReply},(async()=>this.postThreadUpdate(e))))})),(0,r.A)(this,"resetJumpToEvent",(e=>{var t,n;this.props.initialEvent&&this.props.initialEventScrollIntoView&&e===(null===(t=this.props.initialEvent)||void 0===t?void 0:t.getId())&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.props.room.roomId,event_id:null===(n=this.props.initialEvent)||void 0===n?void 0:n.getId(),highlighted:this.props.isInitialEventHighlighted,scroll_into_view:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0})})),(0,r.A)(this,"onMeasurement",(e=>{this.setState({narrow:e})})),(0,r.A)(this,"onKeyDown",(e=>{let t=!1;if((0,Se.zM)().getRoomAction(e)===Ee.bY.UploadFile)v.Ay.dispatch({action:"upload_file",context:Zr.Ae.Thread},!0),t=!0;t&&(e.stopPropagation(),e.preventDefault())})),(0,r.A)(this,"onFileDrop",(e=>{const t=this.props.mxEvent.getRoomId();t?No.Ay.sharedInstance().sendContentListToRoom(Array.from(e.files),t,this.threadRelation,h.J.safeGet(),Zr.Ae.Thread):console.warn("Unknwon roomId for event",this.props.mxEvent)})),(0,r.A)(this,"renderThreadViewHeader",(()=>o.createElement("div",{className:"mx_BaseCard_header_title"},o.createElement(Ii.A,{size:"4",className:"mx_BaseCard_header_title_heading"},(0,C._t)("common|thread")),o.createElement(ou,{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator})))),this.setEventId(this.props.mxEvent);const i=null!==(n=this.props.room.getThread(this.eventId))&&void 0!==n?n:void 0;this.setupThreadListeners(i),this.state={layout:O.A.getValue("layout"),narrow:!1,thread:i,lastReply:null==i?void 0:i.lastReply((e=>e.isRelation(s.THREAD_RELATION_TYPE.name)&&!e.status))},this.layoutWatcherRef=O.A.watchSetting("layout",null,((...[,,,e])=>this.setState({layout:e})))}componentDidMount(){this.state.thread&&this.postThreadUpdate(this.state.thread),this.setupThread(this.props.mxEvent),this.dispatcherRef=v.Ay.register(this.onAction),this.props.room.on(s.ThreadEvent.New,this.onNewThread)}componentWillUnmount(){var e;this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef);const t=this.props.mxEvent.getRoomId();O.A.unwatchSetting(this.layoutWatcherRef);const n=Xt.M.instance.roomViewStore.getRoomId()!==t;this.props.initialEvent&&!n&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.props.room.roomId,metricsTrigger:void 0}),v.Ay.dispatch({action:x.r.ViewThread,thread_id:null}),null===(e=this.state.thread)||void 0===e||e.off(s.ThreadEvent.NewReply,this.updateThreadRelation),this.props.room.off(s.RoomEvent.LocalEchoUpdated,this.updateThreadRelation),this.props.room.removeListener(s.ThreadEvent.New,this.onNewThread)}componentDidUpdate(e){e.mxEvent!==this.props.mxEvent&&(this.setEventId(this.props.mxEvent),this.setupThread(this.props.mxEvent)),e.room!==this.props.room&&qn.A.instance.setCard({phase:$n.n.RoomSummary})}setEventId(e){if(!e.getId())throw new Error("Got thread event without id");this.eventId=e.getId()}get threadLastReply(){var e,t;return null!==(e=null===(t=this.state.thread)||void 0===t?void 0:t.lastReply((e=>e.isRelation(s.THREAD_RELATION_TYPE.name)&&!e.status)))&&void 0!==e?e:void 0}async postThreadUpdate(e){var t,n;v.Ay.dispatch({action:x.r.ViewThread,thread_id:e.id}),e.emit(s.ThreadEvent.ViewThread),this.updateThreadRelation(),null===(t=this.timelinePanel.current)||void 0===t||t.refreshTimeline(null===(n=this.props.initialEvent)||void 0===n?void 0:n.getId())}setupThreadListeners(e,t){var n;t&&(null===(n=this.state.thread)||void 0===n||n.off(s.ThreadEvent.NewReply,this.updateThreadRelation),this.props.room.off(s.RoomEvent.LocalEchoUpdated,this.updateThreadRelation));e&&(e.on(s.ThreadEvent.NewReply,this.updateThreadRelation),this.props.room.on(s.RoomEvent.LocalEchoUpdated,this.updateThreadRelation))}get threadRelation(){var e,t,n,i;const r={rel_type:s.THREAD_RELATION_TYPE.name,event_id:null===(e=this.state.thread)||void 0===e?void 0:e.id,is_falling_back:!0},o=null!==(t=null===(n=this.state.lastReply)||void 0===n?void 0:n.getId())&&void 0!==t?t:null===(i=this.state.thread)||void 0===i?void 0:i.id;return o&&(r["m.in_reply_to"]={event_id:o}),r}render(){var e,t,n,i;const r=this.props.isInitialEventHighlighted?null===(e=this.props.initialEvent)||void 0===e?void 0:e.getId():void 0,s=this.threadRelation;let a;var c;this.state.thread?(this.props.initialEvent&&this.props.initialEvent.getRoomId()!==this.state.thread.roomId&&l.v.warn("ThreadView attempting to render TimelinePanel with mismatched initialEvent",this.state.thread.roomId,this.props.initialEvent.getRoomId(),this.props.initialEvent.getId()),a=o.createElement(o.Fragment,null,o.createElement(su,{parent:this.card.current,onFileDrop:this.onFileDrop}),o.createElement(pd,{key:this.state.thread.id,ref:this.timelinePanel,showReadReceipts:this.context.showReadReceipts,manageReadReceipts:!0,manageReadMarkers:!0,sendReadReceiptOnLoad:!0,timelineSet:this.state.thread.timelineSet,showUrlPreview:this.context.showUrlPreview,layout:this.state.layout===Us.P.Bubble?Us.P.Bubble:Us.P.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!0,className:"mx_RoomView_messagePanel",permalinkCreator:this.props.permalinkCreator,membersLoaded:!0,editState:this.state.editState,eventId:null===(c=this.props.initialEvent)||void 0===c?void 0:c.getId(),highlightedEventId:r,eventScrollIntoView:this.props.initialEventScrollIntoView,onEventScrolledIntoView:this.resetJumpToEvent}))):a=o.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},o.createElement(dn.A,null));return o.createElement(Zr.Ay.Provider,{value:cu(cu({},this.context),{},{timelineRenderingType:Zr.Ae.Thread,threadId:null===(t=this.state.thread)||void 0===t?void 0:t.id,liveTimeline:null===(n=this.state)||void 0===n||null===(n=n.thread)||void 0===n||null===(n=n.timelineSet)||void 0===n?void 0:n.getLiveTimeline(),narrow:this.state.narrow})},o.createElement(vs.A,{className:ee()("mx_ThreadView mx_ThreadPanel",{mx_ThreadView_narrow:this.state.narrow}),onClose:this.props.onClose,withoutScrollContainer:!0,header:this.renderThreadViewHeader(),ref:this.card,onKeyDown:this.onKeyDown,onBack:e=>{u.A.trackInteraction("WebThreadViewBackButton",e)}},this.card.current&&o.createElement(gd,{sensor:this.card.current,onMeasurement:this.onMeasurement}),o.createElement("div",{className:"mx_ThreadView_timelinePanelWrapper"},a),No.Ay.sharedInstance().getCurrentUploads(s).length>0&&o.createElement(nu,{room:this.props.room,relation:s}),(null===(i=this.state.thread)||void 0===i?void 0:i.timelineSet)&&o.createElement(Xd,{room:this.props.room,resizeNotifier:this.props.resizeNotifier,relation:s,replyToEvent:this.state.replyToEvent,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus,compact:!0})))}}function uu(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M7 10a.968.968 0 0 1-.713-.287A.968.968 0 0 1 6 9c0-.283.096-.52.287-.713A.968.968 0 0 1 7 8h10a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 17 10H7Zm0 4a.967.967 0 0 1-.713-.287A.968.968 0 0 1 6 13c0-.283.096-.52.287-.713A.967.967 0 0 1 7 12h6c.283 0 .52.096.713.287.191.192.287.43.287.713s-.096.52-.287.713A.968.968 0 0 1 13 14H7Z"}),(0,Oo.jsx)("path",{d:"M3.707 21.293c-.63.63-1.707.184-1.707-.707V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6l-2.293 2.293ZM6 17h14V5H4v13.172l.586-.586A2 2 0 0 1 6 17Z"})]})}(0,r.A)(du,"contextType",Zr.Ay),uu.displayName="ThreadsIcon";const mu=(0,o.forwardRef)(uu);var hu,pu;function gu(){return gu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gu.apply(null,arguments)}var vu=function(e,t){return o.createElement("svg",gu({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),hu||(hu=o.createElement("path",{stroke:"#656D77",strokeLinecap:"round",strokeWidth:1.5,d:"M1.75 2h12.5M1.75 6h12.5M1.75 10h6.5"})),pu||(pu=o.createElement("path",{stroke:"#656D77",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m6.172 13 2.121 2.121 5.657-5.657"})))},_u=(0,o.forwardRef)(vu);var fu=n("./node_modules/matrix-react-sdk/src/accessibility/context_menu/ContextMenuButton.tsx");function yu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Eu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yu(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let bu=function(e){return e[e.My=0]="My",e[e.All=1]="All",e}({});const wu=({label:e,description:t,onClick:n,isSelected:i})=>o.createElement(Me.sH,{active:i,className:"mx_ThreadPanel_Header_FilterOptionItem",onClick:n},o.createElement("span",null,e),o.createElement("span",null,t)),xu=({filterOption:e,setFilterOption:t})=>{const n=(0,Re.nH)(),i=(0,Zr.mP)(),[r,s,a,c]=(0,Me.EF)(),d=[{label:(0,C._t)("threads|all_threads"),description:(0,C._t)("threads|all_threads_description"),key:bu.All},{label:(0,C._t)("threads|my_threads"),description:(0,C._t)("threads|my_threads_description"),key:bu.My}],m=d.find((t=>t.key===e)),h=d.map((e=>o.createElement(wu,{key:e.key,label:e.label,description:e.description,onClick:()=>{t(e.key),c()},isSelected:e===m}))),p=r?o.createElement(Me.Ay,{top:108,right:33,onFinished:c,chevronFace:Me.t4.Top,wrapperClassName:"mx_BaseCard_header_title"},h):null,g=o.useCallback((e=>{u.A.trackInteraction("WebThreadsMarkAllReadButton",e),i.room?(0,Wn.G9)(i.room,n).catch((e=>{l.v.error("Failed to mark all threads read",e)})):l.v.error("No room in context to mark all threads read")}),[i.room,n]);return o.createElement("div",{className:"mx_BaseCard_header_title"},o.createElement(ke.m_,{label:(0,C._t)("threads|mark_all_read")},o.createElement(ke.K0,{onClick:g,"aria-label":(0,C._t)("threads|mark_all_read"),size:"24px"},o.createElement(_u,null))),o.createElement("div",{className:"mx_ThreadPanel_vertical_separator"}),o.createElement(fu.V,{className:"mx_ThreadPanel_dropdown",ref:s,isExpanded:r,onClick:e=>{a(),u.A.trackInteraction("WebRightPanelThreadPanelFilterDropdown",e)}},`${(0,C._t)("threads|show_thread_filter")} ${null==m?void 0:m.label}`),p)},Au=({roomId:e,onClose:t,permalinkCreator:n})=>{var i,r,a;const l=(0,o.useContext)(Re.Ay),c=(0,o.useContext)(Zr.Ay),d=(0,o.useRef)(null),u=(0,o.useRef)(null),m=(0,o.useRef)(null),[h,p]=(0,o.useState)(bu.All),[g,v]=(0,o.useState)(null),[_,f]=(0,o.useState)(!1),y=h===bu.My?null==g?void 0:g.threadsTimelineSets[1]:null==g?void 0:g.threadsTimelineSets[0],E=Boolean(null==g||null===(i=g.threadsTimelineSets)||void 0===i||null===(i=i[0])||void 0===i||null===(i=i.getLiveTimeline())||void 0===i||null===(i=i.getEvents())||void 0===i?void 0:i.length);return(0,o.useEffect)((()=>{const t=l.getRoom(e);null==t||t.createThreadsTimelineSets().then((()=>t.fetchRoomThreads())).then((()=>{p(bu.All),v(t)}))}),[l,e]),(0,o.useEffect)((()=>{var e;y&&!s.Thread.hasServerSideSupport&&(null===(e=d.current)||void 0===e||e.refreshTimeline())}),[y,d]),o.createElement(Zr.Ay.Provider,{value:Eu(Eu({},c),{},{timelineRenderingType:Zr.Ae.ThreadsList,showHiddenEvents:!0,narrow:_})},o.createElement(vs.A,{hideHeaderButtons:!0,header:E&&o.createElement(xu,{filterOption:h,setFilterOption:p}),id:"thread-panel",className:"mx_ThreadPanel",ariaLabelledBy:"thread-panel-tab",role:"tabpanel",onClose:t,withoutScrollContainer:!0,ref:u,closeButtonRef:m},u.current&&o.createElement(gd,{sensor:u.current,onMeasurement:f}),y?o.createElement(pd,{key:h+":"+(null!==(r=null===(a=y.getFilter())||void 0===a?void 0:a.filterId)&&void 0!==r?r:e),ref:d,showReadReceipts:!1,manageReadReceipts:!1,manageReadMarkers:!1,sendReadReceiptOnLoad:!1,timelineSet:y,showUrlPreview:!1,empty:o.createElement(vd,{Icon:mu,title:(0,C._t)("threads|empty_title"),description:(0,C._t)("threads|empty_description",{replyInThread:(0,C._t)("action|reply_in_thread")})}),alwaysShowTimestamps:!0,layout:Us.P.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!1,className:"mx_RoomView_messagePanel",membersLoaded:!0,permalinkCreator:n,disableGrouping:!0}):o.createElement("div",{className:"mx_AutoHideScrollbar"},o.createElement(dn.A,null))))};function Su(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M12 3c7 0 7 7 7 7v6l1.293 1.293c.63.63.184 1.707-.707 1.707H4.414c-.89 0-1.337-1.077-.707-1.707L5 16v-6s0-7 7-7Zm5 7.01v-.022l-.009-.146a6.591 6.591 0 0 0-.073-.607 6.608 6.608 0 0 0-.582-1.84c-.319-.638-.766-1.215-1.398-1.637C14.318 5.344 13.4 5 12 5c-1.4 0-2.317.344-2.937.758-.633.422-1.08.999-1.4 1.636a6.606 6.606 0 0 0-.58 1.841A6.596 6.596 0 0 0 7 9.988v6.84L6.828 17h10.344L17 16.828V10.01ZM12 22a2 2 0 0 1-2-2h4a2 2 0 0 1-2 2Z"})})}Su.displayName="NotificationsIcon";const Cu=(0,o.forwardRef)(Su);function ku(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ru(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ku(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ku(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Iu extends o.PureComponent{constructor(e,t){super(e,t),(0,r.A)(this,"card",o.createRef()),(0,r.A)(this,"onMeasurement",(e=>{this.setState({narrow:e})})),this.state={narrow:!1}}render(){const e=o.createElement(vd,{Icon:Cu,title:(0,C._t)("notif_panel|empty_heading"),description:(0,C._t)("notif_panel|empty_description")});let t;const n=h.J.safeGet().getNotifTimelineSet();return n?t=o.createElement(pd,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:n,showUrlPreview:!1,empty:e,alwaysShowTimestamps:!0,layout:Us.P.Group}):(l.v.error("No notifTimelineSet available!"),t=o.createElement(dn.A,null)),o.createElement(Zr.Ay.Provider,{value:Ru(Ru({},this.context),{},{timelineRenderingType:Zr.Ae.Notification,narrow:this.state.narrow})},o.createElement(vs.A,{header:o.createElement("div",{className:"mx_BaseCard_header_title"},o.createElement(Ii.A,{size:"4",className:"mx_BaseCard_header_title_heading"},(0,C._t)("notifications|enable_prompt_toast_title"))),className:"mx_ThreadPanel",onClose:this.props.onClose,withoutScrollContainer:!0},this.card.current&&o.createElement(gd,{sensor:this.card.current,onMeasurement:this.onMeasurement}),t))}}var Tu;function Pu(){return Pu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Pu.apply(null,arguments)}(0,r.A)(Iu,"contextType",Zr.Ay);var Nu=function(e,t){return o.createElement("svg",Pu({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Tu||(Tu=o.createElement("path",{d:"M12 16q1.875 0 3.188-1.313Q16.5 13.375 16.5 11.5t-1.313-3.188Q13.875 7.002 12 7q-1.875 0-3.187 1.313Q7.5 9.625 7.5 11.5t1.313 3.188Q10.125 16 12 16m0-1.8q-1.125 0-1.912-.787A2.6 2.6 0 0 1 9.3 11.5q0-1.125.787-1.912A2.6 2.6 0 0 1 12 8.8q1.125 0 1.912.787.788.789.788 1.913c0 1.124-.262 1.387-.787 1.912A2.6 2.6 0 0 1 12 14.2m0 4.8q-3.475 0-6.35-1.837Q2.775 15.324 1.3 12.2a.8.8 0 0 1-.1-.313 3 3 0 0 1 0-.774.8.8 0 0 1 .1-.313q1.475-3.125 4.35-4.963Q8.525 4.001 12 4t6.35 1.838q2.876 1.837 4.35 4.962a.8.8 0 0 1 .1.313 3 3 0 0 1 0 .774.8.8 0 0 1-.1.313q-1.474 3.125-4.35 4.963Q15.475 19 12 19m0-2a9.54 9.54 0 0 0 5.188-1.488A9.77 9.77 0 0 0 20.8 11.5a9.77 9.77 0 0 0-3.613-4.013A9.54 9.54 0 0 0 12 6a9.55 9.55 0 0 0-5.187 1.487A9.77 9.77 0 0 0 3.2 11.5a9.77 9.77 0 0 0 3.613 4.012A9.54 9.54 0 0 0 12 17"})))},Du=(0,o.forwardRef)(Nu);var Mu,Ou=n("./node_modules/@vector-im/compound-design-tokens/icons/unpin.svg");function Lu(){return Lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Lu.apply(null,arguments)}var Uu=function(e,t){return o.createElement("svg",Lu({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Mu||(Mu=o.createElement("path",{d:"M14.597 5.708a1.004 1.004 0 0 1 0-1.416.996.996 0 0 1 1.412 0l4.699 4.714c.39.39.39 1.025 0 1.416l-4.7 4.714a.996.996 0 0 1-1.411 0 1.004 1.004 0 0 1 0-1.416l3.043-3.054H8.487C6.599 10.666 5 12.27 5 14.333 5.002 16.396 6.6 18 8.488 18h2.093a1 1 0 1 1 0 2H8.487C5.42 20 3 17.425 3 14.333s2.42-5.666 5.486-5.666h9.059l-2.95-2.959Z"})))},Fu=(0,o.forwardRef)(Uu);var ju;function Bu(){return Bu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Bu.apply(null,arguments)}var Vu=function(e,t){return o.createElement("svg",Bu({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),ju||(ju=o.createElement("path",{d:"M6 14q-.824 0-1.412-.588A1.93 1.93 0 0 1 4 12q0-.825.588-1.412A1.93 1.93 0 0 1 6 10q.824 0 1.412.588Q8 11.175 8 12t-.588 1.412A1.93 1.93 0 0 1 6 14m6 0q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 12q0-.825.588-1.412A1.93 1.93 0 0 1 12 10q.825 0 1.412.588Q14 11.175 14 12t-.588 1.412A1.93 1.93 0 0 1 12 14m6 0q-.824 0-1.413-.588A1.93 1.93 0 0 1 16 12q0-.825.587-1.412A1.93 1.93 0 0 1 18 10q.824 0 1.413.588Q20 11.175 20 12t-.587 1.412A1.93 1.93 0 0 1 18 14"})))},Hu=(0,o.forwardRef)(Vu);var zu;function Wu(){return Wu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Wu.apply(null,arguments)}var Gu=function(e,t){return o.createElement("svg",Wu({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),zu||(zu=o.createElement("path",{d:"M7 21q-.824 0-1.412-.587A1.93 1.93 0 0 1 5 19V6a.97.97 0 0 1-.713-.287A.97.97 0 0 1 4 5q0-.424.287-.713A.97.97 0 0 1 5 4h4a.97.97 0 0 1 .287-.712A.97.97 0 0 1 10 3h4a.97.97 0 0 1 .713.288A.97.97 0 0 1 15 4h4a.97.97 0 0 1 .712.287Q20 4.575 20 5c0 .425-.096.52-.288.713A.97.97 0 0 1 19 6v13q0 .824-.587 1.413A1.93 1.93 0 0 1 17 21zM7 6v13h10V6zm2 10q0 .424.287.712Q9.575 17 10 17c.425 0 .52-.096.713-.288A.97.97 0 0 0 11 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 10 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 9 9zm4 0q0 .424.287.712.288.288.713.288c.425 0 .52-.096.713-.288A.97.97 0 0 0 15 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 14 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 13 9z"})))},Ku=(0,o.forwardRef)(Gu);var Ju,qu;function $u(){return $u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$u.apply(null,arguments)}var Yu=function(e,t){return o.createElement("svg",$u({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Ju||(Ju=o.createElement("path",{d:"M7 10a.97.97 0 0 1-.713-.287A.97.97 0 0 1 6 9q0-.424.287-.713A.97.97 0 0 1 7 8h10a.97.97 0 0 1 .712.287Q18 8.575 18 9c0 .425-.096.52-.288.713A.97.97 0 0 1 17 10zm0 4a.97.97 0 0 1-.713-.287A.97.97 0 0 1 6 13q0-.424.287-.713A.97.97 0 0 1 7 12h6q.424 0 .713.287.287.288.287.713c0 .425-.096.52-.287.713A.97.97 0 0 1 13 14z"})),qu||(qu=o.createElement("path",{d:"M3.707 21.293c-.63.63-1.707.184-1.707-.707V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6zM6 17h14V5H4v13.172l.586-.586A2 2 0 0 1 6 17"})))},Qu=(0,o.forwardRef)(Yu);var Zu=n("./node_modules/matrix-react-sdk/src/components/views/messages/MessageEvent.tsx"),Xu=n("./node_modules/matrix-react-sdk/src/events/forward/getForwardableEvent.ts"),em=(n("./node_modules/matrix-react-sdk/src/events/location/getShareableLocationEvent.ts"),n("./node_modules/matrix-react-sdk/src/components/views/dialogs/ConfirmRedactDialog.tsx"));const tm="32px";function nm({event:e,room:t,permalinkCreator:n}){var i,r;const s=e.getSender();if(!s)throw new Error("Pinned event unexpectedly has no sender");const a=Boolean(e.threadRootId),l=!e.isThreadRoot&&a;return o.createElement("div",{className:"mx_PinnedEventTile",role:"listitem"},o.createElement("div",null,o.createElement(Ws.A,{className:"mx_PinnedEventTile_senderAvatar",member:e.sender,size:tm,fallbackUserId:s})),o.createElement("div",{className:"mx_PinnedEventTile_wrapper"},o.createElement("div",{className:"mx_PinnedEventTile_top"},o.createElement(ke.m_,{label:(null===(i=e.sender)||void 0===i?void 0:i.name)||s},o.createElement("span",{className:ee()("mx_PinnedEventTile_sender",(0,ia.yJ)(s))},(null===(r=e.sender)||void 0===r?void 0:r.name)||s)),o.createElement(im,{event:e,room:t,permalinkCreator:n})),o.createElement(Zu.A,{mxEvent:e,maxImageHeight:150,onHeightChanged:()=>{},permalinkCreator:n,replacingEventId:e.replacingEventId()}),l&&o.createElement("div",{className:"mx_PinnedEventTile_thread"},o.createElement(Qu,null),(0,C._t)("right_panel|pinned_messages|reply_thread",{},{link:n=>o.createElement("button",{type:"button",onClick:()=>{if(!e.threadRootId)return;const n=t.findEventById(e.threadRootId);n&&v.Ay.dispatch({action:x.r.ShowThread,rootEvent:n,push:!0})}},n)}))))}function im({event:e,room:t,permalinkCreator:n}){var i;const[r,a]=(0,o.useState)(!1),l=(0,Re.nH)(),c=(0,o.useCallback)((()=>{u.A.trackInteraction("PinnedMessageListViewTimeline"),v.Ay.dispatch({action:x.r.ViewRoom,event_id:e.getId(),highlighted:!0,room_id:e.getRoomId(),metricsTrigger:void 0})}),[e]),d=(0,za.U)(t,(()=>il.A.canUnpin(l,e))),m=(0,o.useCallback)((async()=>{await il.A.pinOrUnpinEvent(l,e),u.A.trackPinUnpinMessage("Unpin","MessagePinningList")}),[e,l]),h=(0,Os.qe)(e)&&(0,Xu.e)(e,l),p=(0,o.useCallback)((()=>{h&&v.Ay.dispatch({action:x.r.OpenForwardDialog,event:h,permalinkCreator:n})}),[h,n]),g=(null===(i=t.getLiveTimeline().getState(s.EventTimeline.FORWARDS))||void 0===i?void 0:i.maySendRedactionForEvent(e,l.getSafeUserId()))&&e.getType()!==s.EventType.RoomServerAcl&&e.getType()!==s.EventType.RoomEncryption,_=(0,o.useCallback)((()=>(0,em.Q)({mxEvent:e})),[e]);return o.createElement(ke.W1,{open:r,onOpenChange:a,showTitle:!1,title:(0,C._t)("right_panel|pinned_messages|menu"),side:"right",align:"start",trigger:o.createElement(ke.K0,{size:"24px","aria-label":(0,C._t)("right_panel|pinned_messages|menu")},o.createElement(Hu,null))},o.createElement(ke.Dr,{Icon:Du,label:(0,C._t)("right_panel|pinned_messages|view"),onSelect:c}),d&&o.createElement(ke.Dr,{Icon:Ou.I,label:(0,C._t)("action|unpin"),onSelect:m}),h&&o.createElement(ke.Dr,{Icon:Fu,label:(0,C._t)("action|forward"),onSelect:p}),g&&o.createElement(o.Fragment,null,o.createElement(ke.wv,null),o.createElement(ke.Dr,{kind:"critical",Icon:Ku,label:(0,C._t)("action|delete"),onSelect:_})))}function rm({matrixClient:e,roomId:t,onFinished:n}){return o.createElement(cn.A,{hasCancel:!0,title:(0,C._t)("right_panel|pinned_messages|unpin_all|title"),titleClass:"mx_UnpinAllDialog_title",className:"mx_UnpinAllDialog",onFinished:n,fixedWidth:!1},o.createElement(ke.EY,{as:"span"},(0,C._t)("right_panel|pinned_messages|unpin_all|content")),o.createElement("div",{className:"mx_UnpinAllDialog_buttons"},o.createElement(ke.$n,{destructive:!0,onClick:async()=>{try{await il.A.unpinAllEvents(e,t),u.A.trackPinUnpinMessage("Unpin","UnpinAll")}catch(e){l.v.error("Failed to unpin all events:",e)}n()}},(0,C._t)("action|continue")),o.createElement(ke.$n,{kind:"tertiary",onClick:n},(0,C._t)("action|cancel"))))}function om(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function sm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?om(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):om(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function am({room:e,onClose:t,permalinkCreator:n}){const i=(0,Re.nH)(),r=(0,Zr.mP)(),s=ol(e),a=al(e),l=cl(e,s);let c;return(0,o.useEffect)((()=>{if(!i||i.isGuest())return;s.filter((e=>!a.has(e))).length>0&&i.setRoomAccountData(e.roomId,tl.M,{event_ids:s})}),[i,e.roomId,s,a]),c=s.length?null!=l&&l.length?o.createElement(lm,{events:(0,Pl.Bo)(l),room:e,permalinkCreator:n}):o.createElement(dn.A,null):o.createElement(vd,{Icon:Xo,title:(0,C._t)("right_panel|pinned_messages|empty_title"),description:(0,C._t)("right_panel|pinned_messages|empty_description",{pinAction:(0,C._t)("action|pin")})}),o.createElement(vs.A,{header:o.createElement("div",{className:"mx_BaseCard_header_title"},o.createElement(Ii.A,{size:"4",className:"mx_BaseCard_header_title_heading"},(0,C._t)("right_panel|pinned_messages|header",{count:s.length}))),className:"mx_PinnedMessagesCard",onClose:t},o.createElement(Zr.Ay.Provider,{value:sm(sm({},r),{},{timelineRenderingType:Zr.Ae.Pinned})},c))}function lm({events:e,room:t,permalinkCreator:n}){const i=(0,Re.nH)(),r=(0,za.U)(t,(()=>il.A.userHasPinOrUnpinPermission(i,t))),s=(0,o.useCallback)((async()=>{f.Ay.createDialog(rm,{roomId:t.roomId,matrixClient:i})}),[t,i]);return o.createElement(o.Fragment,null,o.createElement("div",{className:ee()("mx_PinnedMessagesCard_wrapper",{mx_PinnedMessagesCard_wrapper_unpin_all:r}),role:"list"},e.reverse().map(((i,r)=>o.createElement(o.Fragment,null,o.createElement(nm,{key:i.getId(),event:i,permalinkCreator:n,room:t}),e.length-1!==r&&o.createElement(ke.wv,{key:`separator-${i.getId()}`,className:"mx_PinnedMessagesCard_Separator"}))))),r&&o.createElement("div",{className:"mx_PinnedMessagesCard_unpin"},o.createElement(ke.$n,{kind:"tertiary",onClick:s},(0,C._t)("right_panel|pinned_messages|unpin_all|button"))))}const cm=e=>{const t=ee()({mx_JumpToBottomButton:!0,mx_JumpToBottomButton_highlight:e.highlight});let n;return e.numUnreadMessages&&(n=o.createElement("div",{className:"mx_JumpToBottomButton_badge"},e.numUnreadMessages)),o.createElement("div",{className:t},o.createElement(be.A,{className:"mx_JumpToBottomButton_scrollDown",title:(0,C._t)("room|jump_to_bottom_button"),onClick:e.onScrollToBottomClick}),n)};function dm(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function um(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dm(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dm(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class mm extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"layoutWatcherRef",void 0),(0,r.A)(this,"timelinePanel",o.createRef()),(0,r.A)(this,"card",o.createRef()),(0,r.A)(this,"readReceiptsSettingWatcher",void 0),(0,r.A)(this,"onRoomViewStoreUpdate",(async e=>{const t={initialEventId:Xt.M.instance.roomViewStore.getInitialEventId(),isInitialEventHighlighted:Xt.M.instance.roomViewStore.isInitialEventHighlighted(),replyToEvent:Xt.M.instance.roomViewStore.getQuotingEvent()};this.setState(t)})),(0,r.A)(this,"onAction",(e=>{if(e.action===x.r.EditEvent)this.setState({editState:e.event?new eu(e.event):void 0},(()=>{var t;e.event&&(null===(t=this.timelinePanel.current)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))}))})),(0,r.A)(this,"onScroll",(()=>{const e=this.timelinePanel.current;e&&(e.isAtEndOfLiveTimeline()?this.setState({atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.state.initialEventId&&this.state.isInitialEventHighlighted&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.props.room.roomId,event_id:this.state.initialEventId,highlighted:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0}))})),(0,r.A)(this,"onMeasurement",(e=>{this.setState({narrow:e})})),(0,r.A)(this,"jumpToLiveTimeline",(()=>{var e;this.state.initialEventId&&this.state.isInitialEventHighlighted?v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.props.room.roomId}):(null===(e=this.timelinePanel.current)||void 0===e||e.jumpToLiveTimeline(),v.Ay.fire(x.r.FocusSendMessageComposer))})),(0,r.A)(this,"renderTimelineCardHeader",(()=>o.createElement("div",{className:"mx_BaseCard_header_title"},o.createElement(Ii.A,{size:"4",className:"mx_BaseCard_header_title_heading"},(0,C._t)("right_panel|video_room_chat|title"))))),this.state={showReadReceipts:O.A.getValue("showReadReceipts",e.room.roomId),layout:O.A.getValue("layout"),atEndOfLiveTimeline:!0,narrow:!1}}componentDidMount(){Xt.M.instance.roomViewStore.addListener(A.H,this.onRoomViewStoreUpdate),this.dispatcherRef=v.Ay.register(this.onAction),this.readReceiptsSettingWatcher=O.A.watchSetting("showReadReceipts",null,((...[,,,e])=>this.setState({showReadReceipts:e}))),this.layoutWatcherRef=O.A.watchSetting("layout",null,((...[,,,e])=>this.setState({layout:e})))}componentWillUnmount(){Xt.M.instance.roomViewStore.removeListener(A.H,this.onRoomViewStoreUpdate),this.readReceiptsSettingWatcher&&O.A.unwatchSetting(this.readReceiptsSettingWatcher),this.layoutWatcherRef&&O.A.unwatchSetting(this.layoutWatcherRef),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef)}render(){var e,t;const n=this.state.isInitialEventHighlighted?this.state.initialEventId:void 0;let i;this.state.atEndOfLiveTimeline||(i=o.createElement(cm,{highlight:this.props.room.getUnreadNotificationCount(s.NotificationCountType.Highlight)>0,onScrollToBottomClick:this.jumpToLiveTimeline}));const r=No.Ay.sharedInstance().getCurrentUploads(this.props.composerRelation).length>0,a=this.props.room.getMyMembership()===We.O.Join;return o.createElement(Zr.Ay.Provider,{value:um(um({},this.context),{},{timelineRenderingType:null!==(e=this.props.timelineRenderingType)&&void 0!==e?e:this.context.timelineRenderingType,liveTimeline:null===(t=this.props.timelineSet)||void 0===t?void 0:t.getLiveTimeline(),narrow:this.state.narrow})},o.createElement(vs.A,{className:this.props.classNames,onClose:this.props.onClose,withoutScrollContainer:!0,header:this.renderTimelineCardHeader(),ref:this.card},this.card.current&&o.createElement(gd,{sensor:this.card.current,onMeasurement:this.onMeasurement}),o.createElement("div",{className:"mx_TimelineCard_timeline"},i,o.createElement(pd,{ref:this.timelinePanel,showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!0,manageReadMarkers:!1,sendReadReceiptOnLoad:!0,timelineSet:this.props.timelineSet,showUrlPreview:this.context.showUrlPreview,layout:this.state.layout===Us.P.Bubble?Us.P.Bubble:Us.P.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!0,className:"mx_RoomView_messagePanel",permalinkCreator:this.props.permalinkCreator,membersLoaded:!0,editState:this.state.editState,eventId:this.state.initialEventId,resizeNotifier:this.props.resizeNotifier,highlightedEventId:n,onScroll:this.onScroll})),r&&o.createElement(nu,{room:this.props.room,relation:this.props.composerRelation}),a&&o.createElement(Xd,{room:this.props.room,relation:this.props.composerRelation,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus,compact:!0})))}}(0,r.A)(mm,"contextType",Zr.Ay);const hm=({phase:e,room:t})=>{const n=(0,o.useRef)(null);(0,Te.F)(v.Ay,(e=>{var t;e.action===x.r.FocusThreadsPanel&&(null===(t=n.current)||void 0===t||t.focus())}));const i=(0,el.u)(t);return function(e){const t=[$n.n.RoomSummary,$n.n.RoomMemberList,$n.n.ThreadPanel,$n.n.Extensions];return!!e&&t.includes(e)}(e)?o.createElement(ke.jq,{className:"mx_RightPanelTabs","aria-label":"right panel",role:"tablist"},o.createElement(ke.jl,{"aria-controls":"room-summary-panel",id:"room-summary-panel-tab",onClick:()=>{qn.A.instance.pushCard({phase:$n.n.RoomSummary},!0)},active:e===$n.n.RoomSummary},(0,C._t)("right_panel|info")),o.createElement(ke.jl,{"aria-controls":"memberlist-panel",id:"memberlist-panel-tab",onClick:e=>{qn.A.instance.pushCard({phase:$n.n.RoomMemberList},!0),u.A.trackInteraction("WebRightPanelRoomInfoPeopleButton",e)},active:e===$n.n.RoomMemberList},(0,C._t)("common|people")),o.createElement(ke.jl,{"aria-controls":"thread-panel",id:"thread-panel-tab",onClick:()=>{qn.A.instance.pushCard({phase:$n.n.ThreadPanel},!0)},active:e===$n.n.ThreadPanel,ref:n},(0,C._t)("common|threads")),O.A.getValue(W.f.Widgets)&&!i&&(0,Ie.g)(W.C.AddIntegrations)&&o.createElement(ke.jl,{"aria-controls":"thread-panel",id:"extensions-panel-tab",onClick:()=>{qn.A.instance.pushCard({phase:$n.n.Extensions},!0)},active:e===$n.n.Extensions},(0,C._t)("common|extensions"))):null};var pm;function gm(){return gm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gm.apply(null,arguments)}var vm=function(e,t){return o.createElement("svg",gm({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),pm||(pm=o.createElement("path",{d:"M11 13H6a.97.97 0 0 1-.713-.287A.97.97 0 0 1 5 12q0-.424.287-.713A.97.97 0 0 1 6 11h5V6q0-.424.287-.713A.97.97 0 0 1 12 5q.424 0 .713.287Q13 5.575 13 6v5h5a.97.97 0 0 1 .712.287Q19 11.575 19 12c0 .425-.096.52-.288.713A.97.97 0 0 1 18 13h-5v5a.97.97 0 0 1-.287.712A.97.97 0 0 1 12 19a.97.97 0 0 1-.713-.288A.97.97 0 0 1 11 18z"})))},_m=(0,o.forwardRef)(vm);var fm;function ym(){return ym=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ym.apply(null,arguments)}var Em=function(e,t){return o.createElement("svg",ym({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),fm||(fm=o.createElement("path",{d:"M17.25 11.672a.9.9 0 0 1-.663-.282L12.61 7.413a.9.9 0 0 1-.282-.663q0-.381.282-.663l3.977-3.977a.9.9 0 0 1 .663-.282q.381 0 .663.282l3.977 3.977a.9.9 0 0 1 .282.663.9.9 0 0 1-.282.663l-3.977 3.977a.9.9 0 0 1-.663.282m2.475-4.922L17.25 4.275 14.775 6.75l2.475 2.475zM4 11a.97.97 0 0 1-.712-.287A.97.97 0 0 1 3 10V4q0-.424.288-.712A.97.97 0 0 1 4 3h6a.97.97 0 0 1 .713.288A.97.97 0 0 1 11 4v6q0 .424-.287.713A.97.97 0 0 1 10 11zm5-2V5H5v4zm5 12a.97.97 0 0 1-.713-.288A.97.97 0 0 1 13 20v-6q0-.424.287-.713A.97.97 0 0 1 14 13h6a.97.97 0 0 1 .712.287Q21 13.575 21 14v6q0 .424-.288.712A.97.97 0 0 1 20 21zm5-2v-4h-4v4zM4 21a.97.97 0 0 1-.712-.288A.97.97 0 0 1 3 20v-6a.97.97 0 0 1 .288-.713A.97.97 0 0 1 4 13h6q.424 0 .713.287.287.288.287.713v6a.97.97 0 0 1-.287.712A.97.97 0 0 1 10 21zm5-2v-4H5v4z"})))},bm=(0,o.forwardRef)(Em);const wm=({app:e,room:t})=>{const n=vl.A.getWidgetName(e),[i,r]=(0,o.useState)();(0,o.useEffect)((()=>{r(vl.A.canUserModifyWidgets(t.client,t.roomId))}),[t.client,t.roomId]);const s=hc.aK.instance.isInContainer(t,e,hc.mc.Top),a=s?()=>{hc.aK.instance.moveToContainer(t,e,hc.mc.Right)}:()=>{hc.aK.instance.moveToContainer(t,e,hc.mc.Top)},[l,c,d,u]=(0,Me.EF)();let m;if(l){var h,p,g;const t=null===(h=c.current)||void 0===h?void 0:h.getBoundingClientRect(),n=null!==(p=null==t?void 0:t.right)&&void 0!==p?p:0,i=null!==(g=null==t?void 0:t.top)&&void 0!==g?g:0;m=o.createElement(Ac,{chevronFace:Me.t4.None,right:Ce.A.instance.windowWidth-n,bottom:Ce.A.instance.windowHeight-i,onFinished:u,app:e})}const v=!s&&!hc.aK.instance.canAddToContainer(t,hc.mc.Top);let _;_=v?(0,C._t)("right_panel|pinned_messages|limits",{count:hc.yQ}):s?(0,C._t)("action|unpin"):(0,C._t)("action|pin");const f=hc.aK.instance.isInContainer(t,e,hc.mc.Center);let y="";s?y=(0,C._t)("widget|unpin_to_view_right_panel"):f&&(y=(0,C._t)("widget|close_to_view_right_panel"));const E=ee()("mx_BaseCard_Button mx_ExtensionsCard_Button",{mx_ExtensionsCard_Button_pinned:s});return o.createElement("div",{className:E,ref:c},o.createElement(be.A,{className:"mx_ExtensionsCard_icon_app",onClick:()=>{qn.A.instance.pushCard({phase:$n.n.Widget,state:{widgetId:e.id}})},title:s||f?y:void 0,disabled:s||f},o.createElement(Cc,{app:e,size:"24px"}),o.createElement(ke.EY,{size:"md",weight:"medium",className:"mx_lineClamp"},n)),i&&o.createElement(Me.oW,{className:"mx_ExtensionsCard_app_options",isExpanded:l,onClick:d,title:(0,C._t)("common|options")}),o.createElement(be.A,{className:"mx_ExtensionsCard_app_pinToggle",onClick:a,title:_,disabled:v}),m)},xm=({room:e,onClose:t})=>{const n=(0,vl.X)(e),i=(0,o.useMemo)((()=>n.filter((e=>void 0!==e.eventId))),[n]),r=o.createElement(ke.$n,{size:"sm",onClick:()=>{const t=Yl.J.sharedInstance();var n;t.hasManager()?null===(n=t.getPrimaryManager())||void 0===n||n.open(e):t.openNoManagerDialog()},kind:"secondary",Icon:_m},(0,C._t)("right_panel|add_integrations"));let s;if(i.length<1)s=o.createElement(vd,{Icon:bm,title:(0,C._t)("right_panel|extensions_empty_title"),description:(0,C._t)("right_panel|extensions_empty_description",{addIntegrations:(0,C._t)("right_panel|add_integrations")})});else{let t=null;hc.aK.instance.canCopyLayoutToRoom(e)&&(t=o.createElement(ke.N_,{onClick:()=>hc.aK.instance.copyLayoutToRoom(e)},(0,C._t)("widget|set_room_layout"))),s=o.createElement(o.Fragment,null,o.createElement(ke.wv,null),i.map((t=>o.createElement(wm,{key:t.id,app:t,room:e}))),t)}return o.createElement(vs.A,{header:r,className:"mx_ExtensionsCard",onClose:t,hideHeaderButtons:!0},s)};function Am(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}class Sm extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"delayedUpdate",(0,c.throttle)((()=>{this.forceUpdate()}),500,{leading:!0,trailing:!0})),(0,r.A)(this,"onRoomStateMember",((e,t,n)=>{var i;this.props.room&&n.roomId===this.props.room.roomId&&(this.state.phase===$n.n.RoomMemberList||this.state.phase===$n.n.RoomMemberInfo&&n.userId===(null===(i=this.state.cardState)||void 0===i||null===(i=i.member)||void 0===i?void 0:i.userId))&&this.delayedUpdate()})),(0,r.A)(this,"onRightPanelStoreUpdate",(()=>{this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Am(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Am(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Sm.getDerivedStateFromProps(this.props)))})),(0,r.A)(this,"onClose",(()=>{var e,t;if(null!==(e=this.props.overwriteCard)&&void 0!==e&&null!==(e=e.state)&&void 0!==e&&e.member)v.Ay.dispatch({action:x.r.ViewHomePage});else if(this.state.phase===$n.n.EncryptionPanel&&null!==(t=this.state.cardState)&&void 0!==t&&null!==(t=t.verificationRequest)&&void 0!==t&&t.pending)this.state.cardState.verificationRequest.cancel();else{var n,i;qn.A.instance.togglePanel(null!==(n=null===(i=this.props.room)||void 0===i?void 0:i.roomId)&&void 0!==n?n:null)}})),(0,r.A)(this,"onSearchQueryChanged",(e=>{this.setState({searchQuery:e})})),this.state={searchQuery:""}}componentDidMount(){this.context.on(s.RoomStateEvent.Members,this.onRoomStateMember),qn.A.instance.on(A.H,this.onRightPanelStoreUpdate)}componentWillUnmount(){var e;null===(e=this.context)||void 0===e||e.removeListener(s.RoomStateEvent.Members,this.onRoomStateMember),qn.A.instance.off(A.H,this.onRightPanelStoreUpdate)}static getDerivedStateFromProps(e){var t,n,i;let r;return e.room&&(r=qn.A.instance.currentCardForRoom(e.room.roomId)),{cardState:null===(t=r)||void 0===t?void 0:t.state,phase:null!==(n=null===(i=r)||void 0===i?void 0:i.phase)&&void 0!==n?n:void 0}}render(){var e,t,n,i,r;let a=o.createElement("div",null);const l=null===(e=this.props.room)||void 0===e?void 0:e.roomId,c=null!==(t=null===(n=this.props.overwriteCard)||void 0===n?void 0:n.phase)&&void 0!==t?t:this.state.phase,d=null!==(i=null===(r=this.props.overwriteCard)||void 0===r?void 0:r.state)&&void 0!==i?i:this.state.cardState;switch(c){case $n.n.RoomMemberList:l&&(a=o.createElement(td,{roomId:l,key:l,hideHeaderButtons:!0,onClose:this.onClose,searchQuery:this.state.searchQuery,onSearchQueryChanged:this.onSearchQueryChanged}));break;case $n.n.SpaceMemberList:var u,m;if(null!=d&&d.spaceId||l)a=o.createElement(td,{roomId:null!==(u=null==d?void 0:d.spaceId)&&void 0!==u?u:l,key:null!==(m=null==d?void 0:d.spaceId)&&void 0!==m?m:l,onClose:this.onClose,searchQuery:this.state.searchQuery,onSearchQueryChanged:this.onSearchQueryChanged});break;case $n.n.RoomMemberInfo:case $n.n.SpaceMemberInfo:case $n.n.EncryptionPanel:if(null!=d&&d.member){var h;const e=d.member instanceof s.RoomMember?d.member:void 0;a=o.createElement(nd.Ay,{user:d.member,room:null!==(h=this.context.getRoom(null==e?void 0:e.roomId))&&void 0!==h?h:this.props.room,key:null!=l?l:d.member.userId,onClose:this.onClose,phase:c,verificationRequest:d.verificationRequest,verificationRequestPromise:d.verificationRequestPromise})}break;case $n.n.Room3pidMemberInfo:case $n.n.Space3pidMemberInfo:null!=d&&d.memberInfoEvent&&(a=o.createElement(id,{event:d.memberInfoEvent,key:l,onClose:this.onClose}));break;case $n.n.NotificationPanel:a=o.createElement(Iu,{onClose:this.onClose});break;case $n.n.PinnedMessages:this.props.room&&O.A.getValue("feature_pinning")&&(a=o.createElement(am,{room:this.props.room,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator}));break;case $n.n.Timeline:this.props.room&&(a=o.createElement(mm,{classNames:"mx_ThreadPanel mx_TimelineCard",room:this.props.room,timelineSet:this.props.room.getUnfilteredTimelineSet(),resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus}));break;case $n.n.FilePanel:l&&(a=o.createElement(Ed,{roomId:l,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose}));break;case $n.n.ThreadView:this.props.room&&null!=d&&d.threadHeadEvent&&(a=o.createElement(du,{room:this.props.room,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,mxEvent:d.threadHeadEvent,initialEvent:d.initialEvent,isInitialEventHighlighted:d.isInitialEventHighlighted,initialEventScrollIntoView:d.initialEventScrollIntoView,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus}));break;case $n.n.ThreadPanel:this.props.room&&(a=o.createElement(Au,{roomId:this.props.room.roomId,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator}));break;case $n.n.RoomSummary:this.props.room&&(a=o.createElement(pl,{room:this.props.room,permalinkCreator:this.props.permalinkCreator,onSearchChange:this.props.onSearchChange,onSearchCancel:this.props.onSearchCancel,focusRoomSearch:null==d?void 0:d.focusRoomSearch}));break;case $n.n.Extensions:this.props.room&&(a=o.createElement(xm,{room:this.props.room,onClose:this.onClose}));break;case $n.n.Widget:this.props.room&&null!=d&&d.widgetId&&(a=o.createElement(zc,{room:this.props.room,widgetId:d.widgetId,onClose:this.onClose}))}return o.createElement("aside",{className:"mx_RightPanel",id:"mx_RightPanel"},c&&o.createElement(hm,{room:this.props.room,phase:c}),a)}}(0,r.A)(Sm,"contextType",Re.Ay);class Cm{constructor(){(0,r.A)(this,"scrollStateMap",new Map)}getScrollState(e){return this.scrollStateMap.get(e)}setScrollState(e,t){null===t?this.scrollStateMap.delete(e):this.scrollStateMap.set(e,t)}}void 0===window.mxRoomScrollStateStore&&(window.mxRoomScrollStateStore=new Cm);const km=window.mxRoomScrollStateStore;var Rm=n("./node_modules/matrix-react-sdk/src/stores/WidgetEchoStore.ts"),Im=n("./node_modules/@matrix-org/react-sdk-module-api/lib/lifecycles/RoomViewLifecycle.js"),Tm=n("./node_modules/matrix-react-sdk/src/IdentityAuthClient.tsx");class Pm extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"onViewClick",(()=>{this.setState({hidden:!1})})),this.state={hidden:!0}}render(){const e=ee()({mx_InviteReason:!0,mx_InviteReason_hidden:this.state.hidden});return o.createElement("div",{className:e},o.createElement("div",{className:"mx_InviteReason_reason"},this.props.htmlReason?(0,Ga.bk)(this.props.htmlReason):this.props.reason),o.createElement(be.A,{kind:"link_inline",className:"mx_InviteReason_view",onClick:this.onViewClick},(0,C._t)("common|view_message")))}}var Nm=n("./node_modules/matrix-react-sdk/res/img/element-icons/ask-to-join.svg");var Dm=function(e){return e.NotLoggedIn="NotLoggedIn",e.Joining="Joining",e.Loading="Loading",e.Rejecting="Rejecting",e.Kicked="Kicked",e.Banned="Banned",e.OtherThreePIDError="OtherThreePIDError",e.InvitedEmailNotFoundInAccount="InvitedEmailNotFoundInAccount",e.InvitedEmailNoIdentityServer="InvitedEmailNoIdentityServer",e.InvitedEmailMismatch="InvitedEmailMismatch",e.Invite="Invite",e.ViewingRoom="ViewingRoom",e.RoomNotFound="RoomNotFound",e.OtherError="OtherError",e.PromptAskToJoin="PromptAskToJoin",e.Knocked="Knocked",e.RequestDenied="requestDenied",e}(Dm||{});class Mm extends o.Component{constructor(e){super(e),(0,r.A)(this,"onLoginClick",(()=>{v.Ay.dispatch({action:"start_login",screenAfterLogin:this.makeScreenAfterLogin()})})),(0,r.A)(this,"onRegisterClick",(()=>{v.Ay.dispatch({action:"start_registration",screenAfterLogin:this.makeScreenAfterLogin()})})),(0,r.A)(this,"onChangeReason",(e=>{this.setState({reason:e.target.value})})),this.state={busy:!1}}componentDidMount(){this.checkInvitedEmail()}componentDidUpdate(e,t){this.props.invitedEmail===e.invitedEmail&&this.props.inviterName===e.inviterName||this.checkInvitedEmail()}async checkInvitedEmail(){if(this.props.inviterName&&this.props.invitedEmail){this.setState({busy:!0});try{const e=await h.J.safeGet().getThreePids();if(this.setState({accountEmails:e.threepids.filter((e=>"email"===e.medium)).map((e=>e.address))}),!h.J.safeGet().getIdentityServerUrl())return void this.setState({busy:!1});const t=new Tm.A,n=await t.getAccessToken(),i=await h.J.safeGet().lookupThreePid("email",this.props.invitedEmail,n);if(!("mxid"in i))throw new C.P7("room|error_3pid_invite_email_lookup");this.setState({invitedEmailMxid:i.mxid})}catch(e){this.setState({threePidFetchError:e})}this.setState({busy:!1})}}getMessageCase(){if(h.J.safeGet().isGuest())return Dm.NotLoggedIn;const e=this.getMyMember();if(e){var t;const n=null===(t=e.events.member)||void 0===t?void 0:t.getPrevContent().membership;if(e.isKicked())return n===We.O.Knock?Dm.RequestDenied:this.props.promptAskToJoin?Dm.PromptAskToJoin:Dm.Kicked;if(e.membership===We.O.Ban)return Dm.Banned}if(this.props.joining)return Dm.Joining;if(this.props.rejecting)return Dm.Rejecting;if(this.props.loading||this.state.busy)return Dm.Loading;if(this.props.knocked)return Dm.Knocked;if(this.props.canAskToJoinAndMembershipIsLeave||this.props.promptAskToJoin)return Dm.PromptAskToJoin;if(this.props.inviterName){if(this.props.invitedEmail){if(this.state.threePidFetchError)return Dm.OtherThreePIDError;if(this.state.accountEmails&&!this.state.accountEmails.includes(this.props.invitedEmail))return Dm.InvitedEmailNotFoundInAccount;if(!h.J.safeGet().getIdentityServerUrl())return Dm.InvitedEmailNoIdentityServer;if(this.state.invitedEmailMxid!=h.J.safeGet().getUserId())return Dm.InvitedEmailMismatch}return Dm.Invite}return this.props.error?"M_NOT_FOUND"==this.props.error.errcode?Dm.RoomNotFound:Dm.OtherError:Dm.ViewingRoom}getKickOrBanInfo(){var e,t,n,i;const r=this.getMyMember();if(!r)return{};const o=null===(e=r.events.member)||void 0===e?void 0:e.getSender(),s=o?null===(t=this.props.room)||void 0===t?void 0:t.currentState.getMember(o):void 0;return{memberName:null!==(n=null==s?void 0:s.name)&&void 0!==n?n:o,reason:null===(i=r.events.member)||void 0===i?void 0:i.getContent().reason}}joinRule(){var e,t;return null!==(e=null===(t=this.props.room)||void 0===t||null===(t=t.currentState.getStateEvents(s.EventType.RoomJoinRules,""))||void 0===t?void 0:t.getContent().join_rule)&&void 0!==e?e:null}getMyMember(){var e,t;return null!==(e=null===(t=this.props.room)||void 0===t?void 0:t.getMember(h.J.safeGet().getSafeUserId()))&&void 0!==e?e:null}getInviteMember(){var e;const{room:t}=this.props;if(!t)return null;const n=h.J.safeGet().getSafeUserId(),i=t.currentState.getMember(n);if(!i)return null;const r=null===(e=i.events.member)||void 0===e?void 0:e.getSender();return r?t.currentState.getMember(r):null}isDMInvite(){var e;const t=this.getMyMember();if(!t)return!1;const n=null===(e=t.events.member)||void 0===e?void 0:e.getContent();return(null==n?void 0:n.membership)===We.O.Invite&&n.is_direct}makeScreenAfterLogin(){var e,t,n,i,r,o;return{screen:"room",params:{email:this.props.invitedEmail,signurl:this.props.signUrl,room_name:null!==(e=null===(t=this.props.oobData)||void 0===t?void 0:t.name)&&void 0!==e?e:null,room_avatar_url:null!==(n=null===(i=this.props.oobData)||void 0===i?void 0:i.avatarUrl)&&void 0!==n?n:null,inviter_name:null!==(r=null===(o=this.props.oobData)||void 0===o?void 0:o.inviterName)&&void 0!==r?r:null}}}render(){var e,t,n,i,r,a;const l=g.Ay.get().brand,c=null!==(e=null!==(t=null===(n=this.props.room)||void 0===n?void 0:n.name)&&void 0!==t?t:this.props.roomAlias)&&void 0!==e?e:"",d=null!==(i=null===(r=this.props.room)||void 0===r?void 0:r.isSpaceRoom())&&void 0!==i?i:(null===(a=this.props.oobData)||void 0===a?void 0:a.roomType)===s.RoomType.Space;let u,m,p,v,_,f,y,E,b=!1;const w=[],x=this.getMessageCase();switch(x){case Dm.Joining:var A;u=null!==(A=this.props.oobData)&&void 0!==A&&A.roomType||d?d?(0,C._t)("room|joining_space"):(0,C._t)("room|joining_room"):(0,C._t)("room|joining"),b=!0;break;case Dm.Loading:u=(0,C._t)("common|loading"),b=!0;break;case Dm.Rejecting:u=(0,C._t)("room|rejecting"),b=!0;break;case Dm.NotLoggedIn:{const e={canJoin:!1};this.props.roomId&&Gl.r.instance.invoke(Im.RoomViewLifecycle.PreviewRoomNotLoggedIn,e,this.props.roomId),e.canJoin?(u=(0,C._t)("room|join_title"),_=(0,C._t)("action|join"),v=()=>{Gl.r.instance.invoke(Im.RoomViewLifecycle.JoinFromRoomPreview,this.props.roomId)}):(u=(0,C._t)("room|join_title_account"),O.A.getValue(W.f.Registration)&&(_=(0,C._t)("room|join_button_account"),v=this.onRegisterClick),y=(0,C._t)("action|sign_in"),f=this.onLoginClick),this.props.previewLoading&&(E=o.createElement("div",null,o.createElement(dn.A,{w:20,h:20}),(0,C._t)("room|loading_preview")));break}case Dm.Kicked:{const{memberName:e,reason:t}=this.getKickOrBanInfo();u=c?(0,C._t)("room|kicked_from_room_by",{memberName:e,roomName:c}):(0,C._t)("room|kicked_by",{memberName:e}),m=t?(0,C._t)("room|kick_reason",{reason:t}):void 0,_=d?(0,C._t)("room|forget_space"):(0,C._t)("room|forget_room"),v=this.props.onForgetClick,this.joinRule()!==s.JoinRule.Invite&&(y=_,f=v,_=(0,C._t)("room|rejoin_button"),v=this.props.onJoinClick);break}case Dm.RequestDenied:u=(0,C._t)("room|knock_denied_title"),m=(0,C._t)("room|knock_denied_subtitle"),_=d?(0,C._t)("room|forget_space"):(0,C._t)("room|forget_room"),v=this.props.onForgetClick;break;case Dm.Banned:{const{memberName:e,reason:t}=this.getKickOrBanInfo();u=c?(0,C._t)("room|banned_from_room_by",{memberName:e,roomName:c}):(0,C._t)("room|banned_by",{memberName:e}),m=t?(0,C._t)("room|kick_reason",{reason:t}):void 0,_=d?(0,C._t)("room|forget_space"):(0,C._t)("room|forget_room"),v=this.props.onForgetClick;break}case Dm.OtherThreePIDError:{var S;u=c?(0,C._t)("room|3pid_invite_error_title_room",{roomName:c}):(0,C._t)("room|3pid_invite_error_title");const e=this.joinRule(),t=(0,C._t)("room|3pid_invite_error_description",{errcode:(null===(S=this.state.threePidFetchError)||void 0===S?void 0:S.errcode)||(0,C._t)("error|unknown_error_code")});switch(e){case"invite":m=[(0,C._t)("room|3pid_invite_error_invite_subtitle"),t],_=(0,C._t)("room|3pid_invite_error_invite_action"),v=this.props.onJoinClick;break;case"public":m=(0,C._t)("room|3pid_invite_error_public_subtitle"),_=(0,C._t)("room|join_the_discussion"),v=this.props.onJoinClick;break;default:m=t,_=(0,C._t)("room|3pid_invite_error_invite_action"),v=this.props.onJoinClick}break}case Dm.InvitedEmailNotFoundInAccount:u=c?(0,C._t)("room|3pid_invite_email_not_found_account_room",{roomName:c,email:this.props.invitedEmail}):(0,C._t)("room|3pid_invite_email_not_found_account",{email:this.props.invitedEmail}),m=(0,C._t)("room|link_email_to_receive_3pid_invite",{brand:l}),_=(0,C._t)("room|join_the_discussion"),v=this.props.onJoinClick;break;case Dm.InvitedEmailNoIdentityServer:u=c?(0,C._t)("room|invite_sent_to_email_room",{roomName:c,email:this.props.invitedEmail}):(0,C._t)("room|invite_sent_to_email",{email:this.props.invitedEmail}),m=(0,C._t)("room|3pid_invite_no_is_subtitle",{brand:l}),_=(0,C._t)("room|join_the_discussion"),v=this.props.onJoinClick;break;case Dm.InvitedEmailMismatch:u=c?(0,C._t)("room|invite_sent_to_email_room",{roomName:c,email:this.props.invitedEmail}):(0,C._t)("room|invite_sent_to_email",{email:this.props.invitedEmail}),m=(0,C._t)("room|invite_email_mismatch_suggestion",{brand:l}),_=(0,C._t)("room|join_the_discussion"),v=this.props.onJoinClick;break;case Dm.Invite:{var k,R,I;const e=this.isDMInvite(),t=o.createElement(Ge.A,{room:this.props.room,oobData:this.props.oobData}),n=this.getInviteMember(),i=o.createElement("span",{className:"mx_RoomPreviewBar_inviter"},null!==(k=null==n?void 0:n.rawDisplayName)&&void 0!==k?k:this.props.inviterName),r=o.createElement(o.Fragment,null,e?(0,C._t)("room|dm_invite_subtitle",{},{userName:i}):(0,C._t)("room|invite_subtitle",{},{userName:i}),n&&o.createElement(o.Fragment,null,o.createElement("br",null),o.createElement("span",{className:"mx_RoomPreviewBar_inviter_mxid"},n.userId)));var T;if(e)u=(0,C._t)("room|dm_invite_title",{user:null!==(T=null==n?void 0:n.name)&&void 0!==T?T:this.props.inviterName}),_=(0,C._t)("room|dm_invite_action");else u=(0,C._t)("room|invite_title",{roomName:c}),_=(0,C._t)("action|accept");m=[t,r];const s=h.J.safeGet().getSafeUserId(),a=null===(R=this.props.room)||void 0===R?void 0:R.currentState.getMember(s),l=null==a||null===(I=a.events.member)||void 0===I?void 0:I.getContent();null!=l&&l.reason&&(p=o.createElement(Pm,{reason:l.reason,htmlReason:l["io.element.html_reason"]})),v=this.props.onJoinClick,y=(0,C._t)("action|reject"),f=this.props.onRejectClick,this.props.onRejectAndIgnoreClick&&w.push(o.createElement(be.A,{kind:"secondary",onClick:this.props.onRejectAndIgnoreClick,key:"ignore"},(0,C._t)("room|invite_reject_ignore")));break}case Dm.ViewingRoom:u=this.props.canPreview?(0,C._t)("room|peek_join_prompt",{roomName:c}):c?(0,C._t)("room|no_peek_join_prompt",{roomName:c}):(0,C._t)("room|no_peek_no_name_join_prompt"),_=(0,C._t)("room|join_the_discussion"),v=this.props.onJoinClick;break;case Dm.RoomNotFound:u=c?(0,C._t)("room|not_found_title_name",{roomName:c}):(0,C._t)("room|not_found_title"),m=(0,C._t)("room|not_found_subtitle");break;case Dm.OtherError:var P;u=c?(0,C._t)("room|inaccessible_name",{roomName:c}):(0,C._t)("room|inaccessible"),m=[(0,C._t)("room|inaccessible_subtitle_1"),(0,C._t)("room|inaccessible_subtitle_2",{errcode:String(null===(P=this.props.error)||void 0===P?void 0:P.errcode)},{issueLink:e=>o.createElement("a",{href:g.Ay.get().feedback.new_issue_url,target:"_blank",rel:"noreferrer noopener"},e)})];break;case Dm.PromptAskToJoin:var N;u=c?(0,C._t)("room|knock_prompt_name",{roomName:c}):(0,C._t)("room|knock_prompt");m=[o.createElement(Ge.A,{room:this.props.room,oobData:this.props.oobData}),(0,C._t)("room|knock_subtitle")],p=o.createElement(tn.A,{autoFocus:!0,className:"mx_RoomPreviewBar_fullWidth",element:"textarea",onChange:this.onChangeReason,placeholder:(0,C._t)("room|knock_message_field_placeholder"),type:"text",value:null!==(N=this.state.reason)&&void 0!==N?N:""}),v=()=>this.props.onSubmitAskToJoin&&this.props.onSubmitAskToJoin(this.state.reason),_=(0,C._t)("room|knock_send_action");break;case Dm.Knocked:u=(0,C._t)("room|knock_sent"),m=[o.createElement(o.Fragment,null,o.createElement(Nm.I,{className:"mx_Icon mx_Icon_16 mx_RoomPreviewBar_icon"}),(0,C._t)("room|knock_sent_subtitle"))],f=this.props.onCancelAskToJoin,y=(0,C._t)("room|knock_cancel_action")}let D,M,L,U;m&&(Array.isArray(m)||(m=[m]),D=m.map(((e,t)=>o.createElement("p",{key:`subTitle${t}`},e)))),M=b?o.createElement("h3",{className:"mx_RoomPreviewBar_spinnerTitle"},o.createElement(dn.A,null),u):o.createElement("h3",null,u),v&&(L=o.createElement(be.A,{kind:"primary",onClick:v},_)),f&&(U=o.createElement(be.A,{kind:"secondary",onClick:f},y));const F=this.props.canPreview,j=ee()("mx_RoomPreviewBar",`mx_RoomPreviewBar_${x}`,{mx_RoomPreviewBar_panel:F,mx_RoomPreviewBar_dialog:!F}),B=F?o.createElement(o.Fragment,null,U,w,L):o.createElement(o.Fragment,null,L,w,U);return o.createElement("div",{role:"complementary",className:j},o.createElement("div",{className:"mx_RoomPreviewBar_message"},M,D),p,o.createElement("div",{className:ee()("mx_RoomPreviewBar_actions",{mx_RoomPreviewBar_fullWidth:x===Dm.PromptAskToJoin})},B),o.createElement("div",{className:"mx_RoomPreviewBar_footer"},E))}}(0,r.A)(Mm,"defaultProps",{onJoinClick(){}});var Om=n("./node_modules/matrix-react-sdk/src/utils/membership.ts");const Lm=(e,t=250)=>{const[n,i]=(0,o.useState)(e.getJoinedMembers()),r=(0,o.useMemo)((()=>(0,c.throttle)((()=>{i(e.getJoinedMembers())}),t,{leading:!0,trailing:!0})),[e,t]);return(0,Pe.YK)(e.currentState,s.RoomStateEvent.Members,r),n},Um=(e,{throttleWait:t}={throttleWait:250})=>{const[n,i]=(0,o.useState)(e.getJoinedMemberCount()),r=(0,o.useMemo)((()=>(0,c.throttle)((()=>{i(e.getJoinedMemberCount())}),t,{leading:!0,trailing:!0})),[e,t]);return(0,Pe.YK)(e.currentState,s.RoomStateEvent.Members,r),(0,Pe.YK)(e,s.RoomEvent.Summary,r),n},Fm=e=>{const[t,n]=(0,o.useState)(e.getMyMembership());return(0,Pe.YK)(e,s.RoomEvent.MyMembership,(()=>{n(e.getMyMembership())})),t};var jm=n("./node_modules/matrix-react-sdk/src/components/views/elements/FacePile.tsx");const Bm=["room","onlyKnownUsers","numShown"],Vm=5,Hm=e=>{var t;return!(null===(t=Ti.A.shared().getDMRoomsForUserId(e.userId))||void 0===t||!t.length)},zm=e=>{let{room:t,onlyKnownUsers:n=!0,numShown:r=Vm}=e,s=(0,Ue.A)(e,Bm);const a=(0,o.useContext)(Re.Ay),l=t.getMyMembership()===We.O.Join;let d=Lm(t);const u=d.length,m=[e=>e.getMxcAvatarUrl()?0:1];n?d=d.filter(Hm):m.unshift((e=>Hm(e)?0:1));const h=(0,c.sortBy)(d.filter((e=>e.userId!==a.getUserId())),m).slice(0,r);if(h.length<1)return null;const p=h.map((e=>e.name)).reverse().join(", ");return o.createElement(jm.A,(0,i.A)({members:h,size:"28px",overflow:d.length>r,tooltipLabel:s.onClick?(0,C._t)("room|face_pile_tooltip_label",{count:u}):(0,C._t)("common|n_members",{count:u}),tooltipShortcut:l?(0,C._t)("room|face_pile_tooltip_shortcut_joined",{commaSeparatedMembers:p}):(0,C._t)("room|face_pile_tooltip_shortcut",{commaSeparatedMembers:p})},s),n&&o.createElement("span",{className:"mx_FacePile_summary"},(0,C._t)("room|face_pile_summary",{count:d.length})))},Wm=({room:e})=>{const t=(0,nl.e)((async()=>{if(e.getMyMembership()!==We.O.Invite)return null;try{return await e.client.getRoomSummary(e.roomId)}catch(e){return null}}),[e]),n=(0,za.U)(e,(e=>e.getJoinRule())),i=Fm(e),r=Um(e);let a,l,c;if((0,el.u)(e,!0)?(a="mx_RoomInfoLine_video",l=(0,C._t)("common|video_room")):n===s.JoinRule.Public?(a="mx_RoomInfoLine_public",l=e.isSpaceRoom()?(0,C._t)("common|public_space"):(0,C._t)("common|public_room")):(a="mx_RoomInfoLine_private",l=e.isSpaceRoom()?(0,C._t)("common|private_space"):(0,C._t)("common|private_room")),i===We.O.Invite&&t)c=o.createElement("span",{className:"mx_RoomInfoLine_members"},(0,C._t)("common|n_members",{count:t.num_joined_members}));else if(r&&void 0!==t){const t=()=>qn.A.instance.setCard({phase:e.isSpaceRoom()?$n.n.SpaceMemberList:$n.n.RoomMemberList});c=o.createElement(be.A,{kind:"link",className:"mx_RoomInfoLine_members",onClick:t},(0,C._t)("common|n_members",{count:r}))}return o.createElement("div",{className:`mx_RoomInfoLine ${a}`},l,c)},Gm=({room:e,onJoinButtonClicked:t,onRejectButtonClicked:n})=>{const i=(0,o.useContext)(Re.Ay),r=(0,Ne.ny)("feature_video_rooms"),a=(0,el.u)(e,!0),l=Fm(e);(0,Te.F)(v.Ay,(t=>{t.action===x.r.JoinRoomError&&t.roomId===e.roomId&&d(!1)}));const[c,d]=(0,o.useState)(!1),u=(0,za.U)(e,(e=>e.getJoinRule())),m=(0,Om.Cs)(l)===Om._T.Leave&&u!==s.JoinRule.Public,h=()=>v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Labs});let p,g,_=null;if(l===We.O.Join)p=o.createElement(be.A,{kind:"danger_outline",onClick:()=>{v.Ay.dispatch({action:"leave_room",room_id:e.roomId})}},(0,C._t)("action|leave"));else if(l===We.O.Invite){var f;const r=null===(f=e.getMember(i.getUserId()))||void 0===f||null===(f=f.events.member)||void 0===f?void 0:f.getSender();if(r){const t=e.getMember(r);_=o.createElement("div",{className:"mx_RoomPreviewCard_inviter"},o.createElement(Ws.A,{member:t,fallbackUserId:r,size:"32px"}),o.createElement("div",null,o.createElement("div",{className:"mx_RoomPreviewCard_inviter_name"},(0,C._t)("room|invites_you_text",{},{inviter:()=>o.createElement("b",null,(null==t?void 0:t.name)||r)})),t?o.createElement("div",{className:"mx_RoomPreviewCard_inviter_mxid"},r):null))}p=o.createElement(o.Fragment,null,o.createElement(be.A,{kind:"primary_outline",onClick:()=>{d(!0),n()}},(0,C._t)("action|reject")),o.createElement(be.A,{kind:"primary",onClick:()=>{d(!0),t()}},(0,C._t)("action|accept")))}else p=o.createElement(be.A,{kind:"primary",onClick:()=>{t(),i.isGuest()||d(!0)},disabled:m},(0,C._t)("action|join"));c&&(p=o.createElement(Ve.A,null)),g=a?o.createElement(o.Fragment,null,o.createElement(Ge.A,{room:e,size:"50px",viewAvatarOnClick:!0}),o.createElement("div",{className:"mx_RoomPreviewCard_video"}),o.createElement(Oe.s,{onClick:h,tooltipTitle:(0,C._t)("labs|video_rooms_beta")})):e.isSpaceRoom()?o.createElement(Ge.A,{room:e,size:"80px",viewAvatarOnClick:!0}):o.createElement(Ge.A,{room:e,size:"50px",viewAvatarOnClick:!0});let y=null;return m?y=(0,C._t)("room|join_failed_needs_invite",{roomName:e.name}):a&&!r&&(y=l===We.O.Join?(0,C._t)("room|view_failed_enable_video_rooms"):(0,C._t)("room|join_failed_enable_video_rooms"),p=o.createElement(be.A,{kind:"primary",onClick:h},(0,C._t)("room|show_labs_settings"))),o.createElement("div",{className:"mx_RoomPreviewCard"},_,o.createElement("div",{className:"mx_RoomPreviewCard_avatar"},g),o.createElement("h1",{className:"mx_RoomPreviewCard_name"},o.createElement(ys.A,{room:e})),o.createElement(Wm,{room:e}),o.createElement(Xa,{room:e,className:"mx_RoomPreviewCard_topic"}),"public"===e.getJoinRule()&&o.createElement(zm,{room:e}),y?o.createElement("div",{className:"mx_RoomPreviewCard_notice"},y):null,o.createElement("div",{className:"mx_RoomPreviewCard_joinButtons"},p))};var Km=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/RoomUpgradeDialog.tsx");class Jm extends o.PureComponent{constructor(e,t){super(e,t),(0,r.A)(this,"onStateEvents",(e=>{if(!this.props.room||e.getRoomId()!==this.props.room.roomId)return;if("m.room.tombstone"!==e.getType())return;const t=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.setState({upgraded:t&&t.getContent().replacement_room})})),(0,r.A)(this,"onUpgradeClick",(()=>{f.Ay.createDialog(Km.A,{room:this.props.room})}));const n=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.state={upgraded:null==n?void 0:n.getContent().replacement_room}}componentDidMount(){this.context.on(s.RoomStateEvent.Events,this.onStateEvents)}componentWillUnmount(){this.context.removeListener(s.RoomStateEvent.Events,this.onStateEvents)}render(){let e=o.createElement("div",null,o.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},o.createElement("p",null,(0,C._t)("room|upgrade_warning_bar")),o.createElement("p",null,(0,C._t)("room_settings|advanced|room_upgrade_warning",{},{b:e=>o.createElement("b",null,e),i:e=>o.createElement("i",null,e)}))),o.createElement("p",{className:"mx_RoomUpgradeWarningBar_upgradelink"},o.createElement(be.A,{onClick:this.onUpgradeClick},(0,C._t)("room_settings|advanced|room_upgrade_button"))));return this.state.upgraded&&(e=o.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},o.createElement("p",null,(0,C._t)("room|upgrade_warning_bar_upgraded")))),o.createElement("div",{className:"mx_RoomUpgradeWarningBar"},o.createElement("div",{className:"mx_RoomUpgradeWarningBar_wrapped"},o.createElement("div",{className:"mx_RoomUpgradeWarningBar_header"},(0,C._t)("room|upgrade_warning_bar_unstable",{},{roomVersion:()=>o.createElement("code",null,this.props.room.getVersion()),i:e=>o.createElement("i",null,e)})),e,o.createElement("div",{className:"mx_RoomUpgradeWarningBar_small"},(0,C._t)("room|upgrade_warning_bar_admins"))))}}(0,r.A)(Jm,"contextType",Re.Ay);var qm=function(e){return e.CloseScalar="close_scalar",e.GetWidgets="get_widgets",e.SetWidget="set_widget",e.JoinRulesState="join_rules_state",e.SetPlumbingState="set_plumbing_state",e.GetMembershipCount="get_membership_count",e.GetRoomEncryptionState="get_room_enc_state",e.CanSendEvent="can_send_event",e.MembershipState="membership_state",e.invite="invite",e.Kick="kick",e.BotOptions="bot_options",e.SetBotOptions="set_bot_options",e.SetBotPower="set_bot_power",e.GetOpenIdToken="get_open_id_token",e.SendEvent="send_event",e.ReadEvents="read_events",e}(qm||{});function $m(e,t){const n=(0,Ol.ZV)(e.data);n.response=t,e.source.postMessage(n,e.origin)}function Ym(e,t,n){l.v.error("Action:"+e.data.action+" failed with message: "+t);const i=(0,Ol.ZV)(e.data);i.response={error:{message:t}},n&&(i.response.error._error=n),e.source.postMessage(i,e.origin)}function Qm(e,t){const n=h.J.safeGet(),i=e.data.widget_id;let r=e.data.type;const o=e.data.url,s=e.data.name,a=e.data.data,l=e.data.avatar_url,c=e.data.userWidget;if(i&&void 0!==o){if(null!==o){if(void 0!==s&&"string"!=typeof s)return void Ym(e,(0,C._t)("scalar|error_create"),new Error("Optional field 'name' must be a string."));if(void 0!==a&&!(a instanceof Object))return void Ym(e,(0,C._t)("scalar|error_create"),new Error("Optional field 'data' must be an Object."));if(void 0!==l&&"string"!=typeof l)return void Ym(e,(0,C._t)("scalar|error_create"),new Error("Optional field 'avatar_url' must be a string."));if("string"!=typeof r)return void Ym(e,(0,C._t)("scalar|error_create"),new Error("Field 'type' must be a string."));if("string"!=typeof o)return void Ym(e,(0,C._t)("scalar|error_create"),new Error("Field 'url' must be a string or null."))}if(r=Tl.x.fromString(r),c)vl.A.setUserWidget(n,i,r,o,s,a).then((()=>{$m(e,{success:!0}),v.Ay.dispatch({action:"user_widget_updated"})})).catch((t=>{Ym(e,(0,C._t)("scalar|error_create"),t)}));else{if(!t)return void Ym(e,(0,C._t)("scalar|error_missing_room_id"));vl.A.setRoomWidget(n,t,i,r,o,s,a,l).then((()=>{$m(e,{success:!0})}),(t=>{Ym(e,(0,C._t)("scalar|error_send_request"),t)}))}}else Ym(e,(0,C._t)("scalar|error_create"),new Error("Missing required widget fields."))}function Zm(e,t){const n=h.J.get();if(!n)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));let i=[];if(t){const r=n.getRoom(t);if(!r)return void Ym(e,(0,C._t)("scalar|error_room_unknown"));i=vl.A.getRoomWidgets(r).map((e=>e.event))}const r=vl.A.getUserWidgetsArray(n);i=i.concat(r),$m(e,i)}function Xm(e,t,n,i){const r=h.J.get();if(!r)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));const o=r.getRoom(t);if(!o)return void Ym(e,(0,C._t)("scalar|error_room_unknown"));const s=o.currentState.getStateEvents(n,i);$m(e,s?s.getContent():null)}const eh=function(e){let t,n;e.origin||(e.origin=e.originalEvent.origin);try{var i;th||(th=null===(i=Yl.J.sharedInstance().getPrimaryManager())||void 0===i?void 0:i.uiUrl),t=new URL(th)}catch(e){return}try{n=new URL(e.origin)}catch(e){return}if(t.origin!==n.origin||!e.data.action||e.data.api)return;if(e.data.action===qm.CloseScalar)return v.Ay.dispatch({action:qm.CloseScalar}),void $m(e,null);const r=e.data.room_id,o=e.data.user_id;if(!r)return e.data.action===qm.GetWidgets?void Zm(e,null):e.data.action===qm.SetWidget?void Qm(e,null):e.data.action===qm.GetOpenIdToken?void async function(e){try{$m(e,await h.J.safeGet().getOpenIdToken())}catch(t){l.v.warn("Unable to fetch openId token.",t),Ym(e,"Unable to fetch openId token.")}}(e):void Ym(e,(0,C._t)("scalar|error_missing_room_id_request"));if(r===Xt.M.instance.roomViewStore.getRoomId())if(e.data.action!==qm.GetWidgets)if(e.data.action!==qm.SetWidget)if(e.data.action!==qm.JoinRulesState)if(e.data.action!==qm.SetPlumbingState)if(e.data.action!==qm.GetMembershipCount)if(e.data.action!==qm.GetRoomEncryptionState)if(e.data.action!==qm.CanSendEvent)if(e.data.action!==qm.SendEvent)if(e.data.action!==qm.ReadEvents)if(o)switch(e.data.action){case qm.MembershipState:!function(e,t,n){l.v.log(`membership_state of ${n} in room ${t} requested.`),Xm(e,t,"m.room.member",n)}(e,r,o);break;case qm.invite:!function(e,t,n){l.v.log(`Received request to invite ${n} into room ${t}`);const i=h.J.get();if(!i)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));const r=i.getRoom(t);if(r){const t=r.getMember(n);if(t&&[We.O.Join,We.O.Invite].includes(t.membership))return void $m(e,{success:!0})}i.invite(t,n).then((function(){$m(e,{success:!0})}),(function(t){Ym(e,(0,C._t)("widget|error_need_invite_permission"),t)}))}(e,r,o);break;case qm.Kick:!function(e,t,n){l.v.log(`Received request to kick ${n} from room ${t}`);const i=h.J.get();if(!i)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));const r=i.getRoom(t);if(r){const t=r.getMember(n);if(!t||(0,Om.Cs)(t.membership)===Om._T.Leave)return void $m(e,{success:!0})}const o=e.data.reason;i.kick(t,n,o).then((()=>{$m(e,{success:!0})})).catch((t=>{Ym(e,(0,C._t)("widget|error_need_kick_permission"),t)}))}(e,r,o);break;case qm.BotOptions:!function(e,t,n){l.v.log(`bot_options of ${n} in room ${t} requested.`),Xm(e,t,"m.room.bot.options","_"+n)}(e,r,o);break;case qm.SetBotOptions:!function(e,t,n){l.v.log(`Received request to set options for bot ${n} in room ${t}`);const i=h.J.get();i?i.sendStateEvent(t,"m.room.bot.options",e.data.content,"_"+n).then((()=>{$m(e,{success:!0})}),(t=>{Ym(e,t.message?t.message:(0,C._t)("scalar|error_send_request"),t)})):Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"))}(e,r,o);break;case qm.SetBotPower:!async function(e,t,n,i,r){if(!(Number.isInteger(i)&&i>=0))return void Ym(e,(0,C._t)("scalar|error_power_level_invalid"));l.v.log(`Received request to set power level to ${i} for bot ${n} in room ${t}.`);const o=h.J.get();if(o)try{const l=await o.getStateEvent(t,"m.room.power_levels","");var s,a,c;if(!0===r)if((null!==(s=null!==(a=null===(c=l.users)||void 0===c?void 0:c[n])&&void 0!==a?a:l.users_default)&&void 0!==s?s:0)>=i)return $m(e,{success:!0});return await o.setPowerLevel(t,n,i),$m(e,{success:!0})}catch(t){var d;const n=t instanceof Error?t:void 0;Ym(e,null!==(d=null==n?void 0:n.message)&&void 0!==d?d:(0,C._t)("scalar|error_send_request"),n)}else Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"))}(e,r,o,e.data.level,e.data.ignoreIfGreater);break;default:l.v.warn("Unhandled postMessage event with action '"+e.data.action+"'")}else Ym(e,(0,C._t)("scalar|error_missing_user_id_request"));else!async function(e,t){const n=e.data.type,i=e.data.state_key,r=e.data.limit;if("string"!=typeof n)return void Ym(e,(0,C._t)("scalar|failed_read_event"),new Error("Invalid 'type' in request"));if(!["m.room.power_levels","m.room.encryption","m.room.member","m.room.name","m.widgets","im.vector.modular.widgets","io.element.integrations.installations"].includes(n))return void Ym(e,(0,C._t)("scalar|failed_read_event"),new Error("Disallowed 'type' in request"));let o;if(void 0!==r){if("number"!=typeof r||r<0)return void Ym(e,(0,C._t)("scalar|failed_read_event"),new Error("Invalid 'limit' in request"));o=Math.min(r,Number.MAX_SAFE_INTEGER)}else o=Number.MAX_SAFE_INTEGER;const s=h.J.get();if(!s)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));const a=s.getRoom(t);if(a){if(void 0!==i){if("string"!=typeof i&&!0!==i)return void Ym(e,(0,C._t)("scalar|failed_read_event"),new Error("Invalid 'state_key' in request"));const t=!0===i?void 0:i;let r=[];return r=r.concat(a.currentState.getStateEvents(n,t)||[]),r=r.slice(0,o),void $m(e,{events:r.map((e=>e.getEffectiveEvent()))})}Ym(e,(0,C._t)("scalar|failed_read_event"),new Error("Reading message events is not implemented"))}else Ym(e,(0,C._t)("scalar|error_room_unknown"))}(e,r);else!async function(e,t){const n=e.data.type,i=e.data.state_key,r=e.data.content;if("string"!=typeof n)return void Ym(e,(0,C._t)("scalar|failed_send_event"),new Error("Invalid 'type' in request"));if(!["m.widgets","im.vector.modular.widgets","io.element.integrations.installations"].includes(n))return void Ym(e,(0,C._t)("scalar|failed_send_event"),new Error("Disallowed 'type' in request"));if(!r||"object"!=typeof r)return void Ym(e,(0,C._t)("scalar|failed_send_event"),new Error("Invalid 'content' in request"));const o=h.J.get();if(!o)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));if(o.getRoom(t))if(void 0!==i)try{$m(e,{room_id:t,event_id:(await o.sendStateEvent(t,n,r,i)).event_id})}catch(t){return void Ym(e,(0,C._t)("scalar|failed_send_event"),t)}else Ym(e,(0,C._t)("scalar|failed_send_event"),new Error("Sending message events is not implemented"));else Ym(e,(0,C._t)("scalar|error_room_unknown"))}(e,r);else!function(e,t){const n=""+e.data.event_type,i=Boolean(e.data.is_state),r=h.J.get();if(!r)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));const o=r.getRoom(t);if(!o)return void Ym(e,(0,C._t)("scalar|error_room_unknown"));if(o.getMyMembership()!==We.O.Join)return void Ym(e,(0,C._t)("scalar|error_membership"));const s=r.credentials.userId;let a;a=i?o.currentState.maySendStateEvent(n,s):o.currentState.maySendEvent(n,s),a?$m(e,!0):Ym(e,(0,C._t)("scalar|error_permission"))}(e,r);else!function(e,t){const n=h.J.get();if(!n)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));if(!n.getRoom(t))return void Ym(e,(0,C._t)("scalar|error_room_unknown"));$m(e,h.J.safeGet().isRoomEncrypted(t))}(e,r);else!function(e,t){const n=h.J.get();if(!n)return void Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"));const i=n.getRoom(t);if(!i)return void Ym(e,(0,C._t)("scalar|error_room_unknown"));$m(e,i.getJoinedMemberCount())}(e,r);else!function(e,t,n){if("string"!=typeof n)throw new Error("Plumbing state status should be a string");l.v.log(`Received request to set plumbing state to status "${n}" in room ${t}`);const i=h.J.get();i?i.sendStateEvent(t,"m.room.plumbing",{status:n}).then((()=>{$m(e,{success:!0})}),(t=>{Ym(e,t.message?t.message:(0,C._t)("scalar|error_send_request"),t)})):Ym(e,(0,C._t)("widget|error_need_to_be_logged_in"))}(e,r,e.data.status);else!function(e,t){l.v.log(`join_rules of ${t} requested.`),Xm(e,t,"m.room.join_rules","")}(e,r);else Qm(e,r);else Zm(e,r);else Ym(e,(0,C._t)("scalar|error_room_not_visible",{roomId:r}))};let th,nh=0;class ih extends ae{start(e){this.vertical?e.style.minHeight="":e.style.minWidth=""}finish(e){const t=e.offsetParent;if(t)if(this.vertical){const n=(e.offsetHeight/t.offsetHeight*100).toFixed(2)+"%";e.style.minHeight=n,e.style.height=n}else{const n=(e.offsetWidth/t.offsetWidth*100).toFixed(2)+"%";e.style.minWidth=n,e.style.width=n}}}class rh extends ce{static createSizer(e,t,n){return new ih(e,t,n)}}var oh=n("./node_modules/matrix-react-sdk/src/utils/numbers.ts");class sh extends o.Component{constructor(e){super(e),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"resizeContainer",void 0),(0,r.A)(this,"resizer",void 0),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"onIsResizing",(e=>{this.setState({resizingVertical:e}),e||this.relaxResizer()})),(0,r.A)(this,"collectResizer",(e=>{this.resizeContainer&&this.resizer.detach(),e&&(this.resizer.container=e,this.resizer.attach()),this.resizeContainer=e,this.loadResizerPreferences()})),(0,r.A)(this,"getAppsHash",(e=>e.map((e=>e.id)).join("~"))),(0,r.A)(this,"relaxResizer",(()=>{const e=this.resizer.getDistributors();e.forEach((e=>e.start())),e.forEach((e=>e.finish()))})),(0,r.A)(this,"loadResizerPreferences",(()=>{const e=hc.aK.instance.getResizerDistributions(this.props.room,hc.mc.Top);if(this.state.apps&&this.topApps().length-1===e.length)e.forEach(((e,t)=>{const n=this.resizer.forHandleAt(t);n&&(n.size=e,n.finish())}));else if(this.state.apps){const e=this.resizer.getDistributors();e.forEach((e=>e.item.clearSize())),e.forEach((e=>e.start())),e.forEach((e=>e.finish()))}})),(0,r.A)(this,"onAction",(e=>{const t=this.props.room.roomId+"_hide_widget_drawer";if("appsDrawer"===e.action)e.show?localStorage.setItem(t,"false"):localStorage.setItem(t,"true")})),(0,r.A)(this,"getApps",(()=>({[hc.mc.Top]:hc.aK.instance.getContainerWidgets(this.props.room,hc.mc.Top),[hc.mc.Center]:hc.aK.instance.getContainerWidgets(this.props.room,hc.mc.Center)}))),(0,r.A)(this,"topApps",(()=>this.state.apps[hc.mc.Top])),(0,r.A)(this,"centerApps",(()=>this.state.apps[hc.mc.Center])),(0,r.A)(this,"updateApps",(()=>{this.unmounted||this.setState({apps:this.getApps()})})),this.state={apps:this.getApps(),resizingVertical:!1,resizingHorizontal:!1,resizing:!1},this.resizer=this.createResizer(),this.props.resizeNotifier.on("isResizing",this.onIsResizing)}componentDidMount(){0===nh&&window.addEventListener("message",eh,!1),nh+=1,hc.aK.instance.on(hc.aK.emissionForRoom(this.props.room),this.updateApps),this.dispatcherRef=v.Ay.register(this.onAction)}componentWillUnmount(){this.unmounted=!0,function(){if(nh-=1,0===nh&&window.removeEventListener("message",eh),nh<0){const e=new Error("ScalarMessaging: mismatched startListening / stopListening detected. Negative count");l.v.error(e)}}(),hc.aK.instance.off(hc.aK.emissionForRoom(this.props.room),this.updateApps),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef),this.resizeContainer&&this.resizer.detach(),this.props.resizeNotifier.off("isResizing",this.onIsResizing)}createResizer(){const e=new me(null,rh,{onResizeStart:()=>{var e;null===(e=this.resizeContainer)||void 0===e||e.classList.add("mx_AppsDrawer--resizing"),this.setState({resizingHorizontal:!0})},onResizeStop:()=>{var e;null===(e=this.resizeContainer)||void 0===e||e.classList.remove("mx_AppsDrawer--resizing"),hc.aK.instance.setResizerDistributions(this.props.room,hc.mc.Top,this.topApps().slice(1).map(((e,t)=>this.resizer.forHandleAt(t).size))),this.setState({resizingHorizontal:!1})}});return e.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle--vertical",reverse:"mx_ResizeHandle_reverse"}),e}componentDidUpdate(e,t){e.userId!==this.props.userId||e.room!==this.props.room?this.updateApps():this.getAppsHash(this.topApps())!==this.getAppsHash(t.apps[hc.mc.Top])&&this.loadResizerPreferences()}isResizing(){return this.state.resizingVertical||this.state.resizingHorizontal}render(){if(!this.props.showApps)return o.createElement("div",null);const e=this.centerApps().length>0,t=(e?this.centerApps():this.topApps()).map(((e,t,n)=>o.createElement(Hc,{key:e.id,app:e,fullWidth:n.length<2,room:this.props.room,userId:this.props.userId,creatorUserId:e.creatorUserId,widgetPageTitle:vl.A.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,pointerEvents:this.isResizing()?"none":void 0})));if(0===t.length)return o.createElement("div",null);let n;0===t.length&&Rm.A.roomHasPendingWidgets(this.props.room.roomId,vl.A.getRoomWidgets(this.props.room))&&(n=o.createElement(dn.A,null));const i=ee()({mx_AppsDrawer:!0,"mx_AppsDrawer--maximised":e,"mx_AppsDrawer--resizing":this.state.resizing,"mx_AppsDrawer--2apps":2===t.length,"mx_AppsDrawer--3apps":3===t.length}),r=o.createElement("div",{className:"mx_AppsContainer",ref:this.collectResizer},t.map(((e,n)=>n<1?e:o.createElement(o.Fragment,{key:e.key},o.createElement(oe,{reverse:n>t.length/2}),e))));let s;return s=e?r:o.createElement(ah,{room:this.props.room,minHeight:100,maxHeight:this.props.maxHeight-50,className:"mx_AppsDrawer_resizer",handleWrapperClass:"mx_AppsDrawer_resizer_container",handleClass:"mx_AppsDrawer_resizer_container_handle",resizeNotifier:this.props.resizeNotifier},r),o.createElement("div",{role:this.props.role,className:i},s,n)}}(0,r.A)(sh,"defaultProps",{showApps:!0});const ah=({room:e,minHeight:t,maxHeight:n,className:i,handleWrapperClass:r,handleClass:s,resizeNotifier:a,children:l})=>{let c=hc.aK.instance.getContainerHeight(e,hc.mc.Top);var d;(t||(t=100),n||(n=Ce.A.instance.windowHeight/4*3),c)?(c=(0,oh.qE)(c,0,100),c=(0,oh.yj)(c/100,t,n)):c=null!==(d=g.Ay.get().default_widget_container_height)&&void 0!==d?d:280;return o.createElement(Do.c,{size:{height:Math.min(c,n),width:void 0},minHeight:t,maxHeight:n,onResizeStart:()=>{a.startResizing()},onResize:()=>{a.notifyTimelineHeightChanged()},onResizeStop:(i,r,o,s)=>{let l=c+s.height;l=100*(0,oh.s5)(l,t,n),hc.aK.instance.setContainerHeight(e,hc.mc.Top,l),a.stopResizing()},className:i,handleWrapperClass:r,handleClasses:{bottom:s},enable:{bottom:!0}},l)};var lh=n("./node_modules/matrix-js-sdk/src/webrtc/callEventTypes.ts");class ch extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"element",void 0),(0,r.A)(this,"setElementRef",(e=>{var t;e?(this.element=e,e.addEventListener("resize",this.onResize)):null===(t=this.element)||void 0===t||t.removeEventListener("resize",this.onResize)})),(0,r.A)(this,"onNewStream",(()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}),this.playMedia()})),(0,r.A)(this,"onMuteStateChanged",(()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()})})),(0,r.A)(this,"onResize",(e=>{this.props.onResize&&!this.props.feed.isLocal()&&this.props.onResize(e)})),this.state={audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}}componentDidMount(){this.updateFeed(null,this.props.feed),this.playMedia()}componentWillUnmount(){this.updateFeed(this.props.feed,null)}componentDidUpdate(e,t){this.updateFeed(e.feed,this.props.feed),t.videoMuted===this.state.videoMuted&&e.feed.stream===this.props.feed.stream||this.playMedia()}static getDerivedStateFromProps(e){return{audioMuted:e.feed.isAudioMuted(),videoMuted:e.feed.isVideoMuted()}}updateFeed(e,t){e!==t&&(e&&(this.props.feed.removeListener(Co.BL.NewStream,this.onNewStream),this.props.feed.removeListener(Co.BL.MuteStateChanged,this.onMuteStateChanged),this.props.feed.purpose===lh.h.Usermedia&&this.props.feed.measureVolumeActivity(!1),this.stopMedia()),t&&(this.props.feed.addListener(Co.BL.NewStream,this.onNewStream),this.props.feed.addListener(Co.BL.MuteStateChanged,this.onMuteStateChanged),this.props.feed.purpose===lh.h.Usermedia&&this.props.feed.measureVolumeActivity(!0),this.playMedia()))}async playMedia(){const e=this.element;if(e){e.muted=!0,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{await e.play()}catch(e){l.v.info(`Failed to play media element with feed for userId ${this.props.feed.userId} with purpose ${this.props.feed.purpose}`,e)}}}stopMedia(){const e=this.element;e&&(e.pause(),e.removeAttribute("src"))}render(){const{pipMode:e,primary:t,secondary:n,feed:i}=this.props,r=ee()("mx_VideoFeed",{mx_VideoFeed_primary:t,mx_VideoFeed_secondary:n,mx_VideoFeed_voice:this.state.videoMuted}),s=ee()("mx_VideoFeed_mic",{mx_VideoFeed_mic_muted:this.state.audioMuted,mx_VideoFeed_mic_unmuted:!this.state.audioMuted});let a,l;if(i.purpose===lh.h.Screenshare||e||(a=o.createElement("div",{className:s})),this.state.videoMuted){var c;const n=fe.Ay.instance.roomIdForCall(this.props.call),i=null!==(c=n?h.J.safeGet().getRoom(n):void 0)&&void 0!==c?c:void 0;let r;e&&t?r="76px":e&&!t?r="16px":!e&&t&&(r="160px"),l=o.createElement(Ge.A,{room:i,size:r})}else{const e=ee()("mx_VideoFeed_video",{mx_VideoFeed_video_mirror:this.props.feed.isLocal()&&this.props.feed.purpose===lh.h.Usermedia&&O.A.getValue("VideoView.flipVideoHorizontally")});l=o.createElement("video",{className:e,ref:this.setElementRef})}return o.createElement("div",{className:r},a,l)}}class dh extends o.Component{render(){const e=this.props.feeds.map((e=>o.createElement(ch,{key:e.stream.id,feed:e,call:this.props.call,primary:!1,pipMode:this.props.pipMode}))),t=ee()("mx_LegacyCallViewSidebar",{mx_LegacyCallViewSidebar_pipMode:this.props.pipMode});return o.createElement("div",{className:t},e)}}const uh=({onExpand:e,onPin:t,onMaximize:n})=>o.createElement("div",{className:"mx_LegacyCallViewHeader_controls"},n&&o.createElement(be.A,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_fullscreen",onClick:n,title:(0,C._t)("voip|maximise")}),t&&o.createElement(be.A,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_pin",onClick:t,title:(0,C._t)("action|pin")}),e&&o.createElement(be.A,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_expand",onClick:e,title:(0,C._t)("voip|expand")})),mh=({callRoom:e})=>o.createElement("span",{className:"mx_LegacyCallViewHeader_secondaryCallInfo"},o.createElement(Ge.A,{room:e,size:"16px"}),o.createElement("span",{className:"mx_LegacyCallView_secondaryCall_roomName"},(0,C._t)("voip|on_hold",{name:e.name}))),hh=({pipMode:e=!1,callRooms:t,onPipMouseDown:n,onExpand:i,onPin:r,onMaximize:s})=>{const[a,l]=t,c=a.name;return e?o.createElement("div",{className:"mx_LegacyCallViewHeader mx_LegacyCallViewHeader_pip",onMouseDown:n},o.createElement(Ge.A,{room:a,size:"32px"}),o.createElement("div",{className:"mx_LegacyCallViewHeader_callInfo"},o.createElement("div",{className:"mx_LegacyCallViewHeader_roomName"},c),l&&o.createElement(mh,{callRoom:l})),o.createElement(uh,{onExpand:i,onPin:r,onMaximize:s})):o.createElement("div",{className:"mx_LegacyCallViewHeader"},o.createElement("div",{className:"mx_LegacyCallViewHeader_icon"}),o.createElement("span",{className:"mx_LegacyCallViewHeader_text"},(0,C._t)("action|call")),o.createElement(uh,{onMaximize:s}))};class ph extends o.Component{constructor(e){super(e),(0,r.A)(this,"onHoldClick",(()=>{this.props.call.setRemoteOnHold(!0),this.props.onFinished()})),(0,r.A)(this,"onUnholdClick",(()=>{fe.Ay.instance.setActiveCallRoomId(this.props.call.roomId),this.props.onFinished()})),(0,r.A)(this,"onTransferClick",(()=>{fe.Ay.instance.showTransferDialog(this.props.call),this.props.onFinished()}))}render(){const e=this.props.call.isRemoteOnHold()?(0,C._t)("action|resume"):(0,C._t)("action|hold"),t=this.props.call.isRemoteOnHold()?this.onUnholdClick:this.onHoldClick;let n;return this.props.call.opponentCanBeTransferred()&&(n=o.createElement(Me.Dr,{className:"mx_LegacyCallContextMenu_item",onClick:this.onTransferClick},(0,C._t)("action|transfer"))),o.createElement(Me.Ay,this.props,o.createElement(Me.Dr,{className:"mx_LegacyCallContextMenu_item",onClick:t},e),n)}}var gh=n("./node_modules/matrix-react-sdk/src/components/views/voip/DialPad.tsx");class vh extends o.Component{constructor(e){super(e),(0,r.A)(this,"numberEntryFieldRef",(0,o.createRef)()),(0,r.A)(this,"onDigitPress",((e,t)=>{var n;(this.props.call.sendDtmfDigit(e),this.setState({value:this.state.value+e}),"click"===t.type)&&(null===(n=this.numberEntryFieldRef.current)||void 0===n||n.focus())})),(0,r.A)(this,"onCancelClick",(()=>{this.props.onFinished()})),(0,r.A)(this,"onKeyDown",(e=>{"Backspace"!==e.code&&"Delete"!==e.code||e.preventDefault()})),(0,r.A)(this,"onChange",(e=>{this.setState({value:e.target.value})})),this.state={value:""}}render(){return o.createElement(Me.Ay,this.props,o.createElement("div",{className:"mx_DialPadContextMenuWrapper"},o.createElement("div",null,o.createElement(be.A,{className:"mx_DialPadContextMenu_cancel",onClick:this.onCancelClick})),o.createElement("div",{className:"mx_DialPadContextMenu_header"},o.createElement(tn.A,{ref:this.numberEntryFieldRef,className:"mx_DialPadContextMenu_dialled",value:this.state.value,autoFocus:!0,onKeyDown:this.onKeyDown,onChange:this.onChange})),o.createElement("div",{className:"mx_DialPadContextMenu_dialPad"},o.createElement(gh.Ay,{onDigitPress:this.onDigitPress,hasDial:!1}))))}}const _h=["deviceKinds"],fh={[ne.cm.AudioInput]:(0,C.AO)("voip|input_devices"),[ne.cm.AudioOutput]:(0,C.AO)("voip|output_devices"),[ne.cm.VideoInput]:(0,C.AO)("common|cameras")},yh=({label:e,selected:t,onClick:n})=>o.createElement(Le.h6,{iconClassName:"mx_DeviceContextMenu_device_icon",label:e,active:t,onClick:n}),Eh=({deviceKind:e})=>{const[t,n]=(0,o.useState)([]),[i,r]=(0,o.useState)(ne.Ay.getDevice(e));(0,o.useEffect)((()=>{(async()=>{var t,i;n(null!==(t=null===(i=await ne.Ay.getDevices())||void 0===i?void 0:i[e])&&void 0!==t?t:[])})()}),[e]);return o.createElement(Le.tx,{label:(0,C._t)(fh[e])},t.map((({label:t,deviceId:n})=>o.createElement(yh,{key:n,label:t,selected:i===n,onClick:()=>(t=>{ne.Ay.instance.setDevice(t,e),r(t)})(n)}))))},bh=e=>{let{deviceKinds:t}=e,n=(0,Ue.A)(e,_h);return o.createElement(Le.Ay,(0,i.A)({compact:!0,className:"mx_DeviceContextMenu"},n),t.map((e=>o.createElement(Eh,{key:e,deviceKind:e}))))},wh=["children","state","className","onLabel","offLabel","forceHide","onHover"],xh=["state","deviceKinds"],Ah=(0,o.forwardRef)(((e,t)=>{let{children:n,state:r,className:s,onLabel:a,offLabel:l,forceHide:c,onHover:d}=e,u=(0,Ue.A)(e,wh);const m=ee()("mx_LegacyCallViewButtons_button",s,{mx_LegacyCallViewButtons_button_on:r,mx_LegacyCallViewButtons_button_off:!r}),h=c?void 0:r?a:l;return o.createElement(be.A,(0,i.A)({ref:t,className:m,title:h,placement:"top",onTooltipOpenChange:d},u),n)})),Sh=e=>{let{state:t,deviceKinds:n}=e,r=(0,Ue.A)(e,xh);const[s,a,l,c]=(0,Me.EF)(),[d,u]=(0,o.useState)(!1),m=ee()("mx_LegacyCallViewButtons_button","mx_LegacyCallViewButtons_dropdownButton",{mx_LegacyCallViewButtons_dropdownButton_collapsed:!s});return o.createElement(Ah,(0,i.A)({ref:a,forceHide:s||d,state:t},r),o.createElement(Ah,{className:m,onClick:e=>{e.stopPropagation(),l()},onHover:e=>u(e),state:t}),s&&a.current&&o.createElement(bh,(0,i.A)({},(0,Me.Gi)(a.current.getBoundingClientRect()),{onFinished:c,deviceKinds:n})))};class Ch extends o.Component{constructor(e){super(e),(0,r.A)(this,"dialpadButton",(0,o.createRef)()),(0,r.A)(this,"contextMenuButton",(0,o.createRef)()),(0,r.A)(this,"controlsHideTimer",null),(0,r.A)(this,"onControlsHideTimer",(()=>{this.state.hoveringControls||this.state.showDialpad||this.state.showMoreMenu||(this.controlsHideTimer=null,this.setState({visible:!1}))})),(0,r.A)(this,"onMouseEnter",(()=>{this.setState({hoveringControls:!0})})),(0,r.A)(this,"onMouseLeave",(()=>{this.setState({hoveringControls:!1})})),(0,r.A)(this,"onDialpadClick",(()=>{this.state.showDialpad?this.setState({showDialpad:!1}):(this.setState({showDialpad:!0}),this.showControls())})),(0,r.A)(this,"onMoreClick",(()=>{this.setState({showMoreMenu:!0}),this.showControls()})),(0,r.A)(this,"closeDialpad",(()=>{this.setState({showDialpad:!1})})),(0,r.A)(this,"closeContextMenu",(()=>{this.setState({showMoreMenu:!1})})),this.state={showDialpad:!1,hoveringControls:!1,showMoreMenu:!1,visible:!0}}componentDidMount(){this.showControls()}showControls(){this.state.showMoreMenu||this.state.showDialpad||(this.state.visible||this.setState({visible:!0}),null!==this.controlsHideTimer&&clearTimeout(this.controlsHideTimer),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,2e3))}render(){const e=ee()("mx_LegacyCallViewButtons",{mx_LegacyCallViewButtons_hidden:!this.state.visible});let t,n;return this.state.showDialpad&&this.dialpadButton.current&&(t=o.createElement(vh,(0,i.A)({},(0,Me.t$)(this.dialpadButton.current.getBoundingClientRect(),Me.t4.None,8),{mountAsChild:!this.props.pipMode,onFinished:this.closeDialpad,call:this.props.call}))),this.state.showMoreMenu&&this.contextMenuButton.current&&(n=o.createElement(ph,(0,i.A)({},(0,Me.t$)(this.contextMenuButton.current.getBoundingClientRect(),Me.t4.None,8),{mountAsChild:!this.props.pipMode,onFinished:this.closeContextMenu,call:this.props.call}))),o.createElement("div",{className:e,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,n,this.props.buttonsVisibility.dialpad&&o.createElement(Me.oW,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_dialpad",ref:this.dialpadButton,onClick:this.onDialpadClick,isExpanded:this.state.showDialpad,title:(0,C._t)("voip|dialpad"),placement:"top"}),o.createElement(Sh,{state:!this.props.buttonsState.micMuted,className:"mx_LegacyCallViewButtons_button_mic",onLabel:(0,C._t)("voip|disable_microphone"),offLabel:(0,C._t)("voip|enable_microphone"),onClick:this.props.handlers.onMicMuteClick,deviceKinds:[ne.cm.AudioInput,ne.cm.AudioOutput]}),this.props.buttonsVisibility.vidMute&&o.createElement(Sh,{state:!this.props.buttonsState.vidMuted,className:"mx_LegacyCallViewButtons_button_vid",onLabel:(0,C._t)("voip|disable_camera"),offLabel:(0,C._t)("voip|enable_camera"),onClick:this.props.handlers.onVidMuteClick,deviceKinds:[ne.cm.VideoInput]}),this.props.buttonsVisibility.screensharing&&o.createElement(Ah,{state:this.props.buttonsState.screensharing,className:"mx_LegacyCallViewButtons_button_screensharing",onLabel:(0,C._t)("voip|stop_screenshare"),offLabel:(0,C._t)("voip|start_screenshare"),onClick:this.props.handlers.onScreenshareClick}),this.props.buttonsVisibility.sidebar&&o.createElement(Ah,{state:this.props.buttonsState.sidebarShown,className:"mx_LegacyCallViewButtons_button_sidebar",onLabel:(0,C._t)("voip|hide_sidebar_button"),offLabel:(0,C._t)("voip|show_sidebar_button"),onClick:this.props.handlers.onToggleSidebarClick}),this.props.buttonsVisibility.contextMenu&&o.createElement(Me.oW,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_button_more",onClick:this.onMoreClick,ref:this.contextMenuButton,isExpanded:this.state.showMoreMenu,title:(0,C._t)("voip|more_button"),placement:"top"}),o.createElement(be.A,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_button_hangup",onClick:this.props.handlers.onHangupClick,title:(0,C._t)("voip|hangup"),placement:"top"}))}}function kh(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function Rh(){const e=document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document)}class Ih extends o.Component{constructor(e){super(e),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"contentWrapperRef",(0,o.createRef)()),(0,r.A)(this,"buttonsRef",(0,o.createRef)()),(0,r.A)(this,"onAction",(e=>{if("video_fullscreen"===e.action){if(!this.contentWrapperRef.current)return;e.fullscreen?function(e){const t=e.requestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen;t&&t.call(e)}(this.contentWrapperRef.current):kh()&&Rh()}})),(0,r.A)(this,"onCallState",(e=>{this.setState({callState:e})})),(0,r.A)(this,"onFeedsChanged",(e=>{const{primary:t,secondary:n,sidebar:i}=Ih.getOrderedFeeds(e);this.setState({primaryFeed:t,secondaryFeed:n,sidebarFeeds:i,micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted()})})),(0,r.A)(this,"onCallLocalHoldUnhold",(()=>{this.setState({isLocalOnHold:this.props.call.isLocalOnHold()})})),(0,r.A)(this,"onCallRemoteHoldUnhold",(()=>{this.setState({isRemoteOnHold:this.props.call.isRemoteOnHold(),isLocalOnHold:this.props.call.isLocalOnHold()})})),(0,r.A)(this,"onMouseMove",(()=>{var e;null===(e=this.buttonsRef.current)||void 0===e||e.showControls()})),(0,r.A)(this,"onMaximizeClick",(()=>{v.Ay.dispatch({action:"video_fullscreen",fullscreen:!0})})),(0,r.A)(this,"onMicMuteClick",(async()=>{const e=!this.state.micMuted;this.setState({micMuted:await this.props.call.setMicrophoneMuted(e)})})),(0,r.A)(this,"onVidMuteClick",(async()=>{const e=!this.state.vidMuted;this.setState({vidMuted:await this.props.call.setLocalVideoMuted(e)})})),(0,r.A)(this,"onScreenshareClick",(async()=>{let e;e=this.state.screensharing?await this.props.call.setScreensharingEnabled(!1):await this.props.call.setScreensharingEnabled(!0),this.setState({sidebarShown:!0,screensharing:e})})),(0,r.A)(this,"onNativeKeyDown",(e=>{var t,n;let i=!1;switch((0,Se.zM)().getCallAction(e)){case Ee.bY.ToggleMicInCall:this.onMicMuteClick(),null===(t=this.buttonsRef.current)||void 0===t||t.showControls(),i=!0;break;case Ee.bY.ToggleWebcamInCall:this.onVidMuteClick(),null===(n=this.buttonsRef.current)||void 0===n||n.showControls(),i=!0}i&&(e.stopPropagation(),e.preventDefault())})),(0,r.A)(this,"onCallResumeClick",(()=>{const e=fe.Ay.instance.roomIdForCall(this.props.call);e&&fe.Ay.instance.setActiveCallRoomId(e)})),(0,r.A)(this,"onTransferClick",(()=>{const e=fe.Ay.instance.getTransfereeForCallId(this.props.call.callId);e&&this.props.call.transferToCall(e)})),(0,r.A)(this,"onHangupClick",(()=>{const e=fe.Ay.instance.roomIdForCall(this.props.call);e&&fe.Ay.instance.hangupOrReject(e)})),(0,r.A)(this,"onToggleSidebar",(()=>{this.setState({sidebarShown:!this.state.sidebarShown})}));const{primary:t,secondary:n,sidebar:i}=Ih.getOrderedFeeds(this.props.call.getFeeds());this.state={isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),screensharing:this.props.call.isScreensharing(),callState:this.props.call.state,primaryFeed:t,secondaryFeed:n,sidebarFeeds:i,sidebarShown:!0},this.updateCallListeners(null,this.props.call)}componentDidMount(){this.dispatcherRef=v.Ay.register(this.onAction),document.addEventListener("keydown",this.onNativeKeyDown)}componentWillUnmount(){kh()&&Rh(),document.removeEventListener("keydown",this.onNativeKeyDown),this.updateCallListeners(this.props.call,null),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef)}static getDerivedStateFromProps(e){const{primary:t,secondary:n,sidebar:i}=Ih.getOrderedFeeds(e.call.getFeeds());return{primaryFeed:t,secondaryFeed:n,sidebarFeeds:i}}componentDidUpdate(e){this.props.call!==e.call&&(this.setState({isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),callState:this.props.call.state}),this.updateCallListeners(null,this.props.call))}updateCallListeners(e,t){e!==t&&(e&&(e.removeListener(So.$E.State,this.onCallState),e.removeListener(So.$E.LocalHoldUnhold,this.onCallLocalHoldUnhold),e.removeListener(So.$E.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),e.removeListener(So.$E.FeedsChanged,this.onFeedsChanged)),t&&(t.on(So.$E.State,this.onCallState),t.on(So.$E.LocalHoldUnhold,this.onCallLocalHoldUnhold),t.on(So.$E.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),t.on(So.$E.FeedsChanged,this.onFeedsChanged)))}static getOrderedFeeds(e){if(e.length<=2)return{primary:e.find((e=>!e.isLocal())),secondary:e.find((e=>e.isLocal())),sidebar:[]};let t;const n=e.filter((e=>e.purpose===lh.h.Screenshare));t=n.find((e=>!e.isLocal()))||n[0],t||(t=e.find((e=>!e.isLocal())));const i=[...e];return t&&i.splice(i.indexOf(t),1),i.sort(((e,t)=>e.isLocal()&&!t.isLocal()?-1:!e.isLocal()&&t.isLocal()?1:0)),{primary:t,sidebar:i}}renderCallControls(){const{call:e,pipMode:t}=this.props,{callState:n,micMuted:i,vidMuted:r,screensharing:s,sidebarShown:a,secondaryFeed:l,sidebarFeeds:c}=this.state,d=e.opponentSupportsSDPStreamMetadata()||e.hasLocalUserMediaVideoTrack,u=(e.opponentSupportsSDPStreamMetadata()||e.hasLocalUserMediaVideoTrack)&&e.state===So.iP.Connected,m=l&&!l.isVideoMuted()||c.length>0,h=n===So.iP.Connected,p=n===So.iP.Connected&&e.opponentSupportsDTMF();return o.createElement(Ch,{ref:this.buttonsRef,call:e,pipMode:t,handlers:{onToggleSidebarClick:this.onToggleSidebar,onScreenshareClick:this.onScreenshareClick,onHangupClick:this.onHangupClick,onMicMuteClick:this.onMicMuteClick,onVidMuteClick:this.onVidMuteClick},buttonsState:{micMuted:i,vidMuted:r,sidebarShown:a,screensharing:s},buttonsVisibility:{vidMute:d,screensharing:u,sidebar:m,contextMenu:h,dialpad:p}})}renderToast(){var e;const{call:t}=this.props;if(!t.getFeeds().some((e=>e.purpose===lh.h.Screenshare)))return null;const n=t.isScreensharing(),{primaryFeed:i,sidebarShown:r}=this.state,s=null==i||null===(e=i.getMember())||void 0===e?void 0:e.name;if(!s)return null;let a=n?(0,C._t)("voip|you_are_presenting"):(0,C._t)("voip|user_is_presenting",{sharerName:s});return r||(a+=" • "+(t.isLocalVideoMuted()?(0,C._t)("voip|camera_disabled"):(0,C._t)("voip|camera_enabled"))),o.createElement("div",{className:"mx_LegacyCallView_toast"},a)}renderContent(){var e;const{pipMode:t,call:n,onResize:i}=this.props,{isLocalOnHold:r,isRemoteOnHold:s,sidebarShown:a,primaryFeed:l,secondaryFeed:c,sidebarFeeds:d}=this.state,u=fe.Ay.instance.roomIdForCall(n),m=null!==(e=u?h.J.safeGet().getRoom(u):void 0)&&void 0!==e?e:void 0,p=t?"76px":"160px",g=fe.Ay.instance.getTransfereeForCallId(n.callId),v=r||s;let _;if(a&&c&&!c.isVideoMuted()&&(_=o.createElement(ch,{feed:c,call:n,pipMode:t,onResize:i,secondary:!0})),g||v){const e=ee()("mx_LegacyCallView_content",{mx_LegacyCallView_content_hold:v}),t=(0,xa._V)(n.getOpponentMember(),1024,1024,"crop");let i;if(g){const e=h.J.safeGet(),t=fe.Ay.instance.roomIdForCall(n),r=t?e.getRoom(t):null,s=r?r.name:(0,C._t)("voip|unknown_person"),a=fe.Ay.instance.roomIdForCall(g),l=a?e.getRoom(a):null,c=l?l.name:(0,C._t)("voip|unknown_person");i=o.createElement("div",{className:"mx_LegacyCallView_status"},(0,C._t)("voip|consulting",{transferTarget:s,transferee:c},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onTransferClick},e)}))}else{let e;if(s)e=(0,C._t)(fe.Ay.instance.hasAnyUnheldCall()?(0,C.AO)("voip|call_held_switch"):(0,C.AO)("voip|call_held_resume"),{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onCallResumeClick},e)});else if(r){var f;e=(0,C._t)("voip|call_held",{peerName:null===(f=n.getOpponentMember())||void 0===f?void 0:f.name})}i=o.createElement("div",{className:"mx_LegacyCallView_status"},e)}return o.createElement("div",{className:e,onMouseMove:this.onMouseMove},o.createElement("div",{className:"mx_LegacyCallView_holdBackground",style:{backgroundImage:"url("+t+")"}}),i)}return n.noIncomingFeeds()?o.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.createElement("div",{className:"mx_LegacyCallView_avatarsContainer"},o.createElement("div",{className:"mx_LegacyCallView_avatarContainer",style:{width:p,height:p}},o.createElement(Ge.A,{room:m,size:p}))),o.createElement("div",{className:"mx_LegacyCallView_status"},(0,C._t)("voip|connecting")),_):t?o.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.createElement(ch,{feed:l,call:n,pipMode:t,onResize:i,primary:!0})):c?o.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.createElement(ch,{feed:l,call:n,pipMode:t,onResize:i,primary:!0}),_):o.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.createElement(ch,{feed:l,call:n,pipMode:t,onResize:i,primary:!0}),a&&o.createElement(dh,{feeds:d,call:n,pipMode:Boolean(t)}))}render(){const{call:e,secondaryCall:t,pipMode:n,showApps:i,onMouseDownOnHeader:r}=this.props,{sidebarShown:s,sidebarFeeds:a}=this.state,l=h.J.safeGet(),c=fe.Ay.instance.roomIdForCall(e),d=fe.Ay.instance.roomIdForCall(t),u=c?l.getRoom(c):null;if(!u)return null;const m=d?l.getRoom(d):null,p=ee()({mx_LegacyCallView:!0,mx_LegacyCallView_pip:n,mx_LegacyCallView_large:!n,mx_LegacyCallView_sidebar:s&&0!==a.length&&!n,mx_LegacyCallView_belowWidget:i});return o.createElement("div",{className:p},o.createElement(hh,{onPipMouseDown:r,pipMode:n,callRooms:[u,m],onMaximize:this.onMaximizeClick}),o.createElement("div",{className:"mx_LegacyCallView_content_wrapper",ref:this.contentWrapperRef},this.renderToast(),this.renderContent(),this.renderCallControls()))}}class Th extends o.Component{constructor(e){super(e),(0,r.A)(this,"updateCall",(()=>{const e=this.getCall();e!==this.state.call&&this.setState({call:e})})),(0,r.A)(this,"onResizeStart",(()=>{this.props.resizeNotifier.startResizing()})),(0,r.A)(this,"onResize",(()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()})),(0,r.A)(this,"onResizeStop",(()=>{this.props.resizeNotifier.stopResizing()})),this.state={call:this.getCall()}}componentDidMount(){fe.Ay.instance.addListener(fe.uv.CallState,this.updateCall),fe.Ay.instance.addListener(fe.uv.CallChangeRoom,this.updateCall)}componentWillUnmount(){fe.Ay.instance.removeListener(fe.uv.CallState,this.updateCall),fe.Ay.instance.removeListener(fe.uv.CallChangeRoom,this.updateCall)}getCall(){const e=fe.Ay.instance.getCallForRoom(this.props.roomId);return e&&[So.iP.Ended,So.iP.Ringing].includes(e.state)?null:e}render(){return this.state.call?o.createElement("div",{className:"mx_LegacyCallViewForRoom"},o.createElement(Do.c,{minHeight:380,maxHeight:"80vh",enable:{top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_LegacyCallViewForRoom_ResizeWrapper",handleClasses:{bottom:"mx_LegacyCallViewForRoom_ResizeHandle"}},o.createElement(Ih,{call:this.state.call,pipMode:!1,showApps:this.props.showApps}))):null}}class Ph extends o.Component{shouldComponentUpdate(e){return(0,Ol.No)(this.props,e)}render(){const e=o.createElement(Th,{roomId:this.props.room.roomId,resizeNotifier:this.props.resizeNotifier,showApps:this.props.showApps});let t;return O.A.getValue(W.f.Widgets)&&(t=o.createElement(sh,{room:this.props.room,userId:this.props.userId,showApps:this.props.showApps,resizeNotifier:this.props.resizeNotifier})),o.createElement(Bn.A,{role:"region",className:"mx_AuxPanel"},this.props.children,t,e)}}(0,r.A)(Ph,"defaultProps",{showApps:!0});const Nh=["isHighlighted","isUnread","onClick","name","title"];class Dh extends o.Component{render(){const e=this.props,{isHighlighted:t,isUnread:n=!1,onClick:r,name:s,title:a}=e,l=(0,Ue.A)(e,Nh),c=ee()({mx_LegacyRoomHeader_button:!0,"mx_LegacyRoomHeader_button--highlight":t,"mx_LegacyRoomHeader_button--unread":n,[`mx_RightPanel_${s}`]:!0});return o.createElement(be.A,(0,i.A)({},l,{"aria-current":t?"true":"false",title:a,placement:"bottom",className:c,onClick:r}))}}let Mh=function(e){return e.Room="room",e}({});class Oh extends o.Component{constructor(e,t){super(e),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"watcherRef",void 0),(0,r.A)(this,"onRightPanelStoreUpdate",(()=>{this.unmounted||this.setState({phase:qn.A.instance.currentCard.phase})}));const n=qn.A.instance;this.state={headerKind:t,phase:n.currentCard.phase,threadNotificationLevel:Qe.S.None,globalNotificationLevel:Qe.S.None,notificationsEnabled:O.A.getValue("feature_notifications")},this.watcherRef=O.A.watchSetting("feature_notifications",null,((...[,,,e])=>this.setState({notificationsEnabled:e})))}componentDidMount(){qn.A.instance.on(A.H,this.onRightPanelStoreUpdate)}componentWillUnmount(){this.unmounted=!0,qn.A.instance.off(A.H,this.onRightPanelStoreUpdate),this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef),this.watcherRef&&O.A.unwatchSetting(this.watcherRef)}isPhase(e){return!!qn.A.instance.isOpen&&(Array.isArray(e)?!!this.state.phase&&e.includes(this.state.phase):e===this.state.phase)}render(){return this.renderButtons()}}const Lh=[$n.n.RoomSummary,$n.n.Widget,$n.n.FilePanel,$n.n.RoomMemberList,$n.n.RoomMemberInfo,$n.n.EncryptionPanel,$n.n.Room3pidMemberInfo],Uh=({color:e})=>{if(e===Qe.S.None)return null;const t=ee()({mx_Indicator:!0,mx_LegacyRoomHeader_button_unreadIndicator:!0,mx_Indicator_activity:e===Qe.S.Activity,mx_Indicator_notification:e===Qe.S.Notification,mx_Indicator_highlight:e===Qe.S.Highlight});return o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_LegacyRoomHeader_button_unreadIndicator_bg"}),o.createElement("div",{className:t}))},Fh=({room:e,isHighlighted:t,onClick:n})=>{const i=ol(e),r=al(e);if(null==i||!i.length)return null;let s;return i.some((e=>!r.has(e)))&&(s=o.createElement(Uh,null)),o.createElement(Dh,{name:"pinnedMessagesButton",title:(0,C._t)("right_panel|pinned_messages|title"),isHighlighted:t,isUnread:!!s,onClick:n},s)},jh=({room:e,isHighlighted:t,onClick:n})=>{let i;const r=st.n.instance.getRoomState(e).level;switch(r){case Qe.S.Activity:case Qe.S.Notification:case Qe.S.Highlight:i=o.createElement(Uh,{color:r})}return o.createElement(Dh,{name:"timelineCardButton",title:(0,C._t)("right_panel|video_room_chat|title"),isHighlighted:t,onClick:n},i)};class Bh extends Oh{constructor(e){super(e,Mh.Room),(0,r.A)(this,"globalNotificationState",void 0),(0,r.A)(this,"onNotificationUpdate",(()=>{this.setState({threadNotificationLevel:this.notificationLevel})})),(0,r.A)(this,"onUpdateStatus",(e=>{this.globalNotificationState=e,this.setState({globalNotificationLevel:e.level})})),(0,r.A)(this,"onRoomSummaryClicked",(()=>{const e=qn.A.instance.currentCard.phase;e&&Lh.includes(e)?this.state.phase===e?qn.A.instance.showOrHidePhase(e):qn.A.instance.showOrHidePhase(e,qn.A.instance.currentCard.state):qn.A.instance.showOrHidePhase($n.n.RoomSummary)})),(0,r.A)(this,"onNotificationsClicked",(()=>{qn.A.instance.showOrHidePhase($n.n.NotificationPanel)})),(0,r.A)(this,"onPinnedMessagesClicked",(()=>{qn.A.instance.showOrHidePhase($n.n.PinnedMessages)})),(0,r.A)(this,"onTimelineCardClicked",(()=>{qn.A.instance.showOrHidePhase($n.n.Timeline)})),(0,r.A)(this,"onThreadsPanelClicked",(e=>{var t,n;this.state.phase&&Bh.THREAD_PHASES.includes(this.state.phase)?qn.A.instance.togglePanel(null!==(t=null===(n=this.props.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null):(qn.A.instance.setCard({phase:$n.n.ThreadPanel}),u.A.trackInteraction("WebRoomHeaderButtonsThreadsButton",e))})),this.globalNotificationState=st.n.instance.globalState}componentDidMount(){var e,t,n,i,r,o,a,l;super.componentDidMount(),null===(e=this.props.room)||void 0===e||e.on(s.RoomEvent.UnreadNotifications,this.onNotificationUpdate),null===(t=this.props.room)||void 0===t||t.on(s.RoomEvent.Receipt,this.onNotificationUpdate),null===(n=this.props.room)||void 0===n||n.on(s.RoomEvent.Timeline,this.onNotificationUpdate),null===(i=this.props.room)||void 0===i||i.on(s.RoomEvent.Redaction,this.onNotificationUpdate),null===(r=this.props.room)||void 0===r||r.on(s.RoomEvent.LocalEchoUpdated,this.onNotificationUpdate),null===(o=this.props.room)||void 0===o||o.on(s.RoomEvent.MyMembership,this.onNotificationUpdate),null===(a=this.props.room)||void 0===a||a.on(s.ThreadEvent.New,this.onNotificationUpdate),null===(l=this.props.room)||void 0===l||l.on(s.ThreadEvent.Update,this.onNotificationUpdate),this.onNotificationUpdate(),st.n.instance.on(st.N,this.onUpdateStatus)}componentWillUnmount(){var e,t,n,i,r,o,a,l;super.componentWillUnmount(),null===(e=this.props.room)||void 0===e||e.off(s.RoomEvent.UnreadNotifications,this.onNotificationUpdate),null===(t=this.props.room)||void 0===t||t.off(s.RoomEvent.Receipt,this.onNotificationUpdate),null===(n=this.props.room)||void 0===n||n.off(s.RoomEvent.Timeline,this.onNotificationUpdate),null===(i=this.props.room)||void 0===i||i.off(s.RoomEvent.Redaction,this.onNotificationUpdate),null===(r=this.props.room)||void 0===r||r.off(s.RoomEvent.LocalEchoUpdated,this.onNotificationUpdate),null===(o=this.props.room)||void 0===o||o.off(s.RoomEvent.MyMembership,this.onNotificationUpdate),null===(a=this.props.room)||void 0===a||a.off(s.ThreadEvent.New,this.onNotificationUpdate),null===(l=this.props.room)||void 0===l||l.off(s.ThreadEvent.Update,this.onNotificationUpdate),st.n.instance.off(st.N,this.onUpdateStatus)}get notificationLevel(){var e;switch(null===(e=this.props.room)||void 0===e?void 0:e.threadsAggregateNotificationType){case s.NotificationCountType.Highlight:return Qe.S.Highlight;case s.NotificationCountType.Total:return Qe.S.Notification}for(const e of this.props.room.getThreads())if((0,Yn.jM)(e))return Qe.S.Activity;return Qe.S.None}onAction(e){}renderButtons(){if(!this.props.room)return o.createElement(o.Fragment,null);const e=new Map;return O.A.getValue("feature_pinning")&&e.set($n.n.PinnedMessages,o.createElement(Fh,{key:"pinnedMessagesButton",room:this.props.room,isHighlighted:this.isPhase($n.n.PinnedMessages),onClick:this.onPinnedMessagesClicked})),e.set($n.n.Timeline,o.createElement(jh,{key:"timelineButton",room:this.props.room,isHighlighted:this.isPhase($n.n.Timeline),onClick:this.onTimelineCardClicked})),e.set($n.n.ThreadPanel,o.createElement(Dh,{key:$n.n.ThreadPanel,name:"threadsButton",title:(0,C._t)("common|threads"),onClick:this.onThreadsPanelClicked,isHighlighted:this.isPhase(Bh.THREAD_PHASES),isUnread:this.state.threadNotificationLevel>Qe.S.None},o.createElement(Uh,{color:this.state.threadNotificationLevel}))),this.state.notificationsEnabled&&e.set($n.n.NotificationPanel,o.createElement(Dh,{key:"notifsButton",name:"notifsButton",title:(0,C._t)("notifications|enable_prompt_toast_title"),isHighlighted:this.isPhase($n.n.NotificationPanel),onClick:this.onNotificationsClicked,isUnread:this.globalNotificationState.level===Qe.S.Highlight},this.globalNotificationState.level===Qe.S.Highlight?o.createElement(Uh,{color:this.globalNotificationState.level}):null)),e.set($n.n.RoomSummary,o.createElement(Dh,{key:"roomSummaryButton",name:"roomSummaryButton",title:(0,C._t)("right_panel|room_summary_card|title"),isHighlighted:this.isPhase(Lh),onClick:this.onRoomSummaryClicked})),o.createElement(o.Fragment,null,Array.from(e.keys()).map((t=>{var n;return null!==(n=this.props.excludedRightPanelPhaseButtons)&&void 0!==n&&n.includes(t)?null:e.get(t)})))}}(0,r.A)(Bh,"THREAD_PHASES",[$n.n.ThreadPanel,$n.n.ThreadView]);var Vh=n("./node_modules/matrix-react-sdk/res/img/feather-customised/check.svg"),Hh=n("./node_modules/matrix-react-sdk/res/img/feather-customised/x.svg");const zh=({room:e})=>{const[t,n]=(0,o.useState)(!1),i=(0,Pe.DY)(e,s.RoomStateEvent.Update,(0,o.useCallback)((()=>e.getMembersWithMembership(We.O.Knock)),[e])),r=i.length;if(e.getJoinRule()!==s.JoinRule.Knock||0===r)return null;const a=e.client,l=a.getUserId()||"",c=e.canInvite(l),d=e.getMember(l),u=e.getLiveTimeline().getState(s.EventTimeline.FORWARDS),m=!(!d||!u)&&u.hasSufficientPowerLevelFor("kick",d.powerLevel);if(!c&&!m)return null;const h=e=>{f.Ay.createDialog(lc.A,{title:e.name,description:e.message})},p=()=>v.Ay.dispatch({action:"open_room_settings",room_id:e.roomId,initial_tab_id:ma.e.People});let g=o.createElement(be.A,{className:"mx_RoomKnocksBar_action",kind:"primary",onClick:p,title:(0,C._t)("action|view")},(0,C._t)("action|view")),_=(0,ia.ki)(i.map((e=>e.name)),3,!0),y=null;var E;1===r&&(g=o.createElement(o.Fragment,null,o.createElement(be.A,{className:"mx_RoomKnocksBar_action",disabled:!m||t,kind:"icon_primary_outline",onClick:()=>(t=>{n(!0),a.kick(e.roomId,t).catch(h).finally((()=>n(!1)))})(i[0].userId),title:(0,C._t)("action|deny")},o.createElement(Hh.I,{width:18,height:18})),o.createElement(be.A,{className:"mx_RoomKnocksBar_action",disabled:!c||t,kind:"icon_primary",onClick:()=>(t=>{n(!0),a.invite(e.roomId,t).catch(h).finally((()=>n(!1)))})(i[0].userId),title:(0,C._t)("action|approve")},o.createElement(Vh.I,{width:18,height:18}))),_=`${i[0].name} (${i[0].userId})`,y=(null===(E=i[0].events.member)||void 0===E?void 0:E.getContent().reason)&&o.createElement(be.A,{className:"mx_RoomKnocksBar_link",element:"a",kind:"link_inline",onClick:p},(0,C._t)("action|view_message")));return o.createElement("div",{className:"mx_RoomKnocksBar"},i.slice(0,2).map((e=>o.createElement(Ws.A,{className:"mx_RoomKnocksBar_avatar",key:e.userId,member:e,size:"32px"}))),o.createElement("div",{className:"mx_RoomKnocksBar_content"},o.createElement(Ii.A,{size:"4"},(0,C._t)("room|header|n_people_asking_to_join",{count:r})),o.createElement("p",{className:"mx_RoomKnocksBar_paragraph"},_,y)),g)};var Wh=n("./node_modules/matrix-react-sdk/src/stores/local-echo/EchoChamber.ts"),Gh=n("./node_modules/matrix-react-sdk/src/RoomNotifs.ts"),Kh=n("./node_modules/matrix-react-sdk/src/components/views/context_menus/DeveloperToolsOption.tsx");const Jh=["room","onFinished"],qh=e=>{var t;let{room:n,onFinished:r}=e,a=(0,Ue.A)(e,Jh);const l=(0,o.useContext)(Re.Ay),c=(0,Pe.dF)(Ai.Ay.instance,Ai.lA,(()=>Ai.Ay.instance.getTagsForRoom(n)));let d;if(c.includes(he.zO.Archived)){const e=e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"forget_room",room_id:n.roomId}),r()};d=o.createElement(Le.R$,{iconClassName:"mx_RoomTile_iconSignOut",label:(0,C._t)("room|context_menu|forget"),className:"mx_IconizedContextMenu_option_red",onClick:e})}else{const e=e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"leave_room",room_id:n.roomId}),r(),u.A.trackInteraction("WebRoomHeaderContextMenuLeaveItem",e)};d=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("action|leave"),className:"mx_IconizedContextMenu_option_red",iconClassName:"mx_RoomTile_iconSignOut"})}const m=Ti.A.shared().getUserIdForRoomId(n.roomId),h=(0,el.u)(n);let p,g,_,y,E,b,w;if((0,Pe.dF)(l,s.RoomMemberEvent.PowerLevel,(()=>n.canInvite(l.getUserId())))&&!m&&(0,Ie.g)(W.C.InviteUsers)){const e=e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"view_invite",roomId:n.roomId}),r(),u.A.trackInteraction("WebRoomHeaderContextMenuInviteItem",e)};p=o.createElement(Le.R$,{onClick:e,label:(0,C._t)("action|invite"),iconClassName:"mx_RoomTile_iconInvite"})}if(n.getMyMembership()===We.O.Join){const e=c.includes(he.zO.Favourite);g=o.createElement(Le.LS,{onClick:e=>{T(e,he.zO.Favourite),u.A.trackInteraction("WebRoomHeaderContextMenuFavouriteToggle",e)},active:e,label:e?(0,C._t)("room|context_menu|unfavourite"):(0,C._t)("room|context_menu|favourite"),iconClassName:"mx_RoomTile_iconStar"});const t=c.includes(he.zO.LowPriority);_=o.createElement(Le.LS,{onClick:e=>T(e,he.zO.LowPriority),active:t,label:(0,C._t)("common|low_priority"),iconClassName:"mx_RoomTile_iconArrowDown"});let i,s;switch(Wh.s.forRoom(n).notificationVolume){case Gh.dC.AllMessages:i=(0,C._t)("notifications|default"),s="mx_RoomTile_iconNotificationsDefault";break;case Gh.dC.AllMessagesLoud:i=(0,C._t)("notifications|all_messages"),s="mx_RoomTile_iconNotificationsAllMessages";break;case Gh.dC.MentionsOnly:i=(0,C._t)("room|context_menu|mentions_only"),s="mx_RoomTile_iconNotificationsMentionsKeywords";break;case Gh.dC.Mute:i=(0,C._t)("common|mute"),s="mx_RoomTile_iconNotificationsNone"}y=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"open_room_settings",room_id:n.roomId,initial_tab_id:ma.e.Notifications}),r(),u.A.trackInteraction("WebRoomHeaderContextMenuNotificationsItem",e)},label:(0,C._t)("notifications|enable_prompt_toast_title"),iconClassName:s},o.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},i))}m||(E=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),P(e),qn.A.instance.pushCard({phase:$n.n.RoomMemberList},!1),r(),u.A.trackInteraction("WebRoomHeaderContextMenuPeopleItem",e)},label:(0,C._t)("common|people"),iconClassName:"mx_RoomTile_iconPeople"},o.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},n.getJoinedMemberCount())),b=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"copy_room",room_id:n.roomId}),r()},label:(0,C._t)("room|context_menu|copy_link"),iconClassName:"mx_RoomTile_iconCopyLink"})),h||(w=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),P(e),qn.A.instance.pushCard({phase:$n.n.FilePanel},!1),r()},label:(0,C._t)("right_panel|files_button"),iconClassName:"mx_RoomTile_iconFiles"}));const A=(0,Ne.ny)("feature_pinning"),S=null===(t=ol(A?n:void 0))||void 0===t?void 0:t.length;let k,R,I;A&&!h&&(k=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),P(e),qn.A.instance.pushCard({phase:$n.n.PinnedMessages},!1),r()},label:(0,C._t)("right_panel|pinned_messages_button"),iconClassName:"mx_RoomTile_iconPins"},S>0&&o.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},S))),h||(R=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),P(e),qn.A.instance.setCard({phase:$n.n.RoomSummary},!1),r()},label:(0,C._t)("right_panel|widgets_section"),iconClassName:"mx_RoomTile_iconWidgets"})),h||(I=o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),f.Ay.createDialog(Oa,{room:n}),r()},label:(0,C._t)("right_panel|export_chat_button"),iconClassName:"mx_RoomTile_iconExport"}));const T=(e,t)=>{e.preventDefault(),e.stopPropagation(),Ba(n,t);if((0,Se.zM)().getAccessibilityAction(e)===Ee.bY.Enter)r()},P=e=>{Xt.M.instance.roomViewStore.getRoomId()!==n.roomId&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:n.roomId,metricsTrigger:"RoomList",metricsViaKeyboard:"click"!==e.type},!0)};return o.createElement(Le.Ay,(0,i.A)({},a,{onFinished:r,className:"mx_RoomTile_contextMenu",compact:!0}),o.createElement(Le.tx,null,p,y,g,E,w,k,R,_,b,o.createElement(Le.R$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v.Ay.dispatch({action:"open_room_settings",room_id:n.roomId}),r(),u.A.trackInteraction("WebRoomHeaderContextMenuSettingsItem",e)},label:(0,C._t)("common|settings"),iconClassName:"mx_RoomTile_iconSettings"}),I,O.A.getValue("developerMode")&&o.createElement(Kh.l,{onFinished:r,roomId:n.roomId}),d))};var $h=n("./node_modules/matrix-react-sdk/src/components/views/rooms/RoomTile.tsx"),Yh=n("./node_modules/matrix-react-sdk/src/stores/notifications/NotificationState.ts"),Qh=n("./node_modules/matrix-react-sdk/src/stores/OwnBeaconStore.ts"),Zh=n("./node_modules/matrix-react-sdk/src/utils/beacon/index.ts"),Xh=n("./node_modules/matrix-react-sdk/src/components/views/beacon/StyledLiveBeaconIcon.tsx"),ep=n("./node_modules/matrix-react-sdk/res/img/image-view/close.svg"),tp=n("./node_modules/matrix-react-sdk/src/components/views/beacon/LiveTimeRemaining.tsx");const np=({liveBeaconIds:e,roomId:t})=>{const{onStopSharing:n,onResetLocationPublishError:i,beacon:r,stoppingInProgress:s,hasStopSharingError:a,hasLocationPublishError:l}=(0,Zh.fA)(e);if(!r)return null;const c=a||l,d=e=>t=>{null==t||t.stopPropagation(),e()};return o.createElement("div",{className:"mx_RoomLiveShareWarning",onClick:()=>{v.Ay.dispatch({action:x.r.ViewRoom,room_id:r.roomId,metricsTrigger:void 0,event_id:r.beaconInfoId,scroll_into_view:!0,highlighted:!0})}},o.createElement(Xh.A,{className:"mx_RoomLiveShareWarning_icon",withError:c}),o.createElement("span",{className:"mx_RoomLiveShareWarning_label"},((e,t)=>e?(0,C._t)("location_sharing|error_sharing_live_location_try_again"):t?(0,C._t)("location_sharing|error_stopping_live_location_try_again"):(0,C._t)("location_sharing|live_location_active"))(l,a)),s&&o.createElement("span",{className:"mx_RoomLiveShareWarning_spinner"},o.createElement(dn.A,{h:16,w:16})),!s&&!c&&o.createElement(tp.A,{beacon:r}),o.createElement(be.A,{className:"mx_RoomLiveShareWarning_stopButton",onClick:d((()=>{l?i():n()})),kind:"danger",element:"button",disabled:s},c?(0,C._t)("action|retry"):(0,C._t)("action|stop")),l&&o.createElement(be.A,{title:(0,C._t)("location_sharing|stop_and_close"),element:"button",className:"mx_RoomLiveShareWarning_closeButton",onClick:d(n)},o.createElement(ep.I,{className:"mx_RoomLiveShareWarning_closeButtonIcon"})))},ip=({roomId:e})=>{const t=(0,Pe.dF)(Qh.g.instance,Qh.q.MonitoringLivePosition,(()=>Qh.g.instance.isMonitoringLiveLocation)),n=(0,Pe.dF)(Qh.g.instance,Qh.q.LivenessChange,(()=>Qh.g.instance.getLiveBeaconIds(e)));return t&&n.length?o.createElement(np,{liveBeaconIds:n,roomId:e}):null};var rp=n("./node_modules/matrix-react-sdk/src/hooks/useCall.ts"),op=n("./node_modules/matrix-react-sdk/src/utils/room/getJoinedNonFunctionalMembers.ts"),sp=n("./node_modules/matrix-react-sdk/src/models/Call.ts"),ap=n("./node_modules/matrix-react-sdk/src/components/views/voip/CallDuration.tsx");const lp=({roomId:e,call:t})=>{const n=(0,o.useCallback)((t=>{t.preventDefault(),v.bA.dispatch({action:x.r.ViewRoom,room_id:e,view_call:!0,skipLobby:"shiftKey"in t&&t.shiftKey,metricsTrigger:void 0})}),[e]),i=(0,o.useCallback)((()=>{l.v.log("clicking on the call banner is not supported anymore - there are no timeline events anymore."),l.v.error("Couldn't find a group call event to jump to")}),[e]);return o.createElement("div",{className:"mx_RoomCallBanner",onClick:i},o.createElement("div",{className:"mx_RoomCallBanner_text"},o.createElement("span",{className:"mx_RoomCallBanner_label"},(0,C._t)("voip|video_call")),o.createElement(ap.R,{session:t.session})),o.createElement(be.A,{onClick:n,kind:"primary",element:"button",disabled:!1},(0,C._t)("action|join")))},cp=({roomId:e})=>{const t=(0,rp.Gc)(e),n=(0,Pe.dF)(Qh.g.instance,Qh.q.MonitoringLivePosition,(()=>Qh.g.instance.isMonitoringLiveLocation)),i=(0,Pe.dF)(Qh.g.instance,Qh.q.LivenessChange,(()=>Qh.g.instance.getLiveBeaconIds(e)));return n&&i.length||Xt.M.instance.roomViewStore.isViewingCall()?null:null!==t&&t.connectionState===sp.KN.Disconnected?o.createElement(lp,{call:t,roomId:e}):null};class dp{constructor(e){this.reason=e}}const up=({room:e,busy:t,setBusy:n,behavior:i})=>{const{onClick:r,tooltip:s,disabled:a}=(0,o.useMemo)((()=>i instanceof dp?{onClick:()=>{},tooltip:i.reason,disabled:!0}:{onClick:async t=>{t.preventDefault(),n(!0),await fe.Ay.instance.placeCall(e.roomId,So.JG.Voice),n(!1)},disabled:!1}),[i,e,n]);return o.createElement(be.A,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_voiceCallButton",onClick:r,"aria-label":(0,C._t)("voip|voice_call"),title:null!=s?s:(0,C._t)("voip|voice_call"),placement:"bottom",disabled:a||t})},mp=({room:e,busy:t,setBusy:n,behavior:r})=>{const[s,a,l,c]=(0,Me.EF)(),d=(0,o.useCallback)((async()=>{n(!0),await fe.Ay.instance.placeCall(e.roomId,So.JG.Video),n(!1)}),[n,e]),u=(0,o.useCallback)((t=>{n(!0),v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.roomId,view_call:!0,skipLobby:t,metricsTrigger:void 0}),n(!1)}),[n,e]),{onClick:m,tooltip:h,disabled:p}=(0,o.useMemo)((()=>r instanceof dp?{onClick:()=>{},tooltip:r.reason,disabled:!0}:"legacy_or_jitsi"===r?{onClick:async e=>{e.preventDefault(),await d()},disabled:!1}:"element"===r?{onClick:async e=>{e.preventDefault(),u("shiftKey"in e&&e.shiftKey)},disabled:!1}:{onClick:async e=>{e.preventDefault(),l()},disabled:!1}),[r,d,u,l]),_=(0,o.useCallback)((async e=>{e.preventDefault(),c(),await d()}),[c,d]),f=(0,o.useCallback)((e=>{e.preventDefault(),c(),u("shiftKey"in e&&e.shiftKey)}),[c,u]);let y=null;if(s){const e=a.current.getBoundingClientRect(),t=g.Ay.get("element_call").brand;y=o.createElement(Le.Ay,(0,i.A)({},(0,Me.qv)(e),{onFinished:c}),o.createElement(Le.tx,null,o.createElement(Le.R$,{label:"legacy_or_element"==r?(0,C._t)("room|header|video_call_button_legacy"):(0,C._t)("room|header|video_call_button_jitsi"),onClick:_}),o.createElement(Le.R$,{label:(0,C._t)("room|header|video_call_button_ec",{brand:t}),onClick:f})))}return o.createElement(o.Fragment,null,o.createElement(be.A,{ref:a,className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_videoCallButton",onClick:m,"aria-label":(0,C._t)("voip|video_call"),title:null!=h?h:(0,C._t)("voip|video_call"),placement:"bottom",disabled:p||t}),y)},hp=({room:e})=>{const[t,n]=(0,o.useState)(!1),i=(0,Ne.ti)("showCallButtonsInComposer"),r=(0,Ne.ny)("feature_group_calls"),a=(0,Ne.ny)("feature_video_rooms"),l=(0,o.useMemo)((()=>a&&(0,el.j)(e)),[a,e]),c=(0,o.useMemo)((()=>g.Ay.get("element_call").use_exclusively),[]),d=(0,Pe.dF)(fe.Ay.instance,fe.uv.CallsChanged,(0,o.useCallback)((()=>null!==fe.Ay.instance.getCallForRoom(e.roomId)),[e])),u=(0,vl.X)(e),m=(0,o.useMemo)((()=>u.some((e=>Tl.x.JITSI.matches(e.type)))),[u]),h=null!==(0,rp.Gc)(e.roomId),[p,v,_]=(0,Pe.DY)(e,s.RoomStateEvent.Update,(0,o.useCallback)((()=>[(0,op.T)(e),e.currentState.mayClientSendStateEvent("im.vector.modular.widgets",e.client),e.currentState.mayClientSendStateEvent(sp.Ho.CALL_EVENT_TYPE.name,e.client)]),[e])),f=i=>o.createElement(up,{room:e,busy:t,setBusy:n,behavior:i}),y=i=>o.createElement(mp,{room:e,busy:t,setBusy:n,behavior:i});if(l||!i)return null;if(r){if(c)return y(h?new dp((0,C._t)("voip|disabled_ongoing_call")):_?"element":new dp((0,C._t)("voip|disabled_no_perms_start_video_call")));if(d||m)return o.createElement(o.Fragment,null,f(new dp((0,C._t)("voip|disabled_ongoing_call"))),y(new dp((0,C._t)("voip|disabled_ongoing_call"))));if(p.length<=1)return o.createElement(o.Fragment,null,f(new dp((0,C._t)("voip|disabled_no_one_here"))),y(new dp((0,C._t)("voip|disabled_no_one_here"))));if(2===p.length)return o.createElement(o.Fragment,null,f("legacy_or_jitsi"),y("legacy_or_element"));if(v)return o.createElement(o.Fragment,null,f("legacy_or_jitsi"),y(_?"jitsi_or_element":"legacy_or_jitsi"));{const e=_?"element":new dp((0,C._t)("voip|disabled_no_perms_start_video_call"));return o.createElement(o.Fragment,null,f(new dp((0,C._t)("voip|disabled_no_perms_start_voice_call"))),y(e))}}return d||m?o.createElement(o.Fragment,null,f(new dp((0,C._t)("voip|disabled_ongoing_call"))),y(new dp((0,C._t)("voip|disabled_ongoing_call")))):p.length<=1?o.createElement(o.Fragment,null,f(new dp((0,C._t)("voip|disabled_no_one_here"))),y(new dp((0,C._t)("voip|disabled_no_one_here")))):2===p.length||v?o.createElement(o.Fragment,null,f("legacy_or_jitsi"),y("legacy_or_jitsi")):o.createElement(o.Fragment,null,f(new dp((0,C._t)("voip|disabled_no_perms_start_voice_call"))),y(new dp((0,C._t)("voip|disabled_no_perms_start_video_call"))))},pp=({call:e})=>{const t=(0,rp.gK)(e),[n,r,s,a]=(0,Me.EF)(),l=(0,o.useCallback)((e=>{e.preventDefault(),s()}),[s]),c=(0,o.useCallback)((t=>{t.preventDefault(),a(),e.setLayout(sp.PE.Tile)}),[a,e]),d=(0,o.useCallback)((t=>{t.preventDefault(),a(),e.setLayout(sp.PE.Spotlight)}),[a,e]);let u=null;if(n){const e=r.current.getBoundingClientRect();u=o.createElement(Le.Ay,(0,i.A)({className:"mx_LegacyRoomHeader_layoutMenu"},(0,Me.qv)(e),{onFinished:a}),o.createElement(Le.tx,null,o.createElement(Le.h6,{iconClassName:"mx_LegacyRoomHeader_freedomIcon",label:(0,C._t)("room|header|video_call_ec_layout_freedom"),active:t===sp.PE.Tile,onClick:c}),o.createElement(Le.h6,{iconClassName:"mx_LegacyRoomHeader_spotlightIcon",label:(0,C._t)("room|header|video_call_ec_layout_spotlight"),active:t===sp.PE.Spotlight,onClick:d})))}return o.createElement(o.Fragment,null,o.createElement(be.A,{ref:r,className:ee()("mx_LegacyRoomHeader_button",{"mx_LegacyRoomHeader_layoutButton--freedom":t===sp.PE.Tile,"mx_LegacyRoomHeader_layoutButton--spotlight":t===sp.PE.Spotlight}),onClick:l,title:(0,C._t)("room|header|video_call_ec_change_layout"),placement:"bottom",key:"layout"}),u)};class gp extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"client",this.props.room.client),(0,r.A)(this,"featureAskToJoinWatcher",void 0),(0,r.A)(this,"onRightPanelStoreUpdate",(()=>{this.setState({rightPanelOpen:qn.A.instance.isOpen})})),(0,r.A)(this,"onRoomStateEvents",(e=>{this.props.room&&e.getRoomId()===this.props.room.roomId&&this.rateLimitedUpdate()})),(0,r.A)(this,"onNotificationUpdate",(()=>{this.forceUpdate()})),(0,r.A)(this,"rateLimitedUpdate",(0,c.throttle)((()=>{this.forceUpdate()}),500,{leading:!0,trailing:!0})),(0,r.A)(this,"onContextMenuOpenClick",(e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})})),(0,r.A)(this,"onContextMenuCloseClick",(()=>{this.setState({contextMenuPosition:void 0})})),(0,r.A)(this,"onHideCallClick",(e=>{e.preventDefault(),v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.props.room.roomId,view_call:!1,metricsTrigger:void 0})}));st.n.instance.getRoomState(e.room).on(Yh.ce.Update,this.onNotificationUpdate),this.state={rightPanelOpen:qn.A.instance.isOpen,featureAskToJoin:O.A.getValue("feature_ask_to_join")},this.featureAskToJoinWatcher=O.A.watchSetting("feature_ask_to_join",null,((e,t,n,i,r)=>{this.setState({featureAskToJoin:r})}))}componentDidMount(){this.client.on(s.RoomStateEvent.Events,this.onRoomStateEvents),qn.A.instance.on(A.H,this.onRightPanelStoreUpdate)}componentWillUnmount(){this.client.removeListener(s.RoomStateEvent.Events,this.onRoomStateEvents);st.n.instance.getRoomState(this.props.room).removeListener(Yh.ce.Update,this.onNotificationUpdate),qn.A.instance.off(A.H,this.onRightPanelStoreUpdate),O.A.unwatchSetting(this.featureAskToJoinWatcher)}renderButtons(e){var t;const n=[];this.props.viewingCall||!this.props.inRoom||this.context.tombstone||n.push(o.createElement(hp,{key:"calls",room:this.props.room})),this.props.viewingCall&&this.props.activeCall instanceof sp.Ho&&n.push(o.createElement(pp,{key:"layout",call:this.props.activeCall})),!this.props.viewingCall&&this.props.onForgetClick&&n.push(o.createElement(be.A,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_forgetButton",onClick:this.props.onForgetClick,title:(0,C._t)("room|header|forget_room_button"),placement:"bottom",key:"forget"})),!this.props.viewingCall&&this.props.onAppsClick&&n.push(o.createElement(be.A,{className:ee()("mx_LegacyRoomHeader_button mx_LegacyRoomHeader_appsButton",{mx_LegacyRoomHeader_appsButton_highlight:this.props.appsShown}),onClick:this.props.onAppsClick,title:this.props.appsShown?(0,C._t)("room|header|hide_widgets_button"):(0,C._t)("room|header|show_widgets_button"),"aria-checked":this.props.appsShown,placement:"bottom",key:"apps"})),!this.props.viewingCall&&this.props.onSearchClick&&this.props.inRoom&&n.push(o.createElement(be.A,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_searchButton",onClick:this.props.onSearchClick,title:(0,C._t)("action|search"),placement:"bottom",key:"search"})),this.props.onInviteClick&&(!this.props.viewingCall||e)&&this.props.inRoom&&n.push(o.createElement(be.A,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_inviteButton",onClick:this.props.onInviteClick,title:(0,C._t)("action|invite"),placement:"bottom",key:"invite"}));const i=[];return this.props.viewingCall&&!e&&(null===this.props.activeCall?i.push(o.createElement(be.A,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_closeButton",onClick:this.onHideCallClick,title:(0,C._t)("room|header|close_call_button"),key:"close"})):i.push(o.createElement(be.A,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_minimiseButton",onClick:this.onHideCallClick,title:(0,C._t)("room|header|video_room_view_chat_button"),placement:"bottom",key:"minimise"}))),o.createElement(o.Fragment,null,null===(t=this.props.additionalButtons)||void 0===t?void 0:t.map((e=>{const t=e.label();return o.createElement(ke.m_,{label:t,key:e.id},o.createElement(ke.K0,{onClick:()=>{e.onClick(),this.forceUpdate()},title:t},"function"==typeof e.icon?e.icon():e.icon))})),n,o.createElement(Bh,{room:this.props.room,excludedRightPanelPhaseButtons:this.props.excludedRightPanelPhaseButtons}),i)}renderName(e){let t=null;this.state.contextMenuPosition&&this.props.room&&(t=o.createElement(qh,(0,i.A)({},(0,$h._E)(this.state.contextMenuPosition),{room:this.props.room,onFinished:this.onContextMenuCloseClick})));let n=!1;const r=this.props.room?this.props.room.getJoinedMembers():void 0;if(r&&1===r.length&&r[0].userId===this.client.credentials.userId){const e=this.props.room.currentState.getStateEvents("m.room.name","");e&&e.getContent().name||(n=!0)}const s=ee()("mx_LegacyRoomHeader_nametext",{mx_LegacyRoomHeader_settingsHint:n}),a=o.createElement(ys.A,{room:this.props.room},(t=>{const n=t||e;return o.createElement("div",{dir:"auto",className:s,title:n,role:"heading","aria-level":1},n)}));return this.props.enableRoomOptionsMenu&&(0,Ie.g)(W.C.RoomOptionsMenu)?o.createElement(Me.oW,{className:"mx_LegacyRoomHeader_name",onClick:this.onContextMenuOpenClick,isExpanded:!!this.state.contextMenuPosition,title:(0,C._t)("room|context_menu|title"),placement:"bottom"},a,this.props.room&&o.createElement("div",{className:"mx_LegacyRoomHeader_chevron"}),t):o.createElement("div",{className:"mx_LegacyRoomHeader_name mx_LegacyRoomHeader_name--textonly"},a)}render(){var e;const t=O.A.getValue("feature_video_rooms")&&(0,el.j)(this.props.room);let n=null;this.props.room&&(n=o.createElement(Jn.A,{room:this.props.room,size:"24px",oobData:this.props.oobData,viewAvatarOnClick:!0}));const i=this.props.viewingCall?o.createElement("div",{className:"mx_LegacyRoomHeader_icon mx_LegacyRoomHeader_icon_video"}):this.props.e2eStatus?o.createElement(Zc.A,{className:"mx_LegacyRoomHeader_icon",status:this.props.e2eStatus,tooltipPlacement:"bottom"}):this.client.isRoomEncrypted(this.props.room.roomId)&&this.client.isCryptoEnabled()?o.createElement("div",{className:"mx_LegacyRoomHeader_icon"}):null,r=this.props.showButtons?this.renderButtons(t):null;let s=(0,C._t)("common|unnamed_room");this.props.oobData&&this.props.oobData.name&&(s=this.props.oobData.name);const a=this.renderName(s);var l;if(this.props.viewingCall&&!t)return o.createElement("header",{className:"mx_LegacyRoomHeader light-panel"},o.createElement("div",{className:"mx_LegacyRoomHeader_wrapper","aria-owns":this.state.rightPanelOpen?"mx_RightPanel":void 0},o.createElement("div",{className:"mx_LegacyRoomHeader_avatar"},n),i,a,this.props.activeCall instanceof sp.Ho&&o.createElement(ap.R,{session:null===(l=this.props.activeCall)||void 0===l?void 0:l.session}),o.createElement("div",{className:"mx_LegacyRoomHeader_topic"}),r));let c=null;"number"==typeof(null===(e=this.props.searchInfo)||void 0===e?void 0:e.count)&&(c=o.createElement("div",{className:"mx_LegacyRoomHeader_searchStatus"}," ",(0,C._t)("room|search|result_count",{count:this.props.searchInfo.count})));const d=o.createElement(Xa,{room:this.props.room,className:"mx_LegacyRoomHeader_topic"}),u=t?o.createElement(Oe.s,{onClick:()=>v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Labs}),tooltipTitle:(0,C._t)("labs|video_rooms_beta")}):null;return o.createElement("header",{className:"mx_LegacyRoomHeader light-panel"},o.createElement("div",{className:"mx_LegacyRoomHeader_wrapper","aria-owns":this.state.rightPanelOpen?"mx_RightPanel":void 0},o.createElement("div",{className:"mx_LegacyRoomHeader_avatar"},n),i,a,c,d,u,r),!t&&o.createElement(cp,{roomId:this.props.room.roomId}),o.createElement(ip,{roomId:this.props.room.roomId}),this.state.featureAskToJoin&&o.createElement(zh,{room:this.props.room}))}}var vp;function _p(){return _p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_p.apply(null,arguments)}(0,r.A)(gp,"defaultProps",{inRoom:!1,excludedRightPanelPhaseButtons:[],showButtons:!0,enableRoomOptionsMenu:!0}),(0,r.A)(gp,"contextType",Zr.Ay);var fp=function(e,t){return o.createElement("svg",_p({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),vp||(vp=o.createElement("path",{d:"m20.958 16.374.039 3.527q0 .427-.33.756-.33.33-.756.33a16 16 0 0 1-6.57-1.105 16.2 16.2 0 0 1-5.563-3.663 16.1 16.1 0 0 1-3.653-5.573 16.3 16.3 0 0 1-1.115-6.56q0-.427.33-.757T4.095 3l3.528.039a1.07 1.07 0 0 1 1.085.93l.543 3.954q.039.271-.039.504a1.1 1.1 0 0 1-.271.426l-1.64 1.64q.505 1.008 1.154 1.909c.433.6 1.444 1.696 1.444 1.696s1.095 1.01 1.696 1.444q.9.65 1.909 1.153l1.64-1.64a1.1 1.1 0 0 1 .426-.27q.232-.078.504-.04l3.954.543a1.07 1.07 0 0 1 .93 1.085Z"})))},yp=(0,o.forwardRef)(fp);var Ep,bp=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/close.js");function wp(){return wp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},wp.apply(null,arguments)}var xp=function(e,t){return o.createElement("svg",wp({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Ep||(Ep=o.createElement("path",{d:"M12 17a.97.97 0 0 0 .713-.288A.97.97 0 0 0 13 16v-4a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 11a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 12v4q0 .424.287.712.288.288.713.288m0-8q.424 0 .713-.287A.97.97 0 0 0 13 8a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 7a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 8q0 .424.287.713Q11.575 9 12 9m0 13a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12a9.7 9.7 0 0 1 .788-3.9 10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2a9.7 9.7 0 0 1 3.9.788 10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22"})))},Ap=(0,o.forwardRef)(xp);var Sp;function Cp(){return Cp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Cp.apply(null,arguments)}var kp=function(e,t){return o.createElement("svg",Cp({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Sp||(Sp=o.createElement("path",{d:"M20.293 17.293c.63.63.184 1.707-.707 1.707H4.414c-.89 0-1.337-1.077-.707-1.707L5 16v-6s0-7 7-7 7 7 7 7v6zM12 22a2 2 0 0 1-2-2h4a2 2 0 0 1-2 2"})))},Rp=(0,o.forwardRef)(kp);function Ip(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M8.15 21.75 6.7 19.3l-2.75-.6a.943.943 0 0 1-.6-.387.928.928 0 0 1-.175-.688L3.45 14.8l-1.875-2.15a.934.934 0 0 1-.25-.65c0-.25.083-.467.25-.65L3.45 9.2l-.275-2.825a.928.928 0 0 1 .175-.688.943.943 0 0 1 .6-.387l2.75-.6 1.45-2.45a.983.983 0 0 1 .55-.438.97.97 0 0 1 .7.038l2.6 1.1 2.6-1.1a.97.97 0 0 1 .7-.038.983.983 0 0 1 .55.438L17.3 4.7l2.75.6c.25.05.45.18.6.388.15.208.208.437.175.687L20.55 9.2l1.875 2.15c.167.183.25.4.25.65s-.083.467-.25.65L20.55 14.8l.275 2.825a.928.928 0 0 1-.175.688.943.943 0 0 1-.6.387l-2.75.6-1.45 2.45a.983.983 0 0 1-.55.438.97.97 0 0 1-.7-.038l-2.6-1.1-2.6 1.1a.97.97 0 0 1-.7.038.983.983 0 0 1-.55-.438Zm2.8-9.05L9.5 11.275A.933.933 0 0 0 8.813 11c-.275 0-.513.1-.713.3a.948.948 0 0 0-.275.7.95.95 0 0 0 .275.7l2.15 2.15c.2.2.433.3.7.3.267 0 .5-.1.7-.3l4.25-4.25c.2-.2.296-.433.287-.7a1.055 1.055 0 0 0-.287-.7 1.02 1.02 0 0 0-.713-.313.93.93 0 0 0-.712.288L10.95 12.7Z"})})}Ip.displayName="VerifiedIcon";const Tp=(0,o.forwardRef)(Ip),Pp=(e,t="")=>(null==e?void 0:e.name)||t;const Np=async(e,t,n,i)=>{n==Lp.LegacyCall||n==Lp.JitsiCall?await fe.Ay.instance.placeCall(e.roomId,t):n==Lp.ElementCall&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.roomId,view_call:!0,skipLobby:i,metricsTrigger:void 0})};var Dp=n("./node_modules/matrix-react-sdk/src/widgets/ManagedHybrid.ts"),Mp=n("./node_modules/matrix-react-sdk/src/stores/CallStore.ts");const Op=e=>{const t=(0,o.useMemo)((()=>g.Ay.get("element_call").guest_spa_url),[]),{joinRule:n,canInvite:i,canChangeJoinRule:r}=(0,za.U)(e,(t=>({joinRule:e.getJoinRule(),canInvite:e.canInvite(e.myUserId),canChangeJoinRule:t.maySendStateEvent(s.EventType.RoomJoinRules,e.myUserId)}))),a=(0,o.useMemo)((()=>n===s.JoinRule.Public||n===s.JoinRule.Knock&&i),[i,n]);return{canInviteGuests:(0,o.useMemo)((()=>(r||a)&&void 0!==t),[r,a,t]),guestSpaUrl:t,isRoomJoinable:()=>{const t=e.getJoinRule();return t===s.JoinRule.Public||t===s.JoinRule.Knock&&e.canInvite(e.myUserId)},canInvite:i}};let Lp=function(e){return e[e.ElementCall=0]="ElementCall",e[e.JitsiCall=1]="JitsiCall",e[e.LegacyCall=2]="LegacyCall",e}({});const Up=e=>{switch(e){case Lp.ElementCall:return(0,C._t)("voip|element_call");case Lp.JitsiCall:return(0,C._t)("voip|jitsi_call");case Lp.LegacyCall:return(0,C._t)("voip|legacy_call")}};var Fp=function(e){return e[e.NoCall=0]="NoCall",e[e.NoOneHere=1]="NoOneHere",e[e.NoPermission=2]="NoPermission",e[e.Unpinned=3]="Unpinned",e[e.Ongoing=4]="Ongoing",e[e.NotJoined=5]="NotJoined",e}(Fp||{});const jp=e=>{var t,n;const i=(0,Ne.ny)("feature_group_calls"),r=(0,o.useMemo)((()=>g.Ay.get("element_call").use_exclusively),[]),s=(0,Pe.dF)(fe.Ay.instance,fe.uv.CallsChanged,(()=>null!==fe.Ay.instance.getCallForRoom(e.roomId))),a=(0,vl.X)(e),l=(0,o.useMemo)((()=>a.find((e=>Tl.x.JITSI.matches(e.type)))),[a]),c=!!l,d=(0,o.useMemo)((()=>a.find(Dp.ec)),[a]),u=!!d,m=(0,rp.Gc)(e.roomId),h=(0,rp.jd)(m)===sp.KN.Connected,p=null!==m,_=(0,rp.q0)(m)>0,f=(0,Pe.dF)(Xt.M.instance.roomViewStore,A.H,(()=>Xt.M.instance.roomViewStore.isViewingCall()||(0,el.j)(e))),y=Um(e),[E,b]=(0,za.U)(e,(()=>[e.currentState.mayClientSendStateEvent("im.vector.modular.widgets",e.client),e.currentState.mayClientSendStateEvent(sp.Ho.MEMBER_EVENT_TYPE.name,e.client)])),w=(0,o.useMemo)((()=>{const e=[];if(y<=2?e.push(Lp.LegacyCall):(E||c)&&e.push(Lp.JitsiCall),i){if((p||b)&&e.push(Lp.ElementCall),r&&!c)return[Lp.ElementCall];if(p&&Tl.x.CALL.matches(m.widget.type))return[Lp.ElementCall]}return e}),[y,E,c,i,p,b,r,null==m?void 0:m.widget.type]);let S;var k;((w.includes(Lp.JitsiCall)||w.includes(Lp.LegacyCall))&&(S=null!=l?l:d),w.includes(Lp.ElementCall))?S=null==m?void 0:m.widget:S=null!==(k=null==m?void 0:m.widget)&&void 0!==k?k:l;const R=(0,o.useCallback)((()=>{T(hc.aK.instance.canAddToContainer(e,hc.mc.Top)),N(!!S&&hc.aK.instance.isInContainer(e,S,hc.mc.Top))}),[e,S]);(0,Pe.ml)(hc.aK.instance,hc.aK.emissionForRoom(e),R),(0,o.useEffect)((()=>{R()}),[e,l,m,R]);const[I,T]=(0,o.useState)(!1),[P,N]=(0,o.useState)(!1),D=!Tl.x.CALL.matches(null!==(t=null===(n=S)||void 0===n?void 0:n.type)&&void 0!==t?t:"")&&I&&!P,M=(0,Pe.dF)(Mp.e.instance,Mp.s.ConnectedCalls,(()=>Array.from(Mp.e.instance.connectedCalls))),{canInviteGuests:L}=Op(e),U=(0,o.useMemo)((()=>M.find((t=>t.roomId!=e.roomId))?Fp.Ongoing:p&&(c||u)?D?Fp.Unpinned:Fp.Ongoing:s?Fp.Ongoing:y<=1&&!L?Fp.NoOneHere:b||E?Fp.NoCall:Fp.NoPermission),[M,L,p,c,s,u,b,E,y,D,e.roomId]),F=(0,o.useCallback)(((t,n)=>{var i;(null==t||t.stopPropagation(),S&&D)?hc.aK.instance.moveToContainer(e,S,hc.mc.Top):Np(e,So.JG.Voice,n,null!==(i=null==t?void 0:t.shiftKey)&&void 0!==i&&i)}),[D,e,S]),j=(0,o.useCallback)(((t,n)=>{var i;(null==t||t.stopPropagation(),S&&D)?hc.aK.instance.moveToContainer(e,S,hc.mc.Top):Np(e,So.JG.Video,n,null!==(i=null==t?void 0:t.shiftKey)&&void 0!==i&&i)}),[S,D,e]);let B,V;switch(U){case Fp.NoPermission:B=(0,C._t)("voip|disabled_no_perms_start_voice_call"),V=(0,C._t)("voip|disabled_no_perms_start_video_call");break;case Fp.Ongoing:B=(0,C._t)("voip|disabled_ongoing_call"),V=(0,C._t)("voip|disabled_ongoing_call");break;case Fp.NoOneHere:B=(0,C._t)("voip|disabled_no_one_here"),V=(0,C._t)("voip|disabled_no_one_here");break;case Fp.Unpinned:case Fp.NotJoined:case Fp.NoCall:B=null,V=null}const H=(0,o.useCallback)((()=>{v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.roomId,metricsTrigger:void 0,view_call:!f})}),[f,e.roomId]);let z=(0,Dp.dq)(e)||!w.includes(Lp.LegacyCall),G=!1;return y>2&&!O.A.getValue(W.f.Widgets)&&(z=!0,G=!0),{voiceCallDisabledReason:B,voiceCallClick:F,videoCallDisabledReason:V,videoCallClick:j,toggleCallMaximized:H,isViewingCall:f,isConnectedToCall:h,hasActiveCallSession:_,callOptions:w,showVoiceCallButton:!z,showVideoCallButton:!G}},Bp=e=>{const[t,n]=(0,o.useState)(Qe.S.None),i=(0,o.useCallback)((()=>{switch(null==e?void 0:e.threadsAggregateNotificationType){case s.NotificationCountType.Highlight:return void n(Qe.S.Highlight);case s.NotificationCountType.Total:return void n(Qe.S.Notification)}(0,Yn.Nb)(e)?n(Qe.S.Activity):n(Qe.S.None)}),[e]);return(0,Pe.ml)(e,s.RoomEvent.UnreadNotifications,i),(0,Pe.ml)(e,s.RoomEvent.Receipt,i),(0,Pe.ml)(e,s.RoomEvent.Timeline,i),(0,Pe.ml)(e,s.RoomEvent.Redaction,i),(0,Pe.ml)(e,s.RoomEvent.LocalEchoUpdated,i),(0,Pe.ml)(e,s.RoomEvent.MyMembership,i),(0,Pe.ml)(e,s.ThreadEvent.New,i),(0,Pe.ml)(e,s.ThreadEvent.Update,i),(0,o.useEffect)((()=>{i()}),[i]),t},Vp=()=>{const[e,t]=(0,o.useState)(st.n.instance.globalState);return(0,Pe.ml)(st.n.instance,st.N,(e=>{t(e)})),e};var Hp;function zp(){return zp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},zp.apply(null,arguments)}var Wp=function(e,t){return o.createElement("svg",zp({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Hp||(Hp=o.createElement("path",{d:"M2.95 16.3 1.5 21.25a.94.94 0 0 0 .25 1 .94.94 0 0 0 1 .25l4.95-1.45a10.2 10.2 0 0 0 2.1.712Q10.875 22 12 22a9.7 9.7 0 0 0 3.9-.788 10.1 10.1 0 0 0 3.175-2.137q1.35-1.35 2.137-3.175A9.7 9.7 0 0 0 22 12a9.7 9.7 0 0 0-.788-3.9 10.1 10.1 0 0 0-2.137-3.175q-1.35-1.35-3.175-2.137A9.7 9.7 0 0 0 12 2a9.7 9.7 0 0 0-3.9.788 10.1 10.1 0 0 0-3.175 2.137Q3.575 6.275 2.788 8.1A9.7 9.7 0 0 0 2 12a10.2 10.2 0 0 0 .95 4.3"})))},Gp=(0,o.forwardRef)(Wp);const Kp=({room:e})=>{const t=(0,o.useContext)(Xt.A),n=t.roomNotificationStateStore.getRoomState(e),i=(0,Pe.dF)(n,Yh.ce.Update,(()=>null==n?void 0:n.level)),r=!!i&&[Qe.S.Activity,Qe.S.Notification,Qe.S.Highlight].includes(i);return o.createElement(ke.m_,{label:(0,C._t)("right_panel|video_room_chat|title")},o.createElement(ke.K0,{"aria-label":(0,C._t)("right_panel|video_room_chat|title"),onClick:e=>{e.stopPropagation(),t.rightPanelStore.showOrHidePanel($n.n.Timeline)},indicator:r?"default":void 0},o.createElement(Gp,null)))},Jp=({room:e})=>{const{canInviteGuests:t,guestSpaUrl:n,isRoomJoinable:i,canInvite:r}=Op(e),s=(0,o.useCallback)((()=>{if(!i())throw new Error("Cannot create link for room that users can not join without invite.");if(!n)throw new Error("No guest SPA url for external links provided.");const t=new URL(n);t.pathname="/room/",t.searchParams.set("roomId",e.roomId),e.hasEncryptionStateEvent()&&t.searchParams.set("perParticipantE2EE","true");for(const n of(0,Po.Ex)(e))t.searchParams.set("viaServers",n);return t.hash="/"+e.name+t.search,t.search="",l.v.info("Generated element call external url:",t),t}),[n,i,e]),a=(0,o.useCallback)((()=>{try{const e=s();f.Ay.createDialog(_s.A,{target:e,customTitle:(0,C._t)("share|share_call"),subtitle:(0,C._t)("share|share_call_subtitle")})}catch(e){l.v.error("Could not generate call link.",e)}}),[s]),c=(0,o.useCallback)((()=>{i()?a():f.Ay.createDialog(qp,{room:e,canInvite:r}).finished.then((()=>{i()&&a()}))}),[i,a,e,r]);return o.createElement(o.Fragment,null,t&&o.createElement(ke.m_,{label:(0,C._t)("voip|get_call_link")},o.createElement(ke.K0,{onClick:c,"aria-label":(0,C._t)("voip|get_call_link")},o.createElement(Bo,null))))},qp=({onFinished:e,room:t,canInvite:n})=>{const i=O.A.getValue("feature_ask_to_join"),[r,a]=o.useState(void 0),l=(0,o.useCallback)((async n=>{void 0===r&&(a(n),await t.client.sendStateEvent(t.roomId,s.EventType.RoomJoinRules,{join_rule:n},""),setTimeout((()=>e()),500))}),[r,e,t.client,t.roomId]);return o.createElement(cn.A,{title:(0,C._t)("update_room_access_modal|title"),onFinished:e,className:"mx_JoinRuleDialog"},o.createElement("p",null,(0,C._t)("update_room_access_modal|description")),o.createElement("div",{className:"mx_JoinRuleDialogButtons"},i&&n&&o.createElement(ke.$n,{kind:"secondary",className:"mx_Dialog_nonDialogButton",disabled:r===s.JoinRule.Knock,onClick:()=>l(s.JoinRule.Knock)},(0,C._t)("action|ask_to_join")),o.createElement(ke.$n,{className:"mx_Dialog_nonDialogButton",kind:"destructive",disabled:r===s.JoinRule.Public,onClick:()=>l(s.JoinRule.Public)},(0,C._t)("common|public"))),o.createElement("p",null,(0,C._t)("update_room_access_modal|dont_change_description")),o.createElement("div",{className:"mx_JoinRuleDialogButtons"},o.createElement(ke.$n,{kind:"tertiary",className:"mx_Dialog_nonDialogButton",onClick:()=>{void 0===r&&e()}},(0,C._t)("update_room_access_modal|no_change"))))};var $p=n("./node_modules/matrix-react-sdk/src/utils/presence.ts"),Yp=n("./node_modules/matrix-react-sdk/src/components/views/rooms/PresenceLabel.tsx"),Qp=function(e){return e.Online="ONLINE",e.Away="AWAY",e.Offline="OFFLINE",e.Busy="BUSY",e}(Qp||{});function Zp(e){switch(e){case Qp.Online:return(0,C._t)("presence|online");case Qp.Away:return(0,C._t)("presence|away");case Qp.Offline:return(0,C._t)("presence|offline");case Qp.Busy:return(0,C._t)("presence|busy")}}function Xp(e){const t=Ti.A.shared().getUserIdForRoomId(e.roomId);return t?e.getMember(t):null}const eg=e=>{const[t,n]=(0,o.useState)(Xp(e)),i=()=>{n(Xp(e))};return(0,Pe.ml)(e.currentState,s.RoomStateEvent.Members,i),(0,Pe.ml)(e.client,s.ClientEvent.AccountData,i),(0,o.useEffect)(i,[e]),t};function tg(e){if(null==e||!e.user)return null;const t=e.user.presence,n=e.user.currentlyActive||"online"===t;return Yp.I.matches(e.user.presence)?Qp.Busy:n?Qp.Online:"offline"===t?Qp.Offline:"unavailable"===t?Qp.Away:null}const ng=({room:e,size:t,tooltipProps:n,children:i})=>{const r=((e,t)=>{const[n,i]=(0,o.useState)(tg(t)),r=()=>{i(tg(t))};return(0,Pe.ml)(null==t?void 0:t.user,s.UserEvent.Presence,r),(0,Pe.ml)(null==t?void 0:t.user,s.UserEvent.CurrentlyActive,r),(0,o.useEffect)(r,[t]),2===(0,op.T)(e).length&&(0,$p.T)(e.client)?n:null})(e,eg(e));let a;var l;r&&(a=o.createElement("div",{tabIndex:null!==(l=null==n?void 0:n.tabIndex)&&void 0!==l?l:0,className:`mx_WithPresenceIndicator_icon mx_WithPresenceIndicator_icon_${r.toLowerCase()}`,style:{width:t,height:t}}));return r?o.createElement("div",{className:"mx_WithPresenceIndicator"},i,o.createElement(ke.m_,{label:Zp(r),placement:"bottom"},a)):o.createElement(o.Fragment,null,i)};function ig({room:e,additionalButtons:t,oobData:n}){const i=(0,Re.nH)(),r=function(e,t){let n=(0,C._t)("common|unnamed_room");t&&t.name&&(n=t.name);const[i,r]=(0,o.useState)(Pp(e,n));return(0,Pe.YK)(e,s.RoomEvent.Name,(()=>{r(Pp(e,n))})),(0,o.useEffect)((()=>{r(Pp(e,n))}),[e,n]),i}(e),a=(0,za.U)(e,(e=>e.getJoinRule())),l=Lm(e,2500),c=Um(e,{throttleWait:2500}),{voiceCallDisabledReason:d,voiceCallClick:m,videoCallDisabledReason:h,videoCallClick:p,toggleCallMaximized:v,isViewingCall:_,isConnectedToCall:f,hasActiveCallSession:y,callOptions:E,showVoiceCallButton:b,showVideoCallButton:w}=jp(e),x=(0,Ne.ny)("feature_group_calls"),A=(0,o.useMemo)((()=>g.Ay.get("element_call").use_exclusively&&x),[x]),S=Bp(e),k=Vp(),R=!!eg(e),I=function(e,t){const[n,i]=(0,o.useState)(null);return(0,o.useEffect)((()=>{e.isCryptoEnabled()&&(0,fs.G)(e,t).then((e=>{i(e)}))}),[e,t]),n}(i,e),T=(0,Ne.ny)("feature_notifications"),P=(0,Ne.ny)("feature_ask_to_join"),N=(0,o.useCallback)((e=>p(e,E[0])),[E,p]),D=o.createElement(ke.m_,{label:_?(0,C._t)("voip|minimise_call"):(0,C._t)("voip|maximise_call")},o.createElement(ke.K0,{onClick:v},o.createElement(lt.I,null))),M=o.createElement(ke.m_,{label:null!=h?h:(0,C._t)("voip|video_call")},o.createElement(ke.$n,{size:"sm",onClick:N,Icon:lt.I,className:"mx_RoomHeader_join_button",disabled:!!h,color:"primary","aria-label":null!=h?h:(0,C._t)("action|join")},(0,C._t)("action|join"))),O=o.createElement(ke.m_,{label:null!=h?h:(0,C._t)("voip|video_call")},o.createElement(lt.I,null)),[L,U]=(0,o.useState)(!1),F=(0,o.useCallback)((e=>{h||U(e)}),[h]),j=o.createElement(o.Fragment,null,E.length>1?o.createElement(ke.W1,{open:L,onOpenChange:F,title:(0,C._t)("voip|video_call_using"),trigger:o.createElement(ke.K0,{disabled:!!h,"aria-label":null!=h?h:(0,C._t)("voip|video_call")},O),side:"left",align:"start"},E.map((e=>o.createElement(ke.Dr,{key:e,label:Up(e),"aria-label":Up(e),onClick:t=>p(t,e),Icon:lt.I,onSelect:()=>{}})))):o.createElement(ke.K0,{disabled:!!h,"aria-label":null!=h?h:(0,C._t)("voip|video_call"),onClick:N},O));let B=o.createElement(ke.m_,{label:null!=d?d:(0,C._t)("voip|voice_call")},o.createElement(ke.K0,{disabled:!!d||_||f,"aria-label":null!=d?d:(0,C._t)("voip|voice_call"),onClick:e=>m(e,E[0])},o.createElement(yp,null)));const V=o.createElement(ke.m_,{label:(0,C._t)("voip|close_lobby")},o.createElement(ke.K0,{onClick:v,"aria-label":(0,C._t)("voip|close_lobby")},o.createElement(bp.A,null)));let H=j;f?H=D:_&&(H=V),w||(H=void 0),b||(B=void 0);const z=ii("newRoomHeader"),W=(0,o.useContext)(Zr.Ay),G=(0,el.u)(e),K=G||W.mainSplitContentType===Sv.MaximisedWidget||W.mainSplitContentType===Sv.Call;return o.createElement(o.Fragment,null,o.createElement(Fa.s,{as:"header",align:"center",gap:"var(--cpd-space-3x)",className:"mx_RoomHeader light-panel"},o.createElement(oi,{feature:"newRoomHeader",header:(0,C._t)("room|header|release_announcement_header"),description:(0,C._t)("room|header|release_announcement_description"),closeLabel:(0,C._t)("action|ok"),placement:"bottom"},o.createElement("button",{"aria-label":(0,C._t)("right_panel|room_summary_card|title"),tabIndex:0,onClick:()=>{z&&ni.instance.nextReleaseAnnouncement(),qn.A.instance.showOrHidePanel($n.n.RoomSummary)},className:"mx_RoomHeader_infoWrapper"},o.createElement(ng,{room:e,size:"8px"},o.createElement(Ge.A,{room:e,size:"40px",oobData:n})),o.createElement(Ya,{flex:"1",className:"mx_RoomHeader_info"},o.createElement(ke.nB,{as:"div",size:"lg",weight:"semibold",dir:"auto",role:"heading","aria-level":1,className:"mx_RoomHeader_heading"},o.createElement("span",{className:"mx_RoomHeader_truncated mx_lineClamp"},r),!R&&a===s.JoinRule.Public&&o.createElement(ke.m_,{label:(0,C._t)("common|public_room"),placement:"right"},o.createElement(cs,{width:"16px",height:"16px",className:"mx_RoomHeader_icon text-secondary","aria-label":(0,C._t)("common|public_room")})),R&&I===fs.z.Verified&&o.createElement(ke.m_,{label:(0,C._t)("common|verified"),placement:"right"},o.createElement(Tp,{width:"16px",height:"16px",className:"mx_RoomHeader_icon mx_Verified","aria-label":(0,C._t)("common|verified")})),R&&I===fs.z.Warning&&o.createElement(ke.m_,{label:(0,C._t)("room|header_untrusted_label"),placement:"right"},o.createElement(us.A,{width:"16px",height:"16px",className:"mx_RoomHeader_icon mx_Untrusted","aria-label":(0,C._t)("room|header_untrusted_label")})))))),o.createElement(Fa.s,{align:"center",gap:"var(--cpd-space-2x)"},null==t?void 0:t.map((e=>{const t=e.label();return o.createElement(ke.m_,{label:t,key:e.id},o.createElement(ke.K0,{"aria-label":t,onClick:t=>{t.stopPropagation(),e.onClick()}},"function"==typeof e.icon?e.icon():e.icon))})),_&&o.createElement(Jp,{room:e}),!y||f||_?o.createElement(o.Fragment,null,!G&&H,!A&&!G&&B):M,o.createElement(ke.m_,{label:(0,C._t)("right_panel|room_summary_card|title")},o.createElement(ke.K0,{onClick:e=>{e.stopPropagation(),qn.A.instance.showOrHidePanel($n.n.RoomSummary)},"aria-label":(0,C._t)("right_panel|room_summary_card|title")},o.createElement(Ap,null))),K&&o.createElement(Kp,{room:e}),o.createElement(ke.m_,{label:(0,C._t)("common|threads")},o.createElement(ke.K0,{indicator:(0,Wn.W7)(S),onClick:e=>{e.stopPropagation(),qn.A.instance.showOrHidePanel($n.n.ThreadPanel),u.A.trackInteraction("WebRoomHeaderButtonsThreadsButton",e)},"aria-label":(0,C._t)("common|threads")},o.createElement(zn.I,null))),T&&o.createElement(ke.m_,{label:(0,C._t)("notifications|enable_prompt_toast_title")},o.createElement(ke.K0,{indicator:(0,Wn.W7)(k.level),onClick:e=>{e.stopPropagation(),qn.A.instance.showOrHidePanel($n.n.NotificationPanel)},"aria-label":(0,C._t)("notifications|enable_prompt_toast_title")},o.createElement(Rp,null)))),!R&&o.createElement(ke.nB,{as:"div",size:"sm",weight:"medium"},o.createElement(jm.A,{className:"mx_RoomHeader_members",members:l.slice(0,3),size:"20px",overflow:!1,viewUserOnClick:!1,tooltipLabel:(0,C._t)("room|header_face_pile_tooltip"),onClick:e=>{qn.A.instance.showOrHidePanel($n.n.RoomMemberList),e.stopPropagation()},"aria-label":(0,C._t)("common|n_members",{count:c})},(0,ia.B4)(c)))),P&&o.createElement(zh,{room:e}))}const rg=({roomWidth:e})=>{const t=(0,o.useRef)(null),i=(0,o.useRef)(new Map);return(0,o.useEffect)((()=>{const e=()=>{var e;t.current&&(null===(e=t.current)||void 0===e?void 0:e.height)!==Ce.A.instance.windowHeight&&(t.current.height=Ce.A.instance.windowHeight)},r=v.Ay.register((e=>{const r="effects.";if(t.current&&e.action.startsWith(r)){(async e=>{if(!e)return null;let t=i.current.get(e)||null;if(null===t){var r;const o=null===(r=Hl.y.find((t=>t.command===e)))||void 0===r?void 0:r.options;try{const{default:r}=await n("./node_modules/matrix-react-sdk/src/effects lazy recursive ^\\.\\/.*$ referencedExports: default")(`./${e}`);t=new r(o),i.current.set(e,t)}catch(t){l.v.warn(`Unable to load effect module at '../../../effects/${e}.`,t)}}return t})(e.action.slice(8)).then((e=>null==e?void 0:e.start(t.current)))}})),o=t.current;return o&&(o.height=Ce.A.instance.windowHeight),Ce.A.instance.on(Ce.x.Resize,e),()=>{v.Ay.unregister(r),Ce.A.instance.off(Ce.x.Resize,e);const t=i.current;for(const e in t){const n=t.get(e);n&&n.isRunning&&n.stop()}}}),[]),o.createElement("canvas",{ref:t,width:e,style:{display:"block",zIndex:999999,pointerEvents:"none",position:"fixed",top:0,right:0},"aria-hidden":!0})},og=({room:e,resizing:t,call:n,skipLobby:i,role:r})=>{const s=(0,o.useContext)(Re.Ay);(0,o.useEffect)((()=>{n.clean()}),[n]),(0,o.useEffect)((()=>{var e,t;null!==(t=(e=n.widget).data)&&void 0!==t||(e.data={}),n.widget.data.skipLobby=i}),[n.widget,i]),(0,o.useEffect)((()=>(n.connectionState===sp.KN.Disconnected&&n.start(),()=>{n.connected||n.destroy()})),[n]);const a=(0,o.useCallback)((async()=>{const e=[...Mp.e.instance.connectedCalls].filter((e=>Xt.M.instance.roomViewStore.getRoomId()!==e.roomId));await Promise.all(e.map((async e=>await e.disconnect())))}),[]);return o.createElement("div",{className:"mx_CallView"},o.createElement(Hc,{app:n.widget,room:e,userId:s.credentials.userId,creatorUserId:n.widget.creatorUserId,waitForIframeLoad:n.widget.waitForIframeLoad,showMenubar:!1,pointerEvents:t?"none":void 0,stickyPromise:a}))},sg=({room:e,resizing:t,waitForCall:n,skipLobby:i,role:r})=>{const s=(0,rp.Gc)(e.roomId);return(0,o.useEffect)((()=>{null!==s||n||sp.Ho.create(e,i)}),[s,e,i,n]),null===s?null:o.createElement(og,{room:e,resizing:t,call:s,skipLobby:i,role:r})};var ag=n("./node_modules/matrix-react-sdk/src/toasts/DesktopNotificationsToast.ts"),lg=n("./node_modules/matrix-react-sdk/src/email.ts");const cg=(e,t)=>{const[n,i]=(0,o.useState)((()=>Array.isArray(t)?t:new Array(e).fill(t)));return[n,(e,t)=>i((n=>{const i=[...n];return i[e]=t,i}))]};var dg=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/AddExistingToSpaceDialog.tsx"),ug=n("./node_modules/matrix-react-sdk/src/components/views/spaces/SpacePublicShare.tsx"),mg=n("./node_modules/matrix-js-sdk/src/@types/event.ts");class hg{constructor(e,t,n,i=!1){(0,r.A)(this,"viaMap",new Map),(0,r.A)(this,"backRefs",new Map),(0,r.A)(this,"roomMap",new Map),(0,r.A)(this,"loadRequest",void 0),(0,r.A)(this,"nextBatch",void 0),(0,r.A)(this,"_rooms",void 0),(0,r.A)(this,"serverSupportError",void 0),this.root=e,this.pageSize=t,this.maxDepth=n,this.suggestedOnly=i}get noSupport(){return!!this.serverSupportError}get canLoadMore(){return!!this.serverSupportError||!!this.nextBatch||!this._rooms}get loading(){return!!this.loadRequest}get rooms(){return this._rooms}async load(e=this.pageSize){if(this.loadRequest)return this.loadRequest.then((e=>e.rooms));let t;this.loadRequest=this.root.client.getRoomHierarchy(this.root.roomId,e,this.maxDepth,this.suggestedOnly,this.nextBatch);try{({rooms:t,next_batch:this.nextBatch}=await this.loadRequest)}catch(e){if("M_UNRECOGNIZED"!==e.errcode)throw e;return this.serverSupportError=e,[]}finally{this.loadRequest=void 0}return this._rooms?this._rooms=this._rooms.concat(t):this._rooms=t,t.forEach((e=>{this.roomMap.set(e.room_id,e),e.children_state.forEach((t=>{if(t.type!==mg.Bx.SpaceChild)return;const n=t.state_key;if(this.backRefs.has(n)||this.backRefs.set(n,[]),this.backRefs.get(n).push(e.room_id),Array.isArray(t.content.via)){this.viaMap.has(n)||this.viaMap.set(n,new Set);const e=this.viaMap.get(n);t.content.via.forEach((t=>e.add(t)))}}))})),t}getRelation(e,t){var n;return null===(n=this.roomMap.get(e))||void 0===n?void 0:n.children_state.find((e=>e.state_key===t))}isSuggested(e,t){var n;return null===(n=this.getRelation(e,t))||void 0===n?void 0:n.content.suggested}removeRelation(e,t){const n=this.backRefs.get(t);1===(null==n?void 0:n.length)?this.backRefs.delete(t):null!=n&&n.length&&this.backRefs.set(t,n.filter((t=>t!==e)));const i=this.roomMap.get(e);i&&(i.children_state=i.children_state.filter((e=>e.state_key!==t)))}}var pg=n("./node_modules/matrix-react-sdk/src/components/views/elements/InfoTooltip.tsx"),gg=n("./node_modules/matrix-react-sdk/src/utils/RoomUpgrade.ts");function vg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vg(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vg(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const fg=({room:e,suggested:t,selected:n,hasPermissions:i,onToggleClick:r,onViewRoomClick:a,onJoinRoomClick:l,numChildRooms:c,children:d})=>{var u,m;const h=(0,o.useContext)(Re.Ay),p=(0,Pe.DY)(h,s.ClientEvent.Room,(()=>{const t=null==h?void 0:h.getRoom(e.room_id);return(null==t?void 0:t.getMyMembership())===We.O.Join?t:void 0})),g=(0,Pe.DY)(p,s.RoomEvent.Name,(e=>null==e?void 0:e.name)),v=g||e.name||e.canonical_alias||(null===(u=e.aliases)||void 0===u?void 0:u[0])||(e.room_type===s.RoomType.Space?(0,C._t)("common|unnamed_space"):(0,C._t)("common|unnamed_room")),[_,f]=(0,on.X)(!0),[y,E,b]=(0,Ze.A9)(),[w,x]=(0,o.useState)(!1),A=e=>{e.preventDefault(),e.stopPropagation(),a()},S=async t=>{x(!0),t.preventDefault(),t.stopPropagation();try{await l(),await(0,gg.R)(h,e.room_id)}finally{x(!1)}};let k,R,I;k=w?o.createElement(be.A,{disabled:!0,onClick:S,kind:"primary_outline",onFocus:y,tabIndex:E?0:-1,title:(0,C._t)("space|joining_space")},o.createElement(dn.A,{w:24,h:24})):p||e.join_rule===s.JoinRule.Knock?o.createElement(be.A,{onClick:A,kind:"primary_outline",onFocus:y,tabIndex:E?0:-1},(0,C._t)("action|view")):o.createElement(be.A,{onClick:S,kind:"primary",onFocus:y,tabIndex:E?0:-1},(0,C._t)("action|join")),r&&(R=i?o.createElement(at.A,{checked:!!n,onChange:r,tabIndex:E?0:-1}):o.createElement(Ul.A,{tooltip:(0,C._t)("space|user_lacks_permission"),onClick:e=>{e.stopPropagation()}},o.createElement(at.A,{disabled:!0,tabIndex:E?0:-1}))),I=p?o.createElement(Ge.A,{room:p,size:"20px"}):o.createElement(xn.A,{name:v,idName:e.room_id,url:e.avatar_url?(0,Ds.lH)(e.avatar_url).getSquareThumbnailHttp(20):null,size:"20px"});let T,P,N,D,M=(0,C._t)("common|n_members",{count:null!==(m=e.num_joined_members)&&void 0!==m?m:0});if(void 0!==c&&(M+=" · "+(0,C._t)("common|n_rooms",{count:c})),p){const e=(0,Wa.e)(p);T=(0,Ga.sH)(null==e?void 0:e.text,null==e?void 0:e.html)}else T=e.topic;T&&(P=o.createElement(Ga.XZ,{options:{attributes:{onClick(e){e.stopPropagation()}}}}," · ",T)),p&&(N=o.createElement("div",{className:"mx_SpaceHierarchy_roomTile_joined"},(0,C._t)("common|joined"))),!t||p&&!i||(D=o.createElement(pg.A,{tooltip:(0,C._t)("space|suggested_tooltip")},(0,C._t)("space|suggested")));const O=o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_SpaceHierarchy_roomTile_item"},o.createElement("div",{className:"mx_SpaceHierarchy_roomTile_avatar"},I),o.createElement("div",{className:"mx_SpaceHierarchy_roomTile_name"},v,N,D),o.createElement("div",{className:"mx_SpaceHierarchy_roomTile_info"},M,P)),o.createElement("div",{className:"mx_SpaceHierarchy_actions"},k,R));let L,U,F;if(d){if(L=o.createElement("div",{className:ee()("mx_SpaceHierarchy_subspace_toggle",{mx_SpaceHierarchy_subspace_toggle_shown:_}),onClick:e=>{e.stopPropagation(),f()}}),_){const e=e=>{var t;if((0,Se.zM)().getAccessibilityAction(e)===Ee.bY.ArrowLeft)e.preventDefault(),e.stopPropagation(),null===(t=b.current)||void 0===t||t.focus()};U=o.createElement("div",{className:"mx_SpaceHierarchy_subspace_children",onKeyDown:e,role:"group"},d)}F=e=>{let t=!1;switch((0,Se.zM)().getAccessibilityAction(e)){case Ee.bY.ArrowLeft:_&&(t=!0,f());break;case Ee.bY.ArrowRight:if(t=!0,_){var n,i;const e=null===(n=b.current)||void 0===n?void 0:n.nextElementSibling;null==e||null===(i=e.querySelector(".mx_SpaceHierarchy_roomTile"))||void 0===i||i.focus()}else f()}t&&(e.preventDefault(),e.stopPropagation())}}return o.createElement("li",{className:"mx_SpaceHierarchy_roomTileWrapper",role:"treeitem","aria-selected":n,"aria-expanded":d?_:void 0},o.createElement(be.A,{className:ee()("mx_SpaceHierarchy_roomTile",{mx_SpaceHierarchy_subspace:e.room_type===s.RoomType.Space,mx_SpaceHierarchy_joining:w}),onClick:i&&r?r:A,onKeyDown:F,ref:b,onFocus:y,tabIndex:E?0:-1},O,L),U)},yg=(e,t,n,i)=>{var r,o;const s=t.roomMap.get(n);if(e.isGuest()&&!(null!=s&&s.world_readable||null!=s&&s.guest_can_join))return void v.Ay.dispatch({action:"require_registration"});const a=(0,E.iW)(null!==(r=null==s?void 0:s.canonical_alias)&&void 0!==r?r:"",null!==(o=null==s?void 0:s.aliases)&&void 0!==o?o:[])||void 0;v.Ay.dispatch({action:x.r.ViewRoom,should_peek:!0,room_alias:a,room_id:n,via_servers:Array.from(t.viaMap.get(n)||[]),oob_data:{avatarUrl:null==s?void 0:s.avatar_url,name:(null==s?void 0:s.name)||a||(0,C._t)("common|unnamed_room"),roomType:i},metricsTrigger:"RoomDirectory"})},Eg=async(e,t,n)=>{if(e.isGuest())v.Ay.dispatch({action:"require_registration"});else{try{await e.joinRoom(n,{viaServers:Array.from(t.viaMap.get(n)||[])})}catch(e){throw e instanceof s.MatrixError?Xt.M.instance.roomViewStore.showJoinRoomError(e,n):(l.v.warn("Got a non-MatrixError while joining room",e),Xt.M.instance.roomViewStore.showJoinRoomError(new s.MatrixError({error:(0,C._t)("error|unknown")}),n)),e}v.Ay.dispatch({action:x.r.JoinRoomReady,roomId:n,metricsTrigger:"SpaceHierarchy"})}},bg=({root:e,roomSet:t,hierarchy:n,parents:i,selectedMap:r,onViewRoomClick:a,onJoinRoomClick:l,onToggleClick:d})=>{const u=(0,o.useContext)(Re.Ay),m=u.getRoom(e.room_id),h=null==m?void 0:m.currentState.maySendStateEvent(s.EventType.SpaceChild,u.getSafeUserId()),p=(0,c.sortBy)(e.children_state,(e=>(0,xe.tK)(e.content.order,e.origin_server_ts,e.state_key))),[g,v]=p.reduce(((e,i)=>{const r=n.roomMap.get(i.state_key);return r&&t.has(r)&&e[r.room_type===s.RoomType.Space?0:1].push(((e,t,n)=>{const i=e.getRoomUpgradeHistory(t.room_id,!0,O.A.getValue("feature_dynamic_room_predecessors"));let r=null;for(let e=i.length-1;e>=0;--e)if(n.roomMap.get(i[e].roomId)){r=i[e];break}var o,a,l,c,d;return r?_g(_g({},t),{},{room_id:r.roomId,room_type:r.getType(),name:r.name,topic:null===(o=r.currentState.getStateEvents(s.EventType.RoomTopic,""))||void 0===o?void 0:o.getContent().topic,avatar_url:null!==(a=r.getMxcAvatarUrl())&&void 0!==a?a:void 0,canonical_alias:null!==(l=r.getCanonicalAlias())&&void 0!==l?l:void 0,aliases:r.getAltAliases(),world_readable:(null===(c=r.currentState.getStateEvents(s.EventType.RoomHistoryVisibility,""))||void 0===c?void 0:c.getContent().history_visibility)===s.HistoryVisibility.WorldReadable,guest_can_join:(null===(d=r.currentState.getStateEvents(s.EventType.RoomGuestAccess,""))||void 0===d?void 0:d.getContent().guest_access)===s.GuestAccess.CanJoin,num_joined_members:r.getJoinedMemberCount()}):t})(u,r,n)),e}),[[],[]]),_=new Set(i).add(e.room_id);return o.createElement(o.Fragment,null,(0,c.uniqBy)(v,"room_id").map((t=>{var i;return o.createElement(fg,{key:t.room_id,room:t,suggested:n.isSuggested(e.room_id,t.room_id),selected:null==r||null===(i=r.get(e.room_id))||void 0===i?void 0:i.has(t.room_id),onViewRoomClick:()=>a(t.room_id,t.room_type),onJoinRoomClick:()=>l(t.room_id,_),hasPermissions:h,onToggleClick:d?()=>d(e.room_id,t.room_id):void 0})})),g.filter((e=>!_.has(e.room_id))).map((i=>{var c;return o.createElement(fg,{key:i.room_id,room:i,numChildRooms:i.children_state.filter((e=>{const i=n.roomMap.get(e.state_key);return i&&t.has(i)&&!i.room_type})).length,suggested:n.isSuggested(e.room_id,i.room_id),selected:null==r||null===(c=r.get(e.room_id))||void 0===c?void 0:c.has(i.room_id),onViewRoomClick:()=>a(i.room_id,s.RoomType.Space),onJoinRoomClick:()=>l(i.room_id,_),hasPermissions:h,onToggleClick:d?()=>d(e.room_id,i.room_id):void 0},o.createElement(bg,{root:i,roomSet:t,hierarchy:n,parents:_,selectedMap:r,onViewRoomClick:a,onJoinRoomClick:l,onToggleClick:d}))})))},wg=({hierarchy:e,selected:t,setSelected:n,setError:i})=>{const r=(0,o.useContext)(Re.Ay),[a,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),u=Array.from(t.keys()).flatMap((e=>[...t.get(e).values()].map((t=>[e,t])))),m=u.every((([t,n])=>e.isSuggested(t,n))),h=!u.length||a||c;let p=(0,C._t)("common|saving");c||(p=m?(0,C._t)("space|unmark_suggested"):(0,C._t)("space|mark_suggested"));const g=u.length?void 0:(0,C._t)("space|select_room_below");return o.createElement(o.Fragment,null,o.createElement(be.A,{onClick:async()=>{l(!0);try{const t=r.getSafeUserId();for(const[n,i]of u){await r.sendStateEvent(n,s.EventType.SpaceChild,{},i);const o=r.getRoom(i),a=null==o?void 0:o.currentState.getStateEvents(s.EventType.SpaceParent,n);null!=o&&o.currentState.maySendStateEvent(s.EventType.SpaceParent,t)&&Array.isArray(null==a?void 0:a.getContent().via)&&await r.sendStateEvent(i,s.EventType.SpaceParent,{},n),e.removeRelation(n,i)}}catch(e){i((0,C._t)("space|failed_remove_rooms"))}l(!1),n(new Map)},kind:"danger_outline",disabled:h,"aria-label":a?(0,C._t)("redact|ongoing"):(0,C._t)("action|remove"),title:g,placement:"top"},a?(0,C._t)("redact|ongoing"):(0,C._t)("action|remove")),o.createElement(be.A,{onClick:async()=>{d(!0);try{for(const[n,i]of u){var t;const o=!m,a=null===(t=e.getRelation(n,i))||void 0===t?void 0:t.content;if(!a||a.suggested===o)continue;const l=_g(_g({},a),{},{suggested:!m});await r.sendStateEvent(n,s.EventType.SpaceChild,l,i),a.suggested=l.suggested}}catch(e){i("Failed to update some suggestions. Try again later")}d(!1),n(new Map)},kind:"primary_outline",disabled:h,"aria-label":p,title:g,placement:"top"},p))},xg=({space:e,initialText:t="",showRoom:n,additionalButtons:i})=>{const r=(0,o.useContext)(Re.Ay),[a,l]=(0,o.useState)(t),[c,d]=(0,o.useState)(new Map),{loading:u,rooms:m,hierarchy:h,loadMore:p,error:g}=(e=>{const[t,n]=(0,o.useState)([]),[i,r]=(0,o.useState)(),[s,a]=(0,o.useState)(),l=(0,o.useCallback)((()=>{a(void 0);const t=new hg(e,20);t.load().then((()=>{var i;e===t.root&&n(null!==(i=t.rooms)&&void 0!==i?i:[])}),a),r(t)}),[e]);(0,o.useEffect)(l,[l]),(0,Te.F)(v.Ay,(e=>{e.action===x.r.UpdateSpaceHierarchy&&(n([]),l())}));const c=(0,o.useCallback)((async e=>{var t;!i||i.loading||!i.canLoadMore||i.noSupport||s||(await i.load(e).catch(a),n(null!==(t=i.rooms)&&void 0!==t?t:[]))}),[s,i]);return(null==i?void 0:i.root)!==e?{loading:!0,loadMore:c}:{loading:i.loading,rooms:t,hierarchy:i,loadMore:c,error:s}})(e),_=(0,o.useMemo)((()=>{if(null==m||!m.length||!h)return new Set;const e=a.toLowerCase().trim();if(!e)return new Set(m);const t=m.filter((t=>{var n,i;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(i=t.topic)||void 0===i?void 0:i.toLowerCase().includes(e))})),n=new Set,i=[...t.map((e=>e.room_id))];for(;i.length;){var r;const e=i.pop();n.add(e),null===(r=h.backRefs.get(e))||void 0===r||r.forEach((e=>{n.has(e)||i.push(e)}))}return new Set(m.filter((e=>n.has(e.room_id))))}),[m,h,a]),[f,y]=(0,o.useState)("");let E=f;!f&&g&&(E=(0,C._t)("space|failed_load_rooms"));const b=(e=>{const t=t=>{t[0].isIntersecting&&e()},n=(0,o.useRef)();return e=>{n.current?n.current.disconnect():e&&(n.current=new IntersectionObserver(t,{root:e.parentElement,rootMargin:"0px 0px 600px 0px"})),n.current&&e&&n.current.observe(e)}})(p);if(!u&&h.noSupport)return o.createElement("p",null,(0,C._t)("space|incompatible_server_hierarchy"));const w=(e,t)=>{if(y(""),!c.has(e))return void d(new Map(c.set(e,new Set([t]))));const n=c.get(e);n.has(t)?(n.delete(t),d(new Map(c.set(e,new Set(n))))):d(new Map(c.set(e,new Set([...n,t]))))};return o.createElement(Ze.Se,{onKeyDown:(e,t)=>{var n;(0,Se.zM)().getAccessibilityAction(e)===Ee.bY.ArrowDown&&e.currentTarget.classList.contains("mx_SpaceHierarchy_search")&&(null===(n=t.refs[0])||void 0===n||null===(n=n.current)||void 0===n||n.focus())},handleHomeEnd:!0,handleUpDown:!0},(({onKeyDownHandler:p})=>{let g;if(h&&(!u||null!=m&&m.length)){const t=(null==e?void 0:e.getMyMembership())===We.O.Join&&e.currentState.maySendStateEvent(s.EventType.SpaceChild,r.getSafeUserId()),l=h.roomMap.get(e.roomId);let u,m;_.size&&l?u=o.createElement(o.Fragment,null,o.createElement(bg,{root:l,roomSet:_,hierarchy:h,parents:new Set,selectedMap:c,onToggleClick:t?w:void 0,onViewRoomClick:(e,t)=>n(r,h,e,t),onJoinRoomClick:async(e,t)=>{for(const e of t){var n;(null===(n=r.getRoom(e))||void 0===n?void 0:n.getMyMembership())!==We.O.Join&&await Eg(r,h,e)}await Eg(r,h,e)}})):h.canLoadMore||(u=o.createElement("div",{className:"mx_SpaceHierarchy_noResults"},o.createElement("h3",null,(0,C._t)("common|no_results_found")),o.createElement("div",null,(0,C._t)("space|no_search_result_hint")))),h.canLoadMore&&(m=o.createElement("div",{ref:b},o.createElement(dn.A,null))),g=o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_SpaceHierarchy_listHeader"},o.createElement("h4",{className:"mx_SpaceHierarchy_listHeader_header"},a.trim()?(0,C._t)("space|title_when_query_available"):(0,C._t)("space|title_when_query_unavailable")),o.createElement("div",{className:"mx_SpaceHierarchy_listHeader_buttons"},i,t&&o.createElement(wg,{hierarchy:h,selected:c,setSelected:d,setError:y}))),E&&o.createElement("div",{className:"mx_SpaceHierarchy_error"},E),o.createElement("ul",{className:"mx_SpaceHierarchy_list",onKeyDown:p,role:"tree","aria-label":(0,C._t)("common|space")},u),m)}else g=o.createElement(dn.A,null);return o.createElement(o.Fragment,null,o.createElement($c.A,{className:"mx_SpaceHierarchy_search mx_textinput_icon mx_textinput_search",placeholder:(0,C._t)("space|search_placeholder"),onSearch:l,autoFocus:!0,initialValue:t,onKeyDown:p}),g)}))};var Ag=function(e){return e[e.Landing=0]="Landing",e[e.PublicCreateRooms=1]="PublicCreateRooms",e[e.PublicShare=2]="PublicShare",e[e.PrivateScope=3]="PrivateScope",e[e.PrivateInvite=4]="PrivateInvite",e[e.PrivateCreateRooms=5]="PrivateCreateRooms",e[e.PrivateExistingRooms=6]="PrivateExistingRooms",e}(Ag||{});const Sg=({space:e})=>{const[t,n,i,r]=(0,Me.EF)(),a=(0,Ie.g)(W.C.CreateRooms),l=(0,Ie.g)(W.C.CreateSpaces),c=(0,Ne.ny)("feature_video_rooms"),d=(0,Ne.ny)("feature_element_call_video_rooms");let m=null;if(t){const t=n.current.getBoundingClientRect();m=o.createElement(Le.Ay,{left:t.left+window.scrollX+0,top:t.bottom+window.scrollY+8,chevronFace:Me.t4.None,onFinished:r,className:"mx_RoomTile_contextMenu",compact:!0},o.createElement(Le.tx,{first:!0},a&&o.createElement(o.Fragment,null,o.createElement(Le.R$,{label:(0,C._t)("action|new_room"),iconClassName:"mx_RoomList_iconNewRoom",onClick:async t=>{t.preventDefault(),t.stopPropagation(),r(),u.A.trackInteraction("WebSpaceHomeCreateRoomButton",t),await(0,De.PT)(e)&&v.Ay.fire(x.r.UpdateSpaceHierarchy)}}),c&&o.createElement(Le.R$,{label:(0,C._t)("action|new_video_room"),iconClassName:"mx_RoomList_iconNewVideoRoom",onClick:async t=>{t.preventDefault(),t.stopPropagation(),r(),await(0,De.PT)(e,d?s.RoomType.UnstableCall:s.RoomType.ElementVideo)&&v.Ay.fire(x.r.UpdateSpaceHierarchy)}},o.createElement(Oe.s,null))),o.createElement(Le.R$,{label:(0,C._t)("action|add_existing_room"),iconClassName:"mx_RoomList_iconAddExistingRoom",onClick:t=>{t.preventDefault(),t.stopPropagation(),r(),(0,De.yV)(e)}}),l&&o.createElement(Le.R$,{label:(0,C._t)("room_list|add_space_label"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),r(),(0,De.Sl)(e)}},o.createElement(Oe.s,null))))}return o.createElement(o.Fragment,null,o.createElement(Me.VJ,{kind:"primary",ref:n,onClick:i,isExpanded:t,label:(0,C._t)("action|add")},(0,C._t)("action|add")),m)},Cg=({space:e})=>{const t=(0,o.useContext)(Re.Ay),n=Fm(e),i=t.getSafeUserId(),r=(0,o.useCallback)((()=>{var t;return qn.A.instance.isOpenForRoom(e.roomId)&&(null===(t=qn.A.instance.currentCardForRoom(e.roomId))||void 0===t?void 0:t.phase)===$n.n.SpaceMemberList}),[e.roomId]),a=(0,Pe.dF)(qn.A.instance,A.H,r);let l;(0,De.MI)(e)&&(0,Ie.g)(W.C.InviteUsers)&&(l=o.createElement(be.A,{kind:"primary",className:"mx_SpaceRoomView_landing_inviteButton",onClick:()=>{(0,De.Lo)(e)}},(0,C._t)("action|invite")));let c,d;n===We.O.Join&&e.currentState.maySendStateEvent(s.EventType.SpaceChild,i)&&(c=o.createElement(Sg,{space:e})),(0,De.Kv)(e)&&(d=o.createElement(be.A,{className:"mx_SpaceRoomView_landing_settingsButton",onClick:()=>{(0,De.hL)(e)},title:(0,C._t)("common|settings"),placement:"bottom"}));return o.createElement("div",{className:"mx_SpaceRoomView_landing"},o.createElement("div",{className:"mx_SpaceRoomView_landing_header"},o.createElement(Ge.A,{room:e,size:"80px",viewAvatarOnClick:!0,type:"square"})),o.createElement("div",{className:"mx_SpaceRoomView_landing_name"},o.createElement(ys.A,{room:e},(e=>{const t={name:()=>o.createElement("h1",null,e)};return(0,C._t)("space|landing_welcome",{},t)}))),o.createElement("div",{className:"mx_SpaceRoomView_landing_infoBar"},o.createElement(Wm,{room:e}),o.createElement("div",{className:"mx_SpaceRoomView_landing_infoBar_interactive"},o.createElement(zm,{room:e,onlyKnownUsers:!1,numShown:7,onClick:a?void 0:()=>{qn.A.instance.setCard({phase:$n.n.SpaceMemberList})}}),l,d)),o.createElement(Xa,{room:e,className:"mx_SpaceRoomView_landing_topic"}),o.createElement(xg,{space:e,showRoom:yg,additionalButtons:c}))},kg=({space:e,title:t,description:n,onFinished:i})=>{const[r,a]=(0,o.useState)(!1),[c,d]=(0,o.useState)(""),u=[(0,C._t)("common|general"),(0,C._t)("common|random"),(0,C._t)("common|support")],[m,h]=cg(3,[(0,C._t)("common|general"),(0,C._t)("common|random"),""]),p=new Array(3).fill(0).map(((e,t)=>{const n="roomName"+t;return o.createElement(tn.A,{key:n,name:n,type:"text",label:(0,C._t)("common|room_name"),placeholder:u[t],value:m[t],onChange:e=>h(t,e.target.value),autoFocus:2===t,disabled:r,autoComplete:"off"})})),g=async t=>{if(t.preventDefault(),!r){d(""),a(!0);try{var n;const t=e.getJoinRule()===s.JoinRule.Public,r=m.map((e=>e.trim())).filter(Boolean),o=await Promise.all(r.map((n=>(0,V.Ay)(e.client,{createOpts:{preset:t?s.Preset.PublicChat:s.Preset.PrivateChat,name:n},spinner:!1,encryption:!1,andView:!1,inlineErrors:!0,parentSpace:e,joinRule:t?void 0:s.JoinRule.Restricted,suggested:!0}))));i(null!==(n=o[0])&&void 0!==n?n:void 0)}catch(e){l.v.error("Failed to create initial space rooms",e),d((0,C._t)("create_space|failed_create_initial_rooms"))}a(!1)}};let v=e=>{e.preventDefault(),i()},_=(0,C._t)("create_space|skip_action");return m.some((e=>e.trim()))&&(v=g,_=r?(0,C._t)("create_space|creating_rooms"):(0,C._t)("action|continue")),o.createElement("div",null,o.createElement("h1",null,t),o.createElement("div",{className:"mx_SpaceRoomView_description"},n),c&&o.createElement("div",{className:"mx_SpaceRoomView_errorText"},c),o.createElement("form",{onSubmit:v,id:"mx_SpaceSetupFirstRooms"},p),o.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.createElement(be.A,{kind:"primary",disabled:r,onClick:v,element:"input",type:"submit",form:"mx_SpaceSetupFirstRooms",value:_})))},Rg=({space:e,onFinished:t})=>o.createElement("div",null,o.createElement("h1",null,(0,C._t)("create_space|add_existing_rooms_heading")),o.createElement("div",{className:"mx_SpaceRoomView_description"},(0,C._t)("create_space|add_existing_rooms_description")),o.createElement(dg.sS,{space:e,emptySelectionButton:o.createElement(be.A,{kind:"primary",onClick:t},(0,C._t)("create_space|skip_action")),filterPlaceholder:(0,C._t)("space|room_filter_placeholder"),onFinished:t,roomsRenderer:dg.FM,dmsRenderer:dg.nZ})),Ig=({justCreatedOpts:e,space:t,onFinished:n,firstRoomId:i})=>{var r;return o.createElement("div",{className:"mx_SpaceRoomView_publicShare"},o.createElement("h1",null,(0,C._t)("create_space|share_heading",{name:(null==e||null===(r=e.createOpts)||void 0===r?void 0:r.name)||t.name})),o.createElement("div",{className:"mx_SpaceRoomView_description"},(0,C._t)("create_space|share_description")),o.createElement(ug.A,{space:t}),o.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.createElement(be.A,{kind:"primary",onClick:n},i?(0,C._t)("create_space|done_action_first_room"):(0,C._t)("create_space|done_action"))))},Tg=({space:e,justCreatedOpts:t,onFinished:n})=>{var i;return o.createElement("div",{className:"mx_SpaceRoomView_privateScope"},o.createElement("h1",null,(0,C._t)("create_space|private_personal_heading")),o.createElement("div",{className:"mx_SpaceRoomView_description"},(0,C._t)("create_space|private_personal_description",{name:(null==t||null===(i=t.createOpts)||void 0===i?void 0:i.name)||e.name})),o.createElement(be.A,{className:"mx_SpaceRoomView_privateScope_justMeButton",onClick:()=>{n(!1)}},(0,C._t)("create_space|personal_space"),o.createElement("div",null,(0,C._t)("create_space|personal_space_description"))),o.createElement(be.A,{className:"mx_SpaceRoomView_privateScope_meAndMyTeammatesButton",onClick:()=>{n(!0)}},(0,C._t)("create_space|private_space"),o.createElement("div",null,(0,C._t)("create_space|private_space_description"))))},Pg=(0,As.A)({rules:[{key:"email",test:({value:e})=>!e||lg.X(e),invalid:()=>(0,C._t)("auth|email_field_label_invalid")}]}),Ng=({space:e,onFinished:t})=>{const[n,i]=(0,o.useState)(!1),[r,s]=(0,o.useState)(""),a=[(0,o.useRef)(null),(0,o.useRef)(null),(0,o.useRef)(null)],[c,d]=cg(3,""),u=new Array(3).fill(0).map(((e,t)=>{const i="emailAddress"+t;return o.createElement(tn.A,{key:i,name:i,type:"text",label:(0,C._t)("common|email_address"),placeholder:(0,C._t)("auth|email_field_label"),value:c[t],onChange:e=>d(t,e.target.value),ref:a[t],onValidate:Pg,autoFocus:0===t,disabled:n})})),m=async r=>{if(r.preventDefault(),n)return;s("");for(const e of a){var o;if(!1===await(null===(o=e.current)||void 0===o?void 0:o.validate({allowEmpty:!0})))return e.current.focus(),void e.current.validate({allowEmpty:!0,focused:!0})}i(!0);const d=c.map((e=>e.trim())).filter(Boolean);try{const n=await(0,y.wq)(e.client,e.roomId,d),i=Object.keys(n.states).filter((e=>"error"===n.states[e]));i.length>0?(l.v.log("Failed to invite users to space: ",n),s((0,C._t)("create_space|failed_invite_users",{csvUsers:i.join(", ")}))):t()}catch(e){l.v.error("Failed to invite users to space: ",e),s((0,C._t)("invite|error_invite"))}i(!1)};let h=e=>{e.preventDefault(),t()},p=(0,C._t)("create_space|skip_action");return c.some((e=>e.trim()))&&(h=m,p=n?(0,C._t)("create_space|inviting_users"):(0,C._t)("action|continue")),o.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates"},o.createElement("h1",null,(0,C._t)("create_space|invite_teammates_heading")),o.createElement("div",{className:"mx_SpaceRoomView_description"},(0,C._t)("create_space|invite_teammates_description")),r&&o.createElement("div",{className:"mx_SpaceRoomView_errorText"},r),o.createElement("form",{onSubmit:h,id:"mx_SpaceSetupPrivateInvite"},u),o.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates_buttons"},o.createElement(be.A,{className:"mx_SpaceRoomView_inviteTeammates_inviteDialogButton",onClick:()=>(0,y._7)(e.roomId)},(0,C._t)("create_space|invite_teammates_by_username"))),o.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.createElement(be.A,{kind:"primary",disabled:n,onClick:h,element:"input",type:"submit",form:"mx_SpaceSetupPrivateInvite",value:p})))};class Dg extends o.PureComponent{constructor(e,t){var n;super(e,t),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"onMyMembership",((e,t)=>{e.roomId===this.props.space.roomId&&this.setState({myMembership:t})})),(0,r.A)(this,"onRightPanelStoreUpdate",(()=>{this.setState({showRightPanel:qn.A.instance.isOpenForRoom(this.props.space.roomId)})})),(0,r.A)(this,"onAction",(e=>{e.action!==x.r.ViewRoom||e.room_id!==this.props.space.roomId||this.setState({phase:Ag.Landing})})),(0,r.A)(this,"goToFirstRoom",(async()=>{this.state.firstRoomId?v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.state.firstRoomId,metricsTrigger:void 0}):this.setState({phase:Ag.Landing})}));let i=Ag.Landing;const o=null===(n=this.props.space.currentState.getStateEvents(s.EventType.RoomCreate,""))||void 0===n?void 0:n.getSender();var a;this.props.justCreatedOpts&&t.getSafeUserId()===o&&(i=(null===(a=this.props.justCreatedOpts.createOpts)||void 0===a?void 0:a.preset)===s.Preset.PublicChat?Ag.PublicCreateRooms:Ag.PrivateScope);this.state={phase:i,showRightPanel:qn.A.instance.isOpenForRoom(this.props.space.roomId),myMembership:this.props.space.getMyMembership()},this.dispatcherRef=v.Ay.register(this.onAction),qn.A.instance.on(A.H,this.onRightPanelStoreUpdate)}componentDidMount(){this.context.on(s.RoomEvent.MyMembership,this.onMyMembership)}componentWillUnmount(){v.Ay.unregister(this.dispatcherRef),qn.A.instance.off(A.H,this.onRightPanelStoreUpdate),this.context.off(s.RoomEvent.MyMembership,this.onMyMembership)}renderBody(){var e;switch(this.state.phase){case Ag.Landing:return this.state.myMembership===We.O.Join?o.createElement(Cg,{space:this.props.space}):o.createElement(Gm,{room:this.props.space,onJoinButtonClicked:this.props.onJoinButtonClicked,onRejectButtonClicked:this.props.onRejectButtonClicked});case Ag.PublicCreateRooms:return o.createElement(kg,{space:this.props.space,title:(0,C._t)("create_space|setup_rooms_community_heading",{spaceName:(null===(e=this.props.justCreatedOpts)||void 0===e||null===(e=e.createOpts)||void 0===e?void 0:e.name)||this.props.space.name}),description:o.createElement(o.Fragment,null,(0,C._t)("create_space|setup_rooms_community_description"),o.createElement("br",null),(0,C._t)("create_space|setup_rooms_description")),onFinished:e=>this.setState({phase:Ag.PublicShare,firstRoomId:e})});case Ag.PublicShare:return o.createElement(Ig,{justCreatedOpts:this.props.justCreatedOpts,space:this.props.space,onFinished:this.goToFirstRoom,firstRoomId:this.state.firstRoomId});case Ag.PrivateScope:return o.createElement(Tg,{space:this.props.space,justCreatedOpts:this.props.justCreatedOpts,onFinished:e=>{this.setState({phase:e?Ag.PrivateCreateRooms:Ag.PrivateExistingRooms})}});case Ag.PrivateInvite:return o.createElement(Ng,{space:this.props.space,onFinished:()=>this.setState({phase:Ag.Landing})});case Ag.PrivateCreateRooms:return o.createElement(kg,{space:this.props.space,title:(0,C._t)("create_space|setup_rooms_private_heading"),description:o.createElement(o.Fragment,null,(0,C._t)("create_space|setup_rooms_private_description"),o.createElement("br",null),(0,C._t)("create_space|setup_rooms_description")),onFinished:e=>this.setState({phase:Ag.PrivateInvite,firstRoomId:e})});case Ag.PrivateExistingRooms:return o.createElement(Rg,{space:this.props.space,onFinished:()=>this.setState({phase:Ag.Landing})})}}render(){const e=this.state.showRightPanel&&this.state.phase===Ag.Landing?o.createElement(Sm,{room:this.props.space,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.props.permalinkCreator}):void 0;return o.createElement("main",{className:"mx_SpaceRoomView"},o.createElement($s.A,null,o.createElement(Mo,{panel:e,resizeNotifier:this.props.resizeNotifier},this.renderBody())))}}(0,r.A)(Dg,"contextType",Re.Ay);var Mg=n("./node_modules/matrix-react-sdk/src/components/structures/RoomStatusBar.tsx");class Og extends o.PureComponent{render(){return o.createElement("div",{className:"mx_TopUnreadMessagesBar"},o.createElement(be.A,{className:"mx_TopUnreadMessagesBar_scrollUp",title:(0,C._t)("room|jump_read_marker"),onClick:this.props.onScrollUpClick}),o.createElement(be.A,{className:"mx_TopUnreadMessagesBar_markAsRead",title:(0,C._t)("notifications|mark_all_read"),onClick:this.props.onCloseClick}))}}var Lg=n("./node_modules/matrix-react-sdk/src/utils/direct-messages.ts"),Ug=n("./node_modules/matrix-react-sdk/src/components/views/messages/EncryptionEvent.tsx"),Fg=n("./node_modules/matrix-react-sdk/src/components/structures/RoomStatusBarUnsentMessages.tsx");const jg=({text:e})=>o.createElement("div",{className:"mx_LargeLoader"},o.createElement(dn.A,{w:45,h:45}),o.createElement("div",{className:"mx_LargeLoader_text"},e));class Bg extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"callEventGroupers",new Map),this.buildLegacyCallEventGroupers(this.props.timeline)}buildLegacyCallEventGroupers(e){this.callEventGroupers=(0,ld.fN)(this.callEventGroupers,e)}render(){const e=this.props.timeline,t=e[this.props.ourEventsIndexes[0]],n=t.getId(),i=t.getTs(),r=[o.createElement(Js.A,{key:i+"-search",roomId:t.getRoomId(),ts:i})],s=O.A.getValue("layout"),a=O.A.getValue("showTwelveHourTimestamps"),l=O.A.getValue("alwaysShowTimestamps"),c=h.J.safeGet();for(let t=0;t<e.length;t++){var d;const i=e[t];let h;const p=!this.props.ourEventsIndexes.includes(t);if(p||(h=this.props.searchHighlights),(0,Qs.bN)(i,c,null===(d=this.context)||void 0===d?void 0:d.showHiddenEvents)){var u;const d=e[t-1],g=d&&!(0,Ms.fq)(d.getDate()||void 0,i.getDate()||void 0)&&Ea(d,i,c,null===(u=this.context)||void 0===u?void 0:u.showHiddenEvents,Zr.Ae.Search);let v=!0;const _=e[t+1];if(_){var m;v=(0,Ms.fq)(i.getDate()||void 0,_.getDate()||void 0)||i.getSender()!==_.getSender()||!Ea(i,_,c,null===(m=this.context)||void 0===m?void 0:m.showHiddenEvents,Zr.Ae.Search)}r.push(o.createElement(Fs.Ay,{key:`${n}+${t}`,mxEvent:i,layout:s,contextual:p,highlights:h,permalinkCreator:this.props.permalinkCreator,highlightLink:this.props.resultLink,onHeightChanged:this.props.onHeightChanged,isTwelveHour:a,alwaysShowTimestamps:l,lastInSection:v,continuation:g,callEventGrouper:this.callEventGroupers.get(i.getContent().call_id)}))}}return o.createElement("li",{"data-scroll-tokens":n},o.createElement("ol",null,r))}}(0,r.A)(Bg,"contextType",Zr.Ay);var Vg=n("./node_modules/matrix-react-sdk/src/Typeguards.ts");const Hg=10;async function zg(e,t,n,i){const r={limit:Hg};void 0!==n&&(r.rooms=[n]);const o={search_categories:{room_events:{search_term:t,filter:r,order_by:s.SearchOrderBy.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}};return{response:await e.search({body:o},i),query:o}}async function Wg(e,t,n,i){const r=await zg(e,t,n,i),o={abortSignal:i,_query:r.query,results:[],highlights:[]};return e.processRoomEventsSearch(o,r.response)}function Gg(e,t){const n=e.result,i=t.result;return n.origin_server_ts>i.origin_server_ts?-1:n.origin_server_ts<i.origin_server_ts?1:0}async function Kg(e,t,n=!0){const i=rd.A.get(),r={search_term:e,before_limit:1,after_limit:1,limit:Hg,order_by_recency:!0,room_id:void 0};void 0!==t&&(r.room_id=t);const o=await i.search(r);if(!o)throw new Error("Local search failed");r.next_batch=o.next_batch;return{response:o,query:r}}function Jg(e,t){try{const n=e[e.length-1].result,i=t[t.length-1].result;return n.origin_server_ts<=i.origin_server_ts?-1:1}catch{return 0}}function qg(e,t,n,i){const r=n.concat(i).sort(Gg);t.results=r.slice(0,Hg),e.cachedEvents=r.slice(Hg)}function $g(e,t,n){var i;const r=function(e,t,n){var i;const r={},o=null!==(i=e.cachedEvents)&&void 0!==i?i:[];let s=e.oldestEventFrom;var a,l,c,d;if(r.highlights=e.highlights,t&&n&&n.results)Jg(null!==(a=t.results)&&void 0!==a?a:[],n.results)<0&&(s="local"),qg(e,r,null!==(l=t.results)&&void 0!==l?l:[],n.results),r.highlights=(null!==(c=t.highlights)&&void 0!==c?c:[]).concat(null!==(d=n.highlights)&&void 0!==d?d:[]);else if(t){var u,m;Jg(null!==(u=t.results)&&void 0!==u?u:[],o)<0&&(s="local"),qg(e,r,null!==(m=t.results)&&void 0!==m?m:[],o)}else n&&n.results?(Jg(n.results,o)<0&&(s="server"),qg(e,r,n.results,o)):(r.results=o,e.cachedEvents=[]);return e.oldestEventFrom=s,r}(e,t,n);if(e.count)r.count=e.count;else{var o,s;const e=null!==(o=null==t?void 0:t.count)&&void 0!==o?o:0,i=null!==(s=null==n?void 0:n.count)&&void 0!==s?s:0;r.count=e+i}return t&&(0,Vg.E)(e.seshatQuery)&&(e.seshatQuery.next_batch=t.next_batch),n&&(e.serverSideNextBatch=n.next_batch),null!==(i=e.seshatQuery)&&void 0!==i&&i.next_batch?r.next_batch=e.seshatQuery.next_batch:e.serverSideNextBatch&&(r.next_batch=e.serverSideNextBatch),!r.next_batch&&(0,Vg.E)(e.cachedEvents)&&e.cachedEvents.length>0&&(r.next_batch="cached"),r}function Yg(e=[]){for(const t of e){const e=t.context.getTimeline();for(const t of e){const e=t.event;e.curve25519Key&&(t.makeEncrypted(s.EventType.RoomMessageEncrypted,{algorithm:e.algorithm},e.curve25519Key,e.ed25519Key),t.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain,delete e.curve25519Key,delete e.ed25519Key,delete e.algorithm,delete e.forwardingCurve25519KeyChain)}}}function Qg(e,t,n,i){let r;return r=void 0!==n?e.isRoomEncrypted(n)?async function(e,t,n){const i={results:[],highlights:[]};if(""===t)return i;const r=await Kg(t,n);i.seshatQuery=r.query;const o={search_categories:{room_events:r.response}},s=e.processRoomEventsSearch(i,o);return Yg(s.results),s}(e,t,n):Wg(e,t,n,i):async function(e,t,n){const i=zg(e,t,void 0,n),r=Kg(t);await Promise.all([i,r]);const o=await r,s=await i,a=s.query,l=s.response,c=o.query,d=o.response,u={seshatQuery:c,_query:a,serverSideNextBatch:l.search_categories.room_events.next_batch,cachedEvents:[],oldestEventFrom:"server",results:[],highlights:[]},m={search_categories:{room_events:$g(u,d,l.search_categories.room_events)}},h=e.processRoomEventsSearch(u,m);return Yg(h.results),h}(e,t,i),r}function Zg(e,t){const n=t.seshatQuery,i=t._query;if(n){if(i){const n=async function(e,t){var n;const i=rd.A.get(),r=t.seshatQuery,o=t.oldestEventFrom;let s,a;if(null==r||!r.next_batch||t.serverSideNextBatch&&"server"!==o||(s=await i.search(r)),t.serverSideNextBatch&&("local"===o||null==r||!r.next_batch)){const n={body:t._query,next_batch:t.serverSideNextBatch};a=await e.search(n)}const l={search_categories:{room_events:$g(t,s,null===(n=a)||void 0===n?void 0:n.search_categories.room_events)}},c=t.results?t.results.length:0,d=e.processRoomEventsSearch(t,l),u=d.results.length-c;return Yg(d.results.slice(Math.max(d.results.length-u,0))),t.pendingRequest=void 0,d}(e,t);return t.pendingRequest=n,n}{const n=async function(e,t){var n,i;const r=rd.A.get();if(!t.seshatQuery)throw new Error("localSearchProcess must be called first");const o=await r.search(t.seshatQuery);if(!o)throw new Error("Local search pagination failed");t.seshatQuery.next_batch=o.next_batch;const s=null!==(n=null===(i=o.results)||void 0===i?void 0:i.length)&&void 0!==n?n:0,a={search_categories:{room_events:o}},l=e.processRoomEventsSearch(t,a);return Yg(l.results.slice(Math.max(l.results.length-s,0))),t.pendingRequest=void 0,l}(e,t);return t.pendingRequest=n,n}}return e.backPaginateRoomEventsSearch(t)}let Xg=function(e){return e.Room="Room",e.All="All",e}({});function ev(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}let tv=function(e){};const nv=(0,o.forwardRef)((({term:e,scope:t,promise:n,abortController:i,resizeNotifier:a,className:c,onUpdate:d,inProgress:u},m)=>{const h=(0,o.useContext)(Re.Ay),p=(0,o.useContext)(Zr.Ay),[g,v]=(0,o.useState)(null),[_,y]=(0,o.useState)(null),E=(0,o.useRef)(!1),b=(0,o.useRef)(new Map).current,w=(0,o.useRef)();(0,o.useEffect)((()=>()=>{b.forEach((e=>e.stop())),b.clear()}),[b]);const x=(0,o.useCallback)((t=>(d(!0,null),t.then((async t=>{if(tv("search complete"),E.current)return l.v.error("Discarding stale search results"),!1;let n=t.highlights;n.includes(e)||(n=n.concat(e)),n=n.sort((function(e,t){return t.length-e.length}));for(const e of t.results)for(const t of e.context.getTimeline()){if(!t.getServerAggregatedRelation(s.THREAD_RELATION_TYPE.name)||t.getThread())continue;const e=h.getRoom(t.getRoomId()),n=null==e?void 0:e.findThreadForEvent(t);n?t.setThread(n):null==e||e.createThread(t.getId(),t,[],!0)}return v(n),y(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ev(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ev(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t)),d(!1,t),!1}),(e=>{var t;return E.current?(l.v.error("Discarding stale search results"),!1):(l.v.error("Search failed",e),f.Ay.createDialog(lc.A,{title:(0,C._t)("error_dialog|search_failed|title"),description:null!==(t=null==e?void 0:e.message)&&void 0!==t?t:(0,C._t)("error_dialog|search_failed|server_unavailable")}),d(!1,null),!1)})))),[h,e,d]);if((0,o.useEffect)((()=>(E.current=!1,x(n),()=>{E.current=!0,null==i||i.abort()})),[]),null===_)return o.createElement("div",{className:"mx_RoomView_messagePanel mx_RoomView_messagePanelSearchSpinner"});const A=[];var S;(u&&A.push(o.createElement("li",{key:"search-spinner"},o.createElement(dn.A,null))),_.next_batch)||(null!=_&&null!==(S=_.results)&&void 0!==S&&S.length?A.push(o.createElement("li",{key:"search-top-marker"},o.createElement("h2",{className:"mx_RoomView_topMarker"},(0,C._t)("no_more_results")))):A.push(o.createElement("li",{key:"search-top-marker"},o.createElement("h2",{className:"mx_RoomView_topMarker"},(0,C._t)("common|no_results")))));const k=()=>{var e;null===(e=w.current)||void 0===e||e.checkScroll()};let R,I=[],T=[];for(let e=((null==_||null===(P=_.results)||void 0===P?void 0:P.length)||0)-1;e>=0;e--){var P;const n=_.results[e],i=n.context.getEvent(),r=i.getRoomId(),s=h.getRoom(r);if(!s){l.v.log("Hiding search result from an unknown room",r);continue}if(!(0,Qs.bN)(i,h,p.showHiddenEvents))continue;t===Xg.All&&r!==R&&(A.push(o.createElement("li",{key:i.getId()+"-room"},o.createElement("h2",null,(0,C._t)("common|room"),": ",s.name))),R=r);const a="#/room/"+r+"/"+i.getId(),c=n.context.getTimeline(),d=e>0?_.results[e-1].context.getTimeline():[];if(e>0&&c[c.length-1].getId()==d[0].getId()){if(0==I.length){for(let e=0==I.length?0:1;e<n.context.getTimeline().length;e++)I.push(c[e]);T.push(n.context.getOurEventIndex())}for(let e=1;e<d.length;e++)I.push(d[e]);T.push(T[T.length-1]+_.results[e-1].context.getOurEventIndex()+1);continue}0==I.length&&(I=n.context.getTimeline(),T=[],T.push(n.context.getOurEventIndex()));let u=b.get(r);u||(u=new Po.pE(s),u.start(),b.set(r,u)),A.push(o.createElement(Bg,{key:i.getId(),timeline:I,ourEventsIndexes:T,searchHighlights:null!=g?g:[],resultLink:a,permalinkCreator:u,onHeightChanged:k})),T=[],I=[]}return o.createElement(Ks.A,{ref:e=>{"function"==typeof m?m(e):m&&(m.current=e),w.current=e},className:"mx_RoomView_searchResultsPanel "+c,onFillRequest:async e=>{if(!e)return!1;if(!_.next_batch)return tv("no more search results"),!1;tv("requesting more search results");const t=function(e,t){const n=rd.A.get();return t.pendingRequest?t.pendingRequest:null===n?e.backPaginateRoomEventsSearch(t):Zg(e,t)}(h,_);return x(t)},resizeNotifier:a},o.createElement("li",{className:"mx_RoomView_scrollheader"}),A)}));var iv=n("./node_modules/matrix-react-sdk/src/VoipUserMapper.ts");const rv=({roomView:e,resizeNotifier:t,inviteEvent:n})=>{const i=(0,Zr.mP)(),r=g.Ay.get().brand;return o.createElement("div",{className:"mx_RoomView mx_RoomView--local"},o.createElement($s.A,null,O.A.getValue("feature_new_room_decoration_ui")?o.createElement(ig,{room:i.room}):o.createElement(gp,{room:i.room,inRoom:!0,onInviteClick:null,onForgetClick:null,e2eStatus:fs.z.Normal,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),o.createElement("main",{className:"mx_RoomView_body",ref:e},o.createElement("div",{className:"mx_RoomView_timeline"},o.createElement(Ks.A,{className:"mx_RoomView_messagePanel",resizeNotifier:t},o.createElement(ta.A,{className:"mx_cryptoEvent mx_cryptoEvent_icon",title:(0,C._t)("room|waiting_for_join_title",{brand:r}),subtitle:(0,C._t)("room|waiting_for_join_subtitle",{brand:r})}),o.createElement(va,null),o.createElement(Fs.f3,{mxEvent:n}))))))};var ov=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/search.js");const sv=({searchInfo:e,isRoomEncrypted:t,onSearchScopeChange:n,onCancelClick:i})=>{var r;const s=null!==(r=null==e?void 0:e.scope)&&void 0!==r?r:Xg.Room;return o.createElement(o.Fragment,null,o.createElement(u.Z,{screenName:"RoomSearch"}),o.createElement("div",{className:"mx_RoomSearchAuxPanel"},o.createElement("div",{className:"mx_RoomSearchAuxPanel_summary"},o.createElement(ov.A,{width:"24px",height:"24px"}),o.createElement("div",{className:"mx_RoomSearchAuxPanel_summary_text"},void 0!==(null==e?void 0:e.count)?(0,C._t)("room|search|summary",{count:e.count},{query:()=>o.createElement("b",null,e.term)}):o.createElement(Ve.A,null),o.createElement(sd,{kind:od.Search,isRoomEncrypted:t,showLogo:!1}))),o.createElement("div",{className:"mx_RoomSearchAuxPanel_buttons"},o.createElement(ke.N_,{onClick:()=>n(s===Xg.Room?Xg.All:Xg.Room),kind:"primary"},s===Xg.All?(0,C._t)("room|search|this_room_button"):(0,C._t)("room|search|all_rooms_button")),o.createElement(ke.K0,{onClick:i,destructive:!0,tooltip:(0,C._t)("action|cancel"),"aria-label":(0,C._t)("action|cancel")},o.createElement(bp.A,{width:"20px",height:"20px"})))))};var av;function lv(){return lv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},lv.apply(null,arguments)}var cv=function(e,t){return o.createElement("svg",lv({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),av||(av=o.createElement("path",{d:"M5.769 2.857A.5.5 0 0 1 6.119 2h11.762a.5.5 0 0 1 .35.857L16.15 4.9a.5.5 0 0 0-.15.357v4.487a.5.5 0 0 0 .15.356l3.7 3.644a.5.5 0 0 1 .15.356v1.4a.5.5 0 0 1-.5.5H13v6a1 1 0 1 1-2 0v-6H4.5a.5.5 0 0 1-.5-.5v-1.4a.5.5 0 0 1 .15-.356l3.7-3.644A.5.5 0 0 0 8 9.744V5.257a.5.5 0 0 0-.15-.357z"})))},dv=(0,o.forwardRef)(cv);var uv=n("./node_modules/matrix-react-sdk/src/stores/room-list/MessagePreviewStore.ts");function mv({room:e,permalinkCreator:t}){const n=ol(e),i=cl(e,n),r=i.length,s=1===r,[a,l]=(0,o.useState)(r-1);(0,o.useEffect)((()=>{l((()=>r-1))}),[r]);const c=i[a];if(!c)return null;const d=c.isRedacted()||c.isDecryptionFailure();return o.createElement("div",{className:"mx_PinnedMessageBanner","data-single-message":s,"aria-label":(0,C._t)("room|pinned_message_banner|description")},o.createElement("button",{"aria-label":(0,C._t)("room|pinned_message_banner|go_to_message"),type:"button",className:"mx_PinnedMessageBanner_main",onClick:()=>{u.A.trackInteraction("PinnedMessageBannerClick"),v.Ay.dispatch({action:x.r.ViewRoom,event_id:c.getId(),highlighted:!0,room_id:e.roomId,metricsTrigger:void 0}),l((e=>-1==--e?r-1:e))}},o.createElement("div",{className:"mx_PinnedMessageBanner_content"},o.createElement(gv,{count:r,currentIndex:a}),o.createElement(dv,{width:"20",className:"mx_PinnedMessageBanner_PinIcon"}),!s&&o.createElement("div",{className:"mx_PinnedMessageBanner_title"},(0,C._t)("room|pinned_message_banner|title",{index:a+1,length:r},{bold:e=>o.createElement("span",{className:"mx_PinnedMessageBanner_title_counter"},e)})),o.createElement(hv,{pinnedEvent:c}),d&&o.createElement("div",{className:"mx_PinnedMessageBanner_redactedMessage"},o.createElement(Zu.A,{mxEvent:c,maxImageHeight:20,permalinkCreator:t,replacingEventId:c.replacingEventId()})))),!s&&o.createElement(fv,{room:e}))}function hv({pinnedEvent:e}){const t=function(e){return(0,o.useMemo)((()=>!e||e.isRedacted()||e.isDecryptionFailure()?null:uv.X.instance.generatePreviewForEvent(e)),[e])}(e);if(!t)return null;const n=function(e,t){if(e===s.M_POLL_START.name)return(0,C._t)("room|pinned_message_banner|prefix|poll");switch(t){case s.MsgType.Audio:return(0,C._t)("room|pinned_message_banner|prefix|audio");case s.MsgType.Image:return(0,C._t)("room|pinned_message_banner|prefix|image");case s.MsgType.Video:return(0,C._t)("room|pinned_message_banner|prefix|video");case s.MsgType.File:return(0,C._t)("room|pinned_message_banner|prefix|file");default:return null}}(e.getType(),e.getContent().msgtype);return n?o.createElement("span",{className:"mx_PinnedMessageBanner_message"},(0,C._t)("room|pinned_message_banner|preview",{prefix:n,preview:t},{bold:e=>o.createElement("span",{className:"mx_PinnedMessageBanner_prefix"},e)})):o.createElement("span",{className:"mx_PinnedMessageBanner_message"},t)}const pv=3;function gv({count:e,currentIndex:t}){const n=Math.min(e,pv),i=t%n,r=Math.ceil(e/n),s=t>=(r-1)*pv,a=n-(r*n-e);return o.createElement("div",{className:"mx_PinnedMessageBanner_Indicators"},Array.from({length:n}).map(((e,t)=>o.createElement(vv,{key:t,active:t===i,hidden:s&&a<=t}))))}function vv({active:e,hidden:t}){return o.createElement("div",{className:ee()("mx_PinnedMessageBanner_Indicator",{"mx_PinnedMessageBanner_Indicator--active":e,"mx_PinnedMessageBanner_Indicator--hidden":t})})}function _v(e){return qn.A.instance.isOpenForRoom(e)?qn.A.instance.currentCard.phase:null}function fv({room:e}){const[t,n]=(0,o.useState)(_v(e.roomId));(0,Pe.ml)(qn.A.instance,A.H,(()=>n(_v(e.roomId))));const i=t===$n.n.PinnedMessages;return o.createElement(ke.$n,{className:"mx_PinnedMessageBanner_actions",kind:"tertiary",onClick:()=>{i?u.A.trackInteraction("PinnedMessageBannerCloseListButton"):u.A.trackInteraction("PinnedMessageBannerViewAllButton"),qn.A.instance.showOrHidePhase($n.n.PinnedMessages)}},i?(0,C._t)("room|pinned_message_banner|button_close_list"):(0,C._t)("room|pinned_message_banner|button_view_all"))}const yv=["upgradeRecommendation"],Ev=["upgradeRecommendation"];function bv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function wv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bv(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bv(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let xv=function(e){};const Av="sandbox"in document.createElement("iframe");let Sv=function(e){return e[e.Timeline=0]="Timeline",e[e.MaximisedWidget=1]="MaximisedWidget",e[e.Call=2]="Call",e}({});function Cv(e){const t=(0,o.useContext)(Zr.Ay),n=t.room,i=e.localRoom.currentState.getStateEvents(s.EventType.RoomEncryption)[0];let r;i&&(r=o.createElement(Ug.A,{mxEvent:i}));const a=()=>{n.state=pa.cd.NEW,v.bA.dispatch({action:"local_room_event",roomId:n.roomId})};let l=null,c=null;if(n.isError){const e=o.createElement(be.A,{onClick:a,className:"mx_RoomStatusBar_unsentRetry"},(0,C._t)("action|retry"));l=o.createElement(Fg.E,{title:(0,C._t)("room|status_bar|some_messages_not_sent"),notificationState:Ye.d.RED_EXCLAMATION,buttons:e})}else c=o.createElement(Xd,{room:e.localRoom,resizeNotifier:e.resizeNotifier,permalinkCreator:e.permalinkCreator});return o.createElement("div",{className:"mx_RoomView mx_RoomView--local"},o.createElement($s.A,null,O.A.getValue("feature_new_room_decoration_ui")?o.createElement(ig,{room:n}):o.createElement(gp,{room:t.room,searchInfo:void 0,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:n.encrypted?fs.z.Normal:void 0,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),o.createElement("main",{className:"mx_RoomView_body",ref:e.roomView},o.createElement(su,{parent:e.roomView.current,onFileDrop:e.onFileDrop}),o.createElement("div",{className:"mx_RoomView_timeline"},o.createElement(Ks.A,{className:"mx_RoomView_messagePanel",resizeNotifier:e.resizeNotifier},r,o.createElement(va,null))),l,c)))}function kv(e){const t=(0,C._t)("room|creating_room_text",{names:e.names});return o.createElement("div",{className:"mx_RoomView mx_RoomView--local"},o.createElement($s.A,null,O.A.getValue("feature_new_room_decoration_ui")?o.createElement(ig,{room:e.localRoom}):o.createElement(gp,{room:e.localRoom,searchInfo:void 0,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:e.localRoom.encrypted?fs.z.Normal:void 0,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),o.createElement("div",{className:"mx_RoomView_body"},o.createElement(jg,{text:t}))))}class Rv extends o.Component{constructor(e,t){var n;if(super(e,t),(0,r.A)(this,"askToJoinEnabled",void 0),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"settingWatchers",void 0),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"permalinkCreators",{}),(0,r.A)(this,"roomView",(0,o.createRef)()),(0,r.A)(this,"searchResultsPanel",(0,o.createRef)()),(0,r.A)(this,"messagePanel",null),(0,r.A)(this,"roomViewBody",(0,o.createRef)()),(0,r.A)(this,"onIsResizing",(e=>{this.setState({resizing:e})})),(0,r.A)(this,"onWidgetStoreUpdate",(()=>{this.state.room&&(this.checkWidgets(this.state.room),this.doMaybeRemoveOwnJitsiWidget())})),(0,r.A)(this,"onWidgetEchoStoreUpdate",(()=>{this.state.room&&this.checkWidgets(this.state.room)})),(0,r.A)(this,"onWidgetLayoutChange",(()=>{this.state.room&&(v.Ay.dispatch({action:"appsDrawer",show:!0}),this.context.widgetLayoutStore.hasMaximisedWidget(this.state.room)&&this.context.rightPanelStore.setCard({phase:$n.n.Timeline}),this.checkWidgets(this.state.room))})),(0,r.A)(this,"checkWidgets",(e=>{this.setState({hasPinnedWidgets:this.context.widgetLayoutStore.hasPinnedWidgets(e),mainSplitContentType:this.getMainSplitContentType(e),showApps:this.shouldShowApps(e)})})),(0,r.A)(this,"getMainSplitContentType",(e=>O.A.getValue("feature_group_calls")&&this.context.roomViewStore.isViewingCall()||(0,el.j)(e)?Sv.Call:this.context.widgetLayoutStore.hasMaximisedWidget(e)?Sv.MaximisedWidget:Sv.Timeline)),(0,r.A)(this,"onRoomViewStoreUpdate",(async e=>{var t,n,i,r,o,s,a;if(this.unmounted)return;const c=null!==(t=this.context.roomViewStore.getRoomLoadError())&&void 0!==t?t:void 0;if(!e&&!c&&this.state.roomId!==this.context.roomViewStore.getRoomId())return;const d=null!==(n=this.context.roomViewStore.getRoomId())&&void 0!==n?n:null,u=null!==(i=null===(r=this.context.client)||void 0===r?void 0:r.getRoom(null!=d?d:void 0))&&void 0!==i?i:void 0,m={roomId:null!=d?d:void 0,roomAlias:null!==(o=this.context.roomViewStore.getRoomAlias())&&void 0!==o?o:void 0,roomLoading:this.context.roomViewStore.isRoomLoading(),roomLoadError:c,joining:this.context.roomViewStore.isJoining(),replyToEvent:null!==(s=this.context.roomViewStore.getQuotingEvent())&&void 0!==s?s:void 0,shouldPeek:this.state.matrixClientIsReady&&this.context.roomViewStore.shouldPeek(),showReadReceipts:O.A.getValue("showReadReceipts",d),showRedactions:O.A.getValue("showRedactions",d),showJoinLeaves:O.A.getValue("showJoinLeaves",d),showAvatarChanges:O.A.getValue("showAvatarChanges",d),showDisplaynameChanges:O.A.getValue("showDisplaynameChanges",d),wasContextSwitch:this.context.roomViewStore.getWasContextSwitch(),mainSplitContentType:u?this.getMainSplitContentType(u):void 0,initialEventId:void 0,showRightPanel:!!d&&this.context.rightPanelStore.isOpenForRoom(d),threadRightPanel:!!d&&[$n.n.ThreadView,$n.n.ThreadPanel].includes(this.context.rightPanelStore.currentCardForRoom(d).phase),activeCall:d?Mp.e.instance.getActiveCall(d):null,promptAskToJoin:this.context.roomViewStore.promptAskToJoin(),viewRoomOpts:this.context.roomViewStore.getViewRoomOpts()};var h;this.state.mainSplitContentType!==Sv.Timeline&&m.mainSplitContentType===Sv.Timeline&&this.context.rightPanelStore.isOpen&&this.context.rightPanelStore.currentCard.phase===$n.n.Timeline&&this.context.rightPanelStore.roomPhaseHistory.some((e=>e.phase===$n.n.Timeline))&&(this.context.rightPanelStore.setCard({phase:$n.n.RoomSummary}),this.context.rightPanelStore.togglePanel(null!==(h=this.state.roomId)&&void 0!==h?h:null),m.showRightPanel=!1);const p=null!==(a=this.context.roomViewStore.getInitialEventId())&&void 0!==a?a:this.state.initialEventId;if(p){var g,_;let e=null==u?void 0:u.findEventById(p);var f;if(!e&&this.context.client&&d)e=null!==(f=await(0,Os.$I)(this.context.client,d,p))&&void 0!==f?f:void 0;m.initialEventPixelOffset=void 0;const t=null===(g=e)||void 0===g?void 0:g.getThread();null==t||!t.rootEvent||null!==(_=e)&&void 0!==_&&_.isThreadRoot?(m.initialEventId=p,m.isInitialEventHighlighted=this.context.roomViewStore.isInitialEventHighlighted(),m.initialEventScrollIntoView=this.context.roomViewStore.initialEventScrollIntoView()):v.Ay.dispatch({action:x.r.ShowThread,rootEvent:t.rootEvent,initialEvent:e,highlighted:this.context.roomViewStore.isInitialEventHighlighted(),scroll_into_view:this.context.roomViewStore.initialEventScrollIntoView()})}var y,E;(this.settingWatchers=this.settingWatchers.concat([O.A.watchSetting("showReadReceipts",d,((...[,,,e])=>this.setState({showReadReceipts:e}))),O.A.watchSetting("showRedactions",d,((...[,,,e])=>this.setState({showRedactions:e}))),O.A.watchSetting("showJoinLeaves",d,((...[,,,e])=>this.setState({showJoinLeaves:e}))),O.A.watchSetting("showAvatarChanges",d,((...[,,,e])=>this.setState({showAvatarChanges:e}))),O.A.watchSetting("showDisplaynameChanges",d,((...[,,,e])=>this.setState({showDisplaynameChanges:e})))]),e||!this.state.shouldPeek||m.shouldPeek)||(null===(y=this.context.client)||void 0===y||y.stopPeeking());if(l.v.log("RVS update:",m.roomId,m.roomAlias,"loading?",m.roomLoading,"joining?",m.joining,"initial?",e,"shouldPeek?",m.shouldPeek),e&&(m.room=this.context.client.getRoom(m.roomId)||void 0,m.room&&(m.showApps=this.shouldShowApps(m.room),this.onRoomLoaded(m.room))),void 0===this.state.roomId&&void 0!==m.roomId&&!m.initialEventId&&m.roomId){const e=km.getScrollState(m.roomId);e&&(m.initialEventId=e.focussedEvent,m.initialEventPixelOffset=e.pixelOffset)}this.state.timelineRenderingType===Zr.Ae.Search&&this.state.initialEventId!==m.initialEventId&&(m.timelineRenderingType=Zr.Ae.Room,null===(E=this.state.search)||void 0===E||null===(E=E.abortController)||void 0===E||E.abort(),m.search=void 0);this.setState(m),e&&this.setupRoom(m.room,m.roomId,!!m.joining,!!m.shouldPeek)})),(0,r.A)(this,"onConnectedCalls",(()=>{if(void 0===this.state.roomId)return;const e=Mp.e.instance.getActiveCall(this.state.roomId);null===e&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.state.roomId,view_call:!1,metricsTrigger:void 0},!0),this.setState({activeCall:e})})),(0,r.A)(this,"getRoomId",(()=>{var e,t;return null!==(e=null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&void 0!==e?e:this.state.roomId})),(0,r.A)(this,"onRightPanelStoreUpdate",(()=>{const{roomId:e}=this.state;this.setState({showRightPanel:!!e&&this.context.rightPanelStore.isOpenForRoom(e),threadRightPanel:!!e&&[$n.n.ThreadView,$n.n.ThreadPanel].includes(this.context.rightPanelStore.currentCardForRoom(e).phase)})})),(0,r.A)(this,"onPageUnload",(e=>No.Ay.sharedInstance().getCurrentUploads().length>0?e.returnValue=(0,C._t)("quit_warning|file_upload_in_progress"):this.getCallForRoom()&&"ended"!==this.state.callState?e.returnValue=(0,C._t)("quit_warning|call_in_progress"):void 0)),(0,r.A)(this,"onReactKeyDown",(e=>{var t;let n=!1;switch((0,Se.zM)().getRoomAction(e)){case Ee.bY.DismissReadMarker:null===(t=this.messagePanel)||void 0===t||t.forgetReadMarker(),this.jumpToLiveTimeline(),n=!0;break;case Ee.bY.JumpToOldestUnread:this.jumpToReadMarker(),n=!0;break;case Ee.bY.UploadFile:v.Ay.dispatch({action:"upload_file",context:Zr.Ae.Room},!0),n=!0}n&&(e.stopPropagation(),e.preventDefault())})),(0,r.A)(this,"onCallState",(e=>{if(!e)return;const t=this.getCallForRoom();this.setState({callState:null==t?void 0:t.state})})),(0,r.A)(this,"onAction",(async e=>{var t;if(this.context.client)switch(e.action){case"message_sent":this.checkDesktopNotifications();break;case"post_sticker_message":this.injectSticker(e.data.content.url,e.data.content.info,e.data.description||e.data.name,e.data.threadId);break;case"picture_snapshot":{const t=this.getRoomId();(0,Vg.E)(t)&&No.Ay.sharedInstance().sendContentListToRoom([e.file],t,void 0,this.context.client);break}case"notifier_enabled":case x.r.UploadStarted:case x.r.UploadFinished:case x.r.UploadCanceled:this.forceUpdate();break;case"appsDrawer":this.setState({showApps:e.show});break;case"reply_to_event":!this.unmounted&&this.state.search&&(null===(t=e.event)||void 0===t?void 0:t.getRoomId())===this.state.roomId&&e.context===Zr.Ae.Search&&this.onCancelSearchClick();break;case"MatrixActions.sync":var n;if(!this.state.matrixClientIsReady)this.setState({matrixClientIsReady:!(null===(n=this.context.client)||void 0===n||!n.isInitialSyncComplete())},(()=>{this.onRoomViewStoreUpdate(!0)}));break;case"local_room_event":this.onLocalRoomEvent(e.roomId);break;case x.r.EditEvent:{if(e.timelineRenderingType!==this.state.timelineRenderingType)return;if(e.event&&e.event.getRoomId()!==this.state.roomId)return void v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.event.getRoomId(),metricsTrigger:void 0,deferred_action:e});const t=e.event?new eu(e.event):void 0;this.setState({editState:t,search:void 0},(()=>{var t;e.event&&(null===(t=this.messagePanel)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))}));break}case x.r.ComposerInsert:{if(e.composerType)break;let t=e.timelineRenderingType;if(t===Zr.Ae.Thread)break;this.state.timelineRenderingType===Zr.Ae.Search&&e.timelineRenderingType===Zr.Ae.Search&&(await this.onCancelSearchClick(),t=Zr.Ae.Room),v.Ay.dispatch(wv(wv({},e),{},{timelineRenderingType:t,composerType:this.state.editState?au.D.Edit:au.D.Send}));break}case x.r.FocusAComposer:v.Ay.dispatch(wv(wv({},e),{},{action:this.state.editState?x.r.FocusEditMessageComposer:x.r.FocusSendMessageComposer}));break;case"scroll_to_bottom":var i;if(e.timelineRenderingType===Zr.Ae.Room)null===(i=this.messagePanel)||void 0===i||i.jumpToLiveTimeline();break;case x.r.ViewUser:e.member?e.push?qn.A.instance.pushCard({phase:$n.n.RoomMemberInfo,state:{member:e.member}}):qn.A.instance.setCards([{phase:$n.n.RoomSummary},{phase:$n.n.RoomMemberList},{phase:$n.n.RoomMemberInfo,state:{member:e.member}}]):qn.A.instance.showOrHidePhase($n.n.RoomMemberList);break;case x.r.View3pidInvite:((e,t)=>{e.event?t.pushCard({phase:$n.n.Room3pidMemberInfo,state:{memberInfoEvent:e.event}}):t.showOrHidePhase($n.n.RoomMemberList)})(e,qn.A.instance)}})),(0,r.A)(this,"onRoomTimeline",((e,t,n,i,r)=>{var o;this.unmounted||t&&t.roomId===(null===(o=this.state.room)||void 0===o?void 0:o.roomId)&&r.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&("org.matrix.room.preview_urls"===e.getType()&&this.updatePreviewUrlVisibility(t),"m.room.encryption"===e.getType()&&(this.updateE2EStatus(t),this.updatePreviewUrlVisibility(t)),!n&&null!=r&&r.liveEvent&&(this.state.joining||(e.isBeingDecrypted()||e.isDecryptionFailure()||this.handleEffects(e),this.context.client&&e.getSender()!==this.context.client.getSafeUserId()&&(!this.state.search&&this.state.atEndOfLiveTimeline||(0,Io.A)(e,this.state)||this.setState((e=>({numUnreadMessages:e.numUnreadMessages+1})))))))})),(0,r.A)(this,"onEventDecrypted",(e=>{this.state.room&&this.state.matrixClientIsReady&&e.getRoomId()===this.state.room.roomId&&(e.isDecryptionFailure()||this.handleEffects(e))})),(0,r.A)(this,"handleEffects",(e=>{if(!this.state.room)return;this.context.roomNotificationStateStore.getRoomState(this.state.room).isUnread&&Hl.y.forEach((t=>{((0,zl._)(e.getContent(),t.emojis)||e.getContent().msgtype===t.msgType)&&(e.isRelation(s.THREAD_RELATION_TYPE.name)||v.Ay.dispatch({action:`effects.${t.command}`}))}))})),(0,r.A)(this,"onRoomName",(e=>{this.state.room&&e.roomId==this.state.room.roomId&&this.forceUpdate()})),(0,r.A)(this,"onKeyBackupStatus",(()=>{this.forceUpdate()})),(0,r.A)(this,"canResetTimeline",(()=>!this.messagePanel||this.messagePanel.canResetTimeline())),(0,r.A)(this,"loadVirtualRoom",(async e=>{const t=(null==e?void 0:e.roomId)&&await iv.A.sharedInstance().getVirtualRoomForRoom(null==e?void 0:e.roomId);this.setState({virtualRoom:t||void 0})})),(0,r.A)(this,"onRoomLoaded",(e=>{this.unmounted||(this.context.widgetLayoutStore.on(hc.aK.emissionForRoom(e),this.onWidgetLayoutChange),this.calculatePeekRules(e),this.updatePreviewUrlVisibility(e),this.loadMembersIfJoined(e),this.calculateRecommendedVersion(e),this.updateE2EStatus(e),this.updatePermissions(e),this.checkWidgets(e),this.loadVirtualRoom(e),this.getMainSplitContentType(e)!==Sv.Timeline&&this.context.roomNotificationStateStore.getRoomState(e).isUnread&&this.context.rightPanelStore.setCard({phase:$n.n.Timeline},!0,e.roomId),this.setState({tombstone:this.getRoomTombstone(e),liveTimeline:e.getLiveTimeline()}),v.Ay.dispatch({action:x.r.RoomLoaded}))})),(0,r.A)(this,"onRoomTimelineReset",(e=>{var t;e&&e.roomId===(null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&e.getLiveTimeline()!==this.state.liveTimeline&&(l.v.log(`Live timeline of ${e.roomId} was reset`),this.setState({liveTimeline:e.getLiveTimeline()}))})),(0,r.A)(this,"onRoom",(e=>{e&&e.roomId===this.state.roomId&&(this.state.room&&this.context.widgetLayoutStore.off(hc.aK.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.setState({room:e},(()=>{this.onRoomLoaded(e)})))})),(0,r.A)(this,"onDeviceVerificationChanged",(e=>{const t=this.state.room;null!=t&&t.currentState.getMember(e)&&this.updateE2EStatus(t)})),(0,r.A)(this,"onUserVerificationChanged",(e=>{const t=this.state.room;t&&t.currentState.getMember(e)&&this.updateE2EStatus(t)})),(0,r.A)(this,"onCrossSigningKeysChanged",(()=>{const e=this.state.room;e&&this.updateE2EStatus(e)})),(0,r.A)(this,"onUrlPreviewsEnabledChange",(()=>{this.state.room&&this.updatePreviewUrlVisibility(this.state.room)})),(0,r.A)(this,"onRoomStateEvents",((e,t)=>{if(this.state.room&&this.state.room.roomId===t.roomId)if(e.getType()===s.EventType.RoomTombstone)this.setState({tombstone:this.getRoomTombstone()});else this.updatePermissions(this.state.room)})),(0,r.A)(this,"onRoomStateUpdate",(e=>{var t;e.roomId===(null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&this.updateRoomMembers()})),(0,r.A)(this,"onMyMembership",(e=>{e.roomId===this.state.roomId&&(this.forceUpdate(),this.loadMembersIfJoined(e),this.updatePermissions(e))})),(0,r.A)(this,"updateRoomMembers",(0,c.throttle)((()=>{this.state.room&&(this.updateDMState(),this.updateE2EStatus(this.state.room))}),500,{leading:!0,trailing:!0})),(0,r.A)(this,"onInviteClick",(()=>{v.Ay.dispatch({action:"view_invite",roomId:this.getRoomId()})})),(0,r.A)(this,"onJoinButtonClicked",(()=>{var e;null!==(e=this.context.client)&&void 0!==e&&e.isGuest()?(v.Ay.dispatch({action:x.r.DoAfterSyncPrepared,deferred_action:{action:x.r.ViewRoom,room_id:this.getRoomId(),metricsTrigger:void 0}}),v.Ay.dispatch({action:"require_registration"})):Promise.resolve().then((()=>{var e;const t=null===(e=this.props.threepidInvite)||void 0===e?void 0:e.signUrl,n=this.getRoomId();var i;(0,Vg.E)(n)&&v.Ay.dispatch({action:x.r.JoinRoom,roomId:n,opts:{inviteSignUrl:t},metricsTrigger:(null===(i=this.state.room)||void 0===i?void 0:i.getMyMembership())===We.O.Invite?"Invite":"RoomPreview",canAskToJoin:this.state.canAskToJoin});return Promise.resolve()}))})),(0,r.A)(this,"onMessageListScroll",(()=>{var e;null!==(e=this.messagePanel)&&void 0!==e&&e.isAtEndOfLiveTimeline()?this.setState({numUnreadMessages:0,atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.updateTopUnreadMessagesBar()})),(0,r.A)(this,"resetJumpToEvent",(e=>{this.state.initialEventId&&this.state.initialEventScrollIntoView&&this.state.initialEventId===e&&(xv("Removing scroll_into_view flag from initial event"),v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.getRoomId(),event_id:this.state.initialEventId,highlighted:this.state.isInitialEventHighlighted,scroll_into_view:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0}))})),(0,r.A)(this,"onSearch",((e,t=Xg.Room)=>{const n=t===Xg.Room?this.getRoomId():void 0;xv("sending search request");const i=new AbortController,r=function(e,t,n,i){return null===rd.A.get()?Wg(e,t,n,i):Qg(e,t,n,i)}(this.context.client,e,n,i.signal);this.setState({timelineRenderingType:Zr.Ae.Search,search:{searchId:(new Date).getTime(),roomId:n,term:e,scope:t,promise:r,abortController:i}})})),(0,r.A)(this,"onSearchScopeChange",(e=>{var t,n;this.onSearch(null!==(t=null===(n=this.state.search)||void 0===n?void 0:n.term)&&void 0!==t?t:"",e)})),(0,r.A)(this,"onSearchUpdate",((e,t)=>{this.setState({search:wv(wv({},this.state.search),{},{count:null==t?void 0:t.count,inProgress:e})})})),(0,r.A)(this,"onAppsClick",(()=>{v.Ay.dispatch({action:"appsDrawer",show:!this.state.showApps})})),(0,r.A)(this,"onForgetClick",(()=>{v.Ay.dispatch({action:"forget_room",room_id:this.getRoomId()})})),(0,r.A)(this,"onRejectButtonClicked",(()=>{var e;const t=this.getRoomId();t&&(this.setState({rejecting:!0}),null===(e=this.context.client)||void 0===e||e.leave(t).then((()=>{v.Ay.dispatch({action:x.r.ViewHomePage}),this.setState({rejecting:!1})}),(e=>{l.v.error(`Failed to reject invite: ${e}`);const t=e.message?e.message:JSON.stringify(e);f.Ay.createDialog(lc.A,{title:(0,C._t)("room|failed_reject_invite"),description:t}),this.setState({rejecting:!1})})))})),(0,r.A)(this,"onRejectAndIgnoreClick",(async()=>{this.setState({rejecting:!0});try{const e=this.state.room.getMember(this.context.client.getSafeUserId()).events.member,t=this.context.client.getIgnoredUsers();t.push(e.getSender()),await this.context.client.setIgnoredUsers(t),await this.context.client.leave(this.state.roomId),v.Ay.dispatch({action:x.r.ViewHomePage}),this.setState({rejecting:!1})}catch(e){l.v.error(`Failed to reject invite: ${e}`);const t=e instanceof Error?e.message:JSON.stringify(e);f.Ay.createDialog(lc.A,{title:(0,C._t)("room|failed_reject_invite"),description:t}),this.setState({rejecting:!1})}})),(0,r.A)(this,"onRejectThreepidInviteButtonClicked",(()=>{v.Ay.fire(x.r.ViewRoomDirectory)})),(0,r.A)(this,"onSearchClick",(()=>{v.Ay.fire(x.r.FocusMessageSearch)})),(0,r.A)(this,"onSearchChange",(0,c.debounce)((e=>{const t=e.target.value;this.onSearch(t)}),300)),(0,r.A)(this,"onCancelSearchClick",(()=>new Promise((e=>{this.setState({timelineRenderingType:Zr.Ae.Room,search:void 0},e)})))),(0,r.A)(this,"jumpToLiveTimeline",(()=>{var e;this.state.initialEventId&&this.state.isInitialEventHighlighted?v.Ay.dispatch({action:x.r.ViewRoom,room_id:this.getRoomId(),metricsTrigger:void 0}):(null===(e=this.messagePanel)||void 0===e||e.jumpToLiveTimeline(),v.Ay.fire(x.r.FocusSendMessageComposer))})),(0,r.A)(this,"jumpToReadMarker",(()=>{var e;null===(e=this.messagePanel)||void 0===e||e.jumpToReadMarker()})),(0,r.A)(this,"forgetReadMarker",(e=>{var t;e.stopPropagation(),null===(t=this.messagePanel)||void 0===t||t.forgetReadMarker()})),(0,r.A)(this,"updateTopUnreadMessagesBar",(()=>{if(!this.messagePanel)return;const e=this.messagePanel.canJumpToReadMarker();this.state.showTopUnreadMessagesBar!=e&&this.setState({showTopUnreadMessagesBar:e})})),(0,r.A)(this,"onStatusBarVisible",(()=>{this.unmounted||this.state.statusBarVisible||this.setState({statusBarVisible:!0})})),(0,r.A)(this,"onStatusBarHidden",(()=>{!this.unmounted&&this.state.statusBarVisible&&this.setState({statusBarVisible:!1})})),(0,r.A)(this,"handleScrollKey",(e=>{var t;let n;this.searchResultsPanel.current?n=this.searchResultsPanel.current:this.messagePanel&&(n=this.messagePanel),null===(t=n)||void 0===t||t.handleScrollKey(e)})),(0,r.A)(this,"gatherTimelinePanelRef",(e=>{this.messagePanel=e})),(0,r.A)(this,"onHiddenHighlightsClick",(()=>{const e=this.getOldRoom();e&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.roomId,metricsTrigger:"Predecessor"})})),(0,r.A)(this,"onFileDrop",(async e=>{const t=this.getRoomId();t&&this.context.client&&await No.Ay.sharedInstance().sendContentListToRoom(Array.from(e.files),t,void 0,this.context.client,Zr.Ae.Room)})),(0,r.A)(this,"onMeasurement",(e=>{this.setState({narrow:e})})),(0,r.A)(this,"onSubmitAskToJoin",(e=>{const t=this.getRoomId();(0,Vg.E)(t)&&v.Ay.dispatch({action:x.r.SubmitAskToJoin,roomId:t,opts:{reason:e}})})),(0,r.A)(this,"onCancelAskToJoin",(()=>{const e=this.getRoomId();(0,Vg.E)(e)&&v.Ay.dispatch({action:x.r.CancelAskToJoin,roomId:e})})),this.askToJoinEnabled=O.A.getValue("feature_ask_to_join"),!t.client)throw new Error("Unable to create RoomView without MatrixClient");const i=t.client.hasLazyLoadMembersEnabled();this.state={roomId:void 0,roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!i,numUnreadMessages:0,callState:void 0,activeCall:null,canPeek:!1,canSelfRedact:!1,showApps:!1,isPeeking:!1,showRightPanel:!1,threadRightPanel:!1,joining:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canSendMessages:!1,resizing:!1,layout:O.A.getValue("layout"),lowBandwidth:O.A.getValue("lowBandwidth"),alwaysShowTimestamps:O.A.getValue("alwaysShowTimestamps"),showTwelveHourTimestamps:O.A.getValue("showTwelveHourTimestamps"),userTimezone:To.dB(),readMarkerInViewThresholdMs:O.A.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:O.A.getValue("readMarkerOutOfViewThresholdMs"),showHiddenEvents:O.A.getValue("showHiddenEventsInTimeline"),showReadReceipts:!0,showRedactions:!0,showJoinLeaves:!0,showAvatarChanges:!0,showDisplaynameChanges:!0,matrixClientIsReady:null===(n=t.client)||void 0===n?void 0:n.isInitialSyncComplete(),mainSplitContentType:Sv.Timeline,timelineRenderingType:Zr.Ae.Room,liveTimeline:void 0,narrow:!1,msc3946ProcessDynamicPredecessor:O.A.getValue("feature_dynamic_room_predecessors"),canAskToJoin:this.askToJoinEnabled,promptAskToJoin:!1,viewRoomOpts:{buttons:[]}},this.dispatcherRef=v.Ay.register(this.onAction),t.client.on(s.ClientEvent.Room,this.onRoom),t.client.on(s.RoomEvent.Timeline,this.onRoomTimeline),t.client.on(s.RoomEvent.TimelineReset,this.onRoomTimelineReset),t.client.on(s.RoomEvent.Name,this.onRoomName),t.client.on(s.RoomStateEvent.Events,this.onRoomStateEvents),t.client.on(s.RoomStateEvent.Update,this.onRoomStateUpdate),t.client.on(s.RoomEvent.MyMembership,this.onMyMembership),t.client.on(d.cr.KeyBackupStatus,this.onKeyBackupStatus),t.client.on(d.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),t.client.on(d.cr.UserTrustStatusChanged,this.onUserVerificationChanged),t.client.on(d.cr.KeysChanged,this.onCrossSigningKeysChanged),t.client.on(s.MatrixEventEvent.Decrypted,this.onEventDecrypted),t.roomViewStore.on(A.H,this.onRoomViewStoreUpdate),t.rightPanelStore.on(A.H,this.onRightPanelStoreUpdate),Rm.A.on(A.H,this.onWidgetEchoStoreUpdate),t.widgetStore.on(A.H,this.onWidgetStoreUpdate),Mp.e.instance.on(Mp.s.ConnectedCalls,this.onConnectedCalls),this.props.resizeNotifier.on("isResizing",this.onIsResizing),this.settingWatchers=[O.A.watchSetting("layout",null,((...[,,,e])=>this.setState({layout:e}))),O.A.watchSetting("lowBandwidth",null,((...[,,,e])=>this.setState({lowBandwidth:e}))),O.A.watchSetting("alwaysShowTimestamps",null,((...[,,,e])=>this.setState({alwaysShowTimestamps:e}))),O.A.watchSetting("showTwelveHourTimestamps",null,((...[,,,e])=>this.setState({showTwelveHourTimestamps:e}))),O.A.watchSetting(To.cd,null,((...[,,,e])=>this.setState({userTimezone:e}))),O.A.watchSetting("readMarkerInViewThresholdMs",null,((...[,,,e])=>this.setState({readMarkerInViewThresholdMs:e}))),O.A.watchSetting("readMarkerOutOfViewThresholdMs",null,((...[,,,e])=>this.setState({readMarkerOutOfViewThresholdMs:e}))),O.A.watchSetting("showHiddenEventsInTimeline",null,((...[,,,e])=>this.setState({showHiddenEvents:e}))),O.A.watchSetting("urlPreviewsEnabled",null,this.onUrlPreviewsEnabledChange),O.A.watchSetting("urlPreviewsEnabled_e2ee",null,this.onUrlPreviewsEnabledChange),O.A.watchSetting("feature_dynamic_room_predecessors",null,((...[,,,e])=>this.setState({msc3946ProcessDynamicPredecessor:e})))]}doMaybeRemoveOwnJitsiWidget(){if(!this.state.roomId||!this.state.room||!this.context.client)return;const e=this.context.widgetStore.getApps(this.state.roomId).filter((e=>e.eventId&&Tl.x.JITSI.matches(e.type)));if(e.length<2)return;const t=this.context.client.getSafeUserId(),n=e.find((e=>e.creatorUserId===t));if(!n)return;const i=this.state.room.findEventById(n.eventId);if(!i)return;const r=i.getTs();if(!r)return;const o=e.reduce(((e,t)=>{var i;if(t.eventId===n.eventId)return e;const r=(null===(i=this.state.room.findEventById(t.eventId))||void 0===i?void 0:i.getTs())||0;return Math.max(e,r)}),0);o&&r>o&&r-o<3e4&&vl.A.setRoomWidget(this.context.client,this.state.roomId,n.id)}getPermalinkCreatorForRoom(){const{room:e,roomId:t}=this.state;if(void 0===e){if((0,Vg.E)(t)){const e=new Po.pE(null,t);return this.permalinkCreators[t]=e,e}throw new Error("Cannot get a permalink creator without a roomId")}return this.permalinkCreators[e.roomId]||(this.permalinkCreators[e.roomId]=new Po.pE(e),this.state.room&&e.roomId===this.state.room.roomId?this.permalinkCreators[e.roomId].start():this.permalinkCreators[e.roomId].load()),this.permalinkCreators[e.roomId]}stopAllPermalinkCreators(){if(this.permalinkCreators)for(const e of Object.keys(this.permalinkCreators))this.permalinkCreators[e].stop()}setupRoom(e,t,n,i){var r;if(!n&&t)if(!e&&i)l.v.info(`Attempting to peek into room ${t}`),this.setState({peekLoading:!0,isPeeking:!0}),null===(r=this.context.client)||void 0===r||r.peekInRoom(t).then((e=>{this.unmounted||(this.setState({room:e,peekLoading:!1,canAskToJoin:this.askToJoinEnabled&&e.getJoinRule()===s.JoinRule.Knock}),this.onRoomLoaded(e))})).catch((e=>{if(!this.unmounted){if(this.setState({isPeeking:!1}),"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode&&"M_FORBIDDEN"!==e.errcode)throw e;this.setState({peekLoading:!1})}}));else if(e){var o;null===(o=this.context.client)||void 0===o||o.stopPeeking(),this.setState({isPeeking:!1,canAskToJoin:this.askToJoinEnabled&&e.getJoinRule()===s.JoinRule.Knock})}}shouldShowApps(e){if(!Av||!e)return!1;const t=e.roomId+"_hide_widget_drawer",n=localStorage.getItem(t),i=!n||"false"===n,r=this.context.widgetLayoutStore.getContainerWidgets(e,hc.mc.Top);return i&&r.length>0}componentDidMount(){this.onRoomViewStoreUpdate(!0);const e=this.getCallForRoom(),t=null==e?void 0:e.state;this.setState({callState:t}),this.context.legacyCallHandler.on(fe.uv.CallState,this.onCallState),window.addEventListener("beforeunload",this.onPageUnload)}shouldComponentUpdate(e,t){const n=(0,Ol.No)(this.props,e),i=this.state,{upgradeRecommendation:r}=i,o=(0,Ue.A)(i,yv),{upgradeRecommendation:s}=t,a=(0,Ue.A)(t,Ev),l=(null==s?void 0:s.needsUpgrade)!==(null==r?void 0:r.needsUpgrade)||(0,Ol.No)(o,a);return n||l}componentDidUpdate(){this.messagePanel&&void 0===this.state.atEndOfLiveTimeline&&this.setState({atEndOfLiveTimeline:this.messagePanel.isAtEndOfLiveTimeline()})}componentWillUnmount(){var e,t;(this.unmounted=!0,this.context.legacyCallHandler.removeListener(fe.uv.CallState,this.onCallState),this.state.roomId&&km.setScrollState(this.state.roomId,this.getScrollState()),this.state.shouldPeek)&&(null===(e=this.context.client)||void 0===e||e.stopPeeking());this.stopAllPermalinkCreators(),v.Ay.unregister(this.dispatcherRef),this.context.client&&(this.context.client.removeListener(s.ClientEvent.Room,this.onRoom),this.context.client.removeListener(s.RoomEvent.Timeline,this.onRoomTimeline),this.context.client.removeListener(s.RoomEvent.TimelineReset,this.onRoomTimelineReset),this.context.client.removeListener(s.RoomEvent.Name,this.onRoomName),this.context.client.removeListener(s.RoomStateEvent.Events,this.onRoomStateEvents),this.context.client.removeListener(s.RoomEvent.MyMembership,this.onMyMembership),this.context.client.removeListener(s.RoomStateEvent.Update,this.onRoomStateUpdate),this.context.client.removeListener(d.cr.KeyBackupStatus,this.onKeyBackupStatus),this.context.client.removeListener(d.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.context.client.removeListener(d.cr.UserTrustStatusChanged,this.onUserVerificationChanged),this.context.client.removeListener(d.cr.KeysChanged,this.onCrossSigningKeysChanged),this.context.client.removeListener(s.MatrixEventEvent.Decrypted,this.onEventDecrypted)),window.removeEventListener("beforeunload",this.onPageUnload),this.context.roomViewStore.off(A.H,this.onRoomViewStoreUpdate),this.context.rightPanelStore.off(A.H,this.onRightPanelStoreUpdate),Rm.A.removeListener(A.H,this.onWidgetEchoStoreUpdate),this.context.widgetStore.removeListener(A.H,this.onWidgetStoreUpdate),this.props.resizeNotifier.off("isResizing",this.onIsResizing),this.state.room&&this.context.widgetLayoutStore.off(hc.aK.emissionForRoom(this.state.room),this.onWidgetLayoutChange),Mp.e.instance.off(Mp.s.ConnectedCalls,this.onConnectedCalls),this.context.legacyCallHandler.off(fe.uv.CallState,this.onCallState),this.updateRoomMembers.cancel();for(const e of this.settingWatchers)O.A.unwatchSetting(e);this.viewsLocalRoom&&this.state.room&&(null===(t=this.context.client)||void 0===t||t.store.removeRoom(this.state.room.roomId))}onLocalRoomEvent(e){this.context.client&&this.state.room&&e===this.state.room.roomId&&(0,Lg.Cp)(this.context.client,this.state.room)}getRoomTombstone(e=this.state.room){var t;return null!==(t=null==e?void 0:e.currentState.getStateEvents(s.EventType.RoomTombstone,""))&&void 0!==t?t:void 0}async calculateRecommendedVersion(e){const t=await e.getRecommendedVersion();this.unmounted||this.setState({upgradeRecommendation:t})}async loadMembersIfJoined(e){var t;if(null!==(t=this.context.client)&&void 0!==t&&t.hasLazyLoadMembersEnabled()&&e&&e.getMyMembership()===We.O.Join)try{await e.loadMembersIfNeeded(),this.unmounted||this.setState({membersLoaded:!0})}catch(t){const n=`Fetching room members for ${e.roomId} failed. Room members will appear incomplete.`;l.v.error(n),l.v.error(t)}}calculatePeekRules(e){const t=e.currentState.getStateEvents(s.EventType.RoomHistoryVisibility,"");this.setState({canPeek:(null==t?void 0:t.getContent().history_visibility)===s.HistoryVisibility.WorldReadable})}updatePreviewUrlVisibility({roomId:e}){var t;const n=null!==(t=this.context.client)&&void 0!==t&&t.isRoomEncrypted(e)?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled";this.setState({showUrlPreview:O.A.getValue(n,e)})}async updateE2EStatus(e){var t,n;if(null===(t=this.context.client)||void 0===t||!t.isRoomEncrypted(e.roomId))return;let i=null!==(n=Rv.e2eStatusCache.get(e.roomId))&&void 0!==n?n:fs.z.Warning;if(this.setState({e2eStatus:i}),this.context.client.isCryptoEnabled()){if(i=await(0,fs.G)(this.context.client,e),Rv.e2eStatusCache.set(e.roomId,i),this.unmounted)return;this.setState({e2eStatus:i})}}updatePermissions(e){if(e&&this.context.client){const t=this.context.client.getSafeUserId(),n=e.getMyMembership()===We.O.Join&&e.currentState.maySendEvent(s.EventType.Reaction,t),i=e.maySendMessage(),r=e.currentState.maySendEvent(s.EventType.RoomRedaction,t);this.setState({canReact:n,canSendMessages:i,canSelfRedact:r})}}checkDesktopNotifications(){if(!this.state.room)return;this.state.room.getJoinedMemberCount()+this.state.room.getInvitedMemberCount()>1&&_.default.shouldShowPrompt()&&(0,ag.P)(!0)}updateDMState(){const e=this.state.room;if((null==e?void 0:e.getMyMembership())!=We.O.Join)return;const t=null==e?void 0:e.getDMInviter();t&&E.FZ(e.client,e.roomId,t)}injectSticker(e,t,n,i){const r=this.getRoomId();this.context.client&&r&&(this.context.client.isGuest()?v.Ay.dispatch({action:"require_registration"}):No.Ay.sharedInstance().sendStickerContentToRoom(e,r,i,t,n,this.context.client).then(void 0,(e=>{e.name})))}getScrollState(){const e=this.messagePanel;if(!e)return null;if(this.state.atEndOfLiveTimeline)return null;const t=e.getScrollState();return!t||t.stuckAtBottom?null:{focussedEvent:t.trackedScrollToken,pixelOffset:t.pixelOffset}}getCallForRoom(){return this.state.room?this.context.legacyCallHandler.getCallForRoom(this.state.room.roomId):null}getOldRoom(){var e,t;const{roomId:n}=(null===(e=this.state.room)||void 0===e?void 0:e.findPredecessor(this.state.msc3946ProcessDynamicPredecessor))||{};return(null===(t=this.context.client)||void 0===t?void 0:t.getRoom(n))||null}getHiddenHighlightCount(){const e=this.getOldRoom();return e?e.getUnreadNotificationCount(s.NotificationCountType.Highlight):0}get messagePanelClassNames(){return ee()("mx_RoomView_messagePanel",{mx_IRCLayout:this.state.layout===Us.P.IRC})}get viewsLocalRoom(){return(0,Jd.F)(this.state.room)}get permalinkCreator(){return this.getPermalinkCreatorForRoom()}renderLocalRoomCreateLoader(e){var t;if(!this.state.room||null===(t=this.context)||void 0===t||!t.client)return null;const n=this.state.room.getDefaultRoomName(this.context.client.getSafeUserId());return o.createElement(Zr.Ay.Provider,{value:this.state},o.createElement(kv,{localRoom:e,names:n,resizeNotifier:this.props.resizeNotifier}))}renderLocalRoomView(e){return o.createElement(Zr.Ay.Provider,{value:this.state},o.createElement(Cv,{localRoom:e,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,roomView:this.roomView,onFileDrop:this.onFileDrop}))}renderWaitingForThirdPartyRoomView(e){return o.createElement(Zr.Ay.Provider,{value:this.state},o.createElement(rv,{resizeNotifier:this.props.resizeNotifier,roomView:this.roomView,inviteEvent:e}))}render(){var e,t;if(!this.context.client)return null;if(this.state.room instanceof pa.Np)return this.state.room.state===pa.cd.CREATING?this.renderLocalRoomCreateLoader(this.state.room):this.renderLocalRoomView(this.state.room);if(this.state.room){const{shouldEncrypt:e,inviteEvent:t}=ga(this.state.room);if(e)return this.renderWaitingForThirdPartyRoomView(t)}const n=O.A.getValue("feature_new_room_decoration_ui")?"new":"legacy";if(!this.state.room){const e=!this.state.matrixClientIsReady||this.state.roomLoading||this.state.peekLoading;if(e){const t=!this.state.matrixClientIsReady||!this.state.roomId||this.state.peekLoading;return o.createElement("div",{className:"mx_RoomView","data-room-header":n},o.createElement($s.A,null,o.createElement(Mm,{canPreview:!1,previewLoading:t&&!this.state.roomLoadError,error:this.state.roomLoadError,loading:e,joining:this.state.joining,oobData:this.props.oobData,roomId:this.state.roomId})))}{var i,r;let e;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(i=this.props.threepidInvite)||void 0===i?void 0:i.toEmail,s=this.state.roomAlias;return o.createElement("div",{className:"mx_RoomView","data-room-header":n},o.createElement($s.A,null,o.createElement(Mm,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,canPreview:!1,error:this.state.roomLoadError,roomAlias:s,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,signUrl:null===(r=this.props.threepidInvite)||void 0===r?void 0:r.signUrl,roomId:this.state.roomId,promptAskToJoin:this.state.promptAskToJoin,onSubmitAskToJoin:this.onSubmitAskToJoin,onCancelAskToJoin:this.onCancelAskToJoin})))}}const a=this.state.room.getMyMembership();if((0,el.j)(this.state.room)&&(!O.A.getValue("feature_video_rooms")||a!==We.O.Join))return o.createElement($s.A,null,o.createElement("div",{className:"mx_MainSplit"},o.createElement(Gm,{room:this.state.room,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.onRejectButtonClicked})),";");if(a===We.O.Invite&&!this.state.room.isSpaceRoom()){if(this.state.joining||this.state.rejecting)return o.createElement($s.A,null,o.createElement(Mm,{canPreview:!1,error:this.state.roomLoadError,joining:this.state.joining,rejecting:this.state.rejecting,roomId:this.state.roomId}));{const e=this.context.client.getSafeUserId(),t=this.state.room.getMember(e),i=t?t.events.member:null;let r=(0,C._t)("room|inviter_unknown");var l,c;if(i)r=null!==(l=null===(c=i.sender)||void 0===c?void 0:c.name)&&void 0!==l?l:i.getSender();return o.createElement("div",{className:"mx_RoomView","data-room-header":n},o.createElement($s.A,null,o.createElement(Mm,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectButtonClicked,onRejectAndIgnoreClick:this.onRejectAndIgnoreClick,inviterName:r,canPreview:!1,joining:this.state.joining,room:this.state.room,roomId:this.state.roomId})))}}if(this.state.canAskToJoin&&[We.O.Knock,We.O.Leave].includes(a))return o.createElement("div",{className:"mx_RoomView","data-room-header":n},o.createElement($s.A,null,o.createElement(Mm,{onJoinClick:this.onJoinButtonClicked,room:this.state.room,canAskToJoinAndMembershipIsLeave:a===We.O.Leave,promptAskToJoin:this.state.promptAskToJoin,knocked:a===We.O.Knock,onSubmitAskToJoin:this.onSubmitAskToJoin,onCancelAskToJoin:this.onCancelAskToJoin,onForgetClick:this.onForgetClick})));let d,u=null;{const e=this.getCallForRoom();e&&"ended"!==this.state.callState&&"ringing"!==this.state.callState&&(u=e)}let m=!0;No.Ay.sharedInstance().getCurrentUploads().length>0?d=o.createElement(nu,{room:this.state.room}):this.state.search||(m=this.state.statusBarVisible,d=o.createElement(Mg.A,{room:this.state.room,isPeeking:a!==We.O.Join,onInviteClick:this.onInviteClick,onVisible:this.onStatusBarVisible,onHidden:this.onStatusBarHidden}));const h=ee()("mx_RoomView_statusArea",{mx_RoomView_statusArea_expanded:m}),p=d&&o.createElement("div",{role:"region",className:h,"aria-label":(0,C._t)("a11y|room_status_bar")},o.createElement("div",{className:"mx_RoomView_statusAreaBox"},o.createElement("div",{className:"mx_RoomView_statusAreaBox_line"}),d)),g=this.state.upgradeRecommendation,v=g&&g.needsUpgrade&&this.state.room.userMayUpgradeRoom(this.context.client.getSafeUserId()),_=this.getHiddenHighlightCount();let f,y;if(this.state.timelineRenderingType===Zr.Ae.Search)f=o.createElement(sv,{searchInfo:this.state.search,onCancelClick:this.onCancelSearchClick,onSearchScopeChange:this.onSearchScopeChange,isRoomEncrypted:this.context.client.isRoomEncrypted(this.state.room.roomId)});else if(v)f=o.createElement(Jm,{room:this.state.room});else if(a!==We.O.Join){var E,b;let e;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(E=this.props.threepidInvite)||void 0===E?void 0:E.toEmail;if(y=o.createElement(Mm,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,canPreview:this.state.canPeek,room:this.state.room,roomId:this.state.roomId}),!(this.state.canPeek||null!==(b=this.state.room)&&void 0!==b&&b.isSpaceRoom()))return o.createElement("div",{className:"mx_RoomView","data-room-header":n},y)}else _>0&&(f=o.createElement(be.A,{element:"div",className:"mx_RoomView_auxPanel_hiddenHighlights",onClick:this.onHiddenHighlightsClick},(0,C._t)("room|unread_notifications_predecessor",{count:_})));if(null!==(e=this.state.room)&&void 0!==e&&e.isSpaceRoom()&&!this.props.forceTimeline)return o.createElement(Dg,{space:this.state.room,justCreatedOpts:this.props.justCreatedOpts,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.props.threepidInvite?this.onRejectThreepidInviteButtonClicked:this.onRejectButtonClicked});const w=o.createElement(Ph,{room:this.state.room,userId:this.context.client.getSafeUserId(),showApps:this.state.showApps,resizeNotifier:this.props.resizeNotifier},f);let x,A;O.A.getValue("feature_pinning")&&(x=o.createElement(mv,{room:this.state.room,permalinkCreator:this.permalinkCreator}));let S;a===We.O.Join&&!this.state.search&&(A=o.createElement(Xd,{room:this.state.room,e2eStatus:this.state.e2eStatus,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.permalinkCreator}));let k,R=!1;this.state.search&&(S=o.createElement(nv,{key:this.state.search.searchId,ref:this.searchResultsPanel,term:this.state.search.term,scope:this.state.search.scope,promise:this.state.search.promise,abortController:this.state.search.abortController,inProgress:!!this.state.search.inProgress,resizeNotifier:this.props.resizeNotifier,className:this.messagePanelClassNames,onUpdate:this.onSearchUpdate}),R=!0),this.state.isInitialEventHighlighted&&(k=this.state.initialEventId);const I=o.createElement(pd,{ref:this.gatherTimelinePanelRef,timelineSet:this.state.room.getUnfilteredTimelineSet(),overlayTimelineSet:null===(t=this.state.virtualRoom)||void 0===t?void 0:t.getUnfilteredTimelineSet(),overlayTimelineSetFilter:ld.Xm,showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!this.state.isPeeking,sendReadReceiptOnLoad:!this.state.wasContextSwitch,manageReadMarkers:!this.state.isPeeking,hidden:R,highlightedEventId:k,eventId:this.state.initialEventId,eventScrollIntoView:this.state.initialEventScrollIntoView,eventPixelOffset:this.state.initialEventPixelOffset,onScroll:this.onMessageListScroll,onEventScrolledIntoView:this.resetJumpToEvent,onReadMarkerUpdated:this.updateTopUnreadMessagesBar,showUrlPreview:this.state.showUrlPreview,className:this.messagePanelClassNames,membersLoaded:this.state.membersLoaded,permalinkCreator:this.permalinkCreator,resizeNotifier:this.props.resizeNotifier,showReactions:!0,layout:this.state.layout,editState:this.state.editState});let T,P;this.state.showTopUnreadMessagesBar&&!this.state.search&&(T=o.createElement(Og,{onScrollUpClick:this.jumpToReadMarker,onCloseClick:this.forgetReadMarker})),!1!==this.state.atEndOfLiveTimeline||this.state.search||(P=o.createElement(cm,{highlight:this.state.room.getUnreadNotificationCount(s.NotificationCountType.Highlight)>0,numUnreadMessages:this.state.numUnreadMessages,onScrollToBottomClick:this.jumpToLiveTimeline}));const N=this.state.room&&this.state.showRightPanel?o.createElement(Sm,{room:this.state.room,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,e2eStatus:this.state.e2eStatus,onSearchChange:this.onSearchChange,onSearchCancel:this.onCancelSearchClick}):void 0,D=ee()("mx_RoomView_timeline",{mx_RoomView_timeline_rr_enabled:this.state.showReadReceipts}),M=ee()("mx_RoomView",{mx_RoomView_inCall:Boolean(u),mx_RoomView_immersive:this.state.mainSplitContentType!==Sv.Timeline}),L=O.A.getValue("showChatEffects");let U,F;switch(this.state.mainSplitContentType){case Sv.Timeline:F="mx_MainSplit_timeline",U=o.createElement(o.Fragment,null,this.roomViewBody.current&&o.createElement(gd,{sensor:this.roomViewBody.current,onMeasurement:this.onMeasurement}),w,x,o.createElement("main",{className:D},o.createElement(su,{parent:this.roomView.current,onFileDrop:this.onFileDrop}),T,P,I,S),p,y,A);break;case Sv.MaximisedWidget:F="mx_MainSplit_maximisedWidget",U=o.createElement(o.Fragment,null,o.createElement(sh,{room:this.state.room,userId:this.context.client.getSafeUserId(),resizeNotifier:this.props.resizeNotifier,showApps:!0,role:"main"}),y);break;case Sv.Call:var j;F="mx_MainSplit_call",U=o.createElement(o.Fragment,null,o.createElement(sg,{room:this.state.room,resizing:this.state.resizing,waitForCall:(0,el.j)(this.state.room),skipLobby:null!==(j=this.context.roomViewStore.skipCallLobby())&&void 0!==j&&j,role:"main"}),y)}const B=ee()("mx_RoomView_body",F);let V=[$n.n.Timeline],H=this.onAppsClick,z=this.onForgetClick,W=this.onSearchClick,G=null,K=!1;switch(this.state.mainSplitContentType){case Sv.MaximisedWidget:V=[],H=null,z=null,W=null;break;case Sv.Call:V=[],H=null,z=null,W=null,this.state.room.canInvite(this.context.client.getSafeUserId())&&(G=this.onInviteClick),K=!0}const J=this.state.room.getMember(this.context.client.getSafeUserId()),q=!this.context.client.isGuest()&&([We.O.Leave,We.O.Ban].includes(a)||(null==J?void 0:J.isKicked()));return o.createElement(Zr.Ay.Provider,{value:this.state},o.createElement("div",{className:M,ref:this.roomView,onKeyDown:this.onReactKeyDown,"data-room-header":n},L&&this.roomView.current&&o.createElement(rg,{roomWidth:this.roomView.current.offsetWidth}),o.createElement($s.A,null,o.createElement(Mo,{panel:N,resizeNotifier:this.props.resizeNotifier,sizeKey:this.state.threadRightPanel?"thread":void 0,defaultSize:this.state.threadRightPanel?500:void 0},o.createElement("div",{className:B,ref:this.roomViewBody,"data-layout":this.state.layout},O.A.getValue("feature_new_room_decoration_ui")?o.createElement(ig,{room:this.state.room,additionalButtons:this.state.viewRoomOpts.buttons}):o.createElement(gp,{room:this.state.room,searchInfo:this.state.search,oobData:this.props.oobData,inRoom:a===We.O.Join,onSearchClick:W,onInviteClick:G,onForgetClick:q?z:null,e2eStatus:this.state.e2eStatus,onAppsClick:this.state.hasPinnedWidgets?H:null,appsShown:this.state.showApps,excludedRightPanelPhaseButtons:V,showButtons:!this.viewsLocalRoom,enableRoomOptionsMenu:!this.viewsLocalRoom,viewingCall:K,activeCall:this.state.activeCall,additionalButtons:this.state.viewRoomOpts.buttons}),U)))))}}(0,r.A)(Rv,"e2eStatusCache",new Map),(0,r.A)(Rv,"contextType",Xt.A);const Iv=Rv;class Tv extends o.Component{constructor(e){super(e),(0,r.A)(this,"onToastStoreUpdate",(()=>{this.setState({toasts:S.A.sharedInstance().getToasts(),countSeen:S.A.sharedInstance().getCountSeen()})})),this.state={toasts:S.A.sharedInstance().getToasts(),countSeen:S.A.sharedInstance().getCountSeen()},S.A.sharedInstance().on("update",this.onToastStoreUpdate)}componentWillUnmount(){S.A.sharedInstance().removeListener("update",this.onToastStoreUpdate)}render(){const e=this.state.toasts.length,t=e>1;let n,i;if(0!==e){const r=this.state.toasts[0],{title:s,icon:a,key:l,component:c,className:d,bodyClassName:u,props:m}=r,h=ee()("mx_Toast_body",u),p=ee()("mx_Toast_toast",d,{mx_Toast_hasIcon:a,[`mx_Toast_icon_${a}`]:a}),g=Object.assign({},m,{key:l,toastKey:l}),v=o.createElement(c,g);let _,f;(s&&t||this.state.countSeen>0)&&(_=` (${this.state.countSeen+1}/${this.state.countSeen+e})`),s&&(f=o.createElement("div",{className:"mx_Toast_title"},o.createElement(ke.EY,{size:"lg",weight:"semibold",as:"h2"},s),o.createElement("span",{className:"mx_Toast_title_countIndicator"},_))),n=o.createElement("div",{className:p},f,o.createElement("div",{className:h},v)),i=ee()("mx_ToastContainer",{mx_ToastContainer_stacked:t})}return n?o.createElement("div",{className:i,role:"alert"},n):null}}class Pv extends o.Component{constructor(e,t){super(e,t),this.state={loading:!0}}componentDidMount(){this.props.userId&&this.loadProfileInfo()}componentDidUpdate(e){e.userId!==this.props.userId&&this.props.userId&&this.loadProfileInfo()}async loadProfileInfo(){let e;this.setState({loading:!0});try{e=await this.context.getProfileInfo(this.props.userId)}catch(e){return f.Ay.createDialog(lc.A,{title:(0,C._t)("error_dialog|error_loading_user_profile"),description:e instanceof Error?e.message:(0,C._t)("invite|failed_generic")}),void this.setState({loading:!1})}const t=new s.MatrixEvent({type:"m.room.member",content:e}),n=new s.RoomMember("",this.props.userId);n.setMembershipEvent(t),this.setState({member:n,loading:!1})}render(){if(this.state.loading)return o.createElement(dn.A,null);if(this.state.member){const e=o.createElement(Sm,{overwriteCard:{phase:$n.n.RoomMemberInfo,state:{member:this.state.member}},resizeNotifier:this.props.resizeNotifier});return o.createElement(Mo,{panel:e,resizeNotifier:this.props.resizeNotifier},o.createElement(fo,null))}return o.createElement("div",null)}}(0,r.A)(Pv,"contextType",Re.Ay);const Nv=({backgroundImage:e,blurMultiplier:t})=>{if(!e)return null;const n={};if(t){const e=getComputedStyle(document.documentElement).getPropertyValue("--lp-background-blur").replace("px",""),i=parseInt(e,10);isNaN(i)||(n.filter=`blur(${i*t}px)`)}return o.createElement("div",{className:"mx_BackdropPanel"},o.createElement("img",{role:"presentation",alt:"",style:n,className:"mx_BackdropPanel--image",src:e}))};var Dv=n("./node_modules/matrix-react-sdk/res/img/location/live-location.svg");const Mv=({isMinimized:e})=>{const t=(0,Pe.dF)(Qh.g.instance,Qh.q.MonitoringLivePosition,(()=>Qh.g.instance.isMonitoringLiveLocation)),n=(0,Pe.dF)(Qh.g.instance,Qh.q.LocationPublishError,(()=>Qh.g.instance.getLiveBeaconIdsWithLocationPublishError())),i=(0,Pe.dF)(Qh.g.instance,Qh.q.BeaconUpdateError,(()=>Qh.g.instance.getLiveBeaconIds().filter((e=>Qh.g.instance.beaconUpdateErrors.has(e))))),r=(0,Pe.dF)(Qh.g.instance,Qh.q.LivenessChange,(()=>Qh.g.instance.getLiveBeaconIds())),s=!!n.length,a=!!i.length;if(((e,t)=>{(0,o.useEffect)((()=>{const n=()=>{"visible"===document.visibilityState&&e.forEach((e=>{var n;return null===(n=t.get(e))||void 0===n?void 0:n.monitorLiveness()}))};return e.length&&document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}}),[e,t])})(r,Qh.g.instance.beacons),!t)return null;const l=((e,t,n)=>{var i,r;const o=null!==(i=null!==(r=null==t?void 0:t[0])&&void 0!==r?r:null==n?void 0:n[0])&&void 0!==i?i:null==e?void 0:e[0];if(!o)return;return Qh.g.instance.getBeaconById(o)})(r,i,n),c=l?e=>{v.Ay.dispatch({action:x.r.ViewRoom,room_id:l.roomId,metricsTrigger:void 0,event_id:l.beaconInfoId,scroll_into_view:!0,highlighted:!0})}:null,d=((e,t)=>e?(0,C._t)("location_sharing|error_stopping_live_location"):t?(0,C._t)("location_sharing|error_sharing_live_location"):(0,C._t)("location_sharing|live_location_active"))(a,s);return o.createElement(be.A,{className:ee()("mx_LeftPanelLiveShareWarning",{mx_LeftPanelLiveShareWarning__minimized:e,mx_LeftPanelLiveShareWarning__error:s||a}),title:e?d:void 0,onClick:c},e?o.createElement(Dv.I,{height:10}):d)};function Ov(e,t,n){return(1-(n=(0,c.clamp)(n,0,1)))*e+n*t}const Lv=58,Uv=58,Fv=76,jv=8;class Bv extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"callViewWrapper",(0,o.createRef)()),(0,r.A)(this,"initX",0),(0,r.A)(this,"initY",0),(0,r.A)(this,"desiredTranslationX",Ce.A.instance.windowWidth-jv-336),(0,r.A)(this,"desiredTranslationY",Ce.A.instance.windowHeight-Uv-232),(0,r.A)(this,"translationX",this.desiredTranslationX),(0,r.A)(this,"translationY",this.desiredTranslationY),(0,r.A)(this,"mouseHeld",!1),(0,r.A)(this,"scheduledUpdate",new Rd.L((()=>this.animationCallback()),(()=>requestAnimationFrame((()=>this.scheduledUpdate.trigger()))))),(0,r.A)(this,"startingPositionX",0),(0,r.A)(this,"startingPositionY",0),(0,r.A)(this,"_moving",!1),(0,r.A)(this,"animationCallback",(()=>{var e,t;if(!this.moving&&Math.abs(this.translationX-this.desiredTranslationX)<=1&&Math.abs(this.translationY-this.desiredTranslationY)<=1)this.translationX=this.desiredTranslationX,this.translationY=this.desiredTranslationY,this.setStyle();else{const e=this.moving?.2:.1;this.translationX=Ov(this.translationX,this.desiredTranslationX,e),this.translationY=Ov(this.translationY,this.desiredTranslationY,e),this.setStyle(),this.scheduledUpdate.mark()}null===(e=(t=this.props).onMove)||void 0===e||e.call(t)})),(0,r.A)(this,"setStyle",(()=>{this.callViewWrapper.current&&(this.callViewWrapper.current.style.transform=`translateX(${this.translationX}px) translateY(${this.translationY}px)`)})),(0,r.A)(this,"onResize",(()=>{this.snap(!1)})),(0,r.A)(this,"snap",((e=!1)=>{var t,n;const i=this.desiredTranslationX,r=this.desiredTranslationY,o=Ce.A.instance.windowWidth-((null===(t=this.callViewWrapper.current)||void 0===t?void 0:t.clientWidth)||336),s=Ce.A.instance.windowHeight-((null===(n=this.callViewWrapper.current)||void 0===n?void 0:n.clientHeight)||232);i>=o/2&&r>=s/2?(this.desiredTranslationX=o-jv,this.desiredTranslationY=s-Uv):i>=o/2&&r<=s/2?(this.desiredTranslationX=o-jv,this.desiredTranslationY=Lv):i<=o/2&&r>=s/2?(this.desiredTranslationX=Fv,this.desiredTranslationY=s-Uv):(this.desiredTranslationX=Fv,this.desiredTranslationY=Lv),e||(this.translationX=this.desiredTranslationX,this.translationY=this.desiredTranslationY),this.scheduledUpdate.mark()})),(0,r.A)(this,"onStartMoving",(e=>{e.preventDefault(),e.stopPropagation(),this.mouseHeld=!0,this.startingPositionX=e.clientX,this.startingPositionY=e.clientY})),(0,r.A)(this,"onMoving",(e=>{this.mouseHeld&&(Math.abs(this.startingPositionX-e.clientX)<5&&Math.abs(this.startingPositionY-e.clientY)<5||(e.preventDefault(),e.stopPropagation(),this.moving||(this.moving=!0,this.initX=e.pageX-this.desiredTranslationX,this.initY=e.pageY-this.desiredTranslationY,this.scheduledUpdate.mark()),this.setTranslation(e.pageX-this.initX,e.pageY-this.initY)))})),(0,r.A)(this,"onEndMoving",(e=>{this.mouseHeld&&(e.preventDefault(),e.stopPropagation(),this.mouseHeld=!1,setTimeout((()=>this.moving=!1)),this.snap(!0))})),(0,r.A)(this,"onClickCapture",(e=>{this.moving&&(e.preventDefault(),e.stopPropagation())}))}get moving(){return this._moving}set moving(e){this._moving=e}componentDidMount(){document.addEventListener("mousemove",this.onMoving),document.addEventListener("mouseup",this.onEndMoving),Ce.A.instance.on(Ce.x.Resize,this.onResize),this.snap()}componentWillUnmount(){document.removeEventListener("mousemove",this.onMoving),document.removeEventListener("mouseup",this.onEndMoving),Ce.A.instance.off(Ce.x.Resize,this.onResize)}componentDidUpdate(e){e.children!==this.props.children&&this.snap(!0)}setTranslation(e,t){var n,i;const r=(null===(n=this.callViewWrapper.current)||void 0===n?void 0:n.clientWidth)||336,o=(null===(i=this.callViewWrapper.current)||void 0===i?void 0:i.clientHeight)||232;e+r>=Ce.A.instance.windowWidth?this.desiredTranslationX=Ce.A.instance.windowWidth-r:this.desiredTranslationX=e<=0?0:e,t+o>=Ce.A.instance.windowHeight?this.desiredTranslationY=Ce.A.instance.windowHeight-o:this.desiredTranslationY=t<=0?0:t}render(){const e={transform:`translateX(${this.translationX}px) translateY(${this.translationY}px)`},t=this.props.children.map((e=>e({onStartMoving:this.onStartMoving,onResize:this.onResize})));return o.createElement("aside",{className:this.props.className,style:e,ref:this.callViewWrapper,onClickCapture:this.onClickCapture,onDoubleClick:this.props.onDoubleClick},t)}}var Vv=n("./node_modules/matrix-react-sdk/src/voice-broadcast/stores/VoiceBroadcastPlaybacksStore.ts");class Hv extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"room",void 0),this.room=t.getRoom(this.props.persistentRoomId)}render(){const e=sc.Ay.instance.get(this.props.persistentWidgetId,this.props.persistentRoomId);return e?o.createElement(Hc,{key:e.id,app:e,fullWidth:!0,room:this.room,userId:this.context.getSafeUserId(),creatorUserId:e.creatorUserId,widgetPageTitle:vl.A.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,miniMode:!0,showMenubar:!1,pointerEvents:this.props.pointerEvents,movePersistedElement:this.props.movePersistedElement,overlay:this.props.children}):null}}var zv;function Wv(){return Wv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Wv.apply(null,arguments)}(0,r.A)(Hv,"contextType",Re.Ay);var Gv=function(e,t){return o.createElement("svg",Wv({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 14",role:"presentation","aria-hidden":!0,ref:t},e),zv||(zv=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 7H1m0 0 6 6M1 7l6-6"})))},Kv=(0,o.forwardRef)(Gv);var Jv,qv;function $v(){return $v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$v.apply(null,arguments)}var Yv=function(e,t){return o.createElement("svg",$v({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Jv||(Jv=o.createElement("path",{fill:"currentColor",d:"M8.027 15.961c1.141 1.232 3.888 3.365 4.637 3.803l.151.09c1.143.679 4.722 2.807 7.33.815 2.021-1.542 1.364-3.278.684-3.794-.466-.362-1.838-1.36-3.128-2.26-1.268-.883-1.974-.175-2.452.303l-.026.026-.96.961c-.246.245-.618.156-.974-.125a26 26 0 0 1-2.692-2.385l-.004-.004c-.47-.47-1.4-1.4-2.373-2.68-.28-.356-.37-.728-.125-.973l.96-.961.027-.026c.478-.478 1.186-1.184.303-2.452-.9-1.29-1.898-2.662-2.26-3.128-.516-.68-2.252-1.337-3.794.684-1.992 2.608.136 6.187.815 7.33l.09.151c.438.75 2.56 3.484 3.791 4.625"})),qv||(qv=o.createElement("path",{fill:"currentColor",d:"M20.697 3.078a.64.64 0 0 0 0-.893.615.615 0 0 0-.88 0L17 5.045l-2.817-2.86a.615.615 0 0 0-.88 0 .64.64 0 0 0 0 .893l2.817 2.86-2.938 2.984a.64.64 0 0 0 0 .893.615.615 0 0 0 .88 0L17 6.832l2.938 2.983a.615.615 0 0 0 .88 0 .64.64 0 0 0 0-.893L17.88 5.939z"})))},Qv=(0,o.forwardRef)(Yv);const Zv=({widgetId:e,room:t,viewingRoom:n,onStartMoving:i,movePersistedElement:r})=>{const a=(0,o.useMemo)((()=>sc.Ay.instance.getApps(t.roomId).find((t=>t.id===e))),[t,e]),l=(0,Pe.DY)(t,s.RoomEvent.Name,(0,o.useCallback)((()=>t.name),[t])),c=(0,rp.Jf)(e,t.roomId),d=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),null!==c?v.Ay.dispatch({action:x.r.ViewRoom,room_id:t.roomId,view_call:!0,metricsTrigger:"WebFloatingCallWindow"}):n?hc.aK.instance.moveToContainer(t,a,hc.mc.Center):v.Ay.dispatch({action:x.r.ViewRoom,room_id:t.roomId,metricsTrigger:"WebFloatingCallWindow"})}),[t,c,a,n]),u=(0,o.useCallback)((e=>{var t;(e.preventDefault(),e.stopPropagation(),null!==c)?c.disconnect().catch((e=>console.error("Failed to leave call",e))):null===(t=$l.c.instance.getMessagingForUid(vl.A.getWidgetUid(a)))||void 0===t||t.transport.send(Ql.k.HangupCall,{}).catch((e=>console.error("Failed to leave Jitsi",e)))}),[c,a]);return o.createElement("div",{className:"mx_WidgetPip",onMouseDown:i,onClick:d},o.createElement(Hv,{persistentWidgetId:e,persistentRoomId:t.roomId,pointerEvents:"none",movePersistedElement:r},o.createElement("div",{onMouseDown:i,className:"mx_WidgetPip_overlay"},o.createElement(Ci.A,{className:"mx_WidgetPip_header"},o.createElement(Ze.k,{onClick:d,className:"mx_WidgetPip_backButton","aria-label":(0,C._t)("action|back")},o.createElement(Kv,{className:"mx_Icon mx_Icon_16"}),l)),(null!==c||Tl.x.JITSI.matches(null==a?void 0:a.type))&&o.createElement(Ci.A,{className:"mx_WidgetPip_footer"},o.createElement(Ze.k,{onClick:u,title:(0,C._t)("action|leave"),"aria-label":(0,C._t)("action|leave"),placement:"top"},o.createElement(Qv,{className:"mx_Icon mx_Icon_24"}))))))},Xv=[So.iP.Connected,So.iP.InviteSent,So.iP.Connecting,So.iP.CreateAnswer,So.iP.CreateOffer,So.iP.WaitLocalMedia];function e_(e){if(!e)return[null,[]];const t=fe.Ay.instance.getAllActiveCallsForPip(e);let n=null,i=[];for(const e of t)Xv.includes(e.state)&&(e.isRemoteOnHold()||null!==n?i.push(e):n=e);return null===n&&i.length>0&&(n=i[0],i=i.slice(1)),i.length>1&&l.v.log("Found more than 1 secondary call! Other calls will not be shown."),[n,i]}class t_ extends o.Component{constructor(e){super(e),(0,r.A)(this,"onMove",(()=>{var e,t;return null===(e=(t=this.props.movePersistedElement).current)||void 0===e?void 0:e.call(t)})),(0,r.A)(this,"onRoomViewStoreUpdate",(()=>{var e,t;const n=Xt.M.instance.roomViewStore.getRoomId(),i=this.state.viewedRoomId;if(n===i)return;const r=null===(e=h.J.get())||void 0===e?void 0:e.getRoom(i);r&&hc.aK.instance.off(hc.aK.emissionForRoom(r),this.updateCalls);const o=null===(t=h.J.get())||void 0===t?void 0:t.getRoom(n||void 0);if(o&&hc.aK.instance.on(hc.aK.emissionForRoom(o),this.updateCalls),!n)return;const[s,a]=e_(n);this.setState({viewedRoomId:n,primaryCall:s,secondaryCall:a[0]}),this.updateShowWidgetInPip()})),(0,r.A)(this,"onWidgetPersistence",(()=>{this.updateShowWidgetInPip()})),(0,r.A)(this,"onWidgetDockChanges",(()=>{this.updateShowWidgetInPip()})),(0,r.A)(this,"updateCalls",(()=>{if(!this.state.viewedRoomId)return;const[e,t]=e_(this.state.viewedRoomId);this.setState({primaryCall:e,secondaryCall:t[0]}),this.updateShowWidgetInPip()})),(0,r.A)(this,"onCallRemoteHold",(()=>{if(!this.state.viewedRoomId)return;const[e,t]=e_(this.state.viewedRoomId);this.setState({primaryCall:e,secondaryCall:t[0]})})),(0,r.A)(this,"onDoubleClick",(()=>{var e;const t=null===(e=this.state.primaryCall)||void 0===e?void 0:e.roomId;var n;(null!=t?t:this.state.persistentRoomId)&&v.Ay.dispatch({action:x.r.ViewRoom,room_id:null!==(n=null!=t?t:this.state.persistentRoomId)&&void 0!==n?n:void 0,metricsTrigger:"WebFloatingCallWindow"})}));const t=Xt.M.instance.roomViewStore.getRoomId(),[n,i]=e_(t);this.state={viewedRoomId:t||void 0,primaryCall:n||null,secondaryCall:i[0],persistentWidgetId:Cl.A.instance.getPersistentWidgetId(),persistentRoomId:Cl.A.instance.getPersistentRoomId(),showWidgetInPip:!1}}componentDidMount(){fe.Ay.instance.addListener(fe.uv.CallChangeRoom,this.updateCalls),fe.Ay.instance.addListener(fe.uv.CallState,this.updateCalls),Xt.M.instance.roomViewStore.addListener(A.H,this.onRoomViewStoreUpdate),h.J.safeGet().on(So.$E.RemoteHoldUnhold,this.onCallRemoteHold);const e=h.J.safeGet().getRoom(this.state.viewedRoomId);e&&hc.aK.instance.on(hc.aK.emissionForRoom(e),this.updateCalls),Cl.A.instance.on(Cl.y.Persistence,this.onWidgetPersistence),Cl.A.instance.on(Cl.y.Dock,this.onWidgetDockChanges),Cl.A.instance.on(Cl.y.Undock,this.onWidgetDockChanges)}componentWillUnmount(){fe.Ay.instance.removeListener(fe.uv.CallChangeRoom,this.updateCalls),fe.Ay.instance.removeListener(fe.uv.CallState,this.updateCalls);const e=h.J.get();null==e||e.removeListener(So.$E.RemoteHoldUnhold,this.onCallRemoteHold),Xt.M.instance.roomViewStore.removeListener(A.H,this.onRoomViewStoreUpdate);const t=null==e?void 0:e.getRoom(this.state.viewedRoomId);t&&hc.aK.instance.off(hc.aK.emissionForRoom(t),this.updateCalls),Cl.A.instance.off(Cl.y.Persistence,this.onWidgetPersistence),Cl.A.instance.off(Cl.y.Dock,this.onWidgetDockChanges),Cl.A.instance.off(Cl.y.Undock,this.onWidgetDockChanges)}updateShowWidgetInPip(){const e=Cl.A.instance.getPersistentWidgetId(),t=Cl.A.instance.getPersistentRoomId();let n=!1,i=!1;e&&t&&h.J.safeGet().getRoom(t)&&(i=!Cl.A.instance.isDocked(e,t),n=this.state.viewedRoomId!==t);const r=n||i;this.setState({showWidgetInPip:r,persistentWidgetId:e,persistentRoomId:t})}createVoiceBroadcastPlaybackPipContent(e){const t=this.state.viewedRoomId===e.infoEvent.getRoomId()?o.createElement(Pn.DL,{playback:e,pip:!0}):o.createElement(Pn.iB,{playback:e});return({onStartMoving:n})=>o.createElement("div",{key:`vb-playback-${e.infoEvent.getId()}`,onMouseDown:n},t)}createVoiceBroadcastPreRecordingPipContent(e){return({onStartMoving:t})=>o.createElement("div",{key:"vb-pre-recording",onMouseDown:t},o.createElement(Pn.lG,{voiceBroadcastPreRecording:e}))}createVoiceBroadcastRecordingPipContent(e){return({onStartMoving:t})=>o.createElement("div",{key:`vb-recording-${e.infoEvent.getId()}`,onMouseDown:t},o.createElement(Pn.G4,{recording:e}))}render(){const e=!0;let t=[];if(this.props.voiceBroadcastRecording?t=[this.createVoiceBroadcastRecordingPipContent(this.props.voiceBroadcastRecording)]:this.props.voiceBroadcastPreRecording?t=[this.createVoiceBroadcastPreRecordingPipContent(this.props.voiceBroadcastPreRecording)]:this.props.voiceBroadcastPlayback&&(t=[this.createVoiceBroadcastPlaybackPipContent(this.props.voiceBroadcastPlayback)]),this.state.primaryCall){const n=this.state.primaryCall;t.push((({onStartMoving:t,onResize:i})=>o.createElement(Ih,{key:"call-view",onMouseDownOnHeader:t,call:n,secondaryCall:this.state.secondaryCall,pipMode:e,onResize:i})))}return this.state.showWidgetInPip&&this.state.persistentWidgetId&&t.push((({onStartMoving:e})=>{var t;return o.createElement(Zv,{key:"widget-pip",widgetId:this.state.persistentWidgetId,room:h.J.safeGet().getRoom(null!==(t=this.state.persistentRoomId)&&void 0!==t?t:void 0),viewingRoom:this.state.viewedRoomId===this.state.persistentRoomId,onStartMoving:e,movePersistedElement:this.props.movePersistedElement})})),t.length?o.createElement(Bv,{className:"mx_LegacyCallPreview",draggable:e,onDoubleClick:this.onDoubleClick,onMove:this.onMove},t):null}}const n_=()=>{const e=(0,o.useContext)(Xt.A),t=e.voiceBroadcastPreRecordingStore,{currentVoiceBroadcastPreRecording:n}=(0,Pn.mW)(t),i=e.voiceBroadcastRecordingsStore,{currentVoiceBroadcastRecording:r}=(0,Pn.PE)(i),s=e.voiceBroadcastPlaybacksStore,{currentVoiceBroadcastPlayback:a}=(l=s,{currentVoiceBroadcastPlayback:(0,Pe.DY)(l,Vv.n.CurrentChanged,(e=>null!=e?e:l.getCurrent()))});var l;const c=(0,o.useRef)();return o.createElement(t_,{voiceBroadcastPlayback:a,voiceBroadcastPreRecording:n,voiceBroadcastRecording:r,movePersistedElement:c})};var i_=n("./node_modules/matrix-js-sdk/src/pushprocessor.ts");class r_{static encodeActions(e){const t=e.notify,n=e.sound,i=e.highlight;if(t){const e=[s.PushRuleActionName.Notify];return n&&e.push({set_tweak:"sound",value:n}),i?e.push({set_tweak:"highlight"}):e.push({set_tweak:"highlight",value:!1}),e}return[s.PushRuleActionName.DontNotify]}static decodeActions(e){let t,n=!1,i=!1;for(const r of e)if(r===s.PushRuleActionName.Notify)n=!0;else if(r===s.PushRuleActionName.DontNotify)n=!1;else{if("object"!=typeof r)return null;if("sound"===r.set_tweak)t=r.value;else{if("highlight"!==r.set_tweak)return null;i=r.value}}void 0===i&&(i=!0);const r={notify:n,highlight:i};return void 0!==t&&(r.sound=t),r}}const o_=r_.encodeActions;class s_{}(0,r.A)(s_,"ACTION_NOTIFY",o_({notify:!0})),(0,r.A)(s_,"ACTION_NOTIFY_DEFAULT_SOUND",o_({notify:!0,sound:"default"})),(0,r.A)(s_,"ACTION_NOTIFY_RING_SOUND",o_({notify:!0,sound:"ring"})),(0,r.A)(s_,"ACTION_HIGHLIGHT",o_({notify:!0,highlight:!0})),(0,r.A)(s_,"ACTION_HIGHLIGHT_DEFAULT_SOUND",o_({notify:!0,sound:"default",highlight:!0})),(0,r.A)(s_,"ACTION_DONT_NOTIFY",o_({notify:!1})),(0,r.A)(s_,"ACTION_DISABLED",void 0);let a_=function(e){return e.Off="off",e.On="on",e.Loud="loud",e}({});class l_{static actionsFor(e){return e===a_.On?s_.ACTION_NOTIFY:e===a_.Loud?s_.ACTION_HIGHLIGHT_DEFAULT_SOUND:[]}static contentRuleVectorStateKind(e){const t=r_.decodeActions(e.actions);if(!t)return null;let n=0;t.sound&&n++,t.highlight&&n++;let i=null;switch(n){case 0:i=a_.On;break;case 2:i=a_.Loud}return i}}(0,r.A)(l_,"OFF",a_.Off),(0,r.A)(l_,"ON",a_.On),(0,r.A)(l_,"LOUD",a_.Loud),(0,r.A)(l_,"states",a_);class c_{constructor(e){(0,r.A)(this,"description",void 0),(0,r.A)(this,"vectorStateToActions",void 0),(0,r.A)(this,"syncedRuleIds",void 0),this.description=e.description,this.vectorStateToActions=e.vectorStateToActions,this.syncedRuleIds=e.syncedRuleIds}ruleToVectorState(e){let t=!1;e&&(t=e.enabled);for(const n of Object.values(l_.states)){const i=this.vectorStateToActions[n];if(i){if(t&&JSON.stringify(r_.decodeActions(e.actions))===JSON.stringify(r_.decodeActions(i)))return n}else if(!t)return n}l.v.error(`Cannot translate rule actions into Vector rule state. Rule: ${JSON.stringify(e)}, Expected: ${JSON.stringify(this.vectorStateToActions)}`)}}const d_={".m.rule.contains_display_name":new c_({description:(0,C.AO)("settings|notifications|rule_contains_display_name"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_HIGHLIGHT_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DISABLED}}),".m.rule.contains_user_name":new c_({description:(0,C.AO)("settings|notifications|rule_contains_user_name"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_HIGHLIGHT_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DISABLED},syncedRuleIds:[s.RuleId.IsUserMention]}),".m.rule.roomnotif":new c_({description:(0,C.AO)("settings|notifications|rule_roomnotif"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_HIGHLIGHT,[a_.Off]:s_.ACTION_DISABLED},syncedRuleIds:[s.RuleId.IsRoomMention]}),".m.rule.room_one_to_one":new c_({description:(0,C.AO)("settings|notifications|rule_room_one_to_one"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_NOTIFY_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DONT_NOTIFY},syncedRuleIds:[s.RuleId.PollStartOneToOne,s.RuleId.PollStartOneToOneUnstable,s.RuleId.PollEndOneToOne,s.RuleId.PollEndOneToOneUnstable]}),".m.rule.encrypted_room_one_to_one":new c_({description:(0,C.AO)("settings|notifications|rule_encrypted_room_one_to_one"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_NOTIFY_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DONT_NOTIFY}}),".m.rule.message":new c_({description:(0,C.AO)("settings|notifications|rule_message"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_NOTIFY_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DONT_NOTIFY},syncedRuleIds:[s.RuleId.PollStart,s.RuleId.PollStartUnstable,s.RuleId.PollEnd,s.RuleId.PollEndUnstable]}),".m.rule.encrypted":new c_({description:(0,C.AO)("settings|notifications|rule_encrypted"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_NOTIFY_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DONT_NOTIFY}}),".m.rule.invite_for_me":new c_({description:(0,C.AO)("settings|notifications|rule_invite_for_me"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_NOTIFY_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DISABLED}}),".m.rule.call":new c_({description:(0,C.AO)("settings|notifications|rule_call"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_NOTIFY_RING_SOUND,[a_.Off]:s_.ACTION_DISABLED}}),".m.rule.suppress_notices":new c_({description:(0,C.AO)("settings|notifications|rule_suppress_notices"),vectorStateToActions:{[a_.On]:s_.ACTION_DISABLED,[a_.Loud]:s_.ACTION_NOTIFY_DEFAULT_SOUND,[a_.Off]:s_.ACTION_DONT_NOTIFY}}),".m.rule.tombstone":new c_({description:(0,C.AO)("settings|notifications|rule_tombstone"),vectorStateToActions:{[a_.On]:s_.ACTION_NOTIFY,[a_.Loud]:s_.ACTION_HIGHLIGHT,[a_.Off]:s_.ACTION_DISABLED}})};class u_{static parseContentRules(e){const t=u_.categoriseContentRules(e);return t.loud.length?{vectorState:a_.Loud,rules:t.loud,externalRules:[...t.loud_but_disabled,...t.on,...t.on_but_disabled,...t.other]}:t.loud_but_disabled.length?{vectorState:a_.Off,rules:t.loud_but_disabled,externalRules:[...t.on,...t.on_but_disabled,...t.other]}:t.on.length?{vectorState:a_.On,rules:t.on,externalRules:[...t.on_but_disabled,...t.other]}:t.on_but_disabled.length?{vectorState:a_.Off,rules:t.on_but_disabled,externalRules:t.other}:{vectorState:a_.On,rules:[],externalRules:t.other}}static categoriseContentRules(e){const t={on:[],on_but_disabled:[],loud:[],loud_but_disabled:[],other:[]};for(const n in e.global)for(let i=0;i<Object.keys(e.global[n]).length;++i){const r=e.global[n][i];if("."!==r.rule_id[0]&&n===s.PushRuleKind.ContentSpecific)switch(r.kind=n,l_.contentRuleVectorStateKind(r)){case a_.On:r.enabled?t.on.push(r):t.on_but_disabled.push(r);break;case a_.Loud:r.enabled?t.loud.push(r):t.loud_but_disabled.push(r);break;default:t.other.push(r)}}return t}}const m_=async(e,t,n,i)=>{i?(await e.setPushRuleActions("global",n,t,i),await e.setPushRuleEnabled("global",n,t,!0)):await e.setPushRuleEnabled("global",n,t,!1)},h_=async(e,t,n)=>{const i=new i_.j(e),r=null==t?void 0:t.map((e=>i.getPushRuleAndKindById(e))).filter((e=>Boolean(e)));if(null!=r&&r.length)for(const{kind:t,rule:i}of r)await m_(e,i.rule_id,t,n)};function p_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function g_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p_(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const v_=e=>e?g_(g_({},e.rule),{},{kind:e.kind}):void 0,__=async(e,t)=>{if((null==e?void 0:e.getType())!==s.EventType.PushRules)return;const n=new i_.j(t);Object.entries(d_).forEach((async([e,i])=>{try{await(async(e,t,n,i)=>{var r;const o=v_(t.getPushRuleAndKindById(n));if(!o)return;const s=null===(r=i.syncedRuleIds)||void 0===r?void 0:r.map((e=>v_(t.getPushRuleAndKindById(e)))).filter((e=>Boolean(e)));if(null==s||!s.length)return;const a=i.ruleToVectorState(o),l=s.filter((e=>e.enabled!==o.enabled||i.ruleToVectorState(e)!==a));l.length&&await h_(e,l.map((({rule_id:e})=>e)),o.enabled?o.actions:void 0)})(t,n,e,i)}catch(t){l.v.error(`Failed to fully synchronise push rules for ${e}`,t)}}))};var f_=n("./node_modules/matrix-react-sdk/src/contexts/LocalDeviceVerificationStateContext.ts");function y_(e){const t=function(e){const[t,n]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const t=e.getUserId();if(!t)return;const i=e.getCrypto();null==i||i.getUserVerificationStatus(t).then((e=>n(e.isCrossSigningVerified())),(e=>l.v.error("Error fetching verification status",e)))}),[e]),(0,Pe.ml)(e,s.CryptoEvent.UserTrustStatusChanged,((t,i)=>{t===e.getUserId()&&n(i.isCrossSigningVerified())})),t}(e.client);return o.createElement(Re.Ay.Provider,{value:e.client},o.createElement(f_.f.Provider,{value:t},e.children))}function E_(e){return e.closest("input, textarea, select, [contenteditable=true]")}class b_ extends o.Component{constructor(e){super(e),(0,r.A)(this,"_matrixClient",void 0),(0,r.A)(this,"_roomView",void 0),(0,r.A)(this,"_resizeContainer",void 0),(0,r.A)(this,"resizeHandler",void 0),(0,r.A)(this,"layoutWatcherRef",void 0),(0,r.A)(this,"compactLayoutWatcherRef",void 0),(0,r.A)(this,"backgroundImageWatcherRef",void 0),(0,r.A)(this,"resizer",void 0),(0,r.A)(this,"onCallState",(()=>{const e=fe.Ay.instance.getAllActiveCalls();e!==this.state.activeCalls&&this.setState({activeCalls:e})})),(0,r.A)(this,"refreshBackgroundImage",(async()=>{let e=O.A.getValue("RoomList.backgroundImage");e=e?(0,Ds.lH)(e).srcHttp:wn.V.instance.getHttpAvatarUrl(),this.setState({backgroundImage:e})})),(0,r.A)(this,"canResetTimelineInRoom",(e=>!this._roomView.current||this._roomView.current.canResetTimeline())),(0,r.A)(this,"onAccountData",(e=>{"m.ignored_user_list"===e.getType()&&v.Ay.dispatch({action:"ignore_state_changed"}),__(e,this._matrixClient)})),(0,r.A)(this,"onCompactLayoutChanged",(()=>{this.setState({useCompactLayout:O.A.getValue("useCompactLayout")})})),(0,r.A)(this,"onSync",((e,t,n)=>{var i,r;const o=null===(i=this.state.syncErrorData)||void 0===i||null===(i=i.error)||void 0===i?void 0:i.errcode,a=null==n||null===(r=n.error)||void 0===r?void 0:r.errcode;e===t&&o===a||(this.setState({syncErrorData:e===s.SyncState.Error?n:void 0}),t===s.SyncState.Prepared&&e===s.SyncState.Syncing?this.updateServerNoticeEvents():this.calculateServerLimitToast(this.state.syncErrorData,this.state.usageLimitEventContent))})),(0,r.A)(this,"onRoomStateEvents",(e=>{const t=Ai.Ay.instance.orderedLists[he.zO.ServerNotice];null!=t&&t.some((t=>t.roomId===e.getRoomId()))&&this.updateServerNoticeEvents()})),(0,r.A)(this,"onUsageLimitDismissed",(()=>{this.setState({usageLimitDismissed:!0})})),(0,r.A)(this,"updateServerNoticeEvents",(async()=>{const e=Ai.Ay.instance.orderedLists[he.zO.ServerNotice];if(!e)return;const t=[];let n=0;for(const i of e){const e=i.currentState.getStateEvents("m.room.pinned_events","");if(!e||!e.getContent().pinned)continue;n=e.getTs();const r=e.getContent().pinned.slice(0,2);for(const e of r){const n=await this._matrixClient.getEventTimeline(i.getUnfilteredTimelineSet(),e),r=null==n?void 0:n.getEvents().find((t=>t.getId()===e));r&&t.push(r)}}if(n&&this.state.usageLimitEventTs&&this.state.usageLimitEventTs>n)return;const i=t.find((e=>e&&"m.room.message"===e.getType()&&"m.server_notice.usage_limit_reached"===e.getContent().server_notice_type)),r=null==i?void 0:i.getContent();this.calculateServerLimitToast(this.state.syncErrorData,r),this.setState({usageLimitEventContent:r,usageLimitEventTs:n,usageLimitDismissed:!1})})),(0,r.A)(this,"onPaste",(e=>{const t=E_(e.target);if(t!==document.activeElement)if(null!=t&&t.focus)t.focus();else{var n;const e=!(null===(n=document.activeElement)||void 0===n||!n.closest(".mx_ThreadView"));v.Ay.dispatch({action:x.r.FocusSendMessageComposer,context:e?Zr.Ae.Thread:Zr.Ae.Room},!0)}})),(0,r.A)(this,"onReactKeyDown",(e=>{this.onKeyDown(e)})),(0,r.A)(this,"onNativeKeyDown",(e=>{e.target===document.body&&this.onKeyDown(e)})),(0,r.A)(this,"onKeyDown",(e=>{var t,n,i;let r=!1;switch((0,Se.zM)().getRoomAction(e)){case Ee.bY.ScrollUp:case Ee.bY.ScrollDown:case Ee.bY.JumpToFirstMessage:case Ee.bY.JumpToLatestMessage:this.onScrollKeyPressed(e),r=!0;break;case Ee.bY.SearchInRoom:v.Ay.fire(x.r.FocusMessageSearch),r=!0}if(r)return e.stopPropagation(),void e.preventDefault();const o=(0,Se.zM)().getNavigationAction(e);switch(o){case Ee.bY.NextLandmark:case Ee.bY.PreviousLandmark:li.r.findAndFocusNextLandmark(li.H.MESSAGE_COMPOSER_OR_HOME,o===Ee.bY.PreviousLandmark),r=!0;break;case Ee.bY.FilterRooms:v.Ay.dispatch({action:"focus_room_filter"}),r=!0;break;case Ee.bY.ToggleUserMenu:v.Ay.fire(x.r.ToggleUserMenu),r=!0;break;case Ee.bY.ShowKeyboardSettings:v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Keyboard}),r=!0;break;case Ee.bY.GoToHome:if(r=!0,f.Ay.hasDialogs())return;v.Ay.dispatch({action:x.r.ViewHomePage});break;case Ee.bY.ToggleSpacePanel:v.Ay.fire(x.r.ToggleSpacePanel),r=!0;break;case Ee.bY.ToggleRoomSidePanel:"room_view"===this.props.page_type&&(qn.A.instance.togglePanel(null),r=!0);break;case Ee.bY.SelectPrevRoom:v.Ay.dispatch({action:x.r.ViewRoomDelta,delta:-1,unread:!1}),r=!0;break;case Ee.bY.SelectNextRoom:v.Ay.dispatch({action:x.r.ViewRoomDelta,delta:1,unread:!1}),r=!0;break;case Ee.bY.SelectPrevUnreadRoom:v.Ay.dispatch({action:x.r.ViewRoomDelta,delta:-1,unread:!0});break;case Ee.bY.SelectNextUnreadRoom:v.Ay.dispatch({action:x.r.ViewRoomDelta,delta:1,unread:!0});break;case Ee.bY.PreviousVisitedRoomOrSpace:null===(t=p.A.get())||void 0===t||t.navigateForwardBack(!0),r=!0;break;case Ee.bY.NextVisitedRoomOrSpace:null===(n=p.A.get())||void 0===n||n.navigateForwardBack(!1),r=!0}if(!r){switch((0,Se.zM)().getLabsAction(e)){case Ee.bY.ToggleHiddenEventVisibility:{const e=O.A.getValueAt(re.p.DEVICE,"showHiddenEventsInTimeline",void 0,!1);O.A.setValue("showHiddenEventsInTimeline",null,re.p.DEVICE,!e),r=!0;break}}}if(!r&&null!==(i=p.A.get())&&void 0!==i&&i.overrideBrowserShortcuts()&&e.code.startsWith("Digit")&&"Digit0"!==e.code&&(0,te.Et)(e)&&(v.Ay.dispatch({action:x.r.SwitchSpace,num:parseInt(e.code.slice(5),10)}),r=!0),r)return e.stopPropagation(),void e.preventDefault();if(!(e.key===te.Uz.ALT||e.key===te.Uz.CONTROL||e.key===te.Uz.META||e.key===te.Uz.SHIFT)&&!e.ctrlKey&&!e.metaKey){const t=e.target!==document.body&&(e.key===te.Uz.SPACE||e.key===te.Uz.ENTER),n=1===e.key.length||"Dead"===e.key;if(!t&&n&&!E_(e.target)){var s;const t=!(null===(s=document.activeElement)||void 0===s||!s.closest(".mx_ThreadView"));v.Ay.dispatch({action:x.r.FocusSendMessageComposer,context:t?Zr.Ae.Thread:Zr.Ae.Room},!0),e.stopPropagation()}}})),(0,r.A)(this,"onScrollKeyPressed",(e=>{var t;null===(t=this._roomView.current)||void 0===t||t.handleScrollKey(e)})),this.state={syncErrorData:void 0,useCompactLayout:O.A.getValue("useCompactLayout"),usageLimitDismissed:!1,activeCalls:fe.Ay.instance.getAllActiveCalls()},this._matrixClient=this.props.matrixClient,ne.Ay.loadDevices(),(0,ie.Q)(),this._roomView=o.createRef(),this._resizeContainer=o.createRef(),this.resizeHandler=o.createRef()}componentDidMount(){var e;document.addEventListener("keydown",this.onNativeKeyDown,!1),fe.Ay.instance.addListener(fe.uv.CallState,this.onCallState),this.updateServerNoticeEvents(),this._matrixClient.on(s.ClientEvent.AccountData,this.onAccountData),__(this._matrixClient.getAccountData("m.push_rules"),this._matrixClient),this._matrixClient.on(s.ClientEvent.Sync,this.onSync),this.onSync(this._matrixClient.getSyncState(),null,null!==(e=this._matrixClient.getSyncStateData())&&void 0!==e?e:void 0),this._matrixClient.on(s.RoomStateEvent.Events,this.onRoomStateEvents),this.layoutWatcherRef=O.A.watchSetting("layout",null,this.onCompactLayoutChanged),this.compactLayoutWatcherRef=O.A.watchSetting("useCompactLayout",null,this.onCompactLayoutChanged),this.backgroundImageWatcherRef=O.A.watchSetting("RoomList.backgroundImage",null,this.refreshBackgroundImage),this.resizer=this.createResizer(),this.resizer.attach(),wn.V.instance.on(A.H,this.refreshBackgroundImage),this.loadResizerPreferences(),this.refreshBackgroundImage()}componentWillUnmount(){var e;document.removeEventListener("keydown",this.onNativeKeyDown,!1),fe.Ay.instance.removeListener(fe.uv.CallState,this.onCallState),this._matrixClient.removeListener(s.ClientEvent.AccountData,this.onAccountData),this._matrixClient.removeListener(s.ClientEvent.Sync,this.onSync),this._matrixClient.removeListener(s.RoomStateEvent.Events,this.onRoomStateEvents),wn.V.instance.off(A.H,this.refreshBackgroundImage),this.layoutWatcherRef&&O.A.unwatchSetting(this.layoutWatcherRef),this.compactLayoutWatcherRef&&O.A.unwatchSetting(this.compactLayoutWatcherRef),this.backgroundImageWatcherRef&&O.A.unwatchSetting(this.backgroundImageWatcherRef),null===(e=this.resizer)||void 0===e||e.detach()}createResizer(){var e;let t,n;const i={toggleSize:156,onCollapsed:e=>{n=e,e?(v.Ay.dispatch({action:"hide_left_panel"}),window.localStorage.setItem("mx_lhs_size","0")):v.Ay.dispatch({action:"show_left_panel"})},onResized:e=>{t=e,this.props.resizeNotifier.notifyLeftHandleResized()},onResizeStart:()=>{this.props.resizeNotifier.startResizing()},onResizeStop:()=>{n||window.localStorage.setItem("mx_lhs_size",""+t),this.props.resizeNotifier.stopResizing()},isItemCollapsed:e=>e.classList.contains("mx_LeftPanel_minimized"),handler:null!==(e=this.resizeHandler.current)&&void 0!==e?e:void 0},r=new me(this._resizeContainer.current,ue,i);return r.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle--vertical",reverse:"mx_ResizeHandle_reverse"}),r}loadResizerPreferences(){var e;let t=parseInt(window.localStorage.getItem("mx_lhs_size"),10);isNaN(t)&&(t=350),null===(e=this.resizer)||void 0===e||null===(e=e.forHandleWithId("lp-resizer"))||void 0===e||e.resize(t)}calculateServerLimitToast(e,t){var n;const i="M_RESOURCE_LIMIT_EXCEEDED"===(null==e||null===(n=e.error)||void 0===n?void 0:n.errcode);i&&(t=(null==e?void 0:e.error).data),t&&this.state.usageLimitDismissed?((e,t,n)=>{const i=(0,pe.AB)(e,n,{monthly_active_user:(0,C.AO)("error|mau"),hs_blocked:(0,C.AO)("error|hs_blocked"),"":(0,C.AO)("error|resource_limits")}),r=(0,pe.AB)(e,n,{"":(0,C.AO)("error|admin_contact_short")});S.A.sharedInstance().addOrReplaceToast({key:ge,title:(0,C._t)("common|warning"),props:{description:o.createElement(o.Fragment,null,i," ",r),primaryLabel:(0,C._t)("action|ok"),onPrimaryClick:()=>{ve(),t&&t()}},component:k.A,priority:70})})(t.limit_type,this.onUsageLimitDismissed,t.admin_contact):ve()}render(){let e;switch(this.props.page_type){case B.A.RoomView:e=o.createElement(Iv,{ref:this._roomView,onRegistered:this.props.onRegistered,threepidInvite:this.props.threepidInvite,oobData:this.props.roomOobData,key:this.props.currentRoomId||"roomview",resizeNotifier:this.props.resizeNotifier,justCreatedOpts:this.props.roomJustCreatedOpts,forceTimeline:this.props.forceTimeline});break;case B.A.HomePage:e=o.createElement(fo,{justRegistered:this.props.justRegistered});break;case B.A.UserView:this.props.currentUserId&&(e=o.createElement(Pv,{userId:this.props.currentUserId,resizeNotifier:this.props.resizeNotifier}))}const t=ee()({mx_MatrixChat_wrapper:!0,mx_MatrixChat_useCompactLayout:this.state.useCompactLayout}),n=ee()({mx_MatrixChat:!0,"mx_MatrixChat--with-avatar":this.state.backgroundImage}),i=this.state.activeCalls.map((e=>o.createElement(Ro,{call:e,key:e.callId})));return o.createElement(y_,{client:this._matrixClient},o.createElement("div",{onPaste:this.onPaste,onKeyDown:this.onReactKeyDown,className:t,"aria-hidden":this.props.hideToSRUsers},o.createElement(Tv,null),o.createElement("div",{className:n},o.createElement("div",{className:"mx_LeftPanel_outerWrapper"},o.createElement(Mv,{isMinimized:this.props.collapseLhs||!1}),o.createElement("div",{className:"mx_LeftPanel_wrapper"},o.createElement(Nv,{blurMultiplier:.5,backgroundImage:this.state.backgroundImage}),o.createElement(yi,null),o.createElement(Nv,{backgroundImage:this.state.backgroundImage}),o.createElement("div",{className:"mx_LeftPanel_wrapper--user",ref:this._resizeContainer,"data-collapsed":!!this.props.collapseLhs||void 0},o.createElement(wo,{pageType:this.props.page_type,isMinimized:this.props.collapseLhs||!1,resizeNotifier:this.props.resizeNotifier})))),o.createElement(oe,{passRef:this.resizeHandler,id:"lp-resizer"}),o.createElement("div",{className:"mx_RoomView_wrapper"},e))),o.createElement(n_,null),o.createElement(Ao,null),i)}}(0,r.A)(b_,"displayName","LoggedInView");const w_=b_;function x_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}let A_=function(e){return e[e.Primary=0]="Primary",e[e.Cancel=1]="Cancel",e}({});const S_=({onFinished:e,analyticsOwner:t,privacyPolicyUrl:n,primaryButton:i,cancelButton:r,hasCancel:s})=>{const a=n?o.createElement("span",null,(0,C._t)("analytics|privacy_policy",{},{PrivacyPolicyUrl:e=>o.createElement(sn.A,{href:n,rel:"norefferer noopener",target:"_blank"},e)})):"";return o.createElement(cn.A,{className:"mx_AnalyticsLearnMoreDialog",contentId:"mx_AnalyticsLearnMore",title:(0,C._t)("analytics|enable_prompt",{analyticsOwner:t}),onFinished:e},o.createElement("div",{className:"mx_Dialog_content"},o.createElement("div",{className:"mx_AnalyticsLearnMore_image_holder"}),o.createElement("div",{className:"mx_AnalyticsLearnMore_copy"},(0,C._t)("analytics|pseudonymous_usage_data",{analyticsOwner:t})),o.createElement("ul",{className:"mx_AnalyticsLearnMore_bullets"},o.createElement("li",null,(0,C._t)("analytics|bullet_1",{},{Bold:e=>o.createElement("b",null,e)})),o.createElement("li",null,(0,C._t)("analytics|bullet_2",{},{Bold:e=>o.createElement("b",null,e)})),o.createElement("li",null,(0,C._t)("analytics|disable_prompt"))),a),o.createElement(un.A,{primaryButton:i,cancelButton:r,onPrimaryButtonClick:()=>e(A_.Primary),onCancel:()=>e(A_.Cancel),hasCancel:s}))},C_=e=>{var t;const n=g.Ay.get("privacy_policy_url"),i=null!==(t=g.Ay.get("analytics_owner"))&&void 0!==t?t:g.Ay.get("brand");f.Ay.createDialog(S_,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x_(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({privacyPolicyUrl:n,analyticsOwner:i},e),"mx_AnalyticsLearnMoreDialog_wrapper")},k_=()=>{v.Ay.dispatch({action:x.r.PseudonymousAnalyticsAccept})},R_=()=>{v.Ay.dispatch({action:x.r.PseudonymousAnalyticsReject})},I_=()=>{C_({onFinished:e=>{e===A_.Primary&&k_()},primaryButton:(0,C._t)("action|enable")})},T_=()=>{C_({onFinished:e=>{e===A_.Primary?k_():e===A_.Cancel&&R_()},primaryButton:(0,C._t)("analytics|accept_button"),cancelButton:(0,C._t)("action|stop")})},P_="analytics";const N_=()=>{var e;const t=O.A.getValue("analyticsOptIn",null,!0);let n;if(t)n={description:(0,C._t)("analytics|consent_migration"),primaryLabel:(0,C._t)("analytics|accept_button"),onPrimaryClick:k_,secondaryLabel:(0,C._t)("action|learn_more"),onSecondaryClick:T_};else{if(null!=t)return;{const e=e=>o.createElement(be.A,{kind:"link_inline",onClick:I_},e);n={description:(0,C._t)("analytics|learn_more",{},{LearnMoreLink:e}),primaryLabel:(0,C._t)("action|yes"),onPrimaryClick:k_,secondaryLabel:(0,C._t)("action|no"),onSecondaryClick:R_}}}const i=null!==(e=g.Ay.get("analytics_owner"))&&void 0!==e?e:g.Ay.get().brand;S.A.sharedInstance().addOrReplaceToast({key:P_,title:(0,C._t)("analytics|enable_prompt",{analyticsOwner:i}),props:n,component:k.A,className:"mx_AnalyticsToast",priority:10})},D_=()=>{S.A.sharedInstance().dismissToast(P_)};var M_=n("./node_modules/matrix-react-sdk/src/stores/ThreepidInviteStore.ts"),O_=n("./node_modules/matrix-react-sdk/src/components/views/elements/DialPadBackspaceButton.tsx");class L_ extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"numberEntryFieldRef",(0,o.createRef)()),(0,r.A)(this,"onCancelClick",(()=>{this.props.onFinished(!1)})),(0,r.A)(this,"onChange",(e=>{this.setState({value:e.target.value})})),(0,r.A)(this,"onFormSubmit",(e=>{e.preventDefault(),this.onDialPress()})),(0,r.A)(this,"onDigitPress",((e,t)=>{var n;(this.setState({value:this.state.value+e}),"click"===t.type)&&(null===(n=this.numberEntryFieldRef.current)||void 0===n||n.focus())})),(0,r.A)(this,"onDeletePress",(e=>{var t;0!==this.state.value.length&&(this.setState({value:this.state.value.slice(0,-1)}),"click"===e.type&&(null===(t=this.numberEntryFieldRef.current)||void 0===t||t.focus()))})),(0,r.A)(this,"onDialPress",(async()=>{fe.Ay.instance.dialNumber(this.state.value),this.props.onFinished(!0)})),this.state={value:""}}render(){const e=o.createElement(O_.A,{onBackspacePress:this.onDeletePress});let t;return t=0!==this.state.value.length?o.createElement(tn.A,{ref:this.numberEntryFieldRef,className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange,postfixComponent:e}):o.createElement(tn.A,{ref:this.numberEntryFieldRef,className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange}),o.createElement("div",{className:"mx_DialPadModal"},o.createElement("div",null,o.createElement(be.A,{className:"mx_DialPadModal_cancel",onClick:this.onCancelClick})),o.createElement("div",{className:"mx_DialPadModal_header"},o.createElement("form",{onSubmit:this.onFormSubmit},t)),o.createElement("div",{className:"mx_DialPadModal_dialPad"},o.createElement(gh.Ay,{hasDial:!0,onDigitPress:this.onDigitPress,onDeletePress:this.onDeletePress,onDialPress:this.onDialPress})))}}const U_=()=>{window.location.href="mobile_guide/"},F_=()=>{document.cookie="element_mobile_redirect_to_guide=false;path=/;max-age=14400",B_()},j_="mobileguide",B_=()=>{S.A.sharedInstance().dismissToast(j_)};function V_(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M9.175 13.825C9.958 14.608 10.9 15 12 15s2.042-.392 2.825-1.175C15.608 13.042 16 12.1 16 11s-.392-2.042-1.175-2.825C14.042 7.392 13.1 7 12 7s-2.042.392-2.825 1.175C8.392 8.958 8 9.9 8 11s.392 2.042 1.175 2.825Zm4.237-1.412A1.926 1.926 0 0 1 12 13c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 11c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 9c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412Z"}),(0,Oo.jsx)("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"}),(0,Oo.jsx)("path",{d:"M16.23 18.792a12.47 12.47 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0c-.487.12-.972.271-1.455.455a8.04 8.04 0 0 1-1.729-1.454c.89-.412 1.794-.729 2.709-.95A13.76 13.76 0 0 1 12 16c1.1 0 2.183.13 3.25.387a14.78 14.78 0 0 1 2.709.95 8.042 8.042 0 0 1-1.73 1.455Z"})]})}V_.displayName="UserProfileIcon";const H_=(0,o.forwardRef)(V_);function z_(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M3.5 20c-.417 0-.77-.146-1.063-.438A1.447 1.447 0 0 1 2 18.5c0-.417.146-.77.438-1.063A1.446 1.446 0 0 1 3.5 17H4V6c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 4h14a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 20 6H6v11h4.5c.417 0 .77.146 1.063.438.291.291.437.645.437 1.062 0 .417-.146.77-.438 1.063A1.446 1.446 0 0 1 10.5 20h-7ZM15 20a.968.968 0 0 1-.713-.288A.968.968 0 0 1 14 19V9c0-.283.096-.52.287-.713A.968.968 0 0 1 15 8h6a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v10c0 .283-.096.52-.288.712A.968.968 0 0 1 21 20h-6Zm1-3h4v-7h-4v7Z"})})}z_.displayName="DevicesIcon";const W_=(0,o.forwardRef)(z_);var G_=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/visibility-on.js");function K_(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{fillRule:"evenodd",d:"M6.5 2h11a4.5 4.5 0 1 1 0 9h-11a4.5 4.5 0 0 1 0-9Zm0 2h7.258A4.479 4.479 0 0 0 13 6.5c0 .925.28 1.785.758 2.5H6.5a2.5 2.5 0 0 1 0-5ZM15 6.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0Zm-13 11A4.5 4.5 0 0 1 6.5 13h11a4.5 4.5 0 1 1 0 9h-11A4.5 4.5 0 0 1 2 17.5Zm8.242-2.5H17.5a2.5 2.5 0 0 1 0 5h-7.258A4.478 4.478 0 0 0 11 17.5c0-.925-.28-1.785-.758-2.5ZM6.5 15a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5Z",clipRule:"evenodd"})})}K_.displayName="PreferencesIcon";const J_=(0,o.forwardRef)(K_);function q_(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M5.188 8v2h2V8h-2Zm3.875 0v2h2V8h-2Zm3.875 0v2h2V8h-2Zm3.875 0v2h2V8h-2ZM5.188 11.531v2h2v-2h-2Zm3.875 0v2h2v-2h-2Zm3.875 0v2h2v-2h-2Zm3.875 0v2h2v-2h-2ZM9 15a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2H9Z"}),(0,Oo.jsx)("path",{fillRule:"evenodd",d:"M2 6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6Zm2 0h16v12H4V6Z",clipRule:"evenodd"})]})}q_.displayName="KeyboardIcon";const $_=(0,o.forwardRef)(q_);function Y_(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{fillRule:"evenodd",d:"M18 3a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4h12Zm-8 2h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-8V5ZM8 19H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2v14Z",clipRule:"evenodd"})})}Y_.displayName="SidebarIcon";const Q_=(0,o.forwardRef)(Y_);function Z_(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M6 12a1 1 0 1 0-2 0 8.001 8.001 0 0 0 7 7.938V21a1 1 0 1 0 2 0v-1.062A8.001 8.001 0 0 0 20 12a1 1 0 1 0-2 0 6 6 0 0 1-12 0Z"}),(0,Oo.jsx)("path",{fillRule:"evenodd",d:"M14 12V6a2 2 0 1 0-4 0v6a2 2 0 1 0 4 0ZM12 2a4 4 0 0 0-4 4v6a4 4 0 0 0 8 0V6a4 4 0 0 0-4-4Z",clipRule:"evenodd"})]})}Z_.displayName="MicOnIcon";const X_=(0,o.forwardRef)(Z_);function ef(e,t){return(0,Oo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:(0,Oo.jsx)("path",{d:"M6 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 8h1V6c0-1.383.487-2.563 1.463-3.538C9.438 1.487 10.617 1 12 1s2.563.488 3.537 1.462C16.512 3.438 17 4.617 17 6v2h1c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v10c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 22H6Zm0-2h12V10H6v10ZM9 8h6V6c0-.833-.292-1.542-.875-2.125A2.893 2.893 0 0 0 12 3c-.833 0-1.542.292-2.125.875A2.893 2.893 0 0 0 9 6v2Z"})})}ef.displayName="LockIcon";const tf=(0,o.forwardRef)(ef);function nf(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M12 5a1 1 0 0 1-1-1V3a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1Zm-7.071-.071a1 1 0 0 1 1.414 0l.707.707A1 1 0 0 1 5.636 7.05l-.707-.707a1 1 0 0 1 0-1.414Z"}),(0,Oo.jsx)("path",{fillRule:"evenodd",d:"M15.734 15.325C15.316 15.795 15 16.371 15 17v2a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-2c0-.63-.316-1.205-.734-1.675a5 5 0 1 1 7.468 0Zm-1.493-1.33a3 3 0 1 0-4.482 0c.433.486.894 1.166 1.112 2.005h2.258c.218-.84.679-1.52 1.112-2.005ZM13 18h-2v1h2v-1Z",clipRule:"evenodd"}),(0,Oo.jsx)("path",{d:"M2 12a1 1 0 0 1 1-1h1a1 1 0 1 1 0 2H3a1 1 0 0 1-1-1Zm18-1a1 1 0 1 0 0 2h1a1 1 0 1 0 0-2h-1Zm-3.05-5.364a1 1 0 0 0 1.414 1.414l.707-.707a1 1 0 0 0-1.414-1.414l-.707.707Z"})]})}nf.displayName="LabsIcon";const rf=(0,o.forwardRef)(nf);var of=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/block.js");function sf(e,t){return(0,Oo.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:t,...e,children:[(0,Oo.jsx)("path",{d:"M12 8a1.5 1.5 0 0 0-1.5 1.5 1 1 0 1 1-2 0 3.5 3.5 0 1 1 6.01 2.439c-.122.126-.24.243-.352.355-.287.288-.54.54-.76.824-.293.375-.398.651-.398.882a1 1 0 1 1-2 0c0-.874.407-1.58.819-2.11.305-.392.688-.775 1-1.085l.257-.26A1.5 1.5 0 0 0 12 8Zm1 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"}),(0,Oo.jsx)("path",{d:"M8.1 21.212A9.738 9.738 0 0 0 12 22a9.738 9.738 0 0 0 3.9-.788 10.098 10.098 0 0 0 3.175-2.137c.9-.9 1.613-1.958 2.137-3.175A9.738 9.738 0 0 0 22 12a9.738 9.738 0 0 0-.788-3.9 10.099 10.099 0 0 0-2.137-3.175c-.9-.9-1.958-1.612-3.175-2.137A9.738 9.738 0 0 0 12 2a9.738 9.738 0 0 0-3.9.788 10.099 10.099 0 0 0-3.175 2.137c-.9.9-1.612 1.958-2.137 3.175A9.738 9.738 0 0 0 2 12a9.74 9.74 0 0 0 .788 3.9 10.098 10.098 0 0 0 2.137 3.175c.9.9 1.958 1.613 3.175 2.137Zm9.575-3.537C16.125 19.225 14.233 20 12 20c-2.233 0-4.125-.775-5.675-2.325C4.775 16.125 4 14.233 4 12c0-2.233.775-4.125 2.325-5.675C7.875 4.775 9.767 4 12 4c2.233 0 4.125.775 5.675 2.325C19.225 7.875 20 9.767 20 12c0 2.233-.775 4.125-2.325 5.675Z"})]})}sf.displayName="HelpIcon";const af=(0,o.forwardRef)(sf);var lf,cf,df=n("./node_modules/matrix-react-sdk/src/components/structures/TabbedView.tsx");function uf(){return uf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},uf.apply(null,arguments)}var mf=function(e,t){return o.createElement("svg",uf({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),lf||(lf=o.createElement("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2"})),cf||(cf=o.createElement("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2"})))},hf=(0,o.forwardRef)(mf);var pf;function gf(){return gf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gf.apply(null,arguments)}var vf=function(e,t){return o.createElement("svg",gf({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),pf||(pf=o.createElement("path",{d:"M9 12.031q0-.424.288-.712A.97.97 0 0 1 10 11.03h7.15l-1.875-1.875a.96.96 0 0 1-.3-.7q0-.4.325-.725a.93.93 0 0 1 .712-.287.98.98 0 0 1 .688.287l3.6 3.6q.15.15.212.325.063.175.063.375 0 .201-.063.375a.9.9 0 0 1-.212.325l-3.6 3.6a.93.93 0 0 1-.712.288.98.98 0 0 1-.688-.288 1.02 1.02 0 0 1-.313-.712.93.93 0 0 1 .288-.713l1.875-1.875H10a.97.97 0 0 1-.712-.287A.97.97 0 0 1 9 12.03Zm-6-7q0-.825.588-1.412A1.93 1.93 0 0 1 5 3.03h6a.97.97 0 0 1 .713.288.97.97 0 0 1 .287.712.97.97 0 0 1-.287.713.97.97 0 0 1-.713.287H5v14h6a.97.97 0 0 1 .713.288.97.97 0 0 1 .287.712.97.97 0 0 1-.287.713.97.97 0 0 1-.713.287H5q-.824 0-1.412-.587A1.93 1.93 0 0 1 3 19.03z"})))},_f=(0,o.forwardRef)(vf);var ff=n("./node_modules/matrix-react-sdk/src/components/views/settings/AvatarSetting.tsx");const yf=(0,o.createContext)(null);yf.displayName="ToastContext";class Ef{constructor(){(0,r.A)(this,"currentToast",void 0),(0,r.A)(this,"updateCallback",void 0),(0,r.A)(this,"idSeq",0)}setCallback(e){this.updateCallback=e}displayToast(e){var t;const n=++this.idSeq;this.currentToast={id:n,contents:e},null===(t=this.updateCallback)||void 0===t||t.call(this);return()=>{var e,t;(null===(e=this.currentToast)||void 0===e?void 0:e.id)===n&&(this.currentToast=void 0,null===(t=this.updateCallback)||void 0===t||t.call(this))}}getActiveToast(){var e;return null===(e=this.currentToast)||void 0===e?void 0:e.contents}}var bf=n("./node_modules/matrix-react-sdk/src/utils/useId.ts"),wf=n("./node_modules/matrix-react-sdk/src/components/views/elements/CopyableText.tsx");const xf=({children:e})=>o.createElement(o.Fragment,null,o.createElement(Ve.A,null),e),Af=({username:e})=>{const t=(0,bf.B)();return o.createElement("div",{className:"mx_UserProfileSettings_profile_controls_userId"},o.createElement("div",{className:"mx_UserProfileSettings_profile_controls_userId_label",id:t},(0,C._t)("settings|general|username")),o.createElement(wf.A,{getTextToCopy:()=>e,"aria-labelledby":t},e))},Sf=({externalAccountManagementUrl:e})=>o.createElement(be.A,{onClick:null,element:"a",kind:"primary",target:"_blank",rel:"noreferrer noopener",href:e},o.createElement(hf,{className:"mx_UserProfileSettings_accountmanageIcon",width:"24",height:"24"}),(0,C._t)("settings|general|oidc_manage_button")),Cf=()=>{const e=(0,Re.nH)(),t=(0,o.useCallback)((async()=>{await hn(e)?f.Ay.createDialog(pn):v.Ay.dispatch({action:"logout"})}),[e]);return o.createElement(be.A,{onClick:t,kind:"danger_outline"},o.createElement(_f,{className:"mx_UserProfileSettings_accountmanageIcon",width:"24",height:"24"}),(0,C._t)("action|sign_out"))},kf=({externalAccountManagementUrl:e,canSetDisplayName:t,canSetAvatar:n})=>{var i,r;const[s,a]=(0,o.useState)(wn.V.instance.avatarMxc),[c,d]=(0,o.useState)(null!==(i=wn.V.instance.displayName)&&void 0!==i?i:""),[m,h]=(0,o.useState)(!1),[p,g]=(0,o.useState)(),[v,_]=(0,o.useState)(!1),f=(0,o.useContext)(yf),y=(0,Re.nH)();(0,o.useEffect)((()=>{(async()=>{try{const e=await y.getMediaConfig();g(e["m.upload.size"])}catch(e){l.v.warn("Failed to get media config",e)}})()}),[y]);const E=(0,o.useCallback)((async()=>{const e=f.displayToast(o.createElement(xf,null,(0,C._t)("settings|general|avatar_remove_progress")));try{await y.setAvatarUrl(""),a("")}finally{e()}}),[f,y]),b=(0,o.useCallback)((async e=>{u.A.trackInteraction("WebProfileSettingsAvatarUploadButton"),l.v.log(`Uploading new avatar, ${e.name} of type ${e.type}, (${e.size}) bytes`);const t=f.displayToast(o.createElement(xf,null,(0,C._t)("settings|general|avatar_save_progress")));try{h(!1);const{content_uri:t}=await y.uploadContent(e);await y.setAvatarUrl(t),a(t)}catch(e){h(!0)}finally{t()}}),[f,y]),w=(0,o.useCallback)((e=>{d(e.target.value)}),[]),x=(0,o.useCallback)((()=>{var e;d(null!==(e=wn.V.instance.displayName)&&void 0!==e?e:"")}),[]),A=(0,o.useCallback)((async()=>{try{_(!1),await y.setDisplayName(c)}catch(e){throw _(!0),e}}),[c,y]),S=(0,o.useMemo)((()=>An.A.getDisplayUserIdentifier(y.getSafeUserId(),{withDisplayName:!0})),[y]),k=!t||!n;return o.createElement("div",{className:"mx_UserProfileSettings"},o.createElement("h2",null,(0,C._t)("common|profile")),o.createElement("div",null,k?(0,C._t)("settings|general|profile_subtitle_oidc"):(0,C._t)("settings|general|profile_subtitle")),o.createElement("div",{className:"mx_UserProfileSettings_profile"},o.createElement(ff.A,{avatar:null!=s?s:void 0,avatarAltText:(0,C._t)("common|user_avatar"),onChange:b,removeAvatar:s?E:void 0,placeholderName:c,placeholderId:null!==(r=y.getUserId())&&void 0!==r?r:"",disabled:!n}),o.createElement(ke.dU,{className:"mx_UserProfileSettings_profile_displayName",label:(0,C._t)("settings|general|display_name"),value:c,saveButtonLabel:(0,C._t)("common|save"),cancelButtonLabel:(0,C._t)("common|cancel"),savedLabel:(0,C._t)("common|saved"),savingLabel:(0,C._t)("common|updating"),onChange:w,onCancel:x,onSave:A,disabled:!t},v&&o.createElement(ke.Kw,null,(0,C._t)("settings|general|display_name_error")))),m&&o.createElement(ke.Fc,{title:(0,C._t)("settings|general|avatar_upload_error_title"),type:"critical"},void 0===p?(0,C._t)("settings|general|avatar_upload_error_text_generic"):(0,C._t)("settings|general|avatar_upload_error_text",{size:(0,ia.z3)(p)})),S&&o.createElement(Af,{username:S}),o.createElement(Fa.s,{gap:"var(--cpd-space-4x)",className:"mx_UserProfileSettings_profile_buttons"},e&&o.createElement(Sf,{externalAccountManagementUrl:e}),o.createElement(Cf,null)))};var Rf=n("./node_modules/matrix-react-sdk/src/components/structures/InteractiveAuth.tsx"),If=n("./node_modules/matrix-react-sdk/src/components/views/auth/InteractiveAuthEntryComponents.tsx");class Tf extends o.Component{constructor(e){super(e),(0,r.A)(this,"onStagePhaseChange",((e,t)=>{const n={[If.av.PHASE_PREAUTH]:{body:(0,C._t)("settings|general|deactivate_confirm_body_sso"),continueText:(0,C._t)("auth|sso"),continueKind:"danger"},[If.av.PHASE_POSTAUTH]:{body:(0,C._t)("settings|general|deactivate_confirm_body"),continueText:(0,C._t)("settings|general|deactivate_confirm_continue"),continueKind:"danger"}},i={[If.av.LOGIN_TYPE]:n,[If.av.UNSTABLE_LOGIN_TYPE]:n}[e];let r,o,s;if(i){const e=i[t];e&&(e.body&&(r=e.body),e.continueText&&(o=e.continueText),e.continueKind&&(s=e.continueKind))}this.setState({bodyText:r,continueText:o,continueKind:s})})),(0,r.A)(this,"onUIAuthFinished",(async(e,t)=>{e||(t!==Rf.R?(l.v.error("Error during UI Auth:",{result:t}),this.setState({errStr:(0,C._t)("settings|general|error_deactivate_communication")})):this.onCancel())})),(0,r.A)(this,"onUIAuthComplete",(e=>{h.J.safeGet().deactivateAccount(null!=e?e:void 0,this.state.shouldErase).then((e=>{v.Ay.fire(x.r.TriggerLogout),this.props.onFinished(!0)})).catch((e=>{l.v.error(e),this.setState({errStr:(0,C._t)("settings|general|error_deactivate_communication")})}))})),(0,r.A)(this,"onEraseFieldChange",(e=>{this.setState({shouldErase:e.currentTarget.checked,authEnabled:!1}),this.initAuth(e.currentTarget.checked)})),this.state={shouldErase:!1,errStr:null,authData:null,authEnabled:!0},this.initAuth(!1)}onCancel(){this.props.onFinished(!1)}initAuth(e){h.J.safeGet().deactivateAccount(void 0,e).then((e=>{l.v.warn("User's account got deactivated without confirmation: Server had no auth"),this.setState({errStr:(0,C._t)("settings|general|error_deactivate_no_auth")})})).catch((e=>{e&&401===e.httpStatus&&e.data?this.setState({authData:e.data,authEnabled:!0}):this.setState({errStr:(0,C._t)("settings|general|error_deactivate_invalid_auth")})}))}render(){let e;this.state.errStr&&(e=o.createElement("div",{className:"error"},this.state.errStr));let t=o.createElement("div",null,(0,C._t)("common|loading"));return this.state.authData&&this.state.authEnabled&&(t=o.createElement("div",null,this.state.bodyText,o.createElement(Rf.A,{matrixClient:h.J.safeGet(),authData:this.state.authData,makeRequest:this.onUIAuthComplete,onAuthFinished:this.onUIAuthFinished,onStagePhaseChange:this.onStagePhaseChange,continueText:this.state.continueText,continueKind:this.state.continueKind}))),o.createElement(cn.A,{className:"mx_DeactivateAccountDialog",onFinished:this.props.onFinished,titleClass:"danger",title:(0,C._t)("settings|general|deactivate_section"),screenName:"DeactivateAccount"},o.createElement("div",{className:"mx_Dialog_content"},o.createElement("p",null,(0,C._t)("settings|general|deactivate_confirm_content")),o.createElement("ul",null,o.createElement("li",null,(0,C._t)("settings|general|deactivate_confirm_content_1")),o.createElement("li",null,(0,C._t)("settings|general|deactivate_confirm_content_2")),o.createElement("li",null,(0,C._t)("settings|general|deactivate_confirm_content_3")),o.createElement("li",null,(0,C._t)("settings|general|deactivate_confirm_content_4")),o.createElement("li",null,(0,C._t)("settings|general|deactivate_confirm_content_5"))),o.createElement("p",null,(0,C._t)("settings|general|deactivate_confirm_content_6")),o.createElement("div",{className:"mx_DeactivateAccountDialog_input_section"},o.createElement("p",null,o.createElement(at.A,{checked:this.state.shouldErase,onChange:this.onEraseFieldChange},(0,C._t)("settings|general|deactivate_confirm_erase_label"))),e,t)))}}var Pf=n("./node_modules/matrix-react-sdk/src/components/views/auth/PassphraseField.tsx");const Nf=/^[0-9 -.]+$/;const Df=127462-"A".charCodeAt(0),Mf=/^[A-Z]{2}$/,Of=[{iso2:"GB",prefix:"44"},{iso2:"US",prefix:"1"},{iso2:"AF",prefix:"93"},{iso2:"AX",prefix:"358"},{iso2:"AL",prefix:"355"},{iso2:"DZ",prefix:"213"},{iso2:"AS",prefix:"1"},{iso2:"AD",prefix:"376"},{iso2:"AO",prefix:"244"},{iso2:"AI",prefix:"1"},{iso2:"AQ",prefix:"672"},{iso2:"AG",prefix:"1"},{iso2:"AR",prefix:"54"},{iso2:"AM",prefix:"374"},{iso2:"AW",prefix:"297"},{iso2:"AU",prefix:"61"},{iso2:"AT",prefix:"43"},{iso2:"AZ",prefix:"994"},{iso2:"BS",prefix:"1"},{iso2:"BH",prefix:"973"},{iso2:"BD",prefix:"880"},{iso2:"BB",prefix:"1"},{iso2:"BY",prefix:"375"},{iso2:"BE",prefix:"32"},{iso2:"BZ",prefix:"501"},{iso2:"BJ",prefix:"229"},{iso2:"BM",prefix:"1"},{iso2:"BT",prefix:"975"},{iso2:"BO",prefix:"591"},{iso2:"BA",prefix:"387"},{iso2:"BW",prefix:"267"},{iso2:"BV",prefix:"47"},{iso2:"BR",prefix:"55"},{iso2:"IO",prefix:"246"},{iso2:"VG",prefix:"1"},{iso2:"BN",prefix:"673"},{iso2:"BG",prefix:"359"},{iso2:"BF",prefix:"226"},{iso2:"BI",prefix:"257"},{iso2:"KH",prefix:"855"},{iso2:"CM",prefix:"237"},{iso2:"CA",prefix:"1"},{iso2:"CV",prefix:"238"},{iso2:"BQ",prefix:"599"},{iso2:"KY",prefix:"1"},{iso2:"CF",prefix:"236"},{iso2:"TD",prefix:"235"},{iso2:"CL",prefix:"56"},{iso2:"CN",prefix:"86"},{iso2:"CX",prefix:"61"},{iso2:"CC",prefix:"61"},{iso2:"CO",prefix:"57"},{iso2:"KM",prefix:"269"},{iso2:"CG",prefix:"242"},{iso2:"CD",prefix:"243"},{iso2:"CK",prefix:"682"},{iso2:"CR",prefix:"506"},{iso2:"HR",prefix:"385"},{iso2:"CU",prefix:"53"},{iso2:"CW",prefix:"599"},{iso2:"CY",prefix:"357"},{iso2:"CZ",prefix:"420"},{iso2:"CI",prefix:"225"},{iso2:"DK",prefix:"45"},{iso2:"DJ",prefix:"253"},{iso2:"DM",prefix:"1"},{iso2:"DO",prefix:"1"},{iso2:"EC",prefix:"593"},{iso2:"EG",prefix:"20"},{iso2:"SV",prefix:"503"},{iso2:"GQ",prefix:"240"},{iso2:"ER",prefix:"291"},{iso2:"EE",prefix:"372"},{iso2:"ET",prefix:"251"},{iso2:"FK",prefix:"500"},{iso2:"FO",prefix:"298"},{iso2:"FJ",prefix:"679"},{iso2:"FI",prefix:"358"},{iso2:"FR",prefix:"33"},{iso2:"GF",prefix:"594"},{iso2:"PF",prefix:"689"},{iso2:"TF",prefix:"262"},{iso2:"GA",prefix:"241"},{iso2:"GM",prefix:"220"},{iso2:"GE",prefix:"995"},{iso2:"DE",prefix:"49"},{iso2:"GH",prefix:"233"},{iso2:"GI",prefix:"350"},{iso2:"GR",prefix:"30"},{iso2:"GL",prefix:"299"},{iso2:"GD",prefix:"1"},{iso2:"GP",prefix:"590"},{iso2:"GU",prefix:"1"},{iso2:"GT",prefix:"502"},{iso2:"GG",prefix:"44"},{iso2:"GN",prefix:"224"},{iso2:"GW",prefix:"245"},{iso2:"GY",prefix:"592"},{iso2:"HT",prefix:"509"},{iso2:"HM",prefix:"672"},{iso2:"HN",prefix:"504"},{iso2:"HK",prefix:"852"},{iso2:"HU",prefix:"36"},{iso2:"IS",prefix:"354"},{iso2:"IN",prefix:"91"},{iso2:"ID",prefix:"62"},{iso2:"IR",prefix:"98"},{iso2:"IQ",prefix:"964"},{iso2:"IE",prefix:"353"},{iso2:"IM",prefix:"44"},{iso2:"IL",prefix:"972"},{iso2:"IT",prefix:"39"},{iso2:"JM",prefix:"1"},{iso2:"JP",prefix:"81"},{iso2:"JE",prefix:"44"},{iso2:"JO",prefix:"962"},{iso2:"KZ",prefix:"7"},{iso2:"KE",prefix:"254"},{iso2:"KI",prefix:"686"},{iso2:"XK",prefix:"383"},{iso2:"KW",prefix:"965"},{iso2:"KG",prefix:"996"},{iso2:"LA",prefix:"856"},{iso2:"LV",prefix:"371"},{iso2:"LB",prefix:"961"},{iso2:"LS",prefix:"266"},{iso2:"LR",prefix:"231"},{iso2:"LY",prefix:"218"},{iso2:"LI",prefix:"423"},{iso2:"LT",prefix:"370"},{iso2:"LU",prefix:"352"},{iso2:"MO",prefix:"853"},{iso2:"MK",prefix:"389"},{iso2:"MG",prefix:"261"},{iso2:"MW",prefix:"265"},{iso2:"MY",prefix:"60"},{iso2:"MV",prefix:"960"},{iso2:"ML",prefix:"223"},{iso2:"MT",prefix:"356"},{iso2:"MH",prefix:"692"},{iso2:"MQ",prefix:"596"},{iso2:"MR",prefix:"222"},{iso2:"MU",prefix:"230"},{iso2:"YT",prefix:"262"},{iso2:"MX",prefix:"52"},{iso2:"FM",prefix:"691"},{iso2:"MD",prefix:"373"},{iso2:"MC",prefix:"377"},{iso2:"MN",prefix:"976"},{iso2:"ME",prefix:"382"},{iso2:"MS",prefix:"1"},{iso2:"MA",prefix:"212"},{iso2:"MZ",prefix:"258"},{iso2:"MM",prefix:"95"},{iso2:"NA",prefix:"264"},{iso2:"NR",prefix:"674"},{iso2:"NP",prefix:"977"},{iso2:"NL",prefix:"31"},{iso2:"NC",prefix:"687"},{iso2:"NZ",prefix:"64"},{iso2:"NI",prefix:"505"},{iso2:"NE",prefix:"227"},{iso2:"NG",prefix:"234"},{iso2:"NU",prefix:"683"},{iso2:"NF",prefix:"672"},{iso2:"KP",prefix:"850"},{iso2:"MP",prefix:"1"},{iso2:"NO",prefix:"47"},{iso2:"OM",prefix:"968"},{iso2:"PK",prefix:"92"},{iso2:"PW",prefix:"680"},{iso2:"PS",prefix:"970"},{iso2:"PA",prefix:"507"},{iso2:"PG",prefix:"675"},{iso2:"PY",prefix:"595"},{iso2:"PE",prefix:"51"},{iso2:"PH",prefix:"63"},{iso2:"PN",prefix:"870"},{iso2:"PL",prefix:"48"},{iso2:"PT",prefix:"351"},{iso2:"PR",prefix:"1"},{iso2:"QA",prefix:"974"},{iso2:"RO",prefix:"40"},{iso2:"RU",prefix:"7"},{iso2:"RW",prefix:"250"},{iso2:"RE",prefix:"262"},{iso2:"WS",prefix:"685"},{iso2:"SM",prefix:"378"},{iso2:"SA",prefix:"966"},{iso2:"SN",prefix:"221"},{iso2:"RS",prefix:"381 p"},{iso2:"SC",prefix:"248"},{iso2:"SL",prefix:"232"},{iso2:"SG",prefix:"65"},{iso2:"SX",prefix:"1"},{iso2:"SK",prefix:"421"},{iso2:"SI",prefix:"386"},{iso2:"SB",prefix:"677"},{iso2:"SO",prefix:"252"},{iso2:"ZA",prefix:"27"},{iso2:"GS",prefix:"500"},{iso2:"KR",prefix:"82"},{iso2:"SS",prefix:"211"},{iso2:"ES",prefix:"34"},{iso2:"LK",prefix:"94"},{iso2:"BL",prefix:"590"},{iso2:"SH",prefix:"290 n"},{iso2:"KN",prefix:"1"},{iso2:"LC",prefix:"1"},{iso2:"MF",prefix:"590"},{iso2:"PM",prefix:"508"},{iso2:"VC",prefix:"1"},{iso2:"SD",prefix:"249"},{iso2:"SR",prefix:"597"},{iso2:"SJ",prefix:"47"},{iso2:"SZ",prefix:"268"},{iso2:"SE",prefix:"46"},{iso2:"CH",prefix:"41"},{iso2:"SY",prefix:"963"},{iso2:"ST",prefix:"239"},{iso2:"TW",prefix:"886"},{iso2:"TJ",prefix:"992"},{iso2:"TZ",prefix:"255"},{iso2:"TH",prefix:"66"},{iso2:"TL",prefix:"670"},{iso2:"TG",prefix:"228"},{iso2:"TK",prefix:"690"},{iso2:"TO",prefix:"676"},{iso2:"TT",prefix:"1"},{iso2:"TN",prefix:"216"},{iso2:"TR",prefix:"90"},{iso2:"TM",prefix:"993"},{iso2:"TC",prefix:"1"},{iso2:"TV",prefix:"688"},{iso2:"VI",prefix:"1"},{iso2:"UG",prefix:"256"},{iso2:"UA",prefix:"380"},{iso2:"AE",prefix:"971"},{iso2:"UY",prefix:"598"},{iso2:"UZ",prefix:"998"},{iso2:"VU",prefix:"678"},{iso2:"VA",prefix:"39"},{iso2:"VE",prefix:"58"},{iso2:"VN",prefix:"84"},{iso2:"WF",prefix:"681"},{iso2:"EH",prefix:"212"},{iso2:"YE",prefix:"967"},{iso2:"ZM",prefix:"260"},{iso2:"ZW",prefix:"263"}];class Lf extends o.PureComponent{constructor(...e){super(...e),(0,r.A)(this,"validate",(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)(this.props.labelRequired)},{key:"email",test:({value:e})=>!e||lg.X(e),invalid:()=>(0,C._t)(this.props.labelInvalid)}]})),(0,r.A)(this,"onValidate",(async e=>{let t=this.validate;this.props.validationRules&&(t=this.props.validationRules);const n=await t(e);return this.props.onValidate&&this.props.onValidate(n),n}))}render(){return o.createElement(tn.A,{id:this.props.id,ref:this.props.fieldRef,type:"text",label:(0,C._t)(this.props.label),value:this.props.value,autoFocus:this.props.autoFocus,onChange:this.props.onChange,onValidate:this.onValidate})}}(0,r.A)(Lf,"defaultProps",{label:(0,C.AO)("auth|email_field_label"),labelRequired:(0,C.AO)("auth|email_field_label_required"),labelInvalid:(0,C.AO)("auth|email_field_label_invalid")});const Uf=Lf,Ff=({onFinished:e})=>{const[t,n]=(0,o.useState)(""),i=(0,o.useRef)(null),r=async n=>{if(n.preventDefault(),i.current){if(t){if(!await i.current.validate({}))return i.current.focus(),void i.current.validate({focused:!0})}e(!0,t)}};return o.createElement(cn.A,{title:(0,C._t)("auth|registration|continue_without_email_title"),className:"mx_RegistrationEmailPromptDialog",contentId:"mx_RegistrationEmailPromptDialog",onFinished:()=>e(!1),fixedWidth:!1},o.createElement("div",{className:"mx_Dialog_content",id:"mx_RegistrationEmailPromptDialog"},o.createElement("p",null,(0,C._t)("auth|registration|continue_without_email_description",{},{b:e=>o.createElement("b",null,e)})),o.createElement("form",{onSubmit:r},o.createElement(Uf,{fieldRef:i,autoFocus:!0,label:(0,C.AO)("auth|registration|continue_without_email_field_label"),value:t,onChange:e=>{const t=e.target;n(t.value)}}))),o.createElement(un.A,{primaryButton:(0,C._t)("action|continue"),onPrimaryButtonClick:r,hasCancel:!1}))};function jf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}class Bf extends o.Component{constructor(e){var t;super(e),(0,r.A)(this,"defaultCountry",void 0),(0,r.A)(this,"countries",void 0),(0,r.A)(this,"countryMap",void 0),(0,r.A)(this,"onSearchChange",(e=>{this.setState({searchQuery:e})})),(0,r.A)(this,"onOptionChange",(e=>{this.props.onOptionChange(this.countryMap.get(e))})),(0,r.A)(this,"getShortOption",(e=>{if(!this.props.isSmall)return;let t;return this.props.showPrefix&&(t="+"+this.countryMap.get(e).prefix),o.createElement("span",{className:"mx_CountryDropdown_shortOption"},this.flagImgForIso2(e),t)}));const n=new Intl.DisplayNames([(0,C.mf)()],{type:"region"});let i;this.countries=Of.map((e=>{var t;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jf(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({name:null!==(t=n.of(e.iso2))&&void 0!==t?t:e.iso2},e)})),this.countryMap=new Map(this.countries.map((e=>[e.iso2,e])));const s=g.Ay.get("default_country_code");if(s){const e=this.countries.find((e=>e.iso2===s.toUpperCase()));e&&(i=e)}if(!i)try{var a,l,c;const e=new Intl.Locale(null!==(a=navigator.language)&&void 0!==a?a:navigator.languages[0]),t=null!==(l=null!==(c=e.region)&&void 0!==c?c:e.language)&&void 0!==l?l:e.baseName,r=n.of(t).toUpperCase();i=this.countries.find((e=>e.iso2===t.toUpperCase()||e.name.toUpperCase()===r))}catch(e){console.warn("Failed to detect default locale",e)}this.defaultCountry=null!==(t=i)&&void 0!==t?t:this.countries[0],this.state={searchQuery:""}}componentDidMount(){this.props.value||this.props.onOptionChange(this.defaultCountry)}flagImgForIso2(e){return o.createElement("div",{className:"mx_Dropdown_option_emoji"},(t=e,Mf.test(t)?String.fromCodePoint(...t.split("").map((e=>Df+e.charCodeAt(0)))):""));var t}render(){let e;if(this.state.searchQuery){if(e=this.countries.filter((e=>function(e,t){return"+"===e[0]&&(e=e.slice(1)),0==t.name.toUpperCase().indexOf(e.toUpperCase())||t.iso2==e.toUpperCase()||-1!==t.prefix.indexOf(e)}(this.state.searchQuery,e))),2==this.state.searchQuery.length&&this.countryMap.has(this.state.searchQuery.toUpperCase())){const t=this.countryMap.get(this.state.searchQuery.toUpperCase());e=e.filter((e=>e.iso2!=t.iso2)),e.unshift(t)}}else e=this.countries;const t=e.map((e=>o.createElement("div",{className:"mx_CountryDropdown_option",key:e.iso2},this.flagImgForIso2(e.iso2),e.name," (+",e.prefix,")"))),n=this.props.value||this.defaultCountry.iso2;return o.createElement(Ut.A,{id:"mx_CountryDropdown",className:this.props.className+" mx_CountryDropdown",onOptionChange:this.onOptionChange,onSearchChange:this.onSearchChange,menuWidth:298,getShortOption:this.getShortOption,value:n,searchEnabled:!0,disabled:this.props.disabled,label:(0,C._t)("auth|country_dropdown"),autoComplete:"tel-country-code"},t)}}var Vf=n("./node_modules/matrix-react-sdk/src/components/views/auth/PassphraseConfirmField.tsx"),Hf=n("./node_modules/matrix-react-sdk/src/PosthogAnalytics.ts");let zf,Wf,Gf,Kf,Jf;var qf=function(e){return e.Email="field_email",e.PhoneNumber="field_phone_number",e.Username="field_username",e.Password="field_password",e.PasswordConfirm="field_password_confirm",e}(qf||{}),$f=function(e){return e[e.Unknown=0]="Unknown",e[e.Available=1]="Available",e[e.Unavailable=2]="Unavailable",e[e.Error=3]="Error",e[e.Invalid=4]="Invalid",e}($f||{});zf=qf.Email,Wf=qf.Password,Gf=qf.PasswordConfirm,Kf=qf.Username,Jf=qf.PhoneNumber;class Yf extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,zf,null),(0,r.A)(this,Wf,null),(0,r.A)(this,Gf,null),(0,r.A)(this,Kf,null),(0,r.A)(this,Jf,null),(0,r.A)(this,"onSubmit",(async e=>{if(e.preventDefault(),e.persist(),!this.props.canSubmit)return;if(await this.verifyFieldsBeforeSubmit())if(""===this.state.email){if(!this.showEmail())return void this.doSubmit(e);f.Ay.createDialog(Ff,{onFinished:async(t,n)=>{t&&void 0!==n&&this.setState({email:n},(()=>{this.doSubmit(e)}))}})}else this.doSubmit(e)})),(0,r.A)(this,"onEmailChange",(e=>{this.setState({email:e.target.value.trim()})})),(0,r.A)(this,"onEmailValidate",(e=>{this.markFieldValid(qf.Email,!!e.valid)})),(0,r.A)(this,"validateEmailRules",(0,As.A)({description:()=>(0,C._t)("auth|reset_password_email_field_description"),hideDescriptionIfValid:!0,rules:[{key:"required",test({value:e,allowEmpty:t}){return t||!this.authStepIsRequired("m.login.email.identity")||!!e},invalid:()=>(0,C._t)("auth|reset_password_email_field_required_invalid")},{key:"email",test:({value:e})=>!e||lg.X(e),invalid:()=>(0,C._t)("auth|email_field_label_invalid")}]})),(0,r.A)(this,"onPasswordChange",(e=>{this.setState({password:e.target.value})})),(0,r.A)(this,"onPasswordValidate",(e=>{this.markFieldValid(qf.Password,!!e.valid)})),(0,r.A)(this,"onPasswordConfirmChange",(e=>{this.setState({passwordConfirm:e.target.value})})),(0,r.A)(this,"onPasswordConfirmValidate",(e=>{this.markFieldValid(qf.PasswordConfirm,!!e.valid)})),(0,r.A)(this,"onPhoneCountryChange",(e=>{this.setState({phoneCountry:e.iso2})})),(0,r.A)(this,"onPhoneNumberChange",(e=>{this.setState({phoneNumber:e.target.value})})),(0,r.A)(this,"onPhoneNumberValidate",(async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(qf.PhoneNumber,!!t.valid),t})),(0,r.A)(this,"validatePhoneNumberRules",(0,As.A)({description:()=>(0,C._t)("auth|msisdn_field_description"),hideDescriptionIfValid:!0,rules:[{key:"required",test({value:e,allowEmpty:t}){return t||!this.authStepIsRequired("m.login.msisdn")||!!e},invalid:()=>(0,C._t)("auth|registration_msisdn_field_required_invalid")},{key:"email",test:({value:e})=>{return!e||(t=e,Nf.test(t));var t},invalid:()=>(0,C._t)("auth|msisdn_field_number_invalid")}]})),(0,r.A)(this,"onUsernameChange",(e=>{this.setState({username:e.target.value})})),(0,r.A)(this,"onUsernameValidate",(async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(qf.Username,!!t.valid),t})),(0,r.A)(this,"validateUsernameRules",(0,As.A)({description:(e,t)=>t.every((({key:e,valid:t})=>"available"===e||t))?null:(0,C._t)("auth|registration_username_validation"),hideDescriptionIfValid:!0,async deriveData({value:e}){if(!e)return $f.Unknown;try{return await this.props.matrixClient.isUsernameAvailable(e)?$f.Available:$f.Unavailable}catch(e){return e instanceof s.MatrixError&&"M_INVALID_USERNAME"===e.errcode?$f.Invalid:$f.Error}},rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|username_field_required_invalid")},{key:"safeLocalpart",test:({value:e},t)=>(!e||G.test(e))&&t!==$f.Invalid,invalid:()=>(0,C._t)("room_settings|general|alias_field_safe_localpart_invalid")},{key:"available",final:!0,test:async({value:e},t)=>!e||t===$f.Available,invalid:e=>e===$f.Error?(0,C._t)("auth|registration_username_unable_check"):(0,C._t)("auth|registration_username_in_use")}]})),this.state={fieldValid:{},phoneCountry:this.props.defaultPhoneCountry,username:this.props.defaultUsername||"",email:this.props.defaultEmail||"",phoneNumber:this.props.defaultPhoneNumber||"",password:this.props.defaultPassword||"",passwordConfirm:this.props.defaultPassword||""}}doSubmit(e){Hf.Vo.instance.setAuthenticationType("Password");const t=this.state.email.trim(),n=this.props.onRegisterClick({username:this.state.username.trim(),password:this.state.password.trim(),email:t,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber});n&&(e.target.disabled=!0,n.finally((function(){e.target.disabled=!1})))}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[qf.Username,qf.Password,qf.PasswordConfirm,qf.Email,qf.PhoneNumber];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise((e=>this.setState({},e))),this.allFieldsValid())return!0;const n=this.findFirstInvalidField(t);return!n||(n.focus(),n.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){return Object.values(this.state.fieldValid).every(Boolean)}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:n}=this.state;n[e]=t,this.setState({fieldValid:n})}authStepIsRequired(e){return this.props.flows.every((t=>t.stages.includes(e)))}authStepIsUsed(e){return this.props.flows.some((t=>t.stages.includes(e)))}showEmail(){return!(g.Ay.get().disable_3pid_login||!this.authStepIsUsed("m.login.email.identity"))}showPhoneNumber(){return!(g.Ay.get().disable_3pid_login||!this.authStepIsUsed("m.login.msisdn"))}renderEmail(){if(!this.showEmail())return null;const e=this.authStepIsRequired("m.login.email.identity")?(0,C.AO)("auth|email_field_label"):(0,C.AO)("auth|registration|continue_without_email_field_label");return o.createElement(Uf,{fieldRef:e=>this[qf.Email]=e,label:e,value:this.state.email,validationRules:this.validateEmailRules.bind(this),onChange:this.onEmailChange,onValidate:this.onEmailValidate})}renderPassword(){return o.createElement(Pf.A,{id:"mx_RegistrationForm_password",fieldRef:e=>this[qf.Password]=e,minScore:3,value:this.state.password,onChange:this.onPasswordChange,onValidate:this.onPasswordValidate,userInputs:[this.state.username]})}renderPasswordConfirm(){return o.createElement(Vf.A,{id:"mx_RegistrationForm_passwordConfirm",fieldRef:e=>this[qf.PasswordConfirm]=e,autoComplete:"new-password",value:this.state.passwordConfirm,password:this.state.password,onChange:this.onPasswordConfirmChange,onValidate:this.onPasswordConfirmValidate})}renderPhoneNumber(){if(!this.showPhoneNumber())return null;const e=this.authStepIsRequired("m.login.msisdn")?(0,C._t)("auth|phone_label"):(0,C._t)("auth|phone_optional_label"),t=o.createElement(Bf,{value:this.state.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChange});return o.createElement(tn.A,{ref:e=>this[qf.PhoneNumber]=e,type:"text",label:e,value:this.state.phoneNumber,prefixComponent:t,onChange:this.onPhoneNumberChange,onValidate:this.onPhoneNumberValidate})}renderUsername(){return o.createElement(tn.A,{id:"mx_RegistrationForm_username",ref:e=>this[qf.Username]=e,type:"text",autoFocus:!0,label:(0,C._t)("common|username"),placeholder:(0,C._t)("common|username"),value:this.state.username,onChange:this.onUsernameChange,onValidate:this.onUsernameValidate})}render(){const e=o.createElement("input",{className:"mx_Login_submit",type:"submit",value:(0,C._t)("action|register"),disabled:!this.props.canSubmit});let t;return this.showEmail()&&(t=this.showPhoneNumber()?o.createElement("div",null,(0,C._t)("auth|email_help_text")," ",(0,C._t)("auth|email_phone_discovery_text")):o.createElement("div",null,(0,C._t)("auth|email_help_text")," ",(0,C._t)("auth|email_discovery_text"))),o.createElement("div",null,o.createElement("form",{onSubmit:this.onSubmit},o.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderUsername()),o.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderPassword(),this.renderPasswordConfirm()),o.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderEmail(),this.renderPhoneNumber()),t,e))}}(0,r.A)(Yf,"defaultProps",{onValidationChange:l.v.error,canSubmit:!0});var Qf=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/InteractiveAuthDialog.tsx");function Zf(e){const t=e.getIdentityServerUrl(!0);if(!t)throw new C.P7("settings|general|identity_server_not_set");return t}class Xf{constructor(e){(0,r.A)(this,"sessionId",void 0),(0,r.A)(this,"submitUrl",void 0),(0,r.A)(this,"bind",!1),(0,r.A)(this,"clientSecret",void 0),(0,r.A)(this,"makeAddThreepidOnlyRequest",(e=>this.matrixClient.addThreePidOnly({sid:this.sessionId,client_secret:this.clientSecret,auth:null!=e?e:void 0}))),this.matrixClient=e,this.clientSecret=e.generateClientSecret()}async addEmailAddress(e){try{const t=await this.matrixClient.requestAdd3pidEmailToken(e,this.clientSecret,1);return this.sessionId=t.sid,t}catch(e){if(e instanceof s.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new C.P7("settings|general|email_address_in_use",{cause:e});throw e}}async bindEmailAddress(e){var t;this.bind=!0;const n=new Tm.A,i=null!==(t=await n.getAccessToken())&&void 0!==t?t:void 0;try{const t=await this.matrixClient.requestEmailToken(e,this.clientSecret,1,void 0,i);return this.sessionId=t.sid,t}catch(e){if(e instanceof s.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new C.P7("settings|general|email_address_in_use",{cause:e});throw e}}async addMsisdn(e,t){try{const n=await this.matrixClient.requestAdd3pidMsisdnToken(e,t,this.clientSecret,1);return this.sessionId=n.sid,this.submitUrl=n.submit_url,n}catch(e){if(e instanceof s.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new C.P7("settings|general|msisdn_in_use",{cause:e});throw e}}async bindMsisdn(e,t){var n;this.bind=!0;const i=new Tm.A,r=null!==(n=await i.getAccessToken())&&void 0!==n?n:void 0;try{const n=await this.matrixClient.requestMsisdnToken(e,t,this.clientSecret,1,void 0,r);return this.sessionId=n.sid,n}catch(e){if(e instanceof s.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new C.P7("settings|general|msisdn_in_use",{cause:e});throw e}}async checkEmailLinkClicked(){try{if(this.bind){const e=new Tm.A,t=await e.getAccessToken();if(!t)throw new C.P7("settings|general|identity_server_no_token");await this.matrixClient.bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:Zf(this.matrixClient),id_access_token:t})}else try{return await this.makeAddThreepidOnlyRequest(),[!0]}catch(e){if(!(e instanceof s.MatrixError&&401===e.httpStatus&&e.data&&e.data.flows))throw e;const t={[If.av.PHASE_PREAUTH]:{title:(0,C._t)("auth|uia|sso_title"),body:(0,C._t)("auth|uia|sso_body"),continueText:(0,C._t)("auth|sso"),continueKind:"primary"},[If.av.PHASE_POSTAUTH]:{title:(0,C._t)("settings|general|confirm_adding_email_title"),body:(0,C._t)("settings|general|confirm_adding_email_body"),continueText:(0,C._t)("action|confirm"),continueKind:"primary"}},{finished:n}=f.Ay.createDialog(Qf.A,{title:(0,C._t)("settings|general|add_email_dialog_title"),matrixClient:this.matrixClient,authData:e.data,makeRequest:this.makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[If.av.LOGIN_TYPE]:t,[If.av.UNSTABLE_LOGIN_TYPE]:t}});return n}}catch(e){if(e instanceof s.HTTPError&&401===e.httpStatus)throw new C.P7("settings|general|add_email_failed_verification",{cause:e});throw e}return[]}async haveMsisdnToken(e){const t=new Tm.A;if(this.submitUrl)await this.matrixClient.submitMsisdnTokenOtherUrl(this.submitUrl,this.sessionId,this.clientSecret,e);else{if(!this.bind)throw new C.P7("settings|general|add_msisdn_misconfigured");await this.matrixClient.submitMsisdnToken(this.sessionId,this.clientSecret,e,await t.getAccessToken())}if(this.bind)return await this.matrixClient.bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:Zf(this.matrixClient),id_access_token:await t.getAccessToken()}),[!0];try{return await this.makeAddThreepidOnlyRequest(),[!0]}catch(e){if(!(e instanceof s.MatrixError&&401===e.httpStatus&&e.data&&e.data.flows))throw e;const t={[If.av.PHASE_PREAUTH]:{title:(0,C._t)("auth|uia|sso_title"),body:(0,C._t)("settings|general|add_msisdn_confirm_sso_button"),continueText:(0,C._t)("auth|sso"),continueKind:"primary"},[If.av.PHASE_POSTAUTH]:{title:(0,C._t)("settings|general|add_msisdn_confirm_button"),body:(0,C._t)("settings|general|add_msisdn_confirm_body"),continueText:(0,C._t)("action|confirm"),continueKind:"primary"}},{finished:n}=f.Ay.createDialog(Qf.A,{title:(0,C._t)("settings|general|add_msisdn_dialog_title"),matrixClient:this.matrixClient,authData:e.data,makeRequest:this.makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[If.av.LOGIN_TYPE]:t,[If.av.UNSTABLE_LOGIN_TYPE]:t}});return n}}}var ey=function(e){return e.Display="display",e.Edit="edit",e}(ey||{});class ty extends o.Component{constructor(e){super(e),(0,r.A)(this,"value",""),(0,r.A)(this,"placeholder",!1),(0,r.A)(this,"editableDiv",(0,o.createRef)()),(0,r.A)(this,"showPlaceholder",(e=>{this.editableDiv.current&&(e?(this.editableDiv.current.textContent=this.props.placeholder,this.editableDiv.current.setAttribute("class",this.props.className+" "+this.props.placeholderClassName),this.placeholder=!0,this.value=""):(this.editableDiv.current.textContent=this.value,this.editableDiv.current.setAttribute("class",this.props.className),this.placeholder=!1))})),(0,r.A)(this,"cancelEdit",(()=>{var e;this.setState({phase:ey.Display}),this.value=this.props.initialValue,this.showPlaceholder(!this.value),this.onValueChanged(!1),null===(e=this.editableDiv.current)||void 0===e||e.blur()})),(0,r.A)(this,"onValueChanged",(e=>{var t,n;null===(t=(n=this.props).onValueChanged)||void 0===t||t.call(n,this.value,e)})),(0,r.A)(this,"onKeyDown",(e=>{this.placeholder&&this.showPlaceholder(!1);if((0,Se.zM)().getAccessibilityAction(e)===Ee.bY.Enter)e.stopPropagation(),e.preventDefault()})),(0,r.A)(this,"onKeyUp",(e=>{if(e.target.textContent){if(!this.placeholder){var t;this.value=null!==(t=e.target.textContent)&&void 0!==t?t:""}}else this.showPlaceholder(!0);switch((0,Se.zM)().getAccessibilityAction(e)){case Ee.bY.Escape:this.cancelEdit();break;case Ee.bY.Enter:this.onFinish(e)}})),(0,r.A)(this,"onClickDiv",(()=>{this.props.editable&&this.setState({phase:ey.Edit})})),(0,r.A)(this,"onFocus",(e=>{const t=e.target.childNodes[0];if(t){const n=document.createRange();n.setStart(t,0),n.setEnd(t,e.target.childNodes.length);const i=window.getSelection();i.removeAllRanges(),i.addRange(n)}})),(0,r.A)(this,"onFinish",((e,t=!1)=>{const n=this,i=(0,Se.zM)().getAccessibilityAction(e)===Ee.bY.Enter||t;this.setState({phase:ey.Display},(()=>{this.value!==this.props.initialValue&&n.onValueChanged(i)}))})),(0,r.A)(this,"onBlur",(e=>{window.getSelection().removeAllRanges(),this.props.blurToCancel?this.cancelEdit():this.onFinish(e,this.props.blurToSubmit),this.showPlaceholder(!this.value)})),this.state={phase:ey.Display}}componentDidUpdate(e){e.initialValue!==this.props.initialValue&&(this.value=this.props.initialValue,this.editableDiv.current&&this.showPlaceholder(!this.value))}componentDidMount(){this.value=this.props.initialValue,this.editableDiv.current&&this.showPlaceholder(!this.value)}render(){const{className:e,editable:t,initialValue:n,label:i,labelClassName:r}=this.props;let s;return s=!t||this.state.phase===ey.Display&&(i||r)&&!this.value?o.createElement("div",{className:e+" "+r,onClick:this.onClickDiv},i||n):o.createElement("div",{ref:this.editableDiv,contentEditable:!0,className:e,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onFocus:this.onFocus,onBlur:this.onBlur}),s}}(0,r.A)(ty,"defaultProps",{onValueChanged(){},initialValue:"",label:"",placeholder:"",editable:!0,className:"mx_EditableText",placeholderClassName:"mx_EditableText_placeholder",blurToSubmit:!1});class ny extends o.Component{constructor(e){super(e),(0,r.A)(this,"addThreepid",void 0),(0,r.A)(this,"onEmailAddressChanged",(e=>{this.setState({emailAddress:e})})),(0,r.A)(this,"onSubmit",(()=>{const e=this.state.emailAddress;lg.X(e)?(this.addThreepid=new Xf(h.J.safeGet()),this.addThreepid.addEmailAddress(e).then((()=>{f.Ay.createDialog(z.A,{title:(0,C._t)("auth|set_email|verification_pending_title"),description:(0,C._t)("auth|set_email|verification_pending_description"),button:(0,C._t)("action|continue"),onFinished:this.onEmailDialogFinished})}),(t=>{this.setState({emailBusy:!1}),l.v.error("Unable to add email address "+e+" "+t),f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_add_email"),description:(0,lc.$)(t,(0,C._t)("invite|failed_generic"))})})),this.setState({emailBusy:!0})):f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_invalid_email"),description:(0,C._t)("settings|general|error_invalid_email_detail")})})),(0,r.A)(this,"onCancelled",(()=>{this.props.onFinished(!1)})),(0,r.A)(this,"onEmailDialogFinished",(e=>{e?this.verifyEmailAddress():this.setState({emailBusy:!1})})),this.state={emailAddress:"",emailBusy:!1}}verifyEmailAddress(){var e;null===(e=this.addThreepid)||void 0===e||e.checkEmailLinkClicked().then((()=>{this.props.onFinished(!0)}),(e=>{this.setState({emailBusy:!1});let t=e;if(e instanceof C.P7&&(t=e.cause),t instanceof s.MatrixError&&"M_THREEPID_AUTH_FAILED"===t.errcode){const e=(0,C._t)("settings|general|error_email_verification")+" "+(0,C._t)("auth|set_email|verification_pending_description");f.Ay.createDialog(z.A,{title:(0,C._t)("auth|set_email|verification_pending_title"),description:e,button:(0,C._t)("action|continue"),onFinished:this.onEmailDialogFinished})}else l.v.error("Unable to verify email address: "+e),f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_email_verification"),description:(0,lc.$)(e,(0,C._t)("invite|failed_generic"))})}))}render(){const e=this.state.emailBusy?o.createElement(dn.A,null):o.createElement(ty,{initialValue:this.state.emailAddress,className:"mx_SetEmailDialog_email_input",placeholder:(0,C._t)("common|email_address"),placeholderClassName:"mx_SetEmailDialog_email_input_placeholder",blurToCancel:!1,onValueChanged:this.onEmailAddressChanged});return o.createElement(cn.A,{className:"mx_SetEmailDialog",onFinished:this.onCancelled,title:this.props.title,contentId:"mx_Dialog_content"},o.createElement("div",{className:"mx_Dialog_content"},o.createElement("p",{id:"mx_Dialog_content"},(0,C._t)("auth|set_email|description")),e),o.createElement("div",{className:"mx_Dialog_buttons"},o.createElement("input",{className:"mx_Dialog_primary",type:"submit",value:(0,C._t)("action|continue"),onClick:this.onSubmit}),o.createElement("input",{type:"submit",value:(0,C._t)("action|skip"),onClick:this.onCancelled})))}}const iy="field_old_password",ry="field_new_password",oy="field_new_password_confirm";var sy=function(e){return e.Edit="edit",e.Uploading="uploading",e.Error="error",e}(sy||{});class ay extends o.Component{constructor(e){super(e),(0,r.A)(this,iy,null),(0,r.A)(this,ry,null),(0,r.A)(this,oy,null),(0,r.A)(this,"onChangeOldPassword",(e=>{this.setState({oldPassword:e.target.value})})),(0,r.A)(this,"onOldPasswordValidate",(async e=>{const t=await this.validateOldPasswordRules(e);return this.markFieldValid(iy,t.valid),t})),(0,r.A)(this,"validateOldPasswordRules",(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|change_password_empty")}]})),(0,r.A)(this,"onChangeNewPassword",(e=>{this.setState({newPassword:e.target.value})})),(0,r.A)(this,"onNewPasswordValidate",(e=>{this.markFieldValid(ry,e.valid)})),(0,r.A)(this,"onChangeNewPasswordConfirm",(e=>{this.setState({newPasswordConfirm:e.target.value})})),(0,r.A)(this,"onNewPasswordConfirmValidate",(async e=>{const t=await this.validatePasswordConfirmRules(e);return this.markFieldValid(oy,t.valid),t})),(0,r.A)(this,"validatePasswordConfirmRules",(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|change_password_confirm_label")},{key:"match",test({value:e}){return!e||e===this.state.newPassword},invalid:()=>(0,C._t)("auth|change_password_confirm_invalid")}]})),(0,r.A)(this,"onClickChange",(async e=>{e.preventDefault();if(!await this.verifyFieldsBeforeSubmit())return;const t=this.state.oldPassword,n=this.state.newPassword,i=this.state.newPasswordConfirm;try{return this.checkPassword(t,n,i),this.onChangePassword(t,n)}catch(e){e instanceof Error?this.props.onError(e):this.props.onError(new C.P7("auth|change_password_error",{error:String(e),cause:void 0}))}})),this.state={fieldValid:{},phase:sy.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""}}async onChangePassword(e,t){const n=h.J.safeGet();this.changePassword(n,e,t)}changePassword(e,t,n){const i={type:"m.login.password",identifier:{type:"m.id.user",user:e.credentials.userId},password:t};this.setState({phase:sy.Uploading}),e.setPassword(i,n,!1).then((()=>{if(this.props.shouldAskForEmail)return this.optionallySetEmail().then((e=>{this.props.onFinished({didSetEmail:e})}));this.props.onFinished({})}),(e=>{e instanceof Error?this.props.onError(e):this.props.onError(new C.P7("auth|change_password_error",{error:String(e),cause:void 0}))})).finally((()=>{this.setState({phase:sy.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""})}))}checkPassword(e,t,n){if(t!==n)throw new C.P7("auth|change_password_mismatch");if(!t||0===t.length)throw new C.P7("auth|change_password_empty")}optionallySetEmail(){return f.Ay.createDialog(ny,{title:(0,C._t)("auth|set_email_prompt")}).finished.then((([e])=>!!e))}markFieldValid(e,t){const{fieldValid:n}=this.state;n[e]=t,this.setState({fieldValid:n})}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[iy,ry,oy];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise((e=>this.setState({},e))),this.allFieldsValid())return!0;const n=this.findFirstInvalidField(t);return!n||(n.focus(),n.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){return Object.values(this.state.fieldValid).every(Boolean)}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}render(){const e=this.props.rowClassName,t=this.props.buttonClassName;switch(this.state.phase){case sy.Edit:return o.createElement("form",{className:this.props.className,onSubmit:this.onClickChange},o.createElement("div",{className:e},o.createElement(tn.A,{ref:e=>this[iy]=e,type:"password",label:(0,C._t)("auth|change_password_current_label"),value:this.state.oldPassword,onChange:this.onChangeOldPassword,onValidate:this.onOldPasswordValidate})),o.createElement("div",{className:e},o.createElement(Pf.A,{fieldRef:e=>this[ry]=e,type:"password",label:(0,C.AO)("auth|change_password_new_label"),minScore:3,value:this.state.newPassword,autoFocus:this.props.autoFocusNewPasswordInput,onChange:this.onChangeNewPassword,onValidate:this.onNewPasswordValidate,autoComplete:"new-password"})),o.createElement("div",{className:e},o.createElement(tn.A,{ref:e=>this[oy]=e,type:"password",label:(0,C._t)("auth|change_password_confirm_label"),value:this.state.newPasswordConfirm,onChange:this.onChangeNewPasswordConfirm,onValidate:this.onNewPasswordConfirmValidate,autoComplete:"new-password"})),o.createElement(be.A,{className:t,kind:this.props.buttonKind,onClick:this.onClickChange},this.props.buttonLabel||(0,C._t)("auth|change_password_action")));case sy.Uploading:return o.createElement("div",{className:"mx_Dialog_content"},o.createElement(dn.A,null))}}}(0,r.A)(ay,"defaultProps",{onFinished(){},onError(){},confirm:!0});const ly=({mode:e,threepid:t,onChange:n,disabled:i})=>{const[r,a]=(0,o.useState)(!1),c=(0,Re.nH)(),d=(0,o.useRef)(),[u,m]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!1),[g,v]=(0,o.useState)(""),_=(0,o.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a(!0)}),[]),y=(0,o.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a(!1)}),[]),E=(0,o.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),c.deleteThreePid(t.medium,t.address).then((()=>n(t))).catch((e=>{l.v.error("Unable to remove contact information: "+e),f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_remove_3pid"),description:e&&e.message?e.message:(0,C._t)("invite|failed_generic")})}))}),[c,t,n]),b=(0,o.useCallback)((async({bind:e,label:i,errorTitle:r})=>{try{e?(d.current=new Xf(c),p(!0),t.medium===s.ThreepidMedium.Email?await d.current.bindEmailAddress(t.address):await d.current.bindMsisdn(null,`+${t.address}`),p(!1),m(!0)):(await c.unbindThreePid(t.medium,t.address),n(t))}catch(e){l.v.error(`changeBinding: Unable to ${i} email address ${t.address}`,e),m(!1),p(!1),d.current=void 0,f.Ay.createDialog(lc.A,{title:r,description:(0,lc.$)(e,(0,C._t)("invite|failed_generic"))})}}),[c,t,n]),w=(0,o.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),b({bind:!1,label:"revoke",errorTitle:"email"===t.medium?(0,C._t)("settings|general|error_revoke_email_discovery"):(0,C._t)("settings|general|error_revoke_msisdn_discovery")}).then()}),[b,t.medium]),x=(0,o.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),b({bind:!0,label:"share",errorTitle:"email"===t.medium?(0,C._t)("settings|general|error_share_email_discovery"):(0,C._t)("settings|general|error_share_msisdn_discovery")}).then()}),[b,t.medium]),A=(0,o.useCallback)((async e=>{e.stopPropagation(),e.preventDefault(),p(!0);try{var i,r;if(t.medium===s.ThreepidMedium.Email)await(null===(i=d.current)||void 0===i?void 0:i.checkEmailLinkClicked());else await(null===(r=d.current)||void 0===r?void 0:r.haveMsisdnToken(g));m(!1),n(t),d.current=void 0}catch(e){l.v.error("Unable to verify threepid:",e);let n=e;e instanceof C.P7&&(n=e.cause),n instanceof s.MatrixError&&"M_THREEPID_AUTH_FAILED"===n.errcode?f.Ay.createDialog(lc.A,{title:"email"===t.medium?(0,C._t)("settings|general|email_not_verified"):(0,C._t)("settings|general|error_msisdn_verification"),description:"email"===t.medium?(0,C._t)("settings|general|email_verification_instructions"):(0,lc.$)(e,(0,C._t)("invite|failed_generic"))}):(l.v.error("Unable to verify email address: "+e),f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_email_verification"),description:(0,lc.$)(e,(0,C._t)("invite|failed_generic"))}))}finally{p(!1)}}),[g,n,t]),S=(0,o.useCallback)((e=>{v(e.target.value)}),[]);return r?o.createElement("div",{className:"mx_AddRemoveThreepids_existing"},o.createElement("span",{className:"mx_AddRemoveThreepids_existing_promptText"},t.medium===s.ThreepidMedium.Email?(0,C._t)("settings|general|remove_email_prompt",{email:t.address}):(0,C._t)("settings|general|remove_msisdn_prompt",{phone:t.address})),o.createElement(be.A,{onClick:E,kind:"danger_sm",className:"mx_AddRemoveThreepids_existing_button"},(0,C._t)("action|remove")),o.createElement(be.A,{onClick:y,kind:"link_sm",className:"mx_AddRemoveThreepids_existing_button"},(0,C._t)("action|cancel"))):u?t.medium===s.ThreepidMedium.Email?o.createElement("div",{className:"mx_EmailAddressesPhoneNumbers_verify"},o.createElement("span",{className:"mx_EmailAddressesPhoneNumbers_verify_instructions"},(0,C._t)("settings|general|discovery_email_verification_instructions")),o.createElement(be.A,{className:"mx_EmailAddressesPhoneNumbers_existing_button",kind:"primary_sm",onClick:A,disabled:h},(0,C._t)("action|complete"))):o.createElement("div",{className:"mx_EmailAddressesPhoneNumbers_verify"},o.createElement("span",{className:"mx_EmailAddressesPhoneNumbers_verify_instructions"},(0,C._t)("settings|general|msisdn_verification_instructions")),o.createElement("form",{onSubmit:A,autoComplete:"off",noValidate:!0},o.createElement(tn.A,{type:"text",label:(0,C._t)("settings|general|msisdn_verification_field_label"),autoComplete:"off",disabled:h,value:g,onChange:S}))):o.createElement("div",{className:"mx_AddRemoveThreepids_existing"},o.createElement("span",{className:"mx_AddRemoveThreepids_existing_address"},t.address),o.createElement(be.A,{onClick:"hs"===e?_:t.bound?w:x,kind:"hs"===e||t.bound?"danger_sm":"primary_sm",disabled:i},"hs"===e?(0,C._t)("action|remove"):t.bound?(0,C._t)("action|revoke"):(0,C._t)("action|share")))};const cy=({medium:e,disabled:t,onChange:n})=>{const i=(0,o.useRef)(),[r,a]=(0,o.useState)(""),[c,d]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[h,p]=(0,o.useState)(!1),[g,v]=(0,o.useState)(!1),[_,y]=(0,o.useState)(""),E=(0,Re.nH)(),b=(0,o.useCallback)((e=>{d(e.iso2)}),[]),w=(0,o.useCallback)((t=>{var r,o;if(t.stopPropagation(),t.preventDefault(),!i.current)return;v(!0);("email"===e?null===(r=i.current)||void 0===r?void 0:r.checkEmailLinkClicked():null===(o=i.current)||void 0===o?void 0:o.haveMsisdnToken(u)).then((([e])=>{e&&(i.current=void 0,p(!1),a(""),n()),v(!1)})).catch((t=>{l.v.error("Unable to verify 3pid: ",t),v(!1);let n=t;t instanceof C.P7&&(n=t.cause),n instanceof s.MatrixError&&"M_THREEPID_AUTH_FAILED"===n.errcode?f.Ay.createDialog(lc.A,{title:"email"===e?(0,C._t)("settings|general|email_not_verified"):(0,C._t)("settings|general|error_msisdn_verification"),description:(0,C._t)("settings|general|email_verification_instructions")}):f.Ay.createDialog(lc.A,{title:"email"==e?(0,C._t)("settings|general|error_email_verification"):(0,C._t)("settings|general|error_msisdn_verification"),description:(0,lc.$)(t,(0,C._t)("invite|failed_generic"))})}))}),[n,e,u]),x=(0,o.useCallback)((e=>{a(e.target.value)}),[]),A=(0,o.useCallback)((t=>{if(t.stopPropagation(),t.preventDefault(),!r)return;if("email"===e&&!(0,lg.X)(r))return void f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_invalid_email"),description:(0,C._t)("settings|general|error_invalid_email_detail")});i.current=new Xf(E),p(!0),v(!0);("email"===e?i.current.addEmailAddress(r):i.current.addMsisdn(c,r)).then((e=>{v(!1),function(e){return void 0!==e.msisdn}(e)&&y(e.msisdn)})).catch((t=>{l.v.error(`Unable to add threepid ${r}`,t),p(!1),v(!1),i.current=void 0,f.Ay.createDialog(lc.A,{title:"email"===e?(0,C._t)("settings|general|error_add_email"):(0,C._t)("common|error"),description:(0,lc.$)(t,(0,C._t)("invite|failed_generic"))})}))}),[E,c,r,e]),S=(0,o.useCallback)((e=>{m(e.target.value)}),[]);if(h&&"email"===e)return o.createElement("div",null,o.createElement("div",null,(0,C._t)("settings|general|add_email_instructions")),o.createElement(be.A,{onClick:w,kind:"primary",disabled:g},(0,C._t)("action|continue")));if(h)return o.createElement("div",null,o.createElement("div",null,(0,C._t)("settings|general|add_msisdn_instructions",{msisdn:_}),o.createElement("br",null)),o.createElement("form",{onSubmit:w,autoComplete:"off",noValidate:!0},o.createElement(tn.A,{type:"text",label:(0,C._t)("settings|general|msisdn_verification_field_label"),autoComplete:"off",disabled:t||g,value:u,onChange:S}),o.createElement(be.A,{onClick:w,kind:"primary",disabled:t||g||0===u.length},(0,C._t)("action|continue"))));const k="msisdn"===e?o.createElement(Bf,{onOptionChange:b,className:"mx_PhoneNumbers_country",value:c,disabled:h,isSmall:!0,showPrefix:!0}):void 0;return o.createElement("form",{onSubmit:A,autoComplete:"off",noValidate:!0},o.createElement(tn.A,{type:"text",label:"email"===e?(0,C._t)("settings|general|email_address_label"):(0,C._t)("settings|general|msisdn_label"),autoComplete:"email"===e?"email":"tel-national",disabled:t||h,value:r,onChange:x,prefixComponent:k}),o.createElement(be.A,{onClick:A,kind:"primary",disabled:t},(0,C._t)("action|add")))},dy=({mode:e,medium:t,threepids:n,disabled:i,onChange:r,isLoading:s})=>{if(s)return o.createElement(Ve.A,null);const a=n.map((t=>o.createElement(ly,{mode:e,threepid:t,onChange:r,key:t.address,disabled:i})));return o.createElement(o.Fragment,null,a,"hs"===e&&o.createElement(cy,{medium:t,disabled:i,onChange:r}))},uy=({error:e,loadingState:t,children:n})=>"loading"===t?o.createElement(Ve.A,null):"error"===t?o.createElement(ke.Fc,{type:"critical",title:(0,C._t)("common|error")},e):o.createElement(o.Fragment,null,n),my=({canMake3pidChanges:e})=>{const[t,n]=(0,o.useState)(),[i,r]=(0,o.useState)(),[a,l]=(0,o.useState)("loading"),c=(0,Re.nH)(),d=(0,o.useCallback)((async()=>{try{const e=await c.getThreePids();n(e.threepids.filter((e=>e.medium===s.ThreepidMedium.Email))),r(e.threepids.filter((e=>e.medium===s.ThreepidMedium.Phone))),l("loaded")}catch(e){l("error")}}),[c]);(0,o.useEffect)((()=>{d().then()}),[d]);const u=(0,o.useCallback)((()=>{d().then()}),[d]),m=(0,o.useCallback)((()=>{d().then()}),[d]);return O.A.getValue(W.f.ThirdPartyID)?o.createElement("div",null,o.createElement("h2",null,(0,C._t)("settings|general|personal_info")),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|emails_heading"),stretchContent:!0},o.createElement(uy,{error:(0,C._t)("settings|general|unable_to_load_emails"),loadingState:a},o.createElement(dy,{mode:"hs",medium:s.ThreepidMedium.Email,threepids:t,onChange:u,disabled:!e,isLoading:"loading"===a}))),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|msisdns_heading"),stretchContent:!0},o.createElement(uy,{error:(0,C._t)("settings|general|unable_to_load_msisdns"),loadingState:a},o.createElement(dy,{mode:"hs",medium:s.ThreepidMedium.Phone,threepids:i,onChange:m,disabled:!e,isLoading:"loading"===a})))):null},hy=({canChangePassword:e,onPasswordChangeError:t,onPasswordChanged:n})=>e?o.createElement(o.Fragment,null,o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|account_section"),stretchContent:!0},o.createElement(Tt.sS,null,(0,C._t)("settings|general|password_change_section")),o.createElement(ay,{rowClassName:"",buttonKind:"primary",onError:t,onFinished:n}))):o.createElement(o.Fragment,null),py=({onDeactivateClicked:e})=>o.createElement(It.X,{heading:(0,C._t)("settings|general|deactivate_section")},o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|account_management_section"),description:(0,C._t)("settings|general|deactivate_warning")},o.createElement(be.A,{onClick:e,kind:"danger"},(0,C._t)("settings|general|deactivate_section")))),gy=({closeSettingsFn:e})=>{const[t,n]=o.useState(),[i,r]=o.useState(!1),[a,c]=o.useState(!1),[d,u]=o.useState(!1),[m,h]=o.useState(!1),p=(0,Re.nH)(),g=(0,o.useContext)(Xt.A);(0,o.useEffect)((()=>{(async e=>{const t=null!==(e=await p.getCapabilities())&&void 0!==e?e:{},i=t["m.change_password"],o=!i||!1!==i.enabled;await g.oidcClientStore.readyPromise;const s=g.oidcClientStore.accountManagementEndpoint,a=!t["m.3pid_changes"]||!0===t["m.3pid_changes"].enabled,l=!t["m.set_displayname"]||!0===t["m.set_displayname"].enabled,d=!t["m.set_avatar_url"]||!0===t["m.set_avatar_url"].enabled;r(a),c(l),u(d),n(s),h(o)})()}),[p,g.oidcClientStore]);const v=(0,o.useCallback)((e=>{l.v.error("Failed to change password: "+e);let t=e;e instanceof C.P7&&e.cause instanceof Error&&(t=e.cause);const n=(0,lc.$)(e,(0,C._t)("settings|general|error_password_change_unknown",{stringifiedError:String(e)}));let i=n;t instanceof s.HTTPError&&403===t.httpStatus?i=(0,C._t)("settings|general|error_password_change_403"):t instanceof s.HTTPError&&(i=(0,C._t)("settings|general|error_password_change_http",{errorMessage:n,httpStatus:t.httpStatus})),f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|general|error_password_change_title"),description:i})}),[]),_=(0,o.useCallback)((()=>{const e=(0,C._t)("settings|general|password_change_success");f.Ay.createDialog(lc.A,{title:(0,C._t)("common|success"),description:e})}),[]),y=(0,o.useCallback)((()=>{f.Ay.createDialog(Tf,{onFinished:t=>{t&&e()}})}),[e]);let E;const b=Boolean(t);return O.A.getValue(W.f.Deactivate)&&!b&&(E=o.createElement(py,{onDeactivateClicked:y})),o.createElement(Rt.A,null,o.createElement(It.X,null,o.createElement(kf,{externalAccountManagementUrl:t,canSetDisplayName:a,canSetAvatar:d}),o.createElement(my,{canMake3pidChanges:i}),o.createElement(hy,{canChangePassword:m,onPasswordChanged:_,onPasswordChangeError:v})),E)};var vy=n("./node_modules/matrix-react-sdk/src/components/views/elements/SettingsFlag.tsx"),_y=n("./node_modules/matrix-react-sdk/src/utils/maps.ts");const fy=()=>g.Ay.get("show_labs_settings")||O.A.getValue("developerMode");class yy extends o.Component{constructor(e){super(e),(0,r.A)(this,"labs",void 0),(0,r.A)(this,"betas",void 0);const t=O.A.getFeatureSettingNames(),[n,i]=t.reduce(((e,t)=>(e[O.A.getBetaInfo(t)?1:0].push(t),e)),[[],[]]);this.labs=n,this.betas=i,fy()||(this.labs=[])}render(){let e,t;if(this.betas.length&&(e=o.createElement(o.Fragment,null,this.betas.map((e=>o.createElement(Oe.A,{key:e,featureId:e}))))),this.labs.length){const e=new _y.h;this.labs.forEach((t=>{e.getOrCreate(O.A.getLabGroup(t),[]).push(o.createElement(vy.A,{level:re.p.DEVICE,name:t,key:t}))})),e.getOrCreate(Ln.$q.Experimental,[]).push(o.createElement(vy.A,{key:"lowBandwidth",name:"lowBandwidth",level:re.p.DEVICE})),e.getOrCreate(Ln.$q.Analytics,[]).push(o.createElement(vy.A,{key:"automaticErrorReporting",name:"automaticErrorReporting",level:re.p.DEVICE}),o.createElement(vy.A,{key:"automaticDecryptionErrorReporting",name:"automaticDecryptionErrorReporting",level:re.p.DEVICE})),t=o.createElement(o.Fragment,null,(0,c.sortBy)(Array.from(e.entries()),"0").map((([e,t])=>o.createElement(Tt.Ay,{key:e,heading:(0,C._t)(Ln.B2[e])},t))))}return o.createElement(Rt.A,null,o.createElement(It.X,{heading:(0,C._t)("labs|beta_section")},o.createElement(Tt.sS,null,(0,C._t)("labs|beta_description",{brand:g.Ay.get("brand")})),e),t&&o.createElement(It.X,{heading:(0,C._t)("labs|experimental_section")},o.createElement(Tt.sS,null,(0,C._t)("labs|experimental_description",{},{a:e=>o.createElement("a",{href:"https://github.com/vector-im/element-web/blob/develop/docs/labs.md",rel:"noreferrer noopener",target:"_blank"},e)})),t))}}class Ey extends o.Component{constructor(e){super(e),this.state={message:e.message}}fakeEvent({message:e}){const t={type:"m.room.message",sender:this.props.userId,content:{"m.new_content":{msgtype:s.MsgType.Text,body:e,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},msgtype:s.MsgType.Text,body:e,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:"!999999999999999999:example.org"},n=new s.MatrixEvent(t);return n.sender={name:this.props.displayName||this.props.userId,rawDisplayName:this.props.displayName,userId:this.props.userId,getAvatarUrl:(...e)=>xa.r4({avatarUrl:this.props.avatarUrl},32,32,"crop"),getMxcAvatarUrl:()=>this.props.avatarUrl},n}render(){const e=ee()(this.props.className,{mx_IRCLayout:this.props.layout==Us.P.IRC,mx_EventTilePreview_loader:!this.props.userId});if(!this.props.userId)return o.createElement("div",{className:e},o.createElement(dn.A,null));const t=this.fakeEvent(this.state);return o.createElement("div",{className:e,role:"presentation"},o.createElement(Fs.Ay,{mxEvent:t,layout:this.props.layout,as:"div",hideTimestamp:!0,inhibitInteraction:!0}))}}function by(){return o.createElement(Tt.Ay,{heading:(0,C._t)("common|message_layout"),legacy:!1},o.createElement(wy,null),o.createElement(Ay,null))}function wy(){return o.createElement(ke.bL,{className:"mx_LayoutSwitcher_LayoutSelector",onChange:async e=>{const t=new FormData(e.currentTarget).get("layout");await O.A.setValue("layout",null,re.p.DEVICE,t)}},o.createElement(xy,{layout:Us.P.Group,label:(0,C._t)("common|modern")}),o.createElement(xy,{layout:Us.P.Bubble,label:(0,C._t)("settings|appearance|layout_bubbles")}),o.createElement(xy,{layout:Us.P.IRC,label:(0,C._t)("settings|appearance|layout_irc")}))}function xy({layout:e,label:t}){const n=(0,Ne.ti)("layout"),r=function(){const e=(0,Re.nH)(),t=e.getSafeUserId(),[n,i]=(0,o.useState)({userId:t});return(0,o.useEffect)((()=>{(async()=>{const n=await e.getProfileInfo(t);i({userId:t,displayName:n.displayname,avatarUrl:n.avatar_url})})()}),[t,e,i]),n}();return o.createElement(ke.D0,{name:"layout",className:"mxLayoutSwitcher_LayoutSelector_LayoutRadio"},o.createElement(ke.JU,{"aria-label":t},o.createElement("div",{className:"mxLayoutSwitcher_LayoutSelector_LayoutRadio_inline"},o.createElement(ke.bh,{name:"layout",value:e,defaultChecked:n===e}),o.createElement("span",null,t)),o.createElement("hr",{className:"mxLayoutSwitcher_LayoutSelector_LayoutRadio_separator"}),o.createElement(Ey,(0,i.A)({message:(0,C._t)("common|preview_message"),layout:e,className:"mxLayoutSwitcher_LayoutSelector_LayoutRadio_EventTilePreview"},r))))}function Ay(){const e=(0,Ne.ti)("useCompactLayout"),t=(0,Ne.ti)("layout");return o.createElement(ke.bL,{onChange:async e=>{const t="on"===new FormData(e.currentTarget).get("compactLayout");await O.A.setValue("useCompactLayout",null,re.p.DEVICE,t)}},o.createElement(ke.IP,{name:"compactLayout",control:o.createElement(ke._H,{disabled:t!==Us.P.Group,name:"compactLayout",defaultChecked:e})},o.createElement(ke.JU,null,(0,C._t)("settings|appearance|compact_layout")),o.createElement(ke.po,null,(0,C._t)("settings|appearance|compact_layout_description"))))}class Sy extends o.Component{constructor(e){super(e),(0,r.A)(this,"MESSAGE_PREVIEW_TEXT",(0,C._t)("common|preview_message")),(0,r.A)(this,"sizes",[9,10,11,12,13,14,15,16,17,18,20,22,24,26,28,30,32,34,36]),(0,r.A)(this,"layoutWatcherRef",void 0),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"onFontSizeChanged",(async e=>{const t=parseInt(e,10)||0;this.setState({fontSizeDelta:t}),await O.A.setValue("fontSizeDelta",null,re.p.DEVICE,t)})),(0,r.A)(this,"computeDeltaFontSize",(e=>e-this.state.browserFontSize)),this.state={fontSizeDelta:O.A.getValue("fontSizeDelta",null),browserFontSize:Y.g.getBrowserDefaultFontSize(),useCustomFontSize:O.A.getValue("useCustomFontSize"),layout:O.A.getValue("layout")}}async componentDidMount(){const e=h.J.safeGet(),t=e.getSafeUserId(),n=await e.getProfileInfo(t);this.layoutWatcherRef=O.A.watchSetting("layout",null,(()=>{const e=O.A.getValue("layout");this.state.layout!==e&&this.setState({layout:e})})),this.unmounted||this.setState({userId:t,displayName:n.displayname,avatarUrl:n.avatar_url})}componentWillUnmount(){this.unmounted=!0,this.layoutWatcherRef&&O.A.unwatchSetting(this.layoutWatcherRef)}render(){return o.createElement(Tt.Ay,{heading:(0,C._t)("settings|appearance|font_size"),stretchContent:!0},o.createElement(tn.A,{element:"select",className:"mx_FontScalingPanel_Dropdown",label:(0,C._t)("settings|appearance|font_size"),value:this.state.fontSizeDelta.toString(),onChange:e=>this.onFontSizeChanged(e.target.value)},this.sizes.map((e=>o.createElement("option",{key:e,value:this.computeDeltaFontSize(e)},e===this.state.browserFontSize?(0,C._t)("settings|appearance|font_size_default",{fontSize:e}):e)))),o.createElement(Ey,{className:"mx_FontScalingPanel_preview",message:this.MESSAGE_PREVIEW_TEXT,layout:this.state.layout,userId:this.state.userId,displayName:this.state.displayName,avatarUrl:this.state.avatarUrl}))}}var Cy=n("./node_modules/@vector-im/compound-design-tokens/assets/web/icons/delete.js");function ky(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Ry(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ky(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ky(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Iy(){const e=Ft(),t=(0,o.useRef)(new $.A),n=(0,Ne.ti)("feature_custom_themes");return o.createElement(Tt.Ay,{heading:(0,C._t)("common|theme"),legacy:!1},t.current.isSystemThemeSupported()&&o.createElement(Ty,{systemThemeActivated:e.systemThemeActivated}),o.createElement(Py,{theme:e.theme,disabled:e.systemThemeActivated}),n&&o.createElement(Ny,{theme:e.theme}))}function Ty({systemThemeActivated:e}){return o.createElement(ke.bL,{onChange:async e=>{const t="on"===new FormData(e.currentTarget).get("systemTheme");await O.A.setValue("use_system_theme",null,re.p.DEVICE,t),v.Ay.dispatch({action:x.r.RecheckTheme})}},o.createElement(ke.IP,{name:"systemTheme",control:o.createElement(ke._H,{name:"systemTheme",defaultChecked:e})},o.createElement(ke.JU,null,O.A.getDisplayName("use_system_theme"))))}function Py({theme:e,disabled:t}){const n=function(){const e=(0,Ne.ti)("custom_themes");return(0,o.useMemo)((()=>{const t=(e||[]).reduce(((e,t)=>e.set(t.name,t)),new Map),n=(0,Lt.E0)(),i=n.filter((e=>!t.has(e.name))),r=n.filter((e=>t.has(e.name))),o=function(){const e=(0,Lt.TJ)("light");if(e)return{name:(0,C._t)("settings|appearance|high_contrast"),id:e}}();o&&i.push(o);return i.concat(r).map((e=>{const n=t.get(e.name),i=(n?n.is_dark:e.id.includes("dark"))||!1;return Ry(Ry({},e),{},{isDark:i})}))}),[e])}();return o.createElement(ke.bL,{className:"mx_ThemeChoicePanel_ThemeSelectors",onChange:async t=>{const n=new FormData(t.currentTarget).get("themeSelector");n&&e!==n&&(O.A.setValue("theme",null,re.p.DEVICE,n).catch((()=>{v.Ay.dispatch({action:x.r.RecheckTheme})})),v.Ay.dispatch({action:x.r.RecheckTheme,forceTheme:n}))}},n.map((n=>{const i=e===n.id;return o.createElement(ke.IP,{className:ee()("mx_ThemeChoicePanel_themeSelector",{mx_ThemeChoicePanel_themeSelector_enabled:!t&&e===n.id,mx_ThemeChoicePanel_themeSelector_disabled:t,"cpd-theme-light":!n.isDark,"cpd-theme-dark":n.isDark}),name:"themeSelector",key:n.id,control:o.createElement(ke.bh,{name:"themeSelector",checked:!t&&i,disabled:t,value:n.id})},o.createElement(ke.JU,{className:"mx_ThemeChoicePanel_themeSelector_Label"},n.name))})))}function Ny({theme:e}){const[t,n]=(0,o.useState)(""),[i,r]=(0,o.useState)(),s=(0,o.useCallback)((()=>{r(void 0),n("")}),[r,n]);return o.createElement("div",{className:"mx_ThemeChoicePanel_CustomTheme"},o.createElement(ke.dU,{className:"mx_ThemeChoicePanel_CustomTheme_EditInPlace",label:(0,C._t)("settings|appearance|custom_theme_add"),cancelButtonLabel:(0,C._t)("action|cancel"),saveButtonLabel:(0,C._t)("settings|appearance|custom_theme_add"),savingLabel:(0,C._t)("settings|appearance|custom_theme_downloading"),value:t,onChange:e=>{r(void 0),n(e.target.value)},onSave:async()=>{if(!t)return;const e=O.A.getValue("custom_themes").map((e=>e))||[];try{const n=await fetch(t),i=await n.json();if(!i||"string"!=typeof i.name||"object"!=typeof i.colors)return void r((0,C._t)("settings|appearance|custom_theme_invalid"));if(Boolean(e.find((e=>e.name===i.name))))return void s();e.push(i)}catch(e){return l.v.error(e),void r((0,C._t)("settings|appearance|custom_theme_error_downloading"))}s(),await O.A.setValue("custom_themes",null,re.p.ACCOUNT,e)},onCancel:s},o.createElement(ke.po,null,(0,C._t)("settings|appearance|custom_theme_help")),i&&o.createElement(ke.Kw,null,i)),o.createElement(Dy,{theme:e}))}function Dy({theme:e}){const t=(0,Ne.ti)("custom_themes")||[];return o.createElement("ul",{className:"mx_ThemeChoicePanel_CustomThemeList"},t.map((t=>o.createElement("li",{key:t.name,className:"mx_ThemeChoicePanel_CustomThemeList_theme","aria-label":t.name},o.createElement("span",{className:"mx_ThemeChoicePanel_CustomThemeList_name"},t.name),o.createElement(ke.K0,{destructive:!0,"aria-label":(0,C._t)("action|delete"),tooltip:(0,C._t)("action|delete"),onClick:async()=>{const n=(O.A.getValue("custom_themes").map((e=>e))||[]).filter((e=>e.name!==t.name));await O.A.setValue("custom_themes",null,re.p.ACCOUNT,n),e===`custom-${t.name}`&&(await O.A.setValue("theme",null,re.p.DEVICE,null),v.Ay.dispatch({action:x.r.RecheckTheme}))}},o.createElement(Cy.A,null))))))}var My=n("./node_modules/matrix-react-sdk/src/components/views/elements/StyledRadioButton.tsx"),Oy=n("./node_modules/matrix-react-sdk/src/settings/enums/ImageSize.ts");class Ly extends o.Component{constructor(e){super(e),(0,r.A)(this,"onSizeChange",(e=>{const t=e.target.value;this.setState({size:t}),O.A.setValue("Images.size",null,re.p.ACCOUNT,t)})),this.state={size:O.A.getValue("Images.size")}}render(){return o.createElement(Tt.Ay,{heading:(0,C._t)("settings|appearance|timeline_image_size")},o.createElement("div",{className:"mx_ImageSizePanel_radios"},o.createElement("label",null,o.createElement("div",{className:"mx_ImageSizePanel_size mx_ImageSizePanel_sizeDefault"}),o.createElement(My.A,{name:"image_size",value:Oy.h.Normal,checked:this.state.size===Oy.h.Normal,onChange:this.onSizeChange},(0,C._t)("settings|appearance|image_size_default"))),o.createElement("label",null,o.createElement("div",{className:"mx_ImageSizePanel_size mx_ImageSizePanel_sizeLarge"}),o.createElement(My.A,{name:"image_size",value:Oy.h.Large,checked:this.state.size===Oy.h.Large,onChange:this.onSizeChange},(0,C._t)("settings|appearance|image_size_large")))))}}class Uy extends o.Component{constructor(e){super(e),this.state={useBundledEmojiFont:O.A.getValue("useBundledEmojiFont"),useSystemFont:O.A.getValue("useSystemFont"),systemFont:O.A.getValue("systemFont"),showAdvanced:!1}}renderAdvancedSection(){if(!O.A.getValue(W.f.AdvancedSettings))return null;const e=g.Ay.get().brand,t=o.createElement(be.A,{kind:"link",onClick:()=>this.setState({showAdvanced:!this.state.showAdvanced}),"aria-expanded":this.state.showAdvanced},this.state.showAdvanced?(0,C._t)("action|hide_advanced"):(0,C._t)("action|show_advanced"));let n;if(this.state.showAdvanced){const t=(0,C._t)("settings|appearance|custom_font_description",{brand:e});n=o.createElement(o.Fragment,null,o.createElement(vy.A,{name:"useCompactLayout",level:re.p.DEVICE,useCheckbox:!0}),o.createElement(vy.A,{name:"useBundledEmojiFont",level:re.p.DEVICE,useCheckbox:!0,onChange:e=>this.setState({useBundledEmojiFont:e})}),o.createElement(vy.A,{name:"useSystemFont",level:re.p.DEVICE,useCheckbox:!0,onChange:e=>this.setState({useSystemFont:e})}),o.createElement(tn.A,{className:"mx_AppearanceUserSettingsTab_checkboxControlledField",label:O.A.getDisplayName("systemFont"),onChange:e=>{this.setState({systemFont:e.target.value}),O.A.setValue("systemFont",null,re.p.DEVICE,e.target.value)},tooltipContent:t,forceTooltipVisible:!0,disabled:!this.state.useSystemFont,value:this.state.systemFont}))}return o.createElement(Tt.Ay,null,t,n)}render(){return o.createElement(Rt.A,null,o.createElement(It.X,null,o.createElement(Iy,null),o.createElement(by,null),o.createElement(Sy,null),this.renderAdvancedSection(),o.createElement(Ly,null)))}}var Fy=n("./node_modules/matrix-react-sdk/src/SecurityManager.ts");class jy extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"onKeyBackupSessionsRemaining",(e=>{this.setState({sessionsRemaining:e})})),(0,r.A)(this,"onKeyBackupStatus",(()=>{this.loadBackupStatus()})),(0,r.A)(this,"startNewBackup",(()=>{f.Ay.createDialogAsync(n.e(8366).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/CreateKeyBackupDialog.tsx")),{onFinished:()=>{this.loadBackupStatus()}},void 0,!1,!0)})),(0,r.A)(this,"deleteBackup",(()=>{f.Ay.createDialog(z.A,{title:(0,C._t)("settings|security|delete_backup"),description:(0,C._t)("settings|security|delete_backup_confirm_description"),button:(0,C._t)("settings|security|delete_backup"),danger:!0,onFinished:e=>{var t;if(!e)return;this.setState({loading:!0});const n=this.state.backupInfo.version;null===(t=h.J.safeGet().getCrypto())||void 0===t||t.deleteKeyBackupVersion(n).then((()=>{this.loadBackupStatus()}))}})})),(0,r.A)(this,"restoreBackup",(async()=>{f.Ay.createDialog(ln.A,void 0,void 0,!1,!0)})),(0,r.A)(this,"resetSecretStorage",(async()=>{this.setState({error:!1});try{await(0,Fy.cb)((async()=>{}),!0)}catch(e){if(l.v.error("Error resetting secret storage",e),this.unmounted)return;this.setState({error:!0})}this.unmounted||this.loadBackupStatus()})),this.state={loading:!0,error:!1,backupKeyStored:null,backupKeyCached:null,backupKeyWellFormed:null,secretStorageKeyInAccount:null,secretStorageReady:null,backupInfo:null,backupTrustInfo:void 0,activeBackupVersion:null,sessionsRemaining:null}}componentDidMount(){this.loadBackupStatus(),h.J.safeGet().on(d.cr.KeyBackupStatus,this.onKeyBackupStatus),h.J.safeGet().on(d.cr.KeyBackupSessionsRemaining,this.onKeyBackupSessionsRemaining)}componentWillUnmount(){this.unmounted=!0,h.J.get()&&(h.J.get().removeListener(d.cr.KeyBackupStatus,this.onKeyBackupStatus),h.J.get().removeListener(d.cr.KeyBackupSessionsRemaining,this.onKeyBackupSessionsRemaining))}async loadBackupStatus(){this.setState({loading:!0}),this.getUpdatedDiagnostics();try{var e,t,n;const i=h.J.safeGet(),r=await i.getKeyBackupVersion(),o=r?await(null===(e=i.getCrypto())||void 0===e?void 0:e.isKeyBackupTrusted(r)):void 0,s=null!==(t=await(null===(n=i.getCrypto())||void 0===n?void 0:n.getActiveSessionBackupVersion()))&&void 0!==t?t:null;if(this.unmounted)return;this.setState({loading:!1,error:!1,backupInfo:r,backupTrustInfo:o,activeBackupVersion:s})}catch(e){if(l.v.log("Unable to fetch key backup status",e),this.unmounted)return;this.setState({loading:!1,error:!0,backupInfo:null,backupTrustInfo:void 0,activeBackupVersion:null})}}async getUpdatedDiagnostics(){const e=h.J.safeGet(),t=e.getCrypto();if(!t)return;const n=e.secretStorage,i=!!await e.isKeyBackupKeyStored(),r=await t.getSessionBackupPrivateKey(),o=!!r,s=r instanceof Uint8Array,a=await n.hasKey(),l=await t.isSecretStorageReady();this.unmounted||this.setState({backupKeyStored:i,backupKeyCached:o,backupKeyWellFormed:s,secretStorageKeyInAccount:a,secretStorageReady:l})}render(){const{loading:e,error:t,backupKeyStored:n,backupKeyCached:i,backupKeyWellFormed:r,secretStorageKeyInAccount:s,secretStorageReady:a,backupInfo:l,backupTrustInfo:c,sessionsRemaining:d}=this.state;let u,m,p;const g=[];if(t)u=o.createElement(Tt.sS,{className:"error"},(0,C._t)("settings|security|error_loading_key_backup_status"));else if(e)u=o.createElement(dn.A,null);else if(l){let e,t,n=(0,C._t)("settings|security|restore_key_backup");null!==this.state.activeBackupVersion?u=o.createElement(Tt.sS,null,"✅ ",(0,C._t)("settings|security|key_backup_active")):(u=o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,(0,C._t)("settings|security|key_backup_inactive",{},{b:e=>o.createElement("b",null,e)})),o.createElement(Tt.sS,null,(0,C._t)("settings|security|key_backup_connect_prompt"))),n=(0,C._t)("settings|security|key_backup_connect")),e=null===d?"":d>0?o.createElement("div",null,(0,C._t)("settings|security|key_backup_in_progress",{sessionsRemaining:d})," ",o.createElement("br",null)):o.createElement("div",null,(0,C._t)("settings|security|key_backup_complete")," ",o.createElement("br",null)),null!=c&&c.matchesDecryptionKey&&(t=(0,C._t)("settings|security|key_backup_can_be_restored")),m=o.createElement(o.Fragment,null,o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|key_backup_latest_version")),o.createElement("td",null,l.version," (",(0,C._t)("settings|security|key_backup_algorithm")," ",o.createElement("code",null,l.algorithm),")")),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|key_backup_active_version")),o.createElement("td",null,null===this.state.activeBackupVersion?(0,C._t)("settings|security|key_backup_active_version_none"):this.state.activeBackupVersion))),p=o.createElement(o.Fragment,null,e,o.createElement("div",null,t)),g.push(o.createElement(be.A,{key:"restore",kind:"primary_outline",onClick:this.restoreBackup},n)),(0,gn.R$)(h.J.safeGet())||g.push(o.createElement(be.A,{key:"delete",kind:"danger_outline",onClick:this.deleteBackup},(0,C._t)("settings|security|delete_backup")))}else u=o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,(0,C._t)("settings|security|key_backup_inactive_warning",{},{b:e=>o.createElement("b",null,e)})),o.createElement(Tt.sS,null,(0,C._t)("encryption|setup_secure_backup|explainer"))),g.push(o.createElement(be.A,{key:"setup",kind:"primary_outline",onClick:this.startNewBackup},(0,C._t)("encryption|setup_secure_backup|title")));s&&g.push(o.createElement(be.A,{key:"reset",kind:"danger_outline",onClick:this.resetSecretStorage},(0,C._t)("action|reset")));let v,_="";return i&&(_=", ",_+=r?(0,C._t)("settings|security|backup_key_well_formed"):(0,C._t)("settings|security|backup_key_unexpected_type")),g.length&&(v=o.createElement("div",{className:"mx_SecureBackupPanel_buttonRow"},g)),o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,(0,C._t)("settings|security|backup_keys_description")),u,o.createElement("details",null,o.createElement("summary",{className:"mx_SecureBackupPanel_advanced"},(0,C._t)("common|advanced")),o.createElement("table",{className:"mx_SecureBackupPanel_statusList"},o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|backup_key_stored_status")),o.createElement("td",null,!0===n?(0,C._t)("settings|security|cross_signing_in_4s"):(0,C._t)("settings|security|cross_signing_not_stored"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|backup_key_cached_status")),o.createElement("td",null,i?(0,C._t)("settings|security|cross_signing_cached"):(0,C._t)("settings|security|cross_signing_not_cached"),_)),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|4s_public_key_status")),o.createElement("td",null,s?(0,C._t)("settings|security|4s_public_key_in_account_data"):(0,C._t)("settings|security|cross_signing_not_found"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|secret_storage_status")),o.createElement("td",null,a?(0,C._t)("settings|security|secret_storage_ready"):(0,C._t)("settings|security|secret_storage_not_ready"))),m),p),v)}}class By extends o.Component{constructor(e){super(e),(0,r.A)(this,"onExportE2eKeysClicked",(()=>{f.Ay.createDialogAsync(n.e(8297).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/ExportE2eKeysDialog.tsx")),{matrixClient:h.J.safeGet()})})),(0,r.A)(this,"onImportE2eKeysClicked",(()=>{f.Ay.createDialogAsync(n.e(6202).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/ImportE2eKeysDialog.tsx")),{matrixClient:h.J.safeGet()})})),(0,r.A)(this,"updateBlacklistDevicesFlag",(e=>{h.J.safeGet().setGlobalBlacklistUnverifiedDevices(e)}))}render(){const e=h.J.safeGet(),t=e.deviceId;let n,i,r=e.getDeviceEd25519Key();return r=r?ia.y$(r):(0,C._t)("encryption|not_supported"),e.isCryptoEnabled()&&(n=o.createElement("div",{className:"mx_CryptographyPanel_importExportButtons"},o.createElement(be.A,{kind:"primary_outline",onClick:this.onExportE2eKeysClicked},(0,C._t)("settings|security|export_megolm_keys")),o.createElement(be.A,{kind:"primary_outline",onClick:this.onImportE2eKeysClicked},(0,C._t)("settings|security|import_megolm_keys")))),O.A.canSetValue("blacklistUnverifiedDevices",null,re.p.DEVICE)&&(i=o.createElement(vy.A,{name:"blacklistUnverifiedDevices",level:re.p.DEVICE,onChange:this.updateBlacklistDevicesFlag})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|security|cryptography_section")},o.createElement(Tt.sS,null,o.createElement("table",{className:"mx_CryptographyPanel_sessionInfo"},o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|session_id")),o.createElement("td",null,o.createElement("code",null,t))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|session_key")),o.createElement("td",null,o.createElement("code",null,o.createElement("b",null,r)))))),n,i)}}class Vy extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"onConfirm",(()=>{this.props.onFinished(!0)})),(0,r.A)(this,"onDecline",(()=>{this.props.onFinished(!1)}))}render(){return o.createElement(cn.A,{className:"mx_ConfirmDestroyCrossSigningDialog",hasCancel:!0,onFinished:this.props.onFinished,title:(0,C._t)("encryption|destroy_cross_signing_dialog|title")},o.createElement("div",{className:"mx_ConfirmDestroyCrossSigningDialog_content"},o.createElement("p",null,(0,C._t)("encryption|destroy_cross_signing_dialog|warning"))),o.createElement(un.A,{primaryButton:(0,C._t)("encryption|destroy_cross_signing_dialog|primary_button_text"),onPrimaryButtonClick:this.onConfirm,primaryButtonClass:"danger",cancelButton:(0,C._t)("action|cancel"),onCancel:this.onDecline}))}}var Hy=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/security/SetupEncryptionDialog.tsx");class zy extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"onAccountData",(e=>{const t=e.getType();(t.startsWith("m.cross_signing")||t.startsWith("m.secret_storage"))&&this.getUpdatedStatus()})),(0,r.A)(this,"onBootstrapClick",(()=>{this.state.crossSigningPrivateKeysInStorage?f.Ay.createDialog(Hy.A,{},void 0,!1,!0):(0,Fy.cb)()})),(0,r.A)(this,"onStatusChanged",(()=>{this.getUpdatedStatus()})),(0,r.A)(this,"onResetCrossSigningClick",(()=>{f.Ay.createDialog(Vy,{onFinished:async e=>{e&&this.resetCrossSigning()}})})),this.state={error:!1}}componentDidMount(){const e=h.J.safeGet();e.on(s.ClientEvent.AccountData,this.onAccountData),e.on(d.cr.UserTrustStatusChanged,this.onStatusChanged),e.on(d.cr.KeysChanged,this.onStatusChanged),this.getUpdatedStatus()}componentWillUnmount(){this.unmounted=!0;const e=h.J.get();e&&(e.removeListener(s.ClientEvent.AccountData,this.onAccountData),e.removeListener(d.cr.UserTrustStatusChanged,this.onStatusChanged),e.removeListener(d.cr.KeysChanged,this.onStatusChanged))}async getUpdatedStatus(){const e=h.J.safeGet(),t=e.getCrypto();if(!t)return;const n=await t.getCrossSigningStatus(),i=n.publicKeysOnDevice,r=n.privateKeysInSecretStorage,o=n.privateKeysCachedLocally.masterKey,s=n.privateKeysCachedLocally.selfSigningKey,a=n.privateKeysCachedLocally.userSigningKey,l=await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"),c=await t.isCrossSigningReady();this.setState({crossSigningPublicKeysOnDevice:i,crossSigningPrivateKeysInStorage:r,masterPrivateKeyCached:o,selfSigningPrivateKeyCached:s,userSigningPrivateKeyCached:a,homeserverSupportsCrossSigning:l,crossSigningReady:c})}async resetCrossSigning(){this.setState({error:!1});try{const e=h.J.safeGet();await(0,Fy.J6)((async()=>{await e.getCrypto().bootstrapCrossSigning({authUploadDeviceSigningKeys:async t=>{const{finished:n}=f.Ay.createDialog(Qf.A,{title:(0,C._t)("encryption|bootstrap_title"),matrixClient:e,makeRequest:t}),[i]=await n;if(!i)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:!0})}))}catch(e){this.setState({error:!0}),l.v.error("Error bootstrapping cross-signing",e)}this.unmounted||this.getUpdatedStatus()}render(){const{error:e,crossSigningPublicKeysOnDevice:t,crossSigningPrivateKeysInStorage:n,masterPrivateKeyCached:i,selfSigningPrivateKeyCached:r,userSigningPrivateKeyCached:s,homeserverSupportsCrossSigning:a,crossSigningReady:l}=this.state;let c,d;e&&(c=o.createElement("div",{className:"error"},e.toString())),d=void 0===a?o.createElement(dn.A,null):a?l&&n?o.createElement(Tt.sS,null,"✅ ",(0,C._t)("encryption|cross_signing_ready")):l&&!n?o.createElement(Tt.sS,null,"⚠️ ",(0,C._t)("encryption|cross_signing_ready_no_backup")):n?o.createElement(Tt.sS,null,(0,C._t)("encryption|cross_signing_untrusted")):o.createElement(Tt.sS,null,(0,C._t)("encryption|cross_signing_not_ready")):o.createElement(Tt.sS,null,(0,C._t)("encryption|cross_signing_unsupported"));const u=t||n||i||r||s,m=[];if(!(t&&n&&i&&r&&s)&&a){let e=(0,C._t)("encryption|set_up_toast_title");n&&(e=(0,C._t)("encryption|verify_toast_title")),m.push(o.createElement(be.A,{key:"setup",kind:"primary_outline",onClick:this.onBootstrapClick},e))}let h;return u&&m.push(o.createElement(be.A,{key:"reset",kind:"danger_outline",onClick:this.onResetCrossSigningClick},(0,C._t)("action|reset"))),m.length&&(h=o.createElement("div",{className:"mx_CrossSigningPanel_buttonRow"},m)),o.createElement(o.Fragment,null,d,o.createElement("details",null,o.createElement("summary",{className:"mx_CrossSigningPanel_advanced"},(0,C._t)("common|advanced")),o.createElement("table",{className:"mx_CrossSigningPanel_statusList"},o.createElement("tbody",null,o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|cross_signing_public_keys")),o.createElement("td",null,t?(0,C._t)("settings|security|cross_signing_in_memory"):(0,C._t)("settings|security|cross_signing_not_found"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|cross_signing_private_keys")),o.createElement("td",null,n?(0,C._t)("settings|security|cross_signing_in_4s"):(0,C._t)("settings|security|cross_signing_not_in_4s"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|cross_signing_master_private_Key")),o.createElement("td",null,i?(0,C._t)("settings|security|cross_signing_cached"):(0,C._t)("settings|security|cross_signing_not_cached"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|cross_signing_self_signing_private_key")),o.createElement("td",null,r?(0,C._t)("settings|security|cross_signing_cached"):(0,C._t)("settings|security|cross_signing_not_cached"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|cross_signing_user_signing_private_key")),o.createElement("td",null,s?(0,C._t)("settings|security|cross_signing_cached"):(0,C._t)("settings|security|cross_signing_not_cached"))),o.createElement("tr",null,o.createElement("th",{scope:"row"},(0,C._t)("settings|security|cross_signing_homeserver_support")),o.createElement("td",null,a?(0,C._t)("settings|security|cross_signing_homeserver_support_exists"):(0,C._t)("settings|security|cross_signing_not_found")))))),c,h)}}class Wy extends o.PureComponent{render(){return o.createElement(cn.A,{hasCancel:!0,onFinished:this.props.onFinished.bind(null,!1),title:(0,C._t)("seshat|reset_title")},o.createElement("div",null,o.createElement("p",null,(0,C._t)("seshat|reset_description"),o.createElement("br",null),(0,C._t)("seshat|reset_explainer"))),o.createElement(un.A,{primaryButton:(0,C._t)("seshat|reset_button"),onPrimaryButtonClick:this.props.onFinished.bind(null,!0),primaryButtonClass:"danger",cancelButton:(0,C._t)("action|cancel"),onCancel:this.props.onFinished.bind(null,!1)}))}}class Gy extends o.Component{constructor(e){super(e),(0,r.A)(this,"updateCurrentRoom",(async()=>{const e=rd.A.get(),t=await(null==e?void 0:e.getStats().catch((()=>{})));t&&this.setState({eventIndexSize:t.size,roomCount:t.roomCount})})),(0,r.A)(this,"onManage",(async()=>{f.Ay.createDialogAsync(n.e(774).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/eventindex/ManageEventIndexDialog.tsx")),{onFinished:()=>{}},null,!1,!0)})),(0,r.A)(this,"onEnable",(async()=>{var e,t;this.setState({enabling:!0}),await rd.A.initEventIndex(),await(null===(e=rd.A.get())||void 0===e?void 0:e.addInitialCheckpoints()),null===(t=rd.A.get())||void 0===t||t.startCrawler(),await O.A.setValue("enableEventIndexing",null,re.p.DEVICE,!0),await this.updateState()})),(0,r.A)(this,"confirmEventStoreReset",(()=>{const{close:e}=f.Ay.createDialog(Wy,{onFinished:async t=>{t&&(await O.A.setValue("enableEventIndexing",null,re.p.DEVICE,!1),await rd.A.deleteEventIndex(),await this.onEnable(),e())}})})),this.state={enabling:!1,eventIndexSize:0,roomCount:0,eventIndexingEnabled:O.A.getValueAt(re.p.DEVICE,"enableEventIndexing")}}componentWillUnmount(){const e=rd.A.get();null!==e&&e.removeListener("changedCheckpoint",this.updateCurrentRoom)}componentDidMount(){this.updateState()}async updateState(){const e=rd.A.get(),t=O.A.getValueAt(re.p.DEVICE,"enableEventIndexing");let n=0,i=0;if(null!==e){e.on("changedCheckpoint",this.updateCurrentRoom);const t=await e.getStats().catch((()=>{}));t&&(n=t.size,i=t.roomCount)}this.setState({enabling:!1,eventIndexSize:n,roomCount:i,eventIndexingEnabled:t})}render(){let e;const t=g.Ay.get().brand;if(null!==rd.A.get())e=o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,(0,C._t)("settings|security|message_search_enabled",{size:(0,ia.z3)(this.state.eventIndexSize,0),count:this.state.roomCount,rooms:(0,ia.Zl)(this.state.roomCount)})),o.createElement(be.A,{kind:"primary",onClick:this.onManage},(0,C._t)("action|manage")));else if(!this.state.eventIndexingEnabled&&rd.A.supportIsInstalled())e=o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,(0,C._t)("settings|security|message_search_disabled")),o.createElement("div",null,o.createElement(be.A,{kind:"primary",disabled:this.state.enabling,onClick:this.onEnable},(0,C._t)("action|enable")),this.state.enabling?o.createElement(Ve.A,null):o.createElement("div",null)));else if(rd.A.platformHasSupport()&&!rd.A.supportIsInstalled()){const n="https://github.com/vector-im/element-desktop/blob/develop/docs/native-node-modules.md#adding-seshat-for-search-in-e2e-encrypted-rooms";e=o.createElement(Tt.sS,null,(0,C._t)("settings|security|message_search_unsupported",{brand:t},{nativeLink:e=>o.createElement(sn.A,{href:n,target:"_blank",rel:"noreferrer noopener"},e)}))}else e=rd.A.platformHasSupport()?o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,this.state.enabling?o.createElement(Ve.A,null):(0,C._t)("settings|security|message_search_failed")),rd.A.error&&o.createElement(Tt.sS,null,o.createElement("details",null,o.createElement("summary",null,(0,C._t)("common|advanced")),o.createElement("code",null,rd.A.error instanceof Error?rd.A.error.message:(0,C._t)("error|unknown")),o.createElement("p",null,o.createElement(be.A,{key:"delete",kind:"danger",onClick:this.confirmEventStoreReset},(0,C._t)("action|reset")))))):o.createElement(Tt.sS,null,(0,C._t)("settings|security|message_search_unsupported_web",{brand:t},{desktopLink:e=>o.createElement(sn.A,{href:"https://element.io/get-started",target:"_blank",rel:"noreferrer noopener"},e)}));return e}}var Ky=n("./node_modules/matrix-react-sdk/src/utils/device/clientInformation.ts"),Jy=n("./node_modules/matrix-react-sdk/src/utils/device/parseUserAgent.ts"),qy=n("./node_modules/matrix-react-sdk/src/utils/device/isDeviceVerified.ts");function $y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Yy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$y(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Qy=(e,t)=>{const{name:n,version:i,url:r}=(0,Ky.Uh)(e,t.device_id);return{appName:n,appVersion:i,url:r}};let Zy=function(e){return e.Unsupported="Unsupported",e.Default="Default",e}({});const Xy=()=>{var e;const t=(0,o.useContext)(Xt.A).client,n=t.getDeviceId(),i=t.getSafeUserId(),[r,a]=(0,o.useState)({}),[c,u]=(0,o.useState)(void 0),[m,h]=(0,o.useState)([]),[p,g]=(0,o.useState)(new Map),[v,_]=(0,o.useState)(!0),[f,y]=(0,o.useState)(!0),[E,b]=(0,o.useState)();(0,o.useEffect)((()=>{t.doesServerSupportUnstableFeature("org.matrix.msc3881").then((e=>{y(e)}))}),[t]);const w=(0,o.useCallback)((async()=>{_(!0);try{var e,n;const r=await async function(e){const{devices:t}=await e.getDevices(),n={};for(const i of t)n[i.device_id]=Yy(Yy(Yy({},i),{},{isVerified:await(0,qy.z)(e,i.device_id)},Qy(e,i)),(0,Jy.y)(i[s.UNSTABLE_MSC3852_LAST_SEEN_UA.name]));return n}(t);a(r);const{pushers:o}=await t.getPushers();h(o);const l=new Map;Object.keys(r).forEach((e=>{const n=`${s.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name}.${e}`,i=t.getAccountData(n);i&&l.set(e,i.getContent())})),g(l);const c=t.getUserId(),d=null===(e=await(null===(n=t.getCrypto())||void 0===n?void 0:n.getUserDeviceInfo([c])))||void 0===e?void 0:e.get(c),m=[];for(const e of null!==(i=null==d?void 0:d.values())&&void 0!==i?i:[]){var i;e.dehydrated&&m.push(e.deviceId)}u(1==m.length?m[0]:void 0),_(!1)}catch(e){404==e.httpStatus?b(Zy.Unsupported):(l.v.error("Error loading sessions:",e),b(Zy.Default)),_(!1)}}),[t]);(0,o.useEffect)((()=>{w()}),[w]),(0,o.useEffect)((()=>{const e=Object.keys(r);e.length&&(0,Ky.eD)(e,t)}),[r,t]),(0,Pe.ml)(t,d.cr.DevicesUpdated,(e=>{e.includes(i)&&w()})),(0,Pe.ml)(t,s.ClientEvent.AccountData,(e=>{const t=e.getType();if(t.startsWith(s.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name)){const n=new Map(p),i=t.slice(t.lastIndexOf(".")+1);n.set(i,e.getContent()),g(n)}}));const x=!(null===(e=r[n])||void 0===e||!e.isVerified)&&i?async e=>await t.getCrypto().requestDeviceVerification(i,e):void 0,A=(0,o.useCallback)((async(e,n)=>{const i=r[e];if(n!==(null==i?void 0:i.display_name))try{await t.setDeviceDetails(e,{display_name:n}),await w()}catch(e){throw l.v.error("Error setting device name",e),new Error((0,C._t)("settings|sessions|error_set_name"))}}),[t,r,w]),S=(0,o.useCallback)((async(e,n)=>{try{const i=m.find((t=>t[s.PUSHER_DEVICE_ID.name]===e));i?await t.setPusher(Yy(Yy({},i),{},{[s.PUSHER_ENABLED.name]:n})):p.has(e)&&await t.setLocalNotificationSettings(e,{is_silenced:!n})}catch(e){throw l.v.error("Error setting pusher state",e),new Error((0,C._t)("settings|sessions|error_pusher_state"))}finally{await w()}}),[t,m,p,w]);return{devices:r,dehydratedDeviceId:c,pushers:m,localNotificationSettings:p,currentDeviceId:n,isLoadingDeviceList:v,error:E,requestDeviceVerification:x,refreshDevices:w,saveDeviceName:A,setPushNotifications:S,supportsMSC3881:f}};async function eE(e,t){const n=e.getUserId();let{threepids:i}=await e.getThreePids();if(t&&(i=i.filter((e=>e.medium===t))),i.length>0&&e.getIdentityServerUrl())try{const r=new Tm.A,o=await r.getAccessToken({check:!1});if(!o)throw new Error("No identity access token found");const s=i.map((({medium:e,address:t})=>[e,t])),a=await e.bulkLookupThreePids(s,o);for(const[e,r,o]of a.threepids){if(o!==n)continue;if(t&&e!==t)continue;const s=i.find((t=>t.medium===e&&t.address===r));s&&(s.bound=!0)}}catch(e){if(!(e instanceof s.MatrixError)||"M_TERMS_NOT_SIGNED"!==e.errcode)throw e}return i}var tE=n("./node_modules/matrix-react-sdk/src/utils/IdentityServerUtils.ts"),nE=n("./node_modules/matrix-react-sdk/src/utils/promise.ts"),iE=n("./node_modules/matrix-react-sdk/src/components/views/settings/SettingsFieldset.tsx");class rE extends o.Component{constructor(e){super(e),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"onAction",(e=>{"id_server_changed"===e.action&&this.setState({currentClientIdServer:h.J.safeGet().getIdentityServerUrl()})})),(0,r.A)(this,"onIdentityServerChanged",(e=>{const t=e.target.value;this.setState({idServer:t})})),(0,r.A)(this,"getTooltip",(()=>this.state.checking?o.createElement("div",null,o.createElement(Ve.A,null),(0,C._t)("identity_server|checking")):this.state.error?o.createElement("strong",{className:"warning"},this.state.error):null)),(0,r.A)(this,"idServerChangeEnabled",(()=>!!this.state.idServer&&!this.state.busy)),(0,r.A)(this,"saveIdServer",(e=>{h.J.safeGet().setAccountData("m.identity_server",{base_url:e}),this.setState({busy:!1,error:void 0,currentClientIdServer:e,idServer:""})})),(0,r.A)(this,"checkIdServer",(async e=>{var t;e.preventDefault();const{idServer:n,currentClientIdServer:i}=this.state;this.setState({busy:!0,checking:!0,error:void 0});const r=(0,yl.qe)(n);let s=await async function(e){if("https:"!==(0,yl.Dl)(e).protocol)return(0,C._t)("identity_server|url_not_https");try{const t=await fetch(e+"/_matrix/identity/v2");return t.ok?null:t.status<200||t.status>=300?(0,C._t)("identity_server|error_invalid",{code:t.status}):(0,C._t)("identity_server|error_connection")}catch(e){return(0,C._t)("identity_server|error_connection")}}(r);if(!s)try{this.setState({checking:!1});const e=new Tm.A(r);await e.getAccessToken();let t=!0;if(!await(0,tE.mn)(h.J.safeGet(),r)){const[e]=await this.showNoTermsWarning(r);t=!!e}if(t&&i&&r!==i){const[e]=await this.showServerChangeWarning({title:(0,C._t)("identity_server|change"),unboundMessage:(0,C._t)("identity_server|change_prompt",{},{current:e=>o.createElement("b",null,(0,yl.FO)(i)),new:e=>o.createElement("b",null,(0,yl.FO)(n))}),button:(0,C._t)("action|continue")});t=!!e}t&&this.saveIdServer(r)}catch(e){l.v.error(e),s=(0,C._t)("identity_server|error_invalid_or_terms")}this.setState({busy:!1,checking:!1,error:null!==(t=s)&&void 0!==t?t:void 0,currentClientIdServer:h.J.safeGet().getIdentityServerUrl()})})),(0,r.A)(this,"onDisconnectClicked",(async()=>{this.setState({disconnectBusy:!0});try{const[e]=await this.showServerChangeWarning({title:(0,C._t)("identity_server|disconnect"),unboundMessage:(0,C._t)("identity_server|disconnect_server",{},{idserver:e=>o.createElement("b",null,(0,yl.FO)(this.state.currentClientIdServer))}),button:(0,C._t)("action|disconnect")});e&&this.disconnectIdServer()}finally{this.setState({disconnectBusy:!1})}})),(0,r.A)(this,"disconnectIdServer",(()=>{h.J.safeGet().setAccountData("m.identity_server",{base_url:null});let e="";(0,tE.iR)()&&(e=(0,yl.FO)((0,tE.iR)())),this.setState({busy:!1,error:void 0,currentClientIdServer:h.J.safeGet().getIdentityServerUrl(),idServer:e})}));let t="";!h.J.safeGet().getIdentityServerUrl()&&(0,tE.iR)()&&(t=(0,yl.FO)((0,tE.iR)())),this.state={defaultIdServer:t,currentClientIdServer:h.J.safeGet().getIdentityServerUrl(),idServer:"",busy:!1,disconnectBusy:!1,checking:!1}}componentDidMount(){this.dispatcherRef=v.Ay.register(this.onAction)}componentWillUnmount(){this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef)}showNoTermsWarning(e){const{finished:t}=f.Ay.createDialog(z.A,{title:(0,C._t)("terms|identity_server_no_terms_title"),description:o.createElement("div",null,o.createElement("strong",{className:"warning"},(0,C._t)("identity_server|no_terms")),o.createElement("span",null," ",(0,C._t)("terms|identity_server_no_terms_description_2"))),button:(0,C._t)("action|continue")});return t}async showServerChangeWarning({title:e,unboundMessage:t,button:n}){const{currentClientIdServer:i}=this.state;let r=[],s=!0;try{r=await(0,nE.w)(eE(h.J.safeGet()),Promise.reject(new Error("Timeout attempting to reach identity server")),1e4)}catch(e){s=!1,l.v.warn(`Unable to reach identity server at ${i} to check for 3PIDs during IS change flow`),l.v.warn(e)}const a=r.filter((e=>e.bound));let c,d=!1;const u={idserver:e=>o.createElement("b",null,(0,yl.FO)(i)),b:e=>o.createElement("b",null,e)};s?a.length?(c=o.createElement("div",null,o.createElement("p",null,(0,C._t)("identity_server|disconnect_personal_data_warning_1",{},u)),o.createElement("p",null,(0,C._t)("identity_server|disconnect_personal_data_warning_2"))),d=!0,n=(0,C._t)("identity_server|disconnect_anyway")):c=t:(c=o.createElement("div",null,o.createElement("p",null,(0,C._t)("identity_server|disconnect_offline_warning",{},u)),o.createElement("p",null,(0,C._t)("identity_server|suggestions")),o.createElement("ul",null,o.createElement("li",null,(0,C._t)("identity_server|suggestions_1")),o.createElement("li",null,(0,C._t)("identity_server|suggestions_2",{},{idserver:u.idserver})),o.createElement("li",null,(0,C._t)("identity_server|suggestions_3")))),d=!0,n=(0,C._t)("identity_server|disconnect_anyway"));const{finished:m}=f.Ay.createDialog(z.A,{title:e,description:c,button:n,cancelButton:(0,C._t)("action|go_back"),danger:d});return m}render(){const e=this.state.currentClientIdServer;let t,n,i;if(e?(t=(0,C._t)("identity_server|url",{server:(0,yl.FO)(e)}),n=(0,C._t)("identity_server|description_connected",{},{server:t=>o.createElement("b",null,(0,yl.FO)(e))}),this.props.missingTerms&&(n=(0,C._t)("identity_server|change_server_prompt",{},{server:t=>o.createElement("b",null,(0,yl.FO)(e))}))):(t=(0,C._t)("common|identity_server"),n=(0,C._t)("identity_server|description_disconnected")),e){let e=(0,C._t)("action|disconnect"),t=(0,C._t)("identity_server|disconnect_warning");this.props.missingTerms&&(t=(0,C._t)("identity_server|description_optional"),e=(0,C._t)("identity_server|do_not_use")),this.state.disconnectBusy&&(e=o.createElement(Ve.A,null)),i=o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,t),o.createElement(be.A,{onClick:this.onDisconnectClicked,kind:"danger_sm"},e))}return o.createElement(iE.A,{legend:t,description:n},o.createElement("form",{className:"mx_SetIdServer",onSubmit:this.checkIdServer},o.createElement(tn.A,{label:(0,C._t)("identity_server|url_field_label"),type:"text",autoComplete:"off",placeholder:this.state.defaultIdServer,value:this.state.idServer,onChange:this.onIdentityServerChanged,tooltipContent:this.getTooltip(),tooltipClassName:"mx_SetIdServer_tooltip",disabled:this.state.busy,forceValidity:!this.state.error&&void 0}),o.createElement(be.A,{type:"submit",kind:"primary_sm",onClick:this.checkIdServer,disabled:!this.idServerChangeEnabled()},(0,C._t)("action|change")),i))}}class oE extends o.Component{constructor(e){super(e),(0,r.A)(this,"togglePolicy",(e=>{const t=(0,Ol.ZV)(this.state.policies);t[e].checked=!t[e].checked,this.setState({policies:t})})),(0,r.A)(this,"onContinue",(()=>{!!this.state.policies.some((e=>!e.checked))||(this.setState({busy:!0}),this.props.onFinished(this.state.policies.map((e=>e.url))))})),this.state={policies:[],busy:!1}}componentDidMount(){const e=[];for(const t of this.props.policiesAndServicePairs){const n=Object.values(t.policies);for(const t of n){const n=(0,C.CO)(Object.keys(t).filter((e=>"version"!==e))),i={checked:!1,url:t[n].url,name:t[n].name};e.push(i)}}this.setState({policies:e})}renderCheckboxes(){const e=[];for(let t=0;t<this.state.policies.length;t++){const n=this.state.policies[t],i=(0,C._t)("terms|inline_intro_text",{},{policyLink:()=>o.createElement("a",{href:n.url,rel:"noreferrer noopener",target:"_blank"},n.name,o.createElement("span",{className:"mx_InlineTermsAgreement_link"}))});e.push(o.createElement("div",{key:t,className:"mx_InlineTermsAgreement_cbContainer"},o.createElement("div",null,i),o.createElement("div",{className:"mx_InlineTermsAgreement_checkbox"},o.createElement(at.A,{onChange:()=>this.togglePolicy(t),checked:n.checked},(0,C._t)("action|accept")))))}return e}render(){const e=!!this.state.policies.some((e=>!e.checked));return o.createElement("div",null,this.props.introElement,this.renderCheckboxes(),o.createElement(be.A,{onClick:this.onContinue,disabled:e||this.state.busy,kind:"primary_sm"},(0,C._t)("action|continue")))}}var sE=n("./node_modules/matrix-react-sdk/src/Terms.ts");const aE=()=>{const e=(0,Re.nH)(),[t,n]=(0,o.useState)(!0),[i,r]=(0,o.useState)([]),[a,c]=(0,o.useState)([]),[d,u]=(0,o.useState)((0,yl.FO)(e.getIdentityServerUrl())),[m,h]=(0,o.useState)(!1),[p,g]=(0,o.useState)({policiesAndServices:null,agreedUrls:null,resolve:null}),[_,f]=(0,o.useState)(!1),y=(0,o.useCallback)((async()=>{n(!0);const t=await eE(e);r(t.filter((e=>e.medium===s.ThreepidMedium.Email))),c(t.filter((e=>e.medium===s.ThreepidMedium.Phone))),n(!1)}),[e]);if((0,Te.F)(v.Ay,(0,o.useCallback)((t=>{"id_server_changed"===t.action&&(u((0,yl.FO)(e.getIdentityServerUrl())),y().then())}),[e,y])),(0,o.useEffect)((()=>{(async()=>{try{await y();const t=await e.getCapabilities();h(!t["m.3pid_changes"]||!0===t["m.3pid_changes"].enabled);const n=e.getIdentityServerUrl();if(!n)return;const i=new Tm.A;try{const t=await i.getAccessToken({check:!1});await(0,sE.gw)(e,[new sE.kl(s.SERVICE_TYPES.IS,n,t)],((e,t,i)=>new Promise((i=>{u((0,yl.FO)(n)),f(!0),g({policiesAndServices:e,agreedUrls:t,resolve:i})})))),f(!1)}catch(e){l.v.warn(`Unable to reach identity server at ${n} to check for terms in Settings`),l.v.warn(e)}}catch(e){}})()}),[e,y]),!O.A.getValue(W.f.ThirdPartyID))return null;if(_&&p.policiesAndServices){const e=o.createElement(ke.Fc,{type:"info",title:(0,C._t)("settings|general|discovery_needs_terms_title")},(0,C._t)("settings|general|discovery_needs_terms",{serverName:d}));return o.createElement(o.Fragment,null,o.createElement(oE,{policiesAndServicePairs:p.policiesAndServices,agreedUrls:p.agreedUrls,onFinished:p.resolve,introElement:e}),o.createElement(rE,{missingTerms:!0}))}let E;return d&&(E=o.createElement(o.Fragment,null,o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|emails_heading"),description:0===i.length?(0,C._t)("settings|general|discovery_email_empty"):void 0,stretchContent:!0},o.createElement(dy,{mode:"is",medium:s.ThreepidMedium.Email,threepids:i,onChange:y,disabled:!m,isLoading:t})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|msisdns_heading"),description:0===a.length?(0,C._t)("settings|general|discovery_msisdn_empty"):void 0,stretchContent:!0},o.createElement(dy,{mode:"is",medium:s.ThreepidMedium.Phone,threepids:a,onChange:y,disabled:!m,isLoading:t})))),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|discovery|title"),stretchContent:!0},E,o.createElement(rE,{missingTerms:!1}))};var lE=n("./node_modules/matrix-react-sdk/src/components/views/elements/ToggleSwitch.tsx");class cE extends o.Component{constructor(e){super(e),(0,r.A)(this,"onProvisioningToggled",(()=>{const e=this.state.provisioningEnabled;O.A.setValue("integrationProvisioning",null,re.p.ACCOUNT,!e).catch((t=>{l.v.error("Error changing integration manager provisioning"),l.v.error(t),this.setState({provisioningEnabled:e})})),this.setState({provisioningEnabled:!e})}));const t=Yl.J.sharedInstance().getPrimaryManager();this.state={currentManager:t,provisioningEnabled:O.A.getValue("integrationProvisioning")}}render(){const e=this.state.currentManager;let t,n;return e?(t=`(${e.name})`,n=(0,C._t)("integration_manager|use_im_default",{serverName:e.name},{b:e=>o.createElement("b",null,e)})):n=(0,C._t)("integration_manager|use_im"),O.A.getValue(W.f.Widgets)?o.createElement("label",{className:"mx_SetIntegrationManager",htmlFor:"toggle_integration"},o.createElement("div",{className:"mx_SettingsFlag"},o.createElement("div",{className:"mx_SetIntegrationManager_heading_manager"},o.createElement(Ii.A,{size:"3"},(0,C._t)("integration_manager|manage_title")),o.createElement(Ii.A,{size:"4"},t)),o.createElement(lE.A,{id:"toggle_integration",checked:this.state.provisioningEnabled,disabled:!1,onChange:this.onProvisioningToggled})),o.createElement(Tt.sS,null,n),o.createElement(Tt.sS,null,(0,C._t)("integration_manager|explainer"))):null}}const dE=()=>{const{dehydratedDeviceId:e}=Xy();return e?o.createElement("div",{className:"mx_SettingsSubsection_content"},o.createElement("div",{className:"mx_SettingsFlag_label"},(0,C._t)("settings|security|dehydrated_device_enabled")),o.createElement("div",{className:"mx_SettingsSubsection_text"},(0,C._t)("settings|security|dehydrated_device_description"))):null};class uE extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"onUnignoreClicked",(()=>{this.props.onUnignored(this.props.userId)}))}render(){const e=`mx_SecurityUserSettingsTab_ignoredUser_${this.props.userId}`;return o.createElement("div",{className:"mx_SecurityUserSettingsTab_ignoredUser"},o.createElement(be.A,{onClick:this.onUnignoreClicked,kind:"primary_sm","aria-describedby":e,disabled:this.props.inProgress},(0,C._t)("action|unignore")),o.createElement("span",{id:e},this.props.userId))}}class mE extends o.Component{constructor(e){super(e),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"onAction",(({action:e})=>{if("ignore_state_changed"===e){const e=h.J.safeGet().getIgnoredUsers(),t=this.state.waitingUnignored.filter((t=>e.includes(t)));this.setState({ignoredUserIds:e,waitingUnignored:t})}})),(0,r.A)(this,"onMyMembership",((e,t)=>{e.isSpaceRoom()||(t===We.O.Invite?this.addInvitedRoom(e):this.state.invitedRoomIds.has(e.roomId)&&this.removeInvitedRoom(e.roomId))})),(0,r.A)(this,"addInvitedRoom",(e=>{this.setState((({invitedRoomIds:t})=>({invitedRoomIds:new Set(t).add(e.roomId)})))})),(0,r.A)(this,"removeInvitedRoom",(e=>{this.setState((({invitedRoomIds:t})=>{const n=new Set(t);return n.delete(e),{invitedRoomIds:n}}))})),(0,r.A)(this,"onUserUnignored",(async e=>{const{ignoredUserIds:t,waitingUnignored:n}=this.state,i=t.filter((e=>!n.includes(e))),r=i.indexOf(e);-1!==r&&(i.splice(r,1),this.setState((({waitingUnignored:t})=>({waitingUnignored:[...t,e]}))),h.J.safeGet().setIgnoredUsers(i))})),(0,r.A)(this,"getInvitedRooms",(()=>h.J.safeGet().getRooms().filter((e=>e.hasMembershipState(h.J.safeGet().getUserId(),We.O.Invite))))),(0,r.A)(this,"manageInvites",(async e=>{this.setState({managingInvites:!0});const t=Array.from(this.state.invitedRoomIds),n=h.J.safeGet(),i=e?n.joinRoom.bind(n):n.leave.bind(n);for(let e=0;e<t.length;e++){const n=t[e];await i(n).then((()=>{this.removeInvitedRoom(n)}),(async t=>{"M_LIMIT_EXCEEDED"===t.errcode?(await(0,a.yy)(t.retry_after_ms||2500),e--):l.v.warn(t)}))}this.setState({managingInvites:!1})})),(0,r.A)(this,"onAcceptAllInvitesClicked",(()=>{this.manageInvites(!0)})),(0,r.A)(this,"onRejectAllInvitesClicked",(()=>{this.manageInvites(!1)}));const t=new Set(this.getInvitedRooms().map((e=>e.roomId)));this.state={ignoredUserIds:h.J.safeGet().getIgnoredUsers(),waitingUnignored:[],managingInvites:!1,invitedRoomIds:t}}componentDidMount(){this.dispatcherRef=v.Ay.register(this.onAction),h.J.safeGet().on(s.RoomEvent.MyMembership,this.onMyMembership),h.J.safeGet().getVersions().then((e=>this.setState({versions:e})))}componentWillUnmount(){this.dispatcherRef&&v.Ay.unregister(this.dispatcherRef),h.J.safeGet().removeListener(s.RoomEvent.MyMembership,this.onMyMembership)}renderIgnoredUsers(){const{waitingUnignored:e,ignoredUserIds:t}=this.state,n=null!=t&&t.length?t.map((t=>o.createElement(uE,{userId:t,onUnignored:this.onUserUnignored,key:t,inProgress:e.includes(t)}))):(0,C._t)("settings|security|ignore_users_empty");return o.createElement(Tt.Ay,{heading:(0,C._t)("settings|security|ignore_users_section")},o.createElement(Tt.sS,null,n))}renderManageInvites(){const{invitedRoomIds:e}=this.state;return 0===e.size?null:o.createElement(Tt.Ay,{heading:(0,C._t)("settings|security|bulk_options_section")},o.createElement("div",{className:"mx_SecurityUserSettingsTab_bulkOptions"},o.createElement(be.A,{onClick:this.onAcceptAllInvitesClicked,kind:"primary_outline",disabled:this.state.managingInvites},(0,C._t)("settings|security|bulk_options_accept_all_invites",{invitedRooms:e.size})),o.createElement(be.A,{onClick:this.onRejectAllInvitesClicked,kind:"danger_outline",disabled:this.state.managingInvites},(0,C._t)("settings|security|bulk_options_reject_all_invites",{invitedRooms:e.size})),this.state.managingInvites?o.createElement(Ve.A,null):o.createElement("div",null)))}render(){const e=o.createElement(Tt.Ay,{heading:(0,C._t)("common|secure_backup")},o.createElement(jy,null),o.createElement(dE,null)),t=o.createElement(Tt.Ay,{heading:(0,C._t)("settings|security|message_search_section")},o.createElement(Gy,null)),n=o.createElement(Tt.Ay,{heading:(0,C._t)("common|cross_signing")},o.createElement(zy,null));let i,r,s;if((0,ha.u)(h.J.safeGet())||(i=o.createElement("div",{className:"mx_SecurityUserSettingsTab_warning"},(0,C._t)("settings|security|e2ee_default_disabled_warning"))),Hf.Vo.instance.isEnabled()){const e=()=>{C_({primaryButton:(0,C._t)("action|ok"),hasCancel:!1})};r=o.createElement(It.X,{heading:(0,C._t)("common|privacy")},o.createElement(aE,null),o.createElement(Tt.Ay,{heading:(0,C._t)("common|analytics"),description:(0,C._t)("settings|security|analytics_description")},o.createElement(be.A,{kind:"link",onClick:e},(0,C._t)("action|learn_more")),Hf.Vo.instance.isEnabled()&&o.createElement(vy.A,{name:"pseudonymousAnalyticsOptIn",level:re.p.ACCOUNT})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|sessions|title")},o.createElement(vy.A,{name:"deviceClientInformationOptIn",level:re.p.ACCOUNT})))}if(O.A.getValue(W.f.AdvancedSettings)){const e=this.renderIgnoredUsers(),t=this.renderManageInvites();(e||t)&&(s=o.createElement(It.X,{heading:(0,C._t)("common|advanced")},e,t))}return o.createElement(Rt.A,null,i,o.createElement(cE,null),o.createElement(It.X,{heading:(0,C._t)("settings|security|encryption_section")},e,t,n,o.createElement(By,null)),r,s)}}var hE=n("./node_modules/matrix-react-sdk/res/img/element-icons/cancel-rounded.svg");const pE=["icon","label","onDeleteClick","disabled"],gE=e=>{let{icon:t,label:n,onDeleteClick:r,disabled:s=!1}=e,a=(0,Ue.A)(e,pE);return o.createElement("div",(0,i.A)({className:"mx_Tag"},a),null==t?void 0:t(),n,r&&o.createElement(be.A,{"aria-label":"Remove",className:"mx_Tag_delete",onClick:r,disabled:s},o.createElement(hE.I,null)))};class vE extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"onInputChange",(e=>{this.setState({newTag:e.target.value})})),(0,r.A)(this,"onAdd",(e=>{e.preventDefault(),this.state.newTag&&(this.props.onAdd(this.state.newTag),this.setState({newTag:""}))})),this.state={newTag:""}}onRemove(e){this.props.onRemove(e)}render(){return o.createElement("div",{className:ee()("mx_TagComposer",{mx_TagComposer_disabled:this.props.disabled})},o.createElement("form",{className:"mx_TagComposer_input",onSubmit:this.onAdd},o.createElement(tn.A,{id:this.props.id?this.props.id+"_field":void 0,value:this.state.newTag,onChange:this.onInputChange,label:this.props.label||(0,C._t)("notifications|keyword"),placeholder:this.props.placeholder||(0,C._t)("notifications|keyword_new"),disabled:this.props.disabled,autoComplete:"off"}),o.createElement(be.A,{onClick:this.onAdd,kind:"primary",disabled:this.props.disabled},(0,C._t)("action|add"))),o.createElement("div",{className:"mx_TagComposer_tags",role:"list"},this.props.tags.map(((e,t)=>o.createElement(gE,{label:e,key:e,onDeleteClick:this.onRemove.bind(this,e),disabled:this.props.disabled,role:"listitem"})))))}}var _E=n("./node_modules/matrix-react-sdk/src/components/views/typography/Caption.tsx"),fE=n("./node_modules/matrix-react-sdk/src/components/views/settings/shared/SettingsSubsectionHeading.tsx");function yE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function EE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yE(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bE=function(e){return e.Loading="loading",e.Ready="ready",e.Persisting="persisting",e.Error="error",e.SavingError="savingError",e}(bE||{}),wE=function(e){return e.Master="master",e.VectorGlobal="vector_global",e.VectorMentions="vector_mentions",e.VectorOther="vector_other",e.Other="other",e}(wE||{});const xE="_keywords",AE=wE.VectorMentions,SE=[s.RuleId.DM,s.RuleId.EncryptedDM,s.RuleId.Message,s.RuleId.EncryptedMessage,s.RuleId.ContainsDisplayName,s.RuleId.ContainsUserName,s.RuleId.AtRoomNotification,s.RuleId.InviteToSelf,s.RuleId.IncomingCall,s.RuleId.SuppressNotices,s.RuleId.Tombstone],CE=[a_.Off,a_.On,a_.Loud],kE=(e,t,n)=>{var i;if(null===(i=n.syncedRuleIds)||void 0===i||!i.length)return;const r=n.syncedRuleIds.reduce(((t,i)=>{if(t===a_.Loud)return t;const r=((e,t)=>{for(const n in t){const i=t[n].find((t=>t.rule_id===e));if(i)return i}})(i,e);if(r){const e=n.ruleToVectorState(r);if(e&&CE.indexOf(e)>CE.indexOf(t))return e}return t}),n.ruleToVectorState(t));return r},RE=()=>o.createElement("div",null,o.createElement(vy.A,{name:"Notifications.showbold",level:re.p.DEVICE}),o.createElement(vy.A,{name:"Notifications.tac_only_notifications",level:re.p.DEVICE}));class IE extends o.PureComponent{constructor(e){var t;super(e),(0,r.A)(this,"settingWatchers",void 0),(0,r.A)(this,"onMasterRuleChanged",(async e=>{this.setState({phase:bE.Persisting});const t=this.state.masterPushRule;try{await h.J.safeGet().setPushRuleEnabled("global",t.kind,t.rule_id,!e),await this.refreshFromServer()}catch(e){this.setState({phase:bE.Error}),l.v.error("Error updating master push rule:",e),this.showSaveError()}})),(0,r.A)(this,"setSavingError",(e=>{this.setState((({ruleIdsWithError:t})=>({phase:bE.SavingError,ruleIdsWithError:EE(EE({},t),{},{[e]:!0})})))})),(0,r.A)(this,"updateDeviceNotifications",(async e=>{await O.A.setValue("deviceNotificationsEnabled",null,re.p.DEVICE,e)})),(0,r.A)(this,"onEmailNotificationsChanged",(async(e,t)=>{this.setState({phase:bE.Persisting});try{if(t)await h.J.safeGet().setPusher({kind:"email",app_id:"m.email",pushkey:e,app_display_name:"Email Notifications",device_display_name:e,lang:navigator.language,data:{brand:g.Ay.get().brand},append:!0});else{var n;const t=null===(n=this.state.pushers)||void 0===n?void 0:n.find((t=>"email"===t.kind&&t.pushkey===e));t&&await h.J.safeGet().removePusher(t.pushkey,t.app_id)}await this.refreshFromServer()}catch(e){this.setState({phase:bE.Error}),l.v.error("Error updating email pusher:",e),this.showSaveError()}})),(0,r.A)(this,"onDesktopNotificationsChanged",(async e=>{await O.A.setValue("notificationsEnabled",null,re.p.DEVICE,e)})),(0,r.A)(this,"onDesktopShowBodyChanged",(async e=>{await O.A.setValue("notificationBodyEnabled",null,re.p.DEVICE,e)})),(0,r.A)(this,"onAudioNotificationsChanged",(async e=>{await O.A.setValue("audioNotificationsEnabled",null,re.p.DEVICE,e)})),(0,r.A)(this,"onRadioChecked",(async(e,t)=>{this.setState((({ruleIdsWithError:t})=>({phase:bE.Persisting,ruleIdsWithError:EE(EE({},t),{},{[e.ruleId]:!1})})));try{const n=h.J.safeGet();if(e.ruleId===xE){if(!this.state.vectorKeywordRuleInfo)throw new Error("Notification data is incomplete.");for(const e of this.state.vectorKeywordRuleInfo.rules){let i,r;t===a_.On?(1!==e.actions.length&&(r=l_.actionsFor(t)),this.state.vectorKeywordRuleInfo.vectorState===a_.Off&&(i=!0)):t===a_.Loud?(3!==e.actions.length&&(r=l_.actionsFor(t)),this.state.vectorKeywordRuleInfo.vectorState===a_.Off&&(i=!0)):i=!1,r&&await n.setPushRuleActions("global",e.kind,e.rule_id,r),void 0!==i&&await n.setPushRuleEnabled("global",e.kind,e.rule_id,i)}}else{const i=d_[e.ruleId],r=i.vectorStateToActions[t];if(!e.rule)throw new Error("Cannot update rule: push rule data is incomplete.");await m_(n,e.rule.rule_id,e.rule.kind,r),await h_(n,i.syncedRuleIds,r)}await this.refreshFromServer()}catch(t){this.setSavingError(e.ruleId),l.v.error("Error updating push rule:",t)}})),(0,r.A)(this,"onClearNotificationsClicked",(async()=>{try{this.setState({clearingNotifications:!0});const e=h.J.safeGet();await(0,Wn.XC)(e)}finally{this.setState({clearingNotifications:!1})}})),(0,r.A)(this,"onKeywordAdd",(e=>{if(!this.state.vectorKeywordRuleInfo)throw new Error("Notification data is incomplete.");const t=(0,Ol.ZV)(this.state.vectorKeywordRuleInfo.rules);this.setState({phase:bE.Persisting,vectorKeywordRuleInfo:EE(EE({},this.state.vectorKeywordRuleInfo),{},{rules:[...this.state.vectorKeywordRuleInfo.rules,{pattern:e}]})},(async()=>{await this.setKeywords(this.state.vectorKeywordRuleInfo.rules.map((e=>e.pattern)),t)}))})),(0,r.A)(this,"onKeywordRemove",(e=>{if(!this.state.vectorKeywordRuleInfo)throw new Error("Notification data is incomplete.");const t=(0,Ol.ZV)(this.state.vectorKeywordRuleInfo.rules);this.setState({phase:bE.Persisting,vectorKeywordRuleInfo:EE(EE({},this.state.vectorKeywordRuleInfo),{},{rules:this.state.vectorKeywordRuleInfo.rules.filter((t=>t.pattern!==e))})},(async()=>{await this.setKeywords(this.state.vectorKeywordRuleInfo.rules.map((e=>e.pattern)),t)}))})),this.state={phase:bE.Loading,deviceNotificationsEnabled:null===(t=O.A.getValue("deviceNotificationsEnabled"))||void 0===t||t,desktopNotifications:O.A.getValue("notificationsEnabled"),desktopShowBody:O.A.getValue("notificationBodyEnabled"),audioNotifications:O.A.getValue("audioNotificationsEnabled"),clearingNotifications:!1,ruleIdsWithError:{}},this.settingWatchers=[O.A.watchSetting("notificationsEnabled",null,((...[,,,,e])=>this.setState({desktopNotifications:e}))),O.A.watchSetting("deviceNotificationsEnabled",null,((...[,,,,e])=>{this.setState({deviceNotificationsEnabled:e})})),O.A.watchSetting("notificationBodyEnabled",null,((...[,,,,e])=>this.setState({desktopShowBody:e}))),O.A.watchSetting("audioNotificationsEnabled",null,((...[,,,,e])=>this.setState({audioNotifications:e})))]}get isInhibited(){var e;return!(null===(e=this.state.masterPushRule)||void 0===e||!e.enabled)}componentDidMount(){this.refreshFromServer(),this.refreshFromAccountData()}componentWillUnmount(){this.settingWatchers.forEach((e=>O.A.unwatchSetting(e)))}componentDidUpdate(e,t){this.state.deviceNotificationsEnabled!==t.deviceNotificationsEnabled&&this.persistLocalNotificationSettings(this.state.deviceNotificationsEnabled)}async refreshFromServer(){try{const e=(await Promise.all([this.refreshRules(),this.refreshPushers(),this.refreshThreepids()])).reduce(((e,t)=>Object.assign(t,e)),{});this.setState(EE(EE({},e),{},{phase:bE.Ready}))}catch(e){l.v.error("Error setting up notifications for settings: ",e),this.setState({phase:bE.Error})}}async refreshFromAccountData(){const e=h.J.safeGet(),t=e.getAccountData((0,Wn.uG)(e.deviceId));if(t){const e=!t.getContent().is_silenced;await this.updateDeviceNotifications(e)}}persistLocalNotificationSettings(e){const t=h.J.safeGet();return t.setAccountData((0,Wn.uG)(t.deviceId),{is_silenced:!e})}async refreshRules(){const e=await h.J.safeGet().getPushRules(),t={[s.RuleId.Master]:wE.Master,[s.RuleId.DM]:wE.VectorGlobal,[s.RuleId.EncryptedDM]:wE.VectorGlobal,[s.RuleId.Message]:wE.VectorGlobal,[s.RuleId.EncryptedMessage]:wE.VectorGlobal,[s.RuleId.ContainsDisplayName]:wE.VectorMentions,[s.RuleId.ContainsUserName]:wE.VectorMentions,[s.RuleId.AtRoomNotification]:wE.VectorMentions,[s.RuleId.InviteToSelf]:wE.VectorOther,[s.RuleId.IncomingCall]:wE.VectorOther,[s.RuleId.SuppressNotices]:wE.VectorOther,[s.RuleId.Tombstone]:wE.VectorOther},n={[wE.Master]:[],[wE.VectorGlobal]:[],[wE.VectorMentions]:[],[wE.VectorOther]:[],[wE.Other]:[]};for(const r in e.global){const o=r;for(const r of e.global[o]){var i;const e=Object.assign(r,{kind:o}),s=null!==(i=t[e.rule_id])&&void 0!==i?i:wE.Other;"."===e.rule_id[0]&&n[s].push(e)}}const r={};if(!(n.master.length>0))throw new Error("Failed to locate a master push rule");r.masterPushRule=n.master[0],r.vectorKeywordRuleInfo=u_.parseContentRules(e),r.vectorPushRules={};const o=[wE.VectorGlobal,wE.VectorMentions,wE.VectorOther];for(const e of o){r.vectorPushRules[e]=[];for(const t of n[e]){const i=d_[t.rule_id],o=i.ruleToVectorState(t);r.vectorPushRules[e].push({ruleId:t.rule_id,rule:t,vectorState:o,syncedVectorState:kE(n,t,i),description:(0,C._t)(i.description)})}r.vectorPushRules[e].sort(((e,t)=>{let n=SE.indexOf(e.ruleId),i=SE.indexOf(t.ruleId);return n<0&&(n=SE.length),i<0&&(i=SE.length),n-i})),e===AE&&r.vectorPushRules[e].push({ruleId:xE,description:(0,C._t)("settings|notifications|messages_containing_keywords"),vectorState:r.vectorKeywordRuleInfo.vectorState})}return r}refreshPushers(){return h.J.safeGet().getPushers()}refreshThreepids(){return h.J.safeGet().getThreePids()}showSaveError(){f.Ay.createDialog(lc.A,{title:(0,C._t)("settings|notifications|error_saving"),description:(0,C._t)("settings|notifications|error_saving_detail")})}async setKeywords(e,t){try{const n=(0,Pl.Bo)(Array.from(new Set(e))),i=(0,Pl.Bo)(Array.from(new Set(t.map((e=>e.pattern))))),r=(0,Pl.ZQ)(i,n);for(const e of r.removed)for(const n of t.filter((t=>t.pattern===e)))await h.J.safeGet().deletePushRule("global",n.kind,n.rule_id);let o=this.state.vectorKeywordRuleInfo.vectorState;if(o===a_.Off){const e=t.length?l_.contentRuleVectorStateKind(t[0]):void 0;o=null!=e?e:a_.On}const a=s.PushRuleKind.ContentSpecific;for(const e of r.added)await h.J.safeGet().addPushRule("global",a,e,{actions:l_.actionsFor(o),pattern:e}),o===a_.Off&&await h.J.safeGet().setPushRuleEnabled("global",a,e,!1);await this.refreshFromServer()}catch(e){this.setState({phase:bE.Error}),l.v.error("Error updating keyword push rules:",e),this.showSaveError()}}renderTopSection(){const e=o.createElement(Nl.A,{value:!this.isInhibited,label:(0,C._t)("settings|notifications|enable_notifications_account"),caption:(0,C._t)("settings|notifications|enable_notifications_account_detail"),onChange:this.onMasterRuleChanged,disabled:this.state.phase===bE.Persisting});if(this.isInhibited)return e;const t=(this.state.threepids||[]).filter((e=>e.medium===s.ThreepidMedium.Email)).map((e=>{var t;return o.createElement(Nl.A,{key:e.address,value:!(null===(t=this.state.pushers)||void 0===t||!t.some((t=>"email"===t.kind&&t.pushkey===e.address))),label:(0,C._t)("settings|notifications|enable_email_notifications",{email:e.address}),onChange:this.onEmailNotificationsChanged.bind(this,e.address),disabled:this.state.phase===bE.Persisting})}));return o.createElement(Tt.Ay,null,e,o.createElement(Nl.A,{value:this.state.deviceNotificationsEnabled,label:(0,C._t)("settings|notifications|enable_notifications_device"),onChange:e=>this.updateDeviceNotifications(e),disabled:this.state.phase===bE.Persisting}),this.state.deviceNotificationsEnabled&&o.createElement(o.Fragment,null,o.createElement(Nl.A,{value:this.state.desktopNotifications,onChange:this.onDesktopNotificationsChanged,label:(0,C._t)("settings|notifications|enable_desktop_notifications_session"),disabled:this.state.phase===bE.Persisting}),o.createElement(Nl.A,{value:this.state.desktopShowBody,onChange:this.onDesktopShowBodyChanged,label:(0,C._t)("settings|notifications|show_message_desktop_notification"),disabled:this.state.phase===bE.Persisting}),o.createElement(Nl.A,{value:this.state.audioNotifications,onChange:this.onAudioNotificationsChanged,label:(0,C._t)("settings|notifications|enable_audible_notifications_session"),disabled:this.state.phase===bE.Persisting})),t)}renderCategory(e){var t;if(this.isInhibited)return null;let n;if(e===wE.VectorMentions){var i;const e=(0,Pl.Bo)((null===(i=this.state.vectorKeywordRuleInfo)||void 0===i?void 0:i.rules.map((e=>e.pattern)))||[]);n=o.createElement(vE,{tags:e,onAdd:this.onKeywordAdd,onRemove:this.onKeywordRemove,disabled:this.state.phase===bE.Persisting,label:(0,C._t)("notifications|keyword"),placeholder:(0,C._t)("notifications|keyword_new")})}const r={[a_.On]:(0,C._t)("common|on"),[a_.Off]:(0,C._t)("common|off"),[a_.Loud]:(0,C._t)("settings|notifications|noisy")},s=(e,t)=>{var n;return o.createElement(My.A,{key:e.ruleId+t,name:e.ruleId,checked:(null!==(n=e.syncedVectorState)&&void 0!==n?n:e.vectorState)===t,onChange:this.onRadioChecked.bind(this,e,t),disabled:this.state.phase===bE.Persisting,"aria-label":r[t]})},a=null===(t=this.state.vectorPushRules)||void 0===t||null===(t=t[e])||void 0===t?void 0:t.map((t=>o.createElement("fieldset",{key:e+t.ruleId,className:"mx_UserNotifSettings_gridRowContainer"},o.createElement("legend",{className:"mx_UserNotifSettings_gridRowLabel"},t.description),s(t,a_.Off),s(t,a_.On),s(t,a_.Loud),this.state.ruleIdsWithError[t.ruleId]&&o.createElement("div",{className:"mx_UserNotifSettings_gridRowError"},o.createElement(_E.H,{isError:!0},(0,C._t)("settings|notifications|error_updating"))))));let l;switch(e){case wE.VectorGlobal:l=(0,C._t)("notifications|class_global");break;case wE.VectorMentions:l=(0,C._t)("notifications|mentions_keywords");break;case wE.VectorOther:l=(0,C._t)("notifications|class_other");break;default:throw new Error("Developer error: Unnamed notifications section: "+e)}return o.createElement("div",null,o.createElement("div",{className:"mx_UserNotifSettings_grid"},o.createElement(fE.r,{heading:l}),o.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},r[a_.Off]),o.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},r[a_.On]),o.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},r[a_.Loud]),a),n)}renderTargets(){var e;if(this.isInhibited)return null;const t=null===(e=this.state.pushers)||void 0===e?void 0:e.map((e=>o.createElement("tr",{key:e.kind+e.pushkey},o.createElement("td",null,e.app_display_name),o.createElement("td",null,e.device_display_name))));return null!=t&&t.length?o.createElement("div",{className:"mx_UserNotifSettings_floatingSection"},o.createElement("div",null,(0,C._t)("settings|notifications|push_targets")),o.createElement("table",null,o.createElement("tbody",null,t))):null}render(){if(this.state.phase===bE.Loading)return o.createElement(dn.A,null);if(this.state.phase===bE.Error)return o.createElement("p",null,(0,C._t)("settings|notifications|error_loading"));let e;return h.J.safeGet().getRooms().some((e=>(0,Yn.GN)(e,!0)))&&(e=o.createElement(be.A,{onClick:this.onClearNotificationsClicked,disabled:this.state.clearingNotifications,kind:"danger",className:"mx_UserNotifSettings_clearNotifsButton"},(0,C._t)("notifications|mark_all_read"))),o.createElement(o.Fragment,null,this.renderTopSection(),this.renderCategory(wE.VectorGlobal),this.renderCategory(wE.VectorMentions),this.renderCategory(wE.VectorOther),this.renderTargets(),o.createElement(RE,null),e)}}function TE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function PE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?TE(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function NE(e){const t=new Map;for(const i of Object.values(s.PushRuleKind))for(const r of null!==(n=e.global[i])&&void 0!==n?n:[]){var n;r.rule_id.startsWith(".")&&t.set(r.rule_id,PE(PE({},r),{},{kind:i}))}return t}function DE(e,t,n){var i,r;const o={updated:[],added:[],deleted:[]},l=NE(e),c=function(e,t){const n=new Map;n.set(s.RuleId.Master,{rule_id:s.RuleId.Master,kind:s.PushRuleKind.Override,enabled:e.globalMute}),n.set(s.RuleId.EncryptedMessage,{rule_id:s.RuleId.EncryptedMessage,kind:s.PushRuleKind.Underride,enabled:!0,actions:r_.encodeActions({notify:e.defaultLevels.room===Gh.dC.AllMessages,highlight:!1})}),n.set(s.RuleId.Message,{rule_id:s.RuleId.Message,kind:s.PushRuleKind.Underride,enabled:!0,actions:r_.encodeActions({notify:e.defaultLevels.room===Gh.dC.AllMessages,highlight:!1})}),n.set(s.RuleId.EncryptedDM,{rule_id:s.RuleId.EncryptedDM,kind:s.PushRuleKind.Underride,enabled:!0,actions:r_.encodeActions({notify:e.defaultLevels.dm===Gh.dC.AllMessages,highlight:!1,sound:e.sound.people})}),n.set(s.RuleId.DM,{rule_id:s.RuleId.DM,kind:s.PushRuleKind.Underride,enabled:!0,actions:r_.encodeActions({notify:e.defaultLevels.dm===Gh.dC.AllMessages,highlight:!1,sound:e.sound.people})}),n.set(s.RuleId.SuppressNotices,{rule_id:s.RuleId.SuppressNotices,kind:s.PushRuleKind.Override,enabled:!e.activity.bot_notices,actions:s_.ACTION_DONT_NOTIFY}),n.set(s.RuleId.InviteToSelf,{rule_id:s.RuleId.InviteToSelf,kind:s.PushRuleKind.Override,enabled:e.activity.invite,actions:r_.encodeActions({notify:!0,highlight:!1,sound:e.sound.people})}),n.set(s.RuleId.MemberEvent,{rule_id:s.RuleId.MemberEvent,kind:s.PushRuleKind.Override,enabled:!0,actions:e.activity.status_event?s_.ACTION_NOTIFY:s_.ACTION_DONT_NOTIFY});const i=r_.encodeActions({notify:!0,sound:e.sound.mentions,highlight:!0}),r=e.mentions.user?i:s_.ACTION_DONT_NOTIFY;t&&n.set(s.RuleId.IsUserMention,{rule_id:s.RuleId.IsUserMention,kind:s.PushRuleKind.Override,enabled:!0,actions:r}),n.set(s.RuleId.ContainsDisplayName,{rule_id:s.RuleId.ContainsDisplayName,kind:s.PushRuleKind.Override,enabled:!0,actions:r}),n.set(s.RuleId.ContainsUserName,{rule_id:s.RuleId.ContainsUserName,kind:s.PushRuleKind.ContentSpecific,enabled:!0,actions:r});const o=e.mentions.room?s_.ACTION_NOTIFY:s_.ACTION_DONT_NOTIFY;return t&&n.set(s.RuleId.IsRoomMention,{rule_id:s.RuleId.IsRoomMention,kind:s.PushRuleKind.Override,enabled:!0,actions:o}),n.set(s.RuleId.AtRoomNotification,{rule_id:s.RuleId.AtRoomNotification,kind:s.PushRuleKind.Override,enabled:!0,actions:o}),n.set(s.RuleId.Tombstone,{rule_id:s.RuleId.Tombstone,kind:s.PushRuleKind.Override,enabled:e.activity.status_event,actions:s_.ACTION_HIGHLIGHT}),n.set(s.RuleId.IncomingCall,{rule_id:s.RuleId.IncomingCall,kind:s.PushRuleKind.Underride,enabled:!0,actions:r_.encodeActions({notify:!0,sound:e.sound.calls})}),n}(t,n);for(const e of c.values()){const t=l.get(e.rule_id);let n=!1;if(void 0===t)n=!0;else if(void 0!==e.enabled&&e.enabled!==t.enabled)n=!0;else if(void 0!==e.actions){const i=r_.decodeActions(t.actions),r=r_.decodeActions(e.actions);null===i||null===r?n=!0:(0,a.ky)(r,i)||(n=!0)}n&&o.updated.push(e)}const d=r_.encodeActions({notify:!0,sound:t.sound.mentions,highlight:!0}),u=null!==(i=null===(r=e.global.content)||void 0===r?void 0:r.filter((e=>!e.rule_id.startsWith("."))))&&void 0!==i?i:[],m=new Set(t.keywords);for(const e of u){if(m.has(e.pattern)){let n=!1;if(e.enabled!==t.mentions.keywords)n=!0;else if(void 0!==e.actions){const t=r_.decodeActions(e.actions),i=r_.decodeActions(d);null===t||null===i?n=!0:(0,a.ky)(i,t)||(n=!0)}n&&o.updated.push({rule_id:e.rule_id,kind:s.PushRuleKind.ContentSpecific,enabled:t.mentions.keywords,actions:d})}else o.deleted.push({rule_id:e.rule_id,kind:s.PushRuleKind.ContentSpecific});m.delete(e.pattern)}for(const e of m)o.added.push({rule_id:e,kind:s.PushRuleKind.ContentSpecific,default:!1,enabled:t.mentions.keywords,pattern:e,actions:d});return o}function ME(e){if(0===e.length)return!0;for(const t of e){if(null==t||!1===t||!t.enabled)continue;const e=r_.decodeActions(t.actions);if(null!==e&&e.notify)return!0}return!1}function OE(e){if(0===e.length)return!1;for(const t of e){if(null==t||!1===t||!t.enabled)continue;const e=r_.decodeActions(t.actions);if(null!==e&&!e.notify&&!0!==e.highlight&&void 0===e.sound)return!0}return!1}function LE(e){for(const t of e){if(null==t||!1===t||!t.enabled)continue;const e=r_.decodeActions(t.actions);if(null!==e&&e.notify&&void 0!==e.sound)return e.sound}}function UE(e){const t=function(){const e=(0,o.useRef)(null);return(0,o.useCallback)((t=>{let n;return n=null===e.current?t():e.current.then(t),e.current=n,n}),[])}(),n=(0,o.useMemo)((()=>e.supportsIntentionalMentions()),[e]),i=(0,o.useRef)(null),[r,a]=(0,o.useState)(null),[l,c]=(0,o.useState)(!1),d=(0,o.useCallback)((async()=>{const t=await e.getPushRules(),r=function(e,t){var n,i,r,o;const a=NE(e),l=null!==(n=null===(i=e.global.content)||void 0===i?void 0:i.filter((e=>!e.rule_id.startsWith("."))))&&void 0!==n?n:[],c=[a.get(s.RuleId.DM),a.get(s.RuleId.EncryptedDM)],d=[a.get(s.RuleId.Message),a.get(s.RuleId.EncryptedMessage)];return{globalMute:null!==(r=null===(o=a.get(s.RuleId.Master))||void 0===o?void 0:o.enabled)&&void 0!==r&&r,defaultLevels:{room:ME(d)?Gh.dC.AllMessages:Gh.dC.MentionsOnly,dm:ME(c)?Gh.dC.AllMessages:Gh.dC.MentionsOnly},sound:{calls:LE([a.get(s.RuleId.IncomingCall)]),mentions:LE([t&&a.get(s.RuleId.IsUserMention),a.get(s.RuleId.ContainsUserName),a.get(s.RuleId.ContainsDisplayName),...l]),people:LE(c)},activity:{bot_notices:!OE([a.get(s.RuleId.SuppressNotices)]),invite:ME([a.get(s.RuleId.InviteToSelf)]),status_event:ME([a.get(s.RuleId.MemberEvent),a.get(s.RuleId.Tombstone)])},mentions:{user:ME([t&&a.get(s.RuleId.IsUserMention),a.get(s.RuleId.ContainsUserName),a.get(s.RuleId.ContainsDisplayName)]),room:ME([t&&a.get(s.RuleId.IsRoomMention),a.get(s.RuleId.AtRoomNotification)]),keywords:ME(l)},keywords:l.map((e=>e.pattern))}}(t,n),o=DE(t,r,n);i.current=t,c(o.updated.length>0||o.added.length>0||o.deleted.length>0),a(r)}),[e,n]);(0,o.useEffect)((()=>{t(d).catch((e=>console.error(e)))}),[e,t,d]);const u=(0,o.useCallback)((r=>{a(r),t((async()=>{if(null!==i.current){const t=DE(i.current,r,n);await async function(e,t){await Promise.all(t.deleted.map((t=>e.deletePushRule("global",t.kind,t.rule_id)))),await Promise.all(t.added.map((t=>e.addPushRule("global",t.kind,t.rule_id,t)))),await Promise.all(t.updated.map((async t=>{void 0!==t.enabled&&await e.setPushRuleEnabled("global",t.kind,t.rule_id,t.enabled),void 0!==t.actions&&await e.setPushRuleActions("global",t.kind,t.rule_id,t.actions)})))}(e,t),await d()}})).catch((e=>console.error(e)))}),[t,n,e,d]);return{model:r,hasPendingChanges:l,reconcile:u}}const FE={globalMute:!1,defaultLevels:{room:Gh.dC.AllMessages,dm:Gh.dC.AllMessages},sound:{people:"default",mentions:"default",calls:"ring"},activity:{invite:!0,status_event:!1,bot_notices:!0},mentions:{user:!0,room:!0,keywords:!0},keywords:[]};var jE=n("./node_modules/matrix-react-sdk/src/components/views/elements/LabelledCheckbox.tsx");function BE({children:e,icon:t,action:n,onAction:i}){return o.createElement("div",{className:"mx_SettingsBanner"},t,o.createElement("div",{className:"mx_SettingsBanner_content"},e),n&&o.createElement(be.A,{kind:"primary_outline",onClick:null!=i?i:null},n))}function VE(e,t,n){const[i,r]=(0,o.useState)(n),s=(0,o.useCallback)((()=>{let t=!1;return e().then((e=>{t||r(e)})).catch((e=>console.error(e))),()=>{t=!0}}),t);return(0,o.useEffect)(s,[s]),[i,s]}const HE=["children"],zE=e=>{let{children:t}=e,n=(0,Ue.A)(e,HE);return o.createElement("div",(0,i.A)({},n,{className:"mx_SettingsIndent"}),t)};function WE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function GE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WE(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function KE(e){return o.createElement(be.A,{kind:"link_inline",onClick:()=>{v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Account})}},e)}function JE(){const e=(0,o.useMemo)((()=>({kind:"email",app_id:"m.email",app_display_name:(0,C._t)("notifications|email_pusher_app_display_name"),lang:navigator.language,data:{brand:g.Ay.get().brand}})),[]),t=(0,Re.nH)(),[n,i]=VE((()=>r.getPushers().then((e=>e.pushers))),[r=t],[]);var r;const[a,l]=function(e){return VE((()=>e.getThreePids().then((e=>e.threepids))),[e],[])}(t),c=(0,o.useCallback)(((r,o)=>{if(o)t.setPusher(GE(GE({},e),{},{pushkey:r,device_display_name:r,append:!0})).catch((e=>console.error(e)));else{const e=n.find((e=>"email"===e.kind&&e.pushkey===r));e&&t.removePusher(e.pushkey,e.app_id).catch((e=>console.error(e)))}l(),i()}),[e,t,n,i,l]),d=n.filter((e=>"email"!==e.kind));return o.createElement(o.Fragment,null,o.createElement(Tt.Ay,{className:"mx_NotificationPusherSettings",heading:(0,C._t)("settings|notifications|email_section")},o.createElement(Tt.sS,{className:"mx_NotificationPusherSettings_description"},(0,C._t)("settings|notifications|email_description")),o.createElement("div",{className:"mx_SettingsSubsection_description mx_NotificationPusherSettings_detail"},o.createElement(Tt.sS,null,(0,C._t)("settings|notifications|email_select",{},{button:KE}))),o.createElement(zE,null,a.filter((e=>e.medium===s.ThreepidMedium.Email)).map((e=>o.createElement(jE.A,{key:e.address,label:e.address,value:void 0!==n.find((t=>t.pushkey===e.address)),onChange:t=>c(e.address,t)}))))),d.length>0&&o.createElement(Tt.Ay,{heading:(0,C._t)("settings|notifications|push_targets")},o.createElement("ul",null,n.filter((e=>"email"!==e.kind)).map((e=>o.createElement("li",{key:e.pushkey},e.device_display_name||e.app_display_name))))))}function qE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function $E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qE(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var YE=function(e){return e.AllMessages="all_messages",e.PeopleMentionsKeywords="people_mentions_keywords",e.MentionsKeywords="mentions_keywords",e}(YE||{});function QE(e){return o.createElement("strong",null,e)}function ZE(e){return o.createElement(sn.A,{href:"https://element.io/help#settings2"},e)}function XE(){var e;const t=(0,Re.nH)(),n=(0,Ne.ti)("notificationsEnabled"),i=(0,Ne.ti)("notificationBodyEnabled"),r=(0,Ne.ti)("audioNotificationsEnabled"),{model:s,hasPendingChanges:a,reconcile:l}=UE(t),c=null===s||a,d=null!=s?s:FE,[u,m]=(0,o.useState)(!1),h=(0,Re.nH)().getRooms().some((e=>e.getUnreadNotificationCount()>0)),p=[{value:YE.AllMessages,label:(0,C._t)("notifications|all_messages")},{value:YE.PeopleMentionsKeywords,label:(0,C._t)("settings|notifications|people_mentions_keywords")},{value:YE.MentionsKeywords,label:(0,C._t)("settings|notifications|mentions_keywords_only")}];return o.createElement("div",{className:"mx_NotificationSettings2"},a&&null!==s&&o.createElement(BE,{icon:o.createElement("img",{src:"img/element-icons/new-and-improved.65a63c7.svg",alt:"",width:12}),action:(0,C._t)("action|proceed"),onAction:()=>l(s)},(0,C._t)("settings|notifications|labs_notice_prompt",{},{strong:QE,a:ZE})),o.createElement(It.X,null,o.createElement("div",{className:"mx_SettingsSubsection_content mx_NotificationSettings2_flags"},o.createElement(Nl.A,{label:(0,C._t)("settings|notifications|enable_notifications_account"),value:!d.globalMute,disabled:c,onChange:e=>{l($E($E({},s),{},{globalMute:!e}))}}),o.createElement(Nl.A,{label:(0,C._t)("settings|notifications|enable_desktop_notifications_session"),value:n,onChange:e=>O.A.setValue("notificationsEnabled",null,re.p.DEVICE,e)}),o.createElement(Nl.A,{label:(0,C._t)("settings|notifications|desktop_notification_message_preview"),value:i,onChange:e=>O.A.setValue("notificationBodyEnabled",null,re.p.DEVICE,e)}),o.createElement(Nl.A,{label:(0,C._t)("settings|notifications|enable_audible_notifications_session"),value:r,onChange:e=>O.A.setValue("audioNotificationsEnabled",null,re.p.DEVICE,e)})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|notifications|default_setting_section"),description:(0,C._t)("settings|notifications|default_setting_description")},o.createElement(Es.A,{name:"defaultNotificationLevel",value:(g=d.defaultLevels,g.room===Gh.dC.AllMessages?YE.AllMessages:g.dm===Gh.dC.AllMessages?YE.PeopleMentionsKeywords:YE.MentionsKeywords),disabled:c,definitions:p,onChange:e=>{l($E($E({},s),{},{defaultLevels:$E($E({},s.defaultLevels),{},{dm:e!==YE.MentionsKeywords?Gh.dC.AllMessages:Gh.dC.MentionsOnly,room:e===YE.AllMessages?Gh.dC.AllMessages:Gh.dC.MentionsOnly})}))}})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|notifications|play_sound_for_section"),description:(0,C._t)("settings|notifications|play_sound_for_description")},o.createElement(jE.A,{label:"People",value:void 0!==d.sound.people,disabled:c||d.defaultLevels.dm===Gh.dC.MentionsOnly,onChange:e=>{l($E($E({},s),{},{sound:$E($E({},s.sound),{},{people:e?"default":void 0})}))}}),o.createElement(jE.A,{label:(0,C._t)("settings|notifications|mentions_keywords"),value:void 0!==d.sound.mentions,disabled:c,onChange:e=>{l($E($E({},s),{},{sound:$E($E({},s.sound),{},{mentions:e?"default":void 0})}))}}),o.createElement(jE.A,{label:(0,C._t)("settings|notifications|voip"),value:void 0!==d.sound.calls,disabled:c,onChange:e=>{l($E($E({},s),{},{sound:$E($E({},s.sound),{},{calls:e?"ring":void 0})}))}})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|notifications|other_section")},o.createElement(jE.A,{label:(0,C._t)("settings|notifications|invites"),value:d.activity.invite,disabled:c,onChange:e=>{l($E($E({},s),{},{activity:$E($E({},s.activity),{},{invite:e})}))}}),o.createElement(jE.A,{label:(0,C._t)("settings|notifications|room_activity"),value:d.activity.status_event,disabled:c,onChange:e=>{l($E($E({},s),{},{activity:$E($E({},s.activity),{},{status_event:e})}))}}),o.createElement(jE.A,{label:(0,C._t)("settings|notifications|notices"),value:d.activity.bot_notices,disabled:c,onChange:e=>{l($E($E({},s),{},{activity:$E($E({},s.activity),{},{bot_notices:e})}))}})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|notifications|mentions_keywords"),description:(0,C._t)("settings|notifications|keywords",{},{badge:o.createElement(ei.V,{symbol:"1",count:1,level:Qe.S.Notification})})},o.createElement(jE.A,{label:(0,C._t)("settings|notifications|notify_at_room"),value:d.mentions.room,disabled:c,onChange:e=>{l($E($E({},s),{},{mentions:$E($E({},s.mentions),{},{room:e})}))}}),o.createElement(jE.A,{label:(0,C._t)("settings|notifications|notify_mention",{mxid:t.getUserId()}),value:d.mentions.user,disabled:c,onChange:e=>{l($E($E({},s),{},{mentions:$E($E({},s.mentions),{},{user:e})}))}}),o.createElement(jE.A,{label:(0,C._t)("settings|notifications|notify_keyword"),byline:(0,C._t)("settings|notifications|keywords_prompt"),value:d.mentions.keywords,disabled:c,onChange:e=>{l($E($E({},s),{},{mentions:$E($E({},s.mentions),{},{keywords:e})}))}}),o.createElement(vE,{id:"mx_NotificationSettings2_Keywords",tags:null!==(e=null==s?void 0:s.keywords)&&void 0!==e?e:[],disabled:c,onAdd:e=>{l($E($E({},s),{},{keywords:[e,...s.keywords]}))},onRemove:e=>{l($E($E({},s),{},{keywords:s.keywords.filter((t=>t!==e))}))},label:(0,C._t)("notifications|keyword"),placeholder:(0,C._t)("notifications|keyword_new")}),o.createElement(vy.A,{name:"Notifications.showbold",level:re.p.DEVICE}),o.createElement(vy.A,{name:"Notifications.tac_only_notifications",level:re.p.DEVICE})),o.createElement(JE,null),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|notifications|quick_actions_section")},h&&o.createElement(be.A,{kind:"primary_outline",disabled:u,onClick:async()=>{m(!0),await(0,Wn.XC)(t),m(!1)}},(0,C._t)("settings|notifications|quick_actions_mark_all_read")),o.createElement(be.A,{kind:"danger_outline",disabled:null===s,onClick:()=>{l(FE)}},(0,C._t)("settings|notifications|quick_actions_reset")))));var g}class eb extends o.Component{render(){const e=O.A.getValue(Ln.O5.NotificationSettings2);return o.createElement(Rt.A,null,e?o.createElement(XE,null):o.createElement(It.X,null,o.createElement(IE,null)))}}class tb extends o.Component{constructor(e){super(e),(0,r.A)(this,"onSearchChange",(e=>{this.setState({searchQuery:e})})),this.state={searchQuery:"",langs:null}}componentDidMount(){if(C.om().then((e=>{e.sort((function(e,t){return e.labelInTargetLanguage<t.labelInTargetLanguage?-1:e.labelInTargetLanguage>t.labelInTargetLanguage?1:0})),this.setState({langs:e})})).catch((()=>{this.setState({langs:[{value:"en",label:"English",labelInTargetLanguage:"English"}]})})),!this.props.value){const e=C.mf();this.props.onOptionChange(e)}}render(){if(null===this.state.langs)return o.createElement(dn.A,null);let e;e=this.state.searchQuery?this.state.langs.filter((e=>function(e,t){return!!t.labelInTargetLanguage.toUpperCase().includes(e.toUpperCase())||!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e))):this.state.langs;const t=e.map((e=>o.createElement("div",{key:e.value},e.labelInTargetLanguage)));let n,i=O.A.getValue("language",null,!0);return i||(i=navigator.language||navigator.userLanguage),n=this.props.value||i,o.createElement(Ut.A,{id:"mx_LanguageDropdown",className:ee()("mx_LanguageDropdown",this.props.className),onOptionChange:this.props.onOptionChange,onSearchChange:this.onSearchChange,searchEnabled:!0,value:n,label:(0,C._t)("language_dropdown_label"),disabled:this.props.disabled},t)}}class nb extends o.Component{constructor(e){super(e),this.onSearchChange=this.onSearchChange.bind(this),this.state={searchQuery:""}}componentDidMount(){const e=p.A.get();if(e){var t;const n=new Intl.DisplayNames([(0,C.mf)()],{type:"language",style:"short"});null===(t=e.getAvailableSpellCheckLanguages())||void 0===t||t.then((e=>{e.sort((function(e,t){return e<t?-1:e>t?1:0}));const t=[];e.forEach((e=>{t.push({label:n.of(e),value:e})})),this.setState({languages:t})})).catch((e=>{this.setState({languages:[{value:"en",label:n.of("en")}]})}))}}onSearchChange(e){this.setState({searchQuery:e})}render(){if(!this.state.languages)return o.createElement(dn.A,null);let e;e=this.state.searchQuery?this.state.languages.filter((e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e))):this.state.languages;const t=e.map((e=>o.createElement("div",{key:e.value},e.label)));let n,i=O.A.getValue("language",null,!0);return i||(i=navigator.language||navigator.userLanguage),n=this.props.value||i,o.createElement(Ut.A,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this.onSearchChange,searchEnabled:!0,value:n,label:(0,C._t)("language_dropdown_label"),placeholder:(0,C._t)("settings|general|spell_check_locale_placeholder")},t)}}class ib extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"onRemove",(e=>(e.stopPropagation(),e.preventDefault(),this.props.onRemoved(this.props.language))))}render(){var e;return o.createElement("div",{className:"mx_ExistingSpellCheckLanguage"},o.createElement("span",{className:"mx_ExistingSpellCheckLanguage_language"},null!==(e=this.props.label)&&void 0!==e?e:this.props.language),o.createElement(be.A,{onClick:this.onRemove,kind:"danger_sm"},(0,C._t)("action|remove")))}}class rb extends o.Component{constructor(e){super(e),(0,r.A)(this,"onRemoved",(e=>{const t=this.props.languages.filter((t=>t!==e));this.props.onLanguagesChange(t)})),(0,r.A)(this,"onAddClick",(e=>{e.stopPropagation(),e.preventDefault();const t=this.state.newLanguage;this.setState({newLanguage:""}),t&&(this.props.languages.includes(t)||(this.props.languages.push(t),this.props.onLanguagesChange(this.props.languages)))})),(0,r.A)(this,"onNewLanguageChange",(e=>{this.state.newLanguage!==e&&this.setState({newLanguage:e})})),this.state={newLanguage:""}}render(){const e=new Intl.DisplayNames([(0,C.mf)()],{type:"language",style:"short"}),t=this.props.languages.map((t=>o.createElement(ib,{language:t,label:e.of(t),onRemoved:this.onRemoved,key:t}))),n=o.createElement(be.A,{onClick:this.onAddClick,kind:"primary"},(0,C._t)("action|add"));return o.createElement(o.Fragment,null,t,o.createElement("form",{onSubmit:this.onAddClick,noValidate:!0},o.createElement(nb,{className:"mx_GeneralUserSettingsTab_spellCheckLanguageInput",value:this.state.newLanguage,onOptionChange:this.onNewLanguageChange}),n))}}const ob=()=>{const[e,t]=(0,o.useState)((0,C.UK)()),n=(0,o.useCallback)((n=>{if(e===n)return;O.A.setValue("language",null,re.p.DEVICE,n),t(n);const i=p.A.get();i&&(i.setLanguage([n]),i.reload())}),[e]);return o.createElement("div",{className:"mx_SettingsSubsection_dropdown"},(0,C._t)("settings|general|application_language"),o.createElement(tb,{onOptionChange:n,value:e}),o.createElement("div",{className:"mx_PreferencesUserSettingsTab_section_hint"},(0,C._t)("settings|general|application_language_reload_hint")))},sb=()=>{var e;const[t,n]=(0,o.useState)(),[i,r]=(0,o.useState)();(0,o.useEffect)((()=>{(async()=>{const e=p.A.get(),[t,i]=await Promise.all([null==e?void 0:e.getSpellCheckEnabled(),null==e?void 0:e.getSpellCheckLanguages()]);n(t),r(i||void 0)})()}),[]);const s=(0,o.useCallback)((e=>{var t;n(e),null===(t=p.A.get())||void 0===t||t.setSpellCheckEnabled(e)}),[]),a=(0,o.useCallback)((e=>{var t;r(e),null===(t=p.A.get())||void 0===t||t.setSpellCheckLanguages(e)}),[]);return null!==(e=p.A.get())&&void 0!==e&&e.supportsSpellCheckSettings()?o.createElement(o.Fragment,null,o.createElement(Nl.A,{label:(0,C._t)("settings|general|allow_spellcheck"),value:Boolean(t),onChange:s}),t&&void 0!==i&&!te.vL&&o.createElement(rb,{languages:i,onLanguagesChange:a})):null};class ab extends o.Component{constructor(e){super(e),(0,r.A)(this,"onTimezoneChange",(e=>{this.setState({timezone:e}),To.nY(e)})),(0,r.A)(this,"onTimezoneSearchChange",(e=>{const t=e.toLowerCase(),n=t?To.QG().filter((e=>e.toLowerCase().includes(t))):To.QG();this.setState({timezones:n,timezoneSearch:t})})),(0,r.A)(this,"onAutocompleteDelayChange",(e=>{this.setState({autocompleteDelay:e.target.value}),O.A.setValue("autocompleteDelay",null,re.p.DEVICE,e.target.value)})),(0,r.A)(this,"onReadMarkerInViewThresholdMs",(e=>{this.setState({readMarkerInViewThresholdMs:e.target.value}),O.A.setValue("readMarkerInViewThresholdMs",null,re.p.DEVICE,e.target.value)})),(0,r.A)(this,"onReadMarkerOutOfViewThresholdMs",(e=>{this.setState({readMarkerOutOfViewThresholdMs:e.target.value}),O.A.setValue("readMarkerOutOfViewThresholdMs",null,re.p.DEVICE,e.target.value)})),(0,r.A)(this,"onKeyboardShortcutsClicked",(()=>{v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.Keyboard})})),this.state={timezone:To.dB(),timezones:To.QG(),timezoneSearch:void 0,autocompleteDelay:O.A.getValueAt(re.p.DEVICE,"autocompleteDelay").toString(10),readMarkerInViewThresholdMs:O.A.getValueAt(re.p.DEVICE,"readMarkerInViewThresholdMs").toString(10),readMarkerOutOfViewThresholdMs:O.A.getValueAt(re.p.DEVICE,"readMarkerOutOfViewThresholdMs").toString(10)}}renderGroup(e,t=re.p.ACCOUNT){return e.map((e=>o.createElement(vy.A,{key:e,name:e,level:t})))}render(){const e=O.A.getValue("FTUE.useCaseSelection"),t=ab.ROOM_LIST_SETTINGS.filter((t=>"FTUE.userOnboardingButton"!==t||_o(e))),n=(0,C._t)("settings|preferences|default_timezone",{timezone:To.cf()}),i=this.state.timezones.map((e=>o.createElement("div",{key:e},e)));return i.unshift(o.createElement("div",{key:""},n)),o.createElement(Rt.A,null,o.createElement(It.X,null,o.createElement(Tt.Ay,{heading:(0,C._t)("settings|general|language_section")},o.createElement(ob,null),o.createElement(sb,null)),t.length>0&&o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|room_list_heading")},this.renderGroup(t)),o.createElement(Tt.Ay,{heading:(0,C._t)("common|spaces")},this.renderGroup(ab.SPACES_SETTINGS,re.p.ACCOUNT)),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|keyboard_heading"),description:(0,C._t)("settings|preferences|keyboard_view_shortcuts_button",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onKeyboardShortcutsClicked},e)})},this.renderGroup(ab.KEYBINDINGS_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|time_heading")},o.createElement("div",{className:"mx_SettingsSubsection_dropdown"},(0,C._t)("settings|preferences|user_timezone"),o.createElement(Ut.A,{id:"mx_dropdownUserTimezone",className:"mx_dropdownUserTimezone",searchEnabled:!0,value:this.state.timezone,label:(0,C._t)("settings|preferences|user_timezone"),placeholder:n,onOptionChange:this.onTimezoneChange,onSearchChange:this.onTimezoneSearchChange},i)),this.renderGroup(ab.TIME_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("common|presence"),description:(0,C._t)("settings|preferences|presence_description")},this.renderGroup(ab.PRESENCE_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|composer_heading")},this.renderGroup(ab.COMPOSER_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|code_blocks_heading")},this.renderGroup(ab.CODE_BLOCKS_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|media_heading")},this.renderGroup(ab.IMAGES_AND_VIDEOS_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("common|timeline")},this.renderGroup(ab.TIMELINE_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|preferences|room_directory_heading")},this.renderGroup(ab.ROOM_DIRECTORY_SETTINGS)),o.createElement(Tt.Ay,{heading:(0,C._t)("common|general"),stretchContent:!0},this.renderGroup(ab.GENERAL_SETTINGS),o.createElement(vy.A,{name:"Electron.showTrayIcon",level:re.p.PLATFORM,hideIfCannotSet:!0}),o.createElement(vy.A,{name:"Electron.enableHardwareAcceleration",level:re.p.PLATFORM,hideIfCannotSet:!0,label:(0,C._t)("settings|preferences|Electron.enableHardwareAcceleration",{appName:g.Ay.get().brand})}),o.createElement(vy.A,{name:"Electron.alwaysShowMenuBar",level:re.p.PLATFORM,hideIfCannotSet:!0}),o.createElement(vy.A,{name:"Electron.autoLaunch",level:re.p.PLATFORM,hideIfCannotSet:!0}),o.createElement(vy.A,{name:"Electron.warnBeforeExit",level:re.p.PLATFORM,hideIfCannotSet:!0}),o.createElement(tn.A,{label:(0,C._t)("settings|preferences|autocomplete_delay"),type:"number",value:this.state.autocompleteDelay,onChange:this.onAutocompleteDelayChange}),o.createElement(tn.A,{label:(0,C._t)("settings|preferences|rm_lifetime"),type:"number",value:this.state.readMarkerInViewThresholdMs,onChange:this.onReadMarkerInViewThresholdMs}),o.createElement(tn.A,{label:(0,C._t)("settings|preferences|rm_lifetime_offscreen"),type:"number",value:this.state.readMarkerOutOfViewThresholdMs,onChange:this.onReadMarkerOutOfViewThresholdMs}))))}}(0,r.A)(ab,"ROOM_LIST_SETTINGS",["breadcrumbs","FTUE.userOnboardingButton"]),(0,r.A)(ab,"SPACES_SETTINGS",["Spaces.allRoomsInHome"]),(0,r.A)(ab,"KEYBINDINGS_SETTINGS",["ctrlFForSearch"]),(0,r.A)(ab,"PRESENCE_SETTINGS",["sendReadReceipts","sendTypingNotifications"]),(0,r.A)(ab,"COMPOSER_SETTINGS",["MessageComposerInput.autoReplaceEmoji","MessageComposerInput.useMarkdown","MessageComposerInput.suggestEmoji","MessageComposerInput.ctrlEnterToSend","MessageComposerInput.surroundWith","MessageComposerInput.showStickersButton","MessageComposerInput.insertTrailingColon"]),(0,r.A)(ab,"TIME_SETTINGS",["showTwelveHourTimestamps","alwaysShowTimestamps"]),(0,r.A)(ab,"CODE_BLOCKS_SETTINGS",["enableSyntaxHighlightLanguageDetection","expandCodeByDefault","showCodeLineNumbers"]),(0,r.A)(ab,"IMAGES_AND_VIDEOS_SETTINGS",["urlPreviewsEnabled","autoplayGifs","autoplayVideo","showImages"]),(0,r.A)(ab,"TIMELINE_SETTINGS",["showTypingNotifications","showRedactions","showReadReceipts","showJoinLeaves","showDisplaynameChanges","showChatEffects","showAvatarChanges","Pill.shouldShowPillAvatar","TextualBody.enableBigEmoji","scrollToBottomOnMessageSent","useOnlyCurrentProfiles"]),(0,r.A)(ab,"ROOM_DIRECTORY_SETTINGS",["SpotlightSearch.showNsfwPublicRooms"]),(0,r.A)(ab,"GENERAL_SETTINGS",["promptBeforeInviteUnknownUsers"]);var lb=n("./node_modules/matrix-react-sdk/src/utils/media/requestMediaPermissions.tsx");const cb=e=>{switch(e){case ne.cm.AudioOutput:return ne.Ay.getAudioOutput();case ne.cm.AudioInput:return ne.Ay.getAudioInput();case ne.cm.VideoInput:return ne.Ay.getVideoInput()}};class db extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"refreshMediaDevices",(async e=>{var t;this.setState({mediaDevices:null!==(t=await ne.Ay.getDevices())&&void 0!==t?t:null,[ne.cm.AudioOutput]:cb(ne.cm.AudioOutput),[ne.cm.AudioInput]:cb(ne.cm.AudioInput),[ne.cm.VideoInput]:cb(ne.cm.VideoInput)}),e&&e.getTracks().forEach((e=>e.stop()))})),(0,r.A)(this,"requestMediaPermissions",(async()=>{const e=await(0,lb.y)();e&&await this.refreshMediaDevices(e)})),(0,r.A)(this,"setDevice",(async(e,t)=>{this.setState({[t]:e});try{await ne.Ay.instance.setDevice(e,t)}catch(n){l.v.error(`Failed to set device ${t}: ${e}`),this.setState({[t]:cb(t)})}})),(0,r.A)(this,"changeWebRtcMethod",(e=>{this.context.setForceTURN(!e)})),(0,r.A)(this,"changeFallbackICEServerAllowed",(e=>{this.context.setFallbackICEServerAllowed(e)})),this.state={mediaDevices:null,[ne.cm.AudioOutput]:null,[ne.cm.AudioInput]:null,[ne.cm.VideoInput]:null,audioAutoGainControl:ne.Ay.getAudioAutoGainControl(),audioEchoCancellation:ne.Ay.getAudioEchoCancellation(),audioNoiseSuppression:ne.Ay.getAudioNoiseSuppression()}}async componentDidMount(){await ne.Ay.hasAnyLabeledDevices()&&await this.refreshMediaDevices()}renderDeviceOptions(e,t){return e.map((e=>o.createElement("option",{key:`${t}-${e.deviceId}`,value:e.deviceId},e.label)))}renderDropdown(e,t){var n;const i=null===(n=this.state.mediaDevices)||void 0===n?void 0:n[e].slice(0);if(null==i||!i.length)return null;const r=ne.Ay.getDefaultDevice(i);return o.createElement(tn.A,{element:"select",label:t,value:this.state[e]||r,onChange:t=>this.setDevice(t.target.value,e)},this.renderDeviceOptions(i,e))}render(){let e,t,n,i;return this.state.mediaDevices?this.state.mediaDevices&&(t=this.renderDropdown(ne.cm.AudioOutput,(0,C._t)("settings|voip|audio_output"))||o.createElement("p",null,(0,C._t)("settings|voip|audio_output_empty")),n=this.renderDropdown(ne.cm.AudioInput,(0,C._t)("common|microphone"))||o.createElement("p",null,(0,C._t)("settings|voip|audio_input_empty")),i=this.renderDropdown(ne.cm.VideoInput,(0,C._t)("common|camera"))||o.createElement("p",null,(0,C._t)("settings|voip|video_input_empty"))):e=o.createElement("div",null,o.createElement("p",null,(0,C._t)("settings|voip|missing_permissions_prompt")),o.createElement(be.A,{onClick:this.requestMediaPermissions,kind:"primary"},(0,C._t)("settings|voip|request_permissions"))),o.createElement(Rt.A,null,o.createElement(It.X,null,e,o.createElement(Tt.Ay,{heading:(0,C._t)("settings|voip|voice_section"),stretchContent:!0},t,n,o.createElement(Nl.A,{value:this.state.audioAutoGainControl,onChange:async e=>{await ne.Ay.setAudioAutoGainControl(e),this.setState({audioAutoGainControl:ne.Ay.getAudioAutoGainControl()})},label:(0,C._t)("settings|voip|voice_agc")})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|voip|video_section"),stretchContent:!0},i,o.createElement(vy.A,{name:"VideoView.flipVideoHorizontally",level:re.p.ACCOUNT}))),o.createElement(It.X,{heading:(0,C._t)("common|advanced")},o.createElement(Tt.Ay,{heading:(0,C._t)("settings|voip|voice_processing")},o.createElement(Nl.A,{value:this.state.audioNoiseSuppression,onChange:async e=>{await ne.Ay.setAudioNoiseSuppression(e),this.setState({audioNoiseSuppression:ne.Ay.getAudioNoiseSuppression()})},label:(0,C._t)("settings|voip|noise_suppression")}),o.createElement(Nl.A,{value:this.state.audioEchoCancellation,onChange:async e=>{await ne.Ay.setAudioEchoCancellation(e),this.setState({audioEchoCancellation:ne.Ay.getAudioEchoCancellation()})},label:(0,C._t)("settings|voip|echo_cancellation")})),o.createElement(Tt.Ay,{heading:(0,C._t)("settings|voip|connection_section")},o.createElement(vy.A,{name:"webRtcAllowPeerToPeer",level:re.p.DEVICE,onChange:this.changeWebRtcMethod}),o.createElement(vy.A,{name:"fallbackICEServerAllowed",label:(0,C._t)("settings|voip|enable_fallback_ice_server",{server:new URL(So.ZB).pathname}),level:re.p.DEVICE,onChange:this.changeFallbackICEServerAllowed}))))}}(0,r.A)(db,"contextType",Re.Ay);var ub=n("./node_modules/matrix-react-sdk/src/BasePlatform.ts");const mb=["action"];function hb(){var e;null===(e=p.A.get())||void 0===e||e.installUpdate()}const pb=[ub.Kn.Ready,ub.Kn.Error,ub.Kn.NotAvailable],gb=()=>{const[e,t]=(0,o.useState)(null);(0,Te.F)(v.Ay,(e=>{let{action:n}=e,i=(0,Ue.A)(e,mb);n===x.r.CheckUpdates&&t(i)}));const n=!!e&&!pb.includes(e.status);let i;return e&&(i=o.createElement("span",{className:"mx_UpdateCheckButton_summary"},function(e,t){switch(e){case ub.Kn.Error:return(0,C._t)("update|error_encountered",{errorDetail:t});case ub.Kn.Checking:return(0,C._t)("update|checking");case ub.Kn.NotAvailable:return(0,C._t)("update|no_update");case ub.Kn.Downloading:return(0,C._t)("update|downloading");case ub.Kn.Ready:return(0,C._t)("update|new_version_available",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:hb},e)})}}(e.status,e.detail),n&&o.createElement(Ve.A,null))),o.createElement(o.Fragment,null,o.createElement(be.A,{onClick:()=>{var e;t(null),null===(e=p.A.get())||void 0===e||e.startUpdateCheck()},kind:"primary_outline",disabled:n},(0,C._t)("update|check_action")),i)};class vb extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"onClearCacheAndReload",(()=>{p.A.get()&&(l.v.log("Clear cache & reload clicked"),this.context.stopClient(),this.context.store.deleteAllData().then((()=>{var e;null===(e=p.A.get())||void 0===e||e.reload()})))})),(0,r.A)(this,"onBugReport",(()=>{f.Ay.createDialog(nn.A,{})})),(0,r.A)(this,"getVersionTextToCopy",(()=>{const{appVersion:e,cryptoVersion:t}=this.getVersionInfo();return`${e}\n${t}`})),this.state={appVersion:null,canUpdate:!1}}componentDidMount(){var e,t;null===(e=p.A.get())||void 0===e||e.getAppVersion().then((e=>this.setState({appVersion:e}))).catch((e=>{l.v.error("Error getting vector version: ",e)})),null===(t=p.A.get())||void 0===t||t.canSelfUpdate().then((e=>this.setState({canUpdate:e}))).catch((e=>{l.v.error("Error getting self updatability: ",e)}))}getVersionInfo(){var e,t;const n=g.Ay.get().brand,i=this.state.appVersion||"unknown",r=null!==(e=null===(t=this.context.getCrypto())||void 0===t?void 0:t.getVersion())&&void 0!==e?e:"<not-enabled>";return{appVersion:`${(0,C._t)("setting|help_about|brand_version",{brand:n})} ${i}`,cryptoVersion:`${(0,C._t)("setting|help_about|crypto_version")} ${r}`}}renderLegal(){const e=g.Ay.get().terms_and_conditions_links;if(!e)return null;const t=[];for(const n of e)t.push(o.createElement("div",{key:n.url},o.createElement(sn.A,{href:n.url},n.text)));return o.createElement(Tt.Ay,{heading:(0,C._t)("common|legal")},o.createElement(Tt.sS,null,t))}renderCredits(){return o.createElement(Tt.Ay,{heading:(0,C._t)("common|credits")},o.createElement(Tt.sS,null,o.createElement("ul",null,o.createElement("li",null,(0,C._t)("credits|default_cover_photo",{},{photo:e=>o.createElement(sn.A,{href:"themes/element/img/backgrounds/lake.jpg",rel:"noreferrer noopener",target:"_blank"},e),author:e=>o.createElement(sn.A,{href:"https://www.flickr.com/golan"},e),terms:e=>o.createElement(sn.A,{href:"https://creativecommons.org/licenses/by-sa/4.0/",rel:"noreferrer noopener",target:"_blank"},e)})),o.createElement("li",null,(0,C._t)("credits|twemoji_colr",{},{colr:e=>o.createElement(sn.A,{href:"https://github.com/matrix-org/twemoji-colr",rel:"noreferrer noopener",target:"_blank"},e),author:e=>o.createElement(sn.A,{href:"https://mozilla.org"},e),terms:e=>o.createElement(sn.A,{href:"https://www.apache.org/licenses/LICENSE-2.0",rel:"noreferrer noopener",target:"_blank"},e)})),o.createElement("li",null,(0,C._t)("credits|twemoji",{},{twemoji:e=>o.createElement(sn.A,{href:"https://twemoji.twitter.com/"},e),author:e=>o.createElement(sn.A,{href:"https://twemoji.twitter.com/"},e),terms:e=>o.createElement(sn.A,{href:"https://creativecommons.org/licenses/by/4.0/",rel:"noreferrer noopener",target:"_blank"},e)})))))}render(){const e=g.Ay.get().brand,t=(0,C._t)("setting|help_about|help_link",{brand:e},{a:e=>o.createElement(sn.A,{href:g.Ay.get("help_url")},e)});let n,i;this.state.canUpdate&&(n=o.createElement(gb,null)),g.Ay.get().bug_report_endpoint_url&&(i=o.createElement(Tt.Ay,{heading:(0,C._t)("bug_reporting|title"),description:o.createElement(o.Fragment,null,o.createElement(Tt.sS,null,(0,C._t)("bug_reporting|introduction")),(0,C._t)("bug_reporting|description"))},o.createElement(be.A,{onClick:this.onBugReport,kind:"primary_outline"},(0,C._t)("bug_reporting|submit_debug_logs")),o.createElement(Tt.sS,null,(0,C._t)("bug_reporting|matrix_security_issue",{},{a:e=>o.createElement(sn.A,{href:"https://matrix.org/security-disclosure-policy/"},e)}))));const{appVersion:r,cryptoVersion:s}=this.getVersionInfo();return o.createElement(Rt.A,null,o.createElement(It.X,null,i,o.createElement(Tt.Ay,{heading:(0,C._t)("common|faq"),description:t}),o.createElement(Tt.Ay,{heading:(0,C._t)("setting|help_about|versions")},o.createElement(Tt.sS,null,o.createElement(wf.A,{getTextToCopy:this.getVersionTextToCopy},r,o.createElement("br",null),s,o.createElement("br",null)),n)),this.renderLegal(),this.renderCredits(),o.createElement(Tt.Ay,{heading:(0,C._t)("common|advanced")},o.createElement(Tt.sS,null,(0,C._t)("setting|help_about|homeserver",{homeserverUrl:this.context.getHomeserverUrl()},{code:e=>o.createElement("code",null,e)})),this.context.getIdentityServerUrl()&&o.createElement(Tt.sS,null,(0,C._t)("setting|help_about|identity_server",{identityServerUrl:this.context.getIdentityServerUrl()},{code:e=>o.createElement("code",null,e)})),o.createElement(Tt.sS,null,o.createElement("details",null,o.createElement("summary",{className:"mx_HelpUserSettingsTab_accessTokenDetails"},(0,C._t)("common|access_token")),o.createElement("b",null,(0,C._t)("setting|help_about|access_token_detail")),o.createElement(wf.A,{getTextToCopy:()=>this.context.getAccessToken()},this.context.getAccessToken()))),o.createElement(be.A,{onClick:this.onClearCacheAndReload,kind:"danger_outline"},(0,C._t)("setting|help_about|clear_cache_reload")))))}}(0,r.A)(vb,"contextType",Re.Ay);var _b=n("./node_modules/matrix-react-sdk/src/mjolnir/Mjolnir.ts"),fb=n("./node_modules/matrix-react-sdk/src/mjolnir/BanList.ts");class yb extends o.Component{constructor(e){super(e),(0,r.A)(this,"onPersonalRuleChanged",(e=>{this.setState({newPersonalRule:e.target.value})})),(0,r.A)(this,"onNewListChanged",(e=>{this.setState({newList:e.target.value})})),(0,r.A)(this,"onAddPersonalRule",(async e=>{e.preventDefault(),e.stopPropagation();let t=fb.fy;this.state.newPersonalRule.startsWith("@")&&(t=fb.ZZ),this.setState({busy:!0});try{const e=await _b.u.sharedInstance().getOrCreatePersonalList();await e.banEntity(t,this.state.newPersonalRule,(0,C._t)("labs_mjolnir|ban_reason")),this.setState({newPersonalRule:""})}catch(e){l.v.error(e),f.Ay.createDialog(lc.A,{title:(0,C._t)("labs_mjolnir|error_adding_ignore"),description:(0,C._t)("labs_mjolnir|something_went_wrong")})}finally{this.setState({busy:!1})}})),(0,r.A)(this,"onSubscribeList",(async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});try{const e=await h.J.safeGet().joinRoom(this.state.newList);await _b.u.sharedInstance().subscribeToList(e.roomId),this.setState({newList:""})}catch(e){l.v.error(e),f.Ay.createDialog(lc.A,{title:(0,C._t)("labs_mjolnir|error_adding_list_title"),description:(0,C._t)("labs_mjolnir|error_adding_list_description")})}finally{this.setState({busy:!1})}})),this.state={busy:!1,newPersonalRule:"",newList:""}}async removePersonalRule(e){this.setState({busy:!0});try{const t=_b.u.sharedInstance().getPersonalList();await t.unbanEntity(e.kind,e.entity)}catch(e){l.v.error(e),f.Ay.createDialog(lc.A,{title:(0,C._t)("labs_mjolnir|error_removing_ignore"),description:(0,C._t)("labs_mjolnir|something_went_wrong")})}finally{this.setState({busy:!1})}}async unsubscribeFromList(e){this.setState({busy:!0});try{await _b.u.sharedInstance().unsubscribeFromList(e.roomId),await h.J.safeGet().leave(e.roomId)}catch(e){l.v.error(e),f.Ay.createDialog(lc.A,{title:(0,C._t)("labs_mjolnir|error_removing_list_title"),description:(0,C._t)("labs_mjolnir|error_removing_list_description")})}finally{this.setState({busy:!1})}}viewListRules(e){const t=h.J.safeGet().getRoom(e.roomId),n=t?t.name:e.roomId,i=e=>{if(0===e.length)return o.createElement("i",null,(0,C._t)("labs_mjolnir|rules_empty"));const t=[];for(const n of e)t.push(o.createElement("li",{key:n.kind+n.entity},o.createElement("code",null,n.entity)));return o.createElement("ul",null,t)};f.Ay.createDialog(z.A,{title:(0,C._t)("labs_mjolnir|rules_title",{roomName:n}),description:o.createElement("div",null,o.createElement("h3",null,(0,C._t)("labs_mjolnir|rules_server")),i(e.serverRules),o.createElement("h3",null,(0,C._t)("labs_mjolnir|rules_user")),i(e.userRules)),button:(0,C._t)("action|close"),hasCancelButton:!1})}renderPersonalBanListRules(){const e=_b.u.sharedInstance().getPersonalList(),t=e?[...e.userRules,...e.serverRules]:[];if(!e||t.length<=0)return o.createElement("i",null,(0,C._t)("labs_mjolnir|personal_empty"));const n=[];for(const e of t)n.push(o.createElement("li",{key:e.entity,className:"mx_MjolnirUserSettingsTab_listItem"},o.createElement(be.A,{kind:"danger_sm",onClick:()=>this.removePersonalRule(e),disabled:this.state.busy},(0,C._t)("action|remove"))," ",o.createElement("code",null,e.entity)));return o.createElement("div",null,o.createElement("p",null,(0,C._t)("labs_mjolnir|personal_section")),o.createElement("ul",null,n))}renderSubscribedBanLists(){const e=_b.u.sharedInstance().getPersonalList(),t=_b.u.sharedInstance().lists.filter((t=>!e||e.roomId!==t.roomId));if(!t||t.length<=0)return o.createElement("i",null,(0,C._t)("labs_mjolnir|no_lists"));const n=[];for(const e of t){const t=h.J.safeGet().getRoom(e.roomId),i=t?o.createElement("span",null,t.name," (",o.createElement("code",null,e.roomId),")"):o.createElement("code",null,"list.roomId");n.push(o.createElement("li",{key:e.roomId,className:"mx_MjolnirUserSettingsTab_listItem"},o.createElement(be.A,{kind:"danger_sm",onClick:()=>this.unsubscribeFromList(e),disabled:this.state.busy},(0,C._t)("action|unsubscribe"))," ",o.createElement(be.A,{kind:"primary_sm",onClick:()=>this.viewListRules(e),disabled:this.state.busy},(0,C._t)("labs_mjolnir|view_rules"))," ",i))}return o.createElement("div",null,o.createElement("p",null,(0,C._t)("labs_mjolnir|lists")),o.createElement("ul",null,n))}render(){const e=g.Ay.get().brand;return o.createElement(Rt.A,null,o.createElement(It.X,null,o.createElement(Tt.sS,null,o.createElement("strong",{className:"warning"},(0,C._t)("labs_mjolnir|advanced_warning")),o.createElement("p",null,(0,C._t)("labs_mjolnir|explainer_1",{brand:e},{code:e=>o.createElement("code",null,e)})),o.createElement("p",null,(0,C._t)("labs_mjolnir|explainer_2"))),o.createElement(Tt.Ay,{heading:(0,C._t)("labs_mjolnir|personal_heading"),description:(0,C._t)("labs_mjolnir|personal_description",{myBanList:(0,C._t)("labs_mjolnir|room_name")})},this.renderPersonalBanListRules(),o.createElement("form",{onSubmit:this.onAddPersonalRule,autoComplete:"off"},o.createElement(tn.A,{type:"text",label:(0,C._t)("labs_mjolnir|personal_new_label"),placeholder:(0,C._t)("labs_mjolnir|personal_new_placeholder"),value:this.state.newPersonalRule,onChange:this.onPersonalRuleChanged}),o.createElement(be.A,{type:"submit",kind:"primary",onClick:this.onAddPersonalRule,disabled:this.state.busy},(0,C._t)("action|ignore")))),o.createElement(Tt.Ay,{heading:(0,C._t)("labs_mjolnir|lists_heading"),description:o.createElement(o.Fragment,null,o.createElement("strong",{className:"warning"},(0,C._t)("labs_mjolnir|lists_description_1"))," ",o.createElement("span",null,(0,C._t)("labs_mjolnir|lists_description_2")))},this.renderSubscribedBanLists(),o.createElement("form",{onSubmit:this.onSubscribeList,autoComplete:"off"},o.createElement(tn.A,{type:"text",label:(0,C._t)("labs_mjolnir|lists_new_label"),value:this.state.newList,onChange:this.onNewListChanged}),o.createElement(be.A,{type:"submit",kind:"primary",onClick:this.onSubscribeList,disabled:this.state.busy},(0,C._t)("action|subscribe"))))))}}var Eb=n("./node_modules/matrix-react-sdk/src/accessibility/KeyboardShortcutUtils.ts");const bb=Object.entries(Ee.R6).filter((([e])=>e!==Ee.md.LABS||fy())),wb=({name:e})=>{const t=(0,Eb.Lt)(e),n=(0,Eb.Tz)(e);return t&&n?o.createElement("li",{className:"mx_KeyboardShortcut_shortcutRow"},t,o.createElement(ci.S,{value:n})):null},xb=({categoryName:e,category:t})=>t.categoryLabel?o.createElement(Tt.Ay,{heading:(0,C._t)(t.categoryLabel),key:e},o.createElement("ul",{className:"mx_KeyboardShortcut_shortcutList"},t.settingNames.map((e=>o.createElement(wb,{key:e,name:e}))))):null,Ab=()=>o.createElement(Rt.A,null,o.createElement(It.X,null,bb.map((([e,t])=>o.createElement(xb,{key:e,categoryName:e,category:t})))));var Sb,Cb=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/VerificationRequestDialog.tsx");function kb(){return kb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},kb.apply(null,arguments)}var Rb=function(e,t){return o.createElement("svg",kb({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),Sb||(Sb=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 8.818 7.125 12 14 5"})))},Ib=(0,o.forwardRef)(Rb);const Tb=["value","options","selectedLabel","className"],Pb=(e,t)=>n=>{const i=e.find((({id:e})=>e===n));return i?t?`${t}: ${i.label}`:i.label:null},Nb=e=>{let{value:t,options:n,selectedLabel:r,className:s}=e,a=(0,Ue.A)(e,Tb);return o.createElement(Ut.A,(0,i.A)({},a,{value:t,className:ee()("mx_FilterDropdown",s),getShortOption:Pb(n,r)}),n.map((({id:e,label:n,description:i})=>o.createElement("div",{className:"mx_FilterDropdown_option",key:e},e===t&&o.createElement(Ib,{className:"mx_FilterDropdown_optionSelectedIcon"}),o.createElement("span",{className:"mx_FilterDropdown_optionLabel"},n),!!i&&o.createElement("span",{className:"mx_FilterDropdown_optionDescription"},i)))))},Db=["title","description"],Mb=e=>{let{title:t,description:n}=e,r=(0,Ue.A)(e,Db);return o.createElement(be.A,(0,i.A)({},r,{kind:"link_inline",onClick:()=>{f.Ay.createDialog(rn.A,{title:t,description:n,button:(0,C._t)("action|got_it"),hasCloseButton:!0})},className:"mx_LearnMore_button"}),(0,C._t)("action|learn_more"))},Ob=({device:e,saveDeviceName:t,stopEditing:n})=>{const[i,r]=(0,o.useState)(e.display_name||""),[s,a]=(0,o.useState)(!1),[l,c]=(0,o.useState)(null);(0,o.useEffect)((()=>{r(e.display_name||"")}),[e.display_name]);const d=async e=>{a(!0),c(null),e.preventDefault();try{await t(i),n()}catch(e){c((0,C._t)("settings|sessions|error_set_name")),a(!1)}},u=`device-rename-${e.device_id}`,m=`device-rename-description-${e.device_id}`;return o.createElement("form",{"aria-disabled":s,className:"mx_DeviceDetailHeading_renameForm",onSubmit:d,method:"post"},o.createElement("p",{id:u,className:"mx_DeviceDetailHeading_renameFormHeading"},(0,C._t)("settings|sessions|rename_form_heading")),o.createElement("div",null,o.createElement(tn.A,{type:"text",value:i,autoComplete:"off",onChange:e=>r(e.target.value),autoFocus:!0,disabled:s,"aria-labelledby":u,"aria-describedby":m,className:"mx_DeviceDetailHeading_renameFormInput",maxLength:100}),o.createElement(_E.H,{id:m},(0,C._t)("settings|sessions|rename_form_caption"),o.createElement(Mb,{title:(0,C._t)("settings|sessions|rename_form_learn_more"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("settings|sessions|rename_form_learn_more_description_1")),o.createElement("p",null,(0,C._t)("settings|sessions|rename_form_learn_more_description_2")))}),!!l&&o.createElement("span",{className:"mx_DeviceDetailHeading_renameFormError"},l))),o.createElement("div",{className:"mx_DeviceDetailHeading_renameFormButtons"},o.createElement(be.A,{onClick:d,kind:"primary",disabled:s},(0,C._t)("action|save")),o.createElement(be.A,{onClick:n,kind:"secondary",disabled:s},(0,C._t)("action|cancel")),s&&o.createElement(dn.A,{w:16,h:16})))},Lb=({device:e,saveDeviceName:t})=>{const[n,i]=(0,o.useState)(!1);return n?o.createElement(Ob,{device:e,saveDeviceName:t,stopEditing:()=>i(!1)}):o.createElement("div",{className:"mx_DeviceDetailHeading"},o.createElement(Ii.A,{size:"4"},e.display_name||e.device_id),o.createElement(be.A,{kind:"link_inline",onClick:()=>i(!0),className:"mx_DeviceDetailHeading_renameCta"},(0,C._t)("action|rename")))};var Ub;function Fb(){return Fb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Fb.apply(null,arguments)}var jb=function(e,t){return o.createElement("svg",Fb({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),Ub||(Ub=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 3.05v6.22C2 15.63 9 17 9 17s7-1.37 7-7.73V3.05L9 1zm9.94 2.47c.19-.18.49-.17.67.02.16.18.16.45.02.63l-4.22 5.11-.03.04c-.28.34-.79.39-1.13.11a.3.3 0 0 1-.077-.067l-.023-.023-1.81-2.08c-.2-.24-.18-.6.06-.8.2-.18.49-.18.7-.04l1.57 1.1z",clipRule:"evenodd"})))},Bb=(0,o.forwardRef)(jb);var Vb=n("./node_modules/matrix-react-sdk/res/img/e2e/warning.svg"),Hb=n("./node_modules/matrix-react-sdk/res/img/element-icons/settings/inactive.svg"),zb=n("./node_modules/matrix-react-sdk/src/components/views/settings/devices/types.ts");const Wb={[zb.e.Inactive]:Hb.I,[zb.e.Verified]:Bb,[zb.e.Unverified]:Vb.I,[zb.e.Unverifiable]:Vb.I},Gb=({variation:e})=>{const t=Wb[e];return o.createElement("div",{className:ee()("mx_DeviceSecurityCard_icon",e)},o.createElement(t,{height:16,width:16}))},Kb=({variation:e,heading:t,description:n,children:i})=>o.createElement("div",{className:"mx_DeviceSecurityCard"},o.createElement(Gb,{variation:e}),o.createElement("div",{className:"mx_DeviceSecurityCard_content"},o.createElement("p",{className:"mx_DeviceSecurityCard_heading"},t),o.createElement("p",{className:"mx_DeviceSecurityCard_description"},n),!!i&&o.createElement("div",{className:"mx_DeviceSecurityCard_actions"},i))),Jb={[zb.e.Verified]:{title:(0,C._t)("settings|sessions|verified_sessions"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("settings|sessions|verified_sessions_explainer_1")),o.createElement("p",null,(0,C._t)("settings|sessions|verified_sessions_explainer_2")))},[zb.e.Unverified]:{title:(0,C._t)("settings|sessions|unverified_sessions"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("settings|sessions|unverified_sessions_explainer_1")),o.createElement("p",null,(0,C._t)("settings|sessions|unverified_sessions_explainer_2")))},[zb.e.Unverifiable]:{title:(0,C._t)("settings|sessions|unverified_session"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("settings|sessions|unverified_session_explainer_1")),o.createElement("p",null,(0,C._t)("settings|sessions|unverified_session_explainer_2")),o.createElement("p",null,(0,C._t)("settings|sessions|unverified_session_explainer_3")))},[zb.e.Inactive]:{title:(0,C._t)("settings|sessions|inactive_sessions"),description:o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("settings|sessions|inactive_sessions_explainer_1")),o.createElement("p",null,(0,C._t)("settings|sessions|inactive_sessions_explainer_2")))}},qb=({variation:e})=>{const{title:t,description:n}=Jb[e];return o.createElement(Mb,{title:t,description:n})},$b=({device:e,isCurrentDevice:t,onVerifyDevice:n})=>{const i=((e,t)=>{if(e.isVerified){const e=t?(0,C._t)("settings|sessions|device_verified_description_current"):(0,C._t)("settings|sessions|device_verified_description");return{variation:zb.e.Verified,heading:(0,C._t)("settings|sessions|verified_session"),description:o.createElement(o.Fragment,null,e,o.createElement(qb,{variation:zb.e.Verified}))}}if(null===e.isVerified)return{variation:zb.e.Unverified,heading:(0,C._t)("settings|sessions|unverified_session"),description:o.createElement(o.Fragment,null,(0,C._t)("settings|sessions|unverified_session_explainer_1"),o.createElement(qb,{variation:zb.e.Unverifiable}))};const n=t?(0,C._t)("settings|sessions|device_unverified_description_current"):(0,C._t)("settings|sessions|device_unverified_description");return{variation:zb.e.Unverified,heading:(0,C._t)("settings|sessions|unverified_session"),description:o.createElement(o.Fragment,null,n,o.createElement(qb,{variation:zb.e.Unverified}))}})(e,t);return o.createElement(Kb,i,!1===e.isVerified&&!!n&&o.createElement(be.A,{kind:"primary",onClick:n},(0,C._t)("settings|sessions|verify_session")))};function Yb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Qb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yb(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Zb=({device:e,pusher:t,localNotificationSettings:n,isSigningOut:i,onVerifyDevice:r,onSignOutDevice:a,saveDeviceName:l,setPushNotifications:c,supportsMSC3881:d,className:u,isCurrentDevice:m})=>{const h=[{id:"session",values:[{label:(0,C._t)("settings|sessions|session_id"),value:e.device_id},{label:(0,C._t)("settings|sessions|last_activity"),value:e.last_seen_ts&&(0,Ms.Yq)(new Date(e.last_seen_ts))}]},{id:"application",heading:(0,C._t)("common|application"),values:[{label:(0,C._t)("common|name"),value:e.appName},{label:(0,C._t)("common|version"),value:e.appVersion},{label:(0,C._t)("settings|sessions|url"),value:e.url}]},{id:"device",heading:(0,C._t)("common|device"),values:[{label:(0,C._t)("common|model"),value:e.deviceModel},{label:(0,C._t)("settings|sessions|os"),value:e.deviceOperatingSystem},{label:(0,C._t)("settings|sessions|browser"),value:e.client},{label:(0,C._t)("settings|sessions|ip"),value:e.last_seen_ip}]}].map((e=>Qb(Qb({},e),{},{values:e.values.filter((e=>!!e.value))}))).filter((e=>e.values.length)),p=!!t||!!n;return o.createElement("div",{className:ee()("mx_DeviceDetails",u)},o.createElement("section",{className:"mx_DeviceDetails_section"},o.createElement(Lb,{device:e,saveDeviceName:l}),o.createElement($b,{device:e,onVerifyDevice:r,isCurrentDevice:!0})),o.createElement("section",{className:"mx_DeviceDetails_section"},o.createElement("p",{className:"mx_DeviceDetails_sectionHeading"},(0,C._t)("settings|sessions|details_heading")),h.map((({heading:e,values:t,id:n},i)=>o.createElement("table",{className:"mx_DeviceDetails_metadataTable",key:i},e&&o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",null,e))),o.createElement("tbody",null,t.map((({label:e,value:t})=>o.createElement("tr",{key:e},o.createElement("td",{className:"mxDeviceDetails_metadataLabel"},e),o.createElement("td",{className:"mxDeviceDetails_metadataValue"},t))))))))),p&&o.createElement("section",{className:"mx_DeviceDetails_section mx_DeviceDetails_pushNotifications"},o.createElement(lE.A,{checked:function(e){return e?!!e[s.PUSHER_ENABLED.name]:!n||!n.is_silenced}(t),disabled:function(e){return!n&&!(!e||d)}(t),onChange:t=>null==c?void 0:c(e.device_id,t),title:(0,C._t)("settings|sessions|push_toggle")}),o.createElement("p",{className:"mx_DeviceDetails_sectionHeading"},(0,C._t)("settings|sessions|push_heading"),o.createElement("small",{className:"mx_DeviceDetails_sectionSubheading"},(0,C._t)("settings|sessions|push_subheading")))),o.createElement("section",{className:"mx_DeviceDetails_section"},o.createElement(be.A,{onClick:a,kind:"danger_inline",disabled:i},o.createElement("span",{className:"mx_DeviceDetails_signOutButtonContent"},(0,C._t)("settings|sessions|sign_out"),i&&o.createElement(dn.A,{w:16,h:16})))))};var Xb;function ew(){return ew=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ew.apply(null,arguments)}var tw=function(e,t){return o.createElement("svg",ew({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 6",role:"presentation","aria-hidden":!0,ref:t},e),Xb||(Xb=o.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.3},o.createElement("path",{d:"m1.5 1.5 3.859 3.254M9.132 1.56 5.359 4.754"}))))},nw=(0,o.forwardRef)(tw);const iw=["isExpanded","onClick"],rw=e=>{let{isExpanded:t,onClick:n}=e,r=(0,Ue.A)(e,iw);const s=t?(0,C._t)("settings|sessions|hide_details"):(0,C._t)("settings|sessions|show_details");return o.createElement(be.A,(0,i.A)({},r,{"aria-label":s,title:s,kind:"icon",className:ee()("mx_DeviceExpandDetailsButton",{mx_DeviceExpandDetailsButton_expanded:t}),onClick:n}),o.createElement(nw,{className:"mx_DeviceExpandDetailsButton_icon"}))};var ow,sw=n("./node_modules/matrix-react-sdk/src/components/views/settings/devices/filter.ts");function aw(){return aw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},aw.apply(null,arguments)}var lw=function(e,t){return o.createElement("svg",aw({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 22 23",role:"presentation","aria-hidden":!0,ref:t},e),ow||(ow=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M11 22.5c6.075 0 11-4.925 11-11S17.075.5 11 .5 0 5.425 0 11.5s4.925 11 11 11m0-4.24a1.375 1.375 0 1 0 0-2.75 1.375 1.375 0 0 0 0 2.75M9.09 9.429A1.91 1.91 0 0 1 11 7.518c1.048 0 1.91.862 1.91 1.91 0 .485-.208.659-1.026 1.224-.363.25-.86.598-1.246 1.108-.415.546-.67 1.227-.67 2.093h2.063c0-.424.113-.666.25-.846.164-.217.402-.4.775-.659l.124-.084c.676-.46 1.792-1.219 1.792-2.836A3.98 3.98 0 0 0 11 5.456a3.97 3.97 0 0 0-3.973 3.972z",clipRule:"evenodd"})))},cw=(0,o.forwardRef)(lw);var dw;function uw(){return uw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},uw.apply(null,arguments)}var mw=function(e,t){return o.createElement("svg",uw({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 22 19",role:"presentation","aria-hidden":!0,ref:t},e),dw||(dw=o.createElement("path",{fill:"currentColor",d:"M3 15.5q-.824 0-1.412-.587A1.93 1.93 0 0 1 1 13.5v-11q0-.825.588-1.413A1.93 1.93 0 0 1 3 .5h16q.825 0 1.413.587Q21 1.675 21 2.5v11q0 .825-.587 1.413A1.93 1.93 0 0 1 19 15.5zm0-2h16v-11H3zm-2 5a.97.97 0 0 1-.712-.288A.97.97 0 0 1 0 17.5q0-.424.288-.712A.97.97 0 0 1 1 16.5h20q.424 0 .712.288A.97.97 0 0 1 22 17.5q0 .424-.288.712A.97.97 0 0 1 21 18.5zm2-5v-11z"})))},hw=(0,o.forwardRef)(mw);var pw;function gw(){return gw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},gw.apply(null,arguments)}var vw=function(e,t){return o.createElement("svg",gw({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 17",role:"presentation","aria-hidden":!0,ref:t},e),pw||(pw=o.createElement("path",{fill:"currentColor",d:"M18 16.5H2q-.824 0-1.412-.587A1.93 1.93 0 0 1 0 14.5v-12q0-.825.588-1.412A1.92 1.92 0 0 1 2 .5h16q.825 0 1.413.588Q20 1.675 20 2.5v12q0 .825-.587 1.413A1.93 1.93 0 0 1 18 16.5M2 4.5v10h16v-10z"})))},_w=(0,o.forwardRef)(vw);var fw;function yw(){return yw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},yw.apply(null,arguments)}var Ew=function(e,t){return o.createElement("svg",yw({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 23",role:"presentation","aria-hidden":!0,ref:t},e),fw||(fw=o.createElement("path",{fill:"currentColor",d:"M12 .51 2 .5c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-18c0-1.1-.9-1.99-2-1.99m0 17.99H2v-14h10z"})))},bw=(0,o.forwardRef)(Ew);const ww={[Jy.b.Desktop]:hw,[Jy.b.Mobile]:bw,[Jy.b.Web]:_w,[Jy.b.Unknown]:cw},xw={[Jy.b.Desktop]:(0,C.AO)("settings|sessions|desktop_session"),[Jy.b.Mobile]:(0,C.AO)("settings|sessions|mobile_session"),[Jy.b.Web]:(0,C.AO)("settings|sessions|web_session"),[Jy.b.Unknown]:(0,C.AO)("settings|sessions|unknown_session")},Aw=({isVerified:e,isSelected:t,deviceType:n})=>{const i=ww[n]||ww[Jy.b.Unknown],r=(0,C._t)(xw[n]||xw[Jy.b.Unknown]);return o.createElement("div",{className:ee()("mx_DeviceTypeIcon",{mx_DeviceTypeIcon_selected:t})},o.createElement("div",{className:"mx_DeviceTypeIcon_deviceIconWrapper"},o.createElement(i,{className:"mx_DeviceTypeIcon_deviceIcon",role:"img","aria-label":r})),e?o.createElement(Bb,{className:ee()("mx_DeviceTypeIcon_verificationIcon","verified"),role:"img","aria-label":(0,C._t)("common|verified")}):o.createElement(Vb.I,{className:ee()("mx_DeviceTypeIcon_verificationIcon","unverified"),role:"img","aria-label":(0,C._t)("common|unverified")}))};var Sw=n("./node_modules/matrix-react-sdk/src/utils/NativeEventUtils.ts"),Cw=n("./node_modules/matrix-react-sdk/src/components/views/settings/devices/DeviceMetaData.tsx");const kw=({device:e})=>o.createElement(Ii.A,{size:"4"},e.display_name||e.device_id),Rw=({device:e,children:t,isSelected:n,onClick:i})=>o.createElement("div",{className:ee()("mx_DeviceTile",{mx_DeviceTile_interactive:!!i}),onClick:i},o.createElement(Aw,{isVerified:e.isVerified,isSelected:n,deviceType:e.deviceType}),o.createElement("div",{className:"mx_DeviceTile_info"},o.createElement(kw,{device:e}),o.createElement("div",{className:"mx_DeviceTile_metadata"},o.createElement(Cw.e,{device:e}))),o.createElement("div",{className:"mx_DeviceTile_actions",onClick:(0,Sw.Z)((()=>{}))},t)),Iw=({children:e,device:t,isSelected:n,onSelect:i,onClick:r})=>o.createElement("div",{className:"mx_SelectableDeviceTile"},o.createElement(at.A,{kind:at.x.Solid,checked:n,onChange:i,className:"mx_SelectableDeviceTile_checkbox",id:`device-tile-checkbox-${t.device_id}`},o.createElement(Rw,{device:t,onClick:r,isSelected:n},e))),Tw=["selectedDeviceCount","isAllSelected","isSelectDisabled","toggleSelectAll","children"],Pw=e=>{let{selectedDeviceCount:t,isAllSelected:n,isSelectDisabled:r,toggleSelectAll:s,children:a}=e,l=(0,Ue.A)(e,Tw);const c=n?(0,C._t)("common|deselect_all"):(0,C._t)("common|select_all");return o.createElement("div",(0,i.A)({className:"mx_FilteredDeviceListHeader"},l),!r&&o.createElement(ke.m_,{label:c,placement:"top",isTriggerInteractive:!1},o.createElement(at.A,{kind:at.x.Solid,checked:n,onChange:s,id:"device-select-all-checkbox","aria-label":c})),o.createElement("span",{className:"mx_FilteredDeviceListHeader_label"},t>0?(0,C._t)("settings|sessions|n_sessions_selected",{count:t}):(0,C._t)("settings|sessions|title")),a)},Nw=(e,t)=>t.includes(e),Dw=(e,t)=>(t.last_seen_ts||0)-(e.last_seen_ts||0)||(e.display_name||e.device_id).localeCompare(t.display_name||t.device_id),Mw="ALL",Ow=({filter:e})=>{if((e=>!!e&&[zb.e.Inactive,zb.e.Unverified,zb.e.Verified].includes(e))(e)){const t={[zb.e.Verified]:{title:(0,C._t)("settings|sessions|verified_sessions"),description:(0,C._t)("settings|sessions|verified_sessions_list_description")},[zb.e.Unverified]:{title:(0,C._t)("settings|sessions|unverified_sessions"),description:(0,C._t)("settings|sessions|unverified_sessions_list_description")},[zb.e.Unverifiable]:{title:(0,C._t)("settings|sessions|unverified_session"),description:(0,C._t)("settings|sessions|unverified_session_explainer_1")},[zb.e.Inactive]:{title:(0,C._t)("settings|sessions|inactive_sessions"),description:(0,C._t)("settings|sessions|inactive_sessions_list_description",{inactiveAgeDays:sw.B1})}},{title:n,description:i}=t[e];return o.createElement("div",{className:"mx_FilteredDeviceList_securityCard"},o.createElement(Kb,{variation:e,heading:n,description:o.createElement("span",null,i,o.createElement(qb,{variation:e}))}))}return null},Lw=({filter:e,clearFilter:t})=>o.createElement("div",{className:"mx_FilteredDeviceList_noResults"},(e=>{switch(e){case zb.e.Verified:return(0,C._t)("settings|sessions|no_verified_sessions");case zb.e.Unverified:return(0,C._t)("settings|sessions|no_unverified_sessions");case zb.e.Inactive:return(0,C._t)("settings|sessions|no_inactive_sessions");default:return(0,C._t)("settings|sessions|no_sessions")}})(e),!!e&&o.createElement(o.Fragment,null," ",o.createElement(be.A,{kind:"link_inline",onClick:t},(0,C._t)("action|show_all")))),Uw=({device:e,pusher:t,localNotificationSettings:n,isExpanded:i,isSigningOut:r,isSelected:s,onDeviceExpandToggle:a,onSignOutDevice:l,saveDeviceName:c,onRequestDeviceVerification:d,setPushNotifications:u,toggleSelected:m,supportsMSC3881:h,isSelectDisabled:p})=>{const g=o.createElement(o.Fragment,null,r&&o.createElement(dn.A,{w:16,h:16}),o.createElement(rw,{isExpanded:i,onClick:a}));return o.createElement("li",{className:"mx_FilteredDeviceList_listItem"},p?o.createElement(Rw,{device:e,onClick:a},g):o.createElement(Iw,{isSelected:s,onSelect:m,onClick:a,device:e},g),i&&o.createElement(Zb,{device:e,pusher:t,localNotificationSettings:n,isSigningOut:r,onVerifyDevice:d,onSignOutDevice:l,saveDeviceName:c,setPushNotifications:u,supportsMSC3881:h,className:"mx_FilteredDeviceList_deviceDetails"}))},Fw=(0,o.forwardRef)((({devices:e,pushers:t,localNotificationSettings:n,filter:i,expandedDeviceIds:r,signingOutDeviceIds:a,selectedDeviceIds:l,onFilterChange:c,onDeviceExpandToggle:d,saveDeviceName:u,onSignOutDevices:m,onRequestDeviceVerification:h,setPushNotifications:p,setSelectedDeviceIds:g,supportsMSC3881:v,disableMultipleSignout:_},f)=>{const y=((e,t)=>(0,sw.Im)(Object.values(e),t?[t]:[]).sort(Dw))(e,i);function E(e){return t.find((t=>t[s.PUSHER_DEVICE_ID.name]===e.device_id))}const b=[{id:Mw,label:(0,C._t)("settings|sessions|filter_all")},{id:zb.e.Verified,label:(0,C._t)("common|verified"),description:(0,C._t)("settings|sessions|filter_verified_description")},{id:zb.e.Unverified,label:(0,C._t)("common|unverified"),description:(0,C._t)("settings|sessions|filter_unverified_description")},{id:zb.e.Inactive,label:(0,C._t)("settings|sessions|filter_inactive"),description:(0,C._t)("settings|sessions|filter_inactive_description",{inactiveAgeDays:sw.B1})}],w=l.length>=y.length,x=!!a.length;return o.createElement("div",{className:"mx_FilteredDeviceList",ref:f},o.createElement(Pw,{selectedDeviceCount:l.length,isAllSelected:w,toggleSelectAll:()=>{g(w?[]:y.map((e=>e.device_id)))},isSelectDisabled:_},l.length?o.createElement(o.Fragment,null,o.createElement(be.A,{kind:"danger_inline",disabled:x,onClick:()=>m(l),className:"mx_FilteredDeviceList_headerButton"},x&&o.createElement(dn.A,{w:16,h:16}),(0,C._t)("action|sign_out")),o.createElement(be.A,{kind:"content_inline",disabled:x,onClick:()=>g([]),className:"mx_FilteredDeviceList_headerButton"},(0,C._t)("action|cancel"))):o.createElement(Nb,{id:"device-list-filter",label:(0,C._t)("settings|sessions|filter_label"),value:i||Mw,onOptionChange:e=>{c(e===Mw?void 0:e)},options:b,selectedLabel:(0,C._t)("action|show")})),y.length?o.createElement(Ow,{filter:i}):o.createElement(Lw,{filter:i,clearFilter:()=>c(void 0)}),o.createElement("ol",{className:"mx_FilteredDeviceList_list"},y.map((e=>o.createElement(Uw,{key:e.device_id,device:e,pusher:E(e),localNotificationSettings:n.get(e.device_id),isExpanded:r.includes(e.device_id),isSigningOut:a.includes(e.device_id),isSelected:Nw(e.device_id,l),isSelectDisabled:_,onDeviceExpandToggle:()=>d(e.device_id),onSignOutDevice:()=>m([e.device_id]),saveDeviceName:t=>u(e.device_id,t),onRequestDeviceVerification:h?()=>h(e.device_id):void 0,setPushNotifications:p,toggleSelected:()=>{return t=e.device_id,void(Nw(t,l)?g(l.filter((e=>e!==t))):g([...l,t]));var t},supportsMSC3881:v})))))}));var jw=n("./node_modules/matrix-react-sdk/res/img/element-icons/context-menu.svg");const Bw=["options","title"],Vw=e=>{let{options:t,title:n}=e,r=(0,Ue.A)(e,Bw);const[s,a,l,c]=(0,Me.EF)();return o.createElement(o.Fragment,null,o.createElement(Me.VJ,(0,i.A)({},r,{onClick:l,title:n,isExpanded:s,ref:a}),o.createElement(jw.I,{className:"mx_KebabContextMenu_icon"})),s&&o.createElement(Le.Ay,(0,i.A)({onFinished:c,compact:!0,rightAligned:!0,closeOnInteraction:!0},{left:(d=a.current.getBoundingClientRect()).left+window.scrollX+d.width,top:d.bottom+window.scrollY,chevronFace:Me.t4.None}),o.createElement(Le.tx,null,t)));var d},Hw=({onSignOutCurrentDevice:e,signOutAllOtherSessions:t,otherSessionsCount:n,disabled:i})=>{const r=[o.createElement(Le.R$,{key:"sign-out",label:(0,C._t)("action|sign_out"),onClick:e,isDestructive:!0}),...t?[o.createElement(Le.R$,{key:"sign-out-all-others",label:(0,C._t)("settings|sessions|sign_out_all_other_sessions",{otherSessionsCount:n}),onClick:t,isDestructive:!0})]:[]];return o.createElement(fE.r,{heading:(0,C._t)("settings|sessions|current_session")},o.createElement(Vw,{disabled:i,title:(0,C._t)("common|options"),options:r}))},zw=({device:e,isLoading:t,isSigningOut:n,localNotificationSettings:i,otherSessionsCount:r,setPushNotifications:s,onVerifyCurrentDevice:a,onSignOutCurrentDevice:l,signOutAllOtherSessions:c,saveDeviceName:d})=>{const[u,m]=(0,o.useState)(!1);return o.createElement(Tt.Ay,{heading:o.createElement(Hw,{onSignOutCurrentDevice:l,signOutAllOtherSessions:c,otherSessionsCount:r,disabled:t||!e||n})},t&&!e&&o.createElement(dn.A,null),!!e&&o.createElement(o.Fragment,null,o.createElement(Rw,{device:e,onClick:()=>m(!u)},o.createElement(rw,{isExpanded:u,onClick:()=>m(!u)})),u?o.createElement(Zb,{device:e,localNotificationSettings:i,setPushNotifications:s,isSigningOut:n,onVerifyDevice:a,onSignOutDevice:l,saveDeviceName:d,className:"mx_CurrentDeviceSection_deviceDetails"}):o.createElement(o.Fragment,null,o.createElement("br",null),o.createElement($b,{device:e,onVerifyDevice:a,isCurrentDevice:!0}))))},Ww=({devices:e,currentDeviceId:t,goToFilteredList:n})=>{const i=Object.values(e),r=(0,sw.Im)(i,[zb.e.Unverified]).filter((e=>e.device_id!==t)).length,s=(0,sw.Im)(i,[zb.e.Inactive]).length;if(!(r|s))return null;const a=sw.B1;return o.createElement(Tt.Ay,{heading:(0,C._t)("settings|sessions|security_recommendations"),description:(0,C._t)("settings|sessions|security_recommendations_description")},!!r&&o.createElement(Kb,{variation:zb.e.Unverified,heading:(0,C._t)("settings|sessions|unverified_sessions"),description:o.createElement(o.Fragment,null,(0,C._t)("settings|sessions|unverified_sessions_list_description"),o.createElement(qb,{variation:zb.e.Unverified}))},o.createElement(be.A,{kind:"link_inline",onClick:()=>n(zb.e.Unverified)},(0,C._t)("action|view_all")+` (${r})`)),!!s&&o.createElement(o.Fragment,null,!!r&&o.createElement("div",{className:"mx_SecurityRecommendations_spacing"}),o.createElement(Kb,{variation:zb.e.Inactive,heading:(0,C._t)("settings|sessions|inactive_sessions"),description:o.createElement(o.Fragment,null,(0,C._t)("settings|sessions|inactive_sessions_list_description",{inactiveAgeDays:a}),o.createElement(qb,{variation:zb.e.Inactive}))},o.createElement(be.A,{kind:"link_inline",onClick:()=>n(zb.e.Inactive)},(0,C._t)("action|view_all")+` (${s})`))))},Gw=(e,t)=>async n=>e.deleteMultipleDevices(t,null!=n?n:void 0);var Kw=n("./node_modules/matrix-react-sdk/src/components/views/auth/LoginWithQR-types.ts");const Jw=({otherSessionsCount:e,disabled:t,signOutAllOtherSessions:n})=>{const i=(0,Pl.Bo)([n?o.createElement(Le.R$,{key:"sign-out-all-others",label:(0,C._t)("settings|sessions|sign_out_n_sessions",{count:e}),onClick:n,isDestructive:!0}):null]);return o.createElement(fE.r,{heading:(0,C._t)("settings|sessions|other_sessions_heading")},!!i.length&&o.createElement(Vw,{disabled:t,title:(0,C._t)("common|options"),options:i}))},qw=({delegatedAuthAccountUrl:e,deviceId:t,onFinished:n})=>{const[i,r]=(0,o.useState)(!1),s=((e,t)=>{const n=new URL(e);return n.searchParams.set("action","session_end"),n.searchParams.set("device_id",t),n.toString()})(e,t);return o.createElement(cn.A,{onFinished:n,title:(0,C._t)("action|sign_out"),contentId:"mx_Dialog_content"},o.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},(0,C._t)("auth|oidc|logout_redirect_warning")),o.createElement("div",{className:"mx_Dialog_buttons"},i?o.createElement(be.A,{kind:"primary",onClick:()=>n(!0)},(0,C._t)("action|close")):o.createElement(o.Fragment,null,o.createElement(be.A,{kind:"secondary",onClick:()=>n(!1)},(0,C._t)("action|cancel")),o.createElement(be.A,{element:"a",onClick:()=>r(!0),kind:"primary",href:s,target:"_blank"},(0,C._t)("action|continue")))))};function $w(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}const Yw=(0,o.lazy)((()=>Promise.all([n.e(7490),n.e(3767)]).then(n.bind(n,"./node_modules/matrix-react-sdk/src/components/views/auth/LoginWithQR.tsx")))),Qw=(e,t,n)=>{const[i,r]=(0,o.useState)([]);return{onSignOutCurrentDevice:()=>{f.Ay.createDialog(pn,{},void 0,!1,!0)},onSignOutOtherDevices:async a=>{if(a.length)if(n&&1!==a.length)l.v.warn("Unexpectedly tried to sign out multiple OIDC-aware devices.");else{if(!n){if(!await(async e=>{const{finished:t}=f.Ay.createDialog(z.A,{title:(0,C._t)("action|sign_out"),description:o.createElement("div",null,o.createElement("p",null,(0,C._t)("settings|sessions|sign_out_confirm_description",{count:e}))),cancelButton:(0,C._t)("action|cancel"),button:(0,C._t)("action|sign_out")}),[n]=await t;return!!n})(a.length))return}try{r([...i,...a]);const o=async e=>{e&&await t(),r(i.filter((e=>!a.includes(e))))};if(n){const[e]=a;try{r([...i,e]);const t=await(async(e,t)=>{const{finished:n}=f.Ay.createDialog(qw,{deviceId:t,delegatedAuthAccountUrl:e}),[i]=await n;return!!i})(n,e);await o(t)}catch(e){l.v.error("Error deleting OIDC-aware sessions",e)}}else await(async(e,t,n)=>{if(t.length)try{await Gw(e,t)(null),await n(!0,void 0)}catch(r){var i;if(!(r instanceof s.MatrixError&&401===r.httpStatus&&null!==(i=r.data)&&void 0!==i&&i.flows))throw r;const o=t.length,a={[If.av.PHASE_PREAUTH]:{title:(0,C._t)("auth|uia|sso_title"),body:(0,C._t)("settings|sessions|confirm_sign_out_sso",{count:o}),continueText:(0,C._t)("auth|sso"),continueKind:"primary"},[If.av.PHASE_POSTAUTH]:{title:(0,C._t)("settings|sessions|confirm_sign_out",{count:o}),body:(0,C._t)("settings|sessions|confirm_sign_out_body",{count:o}),continueText:(0,C._t)("settings|sessions|confirm_sign_out_continue",{count:o}),continueKind:"danger"}};f.Ay.createDialog(Qf.A,{title:(0,C._t)("common|authentication"),matrixClient:e,authData:r.data,onFinished:n,makeRequest:Gw(e,t),aestheticsForStagePhases:{[If.av.LOGIN_TYPE]:a,[If.av.UNSTABLE_LOGIN_TYPE]:a}})}})(e,a,o)}catch(e){l.v.error("Error deleting sessions",e),r(i.filter((e=>!a.includes(e))))}}},signingOutDeviceIds:i}},Zw=({showMsc4108QrCode:e})=>{var t;const{devices:n,dehydratedDeviceId:i,pushers:r,localNotificationSettings:a,currentDeviceId:c,isLoadingDeviceList:d,requestDeviceVerification:u,refreshDevices:m,saveDeviceName:h,setPushNotifications:p,supportsMSC3881:g}=Xy(),[v,_]=(0,o.useState)(),[y,E]=(0,o.useState)([]),[b,w]=(0,o.useState)([]),x=(0,o.useRef)(null),A=(0,o.useRef)(),S=(0,o.useContext)(Xt.A),k=S.client,R=(0,nl.e)((async()=>(await S.oidcClientStore.readyPromise,S.oidcClientStore.accountManagementEndpoint)),[S.oidcClientStore]),I=!!R,T=null==k?void 0:k.getUserId(),P=T&&(null==k?void 0:k.getUser(T))||void 0,N=(0,nl.e)((()=>k.getVersions()),[k]),D=(0,nl.e)((async()=>null==k?void 0:k.getCapabilities()),[k]),M=(0,o.useMemo)((()=>null==k?void 0:k.getClientWellKnown()),[k]),O=(0,nl.e)((async()=>{try{const e=await(null==k?void 0:k.getAuthIssuer());if(e)return(0,s.discoverAndValidateOIDCIssuerWellKnown)(e.issuer)}catch(e){l.v.error("Failed to discover OIDC metadata",e)}}),[k]),L=(0,nl.e)((async()=>{var e,t;return null!==(e=null===(t=k.getCrypto())||void 0===t?void 0:t.isCrossSigningReady())&&void 0!==e&&e}),[k]),{[c]:U}=n,F=(0,Ue.A)(n,[c].map($w));i&&null!==(t=F[i])&&void 0!==t&&t.isVerified&&delete F[i];const j=Object.keys(F).length,B=j>0,V=(0,o.useCallback)((e=>{if(!u)return;const t=u(e);f.Ay.createDialog(Cb.A,{verificationRequestPromise:t,member:P,onFinished:async()=>{(await t).cancel(),await m()}})}),[u,m,P]),{onSignOutCurrentDevice:H,onSignOutOtherDevices:z,signingOutDeviceIds:W}=Qw(k,(async()=>{await m(),w([])}),R);(0,o.useEffect)((()=>()=>{clearTimeout(A.current)}),[A]),(0,o.useEffect)((()=>{w([])}),[v,w]);const G=B&&!I?()=>{z(Object.keys(F))}:void 0,[K,J]=(0,o.useState)(e?Kw.Kt.Show:null),q=(0,o.useCallback)((()=>{J(null)}),[J]),$=(0,o.useCallback)((()=>{J(Kw.Kt.Show)}),[J]);return K?o.createElement(o.Suspense,{fallback:o.createElement(dn.A,null)},o.createElement(Yw,{mode:K,onFinished:q,client:k,legacy:!O&&!e})):o.createElement(Rt.A,null,o.createElement(It.X,null,o.createElement(Fn,{onShowQr:$,versions:N,capabilities:D,wellKnown:M,oidcClientConfig:O,isCrossSigningReady:L}),o.createElement(Ww,{devices:n,goToFilteredList:e=>{_(e),clearTimeout(A.current),A.current=window.setTimeout((()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}))},currentDeviceId:c}),o.createElement(zw,{device:U,localNotificationSettings:a.get(c),setPushNotifications:p,isSigningOut:W.includes(c),isLoading:d,saveDeviceName:e=>h(c,e),onVerifyCurrentDevice:()=>{f.Ay.createDialog(Hy.A,{onFinished:m})},onSignOutCurrentDevice:H,signOutAllOtherSessions:G,otherSessionsCount:j}),B&&o.createElement(Tt.Ay,{heading:o.createElement(Jw,{otherSessionsCount:j,signOutAllOtherSessions:G,disabled:!!W.length}),description:(0,C._t)("settings|sessions|best_security_note"),stretchContent:!0},o.createElement(Fw,{devices:F,pushers:r,localNotificationSettings:a,filter:v,expandedDeviceIds:y,signingOutDeviceIds:W,selectedDeviceIds:b,setSelectedDeviceIds:w,onFilterChange:_,onDeviceExpandToggle:e=>{y.includes(e)?E(y.filter((t=>t!==e))):E([...y,e])},onRequestDeviceVerification:u?V:void 0,onSignOutDevices:z,saveDeviceName:h,setPushNotifications:p,ref:x,supportsMSC3881:g,disableMultipleSignout:I}))))};function Xw(e){const t={strong:e=>o.createElement("span",{className:"mx_UserSettingsDialog_title_strong"},e)};switch(e){case Ot.v.Account:return(0,C._t)("settings|account|dialog_title",void 0,t);case Ot.v.SessionManager:return(0,C._t)("settings|sessions|dialog_title",void 0,t);case Ot.v.Appearance:return(0,C._t)("settings|appearance|dialog_title",void 0,t);case Ot.v.Notifications:return(0,C._t)("settings|notifications|dialog_title",void 0,t);case Ot.v.Preferences:return(0,C._t)("settings|preferences|dialog_title",void 0,t);case Ot.v.Keyboard:return(0,C._t)("settings|keyboard|dialog_title",void 0,t);case Ot.v.Sidebar:return(0,C._t)("settings|sidebar|dialog_title",void 0,t);case Ot.v.Voice:return(0,C._t)("settings|voip|dialog_title",void 0,t);case Ot.v.Security:return(0,C._t)("settings|security|dialog_title",void 0,t);case Ot.v.Labs:return(0,C._t)("settings|labs|dialog_title",void 0,t);case Ot.v.Mjolnir:return(0,C._t)("settings|labs_mjolnir|dialog_title",void 0,t);case Ot.v.Help:return(0,C._t)("setting|help_about|dialog_title",void 0,t)}}function ex(e){const t=(0,Ne.ti)(W.f.Voip),n=(0,Ne.ti)("feature_mjolnir"),[i,r]=(0,o.useState)(e.showMsc4108QrCode),s=()=>{const r=[];return r.push(new df.oz(Ot.v.Account,(0,C.AO)("settings|account|title"),o.createElement(H_,null),o.createElement(gy,{closeSettingsFn:e.onFinished}),"UserSettingsGeneral")),r.push(new df.oz(Ot.v.SessionManager,(0,C.AO)("settings|sessions|title"),o.createElement(W_,null),o.createElement(Zw,{showMsc4108QrCode:i}),void 0)),r.push(new df.oz(Ot.v.Appearance,(0,C.AO)("common|appearance"),o.createElement(G_.A,null),o.createElement(Uy,null),"UserSettingsAppearance")),r.push(new df.oz(Ot.v.Notifications,(0,C.AO)("notifications|enable_prompt_toast_title"),o.createElement(Cu,null),o.createElement(eb,null),"UserSettingsNotifications")),r.push(new df.oz(Ot.v.Preferences,(0,C.AO)("common|preferences"),o.createElement(J_,null),o.createElement(ab,{closeSettingsFn:e.onFinished}),"UserSettingsPreferences")),r.push(new df.oz(Ot.v.Keyboard,(0,C.AO)("settings|keyboard|title"),o.createElement($_,null),o.createElement(Ab,null),"UserSettingsKeyboard")),r.push(new df.oz(Ot.v.Sidebar,(0,C.AO)("settings|sidebar|title"),o.createElement(Q_,null),o.createElement(Mt,null),"UserSettingsSidebar")),t&&r.push(new df.oz(Ot.v.Voice,(0,C.AO)("settings|voip|title"),o.createElement(X_,null),o.createElement(db,null),"UserSettingsVoiceVideo")),r.push(new df.oz(Ot.v.Security,(0,C.AO)("room_settings|security|title"),o.createElement(tf,null),o.createElement(mE,{closeSettingsFn:e.onFinished}),"UserSettingsSecurityPrivacy")),(fy()||O.A.getFeatureSettingNames().some((e=>O.A.getBetaInfo(e))))&&r.push(new df.oz(Ot.v.Labs,(0,C.AO)("common|labs"),o.createElement(rf,null),o.createElement(yy,null),"UserSettingsLabs")),n&&r.push(new df.oz(Ot.v.Mjolnir,(0,C.AO)("labs_mjolnir|title"),o.createElement(of.A,null),o.createElement(yb,null),"UserSettingMjolnir")),r.push(new df.oz(Ot.v.Help,(0,C.AO)("setting|help_about|title"),o.createElement(af,null),o.createElement(vb,null),"UserSettingsHelpAbout")),r},[a,l]=(0,df.yz)(s(),Ot.v.Account,e.initialTabId),[c,d]=function(){const e=(0,o.useRef)(new Ef),[t,n]=(0,o.useState)(e.current.getActiveToast()),i=(0,o.useCallback)((()=>{n(e.current.getActiveToast())}),[n,e]);return(0,o.useEffect)((()=>{e.current.setCallback(i)}),[e,i]),[t,e.current]}();return o.createElement(Xt.A.Provider,{value:e.sdkContext},o.createElement(yf.Provider,{value:d},o.createElement(cn.A,{className:"mx_UserSettingsDialog",hasCancel:!0,onFinished:e.onFinished,title:Xw(a),titleClass:"mx_UserSettingsDialog_title"},o.createElement("div",{className:"mx_SettingsDialog_content"},o.createElement(df.Ay,{tabs:s(),activeTabId:a,screenName:"UserSettings",onChange:e=>{l(e),r(!1)},responsive:!0})),o.createElement("div",{className:"mx_SettingsDialog_toastContainer"},c&&o.createElement(ke.y8,null,c)))))}var tx=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/CreateRoomDialog.tsx");const nx=({failures:e,source:t,continuation:n,onFinished:i})=>{const[r,s]=(0,o.useState)(2),[a,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),h=(0,o.useRef)(i),p=new Map([["_afterCrossSigningLocalKeyChange",(0,C._t)("encryption|key_signature_upload_failed_master_key_signature")],["checkOwnCrossSigningTrust",(0,C._t)("encryption|key_signature_upload_failed_cross_signing_key_signature")],["setDeviceVerification",(0,C._t)("encryption|key_signature_upload_failed_device_cross_signing_key_signature")]]),v=(0,C._t)("encryption|key_signature_upload_failed_key_signature"),_=(0,o.useCallback)((async()=>{try{d(!0);const e=new Promise(((e,t)=>{h.current=t})).finally((()=>{l(!0)}));await Promise.race([n({shouldEmit:!1}),e]),m(!0)}catch(e){s((e=>e-1))}finally{h.current=i,d(!1)}}),[n,i]);let f;if(!u&&!a&&r>0){const n=p.get(t)||v,i=g.Ay.get().brand;f=o.createElement("div",null,o.createElement("p",null,(0,C._t)("encryption|key_signature_upload_failed_body",{brand:i})),o.createElement("p",null,n),c&&o.createElement(dn.A,null),o.createElement("pre",null,JSON.stringify(e,null,2)),o.createElement(un.A,{primaryButton:"Retry",hasCancel:!0,onPrimaryButtonClick:_,onCancel:h.current,primaryDisabled:c}))}else{let e=(0,C._t)("encryption|key_signature_upload_completed");u||(e=a?(0,C._t)("encryption|key_signature_upload_cancelled"):(0,C._t)("encryption|key_signature_upload_failed")),f=o.createElement("div",null,o.createElement("span",null,e),o.createElement(un.A,{primaryButton:(0,C._t)("action|ok"),hasCancel:!1,onPrimaryButtonClick:i}))}return o.createElement(cn.A,{title:u?(0,C._t)("encryption|key_signature_upload_success_title"):(0,C._t)("encryption|key_signature_upload_failed_title"),fixedWidth:!1,onFinished:()=>{}},f)};var ix=n("./node_modules/matrix-js-sdk/src/crypto-api/index.ts");class rx extends o.Component{render(){return o.createElement("div",null,o.createElement("h2",null,(0,C._t)("encryption|verification|complete_title")),o.createElement("p",null,(0,C._t)("encryption|verification|complete_description")),o.createElement("p",null,(0,C._t)("encryption|verification|explainer")),o.createElement(un.A,{onPrimaryButtonClick:this.props.onDone,primaryButton:(0,C._t)("encryption|verification|complete_action"),hasCancel:!1}))}}class ox extends o.Component{render(){return o.createElement("div",null,o.createElement("p",null,(0,C._t)("encryption|verification|other_party_cancelled")),o.createElement(un.A,{primaryButton:(0,C._t)("action|ok"),hasCancel:!1,onPrimaryButtonClick:this.props.onDone}))}}var sx=n("./node_modules/matrix-react-sdk/src/components/views/verification/VerificationShowSas.tsx");class ax extends o.Component{constructor(e){super(e),(0,r.A)(this,"showSasEvent",void 0),(0,r.A)(this,"onFinished",(()=>{this.props.onFinished(3===this.state.phase)})),(0,r.A)(this,"onCancelClick",(()=>{this.props.onFinished(3===this.state.phase)})),(0,r.A)(this,"onContinueClick",(()=>{this.setState({phase:2}),this.props.verifier.verify().then((()=>{this.setState({phase:3})})).catch((e=>{l.v.log("Verification failed",e)}))})),(0,r.A)(this,"onVerifierShowSas",(e=>{this.showSasEvent=e,this.setState({phase:1,sas:e.sas})})),(0,r.A)(this,"onVerifierCancel",(()=>{this.setState({phase:4})})),(0,r.A)(this,"onSasMatchesClick",(()=>{var e;null===(e=this.showSasEvent)||void 0===e||e.confirm(),this.setState({phase:2})})),(0,r.A)(this,"onVerifiedDoneClick",(()=>{this.props.onFinished(!0)}));let t=0;this.props.verifier.hasBeenCancelled&&(l.v.log("Verifier was cancelled in the background."),t=4),this.showSasEvent=null,this.state={phase:t,sasVerified:!1,opponentProfile:null,opponentProfileError:null,sas:null},this.props.verifier.on(ix.VerifierEvent.ShowSas,this.onVerifierShowSas),this.props.verifier.on(ix.VerifierEvent.Cancel,this.onVerifierCancel),this.fetchOpponentProfile()}componentWillUnmount(){4!==this.state.phase&&3!==this.state.phase&&this.props.verifier.cancel(new Error("User cancel")),this.props.verifier.removeListener(ix.VerifierEvent.ShowSas,this.onVerifierShowSas)}async fetchOpponentProfile(){try{const e=await h.J.safeGet().getProfileInfo(this.props.verifier.userId);this.setState({opponentProfile:e})}catch(e){this.setState({opponentProfileError:e})}}renderPhaseStart(){const e=this.props.verifier.userId===h.J.safeGet().getUserId();let t;const n=this.state.opponentProfile;if(n){const e=n.avatar_url?(0,Ds.lH)(n.avatar_url).getSquareThumbnailHttp(48):null;t=o.createElement("div",{className:"mx_IncomingSasDialog_opponentProfile"},o.createElement(xn.A,{name:n.displayname,idName:this.props.verifier.userId,url:e,size:"48px"}),o.createElement("h2",null,n.displayname))}else t=this.state.opponentProfileError?o.createElement("div",null,o.createElement(xn.A,{name:this.props.verifier.userId.slice(1),idName:this.props.verifier.userId,size:"48px"}),o.createElement("h2",null,this.props.verifier.userId)):o.createElement(dn.A,null);const i=[o.createElement("p",{key:"p1"},(0,C._t)("encryption|verification|incoming_sas_user_dialog_text_1")),o.createElement("p",{key:"p2"},(0,C._t)("encryption|verification|incoming_sas_user_dialog_text_2"))],r=[o.createElement("p",{key:"p1"},(0,C._t)("encryption|verification|incoming_sas_device_dialog_text_1")),o.createElement("p",{key:"p2"},(0,C._t)("encryption|verification|incoming_sas_device_dialog_text_2"))];return o.createElement("div",null,t,e?r:i,o.createElement(un.A,{primaryButton:(0,C._t)("action|continue"),hasCancel:!0,onPrimaryButtonClick:this.onContinueClick,onCancel:this.onCancelClick}))}renderPhaseShowSas(){return this.showSasEvent?o.createElement(sx.A,{sas:this.showSasEvent.sas,onCancel:this.onCancelClick,onDone:this.onSasMatchesClick,isSelf:this.props.verifier.userId===h.J.safeGet().getUserId(),inDialog:!0}):null}renderPhaseWaitForPartnerToConfirm(){return o.createElement("div",null,o.createElement(dn.A,null),o.createElement("p",null,(0,C._t)("encryption|verification|incoming_sas_dialog_waiting")))}renderPhaseVerified(){return o.createElement(rx,{onDone:this.onVerifiedDoneClick})}renderPhaseCancelled(){return o.createElement(ox,{onDone:this.onCancelClick})}render(){let e;switch(this.state.phase){case 0:e=this.renderPhaseStart();break;case 1:e=this.renderPhaseShowSas();break;case 2:e=this.renderPhaseWaitForPartnerToConfirm();break;case 3:e=this.renderPhaseVerified();break;case 4:e=this.renderPhaseCancelled()}return o.createElement(cn.A,{title:(0,C._t)("encryption|verification|incoming_sas_dialog_title"),onFinished:this.onFinished,fixedWidth:!1},e)}}var lx=n("./node_modules/matrix-react-sdk/src/stores/SetupEncryptionStore.ts"),cx=n("./node_modules/matrix-react-sdk/src/components/structures/auth/SetupEncryptionBody.tsx");class dx extends o.PureComponent{render(){return o.createElement("div",{className:"mx_CompleteSecurityBody"},this.props.children)}}var ux=n("./node_modules/matrix-react-sdk/src/components/views/auth/AuthPage.tsx");class mx extends o.Component{constructor(e){super(e),(0,r.A)(this,"onStoreUpdate",(()=>{const e=lx.s.sharedInstance();this.setState({phase:e.phase,lostKeys:e.lostKeys()})})),(0,r.A)(this,"onSkipClick",(()=>{lx.s.sharedInstance().skip()}));const t=lx.s.sharedInstance();t.on("update",this.onStoreUpdate),t.start(),this.state={phase:t.phase,lostKeys:t.lostKeys()}}componentWillUnmount(){const e=lx.s.sharedInstance();e.off("update",this.onStoreUpdate),e.stop()}render(){const{phase:e,lostKeys:t}=this.state;let n,i,r;if(e===lx.a.Loading)return null;if(e===lx.a.Intro)t?(n=o.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),i=(0,C._t)("encryption|verification|after_new_login|unable_to_verify")):(n=o.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),i=(0,C._t)("encryption|verification|after_new_login|verify_this_device"));else if(e===lx.a.Done)n=o.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_verified"}),i=(0,C._t)("encryption|verification|after_new_login|device_verified");else if(e===lx.a.ConfirmSkip)n=o.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),i=(0,C._t)("common|are_you_sure");else if(e===lx.a.Busy)n=o.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),i=(0,C._t)("encryption|verification|after_new_login|verify_this_device");else if(e===lx.a.ConfirmReset)n=o.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),i=(0,C._t)("encryption|verification|after_new_login|reset_confirmation");else if(e!==lx.a.Finished)throw new Error(`Unknown phase ${e}`);return e!==lx.a.Intro&&e!==lx.a.ConfirmReset||(r=o.createElement(be.A,{onClick:this.onSkipClick,className:"mx_CompleteSecurity_skip","aria-label":(0,C._t)("encryption|verification|after_new_login|skip_verification")})),o.createElement(ux.A,null,o.createElement(dx,null,o.createElement("h1",{className:"mx_CompleteSecurity_header"},n,i,r),o.createElement("div",{className:"mx_CompleteSecurity_body"},o.createElement(cx.A,{onFinished:this.props.onFinished}))))}}function hx(e){var t;(0,C.UK)()!==e&&(O.A.setValue("language",null,re.p.DEVICE,e),null===(t=p.A.get())||void 0===t||t.reload())}function px({disabled:e}){return g.Ay.get("disable_login_language_selector")?o.createElement("div",null):o.createElement(tb,{className:"mx_AuthBody_language",onOptionChange:hx,value:(0,C.UK)(),disabled:e})}const gx=`<a href="https://matrix.org" target="_blank" rel="noreferrer noopener">\n    <img width="79" height="34" alt="Matrix" style="padding-left: 1px;vertical-align: middle" src="${n("./node_modules/matrix-react-sdk/res/img/matrix.svg").A}"/>\n</a>`;class vx extends o.PureComponent{render(){const e=g.Ay.getObject("embedded_pages");let t;e&&(t=e.get("welcome_url"));const n={"$riot:ssoUrl":"#/start_sso","$riot:casUrl":"#/start_cas",$matrixLogo:gx,"[matrix]":gx};if(!t){var i;const e=g.Ay.getObject("branding"),r=null!==(i=null==e?void 0:e.get("auth_header_logo_url"))&&void 0!==i?i:"themes/element/img/logos/element-logo.svg";n.$logoUrl=r,t="welcome.html"}return o.createElement(ux.A,null,o.createElement("div",{className:ee()("mx_Welcome",{mx_WelcomePage_registrationDisabled:!O.A.getValue(W.f.Registration)})},o.createElement(Qr,{className:"mx_WelcomePage",url:t,replaceMap:n}),o.createElement(px,null)))}}class _x{constructor(e,t){(0,r.A)(this,"client",void 0),(0,r.A)(this,"clientSecret",void 0),(0,r.A)(this,"password",""),(0,r.A)(this,"sessionId",""),(0,r.A)(this,"logoutDevices",!1),(0,r.A)(this,"sendAttempt",0),this.client=(0,s.createClient)({baseUrl:e,idBaseUrl:t}),this.clientSecret=this.client.generateClientSecret()}requestResetToken(e){return this.sendAttempt++,this.client.requestPasswordEmailToken(e,this.clientSecret,this.sendAttempt).then((e=>(this.sessionId=e.sid,e)),(function(e){throw"M_THREEPID_NOT_FOUND"===e.errcode?e.message=(0,C._t)("auth|reset_password_email_not_found_title"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}setLogoutDevices(e){this.logoutDevices=e}async setNewPassword(e){this.password=e,await this.checkEmailLinkClicked()}async checkEmailLinkClicked(){const e={sid:this.sessionId,client_secret:this.clientSecret};try{await this.client.setPassword({type:"m.login.email.identity",threepid_creds:e},this.password,this.logoutDevices)}catch(e){throw 401===e.httpStatus?e.message=(0,C._t)("settings|general|add_email_failed_verification"):404===e.httpStatus?e.message=(0,C._t)("auth|reset_password_email_not_associated"):e.httpStatus&&(e.message+=` (Status ${e.httpStatus})`),e}}}var fx,yx=n("./node_modules/matrix-react-sdk/src/components/views/auth/AuthHeaderLogo.tsx");class Ex extends o.Component{render(){return o.createElement("div",{className:"mx_AuthHeader"},o.createElement(yx.A,null),o.createElement(px,{disabled:this.props.disableLanguageSelector}))}}function bx({flex:e,className:t,children:n}){return o.createElement("main",{className:ee()("mx_AuthBody",t,{mx_AuthBody_flex:e})},n)}function wx(){return wx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},wx.apply(null,arguments)}var xx=function(e,t){return o.createElement("svg",wx({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0,ref:t},e),fx||(fx=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"m5.092 17.049 6.515 6.709L26.91 8"})))},Ax=(0,o.forwardRef)(xx);var Sx;function Cx(){return Cx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Cx.apply(null,arguments)}var kx=function(e,t){return o.createElement("svg",Cx({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0,ref:t},e),Sx||(Sx=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M13.333 1.852a5.5 5.5 0 0 0-5.5 5.5v5.822H7a3 3 0 0 0-3 3v11.493a3 3 0 0 0 3 3h18a3 3 0 0 0 3-3V16.174a3 3 0 0 0-3-3h-.833V7.352a5.5 5.5 0 0 0-5.5-5.5zm7.834 11.322V7.352a2.5 2.5 0 0 0-2.5-2.5h-5.334a2.5 2.5 0 0 0-2.5 2.5v5.822z",clipRule:"evenodd"})))},Rx=(0,o.forwardRef)(kx);var Ix;function Tx(){return Tx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Tx.apply(null,arguments)}var Px=function(e,t){return o.createElement("svg",Tx({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 40 29",role:"presentation","aria-hidden":!0,ref:t},e),Ix||(Ix=o.createElement("path",{fill:"#737D8C",fillRule:"evenodd",d:"m.261 2.576 18.644 18.586a1.64 1.64 0 0 0 2.316 0L39.773 2.666C39.92 3.084 40 3.533 40 4v21a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4c0-.502.092-.982.261-1.424M2.582.259C3.022.09 3.501 0 4 0h32c.533 0 1.042.104 1.508.294l-17.445 17.39z",clipRule:"evenodd"})))},Nx=(0,o.forwardRef)(Px);var Dx=n("./node_modules/matrix-react-sdk/src/components/structures/ErrorMessage.tsx");const Mx=({email:e,errorText:t,homeserver:n,loading:i,onInputChanged:r,onLoginClick:s,onSubmitForm:a})=>{const l=i?o.createElement(dn.A,{w:16,h:16}):(0,C._t)("auth|forgot_password_send_email"),c=(0,o.useRef)(null);return o.createElement(o.Fragment,null,o.createElement(Nx,{className:"mx_AuthBody_icon"}),o.createElement("h1",null,(0,C._t)("auth|enter_email_heading")),o.createElement("p",{className:"mx_AuthBody_text"},(0,C._t)("auth|enter_email_explainer",{homeserver:n},{b:e=>o.createElement("b",null,e)})),o.createElement("form",{onSubmit:async e=>{var t,n,i;await(null===(t=c.current)||void 0===t?void 0:t.validate({allowEmpty:!1}))?a(e):(null===(n=c.current)||void 0===n||n.focus(),null===(i=c.current)||void 0===i||i.validate({allowEmpty:!1,focused:!0}))}},o.createElement("fieldset",{disabled:i},o.createElement("div",{className:"mx_AuthBody_fieldRow"},o.createElement(Uf,{name:"reset_email",label:(0,C.AO)("common|email_address"),labelRequired:(0,C.AO)("auth|forgot_password_email_required"),labelInvalid:(0,C.AO)("auth|forgot_password_email_invalid"),value:e,autoFocus:!0,onChange:e=>r("email",e),fieldRef:c})),t&&o.createElement(Dx.K,{message:t}),o.createElement("button",{type:"submit",className:"mx_Login_submit"},l),o.createElement("div",{className:"mx_AuthBody_button-container"},o.createElement(be.A,{className:"mx_AuthBody_sign-in-instead-button",element:"button",kind:"link",onClick:e=>{e.preventDefault(),s()}},(0,C._t)("auth|sign_in_instead"))))))};var Ox,Lx=n("./node_modules/matrix-react-sdk/res/img/element-icons/email-prompt.svg");function Ux(){return Ux=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ux.apply(null,arguments)}var Fx=function(e,t){return o.createElement("svg",Ux({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),Ox||(Ox=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.023 2.965a6.418 6.418 0 0 1 10.36 4.369h1.29c.26 0 .416.291.271.509l-2.005 3.011a.327.327 0 0 1-.544 0l-2.006-3.011a.327.327 0 0 1 .272-.51h1.21a4.918 4.918 0 0 0-7.918-3.192 4 4 0 0 1-.184.136l-.014.01-.004.003-.002.001h-.001v.001l-.415-.625.414.625a.75.75 0 0 1-.83-1.25l.003-.001.02-.014zm-.895 5.702H4.34a.327.327 0 0 0 .272-.51L2.606 5.147a.327.327 0 0 0-.545 0L.055 8.158c-.144.217.011.509.273.509h1.29a6.417 6.417 0 0 0 10.503 4.251.75.75 0 0 0-.963-1.149 4.918 4.918 0 0 1-8.03-3.102",clipRule:"evenodd"})))},jx=(0,o.forwardRef)(Fx);const Bx=(e,t)=>{const n=(0,o.useRef)(),[i,r]=(0,o.useState)(e);return(0,o.useEffect)((()=>()=>{clearTimeout(n.current)})),{toggle:()=>{r(!e),n.current=window.setTimeout((()=>r(e)),t)},value:i}},Vx=({email:e,errorText:t,onReEnterEmailClick:n,onSubmitForm:i,onResendClick:r})=>{const{toggle:s,value:a}=Bx(!1,2500);return o.createElement(o.Fragment,null,o.createElement(Lx.I,{className:"mx_AuthBody_emailPromptIcon--shifted"}),o.createElement("h1",null,(0,C._t)("auth|uia|email_auth_header")),o.createElement("div",{className:"mx_AuthBody_text"},o.createElement("p",null,(0,C._t)("auth|check_email_explainer",{email:e},{b:e=>o.createElement("b",null,e)})),o.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},(0,C._t)("auth|check_email_wrong_email_prompt")),o.createElement(be.A,{className:"mx_AuthBody_resend-button",kind:"link",onClick:n},(0,C._t)("auth|check_email_wrong_email_button")))),t&&o.createElement(Dx.K,{message:t}),o.createElement("input",{onClick:i,type:"button",className:"mx_Login_submit",value:(0,C._t)("action|next")}),o.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},(0,C._t)("auth|check_email_resend_prompt")),o.createElement(ke.m_,{label:(0,C._t)("auth|check_email_resend_tooltip"),placement:"top",open:a},o.createElement(be.A,{className:"mx_AuthBody_resend-button",kind:"link",onClick:async()=>{await r(),s()}},o.createElement(jx,{className:"mx_Icon mx_Icon_16"}),(0,C._t)("action|resend")))))},Hx=({email:e,errorText:t,onCloseClick:n,onReEnterEmailClick:i,onResendClick:r})=>{const{toggle:s,value:a}=Bx(!1,2500);return o.createElement(o.Fragment,null,o.createElement(Lx.I,{className:"mx_AuthBody_emailPromptIcon"}),o.createElement("h1",null,(0,C._t)("auth|verify_email_heading")),o.createElement("p",null,(0,C._t)("auth|verify_email_explainer",{email:e},{b:e=>o.createElement("b",null,e)})),o.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},(0,C._t)("auth|check_email_resend_prompt")),o.createElement(ke.m_,{label:(0,C._t)("auth|check_email_resend_tooltip"),placement:"top",open:a},o.createElement(be.A,{className:"mx_AuthBody_resend-button",kind:"link",onClick:async()=>{await r(),s()}},o.createElement(jx,{className:"mx_Icon mx_Icon_16"}),(0,C._t)("action|resend"))),t&&o.createElement(Dx.K,{message:t})),o.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},(0,C._t)("auth|check_email_wrong_email_prompt")),o.createElement(be.A,{className:"mx_AuthBody_resend-button",kind:"link",onClick:i},(0,C._t)("auth|check_email_wrong_email_button"))),o.createElement(be.A,{onClick:n,className:"mx_Dialog_cancelButton","aria-label":(0,C._t)("dialog_close_label")}))};var zx=function(e){return e[e.EnterEmail=1]="EnterEmail",e[e.SendingEmail=2]="SendingEmail",e[e.EmailSent=3]="EmailSent",e[e.PasswordInput=4]="PasswordInput",e[e.ResettingPassword=5]="ResettingPassword",e[e.Done=6]="Done",e}(zx||{});class Wx extends o.Component{constructor(e){super(e),(0,r.A)(this,"reset",void 0),(0,r.A)(this,"fieldPassword",null),(0,r.A)(this,"fieldPasswordConfirm",null),(0,r.A)(this,"sendVerificationMail",(async()=>{try{return await this.reset.requestResetToken(this.state.email),!0}catch(e){this.handleError(e)}return!1})),(0,r.A)(this,"onSubmitForm",(async e=>{if(e.preventDefault(),![zx.SendingEmail,zx.ResettingPassword].includes(this.state.phase)&&(this.setState({errorText:""}),await this.checkServerLiveliness(this.props.serverConfig),this.state.serverIsAlive))switch(this.state.phase){case zx.EnterEmail:this.onPhaseEmailInputSubmit();break;case zx.EmailSent:this.onPhaseEmailSentSubmit();break;case zx.PasswordInput:this.onPhasePasswordInputSubmit()}})),(0,r.A)(this,"onInputChanged",((e,t)=>{let n=t.currentTarget.value;"email"===e&&(n=n.trim()),this.setState({[e]:n})})),this.state={phase:zx.EnterEmail,email:"",password:"",password2:"",errorText:null,serverIsAlive:!0,serverDeadError:"",logoutDevices:!1},this.reset=new _x(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl)}componentDidUpdate(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.checkServerLiveliness(this.props.serverConfig)}async checkServerLiveliness(e){try{await q.A.validateServerConfigWithStaticUrls(e.hsUrl,e.isUrl),this.setState({serverIsAlive:!0})}catch(e){const{serverIsAlive:t,serverDeadError:n}=q.A.authComponentStateForError(e,"forgot_password");this.setState({serverIsAlive:t,errorText:n})}}async onPhaseEmailInputSubmit(){this.phase=zx.SendingEmail,await this.sendVerificationMail()?this.phase=zx.EmailSent:this.phase=zx.EnterEmail}handleError(e){if(429!==(null==e?void 0:e.httpStatus))"ConnectionError"!==(null==e?void 0:e.name)?this.setState({errorText:e.message}):this.setState({errorText:(0,C._t)("cannot_reach_homeserver")+": "+(0,C._t)("cannot_reach_homeserver_detail")});else{var t;const n=parseInt(null==e||null===(t=e.data)||void 0===t?void 0:t.retry_after_ms,10),i=isNaN(n)?(0,C._t)("auth|reset_password|rate_limit_error"):(0,C._t)("auth|reset_password|rate_limit_error_with_time",{timeout:(0,Ms.Xo)(n/1e3)});this.setState({errorText:i})}}async onPhaseEmailSentSubmit(){this.setState({phase:zx.PasswordInput})}set phase(e){this.setState({phase:e})}async verifyFieldsBeforeSubmit(){const e=[this.fieldPassword,this.fieldPasswordConfirm],t=[];for(const n of e){if(!n)continue;await n.validate({allowEmpty:!1})||t.push(n)}return 0===t.length||(t[0].focus(),t[0].validate({allowEmpty:!1,focused:!0}),!1)}async onPhasePasswordInputSubmit(){if(!await this.verifyFieldsBeforeSubmit())return;if(this.state.logoutDevices){if(!await this.renderConfirmLogoutDevicesDialog())return}this.phase=zx.ResettingPassword,this.reset.setLogoutDevices(this.state.logoutDevices);try{return await this.reset.setNewPassword(this.state.password),void this.setState({phase:zx.Done})}catch(e){if(401!==e.httpStatus)return void this.handleError(e)}const e=f.Ay.createDialog(Hx,{email:this.state.email,errorText:this.state.errorText,onCloseClick:()=>{e.close(),this.setState({phase:zx.PasswordInput})},onReEnterEmailClick:()=>{e.close(),this.setState({phase:zx.EnterEmail})},onResendClick:this.sendVerificationMail},"mx_VerifyEMailDialog",!1,!1,{onBeforeClose:async e=>("backgroundClick"===e&&this.setState({phase:zx.PasswordInput}),!0)});for(;this.state.phase===zx.ResettingPassword;)try{await this.reset.setNewPassword(this.state.password),this.setState({phase:zx.Done}),e.close()}catch(e){await(0,a.yy)(2e3)}}renderEnterEmail(){return o.createElement(Mx,{email:this.state.email,errorText:this.state.errorText,homeserver:this.props.serverConfig.hsName,loading:this.state.phase===zx.SendingEmail,onInputChanged:this.onInputChanged,onLoginClick:this.props.onLoginClick,onSubmitForm:this.onSubmitForm})}async renderConfirmLogoutDevicesDialog(){const{finished:e}=f.Ay.createDialog(z.A,{title:(0,C._t)("common|warning"),description:o.createElement("div",null,o.createElement("p",null,(0,C._t)("auth|reset_password|other_devices_logout_warning_1")),o.createElement("p",null,(0,C._t)("auth|reset_password|other_devices_logout_warning_2"))),button:(0,C._t)("action|continue")}),[t]=await e;return!!t}renderCheckEmail(){return o.createElement(Vx,{email:this.state.email,errorText:this.state.errorText,onReEnterEmailClick:()=>this.setState({phase:zx.EnterEmail}),onResendClick:this.sendVerificationMail,onSubmitForm:this.onSubmitForm})}renderSetPassword(){const e=this.state.phase===zx.ResettingPassword?o.createElement(dn.A,{w:16,h:16}):(0,C._t)("auth|reset_password_action");return o.createElement(o.Fragment,null,o.createElement(Rx,{className:"mx_AuthBody_lockIcon"}),o.createElement("h1",null,(0,C._t)("auth|reset_password_title")),o.createElement("form",{onSubmit:this.onSubmitForm},o.createElement("fieldset",{disabled:this.state.phase===zx.ResettingPassword},o.createElement("div",{className:"mx_AuthBody_fieldRow"},o.createElement(Pf.A,{name:"reset_password",type:"password",label:(0,C.AO)("auth|change_password_new_label"),value:this.state.password,minScore:3,fieldRef:e=>this.fieldPassword=e,onChange:this.onInputChanged.bind(this,"password"),autoComplete:"new-password"}),o.createElement(Vf.A,{name:"reset_password_confirm",label:(0,C.AO)("auth|reset_password|confirm_new_password"),labelRequired:(0,C.AO)("auth|reset_password|password_not_entered"),labelInvalid:(0,C.AO)("auth|reset_password|passwords_mismatch"),value:this.state.password2,password:this.state.password,fieldRef:e=>this.fieldPasswordConfirm=e,onChange:this.onInputChanged.bind(this,"password2"),autoComplete:"new-password"})),o.createElement("div",{className:"mx_AuthBody_fieldRow"},o.createElement(at.A,{onChange:()=>this.setState({logoutDevices:!this.state.logoutDevices}),checked:this.state.logoutDevices},(0,C._t)("auth|reset_password|sign_out_other_devices"))),this.state.errorText&&o.createElement(Dx.K,{message:this.state.errorText}),o.createElement("button",{type:"submit",className:"mx_Login_submit"},e))))}renderDone(){return o.createElement(o.Fragment,null,o.createElement(Ax,{className:"mx_Icon mx_Icon_32 mx_Icon_accent"}),o.createElement("h1",null,(0,C._t)("auth|reset_password|reset_successful")),this.state.logoutDevices?o.createElement("p",null,(0,C._t)("auth|reset_password|devices_logout_success")):null,o.createElement("input",{className:"mx_Login_submit",type:"button",onClick:this.props.onComplete,value:(0,C._t)("auth|reset_password|return_to_login")}))}render(){let e;switch(this.state.phase){case zx.EnterEmail:case zx.SendingEmail:e=this.renderEnterEmail();break;case zx.EmailSent:e=this.renderCheckEmail();break;case zx.PasswordInput:case zx.ResettingPassword:e=this.renderSetPassword();break;case zx.Done:e=this.renderDone();break;default:return l.v.warn(`unknown forgot password phase ${this.state.phase}`),void this.setState({phase:zx.EnterEmail})}return o.createElement(ux.A,null,o.createElement(Ex,null),o.createElement(bx,{className:"mx_AuthBody_forgot-password"},e))}}class Gx extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"doBootstrapUIAuth",(async e=>{if(this.state.canUploadKeysWithPasswordOnly&&this.state.accountPassword)await e({type:"m.login.password",identifier:{type:"m.id.user",user:h.J.safeGet().getUserId()},password:this.state.accountPassword});else if(this.props.tokenLogin)await e({});else{const t={[If.av.PHASE_PREAUTH]:{title:(0,C._t)("auth|uia|sso_title"),body:(0,C._t)("auth|uia|sso_preauth_body"),continueText:(0,C._t)("auth|sso"),continueKind:"primary"},[If.av.PHASE_POSTAUTH]:{title:(0,C._t)("encryption|confirm_encryption_setup_title"),body:(0,C._t)("encryption|confirm_encryption_setup_body"),continueText:(0,C._t)("action|confirm"),continueKind:"primary"}},{finished:n}=f.Ay.createDialog(Qf.A,{title:(0,C._t)("encryption|bootstrap_title"),matrixClient:h.J.safeGet(),makeRequest:e,aestheticsForStagePhases:{[If.av.LOGIN_TYPE]:t,[If.av.UNSTABLE_LOGIN_TYPE]:t}}),[i]=await n;if(!i)throw new Error("Cross-signing key upload auth canceled")}})),(0,r.A)(this,"bootstrapCrossSigning",(async()=>{this.setState({error:!1});try{const e=h.J.safeGet();await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:this.doBootstrapUIAuth}),this.props.onFinished(!0)}catch(e){if(this.props.tokenLogin)return void this.props.onFinished(!1);this.setState({error:!0}),l.v.error("Error bootstrapping cross-signing",e)}})),(0,r.A)(this,"onCancel",(()=>{this.props.onFinished(!1)})),this.state={error:!1,canUploadKeysWithPasswordOnly:!!e.accountPassword||null,accountPassword:e.accountPassword||""},this.state.accountPassword||this.queryKeyUploadAuth()}componentDidMount(){this.bootstrapCrossSigning()}async queryKeyUploadAuth(){try{await h.J.safeGet().uploadDeviceSigningKeys(void 0,{}),l.v.log("uploadDeviceSigningKeys unexpectedly succeeded without UI auth!")}catch(e){if(!(e instanceof s.MatrixError&&e.data&&e.data.flows))return void l.v.log("uploadDeviceSigningKeys advertised no flows!");const t=e.data.flows.some((e=>1===e.stages.length&&"m.login.password"===e.stages[0]));this.setState({canUploadKeysWithPasswordOnly:t})}}render(){let e;return e=this.state.error?o.createElement("div",null,o.createElement("p",null,(0,C._t)("encryption|unable_to_setup_keys_error")),o.createElement("div",{className:"mx_Dialog_buttons"},o.createElement(un.A,{primaryButton:(0,C._t)("action|retry"),onPrimaryButtonClick:this.bootstrapCrossSigning,onCancel:this.onCancel}))):o.createElement("div",null,o.createElement(dn.A,null)),o.createElement(cn.A,{className:"mx_CreateCrossSigningDialog",onFinished:this.props.onFinished,title:(0,C._t)("encryption|bootstrap_title"),hasCancel:!1,fixedWidth:!1},o.createElement("div",null,e))}}class Kx extends o.Component{render(){return o.createElement(ux.A,null,o.createElement(dx,null,o.createElement(Gx,{onFinished:this.props.onFinished,accountPassword:this.props.accountPassword,tokenLogin:this.props.tokenLogin})))}}var Jx=n("./node_modules/matrix-react-sdk/src/Login.ts");const qx=["matrixClient","loginType","fragmentAfterLogin","idp","primary","mini","action","flow"],$x=e=>{let t,{matrixClient:r,loginType:a,fragmentAfterLogin:l,idp:c,primary:d,mini:u,action:m,flow:h}=e,g=(0,Ue.A)(e,qx);t=c?(0,C._t)("auth|continue_with_idp",{provider:c.name}):s.DELEGATED_OIDC_COMPATIBILITY.findIn(h)?(0,C._t)("action|continue"):(0,C._t)("auth|sign_in_with_sso");const v=()=>{var e,t;const n=(e=>{switch(e){case s.IdentityProviderBrand.Apple:return"Apple";case s.IdentityProviderBrand.Facebook:return"Facebook";case s.IdentityProviderBrand.Github:return"GitHub";case s.IdentityProviderBrand.Gitlab:return"GitLab";case s.IdentityProviderBrand.Google:return"Google";default:return"SSO"}})(null!==(e=null==c?void 0:c.brand)&&void 0!==e?e:"");Hf.Vo.instance.setAuthenticationType(n),null===(t=p.A.get())||void 0===t||t.startSingleSignOn(r,a,l,null==c?void 0:c.id,m)};let _,f;const y=null!=c&&c.brand?(e=>{switch(e){case s.IdentityProviderBrand.Apple:return n("./node_modules/matrix-react-sdk/res/img/element-icons/brands/apple.svg").A;case s.IdentityProviderBrand.Facebook:return n("./node_modules/matrix-react-sdk/res/img/element-icons/brands/facebook.svg").A;case s.IdentityProviderBrand.Github:return n("./node_modules/matrix-react-sdk/res/img/element-icons/brands/github.svg").A;case s.IdentityProviderBrand.Gitlab:return n("./node_modules/matrix-react-sdk/res/img/element-icons/brands/gitlab.svg").A;case s.IdentityProviderBrand.Google:return n("./node_modules/matrix-react-sdk/res/img/element-icons/brands/google.svg").A;case s.IdentityProviderBrand.Twitter:return n("./node_modules/matrix-react-sdk/res/img/element-icons/brands/twitter.svg").A;default:return null}})(c.brand):null;if(null!=c&&c.brand&&y){const e=c.brand.split(".").pop();f=`mx_SSOButton_brand_${e}`,_=o.createElement("img",{src:y,height:"24",width:"24",alt:e})}else if("string"==typeof(null==c?void 0:c.icon)&&c.icon.startsWith("mxc://")){var E;const e=null!==(E=(0,Ds.lH)(c.icon,r).getSquareThumbnailHttp(24))&&void 0!==E?E:void 0;_=o.createElement("img",{src:e,height:"24",width:"24",alt:c.name})}const b=f?{[f]:f}:void 0,w=ee()("mx_SSOButton",{mx_SSOButton_mini:u,mx_SSOButton_default:!c,mx_SSOButton_primary:d},b);return u?o.createElement(be.A,(0,i.A)({},g,{title:t,className:w,onClick:v}),_):o.createElement(be.A,(0,i.A)({},g,{className:w,onClick:v}),_,t)},Yx=({matrixClient:e,flow:t,loginType:n,fragmentAfterLogin:i,primary:r,action:s,disabled:a})=>{const l=t.identity_providers||[];if(l.length<2)return o.createElement("div",{className:"mx_SSOButtons"},o.createElement($x,{matrixClient:e,loginType:n,fragmentAfterLogin:i,idp:l[0],primary:r,action:s,flow:t,disabled:a}));const d=Math.ceil(l.length/6),u=Math.ceil(l.length/d);return o.createElement("div",{className:"mx_SSOButtons"},(0,c.chunk)(l,u).map((a=>o.createElement("div",{key:a[0].id,className:"mx_SSOButtons_row"},a.map((a=>o.createElement($x,{key:a.id,matrixClient:e,loginType:n,fragmentAfterLogin:i,idp:a,mini:!0,primary:r,action:s,flow:t})))))))};class Qx extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"defaultServer",void 0),(0,r.A)(this,"fieldRef",(0,o.createRef)()),(0,r.A)(this,"validatedConf",void 0),(0,r.A)(this,"onDefaultChosen",(()=>{this.setState({defaultChosen:!0})})),(0,r.A)(this,"onOtherChosen",(()=>{this.setState({defaultChosen:!1})})),(0,r.A)(this,"onHomeserverChange",(e=>{this.setState({otherHomeserver:e.target.value})})),(0,r.A)(this,"validate",(0,As.A)({deriveData:async({value:e})=>{let t=(null!=e?e:"").trim();if(!t.includes("://"))try{const e=await s.AutoDiscovery.findClientConfig(t);return this.validatedConf=await q.A.buildValidatedConfigFromDiscovery(t,e),{}}catch(e){l.v.error(`Attempted ${t} as a server_name but it failed`,e)}t.includes("://")||(t="https://"+t);try{return this.validatedConf=await q.A.validateServerConfigWithStaticUrls(t),{}}catch(e){l.v.error(e);if(q.A.authComponentStateForError(e).serverErrorIsFatal){let t=(0,C._t)("auth|server_picker_failed_validate_homeserver");return e instanceof C.P7&&e.translatedMessage&&(t=e.translatedMessage),{error:t}}try{return this.validatedConf=await q.A.validateServerConfigWithStaticUrls(t,void 0,!0),{}}catch(e){return l.v.error(e),{error:(0,C._t)("auth|server_picker_invalid_url")}}}},rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|server_picker_required")},{key:"valid",test:async function({value:e},{error:t}){return!e||!t},invalid:function({error:e}){return null!=e?e:null}}]})),(0,r.A)(this,"onHomeserverValidate",(e=>this.validate(e))),(0,r.A)(this,"onSubmit",(async e=>{var t;if(e.preventDefault(),this.state.defaultChosen)return void this.props.onFinished(this.defaultServer);var n,i;if(!await(null===(t=this.fieldRef.current)||void 0===t?void 0:t.validate({allowEmpty:!1})))return null===(n=this.fieldRef.current)||void 0===n||n.focus(),void(null===(i=this.fieldRef.current)||void 0===i||i.validate({allowEmpty:!1,focused:!0}));this.props.onFinished(this.validatedConf)}));const t=g.Ay.get();this.defaultServer=t.validated_server_config;const{serverConfig:n}=this.props;let i="";n.isDefault||(i=n.isNameResolvable&&n.hsName?n.hsName:n.hsUrl),this.state={defaultChosen:n.isDefault,otherHomeserver:i}}render(){let e;"matrix.org"===this.defaultServer.hsName&&(e=(0,C._t)("auth|server_picker_matrix.org"));let t=this.defaultServer.hsName;return this.defaultServer.hsNameIsDifferent&&(t=o.createElement(Ul.A,{className:"mx_Login_underlinedServerName",tooltip:this.defaultServer.hsUrl},this.defaultServer.hsName)),o.createElement(cn.A,{title:this.props.title||(0,C._t)("auth|server_picker_title"),className:"mx_ServerPickerDialog",contentId:"mx_ServerPickerDialog",onFinished:this.props.onFinished,fixedWidth:!1,hasCancel:!0},o.createElement("form",{className:"mx_Dialog_content",id:"mx_ServerPickerDialog",onSubmit:this.onSubmit},o.createElement("p",null,(0,C._t)("auth|server_picker_intro")," ",e),o.createElement(My.A,{name:"defaultChosen",value:"true",checked:this.state.defaultChosen,onChange:this.onDefaultChosen},t),o.createElement(My.A,{name:"defaultChosen",value:"false",className:"mx_ServerPickerDialog_otherHomeserverRadio",checked:!this.state.defaultChosen,onChange:this.onOtherChosen,childrenInLabel:!1,"aria-label":(0,C._t)("auth|server_picker_custom")},o.createElement(tn.A,{type:"text",className:"mx_ServerPickerDialog_otherHomeserver",label:(0,C._t)("auth|server_picker_custom"),onChange:this.onHomeserverChange,onFocus:this.onOtherChosen,ref:this.fieldRef,onValidate:this.onHomeserverValidate,value:this.state.otherHomeserver,validateOnChange:!1,validateOnFocus:!1,autoFocus:!0,id:"mx_homeserverInput"})),o.createElement("p",null,(0,C._t)("auth|server_picker_explainer")),o.createElement(be.A,{className:"mx_ServerPickerDialog_continue",kind:"primary",onClick:this.onSubmit},(0,C._t)("action|continue")),o.createElement("h2",null,(0,C._t)("action|learn_more")),o.createElement(sn.A,{href:"https://matrix.org/docs/matrix-concepts/elements-of-matrix/#homeserver",target:"_blank",rel:"noreferrer noopener"},(0,C._t)("auth|server_picker_learn_more"))))}}const Zx=()=>{const e=g.Ay.get().brand;f.Ay.createDialog(rn.A,{title:(0,C._t)("auth|server_picker_title_default"),description:(0,C._t)("auth|server_picker_description",{brand:e}),button:(0,C._t)("action|dismiss"),hasCloseButton:!1,fixedWidth:!1},"mx_ServerPicker_helpDialog")},Xx=({title:e,dialogTitle:t,serverConfig:n,onServerConfigChange:i,disabled:r})=>{const s=g.Ay.get("disable_custom_urls");let a;if(!s&&i){const e=()=>{((e,t,n)=>{f.Ay.createDialog(Qx,{title:e,serverConfig:t,onFinished:n})})(t,n,(e=>{e&&i(e)}))};a=o.createElement(be.A,{className:"mx_ServerPicker_change",kind:"link",onClick:e,disabled:r},(0,C._t)("action|edit"))}let l,c=n.isNameResolvable?n.hsName:n.hsUrl;return n.hsNameIsDifferent&&(c=o.createElement(Ul.A,{className:"mx_Login_underlinedServerName",tooltip:n.hsUrl},n.hsName)),"matrix.org"===n.hsName&&(l=o.createElement("span",{className:"mx_ServerPicker_desc"},(0,C._t)("auth|server_picker_description_matrix.org"))),o.createElement("div",{className:"mx_ServerPicker"},o.createElement("h2",null,e||(0,C._t)("common|homeserver")),s?null:o.createElement(be.A,{className:"mx_ServerPicker_help",onClick:Zx,"aria-label":(0,C._t)("common|help")}),o.createElement("span",{className:"mx_ServerPicker_server",title:"string"==typeof c?c:void 0},c),a,l)};var eA=n("./node_modules/matrix-react-sdk/src/components/structures/auth/header/AuthHeaderContext.tsx");function tA({title:e,icon:t,serverPicker:n,children:i}){var r,s,a;const l=(0,o.useContext)(eA.h);if(!l)return o.createElement(o.Fragment,null);const c=null!==(r=l.state[0])&&void 0!==r?r:null;return o.createElement(o.Fragment,null,null!==(s=null==c?void 0:c.icon)&&void 0!==s?s:t,o.createElement("h1",null,null!==(a=null==c?void 0:c.title)&&void 0!==a?a:e),i,!0!==(null==c?void 0:c.hideServerPicker)&&n)}var nA=n("./node_modules/matrix-react-sdk/src/components/structures/auth/header/AuthHeaderProvider.tsx"),iA=n("./node_modules/matrix-react-sdk/src/utils/oidc/authorize.ts");function rA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const oA=(...e)=>{O.A.getValue("debug_registration")&&l.v.log.call(console,"Registration debuglog:",...e)};class sA extends o.Component{constructor(e){super(e),(0,r.A)(this,"loginLogic",void 0),(0,r.A)(this,"latestServerConfig",void 0),(0,r.A)(this,"oidcNativeFlowEnabled",!1),(0,r.A)(this,"unloadCallback",(e=>{if(this.state.doingUIAuth)return e.preventDefault(),e.returnValue="",""})),(0,r.A)(this,"onFormSubmit",(async e=>{this.setState({errorText:"",busy:!0,formVals:e,doingUIAuth:!0})})),(0,r.A)(this,"requestEmailToken",((e,t,n,i)=>{if(!this.state.matrixClient)throw new Error("Matrix client has not yet been loaded");return this.state.matrixClient.requestRegisterEmailToken(e,t,n)})),(0,r.A)(this,"onUIAuthFinished",(async(e,t)=>{if(!this.state.matrixClient)throw new Error("Matrix client has not yet been loaded");if(oA("Registration: ui authentication finished: ",{success:e,response:t}),!e){var n;let e=t.message||t.toString();if(t instanceof s.MatrixError&&"M_RESOURCE_LIMIT_EXCEEDED"===t.errcode){const n=(0,pe.AB)(t.data.limit_type,t.data.admin_contact,pe.Ch),i=(0,pe.AB)(t.data.limit_type,t.data.admin_contact,pe.aZ);e=o.createElement("div",null,o.createElement("p",null,n),o.createElement("p",null,i))}else if(null!==(n=t.flows)&&void 0!==n&&n.some((e=>e.stages.includes(s.AuthType.Msisdn)))){var i;(null!==(i=t.flows)&&void 0!==i?i:[]).some((e=>e.stages.includes(s.AuthType.Msisdn)))||(e=(0,C._t)("auth|unsupported_auth_msisdn"))}else t instanceof s.MatrixError&&"M_USER_IN_USE"===t.errcode?e=(0,C._t)("auth|username_in_use"):t instanceof s.MatrixError&&"M_THREEPID_IN_USE"===t.errcode&&(e=(0,C._t)("auth|3pid_in_use"));return void this.setState({busy:!1,doingUIAuth:!1,errorText:e})}const r=t.user_id,a=t.access_token;if(!r||!a)throw new Error("Registration failed");h.J.setJustRegisteredUserId(r);const c={doingUIAuth:!1,registeredUsername:r,differentLoggedInUserId:void 0,completedNoSignin:!1,busy:!0},[d,u]=await b.hP();d&&!u&&d!==r&&(l.v.log(`Found a session for ${d} but ${r} has just registered.`),c.differentLoggedInUserId=d);const m=Boolean(this.state.formVals.email),p=Boolean(a);oA("Registration: ui auth finished:",{hasEmail:m,hasAccessToken:p}),p&&!c.differentLoggedInUserId?(await this.props.onLoggedIn({userId:r,deviceId:t.device_id,homeserverUrl:this.state.matrixClient.getHomeserverUrl(),identityServerUrl:this.state.matrixClient.getIdentityServerUrl(),accessToken:a},this.state.formVals.password),this.setupPushers()):(c.busy=!1,c.completedNoSignin=!0),this.setState(c)})),(0,r.A)(this,"onLoginClick",(e=>{e.preventDefault(),e.stopPropagation(),this.props.onLoginClick()})),(0,r.A)(this,"onGoToFormClicked",(e=>{e.preventDefault(),e.stopPropagation(),this.replaceClient(this.props.serverConfig),this.setState({busy:!1,doingUIAuth:!1})})),(0,r.A)(this,"makeRegisterRequest",(e=>{if(!this.state.matrixClient)throw new Error("Matrix client has not yet been loaded");const t={username:this.state.formVals.username,password:this.state.formVals.password,initial_device_display_name:this.props.defaultDeviceDisplayName,auth:void 0,inhibit_login:void 0};return e&&(t.auth=e),oA("Registration: sending registration request:",e),this.state.matrixClient.registerRequest(t)})),(0,r.A)(this,"onLoginClickWithCheck",(async e=>{e.preventDefault();const t=await b.L6({ignoreGuest:!0});return t||this.props.onLoginClick(),t})),this.state={busy:!1,errorText:null,formVals:{email:this.props.email},doingUIAuth:Boolean(this.props.sessionId),flows:null,completedNoSignin:!1,serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""},this.oidcNativeFlowEnabled=O.A.getValue(Ln.O5.OidcNativeFlow);const{hsUrl:t,isUrl:n,delegatedAuthentication:i}=this.props.serverConfig;this.loginLogic=new Jx.A(t,n,null,{defaultDeviceDisplayName:"Element login check",delegatedAuthentication:this.oidcNativeFlowEnabled?i:void 0})}componentDidMount(){this.replaceClient(this.props.serverConfig),window.addEventListener("beforeunload",this.unloadCallback)}componentWillUnmount(){window.removeEventListener("beforeunload",this.unloadCallback)}componentDidUpdate(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.replaceClient(this.props.serverConfig)}async replaceClient(e){this.latestServerConfig=e;const{hsUrl:t,isUrl:n}=e;this.setState({errorText:null,serverDeadError:null,serverErrorIsFatal:!1,busy:!0});try{if(await q.A.validateServerConfigWithStaticUrls(t,n),e!==this.latestServerConfig)return;this.setState({serverIsAlive:!0,serverErrorIsFatal:!1})}catch(t){if(e!==this.latestServerConfig)return;if(this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rA(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({busy:!1},q.A.authComponentStateForError(t,"register"))),this.state.serverErrorIsFatal)return}const i=(0,s.createClient)({baseUrl:t,idBaseUrl:n});this.loginLogic.setHomeserverUrl(t),this.loginLogic.setIdentityServerUrl(n);const o=this.oidcNativeFlowEnabled?e.delegatedAuthentication:void 0;let a,c;this.loginLogic.setDelegatedAuthentication(o);try{const t=await this.loginLogic.getFlows(!0);if(e!==this.latestServerConfig)return;a=t.find((e=>"m.login.sso"===e.type||"m.login.cas"===e.type)),c=t.find((e=>"oidcNativeFlow"===e.type))}catch(t){if(e!==this.latestServerConfig)return;l.v.error("Failed to get login flows to check for SSO support",t)}if(await new Promise((e=>{this.setState((({flows:e})=>({matrixClient:i,ssoFlow:a,oidcNativeFlow:c,flows:c?[]:e,busy:!1})),e)})),!c)try{if(!this.state.doingUIAuth){if(await this.makeRegisterRequest(null),e!==this.latestServerConfig)return;l.v.log("Expecting 401 from register request but got success!")}}catch(t){if(e!==this.latestServerConfig)return;t instanceof s.MatrixError&&401===t.httpStatus?this.setState({flows:t.data.flows}):t instanceof s.MatrixError&&(403===t.httpStatus||"M_FORBIDDEN"===t.errcode)?a?v.Ay.dispatch({action:"start_login"}):this.setState({serverErrorIsFatal:!0,errorText:(0,C._t)("auth|registration_disabled"),flows:[]}):(l.v.log("Unable to query for supported registration methods.",t),this.setState({errorText:(0,C._t)("auth|failed_query_registration_methods"),flows:[]}))}}setupPushers(){if(!this.props.brand)return Promise.resolve();const e=h.J.safeGet();return e.getPushers().then((t=>{const n=t.pushers;for(let t=0;t<n.length;++t)if("email"===n[t].kind){const i=n[t];i.data={brand:this.props.brand},e.setPusher(i).then((()=>{l.v.log("Set email branding to "+this.props.brand)}),(e=>{l.v.error("Couldn't set email branding: "+e)}))}}),(e=>{l.v.error("Couldn't get pushers: "+e)}))}getUIAuthInputs(){return{emailAddress:this.state.formVals.email,phoneCountry:this.state.formVals.phoneCountry,phoneNumber:this.state.formVals.phoneNumber}}renderRegisterComponent(){if(this.state.matrixClient&&this.state.doingUIAuth)return o.createElement(Rf.A,{matrixClient:this.state.matrixClient,makeRequest:this.makeRegisterRequest,onAuthFinished:this.onUIAuthFinished,inputs:this.getUIAuthInputs(),requestEmailToken:this.requestEmailToken,sessionId:this.props.sessionId,clientSecret:this.props.clientSecret,emailSid:this.props.idSid,poll:!0});if(!this.state.matrixClient&&!this.state.busy)return null;if(this.state.busy||!this.state.flows)return o.createElement("div",{className:"mx_AuthBody_spinner"},o.createElement(dn.A,null));if(this.state.matrixClient&&this.state.oidcNativeFlow)return o.createElement(be.A,{className:"mx_Login_fullWidthButton",kind:"primary",onClick:async()=>{await(0,iA.N)(this.props.serverConfig.delegatedAuthentication,this.state.oidcNativeFlow.clientId,this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl,!0)}},(0,C._t)("action|continue"));if(this.state.matrixClient&&this.state.flows.length){let e;if(this.state.ssoFlow){let t;(this.state.ssoFlow.identity_providers||[]).length>1&&(t=o.createElement("h2",{className:"mx_AuthBody_centered"},(0,C._t)("auth|continue_with_sso",{ssoButtons:""}).trim())),e=o.createElement(o.Fragment,null,t,o.createElement(Yx,{matrixClient:this.loginLogic.createTemporaryClient(),flow:this.state.ssoFlow,loginType:"m.login.sso"===this.state.ssoFlow.type?"sso":"cas",fragmentAfterLogin:this.props.fragmentAfterLogin,action:s.SSOAction.REGISTER}),o.createElement("h2",{className:"mx_AuthBody_centered"},(0,C._t)("auth|sso_or_username_password",{ssoButtons:"",usernamePassword:""}).trim()))}return o.createElement(o.Fragment,null,e,o.createElement(Yf,{defaultUsername:this.state.formVals.username,defaultEmail:this.state.formVals.email,defaultPhoneCountry:this.state.formVals.phoneCountry,defaultPhoneNumber:this.state.formVals.phoneNumber,defaultPassword:this.state.formVals.password,onRegisterClick:this.onFormSubmit,flows:this.state.flows,serverConfig:this.props.serverConfig,canSubmit:!this.state.serverErrorIsFatal,matrixClient:this.state.matrixClient}))}return null}render(){let e;const t=this.state.errorText;let n;if(t&&(e=o.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=ee()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});n=o.createElement("div",{className:e},this.state.serverDeadError)}const i=o.createElement("span",{className:"mx_AuthBody_changeFlow"},(0,C._t)("auth|sign_in_instead_prompt",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onLoginClick},e)}));let r,s;if(this.state.doingUIAuth&&(r=o.createElement(be.A,{kind:"link",className:"mx_AuthBody_changeFlow",onClick:this.onGoToFormClicked},(0,C._t)("action|go_back"))),this.state.completedNoSignin){let e;e=this.state.differentLoggedInUserId?o.createElement("div",null,o.createElement("p",null,(0,C._t)("auth|account_clash",{newAccountId:this.state.registeredUsername,loggedInUserId:this.state.differentLoggedInUserId})),o.createElement("p",null,o.createElement(be.A,{kind:"link_inline",onClick:async e=>{await this.onLoginClickWithCheck(e)&&v.Ay.dispatch({action:"view_welcome_page"})}},(0,C._t)("auth|account_clash_previous_account")))):o.createElement("h2",null,(0,C._t)("auth|log_in_new_account",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:async e=>{await this.onLoginClickWithCheck(e)&&v.Ay.dispatch({action:"view_home_page"})}},e)})),s=o.createElement("div",null,o.createElement("h1",null,(0,C._t)("auth|registration_successful")),e)}else s=o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_Register_mainContent"},o.createElement(tA,{title:(0,C._t)("auth|create_account_title"),serverPicker:o.createElement(Xx,{title:(0,C._t)("auth|server_picker_title_registration"),dialogTitle:(0,C._t)("auth|server_picker_dialog_title"),serverConfig:this.props.serverConfig,onServerConfigChange:this.state.doingUIAuth?void 0:this.props.onServerConfigChange})},e,n),this.renderRegisterComponent()),o.createElement("div",{className:"mx_Register_footerActions"},r,i));return o.createElement(ux.A,null,o.createElement(Ex,null),o.createElement(nA.T,null,o.createElement(bx,{flex:!0},s)))}}let aA,lA,cA,dA;const uA=/^[0-9()\-\s]*$/;var mA=function(e){return e.Email="login_field_email",e.MatrixId="login_field_mxid",e.Phone="login_field_phone",e.Password="login_field_password",e}(mA||{});aA=mA.Email,lA=mA.Phone,cA=mA.MatrixId,dA=mA.Password;class hA extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,aA,null),(0,r.A)(this,lA,null),(0,r.A)(this,cA,null),(0,r.A)(this,dA,null),(0,r.A)(this,"onForgotPasswordClick",(e=>{var t,n;e.preventDefault(),e.stopPropagation(),null===(t=(n=this.props).onForgotPasswordClick)||void 0===t||t.call(n)})),(0,r.A)(this,"onSubmitForm",(async e=>{e.preventDefault();if(await this.verifyFieldsBeforeSubmit())switch(this.state.loginType){case mA.Email:case mA.MatrixId:this.props.onSubmit(this.props.username,void 0,void 0,this.state.password);break;case mA.Phone:this.props.onSubmit(void 0,this.props.phoneCountry,this.props.phoneNumber,this.state.password)}})),(0,r.A)(this,"onUsernameChanged",(e=>{var t,n;null===(t=(n=this.props).onUsernameChanged)||void 0===t||t.call(n,e.target.value)})),(0,r.A)(this,"onUsernameBlur",(e=>{var t,n;null===(t=(n=this.props).onUsernameBlur)||void 0===t||t.call(n,e.target.value)})),(0,r.A)(this,"onLoginTypeChange",(e=>{var t,n;const i=e.target.value;this.setState({loginType:i}),null===(t=(n=this.props).onUsernameChanged)||void 0===t||t.call(n,"")})),(0,r.A)(this,"onPhoneCountryChanged",(e=>{var t,n;null===(t=(n=this.props).onPhoneCountryChanged)||void 0===t||t.call(n,e.iso2)})),(0,r.A)(this,"onPhoneNumberChanged",(e=>{var t,n;null===(t=(n=this.props).onPhoneNumberChanged)||void 0===t||t.call(n,e.target.value)})),(0,r.A)(this,"onPasswordChanged",(e=>{this.setState({password:e.target.value})})),(0,r.A)(this,"validateUsernameRules",(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|username_field_required_invalid")}]})),(0,r.A)(this,"onUsernameValidate",(async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(mA.MatrixId,t.valid),t})),(0,r.A)(this,"onEmailValidate",(e=>{this.markFieldValid(mA.Email,e.valid)})),(0,r.A)(this,"validatePhoneNumberRules",(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|msisdn_field_required_invalid")},{key:"number",test:({value:e})=>!e||uA.test(e),invalid:()=>(0,C._t)("auth|msisdn_field_number_invalid")}]})),(0,r.A)(this,"onPhoneNumberValidate",(async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(mA.Password,t.valid),t})),(0,r.A)(this,"validatePasswordRules",(0,As.A)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>(0,C._t)("auth|password_field_label")}]})),(0,r.A)(this,"onPasswordValidate",(async e=>{const t=await this.validatePasswordRules(e);return this.markFieldValid(mA.Password,t.valid),t})),this.state={fieldValid:{},loginType:mA.MatrixId,password:""}}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[this.state.loginType,mA.Password];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise((e=>this.setState({},e))),this.allFieldsValid())return!0;const n=this.findFirstInvalidField(t);return!n||(n.focus(),n.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){return Object.values(this.state.fieldValid).every(Boolean)}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:n}=this.state;n[e]=t,this.setState({fieldValid:n})}renderLoginField(e,t){const n={error:!1};switch(e){case mA.Email:return n.error=this.props.loginIncorrect&&!this.props.username,o.createElement(Uf,{id:"mx_LoginForm_email",className:ee()(n),name:"username",autoComplete:"email",type:"email",key:"email_input",placeholder:"joe@example.com",value:this.props.username,onChange:this.onUsernameChanged,onBlur:this.onUsernameBlur,disabled:this.props.busy,autoFocus:t,onValidate:this.onEmailValidate,fieldRef:e=>{this[mA.Email]=e}});case mA.MatrixId:return n.error=this.props.loginIncorrect&&!this.props.username,o.createElement(tn.A,{id:"mx_LoginForm_username",className:ee()(n),name:"username",autoComplete:"username",key:"username_input",type:"text",label:(0,C._t)("common|username"),placeholder:(0,C._t)("common|username"),value:this.props.username,onChange:this.onUsernameChanged,onBlur:this.onUsernameBlur,disabled:this.props.busy,autoFocus:t,onValidate:this.onUsernameValidate,ref:e=>{this[mA.MatrixId]=e}});case mA.Phone:{n.error=this.props.loginIncorrect&&!this.props.phoneNumber;const e=o.createElement(Bf,{value:this.props.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChanged});return o.createElement(tn.A,{id:"mx_LoginForm_phone",className:ee()(n),name:"phoneNumber",autoComplete:"tel-national",key:"phone_input",type:"text",label:(0,C._t)("auth|msisdn_field_label"),value:this.props.phoneNumber,prefixComponent:e,onChange:this.onPhoneNumberChanged,disabled:this.props.busy,autoFocus:t,onValidate:this.onPhoneNumberValidate,ref:e=>{this[mA.Password]=e}})}}}isLoginEmpty(){switch(this.state.loginType){case mA.Email:case mA.MatrixId:return!this.props.username;case mA.Phone:return!this.props.phoneCountry||!this.props.phoneNumber}}render(){let e;this.props.onForgotPasswordClick&&(e=o.createElement(be.A,{className:"mx_Login_forgot",disabled:this.props.busy,kind:"link",onClick:this.onForgotPasswordClick},(0,C._t)("auth|reset_password_button")));const t=ee()({error:this.props.loginIncorrect&&!this.isLoginEmpty()}),n=!this.isLoginEmpty(),i=this.renderLoginField(this.state.loginType,!n);let r;return g.Ay.get().disable_3pid_login||(r=o.createElement("div",{className:"mx_Login_type_container"},o.createElement("label",{className:"mx_Login_type_label"},(0,C._t)("auth|identifier_label")),o.createElement(tn.A,{element:"select",value:this.state.loginType,onChange:this.onLoginTypeChange,disabled:this.props.busy},o.createElement("option",{key:mA.MatrixId,value:mA.MatrixId},(0,C._t)("common|username")),o.createElement("option",{key:mA.Email,value:mA.Email},(0,C._t)("common|email_address")),o.createElement("option",{key:mA.Password,value:mA.Password},(0,C._t)("auth|msisdn_field_label"))))),o.createElement("div",null,o.createElement("form",{onSubmit:this.onSubmitForm},r,i,o.createElement(tn.A,{id:"mx_LoginForm_password",className:t,autoComplete:"current-password",type:"password",name:"password",label:(0,C._t)("common|password"),value:this.state.password,onChange:this.onPasswordChanged,disabled:this.props.busy,autoFocus:n,onValidate:this.onPasswordValidate,ref:e=>this[mA.Password]=e}),e,!this.props.busy&&o.createElement("input",{className:"mx_Login_submit",type:"submit",value:(0,C._t)("action|sign_in"),disabled:this.props.disableSubmit})))}}function pA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function gA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pA(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}(0,r.A)(hA,"defaultProps",{onUsernameChanged:function(){},onUsernameBlur:function(){},onPhoneCountryChanged:function(){},onPhoneNumberChanged:function(){},loginIncorrect:!1,disableSubmit:!1});class vA extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"oidcNativeFlowEnabled",!1),(0,r.A)(this,"loginLogic",void 0),(0,r.A)(this,"stepRendererMap",void 0),(0,r.A)(this,"isBusy",(()=>!!this.state.busy||!!this.props.busy)),(0,r.A)(this,"onPasswordLogin",(async(e,t,n,i)=>{if(!this.state.serverIsAlive){this.setState({busy:!0});let e=!0;try{await q.A.validateServerConfigWithStaticUrls(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl),this.setState({serverIsAlive:!0,errorText:""})}catch(t){const n=q.A.authComponentStateForError(t);this.setState(gA({busy:!1,busyLoggingIn:!1},n)),e=!n.serverErrorIsFatal}if(!e)return}this.setState({busy:!0,busyLoggingIn:!0,errorText:null,loginIncorrect:!1}),this.loginLogic.loginViaPassword(e,t,n,i).then((e=>{this.setState({serverIsAlive:!0}),this.props.onLoggedIn(e,i)}),(t=>{if(this.unmounted)return;let n;n=400===t.httpStatus&&e&&e.indexOf("@")>0?(0,C._t)("auth|unsupported_auth_email"):(0,pe.Y0)(t,this.props.serverConfig),this.setState({busy:!1,busyLoggingIn:!1,errorText:n,loginIncorrect:401===t.httpStatus||403===t.httpStatus})}))})),(0,r.A)(this,"onUsernameChanged",(e=>{this.setState({username:e})})),(0,r.A)(this,"onUsernameBlur",(async e=>{const t="@"===e[0];if(this.setState({username:e,busy:t,errorText:null,canTryLogin:!0}),t){const t=e.split(":").slice(1).join(":");try{const e=await q.A.validateServerName(t);this.props.onServerConfigChange(e),this.setState({busy:!1})}catch(e){l.v.error("Problem parsing URL or unhandled error doing .well-known discovery:",e);let t=(0,C._t)("auth|failed_homeserver_discovery");e instanceof C.P7&&e.translatedMessage&&(t=e.translatedMessage);let n=t,i={};q.A.isLivelinessError(e)&&(n=this.state.errorText,i=q.A.authComponentStateForError(e)),this.setState(gA({busy:!1,errorText:n},i))}}})),(0,r.A)(this,"onPhoneCountryChanged",(e=>{this.setState({phoneCountry:e})})),(0,r.A)(this,"onPhoneNumberChanged",(e=>{this.setState({phoneNumber:e})})),(0,r.A)(this,"onRegisterClick",(e=>{e.preventDefault(),e.stopPropagation(),this.props.onRegisterClick()})),(0,r.A)(this,"onTryRegisterClick",(e=>{var t,n;const i=null===(t=this.state.flows)||void 0===t?void 0:t.find((e=>"m.login.password"===e.type)),r=null===(n=this.state.flows)||void 0===n?void 0:n.find((e=>"m.login.sso"===e.type||"m.login.cas"===e.type));if(r&&!i){var o;e.preventDefault(),e.stopPropagation();const t="m.login.sso"===r.type?"sso":"cas";null===(o=p.A.get())||void 0===o||o.startSingleSignOn(this.loginLogic.createTemporaryClient(),t,this.props.fragmentAfterLogin,void 0,s.SSOAction.REGISTER)}else this.onRegisterClick(e)})),(0,r.A)(this,"isSupportedFlow",(e=>!!this.stepRendererMap[e.type]||(l.v.log("Skipping flow",e,"due to unsupported login type",e.type),!1))),(0,r.A)(this,"renderPasswordStep",(()=>o.createElement(hA,{onSubmit:this.onPasswordLogin,username:this.state.username,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber,onUsernameChanged:this.onUsernameChanged,onUsernameBlur:this.onUsernameBlur,onPhoneCountryChanged:this.onPhoneCountryChanged,onPhoneNumberChanged:this.onPhoneNumberChanged,onForgotPasswordClick:this.props.onForgotPasswordClick,loginIncorrect:this.state.loginIncorrect,serverConfig:this.props.serverConfig,disableSubmit:this.isBusy(),busy:this.props.isSyncing||this.state.busyLoggingIn}))),(0,r.A)(this,"renderOidcNativeStep",(()=>{const e=this.state.flows.find((e=>"oidcNativeFlow"===e.type));return o.createElement(be.A,{className:"mx_Login_fullWidthButton",kind:"primary",onClick:async()=>{await(0,iA.N)(this.props.serverConfig.delegatedAuthentication,e.clientId,this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl)}},(0,C._t)("action|continue"))})),(0,r.A)(this,"renderSsoStep",(e=>{var t,n;const i=null===(t=this.state.flows)||void 0===t?void 0:t.find((t=>t.type==="m.login."+e));return o.createElement(Yx,{matrixClient:this.loginLogic.createTemporaryClient(),flow:i,loginType:e,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!(null!==(n=this.state.flows)&&void 0!==n&&n.find((e=>"m.login.password"===e.type))),action:s.SSOAction.LOGIN,disabled:this.isBusy()})})),this.oidcNativeFlowEnabled=O.A.getValue(Ln.O5.OidcNativeFlow),this.state={busy:!1,errorText:null,loginIncorrect:!1,canTryLogin:!0,username:e.defaultUsername?e.defaultUsername:"",phoneCountry:"",phoneNumber:"",serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""},this.stepRendererMap={"m.login.password":this.renderPasswordStep,"m.login.cas":()=>this.renderSsoStep("cas"),"m.login.sso":()=>this.renderSsoStep("sso"),oidcNativeFlow:()=>this.renderOidcNativeStep()}}componentDidMount(){this.initLoginLogic(this.props.serverConfig)}componentWillUnmount(){this.unmounted=!0}componentDidUpdate(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl&&e.serverConfig.delegatedAuthentication===this.props.serverConfig.delegatedAuthentication||this.initLoginLogic(this.props.serverConfig)}async checkServerLiveliness({hsUrl:e,isUrl:t}){try{const{warning:n}=await q.A.validateServerConfigWithStaticUrls(e,t);n?this.setState(gA(gA({},q.A.authComponentStateForError(n)),{},{errorText:""})):this.setState({serverIsAlive:!0,errorText:""})}catch(e){this.setState(gA({busy:!1},q.A.authComponentStateForError(e)))}}async initLoginLogic({hsUrl:e,isUrl:t}){let n=!1;this.props.serverConfig.isDefault&&e===this.props.serverConfig.hsUrl&&t===this.props.serverConfig.isUrl&&(n=!0);const i=n?this.props.fallbackHsUrl:null;this.setState({busy:!0,loginIncorrect:!1}),await this.checkServerLiveliness({hsUrl:e,isUrl:t});const r=new Jx.A(e,t,i,{defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,delegatedAuthentication:this.oidcNativeFlowEnabled?this.props.serverConfig.delegatedAuthentication:void 0});this.loginLogic=r,r.getFlows().then((e=>{const t=e.filter(this.isSupportedFlow);this.setState({flows:t}),0===t.length&&this.setState({errorText:(0,C._t)("auth|unsupported_auth")})}),(e=>{this.setState({errorText:(0,pe.Vp)(e,this.props.serverConfig),loginIncorrect:!1,canTryLogin:!1})})).finally((()=>{this.setState({busy:!1})}))}renderLoginComponentForFlows(){if(!this.state.flows)return null;const e=(0,Pl.Bo)(["oidcNativeFlow","m.login.password","m.login.sso"].map((e=>{var t;return null===(t=this.state.flows)||void 0===t?void 0:t.find((t=>t.type===e))})));return o.createElement(o.Fragment,null,e.map((e=>{const t=this.stepRendererMap[e.type];return o.createElement(o.Fragment,{key:e.type},t())})))}render(){const e=this.isBusy()&&!this.state.busyLoggingIn?o.createElement("div",{className:"mx_Login_loader"},o.createElement(dn.A,null)):null,t=this.state.errorText;let n,i,r;if(t&&(n=o.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=ee()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});i=o.createElement("div",{className:e},this.state.serverDeadError)}return this.props.isSyncing||this.state.busyLoggingIn?r=o.createElement("div",{className:"mx_AuthBody_paddedFooter"},o.createElement("div",{className:"mx_AuthBody_paddedFooter_title"},o.createElement(Ve.A,{w:20,h:20}),this.props.isSyncing?(0,C._t)("auth|syncing"):(0,C._t)("auth|signing_in")),this.props.isSyncing&&o.createElement("div",{className:"mx_AuthBody_paddedFooter_subtitle"},(0,C._t)("auth|sync_footer_subtitle"))):O.A.getValue(W.f.Registration)&&(r=o.createElement("span",{className:"mx_AuthBody_changeFlow"},(0,C._t)("auth|create_account_prompt",{},{a:e=>o.createElement(be.A,{kind:"link_inline",onClick:this.onTryRegisterClick},e)}))),o.createElement(ux.A,null,o.createElement(Ex,{disableLanguageSelector:this.props.isSyncing||this.state.busyLoggingIn}),o.createElement(bx,null,o.createElement("h1",null,(0,C._t)("action|sign_in"),e),n,i,o.createElement(Xx,{serverConfig:this.props.serverConfig,onServerConfigChange:this.props.onServerConfigChange,disabled:this.isBusy()}),this.renderLoginComponentForFlows(),r))}}var _A=n("./node_modules/matrix-react-sdk/src/utils/KeyVerificationStateObserver.ts");class fA extends o.PureComponent{constructor(e){var t;super(e),(0,r.A)(this,"intervalHandle",void 0),(0,r.A)(this,"checkRequestIsPending",(()=>{const{request:e}=this.props;(0,ix.canAcceptVerificationRequest)(e)||S.A.sharedInstance().dismissToast(this.props.toastKey)})),(0,r.A)(this,"cancel",(()=>{S.A.sharedInstance().dismissToast(this.props.toastKey);try{this.props.request.cancel()}catch(e){l.v.error("Error while cancelling verification request",e)}})),(0,r.A)(this,"accept",(async()=>{S.A.sharedInstance().dismissToast(this.props.toastKey);const{request:e}=this.props,t=h.J.safeGet();try{if(e.roomId){var n;v.Ay.dispatch({action:x.r.ViewRoom,room_id:e.roomId,should_peek:!1,metricsTrigger:"VerificationRequest"});const i=null!==(n=t.getUser(e.otherUserId))&&void 0!==n?n:void 0;qn.A.instance.setCards([{phase:$n.n.RoomSummary},{phase:$n.n.RoomMemberInfo,state:{member:i}},{phase:$n.n.EncryptionPanel,state:{verificationRequest:e,member:i}}],void 0,e.roomId)}else f.Ay.createDialog(Cb.A,{verificationRequest:e,onFinished:()=>{e.cancel()}},void 0,!1,!0);await e.accept()}catch(e){l.v.error("Failed to accept verification request",e)}})),this.state={counter:Math.ceil((null!==(t=e.request.timeout)&&void 0!==t?t:0)/1e3)}}async componentDidMount(){const{request:e}=this.props;e.timeout&&e.timeout>0&&(this.intervalHandle=window.setInterval((()=>{let{counter:e}=this.state;e=Math.max(0,e-1),this.setState({counter:e})}),1e3)),e.on(ix.VerificationRequestEvent.Change,this.checkRequestIsPending),this.checkRequestIsPending();const t=e.otherDeviceId;if(e.isSelfVerification&&t){const e=h.J.safeGet(),n=await e.getDevice(t);this.setState({ip:n.last_seen_ip,device:await(0,Xc.G)(e,e.getSafeUserId(),t)})}}componentWillUnmount(){clearInterval(this.intervalHandle);const{request:e}=this.props;e.off(ix.VerificationRequestEvent.Change,this.checkRequestIsPending)}render(){const{request:e}=this.props;let t,n;if(e.isSelfVerification)this.state.device&&(t=this.state.device.displayName,n=(0,C._t)("encryption|verification|request_toast_detail",{deviceId:this.state.device.deviceId,ip:this.state.ip}));else{const n=h.J.safeGet(),i=e.otherUserId,r=e.roomId;if(t=r?(0,_A.M)(n,i,r):i,t===i){const e=n.getUser(i);e&&e.displayName&&(t=(0,C._t)("name_and_id",{name:e.displayName,userId:i}))}}const i=0===this.state.counter?(0,C._t)("action|ignore"):(0,C._t)("encryption|verification|request_toast_decline_counter",{counter:this.state.counter});return o.createElement(k.A,{description:t,detail:n,primaryLabel:e.isSelfVerification||!e.roomId?(0,C._t)("encryption|verification|request_toast_accept"):(0,C._t)("encryption|verification|request_toast_accept_user"),onPrimaryClick:this.accept,secondaryLabel:i,onSecondaryClick:this.cancel})}}let yA=function(e){return e.APP_STARTUP="mx_AppStartup",e.PAGE_CHANGE="mx_PageChange",e.RESEND_EVENT="mx_ResendEvent",e.SEND_E2EE_EVENT="mx_SendE2EEEvent",e.SEND_ATTACHMENT="mx_SendAttachment",e.SWITCH_ROOM="mx_SwithRoom",e.JUMP_TO_ROOM="mx_JumpToRoom",e.JOIN_ROOM="mx_JoinRoom",e.CREATE_DM="mx_CreateDM",e.PEEK_ROOM="mx_PeekRoom",e.VERIFY_E2EE_USER="mx_VerifyE2EEUser",e.LOGIN="mx_Login",e.REGISTER="mx_Register",e.SETUP_VOIP_CALL="mx_SetupVoIPCall",e}({});class EA{constructor(){(0,r.A)(this,"START_PREFIX","start:"),(0,r.A)(this,"STOP_PREFIX","stop:"),(0,r.A)(this,"listeners",[]),(0,r.A)(this,"entries",[])}static get instance(){return EA._instance||(EA._instance=new EA),EA._instance}start(e,t){if(!this.supportsPerformanceApi())return;const n=this.buildKey(e,t);performance.getEntriesByName(this.START_PREFIX+n).length>0?l.v.warn(`Recording already started for: ${e}`):performance.mark(this.START_PREFIX+n)}stop(e,t){if(!this.supportsPerformanceApi())return;const n=this.buildKey(e,t);if(0===performance.getEntriesByName(this.START_PREFIX+n).length)return void l.v.warn(`No recording started for: ${e}`);performance.mark(this.STOP_PREFIX+n),performance.measure(n,this.START_PREFIX+n,this.STOP_PREFIX+n),this.clear(e,t);const i=performance.getEntriesByName(n).pop();return this.entries.push(i),this.listeners.forEach((e=>{this.shouldEmit(e,i)&&e.callback([i])})),i}clear(e,t){if(!this.supportsPerformanceApi())return;const n=this.buildKey(e,t);performance.clearMarks(this.START_PREFIX+n),performance.clearMarks(this.STOP_PREFIX+n)}getEntries({name:e,type:t}={}){return this.entries.filter((n=>{const i=!e||n.name===e,r=!t||n.entryType===t;return i&&r}))}addPerformanceDataCallback(e,t=!1){if(this.listeners.push(e),t){const t=this.entries.filter((t=>this.shouldEmit(e,t)));t.length>0&&e.callback(t)}}removePerformanceDataCallback(e){e?this.listeners.splice(this.listeners.findIndex((t=>t.callback===e)),1):this.listeners=[]}supportsPerformanceApi(){return void 0!==performance&&void 0!==performance.mark}shouldEmit(e,t){return!e.entryNames||e.entryNames.includes(t.name)}buildKey(e,t){return`${e}${t?`:${t}`:""}`}}(0,r.A)(EA,"_instance",void 0),window.mxPerformanceMonitor=EA.instance,window.mxPerformanceEntryNames=yA;class bA extends o.Component{constructor(...e){super(...e),(0,r.A)(this,"onConfirm",(()=>{this.props.onFinished(!0)})),(0,r.A)(this,"onDecline",(()=>{this.props.onFinished(!1)}))}render(){return o.createElement(cn.A,{className:"mx_ConfirmWipeDeviceDialog",hasCancel:!0,onFinished:this.props.onFinished,title:(0,C._t)("auth|soft_logout|clear_data_title")},o.createElement("div",{className:"mx_ConfirmWipeDeviceDialog_content"},o.createElement("p",null,(0,C._t)("auth|soft_logout|clear_data_description"))),o.createElement(un.A,{primaryButton:(0,C._t)("auth|soft_logout|clear_data_button"),onPrimaryButtonClick:this.onConfirm,primaryButtonClass:"danger",cancelButton:(0,C._t)("action|cancel"),onCancel:this.onDecline}))}}var wA=function(e){return e[e.Loading=0]="Loading",e[e.Password=1]="Password",e[e.CAS=2]="CAS",e[e.SSO=3]="SSO",e[e.PasswordWithSocialSignOn=4]="PasswordWithSocialSignOn",e[e.Unsupported=5]="Unsupported",e}(wA||{});const xA={"m.login.password":wA.Password,"m.login.cas":wA.CAS,"m.login.sso":wA.SSO};class AA extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"onClearAll",(()=>{f.Ay.createDialog(bA,{onFinished:e=>{e&&(l.v.log("Clearing data from soft-logged-out session"),b.ri(this.context.oidcClientStore))}})})),(0,r.A)(this,"onPasswordChange",(e=>{this.setState({password:e.target.value})})),(0,r.A)(this,"onForgotPassword",(()=>{v.Ay.dispatch({action:"start_password_recovery"})})),(0,r.A)(this,"onPasswordLogin",(async e=>{var t;e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});const n=h.J.safeGet(),i=n.getHomeserverUrl(),r=n.getIdentityServerUrl(),o={identifier:{type:"m.id.user",user:n.getUserId()},password:this.state.password,device_id:null!==(t=n.getDeviceId())&&void 0!==t?t:void 0};let a;try{a=await(0,Jx.b)(i,r,"m.login.password",o)}catch(e){let t=(0,C._t)("auth|failed_soft_logout_homeserver");return e instanceof s.MatrixError&&"M_FORBIDDEN"===e.errcode&&(401===e.httpStatus||403===e.httpStatus)&&(t=(0,C._t)("auth|incorrect_password")),void this.setState({busy:!1,errorText:t})}b.E9(a).catch((e=>{l.v.error(e),this.setState({busy:!1,errorText:(0,C._t)("auth|failed_soft_logout_auth")})}))})),this.state={loginView:wA.Loading,busy:!1,password:"",errorText:"",flows:[]}}componentDidMount(){b.b()?this.initLogin():v.Ay.dispatch({action:"start_login"})}async initLogin(){const e=this.props.realQueryParams;if(null==e?void 0:e.loginToken){this.setState({loginView:wA.Loading});if(await this.trySsoLogin())return}const t=h.J.safeGet(),n=(await t.loginFlows()).flows,i=n.map((e=>xA[e.type])),r=i.includes(wA.Password)&&i.includes(wA.SSO),o=i.filter((e=>!!e))[0]||wA.Unsupported,s=r?wA.PasswordWithSocialSignOn:o;this.setState({flows:n,loginView:s})}async trySsoLogin(){var e;this.setState({busy:!0});const t=localStorage.getItem(ub.FL);if(!t)return l.v.error("Homeserver URL unknown for SSO login callback"),this.setState({busy:!1,loginView:wA.Unsupported}),!1;const n=localStorage.getItem(ub.U7)||h.J.safeGet().getIdentityServerUrl(),i={token:this.props.realQueryParams.loginToken,device_id:null!==(e=h.J.safeGet().getDeviceId())&&void 0!==e?e:void 0};let r;try{r=await(0,Jx.b)(t,n,"m.login.token",i)}catch(e){return l.v.error(e),this.setState({busy:!1,loginView:wA.Unsupported}),!1}return b.E9(r).then((()=>(this.props.onTokenLoginCompleted&&this.props.onTokenLoginCompleted(),!0))).catch((e=>(l.v.error(e),this.setState({busy:!1,loginView:wA.Unsupported}),!1)))}renderPasswordForm(e){let t;return this.state.errorText&&(t=o.createElement("span",{className:"mx_Login_error"},this.state.errorText)),o.createElement("form",{onSubmit:this.onPasswordLogin},e?o.createElement("p",null,e):null,t,o.createElement(tn.A,{type:"password",label:(0,C._t)("common|password"),onChange:this.onPasswordChange,value:this.state.password,disabled:this.state.busy}),o.createElement(be.A,{onClick:this.onPasswordLogin,kind:"primary",type:"submit",disabled:this.state.busy},(0,C._t)("action|sign_in")),o.createElement(be.A,{onClick:this.onForgotPassword,kind:"link"},(0,C._t)("auth|forgot_password_prompt")))}renderSsoForm(e){const t=this.state.loginView===wA.CAS?"cas":"sso",n=this.state.flows.find((e=>e.type==="m.login."+t));return o.createElement("div",null,e?o.createElement("p",null,e):null,o.createElement(Yx,{matrixClient:h.J.safeGet(),flow:n,loginType:t,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!this.state.flows.find((e=>"m.login.password"===e.type)),action:s.SSOAction.LOGIN}))}renderSignInSection(){return this.state.loginView===wA.Loading?o.createElement(dn.A,null):this.state.loginView===wA.Password?this.renderPasswordForm((0,C._t)("auth|soft_logout_intro_password")):this.state.loginView===wA.SSO||this.state.loginView===wA.CAS?this.renderSsoForm((0,C._t)("auth|soft_logout_intro_sso")):this.state.loginView===wA.PasswordWithSocialSignOn?o.createElement(o.Fragment,null,o.createElement("p",null,(0,C._t)("auth|soft_logout_intro_sso")),this.renderSsoForm(null),o.createElement("h2",{className:"mx_AuthBody_centered"},(0,C._t)("auth|sso_or_username_password",{ssoButtons:"",usernamePassword:""}).trim()),this.renderPasswordForm(null)):o.createElement("p",null,(0,C._t)("auth|soft_logout_intro_unsupported_auth"))}render(){return o.createElement(ux.A,null,o.createElement(Ex,null),o.createElement(bx,null,o.createElement("h1",null,(0,C._t)("auth|soft_logout_heading")),o.createElement("h2",null,(0,C._t)("action|sign_in")),o.createElement("div",null,this.renderSignInSection()),o.createElement("h2",null,(0,C._t)("auth|soft_logout_subheading")),o.createElement("p",null,(0,C._t)("auth|soft_logout_warning")),o.createElement("div",null,o.createElement(be.A,{onClick:this.onClearAll,kind:"danger"},(0,C._t)("auth|soft_logout|clear_data_button")))))}}(0,r.A)(AA,"contextType",Xt.A);var SA=n("./node_modules/matrix-react-sdk/src/sentry.ts"),CA=n("./node_modules/matrix-react-sdk/src/Views.ts");const kA=["children","className"];function RA(e){let{children:t,className:n}=e,r=(0,Ue.A)(e,kA);const s=ee()(n,"mx_SplashPage");return o.createElement("main",(0,i.A)({},r,{className:s}),t)}function IA({useCase:e,onClick:t,selected:n}){let i;switch(e){case zr.PersonalMessaging:i=(0,C._t)("onboarding|use_case_personal_messaging");break;case zr.WorkMessaging:i=(0,C._t)("onboarding|use_case_work_messaging");break;case zr.CommunityMessaging:i=(0,C._t)("onboarding|use_case_community_messaging")}return o.createElement(be.A,{className:ee()("mx_UseCaseSelectionButton",{mx_UseCaseSelectionButton_selected:n}),onClick:async()=>t(e)},o.createElement("div",{className:ee()("mx_UseCaseSelectionButton_icon",{mx_UseCaseSelectionButton_messaging:e===zr.PersonalMessaging,mx_UseCaseSelectionButton_work:e===zr.WorkMessaging,mx_UseCaseSelectionButton_community:e===zr.CommunityMessaging})}),o.createElement("span",null,i),o.createElement("div",{className:"mx_UseCaseSelectionButton_selectedIcon"}))}function TA({onFinished:e}){const[t,n]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(t){let n=window.setTimeout((()=>{n=null,e(t)}),1500);return()=>{null!==n&&clearTimeout(n),n=null}}}),[t,e]),o.createElement(RA,{className:ee()("mx_UseCaseSelection",{mx_UseCaseSelection_selected:null!==t})},o.createElement("div",{className:"mx_UseCaseSelection_title mx_UseCaseSelection_slideIn"},o.createElement("h1",null,(0,C._t)("onboarding|use_case_heading1"))),o.createElement("div",{className:"mx_UseCaseSelection_info mx_UseCaseSelection_slideInDelayed"},o.createElement("h2",null,(0,C._t)("onboarding|use_case_heading2")),o.createElement("h3",null,(0,C._t)("onboarding|use_case_heading3"))),o.createElement("div",{className:"mx_UseCaseSelection_options mx_UseCaseSelection_slideInDelayed"},o.createElement(IA,{useCase:zr.PersonalMessaging,selected:t===zr.PersonalMessaging,onClick:n}),o.createElement(IA,{useCase:zr.WorkMessaging,selected:t===zr.WorkMessaging,onClick:n}),o.createElement(IA,{useCase:zr.CommunityMessaging,selected:t===zr.CommunityMessaging,onClick:n})),o.createElement("div",{className:"mx_UseCaseSelection_skip mx_UseCaseSelection_slideInDelayed"},o.createElement(be.A,{kind:"link",onClick:async()=>n(zr.Skip)},(0,C._t)("action|skip"))))}function PA(e,t,n){(0,o.useEffect)((()=>{let i=null;const r=()=>{i=null,t(...n)};if(!1!==e)return i=window.setTimeout(r,100),()=>{i&&clearTimeout(i)}}),[e,t,n])}const NA=e=>{const t=(0,o.useRef)(null);return[(0,o.useCallback)((e=>{t.current=e}),[]),(0,o.useCallback)(((n,i)=>{t.current===n&&e(i)}),[e])]},DA="ALL_ROOMS",MA="mx_last_room_directory_server",OA="mx_last_room_directory_instance";let LA;const UA="nsfw",FA=e=>{var t,n;return!(null!==(t=e.name)&&void 0!==t&&t.toLocaleLowerCase().includes(UA)||null!==(n=e.topic)&&void 0!==n&&n.toLocaleLowerCase().includes(UA))},jA=()=>{const[e,t]=(0,o.useState)([]),[n,i]=(0,o.useState)(void 0),[r,s]=(0,o.useState)(null),[a,l]=(0,o.useState)(!1),[c,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(),[p,v]=NA(t),_=(0,Ne.ti)("SpotlightSearch.showNsfwPublicRooms");const f=(0,o.useCallback)((async({limit:e=20,query:t,roomTypes:i})=>{const r={limit:e};(null==n?void 0:n.roomServer)!=h.J.safeGet().getDomain()&&(r.server=null==n?void 0:n.roomServer),(null==n?void 0:n.instanceId)===DA?r.include_all_networks=!0:null!=n&&n.instanceId&&(r.third_party_instance_id=n.instanceId),(t||i)&&(r.filter={generic_search_term:t,room_types:i&&await h.J.safeGet().doesServerSupportUnstableFeature("org.matrix.msc3827.stable")?Array.from(i):void 0}),p(r),d(!0),m(void 0);try{const{chunk:e}=await h.J.safeGet().publicRooms(r);return v(r,_?e:e.filter(FA)),!0}catch(e){return m(!(e instanceof Error)||e),console.error("Could not fetch public rooms for params",r,e),v(r,[]),!1}finally{d(!1)}}),[n,p,v,_]);return(0,o.useEffect)((()=>{!async function(){if(h.J.get())if(LA)s(LA);else{const e=await h.J.safeGet().getThirdpartyProtocols();LA=e,s(e)}else l(!0)}()}),[]),(0,o.useEffect)((()=>{var e,t,n;if(null===r)return;const o=h.J.safeGet().getDomain(),s=localStorage.getItem(MA),a=null!==(e=localStorage.getItem(OA))&&void 0!==e?e:void 0;let c,d=o;s&&(null!==(t=g.Ay.getObject("room_directory"))&&void 0!==t&&null!==(t=t.get("servers"))&&void 0!==t&&t.includes(s)||null!==(n=O.A.getValue("room_directory_servers"))&&void 0!==n&&n.includes(s))&&(d=s),d!==o||a!==DA&&!Object.values(r).some((e=>{e.instances.some((e=>e.instance_id===a))}))||(c=a),l(!0),i({roomServer:d,instanceId:c})}),[r]),(0,o.useEffect)((()=>{n&&(localStorage.setItem(MA,n.roomServer),n.instanceId?localStorage.setItem(OA,n.instanceId):localStorage.removeItem(OA))}),[n]),{ready:a,loading:c,publicRooms:e,protocols:r,config:n,search:f,setConfig:function(e){if(!a)throw new Error("public room configuration not initialised yet");i(e)},error:u}};var BA=n("./node_modules/matrix-react-sdk/src/stores/room-list/algorithms/tag-sorting/RecentAlgorithm.ts"),VA=n("./node_modules/matrix-react-sdk/src/utils/SortMembers.ts"),HA=n("./node_modules/matrix-react-sdk/src/components/views/avatars/SearchResultAvatar.tsx"),zA=n("./node_modules/matrix-react-sdk/src/accessibility/context_menu/MenuItemRadio.tsx");function WA({label:e,description:t,onClick:n,isSelected:i,adornment:r}){return o.createElement(zA.s,{active:i,className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--item",onClick:n},o.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},o.createElement("span",null,e),o.createElement("span",null,t)),r)}function GA({label:e,description:t,adornment:n,children:i}){return o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--header"},o.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},o.createElement("span",null,e),o.createElement("span",null,t)),n),i)}function KA(e){return"options"in e}function JA({value:e,onChange:t,options:n,selectedLabel:r,onOpen:s,onClose:a,toKey:l,className:c,AdditionalOptions:d}){const[u,m,h,p]=(0,Me.EF)(),g=n.flatMap((e=>KA(e)?[e,...e.options]:[e])).find((t=>l?l(t.key)===l(e):t.key===e));let v;v=n&&KA(n[0])?o.createElement(o.Fragment,null,n.map((e=>{var n;return o.createElement(GA,{key:null!==(n=null==l?void 0:l(e.key))&&void 0!==n?n:e.key,label:e.label,description:e.description,adornment:e.adornment},e.options.map((e=>{var n;return o.createElement(WA,{key:null!==(n=null==l?void 0:l(e.key))&&void 0!==n?n:e.key,label:e.label,description:e.description,onClick:n=>{t(e.key),p(),null==a||a(n)},adornment:e.adornment,isSelected:e===g})})))}))):o.createElement(o.Fragment,null,n.map((e=>{var n;return o.createElement(WA,{key:null!==(n=null==l?void 0:l(e.key))&&void 0!==n?n:e.key,label:e.label,description:e.description,onClick:n=>{t(e.key),p(),null==a||a(n)},adornment:e.adornment,isSelected:e===g})})));const _=u&&m.current?o.createElement(Me.Ay,(0,i.A)({onFinished:p,chevronFace:Me.t4.Top,wrapperClassName:ee()("mx_GenericDropdownMenu_wrapper",c)},(0,Me.qv)(m.current.getBoundingClientRect())),v,d&&o.createElement(d,{menuDisplayed:u,openMenu:h,closeMenu:p})):null;return o.createElement(o.Fragment,null,o.createElement(Me.VJ,{className:"mx_GenericDropdownMenu_button",ref:m,isExpanded:u,onClick:e=>{h(),null==s||s(e)}},r(g)),_)}var qA=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/TextInputDialog.tsx");function $A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const YA=(0,As.A)({deriveData:async({value:e})=>{try{return await h.J.safeGet().publicRooms({limit:1,server:null!=e?e:void 0}),{}}catch(e){return{error:e}}},rules:[{key:"required",test:async({value:e})=>!!e,invalid:()=>(0,C._t)("spotlight|public_rooms|network_dropdown_required_invalid")},{key:"available",final:!0,test:async(e,{error:t})=>!t,valid:()=>(0,C._t)("spotlight|public_rooms|network_dropdown_available_valid"),invalid:({error:e})=>e instanceof s.MatrixError&&"M_FORBIDDEN"===e.errcode?(0,C._t)("spotlight|public_rooms|network_dropdown_available_invalid_forbidden"):(0,C._t)("spotlight|public_rooms|network_dropdown_available_invalid")}],memoize:!0});function QA(e,...t){for(const n of t)e.delete(n)}function ZA(){var e,t;const[n,i]=function(e,t,n=null,i=!1){const[r,s]=(0,o.useState)(O.A.getValue(e,null!=n?n:void 0,i)),a=(0,o.useCallback)((async i=>{s(i),O.A.setValue(e,n,t,i)}),[t,n,e]);return(0,o.useEffect)((()=>{const t=O.A.watchSetting(e,n,(()=>{s(O.A.getValue(e,n,i))}));return()=>{O.A.unwatchSetting(t)}}),[e,n,i]),[r,a]}("room_directory_servers",re.p.ACCOUNT),r=h.J.safeGet().getDomain(),s=new Set(null!==(e=null===(t=g.Ay.getObject("room_directory"))||void 0===t?void 0:t.get("servers"))&&void 0!==e?e:[]);QA(s,r);const a=new Set(n);return QA(a,r),QA(a,...s),{allServers:[r,...Array.from(s).sort(),...Array.from(a).sort()],homeServer:r,userDefinedServers:Array.from(a).sort(),setUserDefinedServers:i}}const XA=({protocols:e,config:t,setConfig:n})=>{const{allServers:i,homeServer:s,userDefinedServers:a,setUserDefinedServers:l}=ZA(),d=i.map((t=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$A(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({key:{roomServer:t,instanceId:void 0},label:t,description:t===s?(0,C._t)("spotlight|public_rooms|network_dropdown_your_server_description"):null,options:[{key:{roomServer:t,instanceId:void 0},label:(0,C._t)("common|matrix")},...t===s&&e?Object.values(e).flatMap((e=>e.instances)).map((e=>({key:{roomServer:t,instanceId:e.instance_id},label:e.desc}))):[]]},a.includes(t)?{adornment:o.createElement(be.A,{className:"mx_NetworkDropdown_removeServer",alt:(0,C._t)("spotlight|public_rooms|network_dropdown_remove_server_adornment",{roomServer:t}),onClick:()=>l((0,c.without)(a,t))})}:{}))),u=(0,o.useCallback)((({closeMenu:e})=>o.createElement(o.Fragment,null,o.createElement("span",{className:"mx_GenericDropdownMenu_divider"}),o.createElement(zA.s,{active:!1,className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--item",onClick:async()=>{e();const{finished:t}=f.Ay.createDialog(qA.A,{title:(0,C._t)("spotlight|public_rooms|network_dropdown_add_dialog_title"),description:(0,C._t)("spotlight|public_rooms|network_dropdown_add_dialog_description"),button:(0,C._t)("action|add"),hasCancel:!1,placeholder:(0,C._t)("spotlight|public_rooms|network_dropdown_add_dialog_placeholder"),validator:YA,fixedWidth:!1},"mx_NetworkDropdown_dialog"),[r,o]=await t;r&&(i.includes(o)||(l([...a,o]),n({roomServer:o})))}},o.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},o.createElement("span",{className:"mx_NetworkDropdown_addServer"},(0,C._t)("spotlight|public_rooms|network_dropdown_add_server_option")))))),[i,n,l,a]);return o.createElement(JA,{className:"mx_NetworkDropdown_wrapper",value:t,toKey:e=>e?`${e.roomServer}-${e.instanceId}`:"null",options:d,onChange:e=>n(e),selectedLabel:e=>null!=e&&e.key?(0,C._t)("spotlight|public_rooms|network_dropdown_selected_label_instance",{server:e.key.roomServer,instance:e.key.instanceId?e.label:"Matrix"}):(0,C._t)("spotlight|public_rooms|network_dropdown_selected_label"),AdditionalOptions:u})},eS=["inputRef","children","endAdornment","className"],tS=e=>{let{inputRef:t,children:n,endAdornment:r,className:s}=e,a=(0,Ue.A)(e,eS);const[l,c,d]=(0,Ze.A9)(t);return o.createElement(be.A,(0,i.A)({},a,{className:ee()(s,"mx_SpotlightDialog_option"),onFocus:l,ref:d,tabIndex:-1,"aria-selected":c,role:"option",element:"li"}),n,o.createElement("div",{className:"mx_SpotlightDialog_option--endAdornment"},o.createElement("kbd",{className:"mx_SpotlightDialog_enterPrompt","aria-hidden":!0},"↵"),r))};function nS({room:e,labelId:t,descriptionId:n,detailsId:i}){var r,s,a;let l=e.name||(0,E.iW)(null!==(r=e.canonical_alias)&&void 0!==r?r:"",null!==(s=e.aliases)&&void 0!==s?s:[])||(0,C._t)("common|unnamed_room");l.length>80&&(l=`${l.substring(0,80)}...`);let c=e.topic||"";return c.length>800&&(c=`${c.substring(0,800)}...`),o.createElement("div",{className:"mx_SpotlightDialog_result_publicRoomDetails"},o.createElement("div",{className:"mx_SpotlightDialog_result_publicRoomHeader"},o.createElement("span",{id:t,className:"mx_SpotlightDialog_result_publicRoomName"},l),o.createElement("span",{id:n,className:"mx_SpotlightDialog_result_publicRoomAlias"},null!==(a=e.canonical_alias)&&void 0!==a?a:e.room_id)),o.createElement("div",{id:i,className:"mx_SpotlightDialog_result_publicRoomDescription"},o.createElement("span",{className:"mx_SpotlightDialog_result_publicRoomMemberCount"},(0,C._t)("spotlight_dialog|count_of_members",{count:e.num_joined_members})),c&&o.createElement(o.Fragment,null," · ",o.createElement("span",{className:"mx_SpotlightDialog_result_publicRoomTopic",dangerouslySetInnerHTML:{__html:(0,Ga.kz)(c)}}))))}var iS=n("./node_modules/matrix-react-sdk/src/hooks/useRoomNotificationState.ts"),rS=n("./node_modules/matrix-react-sdk/src/components/views/context_menus/RoomGeneralContextMenu.tsx"),oS=n("./node_modules/matrix-react-sdk/src/components/views/context_menus/RoomNotificationContextMenu.tsx");function sS({room:e}){const[t]=(0,iS.I)(e),[n,r]=(0,o.useState)(null),[s,a]=(0,o.useState)(null);let l,c;null!==n&&(l=e.isSpaceRoom()?o.createElement(Be,(0,i.A)({},(0,$h._E)(n),{space:e,onFinished:()=>r(null)})):o.createElement(rS.e,(0,i.A)({},(0,$h._E)(n),{room:e,onFinished:()=>r(null)}))),null!==s&&(c=o.createElement(oS.f,(0,i.A)({},(0,$h._E)(s),{room:e,onFinished:()=>a(null)})));const d=ee()("mx_SpotlightDialog_option--notifications",{mx_RoomNotificationContextMenu_iconBell:t===Gh.dC.AllMessages,mx_RoomNotificationContextMenu_iconBellDot:t===Gh.dC.AllMessagesLoud,mx_RoomNotificationContextMenu_iconBellMentions:t===Gh.dC.MentionsOnly,mx_RoomNotificationContextMenu_iconBellCrossed:t===Gh.dC.Mute});return o.createElement(o.Fragment,null,(0,Ie.g)(W.C.RoomOptionsMenu)&&o.createElement($e.o,{className:"mx_SpotlightDialog_option--menu",onClick:e=>{e.preventDefault(),e.stopPropagation();const t=e.target;r(t.getBoundingClientRect())},title:e.isSpaceRoom()?(0,C._t)("space|context_menu|options"):(0,C._t)("room|context_menu|title"),isExpanded:null!==n}),!e.isSpaceRoom()&&o.createElement($e.o,{className:d,onClick:e=>{e.preventDefault(),e.stopPropagation();const t=e.target;a(t.getBoundingClientRect())},title:(0,C._t)("room_list|notification_options"),isExpanded:null!==s}),l,c)}var aS=n("./node_modules/matrix-react-sdk/src/components/views/rooms/RoomContextDetails.tsx");const lS=["inputRef","className","element"],cS=e=>{let{inputRef:t,className:n,element:r}=e,s=(0,Ue.A)(e,lS);const[a,l,c]=(0,Ze.A9)(t);return o.createElement(be.A,(0,i.A)({},s,{className:ee()(n,"mx_SpotlightDialog_option"),onFocus:a,ref:c,tabIndex:-1,"aria-selected":l,role:"option",element:r}))};var dS=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/spotlight/Filter.ts");const uS=50,mS="24px";function hS(e){var t;return!0===(null==e||null===(t=e.current)||void 0===t||null===(t=t.id)||void 0===t?void 0:t.startsWith("mx_SpotlightDialog_button_recentlyViewed_"))}function pS(e){const t=new Set;return e===dS.d.PublicRooms&&t.add(null),e===dS.d.PublicSpaces&&t.add(s.RoomType.Space),t}var gS=function(e){return e[e.People=0]="People",e[e.Rooms=1]="Rooms",e[e.Spaces=2]="Spaces",e[e.Suggestions=3]="Suggestions",e[e.PublicRoomsAndSpaces=4]="PublicRoomsAndSpaces",e}(gS||{});function vS(e){switch(e){case dS.d.People:return(0,C._t)("common|people");case dS.d.PublicRooms:return(0,C._t)("spotlight_dialog|public_rooms_label");case dS.d.PublicSpaces:return(0,C._t)("spotlight_dialog|public_spaces_label")}}const _S=e=>!(null==e||!e.room),fS=e=>!(null==e||!e.publicRoom),yS=e=>!(null==e||!e.member),ES=e=>{var t,n,i,r,o;return{publicRoom:e,section:gS.PublicRoomsAndSpaces,filter:[dS.d.PublicRooms,dS.d.PublicSpaces],query:(0,Pl.Bo)([e.room_id.toLowerCase(),null===(t=e.canonical_alias)||void 0===t?void 0:t.toLowerCase(),null===(n=e.name)||void 0===n?void 0:n.toLowerCase(),Yr()(null!==(i=null===(r=e.topic)||void 0===r?void 0:r.toLowerCase())&&void 0!==i?i:"",{allowedTags:[]}),...(null===(o=e.aliases)||void 0===o?void 0:o.map((e=>e.toLowerCase())))||[]])}},bS=e=>{const t=h.J.safeGet().getUserId();if(Ti.A.shared().getUserIdForRoomId(e.roomId)){const n=e.getMembers().filter((e=>e.userId!==t)),i=[...n.map((e=>e.name.toLowerCase())),...n.map((e=>e.userId.toLowerCase()))].filter(Boolean);return{room:e,section:gS.People,filter:[dS.d.People],query:i}}return e.isSpaceRoom()?{room:e,section:gS.Spaces,filter:[]}:{room:e,section:gS.Rooms,filter:[]}},wS=(e,t)=>({alreadyFiltered:t,member:e,section:gS.Suggestions,filter:[dS.d.People],query:[e.userId.toLowerCase(),e.name.toLowerCase()].filter(Boolean)}),xS=new BA.V7,AS=(e,t)=>t.hasMentions?(0,C._t)("a11y|n_unread_messages_mentions",{count:t.count}):t.hasUnreadCount?(0,C._t)("a11y|n_unread_messages",{count:t.count}):t.isUnread?(0,C._t)("a11y|unread_messages"):void 0,SS=e=>O.A.getValue("feature_ask_to_join")&&s.JoinRule.Knock===e,CS=({initialText:e="",initialFilter:t=null,onFinished:n})=>{var r;const l=(0,o.useRef)(null),d=(0,o.useRef)(null),u=h.J.safeGet(),m=(0,o.useContext)(Ze.ui),[p,g]=(0,o.useState)(e),[_,f]=(()=>{const[e,t]=(0,o.useState)((()=>{const e=h.J.safeGet(),t=O.A.getValue("SpotlightSearch.recentSearches",null);return(0,Pl.Bo)(t.map((t=>e.getRoom(t))))}));return[e,()=>{O.A.setValue("SpotlightSearch.recentSearches",null,re.p.ACCOUNT,[]),t([])}]})(),[E,b]=(0,o.useState)(t),w=(0,o.useCallback)((e=>{var t,n,i;b(e),null===(t=l.current)||void 0===t||t.focus(),null===(n=d.current)||void 0===n||null===(i=n.scrollTo)||void 0===i||i.call(n,{top:0})}),[]),A=(0,o.useMemo)((()=>{const e=(0,VA.nf)(u),t=(0,VA._5)(u);return(0,VA.j2)(e,t)}),[u]),S=(0,Ne.ny)("feature_dynamic_room_predecessors"),k=(0,Po.Ne)(u.getUserId()),[R,I]=(0,o.useState)(!1),T=(0,o.useMemo)((()=>p.trim()),[p]),[P,N]=(0,o.useState)(!0);(0,o.useEffect)((()=>{u.isVersionSupported("v1.4").then((e=>e||u.doesServerSupportUnstableFeature("org.matrix.msc3827.stable"))).then((e=>{N(e)}))}),[u]);const{loading:D,publicRooms:M,protocols:L,config:U,setConfig:F,search:j,error:B}=jA(),{loading:V,users:H,search:z}=(()=>{const[e,t]=(0,o.useState)([]),[n,i]=(0,o.useState)(!1),[r,s]=NA(t);return{ready:!0,loading:n,users:e,search:(0,o.useCallback)((async({limit:e=20,query:n})=>{const o={limit:e,term:n};if(r(o),null==n||!n.length)return t([]),!0;try{i(!0);const{results:e}=await h.J.safeGet().searchUserDirectory(o);return s(o,e.map((e=>new Lg.qv(e)))),!0}catch(t){return console.error("Could not fetch user in user directory for params",{limit:e,term:n},t),s(o,[]),!1}finally{i(!1)}}),[r,s])}})(),{loading:W,profile:G,search:K}=(()=>{const[e,t]=(0,o.useState)(null),[n,i]=(0,o.useState)(!1),[r,s]=NA(t);return{ready:!0,loading:n,profile:e,search:(0,o.useCallback)((async({query:e})=>{if(r(e),null==e||!e.length||!e.startsWith("@")||!e.includes(":"))return t(null),!0;i(!0);try{const t=await h.J.safeGet().getProfileInfo(e);return s(e,{user_id:e,avatar_url:t.avatar_url,display_name:t.displayname}),!0}catch(t){return console.error("Could not fetch profile info for params",{term:e},t),s(e,null),!1}finally{i(!1)}}),[r,s])}})(),J=(0,o.useMemo)((()=>[{query:T,roomTypes:pS(E),limit:uS}]),[T,E]);PA(E===dS.d.PublicRooms||E===dS.d.PublicSpaces,j,J),PA(E===dS.d.People,z,J),PA(E===dS.d.People,K,J);const q=(0,o.useMemo)((()=>{const e=((e,t)=>e.getVisibleRooms(t).filter((e=>!(0,Jd.F)(e)&&(e.getMyMembership()===We.O.Join||e.getMyMembership()==We.O.Invite))))(u,S),t=e.map(bS),n=[],i=t.reduce(((e,t)=>{const n=Ti.A.shared().getUserIdForRoomId(t.room.roomId);return n?(t.room.getJoinedMemberCount()>2||e.set(n,t),e):e}),new Map);function r(e,t){for(const r of e){if(i.has(r.userId)){const e=i.get(r.userId);t&&yS(e)&&!e.alreadyFiltered&&(e.alreadyFiltered=!0);continue}const e=wS(r,t);i.set(r.userId,e),n.push(e)}}return r(((e,t,n=!0)=>Object.values(e.filter((e=>!n||!Ti.A.shared().getUserIdForRoomId(e.roomId))).reduce(((e,t)=>{for(const n of t.getJoinedMembers())e[n.userId]=n;return e}),{})).filter((e=>e.userId!==t.getUserId())))(e,u),!1),r(H,!0),G&&r([new Lg.qv(G)],!0),[...xe.Ay.instance.enabledMetaSpaces.map((e=>({section:gS.Spaces,filter:[],avatar:o.createElement("div",{className:ee()("mx_SpotlightDialog_metaspaceResult",`mx_SpotlightDialog_metaspaceResult_${e}`)}),name:(0,Ae.Ff)(e,xe.Ay.instance.allRoomsInHome),onClick(){xe.Ay.instance.setActiveSpace(e)}}))),...t,...n,...M.map(ES)].filter((e=>null===E||e.filter.includes(E)))}),[u,H,G,M,E,S]),$=(0,o.useMemo)((()=>{const e={[gS.People]:[],[gS.Rooms]:[],[gS.Spaces]:[],[gS.Suggestions]:[],[gS.PublicRoomsAndSpaces]:[]};if(T){const t=T.toLowerCase(),n=(0,a.S8)(T);q.forEach((i=>{if(_S(i)){const e=Ti.A.shared().getUserIdForRoomId(i.room.roomId);var r,o,s;if(!H.some((t=>t.userId===e)))if(!(null!==(r=i.room.normalizedName)&&void 0!==r&&r.includes(n)||null!==(o=i.room.getCanonicalAlias())&&void 0!==o&&o.toLowerCase().includes(t)||null!==(s=i.query)&&void 0!==s&&s.some((e=>e.includes(t)))))return}else if(yS(i)){var a;if(!(i.alreadyFiltered||null!==(a=i.query)&&void 0!==a&&a.some((e=>e.includes(t)))))return}else if(fS(i)){var l;if(null===(l=i.query)||void 0===l||!l.some((e=>e.includes(t))))return}else{var c;if(!(i.name.toLowerCase().includes(t)||null!==(c=i.query)&&void 0!==c&&c.some((e=>e.includes(t)))))return}e[i.section].push(i)}))}else E===dS.d.PublicRooms||E===dS.d.PublicSpaces?q.forEach((t=>{fS(t)&&e[t.section].push(t)})):E===dS.d.People&&q.forEach((t=>{yS(t)&&e[t.section].push(t)}));const t=u.getSafeUserId();for(const n of Object.values(e))n.sort(((e,n)=>_S(e)||_S(n)?_S(n)&&_S(e)?xS.getLastTs(n.room,t)-xS.getLastTs(e.room,t):-1:yS(e)||yS(n)?yS(n)&&yS(e)?A(e.member,n.member):-1:0));return e}),[T,E,u,q,H,A]);((e,t,n)=>{(0,o.useEffect)((()=>{if(!t)return;const i=window.setTimeout((()=>{Hf.Vo.instance.trackEvent({eventName:"WebSearch",viaSpotlight:n,numResults:e,queryLength:t})}),1e3);return()=>{clearTimeout(i)}}),[e,t,n])})((0,c.sum)(Object.values($).map((e=>e.length))),p.length,!0);const Y=xe.Ay.instance.activeSpaceRoom,[Z,X]=((e,t)=>{var n;const[i,r]=(0,o.useState)([]),[l,c]=(0,o.useState)(),d=(0,o.useCallback)((()=>{c(e?new hg(e,50):void 0)}),[e]);return(0,o.useEffect)(d,[d]),(0,o.useEffect)((()=>{if(!e||!l)return;let t=!1;return(async()=>{for(;null!=l&&l.canLoadMore&&!t&&e===l.root;)await l.load(),l.canLoadMore&&l.load(),r(l.rooms)})(),()=>{t=!0}}),[e,l]),[(0,o.useMemo)((()=>{const e=t.trim(),n=e.toLowerCase(),r=(0,a.S8)(e),o=h.J.safeGet();return null==i?void 0:i.filter((e=>{var t;return e.room_type!==s.RoomType.Space&&(null===(t=o.getRoom(e.room_id))||void 0===t?void 0:t.getMyMembership())!==We.O.Join&&((0,a.S8)(e.name||"").includes(r)||(e.canonical_alias||"").includes(n))}))}),[i,t]),null!==(n=null==l?void 0:l.loading)&&void 0!==n&&n]})(null!=Y?Y:void 0,p);(0,o.useEffect)((()=>{setTimeout((()=>{const e=m.state.refs[0];var t,n;e&&(m.dispatch({type:Ze.ZU.SetFocus,payload:{ref:e}}),null===(t=e.current)||void 0===t||null===(n=t.scrollIntoView)||void 0===n||n.call(t,{block:"nearest"}))}))}),[$,E]);const te=(e,t=!1,i=!1)=>{if(t){const t=new Set(O.A.getValue("SpotlightSearch.recentSearches",null).reverse());t.delete(e.roomId),t.add(e.roomId),O.A.setValue("SpotlightSearch.recentSearches",null,re.p.ACCOUNT,Array.from(t).reverse().slice(0,10))}v.Ay.dispatch({action:x.r.ViewRoom,metricsTrigger:"WebUnifiedSearch",metricsViaKeyboard:i,room_id:e.roomId,room_alias:e.roomAlias,auto_join:e.autoJoin&&!SS(e.joinRule),should_peek:e.shouldPeek,via_servers:e.viaServers}),SS(e.joinRule)&&v.Ay.dispatch({action:x.r.PromptAskToJoin}),n()};let ne,ie;if((T||E!==dS.d.PublicRooms&&E!==dS.d.PublicSpaces)&&(ne=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_otherSearches"},o.createElement("h4",{id:"mx_SpotlightDialog_section_otherSearches"},T?(0,C._t)("spotlight_dialog|heading_with_query",{query:p}):(0,C._t)("spotlight_dialog|heading_without_query")),o.createElement("div",null,E!==dS.d.PublicSpaces&&P&&o.createElement(tS,{id:"mx_SpotlightDialog_button_explorePublicSpaces",className:"mx_SpotlightDialog_explorePublicSpaces",onClick:()=>w(dS.d.PublicSpaces)},vS(dS.d.PublicSpaces)),E!==dS.d.PublicRooms&&o.createElement(tS,{id:"mx_SpotlightDialog_button_explorePublicRooms",className:"mx_SpotlightDialog_explorePublicRooms",onClick:()=>w(dS.d.PublicRooms)},vS(dS.d.PublicRooms)),E!==dS.d.People&&o.createElement(tS,{id:"mx_SpotlightDialog_button_startChat",className:"mx_SpotlightDialog_startChat",onClick:()=>w(dS.d.People)},vS(dS.d.People))))),T||null!==E){const e=e=>{var t;if(_S(e)){const t=st.n.instance.getRoomState(e.room),n=AS(e.room,t),r={"aria-label":n?`${e.room.name} ${n}`:e.room.name,"aria-describedby":`mx_SpotlightDialog_button_result_${e.room.roomId}_details`};return o.createElement(tS,(0,i.A)({id:`mx_SpotlightDialog_button_result_${e.room.roomId}`,key:`${gS[e.section]}-${e.room.roomId}`,onClick:t=>{te({roomId:e.room.roomId},!0,"click"!==(null==t?void 0:t.type))},endAdornment:o.createElement(sS,{room:e.room})},r),o.createElement(Jn.A,{room:e.room,size:mS,tooltipProps:{tabIndex:-1}}),e.room.name,o.createElement(qe.A,{notification:t}),o.createElement(aS.n,{id:`mx_SpotlightDialog_button_result_${e.room.roomId}_details`,className:"mx_SpotlightDialog_result_details",room:e.room}))}if(yS(e))return o.createElement(tS,{id:`mx_SpotlightDialog_button_result_${e.member.userId}`,key:`${gS[e.section]}-${e.member.userId}`,onClick:()=>{(0,Lg.UZ)(u,[e.member]),n()},"aria-label":e.member instanceof s.RoomMember?e.member.rawDisplayName:e.member.name,"aria-describedby":`mx_SpotlightDialog_button_result_${e.member.userId}_details`},o.createElement(HA.N,{user:e.member,size:mS}),e.member instanceof s.RoomMember?e.member.rawDisplayName:e.member.name,o.createElement("div",{id:`mx_SpotlightDialog_button_result_${e.member.userId}_details`,className:"mx_SpotlightDialog_result_details"},e.member.userId));if(fS(e)){const t=u.getRoom(e.publicRoom.room_id),n=e.publicRoom.join_rule,i=(null==t?void 0:t.getMyMembership())===We.O.Join||e.publicRoom.world_readable&&!SS(n)||u.isGuest(),r=t=>{var i;t.stopPropagation();const{publicRoom:r}=e;te({roomAlias:r.canonical_alias||(null===(i=r.aliases)||void 0===i?void 0:i[0]),roomId:r.room_id,autoJoin:!e.publicRoom.world_readable&&!u.isGuest(),shouldPeek:e.publicRoom.world_readable||u.isGuest(),viaServers:U?[U.roomServer]:void 0,joinRule:n},!0,"click"!==t.type)};let s;return s=i?(0,C._t)("action|view"):SS(n)?(0,C._t)("action|ask_to_join"):(0,C._t)("action|join"),o.createElement(tS,{id:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}`,className:"mx_SpotlightDialog_result_multiline",key:`${gS[e.section]}-${e.publicRoom.room_id}`,onClick:r,endAdornment:o.createElement(be.A,{kind:i?"primary_outline":"primary",onClick:r,tabIndex:-1},s),"aria-labelledby":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_name`,"aria-describedby":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_alias`,"aria-details":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_details`},o.createElement(Ge.A,{className:"mx_SearchResultAvatar",oobData:{roomId:e.publicRoom.room_id,name:e.publicRoom.name,avatarUrl:e.publicRoom.avatar_url,roomType:e.publicRoom.room_type},size:mS}),o.createElement(nS,{room:e.publicRoom,labelId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_name`,descriptionId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_alias`,detailsId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_details`}))}return o.createElement(tS,{id:`mx_SpotlightDialog_button_result_${e.name}`,key:`${gS[e.section]}-${e.name}`,onClick:null!==(t=e.onClick)&&void 0!==t?t:null},e.avatar,e.name,e.description)};let t,r,a,l,d,m,h,p,g,_;if($[gS.People].length&&(t=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_people"},o.createElement("h4",{id:"mx_SpotlightDialog_section_people"},(0,C._t)("invite|recents_section")),o.createElement("div",null,$[gS.People].slice(0,uS).map(e)))),$[gS.Suggestions].length&&E===dS.d.People&&(r=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_suggestions"},o.createElement("h4",{id:"mx_SpotlightDialog_section_suggestions"},(0,C._t)("common|suggestions")),o.createElement("div",null,$[gS.Suggestions].slice(0,uS).map(e)))),$[gS.Rooms].length&&(a=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_rooms"},o.createElement("h4",{id:"mx_SpotlightDialog_section_rooms"},(0,C._t)("common|rooms")),o.createElement("div",null,$[gS.Rooms].slice(0,uS).map(e)))),$[gS.Spaces].length&&(l=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_spaces"},o.createElement("h4",{id:"mx_SpotlightDialog_section_spaces"},(0,C._t)("spotlight_dialog|spaces_title")),o.createElement("div",null,$[gS.Spaces].slice(0,uS).map(e)))),E===dS.d.PublicRooms||E===dS.d.PublicSpaces){let t;t=B?o.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},E===dS.d.PublicRooms?(0,C._t)("spotlight_dialog|failed_querying_public_rooms"):(0,C._t)("spotlight_dialog|failed_querying_public_spaces")):$[gS.PublicRoomsAndSpaces].slice(0,uS).map(e),d=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_publicRooms"},o.createElement("div",{className:"mx_SpotlightDialog_sectionHeader"},o.createElement("h4",{id:"mx_SpotlightDialog_section_publicRooms"},(0,C._t)("common|suggestions")),o.createElement("div",{className:"mx_SpotlightDialog_options"},o.createElement(XA,{protocols:L,config:null!=U?U:null,setConfig:F}))),o.createElement("div",null,t))}Z.length&&Y&&null===E&&(m=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_spaceRooms"},o.createElement("h4",{id:"mx_SpotlightDialog_section_spaceRooms"},(0,C._t)("spotlight_dialog|other_rooms_in_space",{spaceName:Y.name})),o.createElement("div",null,Z.slice(0,uS).map((e=>o.createElement(tS,{id:`mx_SpotlightDialog_button_result_${e.room_id}`,key:e.room_id,onClick:t=>{te({roomId:e.room_id},!0,"click"!==(null==t?void 0:t.type))}},o.createElement(xn.A,{name:e.name,idName:e.room_id,url:e.avatar_url?(0,Ds.lH)(e.avatar_url).getSquareThumbnailHttp(parseInt(mS,10)):null,size:mS}),e.name||e.canonical_alias,e.name&&e.canonical_alias&&o.createElement("div",{className:"mx_SpotlightDialog_result_details"},e.canonical_alias)))),X&&o.createElement(dn.A,null)))),!T.startsWith("#")||!T.includes(":")||(0,Q.M)(T)&&u.getRoom((0,Q.M)(T))||(h=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group"},o.createElement("div",null,o.createElement(tS,{id:"mx_SpotlightDialog_button_joinRoomAlias",className:"mx_SpotlightDialog_joinRoomAlias",onClick:e=>{v.Ay.dispatch({action:x.r.ViewRoom,room_alias:T,auto_join:!0,metricsTrigger:"WebUnifiedSearch",metricsViaKeyboard:"click"!==(null==e?void 0:e.type)}),n()}},(0,C._t)("spotlight_dialog|join_button_text",{roomAddress:T}))))),E===dS.d.People?p=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_hiddenResults",role:"group"},o.createElement("h4",null,(0,C._t)("spotlight_dialog|result_may_be_hidden_privacy_warning")),o.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},(0,C._t)("spotlight_dialog|cant_find_person_helpful_hint")),o.createElement(cS,{id:"mx_SpotlightDialog_button_inviteLink",className:"mx_SpotlightDialog_inviteLink",onClick:()=>{I(!0),(0,iu.nC)(k)},onTooltipOpenChange:e=>{e||I(!1)},title:R?(0,C._t)("common|copied"):(0,C._t)("action|copy")},o.createElement("span",{className:"mx_AccessibleButton mx_AccessibleButton_hasKind mx_AccessibleButton_kind_primary_outline"},(0,C._t)("spotlight_dialog|copy_link_text")))):!T||E!==dS.d.PublicRooms&&E!==dS.d.PublicSpaces||(p=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_hiddenResults",role:"group"},o.createElement("h4",null,(0,C._t)("spotlight_dialog|result_may_be_hidden_warning")),o.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},(0,C._t)("spotlight_dialog|cant_find_room_helpful_hint")),o.createElement(tS,{id:"mx_SpotlightDialog_button_createNewRoom",className:"mx_SpotlightDialog_createRoom",onClick:()=>v.Ay.dispatch({action:"view_create_room",public:!0,defaultName:(0,c.capitalize)(T)})},o.createElement("span",{className:"mx_AccessibleButton mx_AccessibleButton_hasKind mx_AccessibleButton_kind_primary_outline"},(0,C._t)("spotlight_dialog|create_new_room_button"))))),E===dS.d.People&&(g=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_groupChat"},o.createElement("h4",{id:"mx_SpotlightDialog_section_groupChat"},(0,C._t)("spotlight_dialog|group_chat_section_title")),o.createElement(tS,{id:"mx_SpotlightDialog_button_startGroupChat",className:"mx_SpotlightDialog_startGroupChat",onClick:()=>(0,y.xZ)(T)},(0,C._t)("spotlight_dialog|start_group_chat_button")))),null===E&&(_=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_messageSearch"},o.createElement("h4",{id:"mx_SpotlightDialog_section_messageSearch"},(0,C._t)("spotlight_dialog|message_search_section_title")),o.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},(0,C._t)("spotlight_dialog|search_messages_hint",{},{icon:()=>o.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchIcon"})})))),ie=o.createElement(o.Fragment,null,t,r,a,l,m,d,h,p,ne,g,_)}else{let e;_.length&&(e=o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_recentSearches",role:"group",tabIndex:-1,"aria-labelledby":"mx_SpotlightDialog_section_recentSearches"},o.createElement("h4",null,o.createElement("span",{id:"mx_SpotlightDialog_section_recentSearches"},(0,C._t)("spotlight_dialog|recent_searches_section_title")),o.createElement(be.A,{kind:"link",onClick:f},(0,C._t)("action|clear"))),o.createElement("div",null,_.map((e=>{const t=st.n.instance.getRoomState(e),n=AS(0,t),r={"aria-label":n?`${e.name} ${n}`:e.name,"aria-describedby":`mx_SpotlightDialog_button_recentSearch_${e.roomId}_details`};return o.createElement(tS,(0,i.A)({id:`mx_SpotlightDialog_button_recentSearch_${e.roomId}`,key:e.roomId,onClick:t=>{te({roomId:e.roomId},!0,"click"!==(null==t?void 0:t.type))},endAdornment:o.createElement(sS,{room:e})},r),o.createElement(Jn.A,{room:e,size:mS,tooltipProps:{tabIndex:-1}}),e.name,o.createElement(qe.A,{notification:t}),o.createElement(aS.n,{id:`mx_SpotlightDialog_button_recentSearch_${e.roomId}_details`,className:"mx_SpotlightDialog_result_details",room:e}))}))))),ie=o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_recentlyViewed",role:"group","aria-labelledby":"mx_SpotlightDialog_section_recentlyViewed"},o.createElement("h4",{id:"mx_SpotlightDialog_section_recentlyViewed"},(0,C._t)("spotlight_dialog|recently_viewed_section_title")),o.createElement("div",null,xi.Y.instance.rooms.filter((e=>e.roomId!==Xt.M.instance.roomViewStore.getRoomId())).map((e=>o.createElement(cS,{id:`mx_SpotlightDialog_button_recentlyViewed_${e.roomId}`,title:e.name,key:e.roomId,onClick:t=>{te({roomId:e.roomId},!1,"click"!==t.type)}},o.createElement(Jn.A,{room:e,size:"32px",tooltipProps:{tabIndex:-1}}),e.name))))),e,ne)}const oe=null===(r=m.state.activeRef)||void 0===r||null===(r=r.current)||void 0===r?void 0:r.id;return o.createElement(o.Fragment,null,o.createElement("div",{id:"mx_SpotlightDialog_keyboardPrompt"},(0,C._t)("spotlight_dialog|keyboard_scroll_hint",{},{arrows:()=>o.createElement(o.Fragment,null,o.createElement("kbd",null,"↓"),o.createElement("kbd",null,"↑"),null!==!E&&!p&&o.createElement("kbd",null,"←"),null!==!E&&!p&&o.createElement("kbd",null,"→"))})),o.createElement(cn.A,{className:"mx_SpotlightDialog",onFinished:n,hasCancel:!1,onKeyDown:e=>{if((0,Se.zM)().getNavigationAction(e)===Ee.bY.FilterRooms)e.stopPropagation(),e.preventDefault(),n();let t;const i=(0,Se.zM)().getAccessibilityAction(e);switch(i){case Ee.bY.Escape:e.stopPropagation(),e.preventDefault(),n();break;case Ee.bY.ArrowUp:case Ee.bY.ArrowDown:if(e.stopPropagation(),e.preventDefault(),m.state.activeRef&&m.state.refs.length>0){let e=m.state.refs;if(!p&&null!==!E){const t=hS(m.state.activeRef)?m.state.activeRef:e.find(hS);e=e.filter((e=>e===t||!hS(e)))}const n=e.indexOf(m.state.activeRef);t=(0,Ze.Ed)(e,n+(i===Ee.bY.ArrowUp?-1:1))}break;case Ee.bY.ArrowLeft:case Ee.bY.ArrowRight:if(!p&&null!==!E&&m.state.activeRef&&m.state.refs.length>0&&hS(m.state.activeRef)){e.stopPropagation(),e.preventDefault();const n=m.state.refs.filter(hS),r=n.indexOf(m.state.activeRef);t=(0,Ze.Ed)(n,r+(i===Ee.bY.ArrowLeft?-1:1))}}var r;t&&(m.dispatch({type:Ze.ZU.SetFocus,payload:{ref:t}}),null===(r=t.current)||void 0===r||r.scrollIntoView({block:"nearest"}))},screenName:"UnifiedSearch","aria-label":(0,C._t)("spotlight_dialog|search_dialog")},o.createElement("div",{className:"mx_SpotlightDialog_searchBox mx_textinput"},null!==E&&o.createElement("div",{className:ee()("mx_SpotlightDialog_filter",{mx_SpotlightDialog_filterPeople:E===dS.d.People,mx_SpotlightDialog_filterPublicRooms:E===dS.d.PublicRooms,mx_SpotlightDialog_filterPublicSpaces:E===dS.d.PublicSpaces})},o.createElement("span",null,vS(E)),o.createElement(be.A,{tabIndex:-1,alt:(0,C._t)("spotlight_dialog|remove_filter",{filter:vS(E)}),className:"mx_SpotlightDialog_filter--close",onClick:()=>w(null)})),o.createElement("input",{ref:l,autoFocus:!0,type:"text",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:"false",placeholder:(0,C._t)("action|search"),value:p,onChange:e=>{const t=function(e){var t;const n=(0,Po.$N)(e);return null!==(t=null==n?void 0:n.primaryEntityId)&&void 0!==t?t:e}(e.currentTarget.value);g(t)},onKeyDown:e=>{var t;switch((0,Se.zM)().getAccessibilityAction(e)){case Ee.bY.Backspace:p||null===E||(e.stopPropagation(),e.preventDefault(),w(null));break;case Ee.bY.Enter:e.stopPropagation(),e.preventDefault(),null===(t=m.state.activeRef)||void 0===t||null===(t=t.current)||void 0===t||t.click()}},"aria-owns":"mx_SpotlightDialog_content","aria-activedescendant":oe,"aria-label":(0,C._t)("action|search"),"aria-describedby":"mx_SpotlightDialog_keyboardPrompt"}),(D||V||W)&&o.createElement(dn.A,{w:24,h:24})),o.createElement("div",{ref:d,id:"mx_SpotlightDialog_content",role:"listbox","aria-activedescendant":oe,"aria-describedby":"mx_SpotlightDialog_keyboardPrompt"},ie)))},kS=e=>o.createElement(Ze.Se,null,(()=>o.createElement(CS,e)));var RS=n("./node_modules/matrix-react-sdk/src/utils/dm/findDMForUser.ts"),IS=n("./node_modules/matrix-react-sdk/src/utils/crypto/shouldForceDisableEncryption.ts");const TS="react_sdk_session_lock_ping",PS="react_sdk_session_lock_owner",NS="react_sdk_session_lock_claimant",DS=3e4;async function MS(e){const t=(0,N.A)(),n=l.v.withPrefix(`getSessionLock[${t}]`);let i=null;function r(){const e=window.localStorage.getItem(NS);if(e!==t)return n.warn(`Lock was claimed by ${e} while we were waiting for it: aborting startup`),-1;const i=window.localStorage.getItem(TS),r=window.localStorage.getItem(PS);if(null===i)return n.info("No other session has the lock: proceeding with startup"),0;const o=Date.now()-parseInt(i),s=DS-o;return s<=0?(n.info(`Last ping (from ${r}) was ${o}ms ago: proceeding with startup`),0):(n.info(`Last ping (from ${r}) was ${o}ms ago, waiting`),s)}function o(){window.localStorage.setItem(PS,t),window.localStorage.setItem(TS,Date.now().toString())}function s(){null!==i&&(n.debug("page hide: clearing our claim"),window.clearInterval(i),window.localStorage.removeItem(TS),window.localStorage.removeItem(PS),i=null)}for(window.localStorage.setItem(NS,t);;){const t=r();if(0==t)break;if(t<0)return await e(),!1;let n;const i=new Promise((e=>{n=t=>{t.key!==TS&&t.key!==NS||e(t)}})),o=new Promise((e=>{setTimeout(e,t,void 0)}));window.addEventListener("storage",n),await Promise.race([o,i]),window.removeEventListener("storage",n)}return o(),i=window.setInterval(o,5e3),window.addEventListener("storage",(function r(o){if(o.key===NS){const o=window.localStorage.getItem(NS);if(o===t)return;n.info(`Session ${o} is waiting for the lock`),window.removeEventListener("storage",r),async function(){await e(),null!==i&&window.clearInterval(i);window.localStorage.removeItem(TS),window.localStorage.removeItem(PS),i=null}().catch((e=>{n.error("Error releasing session lock",e)}))}})),window.addEventListener("pagehide",s),window.addEventListener("unload",s),!0}function OS(){const e=g.Ay.get().brand;return o.createElement(RA,{className:"mx_SessionLockStolenView"},o.createElement("h1",null,(0,C._t)("error_app_open_in_another_tab_title",{brand:e})),o.createElement("h2",null,(0,C._t)("error_app_open_in_another_tab",{brand:e})))}function LS(e){const t=g.Ay.get().brand;return o.createElement("div",{className:"mx_ConfirmSessionLockTheftView"},o.createElement("div",{className:"mx_ConfirmSessionLockTheftView_body"},o.createElement("p",null,(0,C._t)("error_app_opened_in_another_window",{brand:t,label:(0,C._t)("action|continue")})),o.createElement(be.A,{kind:"primary",onClick:e.onConfirm},(0,C._t)("action|continue"))))}function US(e){const t=(0,Pe.DY)(e.matrixClient,s.CryptoEvent.LegacyCryptoStoreMigrationProgress,((e,t)=>({progress:null!=e?e:-1,totalSteps:null!=t?t:-1})));let n,i;return e.syncError&&(n=o.createElement("div",{className:"mx_LoginSplashView_syncError"},(0,pe.cQ)(e.syncError))),i=-1!==t.totalSteps?o.createElement("div",{className:"mx_LoginSplashView_migrationProgress"},o.createElement("p",null,(0,C._t)("migrating_crypto",{brand:g.Ay.get().brand})),o.createElement(mo.A,{value:t.progress,max:t.totalSteps})):o.createElement(dn.A,null),o.createElement("div",{className:"mx_MatrixChat_splash"},n,i,o.createElement("div",{className:"mx_LoginSplashView_splashButtons"},o.createElement(be.A,{kind:"link_inline",onClick:e.onLogoutClick},(0,C._t)("action|logout"))))}const FS="mx_draft_cleanup",jS=2592e6;function BS(){if(function(){try{const e=localStorage.getItem(FS);if(!e)return!0;const t=Number.parseInt(e||"",10);return!Number.isInteger(t)||Date.now()>t+jS}catch(e){return!0}}()){l.v.debug("Cleaning up editor drafts..."),function(){for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);if(!t)continue;let n;if(t.startsWith(Hd.hE)&&(n=t.slice(Hd.hE.length).split("_$")[0]),t.startsWith($d)&&(n=t.slice($d.length).split("_$")[0]),!n)continue;h.J.safeGet().getRoom(n)||(l.v.debug(`Removing draft for unknown room with key ${t}`),localStorage.removeItem(t))}}();try{localStorage.setItem(FS,String(Date.now()))}catch(e){l.v.error("Failed to persist draft cleanup key",e)}}}function VS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function HS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VS(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const zS=["register","login","forgot_password","start_sso","start_cas","welcome"],WS=[x.r.ViewUserSettings,"view_create_chat","view_create_room"];class GS extends o.PureComponent{constructor(e){if(super(e),(0,r.A)(this,"firstSyncComplete",!1),(0,r.A)(this,"firstSyncPromise",void 0),(0,r.A)(this,"screenAfterLogin",void 0),(0,r.A)(this,"tokenLogin",void 0),(0,r.A)(this,"focusNext",void 0),(0,r.A)(this,"subTitleStatus",void 0),(0,r.A)(this,"prevWindowWidth",void 0),(0,r.A)(this,"voiceBroadcastResumer",void 0),(0,r.A)(this,"loggedInView",void 0),(0,r.A)(this,"dispatcherRef",void 0),(0,r.A)(this,"themeWatcher",void 0),(0,r.A)(this,"fontWatcher",void 0),(0,r.A)(this,"stores",void 0),(0,r.A)(this,"startInitSession",(()=>{this.initSession().catch((e=>{l.v.error("Error initialising Matrix session",e)}))})),(0,r.A)(this,"onWindowResized",(()=>{this.warnInConsole()})),(0,r.A)(this,"warnInConsole",(0,c.throttle)((()=>{const e="15px",t=(0,C._t)("console_wait"),i=(0,C._t)("console_scam_warning"),r=(0,C._t)("console_dev_note");n.g.mx_rage_logger.bypassRageshake("log",`%c${t}\n%c${i}\n%c${r}`,"font-size:50px; color:blue;",`font-size:${e}; color:red;`,`font-size:${e};`)}),1e3)),(0,r.A)(this,"onAction",(e=>{var t;if(this.state.view!==CA.A.LOCK_STOLEN){if(null!==(t=h.J.get())&&void 0!==t&&t.isGuest()&&WS.includes(e.action))return v.Ay.dispatch({action:x.r.DoAfterSyncPrepared,deferred_action:e}),void v.Ay.dispatch({action:"require_registration"});switch(e.action){case"MatrixActions.accountData":if("m.identity_server"===e.event_type){const t=e.event_content?e.event_content.base_url:null;t?(h.J.safeGet().setIdentityServerUrl(t),localStorage.removeItem("mx_is_access_token"),localStorage.setItem("mx_is_url",t)):(h.J.safeGet().setIdentityServerUrl(void 0),localStorage.removeItem("mx_is_access_token"),localStorage.removeItem("mx_is_url")),v.Ay.dispatch({action:"id_server_changed"})}break;case"logout":fe.Ay.instance.hangupAllCalls(),Promise.all([...[...Mp.e.instance.connectedCalls].map((e=>e.disconnect())),(0,Pn.yn)(this.stores)]).finally((()=>b.ri(this.stores.oidcClientStore)));break;case"require_registration":!async function(e={}){const t=f.Ay.createDialog(z.A,{hasCancelButton:!0,quitOnly:!0,title:O.A.getValue(W.f.Registration)?(0,C._t)("auth|sign_in_or_register"):(0,C._t)("action|sign_in"),description:O.A.getValue(W.f.Registration)?(0,C._t)("auth|sign_in_or_register_description"):(0,C._t)("auth|sign_in_description"),button:(0,C._t)("action|sign_in"),extraButtons:O.A.getValue(W.f.Registration)?[o.createElement("button",{key:"register",onClick:()=>{t.close(),v.Ay.dispatch({action:"start_registration",screenAfterLogin:e.screen_after})}},(0,C._t)("auth|register_action"))]:[],onFinished:t=>{t?v.Ay.dispatch({action:"start_login",screenAfterLogin:e.screen_after}):e.go_home_on_cancel?v.Ay.dispatch({action:x.r.ViewHomePage}):e.go_welcome_on_cancel&&v.Ay.dispatch({action:"view_welcome_page"})}})}(e);break;case"start_registration":if(b.b()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.startRegistration(e.params||{});break;case"start_login":if(b.b()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.viewLogin();break;case"start_password_recovery":this.setStateForNewView({view:CA.A.FORGOT_PASSWORD}),this.notifyNewScreen("forgot_password");break;case"start_chat":(0,V.Ay)(h.J.safeGet(),{dmUserId:e.user_id});break;case"leave_room":this.leaveRoom(e.room_id);break;case"forget_room":this.forgetRoom(e.room_id);break;case"copy_room":this.copyRoom(e.room_id);break;case"reject_invite":f.Ay.createDialog(z.A,{title:(0,C._t)("reject_invitation_dialog|title"),description:(0,C._t)("reject_invitation_dialog|confirmation"),onFinished:t=>{if(t){const t=f.Ay.createDialog(dn.A,void 0,"mx_Dialog_spinner");h.J.safeGet().leave(e.room_id).then((()=>{t.close(),this.state.currentRoomId===e.room_id&&v.Ay.dispatch({action:x.r.ViewHomePage})}),(e=>{t.close(),f.Ay.createDialog(lc.A,{title:(0,C._t)("reject_invitation_dialog|failed"),description:e.toString()})}))}}});break;case"view_user_info":this.viewUser(e.userId,e.subAction);break;case"MatrixActions.RoomState.events":{const t=e.event;t.getType()===s.EventType.RoomCanonicalAlias&&t.getRoomId()===this.state.currentRoomId&&this.viewRoom({action:x.r.ViewRoom,room_id:this.state.currentRoomId,metricsTrigger:void 0});break}case x.r.ViewRoom:{const t=this.viewRoom(e);e.deferred_action&&t.then((()=>{v.Ay.dispatch(e.deferred_action)}));break}case x.r.ViewUserDeviceSettings:v.Ay.dispatch({action:x.r.ViewUserSettings,initialTabId:Ot.v.SessionManager});break;case x.r.ViewUserSettings:{const t=e;f.Ay.createDialog(ex,HS(HS({},e.props),{},{initialTabId:t.initialTabId,sdkContext:this.stores}),void 0,!1,!0),this.viewSomethingBehindModal();break}case"view_create_room":this.createRoom(e.public,e.defaultName,e.type),this.viewSomethingBehindModal();break;case x.r.ViewRoomDirectory:f.Ay.createDialog(kS,{initialText:e.initialText,initialFilter:dS.d.PublicRooms},"mx_SpotlightDialog_wrapper",!1,!0),this.viewSomethingBehindModal();break;case"view_welcome_page":this.viewWelcome();break;case x.r.ViewHomePage:this.viewHome(e.justRegistered);break;case x.r.ViewStartChatOrReuse:this.chatCreateOrReuse(e.user_id);break;case"view_create_chat":(0,y.xZ)(e.initialText||""),this.viewSomethingBehindModal();break;case"view_invite":{const t=h.J.safeGet().getRoom(e.roomId);null!=t&&t.isSpaceRoom()?(0,De.Lo)(t):(0,y._7)(e.roomId);break}case"view_last_screen":this.showScreenAfterLogin();break;case"hide_left_panel":this.setState({collapseLhs:!0},(()=>{this.state.resizeNotifier.notifyLeftHandleResized()}));break;case"show_left_panel":this.setState({collapseLhs:!1},(()=>{this.state.resizeNotifier.notifyLeftHandleResized()}));break;case x.r.OpenDialPad:f.Ay.createDialog(L_,{},"mx_Dialog_dialPadWrapper");break;case x.r.OnLoggedIn:this.stores.client=h.J.safeGet(),this.tokenLogin||b.b()||this.state.view===CA.A.LOGIN||this.state.view===CA.A.REGISTER||this.state.view===CA.A.COMPLETE_SECURITY||this.state.view===CA.A.E2E_SETUP||this.state.view===CA.A.USE_CASE_SELECTION||this.onLoggedIn();break;case"on_client_not_viable":this.onSoftLogout();break;case x.r.OnLoggedOut:this.onLoggedOut();break;case"will_start_client":this.setState({ready:!1},(()=>{this.onWillStartClient()}));break;case"client_started":this.onClientStarted();break;case"send_event":this.onSendEvent(e.room_id,e.event);break;case"aria_hide_main_app":this.setState({hideToSRUsers:!0});break;case"aria_unhide_main_app":this.setState({hideToSRUsers:!1});break;case x.r.PseudonymousAnalyticsAccept:D_(),O.A.setValue("pseudonymousAnalyticsOptIn",null,re.p.ACCOUNT,!0);break;case x.r.PseudonymousAnalyticsReject:D_(),O.A.setValue("pseudonymousAnalyticsOptIn",null,re.p.ACCOUNT,!1);break;case x.r.ShowThread:{const{rootEvent:t,initialEvent:n,highlighted:i,scrollIntoView:r,push:o}=e,s={phase:$n.n.ThreadView,state:{threadHeadEvent:t,initialEvent:n,isInitialEventHighlighted:i,initialEventScrollIntoView:r}};null!=o&&o?qn.A.instance.pushCard(s):qn.A.instance.setCards([{phase:$n.n.ThreadPanel},s]),v.Ay.dispatch({action:x.r.FocusSendMessageComposer,context:Zr.Ae.Thread});break}case x.r.OpenSpotlight:f.Ay.createDialog(kS,{initialText:e.initialText,initialFilter:e.initialFilter},"mx_SpotlightDialog_wrapper",!1,!0)}}})),(0,r.A)(this,"handleResize",(()=>{const e=1e3,t=Ce.A.instance.windowWidth;this.prevWindowWidth<e&&t>=e&&v.Ay.dispatch({action:"show_left_panel"}),this.prevWindowWidth>=e&&t<e&&v.Ay.dispatch({action:"hide_left_panel"}),this.prevWindowWidth=t,this.state.resizeNotifier.notifyWindowResized()})),(0,r.A)(this,"onRegisterClick",(()=>{this.showScreen("register")})),(0,r.A)(this,"onLoginClick",(()=>{this.showScreen("login")})),(0,r.A)(this,"onForgotPasswordClick",(()=>{this.showScreen("forgot_password")})),(0,r.A)(this,"onRegisterFlowComplete",((e,t)=>this.onUserCompletedLoginFlow(e,t))),(0,r.A)(this,"onUpdateStatusIndicator",((e,t)=>{const n=e.numUnreadStates;p.A.get()&&(p.A.get().setErrorStatus(t===s.SyncState.Error),p.A.get().setNotificationCount(n)),this.subTitleStatus="",t===s.SyncState.Error&&(this.subTitleStatus+=`[${(0,C._t)("common|offline")}] `),n>0?this.subTitleStatus+=`[${n}]`:e.level>=Qe.S.Activity&&(this.subTitleStatus+="*"),this.setPageSubtitle()})),(0,r.A)(this,"onServerConfigChange",(e=>{this.setState({serverConfig:e})})),(0,r.A)(this,"onUserCompletedLoginFlow",(async(e,t)=>{this.stores.accountPasswordStore.setPassword(t),await b.QC(e),await this.postLoginSetup(),EA.instance.stop(yA.LOGIN),EA.instance.stop(yA.REGISTER)})),(0,r.A)(this,"onCompleteSecurityE2eSetupFinished",(()=>{this.onLoggedIn()})),this.stores=Xt.M.instance,this.stores.constructEagerStores(),this.state={view:CA.A.LOADING,collapseLhs:!1,currentRoomId:null,currentUserId:null,hideToSRUsers:!1,syncError:null,resizeNotifier:new J,ready:!1},this.loggedInView=(0,o.createRef)(),g.Ay.put(this.props.config),this.firstSyncComplete=!1,this.firstSyncPromise=(0,a.v6)(),this.props.config.sync_timeline_limit&&(h.J.opts.initialSyncLimit=this.props.config.sync_timeline_limit),this.screenAfterLogin=this.props.initialScreenAfterLogin,this.screenAfterLogin){const e=this.screenAfterLogin.params||{};if(this.screenAfterLogin.screen.startsWith("room/")&&e.signurl&&e.email){const t=this.screenAfterLogin.screen.substring(5);M_.A.instance.storeInvite(t,e)}}this.prevWindowWidth=Ce.A.instance.windowWidth||1e3,Ce.A.instance.on(Ce.x.Resize,this.handleResize),this.state.resizeNotifier.on("middlePanelResized",this.dispatchTimelineResize),st.n.instance.on(st.N,this.onUpdateStatusIndicator),this.dispatcherRef=v.Ay.register(this.onAction),this.themeWatcher=new $.A,this.fontWatcher=new Y.g,this.themeWatcher.start(),this.fontWatcher.start(),this.subTitleStatus="",(0,SA.ig)(g.Ay.get("sentry")),!function(){const e=window.localStorage.getItem(TS);return null===e||Date.now()-parseInt(e)>DS}()?setTimeout((()=>this.setState({view:CA.A.CONFIRM_LOCK_THEFT})),0):this.startInitSession()}async initSession(){var e,t,n;if(!await MS((()=>this.onSessionLockStolen())))return;if(b.b())return void b.L6();const i=await b.AK(this.props.realQueryParams,this.props.defaultDeviceDisplayName,this.getFragmentAfterLogin());if((null!==(e=this.props.realQueryParams)&&void 0!==e&&e.loginToken||null!==(t=this.props.realQueryParams)&&void 0!==t&&t.code||null!==(n=this.props.realQueryParams)&&void 0!==n&&n.state)&&this.props.onTokenLoginCompleted(),i)return this.tokenLogin=!0,await b.Vi({ignoreGuest:!0}),void await this.postLoginSetup();const r=this.screenAfterLogin?this.screenAfterLogin.screen:null;await this.loadSession()||null!==r&&zS.includes(r)&&this.showScreenAfterLogin()}async onSessionLockStolen(){await new Promise((e=>{this.setState({view:CA.A.LOCK_STOLEN},e)})),await b.MV()}async postLoginSetup(){const e=h.J.safeGet(),t=e.isCryptoEnabled();t||this.onLoggedIn();const n=[this.firstSyncPromise.promise];let i=!1;if(t&&n.push((async()=>{i=await e.userHasCrossSigningKeys()})()),this.setState({pendingInitialSync:!0}),await Promise.all(n),t){if(i){0==Gl.r.instance.extensions.cryptoSetup.SHOW_ENCRYPTION_SETUP_UI?this.onLoggedIn():this.setStateForNewView({view:CA.A.COMPLETE_SECURITY})}else await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing")&&(r=e,!(0,IS.I)(r)||r.getRooms().some((e=>r.isRoomEncrypted(e.roomId))))?this.setStateForNewView({view:CA.A.E2E_SETUP}):this.onLoggedIn();var r;this.setState({pendingInitialSync:!1})}else this.setState({pendingInitialSync:!1})}setState(e,t){this.shouldTrackPageChange(this.state,HS(HS({},this.state),e))&&this.startPageChangeTimer(),super.setState(e,t)}componentDidMount(){window.addEventListener("resize",this.onWindowResized)}componentDidUpdate(e,t){if(this.shouldTrackPageChange(t,this.state)){const e=this.stopPageChangeTimer();null!=e&&u.A.instance.trackPageChange(this.state.view,this.state.page_type,e)}"composer"===this.focusNext?(v.Ay.fire(x.r.FocusSendMessageComposer),this.focusNext=void 0):"threadsPanel"===this.focusNext&&v.Ay.fire(x.r.FocusThreadsPanel)}componentWillUnmount(){var e;b.NN(),v.Ay.unregister(this.dispatcherRef),this.themeWatcher.stop(),this.fontWatcher.stop(),Ce.A.destroy(),this.state.resizeNotifier.removeListener("middlePanelResized",this.dispatchTimelineResize),window.removeEventListener("resize",this.onWindowResized),this.stores.accountPasswordStore.clearPassword(),null===(e=this.voiceBroadcastResumer)||void 0===e||e.destroy()}getFallbackHsUrl(){var e;if(null!==(e=this.getServerProperties().serverConfig)&&void 0!==e&&e.isDefault)return this.props.config.fallback_hs_url}getServerProperties(){return{serverConfig:this.state.serverConfig||g.Ay.get("validated_server_config")}}loadSession(){return Promise.resolve().then((()=>b.L6({fragmentQueryParams:this.props.startingFragmentQueryParams,enableGuest:this.props.enableGuest,guestHsUrl:this.getServerProperties().serverConfig.hsUrl,guestIsUrl:this.getServerProperties().serverConfig.isUrl,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName}))).then((e=>(e||(M_.A.instance.pickBestInvite()&&O.A.getValue(W.f.Registration)?v.Ay.dispatch({action:"start_registration"}):v.Ay.dispatch({action:"view_welcome_page"})),e)))}startPageChangeTimer(){EA.instance.start(yA.PAGE_CHANGE)}stopPageChangeTimer(){const e=EA.instance;e.stop(yA.PAGE_CHANGE);const t=e.getEntries({name:yA.PAGE_CHANGE}).pop();return t?t.duration:null}shouldTrackPageChange(e,t){return e.currentRoomId!==t.currentRoomId||e.view!==t.view||e.page_type!==t.page_type}setStateForNewView(e){if(void 0===e.view)throw new Error("setStateForNewView with no view!");this.setState(HS({currentUserId:void 0,justRegistered:!1},e))}setPage(e){this.setState({page_type:e})}async startRegistration(e){if(!O.A.getValue(W.f.Registration))return void this.showScreen("welcome");const t={view:CA.A.REGISTER};if(e.client_secret&&e.session_id&&e.hs_url&&e.is_url&&e.sid){t.serverConfig=await q.A.validateServerConfigWithStaticUrls(e.hs_url,e.is_url);const n=g.Ay.get("validated_server_config");n&&n.hsUrl===t.serverConfig.hsUrl&&(t.serverConfig.hsName=n.hsName,t.serverConfig.hsNameIsDifferent=n.hsNameIsDifferent,t.serverConfig.isDefault=n.isDefault,t.serverConfig.isNameResolvable=n.isNameResolvable),t.register_client_secret=e.client_secret,t.register_session_id=e.session_id,t.register_id_sid=e.sid}this.setStateForNewView(t),H.A.isLogin=!0,this.themeWatcher.recheck(),this.notifyNewScreen("register")}async viewRoom(e){var t,n;if(this.focusNext=null!==(t=e.focusNext)&&void 0!==t?t:"composer",e.room_alias?l.v.log(`Switching to room alias ${e.room_alias} at event ${e.event_id}`):l.v.log(`Switching to room id ${e.room_id} at event ${e.event_id}`),!this.firstSyncComplete){if(!this.firstSyncPromise)return void l.v.warn("Cannot view a room before first sync. room_id:",e.room_id);await this.firstSyncPromise.promise}let i=e.room_alias||e.room_id;const r=h.J.safeGet().getRoom(e.room_id);if(r){var o;r.decryptAllEvents();const e=E.zQ(r);e&&(i=e,(0,Q.i)(e,r.roomId)),null===(o=localStorage)||void 0===o||o.setItem("mx_last_room_id",r.roomId)}let s="#"===i[0]&&e.room_id===this.state.currentRoomId;var a,c,d,u;((0,Jd.F)(this.state.currentRoomId)&&(s=!0),e.room_id===this.state.currentRoomId)&&(e.threepid_invite=null!==(a=e.threepid_invite)&&void 0!==a?a:this.state.threepidInvite,e.oob_data=null!==(c=e.oob_data)&&void 0!==c?c:this.state.roomOobData,e.forceTimeline=null!==(d=e.forceTimeline)&&void 0!==d?d:this.state.forceTimeline,e.justCreatedOpts=null!==(u=e.justCreatedOpts)&&void 0!==u?u:this.state.roomJustCreatedOpts);e.event_id&&e.highlighted&&(i+="/"+e.event_id),this.setState({view:CA.A.LOGGED_IN,currentRoomId:null!==(n=e.room_id)&&void 0!==n?n:null,page_type:B.A.RoomView,threepidInvite:e.threepid_invite,roomOobData:e.oob_data,forceTimeline:e.forceTimeline,ready:!0,roomJustCreatedOpts:e.justCreatedOpts},(()=>{H.A.isLogin=!1,this.themeWatcher.recheck(),this.notifyNewScreen("room/"+i,s)}))}viewSomethingBehindModal(){this.state.view===CA.A.LOGGED_IN?this.state.currentRoomId||this.state.currentUserId||this.viewHome():this.viewWelcome()}viewWelcome(){if(function(e){const t=new vn.Q(e).get("embedded_pages");return!!t&&!0===new vn.Q(t).get("login_for_welcome")}(g.Ay.get()))return this.viewLogin();this.setStateForNewView({view:CA.A.WELCOME}),this.notifyNewScreen("welcome"),H.A.isLogin=!0,this.themeWatcher.recheck()}viewLogin(e){this.setStateForNewView(HS({view:CA.A.LOGIN},e)),this.notifyNewScreen("login"),H.A.isLogin=!0,this.themeWatcher.recheck()}viewHome(e=!1){this.setStateForNewView({view:CA.A.LOGGED_IN,justRegistered:e,currentRoomId:null}),this.setPage(B.A.HomePage),this.notifyNewScreen("home"),H.A.isLogin=!1,this.themeWatcher.recheck()}viewUser(e,t){(this.firstSyncPromise?this.firstSyncPromise.promise:Promise.resolve()).then((()=>{"chat"!==t?(this.notifyNewScreen("user/"+e),this.setState({currentUserId:e}),this.setPage(B.A.UserView)):this.chatCreateOrReuse(e)}))}async createRoom(e=!1,t,n){const i=f.Ay.createDialog(tx.A,{type:n,defaultPublic:e,defaultName:t}),[r,o]=await i.finished;r&&(0,V.Ay)(h.J.safeGet(),o)}chatCreateOrReuse(e){if(h.J.safeGet().isGuest())return void v.Ay.dispatch({action:x.r.DoAfterSyncPrepared,deferred_action:{action:x.r.ViewStartChatOrReuse,user_id:e}});const t=h.J.safeGet(),n=(0,RS.D)(t,e);n?v.Ay.dispatch({action:x.r.ViewRoom,room_id:n.roomId,metricsTrigger:"MessageUser"}):v.Ay.dispatch({action:"start_chat",user_id:e})}leaveRoomWarnings(e){const t=h.J.safeGet().getRoom(e),n=null==t?void 0:t.isSpaceRoom(),i=[];if(1===(null==t?void 0:t.currentState.getJoinedMemberCount()))return i.push(o.createElement("strong",{className:"warning",key:"only_member_warning"}," ",(0,C._t)("leave_room_dialog|last_person_warning"))),i;const r=null==t?void 0:t.currentState.getStateEvents("m.room.join_rules","");if(r){"public"!==r.getContent().join_rule&&i.push(o.createElement("strong",{className:"warning",key:"non_public_warning"}," ",n?(0,C._t)("leave_room_dialog|space_rejoin_warning"):(0,C._t)("leave_room_dialog|room_rejoin_warning")))}const a=h.J.get();if(a&&t){const e=t.currentState.getStateEvents(s.EventType.RoomPowerLevels,""),n=(e?e.getContent():{}).users||{},r=n[a.getUserId()],l=Object.values(n);if(l.every((e=>"number"==typeof e))){const e=Math.max(...l);if(e===r&&l.lastIndexOf(e)==l.indexOf(e)){const t=e>=100?(0,C._t)("leave_room_dialog|room_leave_admin_warning"):(0,C._t)("leave_room_dialog|room_leave_mod_warning");i.push(o.createElement("strong",{className:"warning",key:"last_admin_warning"}," ",t))}}}return i}leaveRoom(e){var t,n;const i=h.J.safeGet(),r=i.getRoom(e),s=this.leaveRoomWarnings(e),a=null==r?void 0:r.isSpaceRoom();f.Ay.createDialog(z.A,{title:a?(0,C._t)("space|leave_dialog_action"):(0,C._t)("action|leave_room"),description:o.createElement("span",null,a?(0,C._t)("leave_room_dialog|leave_space_question",{spaceName:null!==(t=null==r?void 0:r.name)&&void 0!==t?t:(0,C._t)("common|unnamed_space")}):(0,C._t)("leave_room_dialog|leave_room_question",{roomName:null!==(n=null==r?void 0:r.name)&&void 0!==n?n:(0,C._t)("common|unnamed_room")}),s),button:(0,C._t)("action|leave"),danger:s.length>0,onFinished:async t=>{t&&(await(0,Fe.U)(i,e),v.Ay.dispatch({action:x.r.AfterLeaveRoom,room_id:e}))}})}forgetRoom(e){const t=h.J.safeGet().getRoom(e);h.J.safeGet().forget(e).then((()=>{this.state.currentRoomId===e&&v.Ay.dispatch({action:x.r.ViewHomePage}),t&&Ai.Ay.instance.manualRoomUpdate(t,he.w4.RoomRemoved)})).catch((e=>{const t=e.errcode||(0,C.AO)("error|unknown_error_code");f.Ay.createDialog(lc.A,{title:(0,C._t)("error_dialog|forget_room_failed",{errCode:t}),description:e&&e.message?e.message:(0,C._t)("invite|failed_generic")})}))}async copyRoom(e){const t=(0,Po.B4)(h.J.safeGet(),e);await(0,iu.nC)(t)||f.Ay.createDialog(lc.A,{title:(0,C._t)("error_dialog|copy_room_link_failed|title"),description:(0,C._t)("error_dialog|copy_room_link_failed|description")})}async onLoggedIn(){if(H.A.isLogin=!1,this.themeWatcher.recheck(),Z.ng(),!h.J.currentUserIsJustRegistered()||null!==O.A.getValue("FTUE.useCaseSelection"))return this.onShowPostLoginScreen();this.setStateForNewView({view:CA.A.USE_CASE_SELECTION}),O.A.watchSetting("FTUE.useCaseSelection",null,((e,t,n,i,r)=>{null!==r&&this.state.view===CA.A.USE_CASE_SELECTION&&this.onShowPostLoginScreen()}))}async onShowPostLoginScreen(e){var t;if(e&&(Hf.Vo.instance.setProperty("ftueUseCaseSelection",e),O.A.setValue("FTUE.useCaseSelection",null,re.p.ACCOUNT,e)),this.setStateForNewView({view:CA.A.LOGGED_IN}),null!==(t=this.screenAfterLogin)&&void 0!==t&&t.screen)this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=void 0;else if(h.J.currentUserIsJustRegistered())if(h.J.setJustRegisteredUserId(null),M_.A.instance.pickBestInvite()){const e=M_.A.instance.pickBestInvite(),t=M_.A.instance.translateToWireFormat(e);this.showScreen(`room/${e.roomId}`,t)}else v.Ay.dispatch({action:x.r.ViewHomePage,justRegistered:!0});else this.showScreenAfterLogin();g.Ay.get("mobile_guide_toast")&&(()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,t=/Android/.test(navigator.userAgent),n=g.Ay.get().brand;(e||t)&&(document.cookie.includes("element_mobile_redirect_to_guide=false")||S.A.sharedInstance().addOrReplaceToast({key:j_,title:(0,C._t)("mobile_guide|toast_title"),props:{description:(0,C._t)("mobile_guide|toast_description",{brand:n}),primaryLabel:(0,C._t)("mobile_guide|toast_accept"),onPrimaryClick:U_,secondaryLabel:(0,C._t)("action|dismiss"),onSecondaryClick:F_},component:k.A,priority:99}))})();const n=g.Ay.get("user_notice");if(n){const e="user_notice_"+n.title;n.show_once&&localStorage.getItem(e)||S.A.sharedInstance().addOrReplaceToast({key:e,title:n.title,props:{description:o.createElement(Ga.XZ,null,n.description),primaryLabel:(0,C._t)("action|ok"),onPrimaryClick:()=>{S.A.sharedInstance().dismissToast(e),localStorage.setItem(e,"1")}},component:k.A,className:"mx_AnalyticsToast",priority:100})}}initPosthogAnalyticsToast(){null===O.A.getValue("pseudonymousAnalyticsOptIn")&&N_(),O.A.watchSetting("pseudonymousAnalyticsOptIn",null,((e,t,n,i,r)=>{null===r?N_():D_()}))}showScreenAfterLogin(){this.screenAfterLogin&&this.screenAfterLogin.screen?(this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=void 0):localStorage&&localStorage.getItem("mx_last_room_id")?this.viewLastRoom():h.J.safeGet().isGuest()?v.Ay.dispatch({action:"view_welcome_page"}):v.Ay.dispatch({action:x.r.ViewHomePage})}viewLastRoom(){var e;v.Ay.dispatch({action:x.r.ViewRoom,room_id:null!==(e=localStorage.getItem("mx_last_room_id"))&&void 0!==e?e:void 0,metricsTrigger:void 0})}onLoggedOut(){this.viewLogin({ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle(),this.stores.onLoggedOut()}onSoftLogout(){this.notifyNewScreen("soft_logout"),this.setStateForNewView({view:CA.A.SOFT_LOGOUT,ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onWillStartClient(){this.firstSyncComplete=!1,this.firstSyncPromise=(0,a.v6)();const e=h.J.safeGet();e.setCanResetTimelineCallback((e=>(l.v.log("Request to reset timeline in room ",e," viewing:",this.state.currentRoomId),e!==this.state.currentRoomId||(!this.loggedInView.current||this.loggedInView.current.canResetTimelineInRoom(e))))),e.on(s.ClientEvent.Sync,((e,t,n)=>{var i;e===s.SyncState.Error||e===s.SyncState.Reconnecting?this.setState({syncError:null!==(i=null==n?void 0:n.error)&&void 0!==i?i:null}):this.state.syncError&&this.setState({syncError:null});e!==s.SyncState.Syncing||t!==s.SyncState.Syncing?(l.v.debug(`MatrixClient sync state => ${e}`),e===s.SyncState.Prepared&&(this.firstSyncComplete=!0,this.firstSyncPromise.resolve(),_.default.shouldShowPrompt()&&!h.J.userRegisteredWithinLastHours(24)&&(0,ag.P)(!1),v.Ay.fire(x.r.FocusSendMessageComposer),this.setState({ready:!0}))):BS()})),e.on(s.HttpApiEvent.SessionLoggedOut,(function(e){if(!b.kQ()){if(f.Ay.forceCloseAllModals(),401===e.httpStatus&&e.data&&e.data.soft_logout)return l.v.warn("Soft logout issued by server - avoiding data deletion"),void b.hF();f.Ay.createDialog(lc.A,{title:(0,C._t)("auth|session_logged_out_title"),description:(0,C._t)("auth|session_logged_out_description")}),v.Ay.dispatch({action:"logout"})}})),e.on(s.HttpApiEvent.NoConsent,(function(t,n){f.Ay.createDialog(z.A,{title:(0,C._t)("terms|tac_title"),description:o.createElement("div",null,o.createElement("p",null," ",(0,C._t)("terms|tac_description",{homeserverDomain:e.getDomain()}))),button:(0,C._t)("terms|tac_button"),cancelButton:(0,C._t)("action|dismiss"),onFinished:e=>{if(e){window.open(n,"_blank").opener=null}}},void 0,!0)})),m.o.instance.start(e).catch((e=>l.v.error("Unable to start DecryptionFailureTracker",e))),e.on(s.ClientEvent.Room,(t=>{if(e.isCryptoEnabled()){const e=O.A.getValueAt(re.p.ROOM_DEVICE,"blacklistUnverifiedDevices",t.roomId,!0);t.setBlacklistUnverifiedDevices(e)}})),e.on(d.cr.Warning,(e=>{if("CRYPTO_WARNING_OLD_VERSION_DETECTED"===e)f.Ay.createDialog(lc.A,{title:(0,C._t)("encryption|old_version_detected_title"),description:(0,C._t)("encryption|old_version_detected_description",{brand:g.Ay.get().brand})})})),e.on(d.cr.KeyBackupFailed,(async t=>{let i,r=null;if(e.getKeyBackupEnabled())i=!0;else try{r=await e.getKeyBackupVersion(),null!==r&&(i=!0)}catch(e){return void l.v.error("Saw key backup error but failed to check backup version!",e)}i?f.Ay.createDialogAsync(n.e(2641).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/NewRecoveryMethodDialog.tsx")),{newVersionInfo:r}):f.Ay.createDialogAsync(n.e(8167).then(n.bind(n,"./node_modules/matrix-react-sdk/src/async-components/views/dialogs/security/RecoveryMethodRemovedDialog.tsx")))})),e.on(d.cr.KeySignatureUploadFailure,((e,t,n)=>{f.Ay.createDialog(nx,{failures:e,source:t,continuation:n})})),e.on(d.cr.VerificationRequestReceived,(e=>{e.verifier?f.Ay.createDialog(ax,{verifier:e.verifier},void 0,!1,!0):e.pending&&S.A.sharedInstance().addOrReplaceToast({key:"verifreq_"+e.transactionId,title:(0,C._t)("encryption|verification_requested_toast_title"),icon:"verification",props:{request:e},component:fA,priority:90})})),this.voiceBroadcastResumer=new Pn.FJ(e)}onClientStarted(){const e=h.J.safeGet();if(e.isCryptoEnabled()){const t=O.A.getValueAt(re.p.DEVICE,"blacklistUnverifiedDevices");e.setGlobalBlacklistUnverifiedDevices(t),e.setGlobalErrorOnUnknownDevices(!1)}Hf.Vo.instance.isEnabled()&&O.A.isLevelSupported(re.p.ACCOUNT)&&this.initPosthogAnalyticsToast()}showScreen(e,t){const n=h.J.get();if(!n||n.isGuest()||!zS.includes(e))if("register"===e)v.Ay.dispatch({action:"start_registration",params:t}),EA.instance.start(yA.REGISTER);else if("login"===e)v.Ay.dispatch({action:"start_login",params:t}),EA.instance.start(yA.LOGIN);else if("forgot_password"===e)v.Ay.dispatch({action:"start_password_recovery",params:t});else if("soft_logout"===e)null!=n&&n.getUserId()&&!b.b()?this.viewLastRoom():v.Ay.dispatch({action:"start_login",params:t});else if("new"===e)v.Ay.dispatch({action:"view_create_room"});else if("dm"===e)v.Ay.dispatch({action:"view_create_chat"});else if("settings"===e)v.Ay.fire(x.r.ViewUserSettings);else if("welcome"===e)v.Ay.dispatch({action:"view_welcome_page"});else if("home"===e)v.Ay.dispatch({action:x.r.ViewHomePage});else if("directory"===e)v.Ay.fire(x.r.ViewRoomDirectory);else if("start_sso"===e||"start_cas"===e){var i;let t=h.J.get();if(!t){const{hsUrl:e,isUrl:n}=this.getServerProperties().serverConfig;t=(0,s.createClient)({baseUrl:e,idBaseUrl:n})}const n="start_sso"===e?"sso":"cas";null===(i=p.A.get())||void 0===i||i.startSingleSignOn(t,n,this.getFragmentAfterLogin())}else if(0===e.indexOf("room/")){var r,o,a;const n=e.substring(5),i=n.indexOf(":")+1;let s=n.length;n.substring(i).indexOf("/")>-1&&(s=i+n.substring(i).indexOf("/"));const l=n.substring(0,s);let c,d=n.substring(s+1);if(d||(d=void 0),null!=t&&t.signurl&&null!=t&&t.email&&(c=M_.A.instance.storeInvite(l,t)),!c){c=M_.A.instance.getInvites().find((e=>e.roomId===l))}let u=[];null!=t&&t.via&&(u="string"==typeof t.via?[t.via]:t.via);const m={action:x.r.ViewRoom,event_id:d,via_servers:u,highlighted:Boolean(d),threepid_invite:c,oob_data:{name:null===(r=c)||void 0===r?void 0:r.roomName,avatarUrl:null===(o=c)||void 0===o?void 0:o.roomAvatarUrl,inviterName:null===(a=c)||void 0===a?void 0:a.inviterName},room_alias:void 0,room_id:void 0,metricsTrigger:void 0};"#"===l[0]?m.room_alias=l:m.room_id=l,v.Ay.dispatch(m)}else if(0===e.indexOf("user/")){const n=e.substring(5);v.Ay.dispatch({action:"view_user_info",userId:n,subAction:null==t?void 0:t.action})}else l.v.info(`Ignoring showScreen for '${e}'`);else v.Ay.dispatch({action:x.r.ViewHomePage})}notifyNewScreen(e,t=!1){this.props.onNewScreen&&this.props.onNewScreen(e,t),this.setPageSubtitle()}onLogoutClick(e){v.Ay.dispatch({action:"logout"}),e.stopPropagation(),e.preventDefault()}dispatchTimelineResize(){v.Ay.dispatch({action:"timeline_resize"})}onRegistered(e){return b.QC(e)}onSendEvent(e,t){const n=h.J.get();n&&n.sendEvent(e,t.getType(),t.getContent()).then((()=>{v.Ay.dispatch({action:"message_sent"})}))}setPageSubtitle(e=""){if(this.state.currentRoomId){const t=h.J.get(),n=null==t?void 0:t.getRoom(this.state.currentRoomId);n&&(e=`${this.subTitleStatus} | ${n.name} ${e}`)}else e=`${this.subTitleStatus} ${e}`;const t=`${g.Ay.get().brand} ${e}`;document.title!==t&&(document.title=t)}getFragmentAfterLogin(){let e="";const t=this.props.initialScreenAfterLogin;return t&&!["welcome","login","register","start_sso","start_cas"].includes(t.screen)&&(e=`/${t.screen}`),e}render(){const e=this.getFragmentAfterLogin();let t;if(this.state.view===CA.A.LOADING)t=o.createElement("div",{className:"mx_MatrixChat_splash"},o.createElement(dn.A,null));else if(this.state.view===CA.A.CONFIRM_LOCK_THEFT)t=o.createElement(LS,{onConfirm:()=>{this.setState({view:CA.A.LOADING}),this.startInitSession()}});else if(this.state.view===CA.A.COMPLETE_SECURITY)t=o.createElement(mx,{onFinished:this.onCompleteSecurityE2eSetupFinished});else if(this.state.view===CA.A.E2E_SETUP)t=o.createElement(Kx,{onFinished:this.onCompleteSecurityE2eSetupFinished,accountPassword:this.stores.accountPasswordStore.getPassword(),tokenLogin:!!this.tokenLogin});else if(this.state.view===CA.A.LOGGED_IN)t=this.state.ready&&this.state.page_type?o.createElement(w_,(0,i.A)({},this.props,this.state,{ref:this.loggedInView,matrixClient:h.J.safeGet(),onRegistered:this.onRegistered,currentRoomId:this.state.currentRoomId})):o.createElement(US,{matrixClient:h.J.safeGet(),onLogoutClick:this.onLogoutClick,syncError:this.state.syncError});else if(this.state.view===CA.A.WELCOME)t=o.createElement(vx,null);else if(this.state.view===CA.A.REGISTER&&O.A.getValue(W.f.Registration)){var n;const r=null===(n=M_.A.instance.pickBestInvite())||void 0===n?void 0:n.toEmail;t=o.createElement(sA,(0,i.A)({clientSecret:this.state.register_client_secret,sessionId:this.state.register_session_id,idSid:this.state.register_id_sid,email:r,brand:this.props.config.brand,onLoggedIn:this.onRegisterFlowComplete,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,fragmentAfterLogin:e},this.getServerProperties()))}else if(this.state.view===CA.A.FORGOT_PASSWORD&&O.A.getValue(W.f.PasswordReset))t=o.createElement(Wx,(0,i.A)({onComplete:this.onLoginClick,onLoginClick:this.onLoginClick},this.getServerProperties()));else if(this.state.view===CA.A.LOGIN){var r;const n=O.A.getValue(W.f.PasswordReset);t=o.createElement(vA,(0,i.A)({isSyncing:this.state.pendingInitialSync,onLoggedIn:this.onUserCompletedLoginFlow,onRegisterClick:this.onRegisterClick,fallbackHsUrl:this.getFallbackHsUrl(),defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,onForgotPasswordClick:n?this.onForgotPasswordClick:void 0,onServerConfigChange:this.onServerConfigChange,fragmentAfterLogin:e,defaultUsername:null===(r=this.props.startingFragmentQueryParams)||void 0===r?void 0:r.defaultUsername},this.getServerProperties()))}else if(this.state.view===CA.A.SOFT_LOGOUT)t=o.createElement(AA,{realQueryParams:this.props.realQueryParams,onTokenLoginCompleted:this.props.onTokenLoginCompleted,fragmentAfterLogin:e});else if(this.state.view===CA.A.USE_CASE_SELECTION)t=o.createElement(TA,{onFinished:e=>this.onShowPostLoginScreen(e)});else{if(this.state.view!==CA.A.LOCK_STOLEN)return l.v.error(`Unknown view ${this.state.view}`),null;t=o.createElement(OS,null)}return o.createElement($s.A,null,o.createElement(Xt.A.Provider,{value:this.stores},t))}}(0,r.A)(GS,"displayName","MatrixChat"),(0,r.A)(GS,"defaultProps",{realQueryParams:{},startingFragmentQueryParams:{},config:{},onTokenLoginCompleted:()=>{}})},"./node_modules/matrix-react-sdk/src/components/structures/auth/SetupEncryptionBody.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/react/index.js"),o=n("./node_modules/matrix-js-sdk/src/logger.ts"),s=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),a=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),l=n("./node_modules/matrix-react-sdk/src/Modal.tsx"),c=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/VerificationRequestDialog.tsx"),d=n("./node_modules/matrix-react-sdk/src/stores/SetupEncryptionStore.ts"),u=n("./node_modules/matrix-react-sdk/src/components/views/right_panel/EncryptionPanel.tsx"),m=n("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),h=n("./node_modules/matrix-react-sdk/src/components/views/elements/Spinner.tsx");class p extends r.Component{constructor(e){super(e),(0,i.A)(this,"onStoreUpdate",(()=>{const e=d.s.sharedInstance();e.phase!==d.a.Finished?this.setState({phase:e.phase,verificationRequest:e.verificationRequest,backupInfo:e.backupInfo,lostKeys:e.lostKeys()}):this.props.onFinished()})),(0,i.A)(this,"onUsePassphraseClick",(async()=>{d.s.sharedInstance().usePassPhrase()})),(0,i.A)(this,"onVerifyClick",(()=>{var e;const t=a.J.safeGet(),n=t.getSafeUserId(),i=t.getCrypto().requestOwnUserVerification();this.props.onFinished(),l.Ay.createDialog(c.A,{verificationRequestPromise:i,member:null!==(e=t.getUser(n))&&void 0!==e?e:void 0,onFinished:async()=>{(await i).cancel(),this.props.onFinished()}})})),(0,i.A)(this,"onSkipConfirmClick",(()=>{d.s.sharedInstance().skipConfirm()})),(0,i.A)(this,"onSkipBackClick",(()=>{d.s.sharedInstance().returnAfterSkip()})),(0,i.A)(this,"onResetClick",(e=>{e.preventDefault();d.s.sharedInstance().reset()})),(0,i.A)(this,"onResetConfirmClick",(()=>{this.props.onFinished();d.s.sharedInstance().resetConfirm()})),(0,i.A)(this,"onResetBackClick",(()=>{d.s.sharedInstance().returnAfterReset()})),(0,i.A)(this,"onDoneClick",(()=>{d.s.sharedInstance().done()})),(0,i.A)(this,"onEncryptionPanelClose",(()=>{this.props.onFinished()}));const t=d.s.sharedInstance();t.on("update",this.onStoreUpdate),t.start(),this.state={phase:t.phase,verificationRequest:t.verificationRequest,backupInfo:t.backupInfo,lostKeys:t.lostKeys()}}componentWillUnmount(){const e=d.s.sharedInstance();e.off("update",this.onStoreUpdate),e.stop()}render(){const e=a.J.safeGet(),{phase:t,lostKeys:n}=this.state;if(this.state.verificationRequest&&e.getUser(this.state.verificationRequest.otherUserId))return r.createElement(u.A,{layout:"dialog",verificationRequest:this.state.verificationRequest,onClose:this.onEncryptionPanelClose,member:e.getUser(this.state.verificationRequest.otherUserId),isRoomEncrypted:!1});if(t===d.a.Intro){if(n)return r.createElement("div",null,r.createElement("p",null,(0,s._t)("encryption|verification|no_key_or_device")),r.createElement("div",{className:"mx_CompleteSecurity_actionRow"},r.createElement(m.A,{kind:"primary",onClick:this.onResetConfirmClick},(0,s._t)("encryption|verification|reset_proceed_prompt"))));{const e=d.s.sharedInstance();let t,n,o;return e.keyInfo&&(i=e.keyInfo,Boolean(i.passphrase&&i.passphrase.salt&&i.passphrase.iterations))?t=(0,s._t)("encryption|verification|verify_using_key_or_phrase"):e.keyInfo&&(t=(0,s._t)("encryption|verification|verify_using_key")),t&&(n=r.createElement(m.A,{kind:"primary",onClick:this.onUsePassphraseClick},t)),e.hasDevicesToVerifyAgainst&&(o=r.createElement(m.A,{kind:"primary",onClick:this.onVerifyClick},(0,s._t)("encryption|verification|verify_using_device"))),r.createElement("div",null,r.createElement("p",null,(0,s._t)("encryption|verification|verification_description")),r.createElement("div",{className:"mx_CompleteSecurity_actionRow"},o,n),r.createElement("div",{className:"mx_SetupEncryptionBody_reset"},(0,s._t)("encryption|reset_all_button",void 0,{a:e=>r.createElement(m.A,{kind:"link_inline",className:"mx_SetupEncryptionBody_reset_link",onClick:this.onResetClick},e)})))}}if(t===d.a.Done){let e;return e=this.state.backupInfo?r.createElement("p",null,(0,s._t)("encryption|verification|verification_success_with_backup")):r.createElement("p",null,(0,s._t)("encryption|verification|verification_success_without_backup")),r.createElement("div",null,r.createElement("div",{className:"mx_CompleteSecurity_heroIcon mx_E2EIcon_verified"}),e,r.createElement("div",{className:"mx_CompleteSecurity_actionRow"},r.createElement(m.A,{kind:"primary",onClick:this.onDoneClick},(0,s._t)("action|done"))))}return t===d.a.ConfirmSkip?r.createElement("div",null,r.createElement("p",null,(0,s._t)("encryption|verification|verification_skip_warning")),r.createElement("div",{className:"mx_CompleteSecurity_actionRow"},r.createElement(m.A,{kind:"danger_outline",onClick:this.onSkipConfirmClick},(0,s._t)("encryption|verification|verify_later")),r.createElement(m.A,{kind:"primary",onClick:this.onSkipBackClick},(0,s._t)("action|go_back")))):t===d.a.ConfirmReset?r.createElement("div",null,r.createElement("p",null,(0,s._t)("encryption|verification|verify_reset_warning_1")),r.createElement("p",null,(0,s._t)("encryption|verification|verify_reset_warning_2")),r.createElement("div",{className:"mx_CompleteSecurity_actionRow"},r.createElement(m.A,{kind:"danger_outline",onClick:this.onResetConfirmClick},(0,s._t)("encryption|verification|reset_proceed_prompt")),r.createElement(m.A,{kind:"primary",onClick:this.onResetBackClick},(0,s._t)("action|go_back")))):t===d.a.Busy||t===d.a.Loading?r.createElement(h.A,null):void o.v.log(`SetupEncryptionBody: Unknown phase ${t}`);var i}}},"./node_modules/matrix-react-sdk/src/components/structures/grouper/LateEventGrouper.ts":(e,t,n)=>{"use strict";n.d(t,{R:()=>r});const i="io.element.late_event";function r(e){return e.getUnsigned()[i]}},"./node_modules/matrix-react-sdk/src/components/views/auth/LoginWithQR-types.ts":(e,t,n)=>{"use strict";n.d(t,{HY:()=>o,Kt:()=>i,a0:()=>r});let i=function(e){return e.Show="show",e}({}),r=function(e){return e[e.Loading=0]="Loading",e[e.ShowingQR=1]="ShowingQR",e[e.OutOfBandConfirmation=2]="OutOfBandConfirmation",e[e.WaitingForDevice=3]="WaitingForDevice",e[e.Verifying=4]="Verifying",e[e.Error=5]="Error",e[e.LegacyConnected=6]="LegacyConnected",e}({}),o=function(e){return e[e.Cancel=0]="Cancel",e[e.Decline=1]="Decline",e[e.Approve=2]="Approve",e[e.Back=3]="Back",e[e.ShowQr=4]="ShowQr",e}({})},"./node_modules/matrix-react-sdk/src/components/views/dialogs/VerificationRequestDialog.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),o=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),s=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),a=n("./node_modules/matrix-react-sdk/src/components/views/right_panel/EncryptionPanel.tsx");class l extends i.Component{constructor(e){var t;super(e),this.state={verificationRequest:this.props.verificationRequest},null===(t=this.props.verificationRequestPromise)||void 0===t||t.then((e=>{this.setState({verificationRequest:e})}))}render(){const e=this.state.verificationRequest,t=null==e?void 0:e.otherUserId,n=this.props.member||(t?r.J.safeGet().getUser(t):null),l=null!=e&&e.isSelfVerification?(0,o._t)("encryption|verification|verification_dialog_title_device"):(0,o._t)("encryption|verification|verification_dialog_title_user");return n?i.createElement(s.A,{className:"mx_InfoDialog",onFinished:this.props.onFinished,contentId:"mx_Dialog_content",title:l,hasCancel:!0},i.createElement(a.A,{layout:"dialog",verificationRequest:this.props.verificationRequest,verificationRequestPromise:this.props.verificationRequestPromise,onClose:this.props.onFinished,member:n,isRoomEncrypted:!1})):null}}},"./node_modules/matrix-react-sdk/src/components/views/dialogs/security/SetupEncryptionDialog.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/react/index.js"),o=n("./node_modules/matrix-react-sdk/src/components/structures/auth/SetupEncryptionBody.tsx"),s=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BaseDialog.tsx"),a=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),l=n("./node_modules/matrix-react-sdk/src/stores/SetupEncryptionStore.ts");function c(e){return e===l.a.Done?n("./node_modules/matrix-react-sdk/res/img/e2e/verified-deprecated.svg").A:n("./node_modules/matrix-react-sdk/res/img/e2e/warning-deprecated.svg").A}class d extends r.Component{constructor(e){super(e),(0,i.A)(this,"store",void 0),(0,i.A)(this,"onStoreUpdate",(()=>{this.setState({icon:c(this.store.phase)})})),this.store=l.s.sharedInstance(),this.state={icon:c(this.store.phase)}}componentDidMount(){this.store.on("update",this.onStoreUpdate)}componentWillUnmount(){this.store.removeListener("update",this.onStoreUpdate)}render(){return r.createElement(s.A,{headerImage:this.state.icon,onFinished:this.props.onFinished,title:(0,a._t)("encryption|verify_toast_title")},r.createElement(o.A,{onFinished:this.props.onFinished}))}}},"./node_modules/matrix-react-sdk/src/components/views/elements/RoomName.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-js-sdk/src/matrix.ts"),o=n("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts");const s=({room:e,children:t})=>{const[n,s]=(0,i.useState)(null==e?void 0:e.name);return(0,o.YK)(e,r.RoomEvent.Name,(()=>{s(null==e?void 0:e.name)})),(0,i.useEffect)((()=>{s(null==e?void 0:e.name)}),[e]),t?t(null!=n?n:""):i.createElement(i.Fragment,null,n||"")}},"./node_modules/matrix-react-sdk/src/components/views/messages/DisambiguatedProfile.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var i=n("./node_modules/react/index.js"),r=n("./node_modules/classnames/index.js"),o=n.n(r),s=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),a=n("./node_modules/matrix-react-sdk/src/utils/FormattingUtils.ts"),l=n("./node_modules/matrix-react-sdk/src/customisations/UserIdentifier.ts");class c extends i.Component{render(){const{fallbackName:e,member:t,colored:n,emphasizeDisplayName:r,withTooltip:c,onClick:d}=this.props,u=(null==t?void 0:t.rawDisplayName)||e,m=null==t?void 0:t.userId;let h,p,g;if(n&&(h=(0,a.yJ)(null!=m?m:"")),m){var v,_;const e=null!==(v=null===(_=l.A.getDisplayUserIdentifier)||void 0===_?void 0:_.call(l.A,m,{withDisplayName:!0,roomId:t.roomId}))&&void 0!==v?v:m;null!=t&&t.disambiguate&&(p=i.createElement("span",{className:"mx_DisambiguatedProfile_mxid"},e)),g=(0,s._t)("timeline|disambiguated_profile",{displayName:u,matrixId:e})}const f=o()(h,{mx_DisambiguatedProfile_displayName:r});return i.createElement("div",{className:"mx_DisambiguatedProfile",title:c?g:void 0,onClick:d},i.createElement("span",{className:f,dir:"auto"},u),p)}}},"./node_modules/matrix-react-sdk/src/components/views/messages/SenderProfile.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-js-sdk/src/matrix.ts"),o=n("./node_modules/matrix-react-sdk/src/components/views/messages/DisambiguatedProfile.tsx"),s=n("./node_modules/matrix-react-sdk/src/hooks/room/useRoomMemberProfile.ts");function a({mxEvent:e,onClick:t,withTooltip:n}){var a;const l=(0,s.s)({userId:e.getSender(),member:e.sender});return e.getContent().msgtype!==r.MsgType.Emote?i.createElement(o.A,{fallbackName:null!==(a=e.getSender())&&void 0!==a?a:"",onClick:t,member:l,colored:!0,emphasizeDisplayName:!0,withTooltip:n}):i.createElement(i.Fragment,null)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/EntityTile.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>g,C:()=>m});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/react/index.js"),o=n("./node_modules/classnames/index.js"),s=n.n(o),a=n("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),l=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),c=n("./node_modules/matrix-react-sdk/src/components/views/rooms/E2EIcon.tsx"),d=n("./node_modules/matrix-react-sdk/src/components/views/avatars/BaseAvatar.tsx"),u=n("./node_modules/matrix-react-sdk/src/components/views/rooms/PresenceLabel.tsx");let m=function(e){return e.Admin="admin",e.Moderator="moderator",e}({});const h={[m.Admin]:(0,l.AO)("power_level|admin"),[m.Moderator]:(0,l.AO)("power_level|mod")},p={offline:"mx_EntityTile_offline",online:"mx_EntityTile_online",unavailable:"mx_EntityTile_unavailable","io.element.unreachable":"mx_EntityTile_unreachable"};class g extends r.PureComponent{constructor(e){super(e),this.state={hover:!1}}getPresenceLabel(){if(!this.props.showPresence)return;const e=this.props.presenceLastActiveAgo?Date.now()-(this.props.presenceLastTs-this.props.presenceLastActiveAgo):-1;return r.createElement(u.A,{activeAgo:e,currentlyActive:this.props.presenceCurrentlyActive,presenceState:this.props.presenceState})}render(){const e={mx_EntityTile:!0};this.props.className&&(e[this.props.className]=!0);var t,i;e[(t=this.props.presenceState,i=this.props.presenceLastActiveAgo,!1===this.props.showPresence?"mx_EntityTile_online_beenactive":"offline"===t?i?p.offline+"_beenactive":p.offline+"_neveractive":t?p[t]:p.offline+"_neveractive")]=!0;const o=this.props.nameJSX||this.props.name,u=r.createElement("div",{className:"mx_EntityTile_details"},r.createElement("div",{className:"mx_EntityTile_name"},o),this.getPresenceLabel());let m,g;this.props.showInviteButton&&(m=r.createElement("div",{className:"mx_EntityTile_invite"},r.createElement("img",{alt:(0,l._t)("action|invite"),src:n("./node_modules/matrix-react-sdk/res/img/plus.svg").A,width:"16",height:"16"})));const v=this.props.powerStatus;if(v){const e=(0,l._t)(h[v]);g=r.createElement("div",{className:"mx_EntityTile_power"},e)}let _;const{e2eStatus:f}=this.props;f&&(_=r.createElement(c.A,{status:f,isUser:!0,bordered:!0}));const y=this.props.avatarJsx||r.createElement(d.A,{name:this.props.name,size:"36px","aria-hidden":"true"});return r.createElement("div",null,r.createElement(a.A,{className:s()(e),title:this.props.title,onClick:this.props.onClick},r.createElement("div",{className:"mx_EntityTile_avatar"},y,_),u,g,m))}}(0,i.A)(g,"defaultProps",{onClick:()=>{},presenceState:"offline",presenceLastActiveAgo:0,presenceLastTs:0,showInviteButton:!1,showPresence:!0})},"./node_modules/matrix-react-sdk/src/components/views/rooms/EventTile.tsx":(e,t,n)=>{"use strict";n.d(t,{f3:()=>Yt,Ay:()=>Qt,CH:()=>$t});var i=n("./node_modules/@babel/runtime/helpers/esm/extends.js"),r=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("./node_modules/react/index.js"),s=n("./node_modules/classnames/index.js"),a=n.n(s),l=n("./node_modules/matrix-js-sdk/src/matrix.ts"),c=n("./node_modules/matrix-js-sdk/src/logger.ts"),d=n("./node_modules/matrix-js-sdk/src/webrtc/call.ts"),u=n("./node_modules/matrix-js-sdk/src/crypto/index.ts"),m=n("./node_modules/matrix-js-sdk/src/crypto-api/index.ts"),h=n("./node_modules/@vector-im/compound-web/dist/compound-web.js"),p=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),g=n("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),v=n("./node_modules/matrix-react-sdk/src/utils/permalinks/Permalinks.ts"),_=n("./node_modules/matrix-react-sdk/src/settings/SettingsStore.ts"),f=n("./node_modules/matrix-react-sdk/src/utils/FormattingUtils.ts"),y=n("./node_modules/matrix-react-sdk/src/dispatcher/actions.ts"),E=n("./node_modules/matrix-react-sdk/src/components/views/elements/Spinner.tsx"),b=n("./node_modules/matrix-react-sdk/src/components/views/rooms/ReplyTile.tsx"),w=n("./node_modules/matrix-react-sdk/src/components/views/elements/Pill.tsx"),x=n("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),A=n("./node_modules/matrix-react-sdk/src/utils/Reply.ts"),S=n("./node_modules/matrix-react-sdk/src/contexts/RoomContext.ts"),C=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts");class k extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"room",void 0),(0,r.A)(this,"blockquoteRef",o.createRef()),(0,r.A)(this,"canCollapse",(()=>this.state.events.length>1)),(0,r.A)(this,"collapse",(()=>{this.initialize()})),(0,r.A)(this,"onQuoteClick",(async()=>{if(!this.state.loadedEv)return;const e=[this.state.loadedEv,...this.state.events];let t=null;e.length>0&&(t=await this.getNextEvent(e[0])),this.setState({loadedEv:t,events:e}),g.Ay.fire(y.r.FocusSendMessageComposer)})),this.state={events:[],loadedEv:null,loading:!0,err:!1},this.room=this.matrixClient.getRoom(this.props.parentEv.getRoomId())}get matrixClient(){return C.J.safeGet()}componentDidMount(){this.initialize(),this.trySetExpandableQuotes()}componentDidUpdate(){var e,t;null===(e=(t=this.props).onHeightChanged)||void 0===e||e.call(t),this.trySetExpandableQuotes()}componentWillUnmount(){this.unmounted=!0}trySetExpandableQuotes(){if(void 0===this.props.isQuoteExpanded&&this.blockquoteRef.current){const e=this.blockquoteRef.current.querySelector(".mx_EventTile_body");if(e){const t=e.querySelector("code"),n=!!t&&t.offsetHeight>=60;(e.offsetHeight>=60||n)&&this.props.setQuoteExpanded(!1)}}}async initialize(){const{parentEv:e}=this.props,t=await this.getEvent((0,A.Ul)(e));if(!this.unmounted)if(t){const e=await this.getNextEvent(t);this.setState({events:[t],loadedEv:e,loading:!1})}else this.setState({err:!0})}async getNextEvent(e){try{const t=(0,A.Ul)(e);return t?await this.getEvent(t):null}catch(e){return null}}async getEvent(e){var t;if(!e)return null;const n=this.room.findEventById(e);if(n)return n;try{await this.matrixClient.getEventTimeline(this.room.getUnfilteredTimelineSet(),e)}catch(e){return null}return null!==(t=this.room.findEventById(e))&&void 0!==t?t:null}getReplyChainColorClass(e){return(0,f.yJ)(e.getSender()).replace("Username","ReplyChain")}render(){let e;if(this.state.err)e=o.createElement("blockquote",{className:"mx_ReplyChain mx_ReplyChain_error"},(0,p._t)("timeline|reply|error_loading"));else if(this.state.loadedEv&&(0,A.c$)(this.state.events[0])){const t=this.state.loadedEv,n=this.matrixClient.getRoom(t.getRoomId());e=o.createElement("blockquote",{className:`mx_ReplyChain ${this.getReplyChainColorClass(t)}`},(0,p._t)("timeline|reply|in_reply_to",{},{a:e=>o.createElement(x.A,{kind:"link_inline",className:"mx_ReplyChain_show",onClick:this.onQuoteClick},e),pill:o.createElement(w.ab,{type:w.yL.UserMention,room:null!=n?n:void 0,url:(0,v.Ne)(t.getSender()),shouldShowPillAvatar:_.A.getValue("Pill.shouldShowPillAvatar")})}))}else if(this.props.forExport){const t=(0,A.Ul)(this.props.parentEv);e=o.createElement("p",{className:"mx_ReplyChain_Export"},(0,p._t)("timeline|reply|in_reply_to_for_export",{},{a:e=>o.createElement("a",{className:"mx_reply_anchor",href:`#${t}`,"data-scroll-to":t}," ",e," ")}))}else this.state.loading&&(e=o.createElement(E.A,{w:16,h:16}));const{isQuoteExpanded:t}=this.props,n=this.state.events.map((e=>{const n=a()({mx_ReplyChain:!0,[this.getReplyChainColorClass(e)]:!0,"mx_ReplyChain--expanded":!0===t,"mx_ReplyChain--collapsed":!1===t});return o.createElement("blockquote",{ref:this.blockquoteRef,className:n,key:e.getId()},o.createElement(b.A,{mxEvent:e,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator,toggleExpandedQuote:()=>this.props.setQuoteExpanded(!this.props.isQuoteExpanded),getRelationsForEvent:this.props.getRelationsForEvent}))}));return o.createElement("div",{className:"mx_ReplyChain_wrapper"},o.createElement("div",null,e),o.createElement("div",null,n))}}(0,r.A)(k,"contextType",S.Ay);var R,I=n("./node_modules/matrix-react-sdk/src/settings/enums/Layout.ts"),T=n("./node_modules/matrix-react-sdk/src/DateUtils.ts"),P=n("./node_modules/matrix-react-sdk/src/components/views/messages/DecryptionFailureBody.tsx"),N=n("./node_modules/matrix-react-sdk/src/components/views/avatars/RoomAvatar.tsx"),D=n("./node_modules/matrix-react-sdk/src/components/views/context_menus/MessageContextMenu.tsx"),M=n("./node_modules/matrix-react-sdk/src/components/structures/ContextMenu.tsx"),O=n("./node_modules/matrix-react-sdk/src/utils/objects.ts"),L=n("./node_modules/matrix-react-sdk/src/stores/notifications/StaticNotificationState.ts"),U=n("./node_modules/matrix-react-sdk/src/components/views/rooms/NotificationBadge.tsx"),F=n("./node_modules/matrix-react-sdk/src/PlatformPeg.ts"),j=n("./node_modules/matrix-react-sdk/src/components/views/avatars/MemberAvatar.tsx"),B=n("./node_modules/matrix-react-sdk/src/components/views/messages/SenderProfile.tsx"),V=n("./node_modules/matrix-react-sdk/src/components/views/messages/MessageTimestamp.tsx");function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},H.apply(null,arguments)}var z=function(e,t){return o.createElement("svg",H({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),R||(R=o.createElement("path",{fillRule:"evenodd",d:"M6.119 2a.5.5 0 0 0-.35.857L7.85 4.9a.5.5 0 0 1 .15.357v4.487a.5.5 0 0 1-.15.356l-3.7 3.644A.5.5 0 0 0 4 14.1v1.4a.5.5 0 0 0 .5.5H11v6a1 1 0 1 0 2 0v-6h6.5a.5.5 0 0 0 .5-.5v-1.4a.5.5 0 0 0-.15-.356l-3.7-3.644a.5.5 0 0 1-.15-.356V5.257a.5.5 0 0 1 .15-.357l2.081-2.043a.5.5 0 0 0-.35-.857zM10 4h4v5.744a2.5 2.5 0 0 0 .746 1.781L17.26 14H6.74l2.514-2.475A2.5 2.5 0 0 0 10 9.744z",clipRule:"evenodd"})))},W=(0,o.forwardRef)(z);var G,K=n("./node_modules/@vector-im/compound-design-tokens/icons/unpin.svg"),J=n("./node_modules/matrix-react-sdk/res/img/element-icons/context-menu.svg");function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},q.apply(null,arguments)}var $=function(e,t){return o.createElement("svg",q({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),G||(G=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 14h12M5 10.5l7-7"})))},Y=(0,o.forwardRef)($);var Q;function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Z.apply(null,arguments)}var X=function(e,t){return o.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Q||(Q=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M20 1a1 1 0 0 0-1 1v2h-2a1 1 0 1 0 0 2h2v2a1 1 0 1 0 2 0V6h2a1 1 0 1 0 0-2h-2V2a1 1 0 0 0-1-1M7 9.5C7 8.67 7.67 8 8.5 8s1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5m8.5 1.5c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5M12 17.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5M4 12a8 8 0 0 1 9.774-7.803 1 1 0 1 0 .442-1.95A10 10 0 0 0 12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10q0-.318-.02-.632a1 1 0 1 0-1.996.125q.015.25.016.507a8 8 0 1 1-16 0",clipRule:"evenodd"})))},ee=(0,o.forwardRef)(X);var te;function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ne.apply(null,arguments)}var ie=function(e,t){return o.createElement("svg",ne({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",role:"presentation","aria-hidden":!0,ref:t},e),te||(te=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.523 2.964a6.418 6.418 0 0 1 10.36 4.369h1.29c.26 0 .416.292.272.51l-2.006 3.011a.327.327 0 0 1-.544 0l-2.006-3.012a.327.327 0 0 1 .272-.509h1.21a4.918 4.918 0 0 0-7.918-3.192 4 4 0 0 1-.184.136l-.014.01-.004.003-.002.001h-.001v.001l-.415-.625.414.625a.75.75 0 0 1-.83-1.25l.003-.001.02-.014zm-.895 5.703H4.84a.327.327 0 0 0 .272-.51L3.106 5.146a.327.327 0 0 0-.545 0L.555 8.157a.328.328 0 0 0 .273.51h1.29a6.418 6.418 0 0 0 10.503 4.251.75.75 0 0 0-.963-1.15 4.918 4.918 0 0 1-8.03-3.102Z",clipRule:"evenodd"})))},re=(0,o.forwardRef)(ie);var oe,se;function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ae.apply(null,arguments)}var le=function(e,t){return o.createElement("svg",ae({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),oe||(oe=o.createElement("path",{fill:"currentColor",d:"M5 5.25a.75.75 0 0 0 0 1.5h8a.75.75 0 0 0 0-1.5zm0 3a.75.75 0 0 0 0 1.5h4a.75.75 0 1 0 0-1.5z"})),se||(se=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 .25A2.75 2.75 0 0 0 .25 3v14a.75.75 0 0 0 1.2.6L4.916 15c.217-.162.48-.25.75-.25H15A2.75 2.75 0 0 0 17.75 12V3A2.75 2.75 0 0 0 15 .25zM1.75 3c0-.69.56-1.25 1.25-1.25h12c.69 0 1.25.56 1.25 1.25v9c0 .69-.56 1.25-1.25 1.25H5.666a2.75 2.75 0 0 0-1.65.55L1.75 15.5z",clipRule:"evenodd"})))},ce=(0,o.forwardRef)(le);var de;function ue(){return ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ue.apply(null,arguments)}var me=function(e,t){return o.createElement("svg",ue({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),de||(de=o.createElement("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"})))},he=(0,o.forwardRef)(me);var pe,ge;function ve(){return ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ve.apply(null,arguments)}var _e=function(e,t){return o.createElement("svg",ve({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0,ref:t},e),pe||(pe=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.5,d:"M10.066 14.25h1.57c1.858 0 3.364-1.567 3.364-3.5s-1.506-3.5-3.364-3.5H4.534"})),ge||(ge=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6.524 3.75 3 7.286l3.524 3.535"})))},fe=(0,o.forwardRef)(_e);var ye;function Ee(){return Ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ee.apply(null,arguments)}var be=function(e,t){return o.createElement("svg",Ee({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 14",role:"presentation","aria-hidden":!0,ref:t},e),ye||(ye=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M.22 8.494a.753.753 0 0 1 1.062-.002l3.724 3.7L8.718 8.48a.753.753 0 0 1 1.062-.002.747.747 0 0 1 .002 1.06L5.54 13.78a.753.753 0 0 1-1.063.002L.221 9.552a.747.747 0 0 1-.002-1.058m9.562-2.988a.753.753 0 0 1-1.062.002l-3.724-3.7L1.283 5.52a.753.753 0 0 1-1.062.002.747.747 0 0 1-.002-1.06L4.462.22A.753.753 0 0 1 5.524.218l4.257 4.23a.747.747 0 0 1 .001 1.058",clipRule:"evenodd"})))},we=(0,o.forwardRef)(be);var xe;function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ae.apply(null,arguments)}var Se=function(e,t){return o.createElement("svg",Ae({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 14",role:"presentation","aria-hidden":!0,ref:t},e),xe||(xe=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M.22.234A.753.753 0 0 1 1.281.232l3.724 3.7L8.718.22A.753.753 0 0 1 9.781.218a.747.747 0 0 1 .001 1.06L5.54 5.52a.753.753 0 0 1-1.063.002L.221 1.292A.747.747 0 0 1 .219.235m9.562 13.532a.753.753 0 0 1-1.062.002l-3.724-3.7-3.713 3.712a.753.753 0 0 1-1.062.002.747.747 0 0 1-.002-1.06L4.462 8.48a.753.753 0 0 1 1.062-.002l4.257 4.23a.747.747 0 0 1 .001 1.058",clipRule:"evenodd"})))},Ce=(0,o.forwardRef)(Se);var ke=n("./node_modules/matrix-react-sdk/src/utils/EventUtils.ts"),Re=n("./node_modules/matrix-react-sdk/src/accessibility/Toolbar.tsx"),Ie=n("./node_modules/matrix-react-sdk/src/accessibility/RovingTabIndex.tsx"),Te=n("./node_modules/matrix-react-sdk/src/Resend.ts"),Pe=n("./node_modules/matrix-react-sdk/src/utils/MediaEventHelper.ts"),Ne=n("./node_modules/matrix-react-sdk/res/img/download.svg"),De=n("./node_modules/matrix-react-sdk/src/utils/FileDownloader.ts"),Me=n("./node_modules/matrix-react-sdk/src/Modal.tsx"),Oe=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx");class Le extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"downloader",new De.s),(0,r.A)(this,"onDownloadClick",(async()=>{try{await this.doDownload()}catch(e){Me.Ay.createDialog(Oe.A,{title:(0,p._t)("timeline|download_failed"),description:o.createElement(o.Fragment,null,o.createElement("div",null,(0,p._t)("timeline|download_failed_description")),o.createElement("div",null,e instanceof Error?e.toString():""))}),this.setState({loading:!1})}})),this.state={loading:!1,tooltip:(0,p.AO)("timeline|download_action_downloading")}}async doDownload(){const e=this.props.mediaEventHelperGet();if(this.state.loading||!e)return;if(e.media.isEncrypted&&this.setState({tooltip:(0,p.AO)("timeline|download_action_decrypting")}),this.setState({loading:!0}),this.state.blob)return this.downloadBlob(this.state.blob);const t=await e.sourceBlob.value;this.setState({blob:t}),await this.downloadBlob(t)}async downloadBlob(e){await this.downloader.download({blob:e,name:this.props.mediaEventHelperGet().fileName}),this.setState({loading:!1})}render(){let e;this.state.loading&&(e=o.createElement(E.A,{w:18,h:18}));const t=a()({mx_MessageActionBar_iconButton:!0,mx_MessageActionBar_downloadButton:!0,mx_MessageActionBar_downloadSpinnerButton:!!e});return o.createElement(Ie.k,{className:t,title:e?(0,p._t)(this.state.tooltip):(0,p._t)("action|download"),onClick:this.onDownloadClick,disabled:!!e,placement:"left"},o.createElement(Ne.I,null),e)}}var Ue=n("./node_modules/matrix-react-sdk/src/components/views/emojipicker/ReactionPicker.tsx"),Fe=n("./node_modules/matrix-react-sdk/src/components/views/right_panel/context.ts"),je=n("./node_modules/matrix-react-sdk/src/Keyboard.ts"),Be=n("./node_modules/matrix-react-sdk/src/accessibility/KeyboardShortcuts.ts"),Ve=n("./node_modules/matrix-react-sdk/src/voice-broadcast/types.ts"),He=n("./node_modules/matrix-react-sdk/src/utils/PinningUtils.ts"),ze=n("./node_modules/matrix-react-sdk/src/PosthogTrackers.ts");const We=({mxEvent:e,getTile:t,getReplyChain:n,permalinkCreator:r,onFocusChange:s,getRelationsForEvent:a})=>{const[l,c,d,u]=(0,M.EF)(),[m,h]=(0,Ie.A9)(c);(0,o.useEffect)((()=>{s(l)}),[s,l]);const g=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),d(),m()}),[d,m]);let v;if(l&&c.current){const s=null==t?void 0:t(),l=n(),d=c.current.getBoundingClientRect();v=o.createElement(D.A,(0,i.A)({},(0,M.qv)(d),{mxEvent:e,permalinkCreator:r,eventTileOps:s&&s.getEventTileOps?s.getEventTileOps():void 0,collapseReplyChain:null!=l&&l.canCollapse()?l.collapse:void 0,onFinished:u,getRelationsForEvent:a}))}return o.createElement(o.Fragment,null,o.createElement(M.oW,{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_optionsButton",title:(0,p._t)("common|options"),onClick:g,onContextMenu:g,isExpanded:l,ref:c,onFocus:m,tabIndex:h?0:-1,placement:"left"},o.createElement(J.I,null)),v)},Ge=({mxEvent:e,reactions:t,onFocusChange:n})=>{const[r,s,a,l]=(0,M.EF)(),[c,d]=(0,Ie.A9)(s);let u;if((0,o.useEffect)((()=>{n(r)}),[n,r]),r&&s.current){const n=s.current.getBoundingClientRect();u=o.createElement(M.Ay,(0,i.A)({},(0,M.qv)(n),{onFinished:l,managed:!1}),o.createElement(Ue.A,{mxEvent:e,reactions:t,onFinished:l}))}const m=(0,o.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),a(),c()}),[a,c]);return o.createElement(o.Fragment,null,o.createElement(M.oW,{className:"mx_MessageActionBar_iconButton",title:(0,p._t)("action|react"),onClick:m,onContextMenu:m,isExpanded:r,ref:s,onFocus:c,tabIndex:d?0:-1,placement:"left"},o.createElement(ee,null)),u)},Ke=({mxEvent:e})=>{var t;const n=(0,o.useContext)(Fe.E),i=null==e||null===(t=e.getRelation())||void 0===t?void 0:t.rel_type,r=!!i&&i!==l.RelationType.Thread,s=t=>{t.preventDefault(),t.stopPropagation();const i=e.getThread();null!=i&&i.rootEvent&&!e.isThreadRoot?g.bA.dispatch({action:y.r.ShowThread,rootEvent:i.rootEvent,initialEvent:e,scroll_into_view:!0,highlighted:!0,push:n.isCard}):g.bA.dispatch({action:y.r.ShowThread,rootEvent:e,push:n.isCard})},a=r?(0,p._t)("threads|error_start_thread_existing_relation"):(0,p._t)("action|reply_in_thread");return o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_threadButton",disabled:r,title:a,onClick:s,onContextMenu:s,placement:"left"},o.createElement(ce,null))};class Je extends o.PureComponent{constructor(...e){super(...e),(0,r.A)(this,"onDecrypted",(()=>{this.forceUpdate()})),(0,r.A)(this,"onBeforeRedaction",(()=>{this.forceUpdate()})),(0,r.A)(this,"onRoomEvent",(e=>{e&&e.getType()===l.EventType.RoomPinnedEvents&&this.forceUpdate()})),(0,r.A)(this,"onSent",(()=>{this.forceUpdate()})),(0,r.A)(this,"onFocusChange",(e=>{var t,n;null===(t=(n=this.props).onFocusChange)||void 0===t||t.call(n,e)})),(0,r.A)(this,"onReplyClick",(e=>{e.preventDefault(),e.stopPropagation(),g.Ay.dispatch({action:"reply_to_event",event:this.props.mxEvent,context:this.context.timelineRenderingType})})),(0,r.A)(this,"onEditClick",(e=>{e.preventDefault(),e.stopPropagation(),(0,ke.ju)(C.J.safeGet(),this.props.mxEvent,this.context.timelineRenderingType,this.props.getRelationsForEvent)})),(0,r.A)(this,"forbiddenThreadHeadMsgType",[l.MsgType.KeyVerificationRequest]),(0,r.A)(this,"onResendClick",(e=>{e.preventDefault(),e.stopPropagation(),this.runActionOnFailedEv((e=>Te.A.resend(C.J.safeGet(),e)))})),(0,r.A)(this,"onCancelClick",(e=>{this.runActionOnFailedEv((e=>Te.A.removeFromQueue(C.J.safeGet(),e)),(e=>(0,ke.d1)(e.status)))})),(0,r.A)(this,"onPinClick",(async(e,t)=>{e.preventDefault(),e.stopPropagation(),await He.A.pinOrUnpinEvent(C.J.safeGet(),this.props.mxEvent),ze.A.trackPinUnpinMessage(t?"Pin":"Unpin","Timeline")}))}componentDidMount(){var e;this.props.mxEvent.status&&this.props.mxEvent.status!==l.EventStatus.SENT&&this.props.mxEvent.on(l.MatrixEventEvent.Status,this.onSent);C.J.safeGet().decryptEventIfNeeded(this.props.mxEvent),this.props.mxEvent.isBeingDecrypted()&&this.props.mxEvent.once(l.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.on(l.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),null===(e=this.context.room)||void 0===e||null===(e=e.getLiveTimeline().getState(l.EventTimeline.FORWARDS))||void 0===e||e.on(l.RoomStateEvent.Events,this.onRoomEvent)}componentWillUnmount(){var e;this.props.mxEvent.off(l.MatrixEventEvent.Status,this.onSent),this.props.mxEvent.off(l.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.off(l.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction),null===(e=this.context.room)||void 0===e||null===(e=e.getLiveTimeline().getState(l.EventTimeline.FORWARDS))||void 0===e||e.off(l.RoomStateEvent.Events,this.onRoomEvent)}get showReplyInThreadAction(){const e=this.context.timelineRenderingType!==S.Ae.Thread,t=!(this.forbiddenThreadHeadMsgType.includes(this.props.mxEvent.getContent().msgtype)||l.M_BEACON_INFO.matches(this.props.mxEvent.getType())||this.props.mxEvent.getType()===Ve.I$);return e&&t}runActionOnFailedEv(e,t){t||(t=()=>!0);const n=this.props.mxEvent,i=n.replacingEvent(),r=[n.localRedactionEvent(),i,n];for(const n of r)if(n&&t(n)){e(n);break}}render(){var e,t;const n=[];if((0,ke.wQ)(C.J.safeGet(),this.props.mxEvent)&&n.push(o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",title:(0,p._t)("action|edit"),onClick:this.onEditClick,onContextMenu:this.onEditClick,key:"edit",placement:"left"},o.createElement(Y,null))),He.A.canPin(C.J.safeGet(),this.props.mxEvent)||He.A.canUnpin(C.J.safeGet(),this.props.mxEvent)){const e=He.A.isPinned(C.J.safeGet(),this.props.mxEvent);n.push(o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",title:e?(0,p._t)("action|unpin"):(0,p._t)("action|pin"),onClick:t=>this.onPinClick(t,e),onContextMenu:t=>this.onPinClick(t,e),key:"pin",placement:"left"},e?o.createElement(K.I,null):o.createElement(W,null)))}const i=o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",title:(0,p._t)("action|delete"),onClick:this.onCancelClick,onContextMenu:this.onCancelClick,key:"cancel",placement:"left"},o.createElement(he,null)),r=o.createElement(Ke,{mxEvent:this.props.mxEvent,key:"reply_thread"}),s=this.props.mxEvent,c=null===(e=s.replacingEvent())||void 0===e?void 0:e.status,d=null===(t=s.localRedactionEvent())||void 0===t?void 0:t.status,u=(0,ke.d1)(s.status)||(0,ke.d1)(c)||(0,ke.d1)(d),m=[s.status,c,d].includes(l.EventStatus.NOT_SENT);if(u&&m)n.splice(0,0,o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",title:(0,p._t)("action|retry"),onClick:this.onResendClick,onContextMenu:this.onResendClick,key:"resend",placement:"left"},o.createElement(re,null))),n.push(i);else{if((0,ke.qe)(this.props.mxEvent)?(this.context.canSendMessages&&(this.showReplyInThreadAction&&n.splice(0,0,r),n.splice(0,0,o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",title:(0,p._t)("action|reply"),onClick:this.onReplyClick,onContextMenu:this.onReplyClick,key:"reply",placement:"left"},o.createElement(fe,null)))),this.context.canReact&&!this.context.search&&n.splice(0,0,o.createElement(Ge,{mxEvent:this.props.mxEvent,reactions:this.props.reactions,onFocusChange:this.onFocusChange,key:"react"})),Pe.j.isEligible(this.props.mxEvent)&&n.splice(0,0,o.createElement(Le,{mxEvent:this.props.mxEvent,mediaEventHelperGet:()=>{var e,t;return null===(e=this.props.getTile())||void 0===e||null===(t=e.getMediaHelper)||void 0===t?void 0:t.call(e)},key:"download"}))):this.context.timelineRenderingType===S.Ae.Room&&this.props.mxEvent.getThread()&&n.unshift(r),u&&n.push(i),void 0!==this.props.isQuoteExpanded&&(0,A.c$)(this.props.mxEvent)){const e=a()({mx_MessageActionBar_iconButton:!0,mx_MessageActionBar_expandCollapseMessageButton:!0});n.push(o.createElement(Ie.k,{className:e,title:this.props.isQuoteExpanded?(0,p._t)("timeline|mab|collapse_reply_chain"):(0,p._t)("timeline|mab|expand_reply_chain"),caption:(0,p._t)(Be.hm[je.Uz.SHIFT])+" + "+(0,p._t)("action|click"),onClick:this.props.toggleThreadExpanded,key:"expand",placement:"left"},this.props.isQuoteExpanded?o.createElement(Ce,null):o.createElement(we,null)))}n.push(o.createElement(We,{mxEvent:this.props.mxEvent,getReplyChain:this.props.getReplyChain,getTile:this.props.getTile,permalinkCreator:this.props.permalinkCreator,onFocusChange:this.onFocusChange,key:"menu",getRelationsForEvent:this.props.getRelationsForEvent}))}return o.createElement(Re.A,{className:"mx_MessageActionBar","aria-label":(0,p._t)("timeline|mab|label"),"aria-live":"off"},n)}}(0,r.A)(Je,"contextType",S.Ay);var qe=n("./node_modules/lodash/lodash.js"),$e=n("./node_modules/matrix-js-sdk/src/NamespacedValue.ts"),Ye=n("./node_modules/matrix-react-sdk/src/accessibility/context_menu/ContextMenuTooltipButton.tsx"),Qe=n("./node_modules/matrix-react-sdk/src/customisations/Media.ts"),Ze=n("./node_modules/matrix-react-sdk/src/HtmlUtils.tsx"),Xe=n("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx");class et extends o.PureComponent{render(){const{content:e,reactionEvents:t,mxEvent:n,children:i}=this.props,r=this.context.getRoom(n.getRoomId());if(r){const n=[];let a;for(const e of t){var s;const t=r.getMember(e.getSender()),i=null!==(s=null==t?void 0:t.name)&&void 0!==s?s:e.getSender();n.push(i),a=this.props.customReactionImagesEnabled&&nt.findIn(e.getContent())||void 0}const l=(0,Ze.aS)(e)||a,c=(0,f.ki)(n,6),d=l?(0,p._t)("timeline|reactions|tooltip_caption",{shortName:l}):void 0;return o.createElement(h.m_,{label:c,caption:d,placement:"right"},i)}return i}}(0,r.A)(et,"contextType",Xe.Ay);class tt extends o.PureComponent{constructor(...e){super(...e),(0,r.A)(this,"onClick",(()=>{const{mxEvent:e,myReactionEvent:t,content:n}=this.props;t?this.context.redactEvent(e.getRoomId(),t.getId()):(this.context.sendEvent(e.getRoomId(),l.EventType.Reaction,{"m.relates_to":{rel_type:l.RelationType.Annotation,event_id:e.getId(),key:n}}),g.Ay.dispatch({action:"message_sent"}))}))}render(){const{mxEvent:e,content:t,count:n,reactionEvents:i,myReactionEvent:r}=this.props,s=a()({mx_ReactionsRowButton:!0,mx_ReactionsRowButton_selected:!!r}),l=this.context.getRoom(e.getRoomId());let c,d;if(l){const e=[];for(const t of i){const n=l.getMember(t.getSender());e.push((null==n?void 0:n.name)||t.getSender()),d=this.props.customReactionImagesEnabled&&nt.findIn(t.getContent())||void 0}const n=(0,f.ki)(e,6);c=t?(0,p._t)("timeline|reactions|label",{reactors:n,content:d||t}):n}let u=o.createElement("span",{className:"mx_ReactionsRowButton_content","aria-hidden":"true"},t);if(this.props.customReactionImagesEnabled&&t.startsWith("mxc://")){const e=(0,Qe.lH)(t).srcHttp;e&&(u=o.createElement("img",{className:"mx_ReactionsRowButton_content",alt:d||(0,p._t)("timeline|reactions|custom_reaction_fallback_label"),src:e,width:"16",height:"16"}))}return o.createElement(et,{mxEvent:this.props.mxEvent,content:t,reactionEvents:i,customReactionImagesEnabled:this.props.customReactionImagesEnabled},o.createElement(x.A,{className:s,"aria-label":c,onClick:this.onClick,disabled:this.props.disabled},u,o.createElement("span",{className:"mx_ReactionsRowButton_count","aria-hidden":"true"},n)))}}(0,r.A)(tt,"contextType",Xe.Ay);const nt=new $e.qr("shortcode","com.beeper.reaction.shortcode"),it=({mxEvent:e,reactions:t})=>{const[n,r,s,l]=(0,M.EF)();let c;if(n&&r.current){const n=r.current.getBoundingClientRect();c=o.createElement(M.Ay,(0,i.A)({},(0,M.qv)(n),{onFinished:l,managed:!1}),o.createElement(Ue.A,{mxEvent:e,reactions:t,onFinished:l}))}return o.createElement(o.Fragment,null,o.createElement(Ye.o,{className:a()("mx_ReactionsRow_addReactionButton",{mx_ReactionsRow_addReactionButton_active:n}),title:(0,p._t)("timeline|reactions|add_reaction_prompt"),onClick:s,onContextMenu:e=>{e.preventDefault(),s()},isExpanded:n,ref:r}),c)};class rt extends o.PureComponent{constructor(e,t){super(e,t),(0,r.A)(this,"onDecrypted",(()=>{this.forceUpdate()})),(0,r.A)(this,"onReactionsChange",(()=>{this.setState({myReactions:this.getMyReactions()}),this.forceUpdate()})),(0,r.A)(this,"onShowAllClick",(()=>{this.setState({showAll:!0})})),this.state={myReactions:this.getMyReactions(),showAll:!1}}componentDidMount(){const{mxEvent:e,reactions:t}=this.props;(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&e.once(l.MatrixEventEvent.Decrypted,this.onDecrypted),t&&(t.on(l.RelationsEvent.Add,this.onReactionsChange),t.on(l.RelationsEvent.Remove,this.onReactionsChange),t.on(l.RelationsEvent.Redaction,this.onReactionsChange))}componentWillUnmount(){const{mxEvent:e,reactions:t}=this.props;e.off(l.MatrixEventEvent.Decrypted,this.onDecrypted),t&&(t.off(l.RelationsEvent.Add,this.onReactionsChange),t.off(l.RelationsEvent.Remove,this.onReactionsChange),t.off(l.RelationsEvent.Redaction,this.onReactionsChange))}componentDidUpdate(e){this.props.reactions&&e.reactions!==this.props.reactions&&(this.props.reactions.on(l.RelationsEvent.Add,this.onReactionsChange),this.props.reactions.on(l.RelationsEvent.Remove,this.onReactionsChange),this.props.reactions.on(l.RelationsEvent.Redaction,this.onReactionsChange),this.onReactionsChange())}getMyReactions(){var e,t;const n=this.props.reactions;if(!n)return null;const i=null===(e=this.context.room)||void 0===e?void 0:e.client.getUserId();if(!i)return null;const r=null===(t=n.getAnnotationsBySender())||void 0===t?void 0:t[i];return r?[...r.values()]:null}render(){var e,t;const{mxEvent:n,reactions:i}=this.props,{myReactions:r,showAll:s}=this.state;if(!i||!(0,ke.qe)(n))return null;const a=_.A.getValue("feature_render_reaction_images");let l,c,d=null===(e=i.getSortedAnnotationsByKey())||void 0===e?void 0:e.map((([e,t])=>{if(!t.size)return null;const i=(0,qe.uniqBy)([...t],(e=>e.getSender())),s=null==r?void 0:r.find((t=>{var n;return!t.isRedacted()&&(null===(n=t.getRelation())||void 0===n?void 0:n.key)===e}));return o.createElement(tt,{key:e,content:e,count:i.length,mxEvent:n,reactionEvents:i,myReactionEvent:s,customReactionImagesEnabled:a,disabled:!this.context.canReact||s&&!s.isRedacted()&&!this.context.canSelfRedact})})).filter((e=>!!e));return null!==(t=d)&&void 0!==t&&t.length?(d.length>9&&!s&&(d=d.slice(0,8),l=o.createElement(x.A,{kind:"link_inline",className:"mx_ReactionsRow_showAll",onClick:this.onShowAllClick},(0,p._t)("action|show_all"))),this.context.canReact&&(c=o.createElement(it,{mxEvent:n,reactions:i})),o.createElement("div",{className:"mx_ReactionsRow",role:"toolbar","aria-label":(0,p._t)("common|reactions")},d,l,c)):null}}(0,r.A)(rt,"contextType",S.Ay);var ot=n("./node_modules/matrix-react-sdk/src/utils/EventRenderingUtils.ts"),st=n("./node_modules/matrix-react-sdk/src/stores/room-list/MessagePreviewStore.ts"),at=n("./node_modules/matrix-react-sdk/src/utils/strings.ts"),lt=n("./node_modules/matrix-react-sdk/src/DecryptionFailureTracker.ts"),ct=n("./node_modules/matrix-react-sdk/src/components/views/messages/RedactedBody.tsx"),dt=n("./node_modules/matrix-react-sdk/src/SdkConfig.ts"),ut=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/BugReportDialog.tsx"),mt=n("./node_modules/matrix-react-sdk/src/components/structures/ViewSource.tsx");class ht extends o.Component{constructor(e){super(e),(0,r.A)(this,"onBugReport",(()=>{Me.Ay.createDialog(ut.A,{label:"react-soft-crash-tile",error:this.state.error})})),(0,r.A)(this,"onViewSource",(()=>{Me.Ay.createDialog(mt.A,{mxEvent:this.props.mxEvent},"mx_Dialog_viewsource")})),this.state={}}static getDerivedStateFromError(e){return{error:e}}render(){if(this.state.error){const{mxEvent:e}=this.props,t={mx_EventTile:!0,mx_EventTile_info:!0,mx_EventTile_content:!0,mx_EventTile_tileError:!0};let n,i;return dt.Ay.get().bug_report_endpoint_url&&(n=o.createElement(o.Fragment,null," ",o.createElement(x.A,{kind:"link",onClick:this.onBugReport},(0,p._t)("bug_reporting|submit_debug_logs")))),e&&_.A.getValue("developerMode")&&(i=o.createElement(o.Fragment,null," ",o.createElement(x.A,{onClick:this.onViewSource,kind:"link"},(0,p._t)("action|view_source")))),o.createElement("li",{className:a()(t),"data-layout":this.props.layout},o.createElement("div",{className:"mx_EventTile_line"},o.createElement("span",null,(0,p._t)("timeline|error_rendering_message"),e&&` (${e.getType()})`,n,i)))}return this.props.children}}var pt=n("./node_modules/matrix-react-sdk/src/events/EventTileFactory.tsx"),gt=n("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),vt=n("./node_modules/@vector-im/compound-design-tokens/icons/threads-solid.svg"),_t=n("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts"),ft=n("./node_modules/matrix-react-sdk/src/hooks/useAsyncMemo.ts"),yt=n("./node_modules/matrix-react-sdk/src/hooks/useUnreadNotifications.ts"),Et=n("./node_modules/matrix-react-sdk/src/utils/notifications.ts");const bt=["mxEvent","thread"],wt=({thread:e,showDisplayname:t=!1})=>{var n,i,r;const s=(0,o.useContext)(Xe.Ay),a=null!==(n=(0,_t.DY)(e,l.ThreadEvent.Update,(()=>e.replyToEvent)))&&void 0!==n?n:void 0,[c,d]=(0,o.useState)(null==a?void 0:a.getContent());(0,_t.YK)(a,l.MatrixEventEvent.Replaced,(()=>{d(a.getContent())}));const u=(null==a?void 0:a.shouldAttemptDecryption())||(null==a?void 0:a.isBeingDecrypted());(0,_t.YK)(u?a:void 0,l.MatrixEventEvent.Decrypted,(()=>{d(a.getContent())}));const m=(0,ft.e)((async()=>{if(a)return await s.decryptEventIfNeeded(a),st.X.instance.generatePreviewForEvent(a)}),[a,c]);return m&&a?o.createElement(o.Fragment,null,o.createElement(j.A,{member:a.sender,fallbackUserId:a.getSender(),size:"24px",className:"mx_ThreadSummary_avatar"}),t&&o.createElement("div",{className:"mx_ThreadSummary_sender"},null!==(i=null===(r=a.sender)||void 0===r?void 0:r.name)&&void 0!==i?i:a.getSender()),a.isDecryptionFailure()?o.createElement("div",{className:"mx_ThreadSummary_content mx_DecryptionFailureBody",title:(0,p._t)("timeline|decryption_failure|unable_to_decrypt")},o.createElement("span",{className:"mx_ThreadSummary_message-preview"},(0,p._t)("timeline|decryption_failure|unable_to_decrypt"))):o.createElement("div",{className:"mx_ThreadSummary_content",title:m},o.createElement("span",{className:"mx_ThreadSummary_message-preview"},m))):null},xt=e=>{let{mxEvent:t,thread:n}=e,r=(0,gt.A)(e,bt);const s=(0,o.useContext)(S.Ay),a=(0,o.useContext)(Fe.E),c=(0,_t.DY)(n,l.ThreadEvent.Update,(()=>n.length)),{level:d}=(0,yt.X)(n.room,n.id);if(!c)return null;let u=c;return s.narrow||(u=(0,p._t)("threads|count_of_reply",{count:c})),o.createElement(x.A,(0,i.A)({},r,{className:"mx_ThreadSummary",onClick:e=>{g.Ay.dispatch({action:y.r.ShowThread,rootEvent:t,push:a.isCard}),ze.A.trackInteraction("WebRoomTimelineThreadSummaryButton",e)},"aria-label":(0,p._t)("threads|open_thread")}),o.createElement(h.Np,{size:"24px",indicator:(0,Et.W7)(d)},o.createElement(vt.I,null)),o.createElement("span",{className:"mx_ThreadSummary_replies_amount"},u),o.createElement(wt,{thread:n,showDisplayname:!s.narrow}),o.createElement("div",{className:"mx_ThreadSummary_chevron"}))};var At=n("./node_modules/react-dom/index.js");class St extends o.Component{constructor(e){super(e),(0,r.A)(this,"nodes",{}),(0,r.A)(this,"children",{}),this.updateChildren(this.props.children)}componentDidUpdate(){this.updateChildren(this.props.children)}applyStyles(e,t){Object.entries(t).forEach((([t,n])=>{e.style[t]=n}))}updateChildren(e){const t=this.children||{};this.children={},o.Children.toArray(e).forEach((e=>{if(function(e){return"object"==typeof e&&"type"in e}(e))if(t[e.key]){const n=t[e.key],i=At.findDOMNode(this.nodes[n.key]);i&&i.style.left!==e.props.style.left&&this.applyStyles(i,{left:e.props.style.left}),this.children[e.key]=o.cloneElement(n,e.props,e.props.children)}else{const t={},n=e.props.style,i=this.props.startStyles;if(i.length>0){const e=i[0];t.style=e}t.ref=t=>this.collectNode(e.key,t,n),this.children[e.key]=o.cloneElement(e,t)}}))}collectNode(e,t,n){if(t&&void 0===this.nodes[e]&&this.props.startStyles.length>0){const e=this.props.startStyles,i=At.findDOMNode(t);for(let t=1;t<e.length;++t)this.applyStyles(i,e[t]);window.setTimeout((()=>{this.applyStyles(i,n)}),0)}this.nodes[e]=t,this.props.innerRef&&(this.props.innerRef.current=t)}render(){return o.createElement(o.Fragment,null,Object.values(this.children))}}(0,r.A)(St,"defaultProps",{startStyles:[]});var Ct=n("./node_modules/matrix-react-sdk/src/utils/units.ts");class kt extends o.PureComponent{constructor(e){super(e),(0,r.A)(this,"avatar",(0,o.createRef)()),this.state={suppressDisplay:!this.props.suppressAnimation}}componentWillUnmount(){const e=this.props.readReceiptPosition;e&&(this.props.checkUnmounting&&this.props.checkUnmounting()||this.buildReadReceiptInfo(e))}componentDidMount(){this.state.suppressDisplay&&this.animateMarker()}componentDidUpdate(e){const t=e.offset!==this.props.offset,n=e.hidden!==this.props.hidden;(t||n)&&this.animateMarker()}buildReadReceiptInfo(e={}){const t=this.avatar.current,n=null==t?void 0:t.offsetParent;if(!n||!n.getBoundingClientRect)return c.v.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no valid horizontalContainer`),e.top=0,e.right=0,e;const i=t.getBoundingClientRect();return e.top=i.top,e.right=i.right-n.getBoundingClientRect().right,e}animateMarker(){var e;const t=this.props.readReceiptPosition,n=null!==(e=this.buildReadReceiptInfo().top)&&void 0!==e?e:0,i=t&&void 0!==t.top?t.top:-It,r=[];null!=t&&t.right&&r.push({top:i-n,right:t.right}),r.push({top:i-n,right:0}),this.setState({suppressDisplay:!1,startStyles:r})}render(){var e;if(this.state.suppressDisplay)return o.createElement("div",{ref:this.avatar});const t={right:(0,Ct.c)(this.props.offset),top:"0px"};return o.createElement(St,{startStyles:this.state.startStyles,innerRef:this.avatar},o.createElement(j.A,{member:null!==(e=this.props.member)&&void 0!==e?e:null,fallbackUserId:this.props.fallbackUserId,"aria-hidden":"true","aria-live":"off",size:"14px",style:t,hideTitle:!0,tabIndex:-1}))}}var Rt=n("./node_modules/matrix-react-sdk/src/components/structures/AutoHideScrollbar.tsx");const It=16;function Tt({readReceipts:e,readReceiptMap:t,checkUnmounting:n,suppressAnimation:r,isTwelveHour:s}){const[a,l,c,d]=(0,M.EF)(),u=e.length>4?3:4,m=function(e,t){return(0,f.ki)(e,t)}(e.map((e=>{var t,n;return null!==(t=null===(n=e.roomMember)||void 0===n?void 0:n.name)&&void 0!==t?t:e.userId})),u);if(0===e.length)return o.createElement("div",{className:"mx_EventTile_msgOption"},o.createElement("div",{className:"mx_ReadReceiptGroup"},o.createElement("div",{className:"mx_ReadReceiptGroup_button"},o.createElement("span",{className:"mx_ReadReceiptGroup_container"}))));const g=e.map(((e,i)=>{const{hidden:a,position:l}=function(e,t){return e<t?{hidden:!1,position:e}:{hidden:!0,position:0}}(i,u),c=e.userId;let d;return t&&(d=t[c],d||(d={},t[c]=d)),o.createElement(kt,{key:c,member:e.roomMember,fallbackUserId:c,offset:10*l,hidden:a,readReceiptPosition:d,checkUnmounting:n,suppressAnimation:r,timestamp:e.ts,showTwelveHour:s})})).reverse();let v;const _=e.length-u;let y;if(_>0&&(v=o.createElement("span",{className:"mx_ReadReceiptGroup_remainder","aria-live":"off"},"+",_)),a&&l.current){const t=l.current.getBoundingClientRect();y=o.createElement(M.Ay,(0,i.A)({menuClassName:"mx_ReadReceiptGroup_popup",onFinished:d},(0,M.qv)(t)),o.createElement(Rt.A,null,o.createElement(Nt,{className:"mx_ReadReceiptGroup_title"},(0,p._t)("timeline|read_receipt_title",{count:e.length})),e.map((e=>o.createElement(Pt,(0,i.A)({key:e.userId},e,{isTwelveHour:s,onAfterClick:d}))))))}return o.createElement("div",{className:"mx_EventTile_msgOption"},o.createElement(h.m_,{label:(0,p._t)("timeline|read_receipt_title",{count:e.length}),caption:m,placement:"top-end"},o.createElement("div",{className:"mx_ReadReceiptGroup",role:"group","aria-label":(0,p._t)("timeline|read_receipts_label")},o.createElement(x.A,{className:"mx_ReadReceiptGroup_button",ref:l,"aria-label":m,"aria-haspopup":"true",onClick:c},v,o.createElement("span",{className:"mx_ReadReceiptGroup_container",style:{width:10*Math.min(u,e.length)+It-10}},g)),y)))}function Pt({userId:e,roomMember:t,ts:n,isTwelveHour:i,onAfterClick:r}){var s,a;return o.createElement(h.m_,{label:null!==(s=null==t?void 0:t.rawDisplayName)&&void 0!==s?s:e,caption:e,placement:"top"},o.createElement("div",null,o.createElement(M.Dr,{className:"mx_ReadReceiptGroup_person",onClick:()=>{g.Ay.dispatch({action:y.r.ViewUser,member:null!=t?t:{userId:e},push:!1}),null==r||r()}},o.createElement(j.A,{member:t,fallbackUserId:e,size:"24px","aria-hidden":"true","aria-live":"off",resizeMethod:"crop",hideTitle:!0}),o.createElement("div",{className:"mx_ReadReceiptGroup_name"},o.createElement("p",null,null!==(a=null==t?void 0:t.name)&&void 0!==a?a:e),o.createElement("p",{className:"mx_ReadReceiptGroup_secondary"},(0,T.Yq)(new Date(n),i))))))}function Nt({className:e,children:t}){const[n,,i]=(0,Ie.A9)();return o.createElement("h3",{className:e,role:"menuitem",onFocus:n,tabIndex:-1,ref:i},t)}var Dt,Mt=n("./node_modules/matrix-react-sdk/src/utils/localRoom/isLocalRoom.ts"),Ot=n("./node_modules/matrix-react-sdk/src/models/Call.ts"),Lt=n("./node_modules/matrix-react-sdk/src/components/views/rooms/NotificationBadge/StatelessNotificationBadge.tsx");function Ut({room:e,threadId:t,forceDot:n}){const{symbol:i,count:r,level:s}=(0,yt.X)(e,t);return o.createElement(Lt.V,{symbol:i,count:r,level:s,forceDot:n})}function Ft(){return Ft=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ft.apply(null,arguments)}var jt=function(e,t){return o.createElement("svg",Ft({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0,ref:t},e),Dt||(Dt=o.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeWidth:2,d:"m12.529 6.54.498-.498c1.378-1.378 3.599-1.391 4.96-.03 1.362 1.362 1.349 3.583-.03 4.96l-2.37 2.37c-1.377 1.378-3.598 1.391-4.96.03m.845 4.087-.5.499c-1.377 1.378-3.598 1.391-4.96.03-1.361-1.362-1.348-3.583.03-4.96l2.37-2.37c1.378-1.378 3.599-1.391 4.96-.03"})))},Bt=(0,o.forwardRef)(jt);var Vt;function Ht(){return Ht=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ht.apply(null,arguments)}var zt=function(e,t){return o.createElement("svg",Ht({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0,ref:t},e),Vt||(Vt=o.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M1 2.75A.75.75 0 0 1 1.75 2h.005a.75.75 0 0 1 0 1.5H1.75A.75.75 0 0 1 1 2.75m2.495 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.005a.75.75 0 0 1 0 1.5h-.005a.75.75 0 0 1-.75-.75M1 6.75A.75.75 0 0 1 1.75 6h8.5a.75.75 0 0 1 0 1.5h-8.5A.75.75 0 0 1 1 6.75m0 3A.75.75 0 0 1 1.75 9h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 1 9.75m0 4a.75.75 0 0 1 .75-.75h.005a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1-.75-.75m2.495 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.01a.75.75 0 0 1 0 1.5h-.01a.75.75 0 0 1-.75-.75m2.5 0a.75.75 0 0 1 .75-.75h.005a.75.75 0 0 1 0 1.5h-.005a.75.75 0 0 1-.75-.75",clipRule:"evenodd"})))},Wt=(0,o.forwardRef)(zt);function Gt({viewInRoom:e,copyLinkToThread:t}){return o.createElement(Re.A,{className:"mx_MessageActionBar","aria-label":(0,p._t)("timeline|mab|label"),"aria-live":"off"},o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",onClick:e,title:(0,p._t)("timeline|mab|view_in_room"),key:"view_in_room"},o.createElement(Wt,null)),o.createElement(Ie.k,{className:"mx_MessageActionBar_iconButton",onClick:t,title:(0,p._t)("timeline|mab|copy_link_thread"),key:"copy_link_to_thread"},o.createElement(Bt,null)))}var Kt=n("./node_modules/matrix-react-sdk/src/components/structures/grouper/LateEventGrouper.ts");function Jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $t(e){return!(!(0,pt.S8)(e)&&e.getType()!==l.EventType.RoomMessageEncrypted)}class Yt extends o.Component{constructor(e,t){super(e,t),(0,r.A)(this,"suppressReadReceiptAnimation",void 0),(0,r.A)(this,"isListeningForReceipts",void 0),(0,r.A)(this,"tile",(0,o.createRef)()),(0,r.A)(this,"replyChain",(0,o.createRef)()),(0,r.A)(this,"ref",(0,o.createRef)()),(0,r.A)(this,"unmounted",!1),(0,r.A)(this,"updateThread",(e=>{this.setState({thread:e})})),(0,r.A)(this,"onNewThread",(e=>{if(e.id===this.props.mxEvent.getId()){this.updateThread(e);const t=C.J.safeGet().getRoom(this.props.mxEvent.getRoomId());null==t||t.off(l.ThreadEvent.New,this.onNewThread)}})),(0,r.A)(this,"viewInRoom",(e=>{e.preventDefault(),e.stopPropagation(),g.Ay.dispatch({action:y.r.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:void 0})})),(0,r.A)(this,"copyLinkToThread",(async e=>{e.preventDefault(),e.stopPropagation();const{permalinkCreator:t,mxEvent:n}=this.props;if(!t)return;const i=t.forEvent(n.getId());await(0,at.nC)(i)})),(0,r.A)(this,"onRoomReceipt",((e,t)=>{t===C.J.safeGet().getRoom(this.props.mxEvent.getRoomId())&&(this.shouldShowSentReceipt||this.shouldShowSendingReceipt||this.isListeningForReceipts)&&this.forceUpdate((()=>{this.shouldShowSentReceipt||this.shouldShowSendingReceipt||(C.J.safeGet().removeListener(l.RoomEvent.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!1)}))})),(0,r.A)(this,"onDecrypted",(()=>{this.verifyEvent(),this.forceUpdate(this.props.onHeightChanged)})),(0,r.A)(this,"onDeviceVerificationChanged",((e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent()})),(0,r.A)(this,"onUserVerificationChanged",((e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent()})),(0,r.A)(this,"onReplaced",(()=>{this.verifyEvent()})),(0,r.A)(this,"onSenderProfileClick",(()=>{g.Ay.dispatch({action:y.r.ComposerInsert,userId:this.props.mxEvent.getSender(),timelineRenderingType:this.context.timelineRenderingType})})),(0,r.A)(this,"onPermalinkClicked",(e=>{e.preventDefault(),g.Ay.dispatch({action:y.r.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:this.context.timelineRenderingType===S.Ae.Search?"MessageSearch":void 0})})),(0,r.A)(this,"onActionBarFocusChange",(e=>{this.setState({actionBarFocused:e})})),(0,r.A)(this,"getTile",(()=>this.tile.current)),(0,r.A)(this,"getReplyChain",(()=>this.replyChain.current)),(0,r.A)(this,"getReactions",(()=>{var e;if(!this.props.showReactions||!this.props.getRelationsForEvent)return null;const t=this.props.mxEvent.getId();return null!==(e=this.props.getRelationsForEvent(t,"m.annotation","m.reaction"))&&void 0!==e?e:null})),(0,r.A)(this,"onReactionsCreated",((e,t)=>{"m.annotation"===e&&"m.reaction"===t&&this.setState({reactions:this.getReactions()})})),(0,r.A)(this,"onContextMenu",(e=>{this.showContextMenu(e)})),(0,r.A)(this,"onTimestampContextMenu",(e=>{var t;this.showContextMenu(e,null===(t=this.props.permalinkCreator)||void 0===t?void 0:t.forEvent(this.props.mxEvent.getId()))})),(0,r.A)(this,"onCloseMenu",(()=>{this.setState({contextMenu:void 0,actionBarFocused:!1})})),(0,r.A)(this,"setQuoteExpanded",(e=>{this.setState({isQuoteExpanded:e})}));const n=this.thread;this.state={actionBarFocused:!1,shieldColour:m.EventShieldColour.NONE,shieldReason:null,reactions:this.getReactions(),hover:!1,thread:n},this.suppressReadReceiptAnimation=!0,this.isListeningForReceipts=!1}get isEligibleForSpecialReceipt(){if(this.props.readReceipts&&this.props.readReceipts.length>0)return!1;if(!this.props.mxEvent)return!1;if(!C.J.safeGet().getRoom(this.props.mxEvent.getRoomId()))return!1;const e=C.J.safeGet().getSafeUserId();return this.props.mxEvent.getSender()===e&&$t(this.props.mxEvent)}get shouldShowSentReceipt(){if(!this.isEligibleForSpecialReceipt)return!1;if(!this.props.lastSuccessful)return!1;if(this.props.eventSendStatus&&this.props.eventSendStatus!==l.EventStatus.SENT)return!1;const e=this.props.readReceipts||[],t=C.J.safeGet().getUserId();return!e.some((e=>e.userId!==t))}get shouldShowSendingReceipt(){return!!this.isEligibleForSpecialReceipt&&!(!this.props.eventSendStatus||this.props.eventSendStatus===l.EventStatus.SENT)}componentDidMount(){this.suppressReadReceiptAnimation=!1;const e=C.J.safeGet();this.props.forExport||(e.on(u.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),e.on(u.cr.UserTrustStatusChanged,this.onUserVerificationChanged),this.props.mxEvent.on(l.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.on(l.MatrixEventEvent.Replaced,this.onReplaced),lt.o.instance.addVisibleEvent(this.props.mxEvent),this.props.showReactions&&this.props.mxEvent.on(l.MatrixEventEvent.RelationsCreated,this.onReactionsCreated),(this.shouldShowSentReceipt||this.shouldShowSendingReceipt)&&(e.on(l.RoomEvent.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!0)),this.props.mxEvent.on(l.ThreadEvent.Update,this.updateThread),e.decryptEventIfNeeded(this.props.mxEvent);const t=e.getRoom(this.props.mxEvent.getRoomId());null==t||t.on(l.ThreadEvent.New,this.onNewThread),this.verifyEvent()}shouldComponentUpdate(e,t){return!!(0,O.No)(this.state,t)||!this.propsEqual(this.props,e)}componentWillUnmount(){const e=C.J.get();if(e){e.removeListener(u.cr.DeviceVerificationChanged,this.onDeviceVerificationChanged),e.removeListener(u.cr.UserTrustStatusChanged,this.onUserVerificationChanged),e.removeListener(l.RoomEvent.Receipt,this.onRoomReceipt);const t=e.getRoom(this.props.mxEvent.getRoomId());null==t||t.off(l.ThreadEvent.New,this.onNewThread)}this.isListeningForReceipts=!1,this.props.mxEvent.removeListener(l.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.removeListener(l.MatrixEventEvent.Replaced,this.onReplaced),this.props.showReactions&&this.props.mxEvent.removeListener(l.MatrixEventEvent.RelationsCreated,this.onReactionsCreated),this.props.mxEvent.off(l.ThreadEvent.Update,this.updateThread),this.unmounted=!1}componentDidUpdate(e,t){t.shieldColour!==this.state.shieldColour&&this.props.onHeightChanged&&this.props.onHeightChanged(),this.isListeningForReceipts||!this.shouldShowSentReceipt&&!this.shouldShowSendingReceipt||(C.J.safeGet().on(l.RoomEvent.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!0),e.eventSendStatus!==this.props.eventSendStatus&&this.verifyEvent()}get thread(){var e;let t=this.props.mxEvent.getThread();if(!t){var n;const e=C.J.safeGet().getRoom(this.props.mxEvent.getRoomId());t=null!==(n=null==e?void 0:e.findThreadForEvent(this.props.mxEvent))&&void 0!==n?n:void 0}return null!==(e=t)&&void 0!==e?e:null}renderThreadPanelSummary(){return this.state.thread?o.createElement("div",{className:"mx_ThreadPanel_replies"},o.createElement("span",{className:"mx_ThreadPanel_replies_amount"},this.state.thread.length),o.createElement(wt,{thread:this.state.thread})):null}renderThreadInfo(){return this.state.thread&&this.state.thread.id===this.props.mxEvent.getId()?o.createElement(xt,{mxEvent:this.props.mxEvent,thread:this.state.thread}):this.context.timelineRenderingType===S.Ae.Search&&this.props.mxEvent.threadRootId?this.props.highlightLink?o.createElement("a",{className:"mx_ThreadSummary_icon",href:this.props.highlightLink},(0,p._t)("timeline|thread_info_basic")):o.createElement("p",{className:"mx_ThreadSummary_icon"},(0,p._t)("timeline|thread_info_basic")):void 0}verifyEvent(){this.doVerifyEvent().catch((e=>{const t=this.props.mxEvent;c.v.error(`Error getting encryption info on event ${t.getId()} in room ${t.getRoomId()}`,e)}))}async doVerifyEvent(){var e,t,n;const i=null!==(e=this.props.mxEvent.replacingEvent())&&void 0!==e?e:this.props.mxEvent;if(!i.isEncrypted()||i.isRedacted())return void this.setState({shieldColour:m.EventShieldColour.NONE,shieldReason:null});const r=null!==(t=await(null===(n=C.J.safeGet().getCrypto())||void 0===n?void 0:n.getEncryptionInfoForEvent(i)))&&void 0!==t?t:null;this.unmounted||(null!==r?this.setState({shieldColour:r.shieldColour,shieldReason:r.shieldReason}):this.setState({shieldColour:m.EventShieldColour.NONE,shieldReason:null}))}propsEqual(e,t){const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r))return!1;if("readReceipts"===r){const n=e[r],i=t[r];if(n===i)continue;if(!n||!i)return!1;if(n.length!==i.length)return!1;for(let e=0;e<n.length;e++){if(n[e].userId!==i[e].userId)return!1;if(n[e].roomMember!==i[e].roomMember)return!1}}else if(e[r]!==t[r])return!1}return!0}shouldHighlight(){if(this.props.forExport)return!1;if(this.context.timelineRenderingType===S.Ae.Notification)return!1;if(this.context.timelineRenderingType===S.Ae.ThreadsList)return!1;const e=C.J.safeGet(),t=e.getPushActionsForEvent(this.props.mxEvent.replacingEvent()||this.props.mxEvent),n=this.props.mxEvent.replacingEvent()?e.getPushActionsForEvent(this.props.mxEvent):void 0;return!!(null!=t&&t.tweaks||null!=n&&n.tweaks)&&(this.props.mxEvent.getSender()!==e.credentials.userId&&!!(null!=t&&t.tweaks.highlight||null!=n&&n.tweaks.highlight))}renderE2EPadlock(){var e;const t=null!==(e=this.props.mxEvent.replacingEvent())&&void 0!==e?e:this.props.mxEvent;if((0,Mt.F)(t.getRoomId()))return null;if(t.isDecryptionFailure())return o.createElement(Xt,null);if(this.state.shieldColour!==m.EventShieldColour.NONE){let e;switch(this.state.shieldReason){case null:case m.EventShieldReason.UNKNOWN:e=(0,p._t)("error|unknown");break;case m.EventShieldReason.UNVERIFIED_IDENTITY:e=(0,p._t)("encryption|event_shield_reason_unverified_identity");break;case m.EventShieldReason.UNSIGNED_DEVICE:e=(0,p._t)("encryption|event_shield_reason_unsigned_device");break;case m.EventShieldReason.UNKNOWN_DEVICE:e=(0,p._t)("encryption|event_shield_reason_unknown_device");break;case m.EventShieldReason.AUTHENTICITY_NOT_GUARANTEED:e=(0,p._t)("encryption|event_shield_reason_authenticity_not_guaranteed");break;case m.EventShieldReason.MISMATCHED_SENDER_KEY:e=(0,p._t)("encryption|event_shield_reason_mismatched_sender_key")}return this.state.shieldColour===m.EventShieldColour.GREY?o.createElement(tn,{icon:en.Normal,title:e}):o.createElement(tn,{icon:en.Warning,title:e})}if(C.J.safeGet().isRoomEncrypted(t.getRoomId())){if(t.status===l.EventStatus.ENCRYPTING)return null;if(t.status===l.EventStatus.NOT_SENT)return null;if(t.isState())return null;if(t.isRedacted())return null;if(!t.isEncrypted())return o.createElement(Zt,null)}return null}showContextMenu(e,t){var n;const i=e.target,r=i instanceof HTMLAnchorElement?i:i.closest("a");i instanceof HTMLImageElement||(null!==(n=F.A.get())&&void 0!==n&&n.allowOverridingNativeContextMenus()||!(0,at.j5)()&&!r)&&(this.props.editState||(e.preventDefault(),e.stopPropagation(),this.setState({contextMenu:{position:{left:e.clientX,top:e.clientY,bottom:e.clientY},link:(null==r?void 0:r.href)||t},actionBarFocused:!0})))}shouldHideEvent(){var e;return(null===(e=this.props.callEventGrouper)||void 0===e?void 0:e.hangupReason)===d.Il.Replaced}renderContextMenu(){if(!this.state.contextMenu)return null;const e=this.getTile(),t=this.getReplyChain(),n=null!=e&&e.getEventTileOps?e.getEventTileOps():void 0,r=null!=t&&t.canCollapse()?t.collapse:void 0;return o.createElement(D.A,(0,i.A)({},(0,M.ps)(this.state.contextMenu.position),{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator,eventTileOps:n,collapseReplyChain:r,onFinished:this.onCloseMenu,rightClick:!0,reactions:this.state.reactions,link:this.state.contextMenu.link,getRelationsForEvent:this.props.getRelationsForEvent}))}render(){var e,t,n;const i=this.props.mxEvent.getContent().msgtype,r=this.props.mxEvent.getType(),{hasRenderer:s,isBubbleMessage:d,isInfoMessage:u,isLeftAlignedBubbleMessage:m,noBubbleEvent:h,isSeeingThroughMessageHiddenForModeration:v}=(0,ot.v)(C.J.safeGet(),this.props.mxEvent,this.context.showHiddenEvents,this.shouldHideEvent()),{isQuoteExpanded:_}=this.state;if(!s){const{mxEvent:e}=this.props;return c.v.warn(`Event type not supported: type:${r} isState:${e.isState()}`),o.createElement("div",{className:"mx_EventTile mx_EventTile_info mx_MNoticeBody"},o.createElement("div",{className:"mx_EventTile_line"},(0,p._t)("timeline|error_no_renderer")))}const f=Pe.j.isEligible(this.props.mxEvent),E=a()("mx_EventTile_line",{mx_EventTile_mediaLine:f,mx_EventTile_image:this.props.mxEvent.getType()===l.EventType.RoomMessage&&this.props.mxEvent.getContent().msgtype===l.MsgType.Image,mx_EventTile_sticker:this.props.mxEvent.getType()===l.EventType.Sticker,mx_EventTile_emote:this.props.mxEvent.getType()===l.EventType.RoomMessage&&this.props.mxEvent.getContent().msgtype===l.MsgType.Emote}),b=["sending","queued","encrypting"].includes(this.props.eventSendStatus),w=(0,pt.S8)(this.props.mxEvent)&&this.props.isRedacted,x=this.props.mxEvent.isDecryptionFailure();let R=this.props.continuation;this.context.timelineRenderingType!==S.Ae.Room&&this.context.timelineRenderingType!==S.Ae.Search&&this.context.timelineRenderingType!==S.Ae.Thread&&this.props.layout!==I.P.Bubble&&(R=!1);const D=this.context.timelineRenderingType===S.Ae.Notification,M=!!this.props.editState,O=a()({mx_EventTile_bubbleContainer:d,mx_EventTile_leftAlignedBubble:m,mx_EventTile:!0,mx_EventTile_isEditing:M,mx_EventTile_info:u,mx_EventTile_12hr:this.props.isTwelveHour,mx_EventTile_sending:!M&&b,mx_EventTile_highlight:this.shouldHighlight(),mx_EventTile_selected:this.props.isSelectedEvent||this.state.contextMenu,mx_EventTile_continuation:R||r===l.EventType.CallInvite||Ot.Ho.CALL_EVENT_TYPE.matches(r),mx_EventTile_last:this.props.last,mx_EventTile_lastInSection:this.props.lastInSection,mx_EventTile_contextual:this.props.contextual,mx_EventTile_actionBarFocused:this.state.actionBarFocused,mx_EventTile_bad:x,mx_EventTile_emote:i===l.MsgType.Emote,mx_EventTile_noSender:this.props.hideSender,mx_EventTile_clamp:this.context.timelineRenderingType===S.Ae.ThreadsList||D,mx_EventTile_noBubble:h}),L=null!==this.props.eventSendStatus?"off":void 0;let U="#";this.props.permalinkCreator&&(U=this.props.permalinkCreator.forEvent(this.props.mxEvent.getId()));const F=this.props.mxEvent.status?void 0:this.props.mxEvent.getId();let H,z,W=null,G=null;if(D?(H="24px",z=!0):u?(H="14px",z=!1):this.context.timelineRenderingType===S.Ae.ThreadsList||this.context.timelineRenderingType===S.Ae.Thread&&!this.props.continuation?(H="32px",z=!0):r===l.EventType.RoomCreate||d?(H=null,z=!1):this.props.layout==I.P.IRC?(H="14px",z=!0):this.props.continuation&&this.context.timelineRenderingType!==S.Ae.File||r===l.EventType.CallInvite||Ot.Ho.CALL_EVENT_TYPE.matches(r)?(H=null,z=!1):(H="30px",z=!0),this.props.mxEvent.sender&&null!==H){let e=null;e=this.props.mxEvent.getContent().third_party_invite?this.props.mxEvent.target:this.props.mxEvent.sender;const t=!this.props.inhibitInteraction&&![S.Ae.ThreadsList,S.Ae.Notification].includes(this.context.timelineRenderingType);W=o.createElement("div",{className:"mx_EventTile_avatar"},o.createElement(j.A,{member:e,size:H,viewUserOnClick:t,forceHistorical:this.props.mxEvent.getType()===l.EventType.RoomMember}))}z&&!0!==this.props.hideSender&&(G=this.context.timelineRenderingType===S.Ae.Room||this.context.timelineRenderingType===S.Ae.Search||this.context.timelineRenderingType===S.Ae.Pinned||this.context.timelineRenderingType===S.Ae.Thread?o.createElement(B.A,{onClick:this.onSenderProfileClick,mxEvent:this.props.mxEvent}):this.context.timelineRenderingType===S.Ae.ThreadsList?o.createElement(B.A,{mxEvent:this.props.mxEvent,withTooltip:!0}):o.createElement(B.A,{mxEvent:this.props.mxEvent}));const K=!M&&!this.props.forExport?o.createElement(Je,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,permalinkCreator:this.props.permalinkCreator,getTile:this.getTile,getReplyChain:this.getReplyChain,onFocusChange:this.onActionBarFocusChange,isQuoteExpanded:_,toggleThreadExpanded:()=>this.setQuoteExpanded(!_),getRelationsForEvent:this.props.getRelationsForEvent}):void 0,J=this.props.mxEvent.getTs()&&!this.props.hideTimestamp&&(this.props.alwaysShowTimestamps||this.props.last||this.state.hover||this.state.actionBarFocused||Boolean(this.state.contextMenu));let q=this.context.timelineRenderingType!==S.Ae.ThreadsList?this.props.mxEvent.getTs():null===(e=this.state.thread)||void 0===e||null===(e=e.replyToEvent)||void 0===e?void 0:e.getTs();"number"!=typeof q&&(q=this.props.mxEvent.getTs());const $=o.createElement(V.A,{showRelative:this.context.timelineRenderingType===S.Ae.ThreadsList,showTwelveHour:this.props.isTwelveHour,ts:q,receivedTs:null===(t=(0,Kt.R)(this.props.mxEvent))||void 0===t?void 0:t.received_ts}),Y=J&&q?$:null;let Q;w||(Q=o.createElement(rt,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,key:"mx_EventTile_reactionsRow"}));const Z=this.props.hideTimestamp?null:o.createElement("a",{href:U,onClick:this.onPermalinkClicked,"aria-label":(0,T.fU)(new Date(this.props.mxEvent.getTs()),this.props.isTwelveHour),onContextMenu:this.onTimestampContextMenu},Y),X=this.props.layout===I.P.IRC,ee=X?null:Z,te=X?Z:null,ne=this.props.layout===I.P.Bubble?$:void 0,ie=!X&&!d&&this.renderE2EPadlock(),re=X&&!d&&this.renderE2EPadlock();let oe,se;if(this.shouldShowSentReceipt||this.shouldShowSendingReceipt)oe=o.createElement(nn,{messageState:this.props.mxEvent.getAssociatedStatus()});else if(this.props.showReadReceipts){var ae,le;oe=o.createElement(Tt,{readReceipts:null!==(ae=this.props.readReceipts)&&void 0!==ae?ae:[],readReceiptMap:null!==(le=this.props.readReceiptMap)&&void 0!==le?le:{},checkUnmounting:this.props.checkUnmounting,suppressAnimation:this.suppressReadReceiptAnimation,isTwelveHour:this.props.isTwelveHour})}(0,pt.bN)(this.props.mxEvent,C.J.safeGet(),this.context.showHiddenEvents)&&(0,A.c$)(this.props.mxEvent)&&(se=o.createElement(k,{parentEv:this.props.mxEvent,onHeightChanged:this.props.onHeightChanged,ref:this.replyChain,forExport:this.props.forExport,permalinkCreator:this.props.permalinkCreator,layout:this.props.layout,alwaysShowTimestamps:this.props.alwaysShowTimestamps||this.state.hover,isQuoteExpanded:_,setQuoteExpanded:this.setQuoteExpanded,getRelationsForEvent:this.props.getRelationsForEvent}));const ce=(null===(n=this.props.mxEvent)||void 0===n?void 0:n.getSender())===C.J.safeGet().getUserId();switch(this.context.timelineRenderingType){case S.Ae.Thread:return o.createElement(this.props.as||"li",{ref:this.ref,className:O,"aria-live":L,"aria-atomic":!0,"data-scroll-tokens":F,"data-has-reply":!!se,"data-layout":this.props.layout,"data-self":ce,"data-event-id":this.props.mxEvent.getId(),onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},[o.createElement("div",{className:"mx_EventTile_senderDetails",key:"mx_EventTile_senderDetails"},W,G),o.createElement("div",{className:E,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),se,(0,pt.rd)(S.Ae.Thread,qt(qt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:v,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:()=>this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents),K,o.createElement("a",{href:U,onClick:this.onPermalinkClicked},Y),oe),Q]);case S.Ae.Notification:case S.Ae.ThreadsList:{const e=C.J.safeGet().getRoom(this.props.mxEvent.getRoomId());return o.createElement(this.props.as||"li",{ref:this.ref,className:O,tabIndex:-1,"aria-live":L,"aria-atomic":"true","data-scroll-tokens":F,"data-layout":this.props.layout,"data-shape":this.context.timelineRenderingType,"data-self":ce,"data-has-reply":!!se,onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1}),onClick:e=>{var t;const n=e.currentTarget;let i=-1;switch(n.parentElement&&(i=Array.from(n.parentElement.children).indexOf(n)),this.context.timelineRenderingType){case S.Ae.Notification:this.viewInRoom(e);break;case S.Ae.ThreadsList:g.Ay.dispatch({action:y.r.ShowThread,rootEvent:this.props.mxEvent,push:!0}),ze.A.trackInteraction("WebThreadsPanelThreadItem",e,null!==(t=i)&&void 0!==t?t:-1)}}},o.createElement(o.Fragment,null,o.createElement("div",{className:"mx_EventTile_details"},G,D&&e?o.createElement("span",{className:"mx_EventTile_truncated"}," ",(0,p._t)("timeline|in_room_name",{room:e.name},{strong:e=>o.createElement("strong",null,e)})):"",Y,o.createElement(Ut,{room:e||void 0,threadId:this.props.mxEvent.getId(),forceDot:!0})),D&&e?o.createElement("div",{className:"mx_EventTile_avatar"},o.createElement(N.A,{room:e,size:"28px"})):W,o.createElement("div",{className:E,key:"mx_EventTile_line"},o.createElement("div",{className:"mx_EventTile_body"},this.props.mxEvent.isRedacted()?o.createElement(ct.A,{mxEvent:this.props.mxEvent}):this.props.mxEvent.isDecryptionFailure()?o.createElement(P.A,{mxEvent:this.props.mxEvent}):st.X.instance.generatePreviewForEvent(this.props.mxEvent)),this.renderThreadPanelSummary()),this.context.timelineRenderingType===S.Ae.ThreadsList&&o.createElement(Gt,{viewInRoom:this.viewInRoom,copyLinkToThread:this.copyLinkToThread}),oe))}case S.Ae.File:return o.createElement(this.props.as||"li",{className:O,"aria-live":L,"aria-atomic":!0,"data-scroll-tokens":F},[o.createElement("div",{className:E,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),(0,pt.rd)(S.Ae.File,qt(qt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:v,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents)),o.createElement("a",{className:"mx_EventTile_senderDetailsLink",key:"mx_EventTile_senderDetailsLink",href:U,onClick:this.onPermalinkClicked},o.createElement("div",{className:"mx_EventTile_senderDetails",onContextMenu:this.onTimestampContextMenu},G,Y))]);default:return o.createElement(this.props.as||"li",{ref:this.ref,className:O,tabIndex:-1,"aria-live":L,"aria-atomic":"true","data-scroll-tokens":F,"data-layout":this.props.layout,"data-self":ce,"data-event-id":this.props.mxEvent.getId(),"data-has-reply":!!se,onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},o.createElement(o.Fragment,null,te,G,re,W,o.createElement("div",{className:E,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),ee,ie,se,(0,pt.rd)(this.context.timelineRenderingType,qt(qt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:v,timestamp:ne,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents),K,this.props.layout===I.P.IRC&&o.createElement(o.Fragment,null,Q,this.renderThreadInfo())),this.props.layout!==I.P.IRC&&o.createElement(o.Fragment,null,Q,this.renderThreadInfo()),oe))}}}(0,r.A)(Yt,"defaultProps",{onHeightChanged:function(){},forExport:!1,layout:I.P.Group}),(0,r.A)(Yt,"contextType",S.Ay);const Qt=(0,o.forwardRef)(((e,t)=>{var n;return o.createElement(o.Fragment,null,o.createElement(ht,{mxEvent:e.mxEvent,layout:null!==(n=e.layout)&&void 0!==n?n:I.P.Group},o.createElement(Yt,(0,i.A)({ref:t},e))))}));function Zt(e){return o.createElement(tn,(0,i.A)({title:(0,p._t)("common|unencrypted"),icon:en.Warning},e))}function Xt(e){return o.createElement(tn,(0,i.A)({title:(0,p._t)("timeline|undecryptable_tooltip"),icon:en.DecryptionFailure},e))}var en=function(e){return e.Normal="normal",e.Warning="warning",e.DecryptionFailure="decryption_failure",e}(en||{});class tn extends o.Component{constructor(e){super(e),this.state={hover:!1}}render(){const e=`mx_EventTile_e2eIcon mx_EventTile_e2eIcon_${this.props.icon}`;return o.createElement(h.m_,{label:this.props.title,isTriggerInteractive:!0},o.createElement("div",{className:e,tabIndex:0}))}}function nn({messageState:e}){const t=!e||"sent"===e,n="not_sent"===e,i=a()({mx_EventTile_receiptSent:t,mx_EventTile_receiptSending:!t&&!n});let r;n&&(r=o.createElement(U.A,{notification:L.d.RED_EXCLAMATION}));let s=(0,p._t)("timeline|send_state_sending");return"encrypting"===e?s=(0,p._t)("timeline|send_state_encrypting"):t?s=(0,p._t)("timeline|send_state_sent"):n&&(s=(0,p._t)("timeline|send_state_failed")),o.createElement("div",{className:"mx_EventTile_msgOption"},o.createElement("div",{className:"mx_ReadReceiptGroup"},o.createElement(h.m_,{label:s,placement:"top-end"},o.createElement("div",{className:"mx_ReadReceiptGroup_button"},o.createElement("span",{className:"mx_ReadReceiptGroup_container"},o.createElement("span",{className:i},r))))))}},"./node_modules/matrix-react-sdk/src/components/views/rooms/ReplyTile.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>A});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/react/index.js"),o=n("./node_modules/classnames/index.js"),s=n.n(o),a=n("./node_modules/matrix-js-sdk/src/matrix.ts"),l=n("./node_modules/matrix-js-sdk/src/logger.ts"),c=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),d=n("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),u=n("./node_modules/matrix-react-sdk/src/dispatcher/actions.ts"),m=n("./node_modules/matrix-react-sdk/src/components/views/messages/SenderProfile.tsx"),h=n("./node_modules/matrix-react-sdk/src/components/views/messages/MImageBody.tsx");class p extends h.A{constructor(...e){super(...e),(0,i.A)(this,"onClick",(e=>{e.preventDefault()}))}wrapImage(e,t){return t}render(){if(this.state.error)return super.render();const e=this.props.mxEvent.getContent(),t=this.state.contentUrl?this.messageContent(this.state.contentUrl,this.state.thumbUrl,e,44):void 0;return r.createElement("div",{className:"mx_MImageReplyBody"},t)}}var g=n("./node_modules/matrix-react-sdk/src/utils/EventUtils.ts"),v=n("./node_modules/matrix-react-sdk/src/utils/EventRenderingUtils.ts"),_=n("./node_modules/matrix-react-sdk/src/components/views/messages/MFileBody.tsx"),f=n("./node_modules/matrix-react-sdk/src/components/views/avatars/MemberAvatar.tsx"),y=n("./node_modules/matrix-react-sdk/src/components/views/messages/MVoiceMessageBody.tsx"),E=n("./node_modules/matrix-react-sdk/src/events/EventTileFactory.tsx"),b=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class A extends r.PureComponent{constructor(...e){super(...e),(0,i.A)(this,"anchorElement",(0,r.createRef)()),(0,i.A)(this,"onDecrypted",(()=>{this.forceUpdate(),this.props.onHeightChanged&&this.props.onHeightChanged()})),(0,i.A)(this,"onEventRequiresUpdate",(()=>{this.forceUpdate()})),(0,i.A)(this,"onClick",(e=>{const t=e.target;"a"===t.tagName.toLowerCase()&&null!==t.closest("a")&&t!==this.anchorElement.current||(e.preventDefault(),this.props.toggleExpandedQuote&&e.shiftKey?this.props.toggleExpandedQuote():d.Ay.dispatch({action:u.r.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:void 0}))}))}componentDidMount(){this.props.mxEvent.on(a.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.on(a.MatrixEventEvent.BeforeRedaction,this.onEventRequiresUpdate),this.props.mxEvent.on(a.MatrixEventEvent.Replaced,this.onEventRequiresUpdate)}componentWillUnmount(){this.props.mxEvent.removeListener(a.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.removeListener(a.MatrixEventEvent.BeforeRedaction,this.onEventRequiresUpdate),this.props.mxEvent.removeListener(a.MatrixEventEvent.Replaced,this.onEventRequiresUpdate)}render(){const e=this.props.mxEvent,t=e.getContent().msgtype,n=e.getType(),{hasRenderer:i,isInfoMessage:o,isSeeingThroughMessageHiddenForModeration:d}=(0,v.v)(b.J.safeGet(),e,!1);if(!i){const{mxEvent:e}=this.props;return l.v.warn(`Event type not supported: type:${e.getType()} isState:${e.isState()}`),r.createElement("div",{className:"mx_ReplyTile mx_ReplyTile_info mx_MNoticeBody"},(0,c._t)("timeline|error_no_renderer"))}const u=s()("mx_ReplyTile",{mx_ReplyTile_inline:t===a.MsgType.Emote,mx_ReplyTile_info:o&&!e.isRedacted(),mx_ReplyTile_audio:t===a.MsgType.Audio,mx_ReplyTile_video:t===a.MsgType.Video});let h,w="#";this.props.permalinkCreator&&(w=this.props.permalinkCreator.forEvent(e.getId()));o||n===a.EventType.RoomCreate||(h=r.createElement("div",{className:"mx_ReplyTile_sender"},r.createElement(f.A,{member:e.sender,fallbackUserId:e.getSender(),size:"16px"}),r.createElement(m.A,{mxEvent:e})));const A={[a.MsgType.Image]:p,[a.MsgType.Audio]:(0,g.Mp)(e)?y.A:_.Ay,[a.MsgType.Video]:_.Ay},S={[a.EventType.Sticker]:p};return r.createElement("div",{className:u},r.createElement("a",{href:w,onClick:this.onClick,ref:this.anchorElement},h,(0,E.BP)(x(x({},this.props),{},{ref:void 0,showUrlPreview:!1,overrideBodyTypes:A,overrideEventTypes:S,maxImageHeight:96,isSeeingThroughMessageHiddenForModeration:d,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),!1)))}}(0,i.A)(A,"defaultProps",{onHeightChanged:()=>{}})},"./node_modules/matrix-react-sdk/src/components/views/rooms/RoomContextDetails.tsx":(e,t,n)=>{"use strict";n.d(t,{n:()=>h});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),o=n("./node_modules/react/index.js"),s=n("./node_modules/matrix-react-sdk/src/stores/spaces/SpaceStore.ts"),a=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),l=n("./node_modules/matrix-react-sdk/src/utils/DMRoomMap.ts"),c=n("./node_modules/matrix-react-sdk/src/utils/FormattingUtils.ts");const d=["room","component"];function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e){let{room:t,component:n}=e,i=(0,r.A)(e,d);const u=function(e){const t=l.A.shared().getUserIdForRoomId(e.roomId),n=e.getMembers().length>2;if(!e.isSpaceRoom()&&t&&!n)return{details:t};const[i,r,...o]=s.Ay.instance.getKnownParents(e.roomId);if(r&&(null==o||!o.length)){var d,u;const t=null===(d=e.client.getRoom(i))||void 0===d?void 0:d.name,n=null===(u=e.client.getRoom(r))||void 0===u?void 0:u.name;return{details:(0,c.ki)([null!=t?t:"",null!=n?n:""]),ariaLabel:(0,a._t)("in_space1_and_space2",{space1Name:t,space2Name:n})}}if(i){var m,h;const t=null!==(m=null===(h=e.client.getRoom(i))||void 0===h?void 0:h.name)&&void 0!==m?m:"",n=o.length;return n>0?{details:(0,c.ki)([t,...o],1),ariaLabel:(0,a._t)("in_space_and_n_other_spaces",{spaceName:t,count:n})}:{details:t,ariaLabel:(0,a._t)("in_space",{spaceName:t})}}return{details:e.getCanonicalAlias()}}(t);return u?o.createElement(null!=n?n:"div",m(m({},i),{},{"aria-label":u.ariaLabel}),[u.details]):o.createElement(o.Fragment,null)}},"./node_modules/matrix-react-sdk/src/components/views/settings/KeyboardShortcut.tsx":(e,t,n)=>{"use strict";n.d(t,{S:()=>l});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-react-sdk/src/accessibility/KeyboardShortcuts.ts"),o=n("./node_modules/matrix-react-sdk/src/Keyboard.ts"),s=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx");const a=({name:e,last:t})=>{const n=r.GA[e],o=r.hm[e];return i.createElement(i.Fragment,null,i.createElement("kbd",null," ",n||o&&(0,s._t)(o)||e," "),!t&&"+")},l=({value:e,className:t="mx_KeyboardShortcut"})=>{if(!e)return null;const n=[];return e.ctrlOrCmdKey?n.push(i.createElement(a,{key:"ctrlOrCmdKey",name:o.vL?o.Uz.META:o.Uz.CONTROL})):e.ctrlKey?n.push(i.createElement(a,{key:"ctrlKey",name:o.Uz.CONTROL})):e.metaKey&&n.push(i.createElement(a,{key:"metaKey",name:o.Uz.META})),e.altKey&&n.push(i.createElement(a,{key:"altKey",name:o.Uz.ALT})),e.shiftKey&&n.push(i.createElement(a,{key:"shiftKey",name:o.Uz.SHIFT})),i.createElement("div",{className:t},n,i.createElement(a,{name:e.key,last:!0}))}},"./node_modules/matrix-react-sdk/src/components/views/settings/devices/DeviceMetaData.tsx":(e,t,n)=>{"use strict";n.d(t,{e:()=>d});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-react-sdk/res/img/element-icons/settings/inactive.svg"),o=n("./node_modules/matrix-react-sdk/src/components/views/settings/devices/filter.ts"),s=n("./node_modules/matrix-react-sdk/src/DateUtils.ts"),a=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx");const l=(e,t=(new Date).getTime())=>{if(e+5184e5>=t){const t=new Date(e);return(0,s.Yq)(t)}return(0,s.fw)(new Date(e))},c=({value:e,id:t})=>e?i.createElement("span",null,e):null,d=({device:e})=>{const t=(e=>{if((0,o.Wf)(e)&&e.last_seen_ts)return{id:"inactive",value:i.createElement(i.Fragment,null,i.createElement(r.I,{className:"mx_DeviceTile_inactiveIcon"}),(0,a._t)("settings|sessions|inactive_days",{inactiveAgeDays:o.B1})+` (${l(e.last_seen_ts)})`)}})(e),n=e.last_seen_ts&&`${(0,a._t)("settings|sessions|last_activity")} ${l(e.last_seen_ts)}`,s=e.isVerified?(0,a._t)("common|verified"):(0,a._t)("common|unverified"),d=t?[t,{id:"lastSeenIp",value:e.last_seen_ip}]:[{id:"isVerified",value:s},{id:"lastActivity",value:n},{id:"lastSeenIp",value:e.last_seen_ip},{id:"deviceId",value:e.device_id}];return i.createElement(i.Fragment,null,d.map((({id:e,value:t},n)=>t?i.createElement(i.Fragment,{key:e},!!n&&" · ",i.createElement(c,{id:e,value:t})):null)))}},"./node_modules/matrix-react-sdk/src/components/views/settings/devices/filter.ts":(e,t,n)=>{"use strict";n.d(t,{B1:()=>o,Im:()=>l,Wf:()=>s});var i=n("./node_modules/matrix-react-sdk/src/components/views/settings/devices/types.ts");const r=7776e6,o=90,s=e=>!!e.last_seen_ts&&e.last_seen_ts<Date.now()-r,a={[i.e.Verified]:e=>!!e.isVerified,[i.e.Unverified]:e=>!e.isVerified,[i.e.Inactive]:s},l=(e,t)=>{const n=t.map((e=>a[e]));return n.length?e.filter((e=>n.every((t=>t(e))))):e}},"./node_modules/matrix-react-sdk/src/components/views/settings/devices/types.ts":(e,t,n)=>{"use strict";n.d(t,{e:()=>i});let i=function(e){return e.Verified="Verified",e.Unverified="Unverified",e.Inactive="Inactive",e.Unverifiable="Unverifiable",e}({})},"./node_modules/matrix-react-sdk/src/hooks/room/useTopic.ts":(e,t,n)=>{"use strict";n.d(t,{B:()=>a,e:()=>s});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-js-sdk/src/matrix.ts"),o=n("./node_modules/matrix-react-sdk/src/hooks/useEventEmitter.ts");const s=e=>{var t;const n=null==e||null===(t=e.currentState)||void 0===t||null===(t=t.getStateEvents(r.EventType.RoomTopic,""))||void 0===t?void 0:t.getContent();return n?r.ContentHelpers.parseTopicContent(n):null};function a(e){const[t,n]=(0,i.useState)(s(e));return(0,o.YK)(null==e?void 0:e.currentState,r.RoomStateEvent.Events,(t=>{t.getType()===r.EventType.RoomTopic&&n(s(e))})),(0,i.useEffect)((()=>{n(s(e))}),[e]),t}},"./node_modules/matrix-react-sdk/src/indexing/EventIndexPeg.ts":(e,t,n)=>{"use strict";n.d(t,{A:()=>g});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/matrix-js-sdk/src/logger.ts"),o=n("./node_modules/matrix-react-sdk/src/PlatformPeg.ts"),s=n("./node_modules/events/events.js"),a=n("./node_modules/matrix-js-sdk/src/matrix.ts"),l=n("./node_modules/matrix-js-sdk/src/types.ts"),c=n("./node_modules/matrix-js-sdk/src/utils.ts"),d=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),u=n("./node_modules/matrix-react-sdk/src/settings/SettingsStore.ts"),m=n("./node_modules/matrix-react-sdk/src/settings/SettingLevel.ts");class h extends s.EventEmitter{constructor(...e){super(...e),(0,i.A)(this,"crawlerCheckpoints",[]),(0,i.A)(this,"crawler",null),(0,i.A)(this,"currentCheckpoint",null),(0,i.A)(this,"onSync",(async(e,t,n)=>{var i;const r=null===(i=o.A.get())||void 0===i?void 0:i.getEventIndexingManager();if(r){if("PREPARED"===t&&"SYNCING"===e){return await r.isEventIndexEmpty()&&await this.addInitialCheckpoints(),void this.startCrawler()}"SYNCING"===t&&"SYNCING"===e&&await r.commitLiveEvents()}})),(0,i.A)(this,"onRoomTimeline",(async(e,t,n,i,r)=>{if(!t)return;const o=d.J.safeGet();return o.isRoomEncrypted(e.getRoomId())?e.isRedaction()?this.redactEvent(e):void(!n&&r&&r.liveEvent&&!e.isRedacted()&&(await o.decryptEventIfNeeded(e),await this.addLiveEventToIndex(e))):void 0})),(0,i.A)(this,"onRoomStateEvent",(async(e,t)=>{d.J.safeGet().isRoomEncrypted(t.roomId)&&(e.getType()!==a.EventType.RoomEncryption||await this.isRoomIndexed(t.roomId)||(r.v.log("EventIndex: Adding a checkpoint for a newly encrypted room",t.roomId),this.addRoomCheckpoint(t.roomId,!0)))})),(0,i.A)(this,"redactEvent",(async e=>{var t;const n=null===(t=o.A.get())||void 0===t?void 0:t.getEventIndexingManager();if(!n)return;const i=e.getAssociatedId();if(i)try{await n.deleteEvent(i)}catch(e){r.v.log("EventIndex: Error deleting event from index",e)}})),(0,i.A)(this,"onTimelineReset",(async e=>{e&&d.J.safeGet().isRoomEncrypted(e.roomId)&&(r.v.log("EventIndex: Adding a checkpoint because of a limited timeline",e.roomId),this.addRoomCheckpoint(e.roomId,!1))}))}async init(){var e;const t=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();t&&(this.crawlerCheckpoints=await t.loadCheckpoints(),r.v.log("EventIndex: Loaded checkpoints",this.crawlerCheckpoints),this.registerListeners())}registerListeners(){const e=d.J.safeGet();e.on(a.ClientEvent.Sync,this.onSync),e.on(a.RoomEvent.Timeline,this.onRoomTimeline),e.on(a.RoomEvent.TimelineReset,this.onTimelineReset),e.on(a.RoomStateEvent.Events,this.onRoomStateEvent)}removeListeners(){const e=d.J.get();null!==e&&(e.removeListener(a.ClientEvent.Sync,this.onSync),e.removeListener(a.RoomEvent.Timeline,this.onRoomTimeline),e.removeListener(a.RoomEvent.TimelineReset,this.onTimelineReset),e.removeListener(a.RoomStateEvent.Events,this.onRoomStateEvent))}async addInitialCheckpoints(){var e;const t=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();if(!t)return;const n=d.J.safeGet(),i=n.getRooms().filter((e=>n.isRoomEncrypted(e.roomId)));r.v.log("EventIndex: Adding initial crawler checkpoints"),await Promise.all(i.map((async e=>{const n=e.getLiveTimeline().getPaginationToken(a.Direction.Backward),i={roomId:e.roomId,token:n,direction:a.Direction.Backward,fullCrawl:!0},o={roomId:e.roomId,token:n,direction:a.Direction.Forward};try{i.token&&(await t.addCrawlerCheckpoint(i),this.crawlerCheckpoints.push(i)),o.token&&(await t.addCrawlerCheckpoint(o),this.crawlerCheckpoints.push(o))}catch(t){r.v.log("EventIndex: Error adding initial checkpoints for room",e.roomId,i,o,t)}})))}isValidEvent(e){const t=[a.EventType.RoomMessage,a.EventType.RoomName,a.EventType.RoomTopic].includes(e.getType())&&!e.isRedacted()&&!e.isDecryptionFailure();let n=!0,i=!0;if(e.getType()!==a.EventType.RoomMessage||e.isRedacted())e.getType()!==a.EventType.RoomTopic||e.isRedacted()?e.getType()!==a.EventType.RoomName||e.isRedacted()||e.getContent().name||(i=!1):e.getContent().topic||(i=!1);else{const t=e.getContent().msgtype;n=!!t&&!t.startsWith("m.key.verification"),e.getContent().body||(i=!1)}return t&&n&&i}eventToJson(e){const t=e.getEffectiveEvent();return e.isEncrypted()?(t.curve25519Key=e.getSenderKey(),t.ed25519Key=e.getClaimedEd25519Key(),t.algorithm=e.getWireContent().algorithm,t.forwardingCurve25519KeyChain=e.getForwardingCurve25519KeyChain()):(delete t.curve25519Key,delete t.ed25519Key,delete t.algorithm,delete t.forwardingCurve25519KeyChain),t}async addLiveEventToIndex(e){var t,n,i;const r=null===(t=o.A.get())||void 0===t?void 0:t.getEventIndexingManager();if(!r||!this.isValidEvent(e))return;const s=this.eventToJson(e),a={displayname:null===(n=e.sender)||void 0===n?void 0:n.rawDisplayName,avatar_url:null===(i=e.sender)||void 0===i?void 0:i.getMxcAvatarUrl()};await r.addEventToIndex(s,a)}emitNewCheckpoint(){this.emit("changedCheckpoint",this.currentRoom())}async addEventsFromLiveTimeline(e){const t=e.getEvents();for(let e=0;e<t.length;e++){const n=t[e];await this.addLiveEventToIndex(n)}}async addRoomCheckpoint(e,t=!1){var n;const i=null===(n=o.A.get())||void 0===n?void 0:n.getEventIndexingManager();if(!i)return;const s=d.J.safeGet().getRoom(e);if(!s)return;const l=s.getLiveTimeline(),c=l.getPaginationToken(a.Direction.Backward);if(!c)return void await this.addEventsFromLiveTimeline(l);const u={roomId:s.roomId,token:c,fullCrawl:t,direction:a.Direction.Backward};r.v.log("EventIndex: Adding checkpoint",u);try{await i.addCrawlerCheckpoint(u)}catch(e){r.v.log("EventIndex: Error adding new checkpoint for room",s.roomId,u,e)}this.crawlerCheckpoints.push(u)}async crawlerFunc(){var e;let t=!1;const n=d.J.safeGet(),i=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();if(!i)return;this.crawler={cancel:()=>{t=!0}};let s=!1;for(;!t;){let e=u.A.getValueAt(m.p.DEVICE,"crawlerSleepTime");if(e=Math.max(e,100),s&&(e=5e3),null!==this.currentCheckpoint&&(this.currentCheckpoint=null,this.emitNewCheckpoint()),await(0,c.yy)(e),t)break;const o=this.crawlerCheckpoints.shift();if(void 0===o){s=!0;continue}this.currentCheckpoint=o,this.emitNewCheckpoint(),s=!1;const d=n.getEventMapper({preventReEmit:!0});let h;try{h=await n.createMessagesRequest(o.roomId,o.token,100,o.direction)}catch(e){if(e instanceof a.HTTPError&&403===e.httpStatus){r.v.log("EventIndex: Removing checkpoint as we don't have ","permissions to fetch messages from this room.",o);try{await i.removeCrawlerCheckpoint(o)}catch(e){r.v.log("EventIndex: Error removing checkpoint",o,e)}continue}r.v.log("EventIndex: Error crawling using checkpoint:",o,",",e),this.crawlerCheckpoints.push(o);continue}if(t){this.crawlerCheckpoints.push(o);break}if(0===h.chunk.length){r.v.log("EventIndex: Done with the checkpoint",o);try{await i.removeCrawlerCheckpoint(o)}catch(e){r.v.log("EventIndex: Error removing checkpoint",o,e)}continue}const p=h.chunk.map(d);let g=[];void 0!==h.state&&(g=h.state.map(d));const v={};g.forEach((e=>{e.getContent().membership===l.O.Join&&(v[e.getSender()]={displayname:e.getContent().displayname,avatar_url:e.getContent().avatar_url})}));const _=p.filter((e=>e.isEncrypted())).map((e=>n.decryptEventIfNeeded(e,{emit:!1})));await Promise.all(_);const f=p.filter(this.isValidEvent),y=p.filter((e=>e.isRedaction())),E=f.map((e=>{const t=this.eventToJson(e);let n={};t.sender in v&&(n=v[t.sender]);return{event:t,profile:n}}));let b=null;h.end&&(b={roomId:o.roomId,token:h.end,fullCrawl:o.fullCrawl,direction:o.direction});try{for(let e=0;e<y.length;e++){const t=y[e],n=t.getAssociatedId();n?await i.deleteEvent(n):r.v.warn("EventIndex: Redaction event doesn't contain a valid associated event id",t)}const e=await i.addHistoricEvents(E,b,o);if(!b){r.v.log("EventIndex: The server didn't return a valid ","new checkpoint, not continuing the crawl.",o);continue}!0===e&&!0!==b.fullCrawl?(r.v.log("EventIndex: Checkpoint had already all events","added, stopping the crawl",o),await i.removeCrawlerCheckpoint(b)):(!0===e&&r.v.log("EventIndex: Checkpoint had already all events","added, but continuing due to a full crawl",o),this.crawlerCheckpoints.push(b))}catch(e){r.v.log("EventIndex: Error during a crawl",e),this.crawlerCheckpoints.push(o)}}this.crawler=null}startCrawler(){null===this.crawler&&this.crawlerFunc()}stopCrawler(){null!==this.crawler&&this.crawler.cancel()}async close(){var e;const t=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();this.removeListeners(),this.stopCrawler(),await(null==t?void 0:t.closeEventIndex())}async search(e){var t;const n=null===(t=o.A.get())||void 0===t?void 0:t.getEventIndexingManager();return null==n?void 0:n.searchEventIndex(e)}async loadFileEvents(e,t=10,n,i=a.EventTimeline.BACKWARDS){var s;const c=d.J.safeGet(),u=null===(s=o.A.get())||void 0===s?void 0:s.getEventIndexingManager();if(!u)return[];const m={roomId:e.roomId,limit:t};let h;n&&(m.fromEvent=n,m.direction=i);try{h=await u.loadFileEvents(m)}catch(e){return r.v.log("EventIndex: Error getting file events",e),[]}const p=c.getEventMapper();return h.map((t=>{const n=p(t.event),i=new a.RoomMember(e.roomId,n.getSender());i.name=t.profile.displayname+" ("+n.getSender()+")";const r=p({content:{membership:l.O.Join,avatar_url:t.profile.avatar_url,displayname:t.profile.displayname},type:a.EventType.RoomMember,event_id:n.getId()+":eventIndex",room_id:n.getRoomId(),sender:n.getSender(),origin_server_ts:n.getTs(),state_key:n.getSender()});return i.events.member=r,n.sender=i,n}))}async populateFileTimeline(e,t,n,i=10,o,s=a.EventTimeline.BACKWARDS){const l=await this.loadFileEvents(n,i,o,s);null===o&&(l.reverse(),s=s==a.EventTimeline.BACKWARDS?a.EventTimeline.FORWARDS:a.EventTimeline.BACKWARDS),l.forEach((n=>{e.eventIdToTimeline(n.getId())||e.addEventToTimeline(n,t,s==a.EventTimeline.BACKWARDS)}));let c=!1,d="";return l.length>0&&(d=l[l.length-1].getId(),c=!0),r.v.log("EventIndex: Populating file panel with",l.length,"events and setting the pagination token to",d),t.setPaginationToken(d,a.EventTimeline.BACKWARDS),c}paginateTimelineWindow(e,t,n,i){const r=t.getTimelineIndex(n);if(!r)return Promise.resolve(!1);if(r.pendingPaginate)return r.pendingPaginate;if(t.extend(n,i))return Promise.resolve(!0);const o=(async(e,t,n,i,r)=>{var o;const s=t.timeline,a=s.getTimelineSet(),l=null!==(o=s.getPaginationToken(i))&&void 0!==o?o:void 0,c=await this.populateFileTimeline(a,s,n,r,l,i);return t.pendingPaginate=void 0,e.extend(i,r),c})(t,r,e,n,i);return r.pendingPaginate=o,o}async getStats(){var e;const t=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();return null==t?void 0:t.getStats()}async isRoomIndexed(e){var t;const n=null===(t=o.A.get())||void 0===t?void 0:t.getEventIndexingManager();return null==n?void 0:n.isRoomIndexed(e)}currentRoom(){if(null===this.currentCheckpoint&&0===this.crawlerCheckpoints.length)return null;const e=d.J.safeGet();return null!==this.currentCheckpoint?e.getRoom(this.currentCheckpoint.roomId):e.getRoom(this.crawlerCheckpoints[0].roomId)}crawlingRooms(){const e=new Set,t=new Set;this.crawlerCheckpoints.forEach(((e,n)=>{t.add(e.roomId)})),null!==this.currentCheckpoint&&t.add(this.currentCheckpoint.roomId);const n=d.J.safeGet();return n.getRooms().filter((e=>n.isRoomEncrypted(e.roomId))).forEach(((t,n)=>{e.add(t.roomId)})),{crawlingRooms:t,totalRooms:e}}}class p{constructor(){(0,i.A)(this,"index",null),(0,i.A)(this,"error",void 0),(0,i.A)(this,"_supportIsInstalled",!1)}async init(){var e;const t=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();return t?(this._supportIsInstalled=await t.supportsEventIndexing(),this.supportIsInstalled()?u.A.getValueAt(m.p.DEVICE,"enableEventIndexing")?this.initEventIndex():(r.v.log("EventIndex: Event indexing is disabled, not initializing"),!1):(r.v.log("EventIndex: Event indexing isn't installed for the platform, not initializing."),!1)):(r.v.log("EventIndex: Platform doesn't support event indexing, not initializing."),!1)}async initEventIndex(){var e;const t=new h,n=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager(),i=d.J.get();if(!n||!i)throw new Error("Unable to init event index");const s=i.getUserId(),a=i.getDeviceId();try{await n.initEventIndex(s,a);const e=await n.getUserVersion(),i=await n.isEventIndexEmpty();i?await n.setUserVersion(1):0!==e||i||(await n.closeEventIndex(),await this.deleteEventIndex(),await n.initEventIndex(s,a),await n.setUserVersion(1)),r.v.log("EventIndex: Successfully initialized the event index"),await t.init()}catch(e){return r.v.log("EventIndex: Error initializing the event index",e),this.error=e,!1}return this.index=t,!0}platformHasSupport(){var e;return null!=(null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager())}supportIsInstalled(){return this._supportIsInstalled}get(){return this.index}start(){null!==this.index&&this.index.startCrawler()}stop(){null!==this.index&&this.index.stopCrawler()}async unset(){null!==this.index&&(await this.index.close(),this.index=null)}async deleteEventIndex(){var e;const t=null===(e=o.A.get())||void 0===e?void 0:e.getEventIndexingManager();t&&(await this.unset(),r.v.log("EventIndex: Deleting event index."),await t.deleteEventIndex())}}window.mxEventIndexPeg||(window.mxEventIndexPeg=new p);const g=window.mxEventIndexPeg},"./node_modules/matrix-react-sdk/src/stores/SetupEncryptionStore.ts":(e,t,n)=>{"use strict";n.d(t,{a:()=>_,s:()=>f});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/events/events.js"),o=n.n(r),s=n("./node_modules/matrix-js-sdk/src/crypto-api/index.ts"),a=n("./node_modules/matrix-js-sdk/src/logger.ts"),l=n("./node_modules/matrix-js-sdk/src/crypto/index.ts"),c=n("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),d=n("./node_modules/matrix-react-sdk/src/SecurityManager.ts"),u=n("./node_modules/matrix-react-sdk/src/Modal.tsx"),m=n("./node_modules/matrix-react-sdk/src/components/views/dialogs/InteractiveAuthDialog.tsx"),h=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),p=n("./node_modules/matrix-react-sdk/src/contexts/SDKContext.ts"),g=n("./node_modules/matrix-react-sdk/src/utils/arrays.ts"),v=n("./node_modules/matrix-react-sdk/src/utils/device/dehydration.ts");let _=function(e){return e[e.Loading=0]="Loading",e[e.Intro=1]="Intro",e[e.Busy=2]="Busy",e[e.Done=3]="Done",e[e.ConfirmSkip=4]="ConfirmSkip",e[e.Finished=5]="Finished",e[e.ConfirmReset=6]="ConfirmReset",e}({});class f extends(o()){constructor(...e){super(...e),(0,i.A)(this,"started",void 0),(0,i.A)(this,"phase",void 0),(0,i.A)(this,"verificationRequest",null),(0,i.A)(this,"backupInfo",null),(0,i.A)(this,"keyId",null),(0,i.A)(this,"keyInfo",null),(0,i.A)(this,"hasDevicesToVerifyAgainst",void 0),(0,i.A)(this,"onUserTrustStatusChanged",(async e=>{var t;if(e!==c.J.safeGet().getSafeUserId())return;await(null===(t=c.J.safeGet().getCrypto())||void 0===t?void 0:t.getCrossSigningKeyId())&&(this.phase=_.Done,this.emit("update"))})),(0,i.A)(this,"onVerificationRequest",(e=>{this.setActiveVerificationRequest(e)})),(0,i.A)(this,"onVerificationRequestChange",(async()=>{var e,t;if((null===(e=this.verificationRequest)||void 0===e?void 0:e.phase)===s.VerificationPhase.Cancelled)this.verificationRequest.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.verificationRequest=null,this.emit("update");else if((null===(t=this.verificationRequest)||void 0===t?void 0:t.phase)===s.VerificationPhase.Done){var n;this.verificationRequest.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.verificationRequest=null;const e=await(null===(n=c.J.safeGet().getCrypto())||void 0===n?void 0:n.getCrossSigningKeyId());this.phase=e?_.Done:_.Busy,this.emit("update")}}))}static sharedInstance(){return window.mxSetupEncryptionStore||(window.mxSetupEncryptionStore=new f),window.mxSetupEncryptionStore}start(){if(this.started)return;this.started=!0,this.phase=_.Loading;const e=c.J.safeGet();e.on(l.cr.VerificationRequestReceived,this.onVerificationRequest),e.on(l.cr.UserTrustStatusChanged,this.onUserTrustStatusChanged);const t=e.getCrypto().getVerificationRequestsToDeviceInProgress(e.getUserId());t.length&&this.setActiveVerificationRequest(t[t.length-1]),this.fetchKeyInfo()}stop(){var e;if(!this.started)return;this.started=!1,null===(e=this.verificationRequest)||void 0===e||e.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange);const t=c.J.get();t&&(t.removeListener(l.cr.VerificationRequestReceived,this.onVerificationRequest),t.removeListener(l.cr.UserTrustStatusChanged,this.onUserTrustStatusChanged))}async fetchKeyInfo(){var e,t;if(!this.started)return;const n=c.J.safeGet(),i=await n.secretStorage.isStored("m.cross_signing.master");null===i||0===Object.keys(i).length?(this.keyId=null,this.keyInfo=null):(this.keyId=Object.keys(i)[0],this.keyInfo=i[this.keyId]);const r=await n.getDehydratedDevice(),o=n.getUserId(),s=n.getCrypto(),a=null!==(e=null===(t=(await s.getUserDeviceInfo([o])).get(o))||void 0===t?void 0:t.values())&&void 0!==e?e:[];this.hasDevicesToVerifyAgainst=await(0,g.rm)(a,(async e=>{if(r&&e.deviceId==(null==r?void 0:r.device_id))return!1;if(e.dehydrated)return!1;if(!e.getIdentityKey())return!1;const t=await s.getDeviceVerificationStatus(o,e.deviceId);return!(null==t||!t.signedByOwner)})),this.phase=_.Intro,this.emit("update")}async usePassPhrase(){a.v.debug("SetupEncryptionStore.usePassphrase"),this.phase=_.Busy,this.emit("update");try{var e;const t=c.J.safeGet(),n=await t.getKeyBackupVersion();this.backupInfo=n,this.emit("update"),await new Promise(((e,i)=>{(0,d.cb)((async()=>{a.v.debug("SetupEncryptionStore.usePassphrase: cross-signing and secret storage set up; checking dehydration and backup in the background"),e(),await(0,v.b)(),n&&await t.restoreKeyBackupWithSecretStorage(n)})).catch(i)})),await(null===(e=t.getCrypto())||void 0===e?void 0:e.getCrossSigningKeyId())&&(a.v.debug("SetupEncryptionStore.usePassphrase: done"),this.phase=_.Done,this.emit("update"))}catch(e){e instanceof d.qQ?a.v.debug("SetupEncryptionStore.usePassphrase: user cancelled access to secret storage"):a.v.log("SetupEncryptionStore.usePassphrase: error",e),this.phase=_.Intro,this.emit("update")}}skip(){this.phase=_.ConfirmSkip,this.emit("update")}skipConfirm(){this.phase=_.Finished,this.emit("update")}returnAfterSkip(){this.phase=_.Intro,this.emit("update")}reset(){this.phase=_.ConfirmReset,this.emit("update")}async resetConfirm(){try{await(0,d.cb)((async()=>{var e;const t=c.J.safeGet();await(null===(e=t.getCrypto())||void 0===e?void 0:e.bootstrapCrossSigning({authUploadDeviceSigningKeys:async e=>{const n=p.M.instance.accountPasswordStore.getPassword();if(n)return void await e({type:"m.login.password",identifier:{type:"m.id.user",user:t.getSafeUserId()},user:t.getSafeUserId(),password:n});const{finished:i}=u.Ay.createDialog(m.A,{title:(0,h._t)("encryption|bootstrap_title"),matrixClient:t,makeRequest:e}),[r]=await i;if(!r)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:!0})),await(0,v.b)(!0),this.phase=_.Finished}),!0)}catch(e){a.v.error("Error resetting cross-signing",e),this.phase=_.Intro}this.emit("update")}returnAfterReset(){this.phase=_.Intro,this.emit("update")}done(){var e;this.phase=_.Finished,this.emit("update"),null===(e=c.J.safeGet().crypto)||void 0===e||e.cancelAndResendAllOutgoingKeyRequests()}async setActiveVerificationRequest(e){this.started&&e.otherUserId===c.J.safeGet().getUserId()&&(this.verificationRequest&&this.verificationRequest.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.verificationRequest=e,await e.accept(),e.on(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.emit("update"))}lostKeys(){return!this.hasDevicesToVerifyAgainst&&!this.keyInfo}}},"./node_modules/matrix-react-sdk/src/stores/ThreepidInviteStore.ts":(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var i=n("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("./node_modules/events/events.js"),o=n.n(r),s=n("./node_modules/rfc4648/lib/rfc4648.js"),a=n("./node_modules/buffer/index.js").hp;function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}const c="mx_threepid_invite_";class d extends(o()){static get instance(){return d._instance||(d._instance=new d),d._instance}storeInvite(e,t){const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({roomId:e},t),r=this.generateIdOf(n);return localStorage.setItem(`${c}${r}`,JSON.stringify(n)),this.translateInvite(n)}getWireInvites(){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(null!=n&&n.startsWith(c))try{e.push(JSON.parse(localStorage.getItem(n)))}catch(e){console.warn("Failed to parse 3pid invite",e)}}return e}getInvites(){return this.getWireInvites().map((e=>this.translateInvite(e)))}pickBestInvite(){return this.getInvites()[0]}resolveInvite(e){localStorage.removeItem(`${c}${e.id}`)}generateIdOf(e){return s.RG.stringify(a.from(JSON.stringify(e)))}translateInvite(e){return{id:this.generateIdOf(e),roomId:e.roomId,toEmail:e.email,signUrl:e.signurl,roomName:e.room_name,roomAvatarUrl:e.room_avatar_url,inviterName:e.inviter_name}}translateToWireFormat(e){return{email:e.toEmail,signurl:e.signUrl,room_name:e.roomName,room_avatar_url:e.roomAvatarUrl,inviter_name:e.inviterName}}}(0,i.A)(d,"_instance",void 0)},"./node_modules/matrix-react-sdk/src/utils/AutoDiscoveryUtils.tsx":(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var i=n("./node_modules/react/index.js"),r=n("./node_modules/matrix-js-sdk/src/matrix.ts"),o=n("./node_modules/matrix-js-sdk/src/logger.ts"),s=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),a=n("./node_modules/matrix-react-sdk/src/SdkConfig.ts");const l=[r.AutoDiscovery.ERROR_INVALID_HOMESERVER,r.AutoDiscovery.ERROR_INVALID_IDENTITY_SERVER],c=Object.values(r.AutoDiscoveryError),d=e=>c.includes(e),u=e=>{switch(e){case r.AutoDiscoveryError.GenericFailure:return(0,s.AO)("auth|autodiscovery_invalid");case r.AutoDiscoveryError.Invalid:return(0,s.AO)("auth|autodiscovery_generic_failure");case r.AutoDiscoveryError.InvalidHsBaseUrl:return(0,s.AO)("auth|autodiscovery_invalid_hs_base_url");case r.AutoDiscoveryError.InvalidHomeserver:return(0,s.AO)("auth|autodiscovery_invalid_hs");case r.AutoDiscoveryError.InvalidIsBaseUrl:return(0,s.AO)("auth|autodiscovery_invalid_is_base_url");case r.AutoDiscoveryError.InvalidIdentityServer:return(0,s.AO)("auth|autodiscovery_invalid_is");case r.AutoDiscoveryError.InvalidIs:return(0,s.AO)("auth|autodiscovery_invalid_is_response");case r.AutoDiscoveryError.MissingWellknown:return(0,s.AO)("auth|autodiscovery_no_well_known");case r.AutoDiscoveryError.InvalidJson:return(0,s.AO)("auth|autodiscovery_invalid_json");case r.AutoDiscoveryError.UnsupportedHomeserverSpecVersion:return(0,s.AO)("auth|autodiscovery_hs_incompatible")}};class m{static isLivelinessError(e){if(!e)return!1;let t=e;return e instanceof s.P7?t=e.cause:e instanceof Error&&(t=e.message),l.includes(t)}static authComponentStateForError(e,t="login"){if(!e)return{serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:null};let n=(0,s._t)("cannot_reach_homeserver"),o=(0,s._t)("cannot_reach_homeserver_detail");if(!m.isLivelinessError(e)){const e=a.Ay.get().brand;n=(0,s._t)("auth|misconfigured_title",{brand:e}),o=(0,s._t)("auth|misconfigured_body",{brand:e},{a:e=>i.createElement("a",{href:"https://github.com/vector-im/element-web/blob/master/docs/config.md",target:"_blank",rel:"noreferrer noopener"},e)})}let l=!0;return(e instanceof Error?e.message:e)===r.AutoDiscovery.ERROR_INVALID_IDENTITY_SERVER&&(l=!1,n=(0,s._t)("auth|failed_connect_identity_server"),o="register"===t?(0,s._t)("auth|failed_connect_identity_server_register"):"reset_password"===t?(0,s._t)("auth|failed_connect_identity_server_reset_password"):(0,s._t)("auth|failed_connect_identity_server_other")),{serverIsAlive:!1,serverErrorIsFatal:l,serverDeadError:i.createElement("div",null,i.createElement("strong",null,n),i.createElement("div",null,o))}}static async validateServerConfigWithStaticUrls(e,t,n=!1){if(!e)throw new s.P7("auth|no_hs_url_provided");const i={"m.homeserver":{base_url:e}};t&&(i["m.identity_server"]={base_url:t});const o=await r.AutoDiscovery.fromDiscoveryConfig(i),a=new URL(e).hostname;return m.buildValidatedConfigFromDiscovery(a,o,n,!0)}static async validateServerName(e){const t=await r.AutoDiscovery.findClientConfig(e);return m.buildValidatedConfigFromDiscovery(e,t)}static async buildValidatedConfigFromDiscovery(e,t,n=!1,i=!1){var l,c;if(null==t||!t["m.homeserver"])throw o.v.error("Ended up in a state of not knowing which homeserver to connect to."),new s.P7("auth|autodiscovery_unexpected_error_hs");const h=t["m.homeserver"],p=t["m.identity_server"],g=a.Ay.get("validated_server_config");let v=g&&g.isUrl;var _;if(p&&p.state===r.AutoDiscovery.SUCCESS)v=null!==(_=p.base_url)&&void 0!==_?_:void 0;else if(p&&p.state!==r.AutoDiscovery.PROMPT){if(o.v.error("Error determining preferred identity server URL:",p),p.state===r.AutoDiscovery.FAIL_ERROR){if(d(p.error))throw new s.P7(u(p.error),{cause:h.error});throw new s.P7("auth|autodiscovery_unexpected_error_is")}h.error=r.AutoDiscovery.ERROR_INVALID_IDENTITY_SERVER,p.base_url&&(v=p.base_url)}if(h.state!==r.AutoDiscovery.SUCCESS&&(o.v.error("Error processing homeserver config:",h),!n||!m.isLivelinessError(h.error))){if(d(h.error))throw new s.P7(u(h.error),{cause:h.error});throw new s.P7("auth|autodiscovery_unexpected_error_hs")}const f=h.base_url;if(!f)throw o.v.error("No homeserver URL configured"),new s.P7("auth|autodiscovery_unexpected_error_hs");let y=null!=e?e:h.server_name;const E=new URL(f);if(y||(y=E.hostname),!y)throw o.v.error("Failed to parse homeserver name from homeserver URL"),new s.P7("auth|autodiscovery_unexpected_error_hs");let b,w;try{const e=new r.MatrixClient({baseUrl:f}),{issuer:t}=await e.getAuthIssuer();b=await(0,r.discoverAndValidateOIDCIssuerWellKnown)(t)}catch(e){e instanceof r.MatrixError&&404===e.httpStatus&&"M_UNRECOGNIZED"===e.errcode||(w=e)}return{hsUrl:f,hsName:y,hsNameIsDifferent:E.hostname!==y,isUrl:v,isDefault:!1,warning:null!==(l=null!==(c=h.error)&&void 0!==c?c:w)&&void 0!==l?l:null,isNameResolvable:!i,delegatedAuthentication:b}}}},"./node_modules/matrix-react-sdk/src/utils/EventRenderingUtils.ts":(e,t,n)=>{"use strict";n.d(t,{v:()=>d});var i=n("./node_modules/matrix-js-sdk/src/matrix.ts"),r=n("./node_modules/matrix-react-sdk/src/settings/SettingsStore.ts"),o=n("./node_modules/matrix-react-sdk/src/events/EventTileFactory.tsx"),s=n("./node_modules/matrix-react-sdk/src/utils/EventUtils.ts"),a=n("./node_modules/matrix-react-sdk/src/models/Call.ts"),l=n("./node_modules/matrix-react-sdk/src/voice-broadcast/index.ts");const c=(e,t,n,r)=>!(n||r||e===i.EventType.RoomMessage||e===i.EventType.RoomMessageEncrypted||e===i.EventType.Sticker||e===i.EventType.RoomCreate||i.M_POLL_START.matches(e)||i.M_POLL_END.matches(e)||i.M_BEACON_INFO.matches(e)||e===l.I$&&(null==t?void 0:t.state)===l.HF.Started);function d(e,t,n,d){const u=t.getContent(),m=u.msgtype,h=t.getType();let p=!1;if(r.A.getValue("feature_msc3531_hide_messages_pending_moderation"))switch((0,s.$k)(t,e)){case s.H3.VISIBLE_FOR_ALL:case s.H3.HIDDEN_TO_CURRENT_USER:break;case s.H3.SEE_THROUGH_FOR_CURRENT_USER:p=!0}let g=(0,o.Sj)(t,e,n),v=h.startsWith("m.key.verification")||h===i.EventType.RoomMessage&&(null==m?void 0:m.startsWith("m.key.verification"))||h===i.EventType.RoomCreate||h===i.EventType.RoomEncryption||g===o.ur;const _=!v&&(h===i.EventType.CallInvite||a.Ho.CALL_EVENT_TYPE.matches(h));let f=c(h,u,v,_);const y=h===i.EventType.RoomMessage&&m===i.MsgType.Emote||i.M_POLL_START.matches(h)||i.M_BEACON_INFO.matches(h)||(0,s.wq)(t)||h===l.I$;return!d&&(0,o.bN)(t,e,n)||(g=(0,o.Sj)(t,e,n,!0),g===o.DD&&(v=!1,f=!0)),{hasRenderer:!!g,isInfoMessage:f,isBubbleMessage:v,isLeftAlignedBubbleMessage:_,noBubbleEvent:y,isSeeingThroughMessageHiddenForModeration:p}}},"./node_modules/matrix-react-sdk/src/utils/device/clientInformation.ts":(e,t,n)=>{"use strict";n.d(t,{BW:()=>a,Uh:()=>c,Zx:()=>o,eD:()=>s});const i="io.element.matrix_client_information.",r=e=>`${i}${e}`,o=async(e,t,n)=>{const i=e.getDeviceId(),{brand:o}=t,s=await(null==n?void 0:n.getAppVersion()),a=r(i),l=(()=>{if(window.electron)return;const e=new URL(window.location.href);return[e.host,e.pathname.replace(/\/$/,"")].join("")})();await e.setAccountData(a,{name:o,version:s,url:l})},s=(e,t)=>{Array.from(t.store.accountData.values()).forEach((n=>{if(!n.getType().startsWith(i))return;const[,r]=n.getType().split(i);r&&!e.includes(r)&&t.deleteAccountData(n.getType())}))},a=async e=>{const t=e.getDeviceId(),n=r(t),i=c(e,t);(i.name||i.version||i.url)&&await e.deleteAccountData(n)},l=e=>e&&"string"==typeof e?e:void 0,c=(e,t)=>{const n=e.getAccountData(r(t));if(!n)return{};const{name:i,version:o,url:s}=n.getContent();return{name:l(i),version:l(o),url:l(s)}}},"./node_modules/matrix-react-sdk/src/utils/device/isDeviceVerified.ts":(e,t,n)=>{"use strict";n.d(t,{z:()=>i});const i=async(e,t)=>{var n;const i=await(null===(n=e.getCrypto())||void 0===n?void 0:n.getDeviceVerificationStatus(e.getSafeUserId(),t));return i?i.crossSigningVerified:null}},"./node_modules/matrix-react-sdk/src/utils/oidc/authorize.ts":(e,t,n)=>{"use strict";n.d(t,{N:()=>a,Y:()=>l});var i=n("./node_modules/matrix-js-sdk/src/oidc/authorize.ts"),r=n("./node_modules/matrix-js-sdk/src/randomstring.ts"),o=n("./node_modules/matrix-react-sdk/src/utils/oidc/error.ts"),s=n("./node_modules/matrix-react-sdk/src/PlatformPeg.ts");const a=async(e,t,n,o,a)=>{var l;const c=s.A.get().getOidcCallbackUrl().href,d=(0,r.DU)(10),u=a?"create":void 0,m=await(0,i.R2)({metadata:e.metadata,redirectUri:c,clientId:t,homeserverUrl:n,identityServerUrl:o,nonce:d,prompt:u,urlState:null===(l=s.A.get())||void 0===l?void 0:l.getOidcClientState()});window.location.href=m},l=async e=>{const{code:t,state:n}=(e=>{const t=e.code,n=e.state;if(!t||"string"!=typeof t||!n||"string"!=typeof n)throw new Error(o.D.InvalidQueryParameters);return{code:t,state:n}})(e),{homeserverUrl:r,tokenResponse:s,idTokenClaims:a,identityServerUrl:l,oidcClientSettings:c}=await(0,i.SU)(t,n);return{homeserverUrl:r,identityServerUrl:l,accessToken:s.access_token,refreshToken:s.refresh_token,idToken:s.id_token,clientId:c.clientId,issuer:c.issuer,idTokenClaims:a}}},"./node_modules/matrix-react-sdk/src/utils/oidc/error.ts":(e,t,n)=>{"use strict";n.d(t,{D:()=>o,v:()=>s});var i=n("./node_modules/matrix-js-sdk/src/oidc/error.ts"),r=n("./node_modules/matrix-react-sdk/src/languageHandler.tsx");let o=function(e){return e.InvalidQueryParameters="Invalid query parameters for OIDC native login. `code` and `state` are required.",e}({});const s=e=>{switch(e.message){case i.u.MissingOrInvalidStoredState:return(0,r._t)("auth|oidc|missing_or_invalid_stored_state");case o.InvalidQueryParameters:case i.u.CodeExchangeFailed:case i.u.InvalidBearerTokenResponse:case i.u.InvalidIdToken:default:return(0,r._t)("auth|oidc|generic_auth_error")}}},"./node_modules/base64-arraybuffer/dist/base64-arraybuffer.umd.js":function(e,t){!function(e){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<t.length;i++)n[t.charCodeAt(i)]=i;var r=function(e){var n,i=new Uint8Array(e),r=i.length,o="";for(n=0;n<r;n+=3)o+=t[i[n]>>2],o+=t[(3&i[n])<<4|i[n+1]>>4],o+=t[(15&i[n+1])<<2|i[n+2]>>6],o+=t[63&i[n+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},o=function(e){var t,i,r,o,s,a=.75*e.length,l=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var d=new ArrayBuffer(a),u=new Uint8Array(d);for(t=0;t<l;t+=4)i=n[e.charCodeAt(t)],r=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],u[c++]=i<<2|r>>4,u[c++]=(15&r)<<4|o>>2,u[c++]=(3&o)<<6|63&s;return d};e.decode=o,e.encode=r,Object.defineProperty(e,"__esModule",{value:!0})}(t)},"./node_modules/css-box-model/dist/css-box-model.cjs.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=(i=n("./node_modules/tiny-invariant/dist/tiny-invariant.cjs.js"))&&"object"==typeof i&&"default"in i?i.default:i,o=function(e){var t=e.top,n=e.right,i=e.bottom,r=e.left;return{top:t,right:n,bottom:i,left:r,width:n-r,height:i-t,x:r,y:t,center:{x:(n+r)/2,y:(i+t)/2}}},s=function(e,t){return{top:e.top-t.top,left:e.left-t.left,bottom:e.bottom+t.bottom,right:e.right+t.right}},a=function(e,t){return{top:e.top+t.top,left:e.left+t.left,bottom:e.bottom-t.bottom,right:e.right-t.right}},l={top:0,right:0,bottom:0,left:0},c=function(e){var t=e.borderBox,n=e.margin,i=void 0===n?l:n,r=e.border,c=void 0===r?l:r,d=e.padding,u=void 0===d?l:d,m=o(s(t,i)),h=o(a(t,c)),p=o(a(h,u));return{marginBox:m,borderBox:o(t),paddingBox:h,contentBox:p,margin:i,border:c,padding:u}},d=function(e){var t=e.slice(0,-2);if("px"!==e.slice(-2))return 0;var n=Number(t);return isNaN(n)&&r(!1),n},u=function(e,t){var n,i,r=e.borderBox,o=e.border,s=e.margin,a=e.padding,l=(i=t,{top:(n=r).top+i.y,left:n.left+i.x,bottom:n.bottom+i.y,right:n.right+i.x});return c({borderBox:l,border:o,margin:s,padding:a})},m=function(e,t){var n={top:d(t.marginTop),right:d(t.marginRight),bottom:d(t.marginBottom),left:d(t.marginLeft)},i={top:d(t.paddingTop),right:d(t.paddingRight),bottom:d(t.paddingBottom),left:d(t.paddingLeft)},r={top:d(t.borderTopWidth),right:d(t.borderRightWidth),bottom:d(t.borderBottomWidth),left:d(t.borderLeftWidth)};return c({borderBox:e,margin:n,padding:i,border:r})};t.calculateBox=m,t.createBox=c,t.expand=s,t.getBox=function(e){var t=e.getBoundingClientRect(),n=window.getComputedStyle(e);return m(t,n)},t.getRect=o,t.offset=u,t.shrink=a,t.withScroll=function(e,t){return void 0===t&&(t={x:window.pageXOffset,y:window.pageYOffset}),u(e,t)}},"./node_modules/cuint/index.js":(e,t,n)=>{t.UINT32=n("./node_modules/cuint/lib/uint32.js"),t.UINT64=n("./node_modules/cuint/lib/uint64.js")},"./node_modules/cuint/lib/uint32.js":function(e,t){var n;!function(){i(Math.pow(36,5)),i(Math.pow(16,7)),i(Math.pow(10,9)),i(Math.pow(2,30)),i(36),i(16),i(10),i(2);function i(e,t){return this instanceof i?(this._low=0,this._high=0,this.remainder=null,void 0===t?o.call(this,e):"string"==typeof e?s.call(this,e,t):void r.call(this,e,t)):new i(e,t)}function r(e,t){return this._low=0|e,this._high=0|t,this}function o(e){return this._low=65535&e,this._high=e>>>16,this}function s(e,t){var n=parseInt(e,t||10);return this._low=65535&n,this._high=n>>>16,this}i.prototype.fromBits=r,i.prototype.fromNumber=o,i.prototype.fromString=s,i.prototype.toNumber=function(){return 65536*this._high+this._low},i.prototype.toString=function(e){return this.toNumber().toString(e||10)},i.prototype.add=function(e){var t=this._low+e._low,n=t>>>16;return n+=this._high+e._high,this._low=65535&t,this._high=65535&n,this},i.prototype.subtract=function(e){return this.add(e.clone().negate())},i.prototype.multiply=function(e){var t,n,i=this._high,r=this._low,o=e._high,s=e._low;return t=(n=r*s)>>>16,t+=i*s,t&=65535,t+=r*o,this._low=65535&n,this._high=65535&t,this},i.prototype.div=function(e){if(0==e._low&&0==e._high)throw Error("division by zero");if(0==e._high&&1==e._low)return this.remainder=new i(0),this;if(e.gt(this))return this.remainder=this.clone(),this._low=0,this._high=0,this;if(this.eq(e))return this.remainder=new i(0),this._low=1,this._high=0,this;for(var t=e.clone(),n=-1;!this.lt(t);)t.shiftLeft(1,!0),n++;for(this.remainder=this.clone(),this._low=0,this._high=0;n>=0;n--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),n>=16?this._high|=1<<n-16:this._low|=1<<n);return this},i.prototype.negate=function(){var e=1+(65535&~this._low);return this._low=65535&e,this._high=~this._high+(e>>>16)&65535,this},i.prototype.equals=i.prototype.eq=function(e){return this._low==e._low&&this._high==e._high},i.prototype.greaterThan=i.prototype.gt=function(e){return this._high>e._high||!(this._high<e._high)&&this._low>e._low},i.prototype.lessThan=i.prototype.lt=function(e){return this._high<e._high||!(this._high>e._high)&&this._low<e._low},i.prototype.or=function(e){return this._low|=e._low,this._high|=e._high,this},i.prototype.and=function(e){return this._low&=e._low,this._high&=e._high,this},i.prototype.not=function(){return this._low=65535&~this._low,this._high=65535&~this._high,this},i.prototype.xor=function(e){return this._low^=e._low,this._high^=e._high,this},i.prototype.shiftRight=i.prototype.shiftr=function(e){return e>16?(this._low=this._high>>e-16,this._high=0):16==e?(this._low=this._high,this._high=0):(this._low=this._low>>e|this._high<<16-e&65535,this._high>>=e),this},i.prototype.shiftLeft=i.prototype.shiftl=function(e,t){return e>16?(this._high=this._low<<e-16,this._low=0,t||(this._high&=65535)):16==e?(this._high=this._low,this._low=0):(this._high=this._high<<e|this._low>>16-e,this._low=this._low<<e&65535,t||(this._high&=65535)),this},i.prototype.rotateLeft=i.prototype.rotl=function(e){var t=this._high<<16|this._low;return t=t<<e|t>>>32-e,this._low=65535&t,this._high=t>>>16,this},i.prototype.rotateRight=i.prototype.rotr=function(e){var t=this._high<<16|this._low;return t=t>>>e|t<<32-e,this._low=65535&t,this._high=t>>>16,this},i.prototype.clone=function(){return new i(this._low,this._high)},void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}()},"./node_modules/cuint/lib/uint64.js":function(e,t){var n;!function(){var i={16:o(Math.pow(16,5)),10:o(Math.pow(10,5)),2:o(Math.pow(2,5))},r={16:o(16),10:o(10),2:o(2)};function o(e,t,n,i){return this instanceof o?(this.remainder=null,"string"==typeof e?l.call(this,e,t):void 0===t?a.call(this,e):void s.apply(this,arguments)):new o(e,t,n,i)}function s(e,t,n,i){return void 0===n?(this._a00=65535&e,this._a16=e>>>16,this._a32=65535&t,this._a48=t>>>16,this):(this._a00=0|e,this._a16=0|t,this._a32=0|n,this._a48=0|i,this)}function a(e){return this._a00=65535&e,this._a16=e>>>16,this._a32=0,this._a48=0,this}function l(e,t){t=t||10,this._a00=0,this._a16=0,this._a32=0,this._a48=0;for(var n=i[t]||new o(Math.pow(t,5)),r=0,s=e.length;r<s;r+=5){var a=Math.min(5,s-r),l=parseInt(e.slice(r,r+a),t);this.multiply(a<5?new o(Math.pow(t,a)):n).add(new o(l))}return this}o.prototype.fromBits=s,o.prototype.fromNumber=a,o.prototype.fromString=l,o.prototype.toNumber=function(){return 65536*this._a16+this._a00},o.prototype.toString=function(e){var t=r[e=e||10]||new o(e);if(!this.gt(t))return this.toNumber().toString(e);for(var n=this.clone(),i=new Array(64),s=63;s>=0&&(n.div(t),i[s]=n.remainder.toNumber().toString(e),n.gt(t));s--);return i[s-1]=n.toNumber().toString(e),i.join("")},o.prototype.add=function(e){var t=this._a00+e._a00,n=t>>>16,i=(n+=this._a16+e._a16)>>>16,r=(i+=this._a32+e._a32)>>>16;return r+=this._a48+e._a48,this._a00=65535&t,this._a16=65535&n,this._a32=65535&i,this._a48=65535&r,this},o.prototype.subtract=function(e){return this.add(e.clone().negate())},o.prototype.multiply=function(e){var t=this._a00,n=this._a16,i=this._a32,r=this._a48,o=e._a00,s=e._a16,a=e._a32,l=t*o,c=l>>>16,d=(c+=t*s)>>>16;c&=65535,d+=(c+=n*o)>>>16;var u=(d+=t*a)>>>16;return d&=65535,u+=(d+=n*s)>>>16,d&=65535,u+=(d+=i*o)>>>16,u+=t*e._a48,u&=65535,u+=n*a,u&=65535,u+=i*s,u&=65535,u+=r*o,this._a00=65535&l,this._a16=65535&c,this._a32=65535&d,this._a48=65535&u,this},o.prototype.div=function(e){if(0==e._a16&&0==e._a32&&0==e._a48){if(0==e._a00)throw Error("division by zero");if(1==e._a00)return this.remainder=new o(0),this}if(e.gt(this))return this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0,this;if(this.eq(e))return this.remainder=new o(0),this._a00=1,this._a16=0,this._a32=0,this._a48=0,this;for(var t=e.clone(),n=-1;!this.lt(t);)t.shiftLeft(1,!0),n++;for(this.remainder=this.clone(),this._a00=0,this._a16=0,this._a32=0,this._a48=0;n>=0;n--)t.shiftRight(1),this.remainder.lt(t)||(this.remainder.subtract(t),n>=48?this._a48|=1<<n-48:n>=32?this._a32|=1<<n-32:n>=16?this._a16|=1<<n-16:this._a00|=1<<n);return this},o.prototype.negate=function(){var e=1+(65535&~this._a00);return this._a00=65535&e,e=(65535&~this._a16)+(e>>>16),this._a16=65535&e,e=(65535&~this._a32)+(e>>>16),this._a32=65535&e,this._a48=~this._a48+(e>>>16)&65535,this},o.prototype.equals=o.prototype.eq=function(e){return this._a48==e._a48&&this._a00==e._a00&&this._a32==e._a32&&this._a16==e._a16},o.prototype.greaterThan=o.prototype.gt=function(e){return this._a48>e._a48||!(this._a48<e._a48)&&(this._a32>e._a32||!(this._a32<e._a32)&&(this._a16>e._a16||!(this._a16<e._a16)&&this._a00>e._a00))},o.prototype.lessThan=o.prototype.lt=function(e){return this._a48<e._a48||!(this._a48>e._a48)&&(this._a32<e._a32||!(this._a32>e._a32)&&(this._a16<e._a16||!(this._a16>e._a16)&&this._a00<e._a00))},o.prototype.or=function(e){return this._a00|=e._a00,this._a16|=e._a16,this._a32|=e._a32,this._a48|=e._a48,this},o.prototype.and=function(e){return this._a00&=e._a00,this._a16&=e._a16,this._a32&=e._a32,this._a48&=e._a48,this},o.prototype.xor=function(e){return this._a00^=e._a00,this._a16^=e._a16,this._a32^=e._a32,this._a48^=e._a48,this},o.prototype.not=function(){return this._a00=65535&~this._a00,this._a16=65535&~this._a16,this._a32=65535&~this._a32,this._a48=65535&~this._a48,this},o.prototype.shiftRight=o.prototype.shiftr=function(e){return(e%=64)>=48?(this._a00=this._a48>>e-48,this._a16=0,this._a32=0,this._a48=0):e>=32?(e-=32,this._a00=65535&(this._a32>>e|this._a48<<16-e),this._a16=this._a48>>e&65535,this._a32=0,this._a48=0):e>=16?(e-=16,this._a00=65535&(this._a16>>e|this._a32<<16-e),this._a16=65535&(this._a32>>e|this._a48<<16-e),this._a32=this._a48>>e&65535,this._a48=0):(this._a00=65535&(this._a00>>e|this._a16<<16-e),this._a16=65535&(this._a16>>e|this._a32<<16-e),this._a32=65535&(this._a32>>e|this._a48<<16-e),this._a48=this._a48>>e&65535),this},o.prototype.shiftLeft=o.prototype.shiftl=function(e,t){return(e%=64)>=48?(this._a48=this._a00<<e-48,this._a32=0,this._a16=0,this._a00=0):e>=32?(e-=32,this._a48=this._a16<<e|this._a00>>16-e,this._a32=this._a00<<e&65535,this._a16=0,this._a00=0):e>=16?(e-=16,this._a48=this._a32<<e|this._a16>>16-e,this._a32=65535&(this._a16<<e|this._a00>>16-e),this._a16=this._a00<<e&65535,this._a00=0):(this._a48=this._a48<<e|this._a32>>16-e,this._a32=65535&(this._a32<<e|this._a16>>16-e),this._a16=65535&(this._a16<<e|this._a00>>16-e),this._a00=this._a00<<e&65535),t||(this._a48&=65535),this},o.prototype.rotateLeft=o.prototype.rotl=function(e){if(0==(e%=64))return this;if(e>=32){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var n=this._a48<<16|this._a32,i=this._a16<<16|this._a00,r=n<<e|i>>>32-e,o=i<<e|n>>>32-e;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&r,this._a48=r>>>16,this},o.prototype.rotateRight=o.prototype.rotr=function(e){if(0==(e%=64))return this;if(e>=32){var t=this._a00;if(this._a00=this._a32,this._a32=t,t=this._a48,this._a48=this._a16,this._a16=t,32==e)return this;e-=32}var n=this._a48<<16|this._a32,i=this._a16<<16|this._a00,r=n>>>e|i<<32-e,o=i>>>e|n<<32-e;return this._a00=65535&o,this._a16=o>>>16,this._a32=65535&r,this._a48=r>>>16,this},o.prototype.clone=function(){return new o(this._a00,this._a16,this._a32,this._a48)},void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()},"./node_modules/matrix-react-sdk/res/img/stickerpack-placeholder.png":e=>{e.exports="img/stickerpack-placeholder.877b5d0.png"},"./node_modules/matrix-react-sdk/res/img/user-onboarding/CommunityMessaging.png":e=>{e.exports="img/user-onboarding/CommunityMessaging.0e6a083.png"},"./node_modules/matrix-react-sdk/res/img/user-onboarding/PersonalMessaging.png":e=>{e.exports="img/user-onboarding/PersonalMessaging.12f2bc3.png"},"./node_modules/matrix-react-sdk/res/img/user-onboarding/WorkMessaging.png":e=>{e.exports="img/user-onboarding/WorkMessaging.2643669.png"},"./node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js":(e,t,n)=>{"use strict";var i=n("./node_modules/react-is/index.js"),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return i.isMemo(e)?s:a[e.$$typeof]||r}a[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[i.Memo]=s;var c=Object.defineProperty,d=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,m=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,i){if("string"!=typeof n){if(p){var r=h(n);r&&r!==p&&e(t,r,i)}var s=d(n);u&&(s=s.concat(u(n)));for(var a=l(t),g=l(n),v=0;v<s.length;++v){var _=s[v];if(!(o[_]||i&&i[_]||g&&g[_]||a&&a[_])){var f=m(n,_);try{c(t,_,f)}catch(e){}}}}return t}},"./node_modules/raf-schd/dist/raf-schd.cjs.js":e=>{"use strict";e.exports=function(e){var t=[],n=null,i=function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];t=r,n||(n=requestAnimationFrame((function(){n=null,e.apply(void 0,t)})))};return i.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},i}},"./node_modules/react-beautiful-dnd/dist/react-beautiful-dnd.cjs.js":(e,t,n)=>{"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=n("./node_modules/react/index.js"),o=i(r),s=i(n("./node_modules/@babel/runtime/helpers/inheritsLoose.js")),a=i(n("./node_modules/@babel/runtime/helpers/extends.js")),l=n("./node_modules/redux/lib/redux.js"),c=n("./node_modules/react-redux/lib/index.js"),d=n("./node_modules/use-memo-one/dist/use-memo-one.cjs.js"),u=n("./node_modules/css-box-model/dist/css-box-model.cjs.js"),m=i(n("./node_modules/react-beautiful-dnd/node_modules/memoize-one/dist/memoize-one.cjs.js")),h=i(n("./node_modules/raf-schd/dist/raf-schd.cjs.js")),p=i(n("./node_modules/react-dom/index.js"));function g(e,t){}g.bind(null,"warn"),g.bind(null,"error");function v(){}function _(e,t,n){var i=t.map((function(t){var i=function(e,t){return a({},e,{},t)}(n,t.options);return e.addEventListener(t.eventName,t.fn,i),function(){e.removeEventListener(t.eventName,t.fn,i)}}));return function(){i.forEach((function(e){e()}))}}var f=!0,y="Invariant failed";function E(e){this.message=e}function b(e,t){if(!e)throw new E(f?y:y+": "+(t||""))}E.prototype.toString=function(){return this.message};var w=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).callbacks=null,t.unbind=v,t.onWindowError=function(e){var n=t.getCallbacks();n.isDragging()&&n.tryAbort(),e.error instanceof E&&e.preventDefault()},t.getCallbacks=function(){if(!t.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return t.callbacks},t.setCallbacks=function(e){t.callbacks=e},t}s(t,e);var n=t.prototype;return n.componentDidMount=function(){this.unbind=_(window,[{eventName:"error",fn:this.onWindowError}])},n.componentDidCatch=function(e){if(!(e instanceof E))throw e;this.setState({})},n.componentWillUnmount=function(){this.unbind()},n.render=function(){return this.props.children(this.setCallbacks)},t}(o.Component),x=function(e){return e+1},A=function(e,t){var n=e.droppableId===t.droppableId,i=x(e.index),r=x(t.index);return n?"\n      You have moved the item from position "+i+"\n      to position "+r+"\n    ":"\n    You have moved the item from position "+i+"\n    in list "+e.droppableId+"\n    to list "+t.droppableId+"\n    in position "+r+"\n  "},S=function(e,t,n){return t.droppableId===n.droppableId?"\n      The item "+e+"\n      has been combined with "+n.draggableId:"\n      The item "+e+"\n      in list "+t.droppableId+"\n      has been combined with "+n.draggableId+"\n      in list "+n.droppableId+"\n    "},C=function(e){return"\n  The item has returned to its starting position\n  of "+x(e.index)+"\n"},k="\n  Press space bar to start a drag.\n  When dragging you can use the arrow keys to move the item around and escape to cancel.\n  Some screen readers may require you to be in focus mode or to use your pass through key\n",R=function(e){return"\n  You have lifted an item in position "+x(e.source.index)+"\n"},I=function(e){var t=e.destination;if(t)return A(e.source,t);var n=e.combine;return n?S(e.draggableId,e.source,n):"You are over an area that cannot be dropped on"},T=function(e){if("CANCEL"===e.reason)return"\n      Movement cancelled.\n      "+C(e.source)+"\n    ";var t=e.destination,n=e.combine;return t?"\n      You have dropped the item.\n      "+A(e.source,t)+"\n    ":n?"\n      You have dropped the item.\n      "+S(e.draggableId,e.source,n)+"\n    ":"\n    The item has been dropped while not over a drop area.\n    "+C(e.source)+"\n  "},P={x:0,y:0},N=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},D=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},M=function(e,t){return e.x===t.x&&e.y===t.y},O=function(e){return{x:0!==e.x?-e.x:0,y:0!==e.y?-e.y:0}},L=function(e,t,n){var i;return void 0===n&&(n=0),(i={})[e]=t,i["x"===e?"y":"x"]=n,i},U=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},F=function(e,t){return Math.min.apply(Math,t.map((function(t){return U(e,t)})))},j=function(e){return function(t){return{x:e(t.x),y:e(t.y)}}},B=function(e,t){return{top:e.top+t.y,left:e.left+t.x,bottom:e.bottom+t.y,right:e.right+t.x}},V=function(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.bottom}]},H=function(e,t){return t&&t.shouldClipSubject?function(e,t){var n=u.getRect({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return n.width<=0||n.height<=0?null:n}(t.pageMarginBox,e):u.getRect(e)},z=function(e){var t=e.page,n=e.withPlaceholder,i=e.axis,r=e.frame,o=function(e,t){return t?B(e,t.scroll.diff.displacement):e}(t.marginBox,r),s=function(e,t,n){var i;return n&&n.increasedBy?a({},e,((i={})[t.end]=e[t.end]+n.increasedBy[t.line],i)):e}(o,i,n);return{page:t,withPlaceholder:n,active:H(s,r)}},W=function(e,t){e.frame||b(!1);var n=e.frame,i=D(t,n.scroll.initial),r=O(i),o=a({},n,{scroll:{initial:n.scroll.initial,current:t,diff:{value:i,displacement:r},max:n.scroll.max}}),s=z({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:o});return a({},e,{frame:o,subject:s})};function G(e){return Object.values?Object.values(e):Object.keys(e).map((function(t){return e[t]}))}function K(e,t){if(e.findIndex)return e.findIndex(t);for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function J(e,t){if(e.find)return e.find(t);var n=K(e,t);return-1!==n?e[n]:void 0}function q(e){return Array.prototype.slice.call(e)}var $=m((function(e){return e.reduce((function(e,t){return e[t.descriptor.id]=t,e}),{})})),Y=m((function(e){return e.reduce((function(e,t){return e[t.descriptor.id]=t,e}),{})})),Q=m((function(e){return G(e)})),Z=m((function(e){return G(e)})),X=m((function(e,t){var n=Z(t).filter((function(t){return e===t.descriptor.droppableId})).sort((function(e,t){return e.descriptor.index-t.descriptor.index}));return n}));function ee(e){return e.at&&"REORDER"===e.at.type?e.at.destination:null}function te(e){return e.at&&"COMBINE"===e.at.type?e.at.combine:null}var ne=m((function(e,t){return t.filter((function(t){return t.descriptor.id!==e.descriptor.id}))})),ie=function(e,t){return e.descriptor.droppableId===t.descriptor.id},re={point:P,value:0},oe={invisible:{},visible:{},all:[]},se={displaced:oe,displacedBy:re,at:null},ae=function(e,t){return function(n){return e<=n&&n<=t}},le=function(e){var t=ae(e.top,e.bottom),n=ae(e.left,e.right);return function(i){if(t(i.top)&&t(i.bottom)&&n(i.left)&&n(i.right))return!0;var r=t(i.top)||t(i.bottom),o=n(i.left)||n(i.right);if(r&&o)return!0;var s=i.top<e.top&&i.bottom>e.bottom,a=i.left<e.left&&i.right>e.right;return!(!s||!a)||(s&&o||a&&r)}},ce=function(e){var t=ae(e.top,e.bottom),n=ae(e.left,e.right);return function(e){return t(e.top)&&t(e.bottom)&&n(e.left)&&n(e.right)}},de={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},ue={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},me=function(e){var t=e.target,n=e.destination,i=e.viewport,r=e.withDroppableDisplacement,o=e.isVisibleThroughFrameFn,s=r?function(e,t){var n=t.frame?t.frame.scroll.diff.displacement:P;return B(e,n)}(t,n):t;return function(e,t,n){return!!t.subject.active&&n(t.subject.active)(e)}(s,n,o)&&function(e,t,n){return n(t)(e)}(s,i,o)},he=function(e){return me(a({},e,{isVisibleThroughFrameFn:le}))},pe=function(e){return me(a({},e,{isVisibleThroughFrameFn:ce}))},ge=function(e,t,n){if("boolean"==typeof n)return n;if(!t)return!0;var i=t.invisible,r=t.visible;if(i[e])return!1;var o=r[e];return!o||o.shouldAnimate};function ve(e){var t=e.afterDragging,n=e.destination,i=e.displacedBy,r=e.viewport,o=e.forceShouldAnimate,s=e.last;return t.reduce((function(e,t){var a=function(e,t){var n=e.page.marginBox,i={top:t.point.y,right:0,bottom:0,left:t.point.x};return u.getRect(u.expand(n,i))}(t,i),l=t.descriptor.id;if(e.all.push(l),!he({target:a,destination:n,viewport:r,withDroppableDisplacement:!0}))return e.invisible[t.descriptor.id]=!0,e;var c={draggableId:l,shouldAnimate:ge(l,s,o)};return e.visible[l]=c,e}),{all:[],visible:{},invisible:{}})}function _e(e){var t=e.insideDestination,n=e.inHomeList,i=e.displacedBy,r=e.destination,o=function(e,t){if(!e.length)return 0;var n=e[e.length-1].descriptor.index;return t.inHomeList?n:n+1}(t,{inHomeList:n});return{displaced:oe,displacedBy:i,at:{type:"REORDER",destination:{droppableId:r.descriptor.id,index:o}}}}function fe(e){var t=e.draggable,n=e.insideDestination,i=e.destination,r=e.viewport,o=e.displacedBy,s=e.last,a=e.index,l=e.forceShouldAnimate,c=ie(t,i);if(null==a)return _e({insideDestination:n,inHomeList:c,displacedBy:o,destination:i});var d=J(n,(function(e){return e.descriptor.index===a}));if(!d)return _e({insideDestination:n,inHomeList:c,displacedBy:o,destination:i});var u=ne(t,n),m=n.indexOf(d);return{displaced:ve({afterDragging:u.slice(m),destination:i,displacedBy:o,last:s,viewport:r.frame,forceShouldAnimate:l}),displacedBy:o,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:a}}}}function ye(e,t){return Boolean(t.effected[e])}var Ee=function(e){var t=e.isMovingForward,n=e.isInHomeList,i=e.draggable,r=e.draggables,o=e.destination,s=e.insideDestination,a=e.previousImpact,l=e.viewport,c=e.afterCritical,d=a.at;if(d||b(!1),"REORDER"===d.type){var u=function(e){var t=e.isMovingForward,n=e.isInHomeList,i=e.insideDestination,r=e.location;if(!i.length)return null;var o=r.index,s=t?o+1:o-1,a=i[0].descriptor.index,l=i[i.length-1].descriptor.index;return s<a||s>(n?l:l+1)?null:s}({isMovingForward:t,isInHomeList:n,location:d.destination,insideDestination:s});return null==u?null:fe({draggable:i,insideDestination:s,destination:o,viewport:l,last:a.displaced,displacedBy:a.displacedBy,index:u})}var m=function(e){var t=e.isMovingForward,n=e.destination,i=e.draggables,r=e.combine,o=e.afterCritical;if(!n.isCombineEnabled)return null;var s=r.draggableId,a=i[s].descriptor.index;return ye(s,o)?t?a:a-1:t?a+1:a}({isMovingForward:t,destination:o,displaced:a.displaced,draggables:r,combine:d.combine,afterCritical:c});return null==m?null:fe({draggable:i,insideDestination:s,destination:o,viewport:l,last:a.displaced,displacedBy:a.displacedBy,index:m})},be=function(e){var t=e.afterCritical,n=e.impact,i=e.draggables,r=te(n);r||b(!1);var o=r.draggableId,s=i[o].page.borderBox.center,a=function(e){var t=e.displaced,n=e.afterCritical,i=e.combineWith,r=e.displacedBy,o=Boolean(t.visible[i]||t.invisible[i]);return ye(i,n)?o?P:O(r.point):o?r.point:P}({displaced:n.displaced,afterCritical:t,combineWith:o,displacedBy:n.displacedBy});return N(s,a)},we=function(e,t){return t.margin[e.start]+t.borderBox[e.size]/2},xe=function(e,t,n){return t[e.crossAxisStart]+n.margin[e.crossAxisStart]+n.borderBox[e.crossAxisSize]/2},Ae=function(e){var t=e.axis,n=e.moveRelativeTo,i=e.isMoving;return L(t.line,n.marginBox[t.end]+we(t,i),xe(t,n.marginBox,i))},Se=function(e){var t=e.axis,n=e.moveRelativeTo,i=e.isMoving;return L(t.line,n.marginBox[t.start]-function(e,t){return t.margin[e.end]+t.borderBox[e.size]/2}(t,i),xe(t,n.marginBox,i))},Ce=function(e){var t=e.impact,n=e.draggable,i=e.draggables,r=e.droppable,o=e.afterCritical,s=X(r.descriptor.id,i),a=n.page,l=r.axis;if(!s.length)return function(e){var t=e.axis,n=e.moveInto,i=e.isMoving;return L(t.line,n.contentBox[t.start]+we(t,i),xe(t,n.contentBox,i))}({axis:l,moveInto:r.page,isMoving:a});var c=t.displaced,d=t.displacedBy,m=c.all[0];if(m){var h=i[m];if(ye(m,o))return Se({axis:l,moveRelativeTo:h.page,isMoving:a});var p=u.offset(h.page,d.point);return Se({axis:l,moveRelativeTo:p,isMoving:a})}var g=s[s.length-1];if(g.descriptor.id===n.descriptor.id)return a.borderBox.center;if(ye(g.descriptor.id,o)){var v=u.offset(g.page,O(o.displacedBy.point));return Ae({axis:l,moveRelativeTo:v,isMoving:a})}return Ae({axis:l,moveRelativeTo:g.page,isMoving:a})},ke=function(e,t){var n=e.frame;return n?N(t,n.scroll.diff.displacement):t},Re=function(e){var t=function(e){var t=e.impact,n=e.draggable,i=e.droppable,r=e.draggables,o=e.afterCritical,s=n.page.borderBox.center,a=t.at;return i&&a?"REORDER"===a.type?Ce({impact:t,draggable:n,draggables:r,droppable:i,afterCritical:o}):be({impact:t,draggables:r,afterCritical:o}):s}(e),n=e.droppable;return n?ke(n,t):t},Ie=function(e,t){var n=D(t,e.scroll.initial),i=O(n);return{frame:u.getRect({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:n,displacement:i}}}};function Te(e,t){return e.map((function(e){return t[e]}))}var Pe=function(e){var t=e.pageBorderBoxCenter,n=e.draggable,i=function(e,t){return N(e.scroll.diff.displacement,t)}(e.viewport,t),r=D(i,n.page.borderBox.center);return N(n.client.borderBox.center,r)},Ne=function(e){var t=e.draggable,n=e.destination,i=e.newPageBorderBoxCenter,r=e.viewport,o=e.withDroppableDisplacement,s=e.onlyOnMainAxis,l=void 0!==s&&s,c=D(i,t.page.borderBox.center),d={target:B(t.page.borderBox,c),destination:n,withDroppableDisplacement:o,viewport:r};return l?function(e){return me(a({},e,{isVisibleThroughFrameFn:(t=e.destination.axis,function(e){var n=ae(e.top,e.bottom),i=ae(e.left,e.right);return function(e){return t===de?n(e.top)&&n(e.bottom):i(e.left)&&i(e.right)}})}));var t}(d):pe(d)},De=function(e){var t=e.isMovingForward,n=e.draggable,i=e.destination,r=e.draggables,o=e.previousImpact,s=e.viewport,l=e.previousPageBorderBoxCenter,c=e.previousClientSelection,d=e.afterCritical;if(!i.isEnabled)return null;var u=X(i.descriptor.id,r),m=ie(n,i),h=function(e){var t=e.isMovingForward,n=e.draggable,i=e.destination,r=e.insideDestination,o=e.previousImpact;if(!i.isCombineEnabled)return null;if(!ee(o))return null;function s(e){var t={type:"COMBINE",combine:{draggableId:e,droppableId:i.descriptor.id}};return a({},o,{at:t})}var l=o.displaced.all,c=l.length?l[0]:null;if(t)return c?s(c):null;var d=ne(n,r);if(!c)return d.length?s(d[d.length-1].descriptor.id):null;var u=K(d,(function(e){return e.descriptor.id===c}));-1===u&&b(!1);var m=u-1;return m<0?null:s(d[m].descriptor.id)}({isMovingForward:t,draggable:n,destination:i,insideDestination:u,previousImpact:o})||Ee({isMovingForward:t,isInHomeList:m,draggable:n,draggables:r,destination:i,insideDestination:u,previousImpact:o,viewport:s,afterCritical:d});if(!h)return null;var p=Re({impact:h,draggable:n,droppable:i,draggables:r,afterCritical:d});if(Ne({draggable:n,destination:i,newPageBorderBoxCenter:p,viewport:s.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:Pe({pageBorderBoxCenter:p,draggable:n,viewport:s}),impact:h,scrollJumpRequest:null};var g=D(p,l),v=function(e){var t=e.impact,n=e.viewport,i=e.destination,r=e.draggables,o=e.maxScrollChange,s=Ie(n,N(n.scroll.current,o)),l=i.frame?W(i,N(i.frame.scroll.current,o)):i,c=t.displaced,d=ve({afterDragging:Te(c.all,r),destination:i,displacedBy:t.displacedBy,viewport:s.frame,last:c,forceShouldAnimate:!1}),u=ve({afterDragging:Te(c.all,r),destination:l,displacedBy:t.displacedBy,viewport:n.frame,last:c,forceShouldAnimate:!1}),m={},h={},p=[c,d,u];return c.all.forEach((function(e){var t=function(e,t){for(var n=0;n<t.length;n++){var i=t[n].visible[e];if(i)return i}return null}(e,p);t?h[e]=t:m[e]=!0})),a({},t,{displaced:{all:c.all,invisible:m,visible:h}})}({impact:h,viewport:s,destination:i,draggables:r,maxScrollChange:g});return{clientSelection:c,impact:v,scrollJumpRequest:g}},Me=function(e){var t=e.subject.active;return t||b(!1),t},Oe=function(e,t){var n=e.page.borderBox.center;return ye(e.descriptor.id,t)?D(n,t.displacedBy.point):n},Le=function(e,t){var n=e.page.borderBox;return ye(e.descriptor.id,t)?B(n,O(t.displacedBy.point)):n},Ue=m((function(e,t){var n=t[e.line];return{value:n,point:L(e.line,n)}})),Fe=function(e,t){return a({},e,{scroll:a({},e.scroll,{max:t})})},je=function(e,t,n){var i=e.frame;ie(t,e)&&b(!1),e.subject.withPlaceholder&&b(!1);var r=Ue(e.axis,t.displaceBy).point,o=function(e,t,n){var i=e.axis;if("virtual"===e.descriptor.mode)return L(i.line,t[i.line]);var r=e.subject.page.contentBox[i.size],o=X(e.descriptor.id,n).reduce((function(e,t){return e+t.client.marginBox[i.size]}),0)+t[i.line]-r;return o<=0?null:L(i.line,o)}(e,r,n),s={placeholderSize:r,increasedBy:o,oldFrameMaxScroll:e.frame?e.frame.scroll.max:null};if(!i){var l=z({page:e.subject.page,withPlaceholder:s,axis:e.axis,frame:e.frame});return a({},e,{subject:l})}var c=o?N(i.scroll.max,o):i.scroll.max,d=Fe(i,c),u=z({page:e.subject.page,withPlaceholder:s,axis:e.axis,frame:d});return a({},e,{subject:u,frame:d})},Be=function(e){var t=e.isMovingForward,n=e.previousPageBorderBoxCenter,i=e.draggable,r=e.isOver,o=e.draggables,s=e.droppables,a=e.viewport,l=e.afterCritical,c=function(e){var t=e.isMovingForward,n=e.pageBorderBoxCenter,i=e.source,r=e.droppables,o=e.viewport,s=i.subject.active;if(!s)return null;var a=i.axis,l=ae(s[a.start],s[a.end]),c=Q(r).filter((function(e){return e!==i})).filter((function(e){return e.isEnabled})).filter((function(e){return Boolean(e.subject.active)})).filter((function(e){return le(o.frame)(Me(e))})).filter((function(e){var n=Me(e);return t?s[a.crossAxisEnd]<n[a.crossAxisEnd]:n[a.crossAxisStart]<s[a.crossAxisStart]})).filter((function(e){var t=Me(e),n=ae(t[a.start],t[a.end]);return l(t[a.start])||l(t[a.end])||n(s[a.start])||n(s[a.end])})).sort((function(e,n){var i=Me(e)[a.crossAxisStart],r=Me(n)[a.crossAxisStart];return t?i-r:r-i})).filter((function(e,t,n){return Me(e)[a.crossAxisStart]===Me(n[0])[a.crossAxisStart]}));if(!c.length)return null;if(1===c.length)return c[0];var d=c.filter((function(e){return ae(Me(e)[a.start],Me(e)[a.end])(n[a.line])}));return 1===d.length?d[0]:d.length>1?d.sort((function(e,t){return Me(e)[a.start]-Me(t)[a.start]}))[0]:c.sort((function(e,t){var i=F(n,V(Me(e))),r=F(n,V(Me(t)));return i!==r?i-r:Me(e)[a.start]-Me(t)[a.start]}))[0]}({isMovingForward:t,pageBorderBoxCenter:n,source:r,droppables:s,viewport:a});if(!c)return null;var d=X(c.descriptor.id,o),u=function(e){var t=e.pageBorderBoxCenter,n=e.viewport,i=e.destination,r=e.insideDestination,o=e.afterCritical,s=r.filter((function(e){return pe({target:Le(e,o),destination:i,viewport:n.frame,withDroppableDisplacement:!0})})).sort((function(e,n){var r=U(t,ke(i,Oe(e,o))),s=U(t,ke(i,Oe(n,o)));return r<s?-1:s<r?1:e.descriptor.index-n.descriptor.index}));return s[0]||null}({pageBorderBoxCenter:n,viewport:a,destination:c,insideDestination:d,afterCritical:l}),m=function(e){var t=e.previousPageBorderBoxCenter,n=e.moveRelativeTo,i=e.insideDestination,r=e.draggable,o=e.draggables,s=e.destination,a=e.viewport,l=e.afterCritical;if(!n){if(i.length)return null;var c={displaced:oe,displacedBy:re,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:0}}},d=Re({impact:c,draggable:r,droppable:s,draggables:o,afterCritical:l}),u=ie(r,s)?s:je(s,r,o);return Ne({draggable:r,destination:u,newPageBorderBoxCenter:d,viewport:a.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?c:null}var m,h=Boolean(t[s.axis.line]<=n.page.borderBox.center[s.axis.line]),p=(m=n.descriptor.index,n.descriptor.id===r.descriptor.id||h?m:m+1),g=Ue(s.axis,r.displaceBy);return fe({draggable:r,insideDestination:i,destination:s,viewport:a,displacedBy:g,last:oe,index:p})}({previousPageBorderBoxCenter:n,destination:c,draggable:i,draggables:o,moveRelativeTo:u,insideDestination:d,viewport:a,afterCritical:l});if(!m)return null;var h=Re({impact:m,draggable:i,droppable:c,draggables:o,afterCritical:l});return{clientSelection:Pe({pageBorderBoxCenter:h,draggable:i,viewport:a}),impact:m,scrollJumpRequest:null}},Ve=function(e){var t=e.at;return t?"REORDER"===t.type?t.destination.droppableId:t.combine.droppableId:null},He=function(e){var t=e.state,n=e.type,i=function(e,t){var n=Ve(e);return n?t[n]:null}(t.impact,t.dimensions.droppables),r=Boolean(i),o=t.dimensions.droppables[t.critical.droppable.id],s=i||o,a=s.axis.direction,l="vertical"===a&&("MOVE_UP"===n||"MOVE_DOWN"===n)||"horizontal"===a&&("MOVE_LEFT"===n||"MOVE_RIGHT"===n);if(l&&!r)return null;var c="MOVE_DOWN"===n||"MOVE_RIGHT"===n,d=t.dimensions.draggables[t.critical.draggable.id],u=t.current.page.borderBoxCenter,m=t.dimensions,h=m.draggables,p=m.droppables;return l?De({isMovingForward:c,previousPageBorderBoxCenter:u,draggable:d,destination:s,draggables:h,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):Be({isMovingForward:c,previousPageBorderBoxCenter:u,draggable:d,isOver:s,draggables:h,droppables:p,viewport:t.viewport,afterCritical:t.afterCritical})};function ze(e){return"DRAGGING"===e.phase||"COLLECTING"===e.phase}function We(e){var t=ae(e.top,e.bottom),n=ae(e.left,e.right);return function(e){return t(e.y)&&n(e.x)}}function Ge(e){var t=e.pageBorderBox,n=e.draggable,i=e.droppables,r=Q(i).filter((function(e){if(!e.isEnabled)return!1;var n,i,r=e.subject.active;if(!r)return!1;if(i=r,!((n=t).left<i.right&&n.right>i.left&&n.top<i.bottom&&n.bottom>i.top))return!1;if(We(r)(t.center))return!0;var o=e.axis,s=r.center[o.crossAxisLine],a=t[o.crossAxisStart],l=t[o.crossAxisEnd],c=ae(r[o.crossAxisStart],r[o.crossAxisEnd]),d=c(a),u=c(l);return!d&&!u||(d?a<s:l>s)}));return r.length?1===r.length?r[0].descriptor.id:function(e){var t=e.pageBorderBox,n=e.draggable,i=e.candidates,r=n.page.borderBox.center,o=i.map((function(e){var n=e.axis,i=L(e.axis.line,t.center[n.line],e.page.borderBox.center[n.crossAxisLine]);return{id:e.descriptor.id,distance:U(r,i)}})).sort((function(e,t){return t.distance-e.distance}));return o[0]?o[0].id:null}({pageBorderBox:t,draggable:n,candidates:r}):null}var Ke=function(e,t){return u.getRect(B(e,t))};function Je(e){var t=e.displaced,n=e.id;return Boolean(t.visible[n]||t.invisible[n])}var qe=function(e){var t=e.pageOffset,n=e.draggable,i=e.draggables,r=e.droppables,o=e.previousImpact,s=e.viewport,a=e.afterCritical,l=Ke(n.page.borderBox,t),c=Ge({pageBorderBox:l,draggable:n,droppables:r});if(!c)return se;var d=r[c],u=X(d.descriptor.id,i),m=function(e,t){var n=e.frame;return n?Ke(t,n.scroll.diff.value):t}(d,l);return function(e){var t=e.draggable,n=e.pageBorderBoxWithDroppableScroll,i=e.previousImpact,r=e.destination,o=e.insideDestination,s=e.afterCritical;if(!r.isCombineEnabled)return null;var a=r.axis,l=Ue(r.axis,t.displaceBy),c=l.value,d=n[a.start],u=n[a.end],m=J(ne(t,o),(function(e){var t=e.descriptor.id,n=e.page.borderBox,r=n[a.size]/4,o=ye(t,s),l=Je({displaced:i.displaced,id:t});return o?l?u>n[a.start]+r&&u<n[a.end]-r:d>n[a.start]-c+r&&d<n[a.end]-c-r:l?u>n[a.start]+c+r&&u<n[a.end]+c-r:d>n[a.start]+r&&d<n[a.end]-r}));return m?{displacedBy:l,displaced:i.displaced,at:{type:"COMBINE",combine:{draggableId:m.descriptor.id,droppableId:r.descriptor.id}}}:null}({pageBorderBoxWithDroppableScroll:m,draggable:n,previousImpact:o,destination:d,insideDestination:u,afterCritical:a})||function(e){var t=e.pageBorderBoxWithDroppableScroll,n=e.draggable,i=e.destination,r=e.insideDestination,o=e.last,s=e.viewport,a=e.afterCritical,l=i.axis,c=Ue(i.axis,n.displaceBy),d=c.value,u=t[l.start],m=t[l.end],h=function(e){var t=e.draggable,n=e.closest,i=e.inHomeList;return n?i&&n.descriptor.index>t.descriptor.index?n.descriptor.index-1:n.descriptor.index:null}({draggable:n,closest:J(ne(n,r),(function(e){var t=e.descriptor.id,n=e.page.borderBox.center[l.line],i=ye(t,a),r=Je({displaced:o,id:t});return i?r?m<=n:u<n-d:r?m<=n+d:u<n})),inHomeList:ie(n,i)});return fe({draggable:n,insideDestination:r,destination:i,viewport:s,last:o,displacedBy:c,index:h})}({pageBorderBoxWithDroppableScroll:m,draggable:n,destination:d,insideDestination:u,last:o.displaced,viewport:s,afterCritical:a})},$e=function(e,t){var n;return a({},e,((n={})[t.descriptor.id]=t,n))},Ye=function(e){var t=e.previousImpact,n=e.impact,i=e.droppables,r=Ve(t),o=Ve(n);if(!r)return i;if(r===o)return i;var s=i[r];if(!s.subject.withPlaceholder)return i;var l=function(e){var t=e.subject.withPlaceholder;t||b(!1);var n=e.frame;if(!n){var i=z({page:e.subject.page,axis:e.axis,frame:null,withPlaceholder:null});return a({},e,{subject:i})}var r=t.oldFrameMaxScroll;r||b(!1);var o=Fe(n,r),s=z({page:e.subject.page,axis:e.axis,frame:o,withPlaceholder:null});return a({},e,{subject:s,frame:o})}(s);return $e(i,l)},Qe=function(e){var t=e.state,n=e.clientSelection,i=e.dimensions,r=e.viewport,o=e.impact,s=e.scrollJumpRequest,l=r||t.viewport,c=i||t.dimensions,d=n||t.current.client.selection,u=D(d,t.initial.client.selection),m={offset:u,selection:d,borderBoxCenter:N(t.initial.client.borderBoxCenter,u)},h={selection:N(m.selection,l.scroll.current),borderBoxCenter:N(m.borderBoxCenter,l.scroll.current),offset:N(m.offset,l.scroll.diff.value)},p={client:m,page:h};if("COLLECTING"===t.phase)return a({phase:"COLLECTING"},t,{dimensions:c,viewport:l,current:p});var g=c.draggables[t.critical.draggable.id],v=o||qe({pageOffset:h.offset,draggable:g,draggables:c.draggables,droppables:c.droppables,previousImpact:t.impact,viewport:l,afterCritical:t.afterCritical}),_=function(e){var t=e.draggable,n=e.draggables,i=e.droppables,r=e.previousImpact,o=e.impact,s=Ye({previousImpact:r,impact:o,droppables:i}),a=Ve(o);if(!a)return s;var l=i[a];if(ie(t,l))return s;if(l.subject.withPlaceholder)return s;var c=je(l,t,n);return $e(s,c)}({draggable:g,impact:v,previousImpact:t.impact,draggables:c.draggables,droppables:c.droppables});return a({},t,{current:p,dimensions:{draggables:c.draggables,droppables:_},impact:v,viewport:l,scrollJumpRequest:s||null,forceShouldAnimate:!s&&null})};var Ze=function(e){var t=e.impact,n=e.viewport,i=e.draggables,r=e.destination,o=e.forceShouldAnimate,s=t.displaced,l=function(e,t){return e.map((function(e){return t[e]}))}(s.all,i),c=ve({afterDragging:l,destination:r,displacedBy:t.displacedBy,viewport:n.frame,forceShouldAnimate:o,last:s});return a({},t,{displaced:c})},Xe=function(e){var t=e.impact,n=e.draggable,i=e.droppable,r=e.draggables,o=e.viewport,s=e.afterCritical,a=Re({impact:t,draggable:n,draggables:r,droppable:i,afterCritical:s});return Pe({pageBorderBoxCenter:a,draggable:n,viewport:o})},et=function(e){var t=e.state,n=e.dimensions,i=e.viewport;"SNAP"!==t.movementMode&&b(!1);var r=t.impact,o=i||t.viewport,s=n||t.dimensions,a=s.draggables,l=s.droppables,c=a[t.critical.draggable.id],d=Ve(r);d||b(!1);var u=l[d],m=Ze({impact:r,viewport:o,destination:u,draggables:a}),h=Xe({impact:m,draggable:c,droppable:u,draggables:a,viewport:o,afterCritical:t.afterCritical});return Qe({impact:m,clientSelection:h,state:t,dimensions:s,viewport:o})},tt=function(e){var t=e.draggable,n=e.home,i=e.draggables,r=e.viewport,o=Ue(n.axis,t.displaceBy),s=X(n.descriptor.id,i),a=s.indexOf(t);-1===a&&b(!1);var l,c=s.slice(a+1),d=c.reduce((function(e,t){return e[t.descriptor.id]=!0,e}),{}),u={inVirtualList:"virtual"===n.descriptor.mode,displacedBy:o,effected:d};return{impact:{displaced:ve({afterDragging:c,destination:n,displacedBy:o,last:null,viewport:r.frame,forceShouldAnimate:!1}),displacedBy:o,at:{type:"REORDER",destination:(l=t.descriptor,{index:l.index,droppableId:l.droppableId})}},afterCritical:u}},nt=function(e){0},it=function(e){0},rt=function(e){var t=e.additions,n=e.updatedDroppables,i=e.viewport,r=i.scroll.diff.value;return t.map((function(e){var t=e.descriptor.droppableId,o=function(e){var t=e.frame;return t||b(!1),t}(n[t]),s=o.scroll.diff.value,l=function(e){var t=e.draggable,n=e.offset,i=e.initialWindowScroll,r=u.offset(t.client,n),o=u.withScroll(r,i);return a({},t,{placeholder:a({},t.placeholder,{client:r}),client:r,page:o})}({draggable:e,offset:N(r,s),initialWindowScroll:i.scroll.initial});return l}))},ot=function(e){return"SNAP"===e.movementMode},st=function(e,t,n){var i=function(e,t){return{draggables:e.draggables,droppables:$e(e.droppables,t)}}(e.dimensions,t);return!ot(e)||n?Qe({state:e,dimensions:i}):et({state:e,dimensions:i})};function at(e){return e.isDragging&&"SNAP"===e.movementMode?a({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var lt={phase:"IDLE",completed:null,shouldFlush:!1},ct=function(e,t){if(void 0===e&&(e=lt),"FLUSH"===t.type)return a({},lt,{shouldFlush:!0});if("INITIAL_PUBLISH"===t.type){"IDLE"!==e.phase&&b(!1);var n=t.payload,i=n.critical,r=n.clientSelection,o=n.viewport,s=n.dimensions,l=n.movementMode,c=s.draggables[i.draggable.id],d=s.droppables[i.droppable.id],u={selection:r,borderBoxCenter:c.client.borderBox.center,offset:P},m={client:u,page:{selection:N(u.selection,o.scroll.initial),borderBoxCenter:N(u.selection,o.scroll.initial),offset:N(u.selection,o.scroll.diff.value)}},h=Q(s.droppables).every((function(e){return!e.isFixedOnPage})),p=tt({draggable:c,home:d,draggables:s.draggables,viewport:o}),g=p.impact;return{phase:"DRAGGING",isDragging:!0,critical:i,movementMode:l,dimensions:s,initial:m,current:m,isWindowScrollAllowed:h,impact:g,afterCritical:p.afterCritical,onLiftImpact:g,viewport:o,scrollJumpRequest:null,forceShouldAnimate:null}}if("COLLECTION_STARTING"===t.type)return"COLLECTING"===e.phase||"DROP_PENDING"===e.phase?e:("DRAGGING"!==e.phase&&b(!1),a({phase:"COLLECTING"},e,{phase:"COLLECTING"}));if("PUBLISH_WHILE_DRAGGING"===t.type)return"COLLECTING"!==e.phase&&"DROP_PENDING"!==e.phase&&b(!1),function(e){var t=e.state,n=e.published;nt();var i=n.modified.map((function(e){var n=t.dimensions.droppables[e.droppableId];return W(n,e.scroll)})),r=a({},t.dimensions.droppables,{},$(i)),o=Y(rt({additions:n.additions,updatedDroppables:r,viewport:t.viewport})),s=a({},t.dimensions.draggables,{},o);n.removals.forEach((function(e){delete s[e]}));var l={droppables:r,draggables:s},c=Ve(t.impact),d=c?l.droppables[c]:null,u=l.draggables[t.critical.draggable.id],m=l.droppables[t.critical.droppable.id],h=tt({draggable:u,home:m,draggables:s,viewport:t.viewport}),p=h.impact,g=h.afterCritical,v=d&&d.isCombineEnabled?t.impact:p,_=qe({pageOffset:t.current.page.offset,draggable:l.draggables[t.critical.draggable.id],draggables:l.draggables,droppables:l.droppables,previousImpact:v,viewport:t.viewport,afterCritical:g});it();var f=a({phase:"DRAGGING"},t,{phase:"DRAGGING",impact:_,onLiftImpact:p,dimensions:l,afterCritical:g,forceShouldAnimate:!1});return"COLLECTING"===t.phase?f:a({phase:"DROP_PENDING"},f,{phase:"DROP_PENDING",reason:t.reason,isWaiting:!1})}({state:e,published:t.payload});if("MOVE"===t.type){if("DROP_PENDING"===e.phase)return e;ze(e)||b(!1);var v=t.payload.client;return M(v,e.current.client.selection)?e:Qe({state:e,clientSelection:v,impact:ot(e)?e.impact:null})}if("UPDATE_DROPPABLE_SCROLL"===t.type){if("DROP_PENDING"===e.phase)return at(e);if("COLLECTING"===e.phase)return at(e);ze(e)||b(!1);var _=t.payload,f=_.id,y=_.newScroll,E=e.dimensions.droppables[f];if(!E)return e;var w=W(E,y);return st(e,w,!1)}if("UPDATE_DROPPABLE_IS_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;ze(e)||b(!1);var x=t.payload,A=x.id,S=x.isEnabled,C=e.dimensions.droppables[A];C||b(!1),C.isEnabled===S&&b(!1);var k=a({},C,{isEnabled:S});return st(e,k,!0)}if("UPDATE_DROPPABLE_IS_COMBINE_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;ze(e)||b(!1);var R=t.payload,I=R.id,T=R.isCombineEnabled,D=e.dimensions.droppables[I];D||b(!1),D.isCombineEnabled===T&&b(!1);var O=a({},D,{isCombineEnabled:T});return st(e,O,!0)}if("MOVE_BY_WINDOW_SCROLL"===t.type){if("DROP_PENDING"===e.phase||"DROP_ANIMATING"===e.phase)return e;ze(e)||b(!1),e.isWindowScrollAllowed||b(!1);var L=t.payload.newScroll;if(M(e.viewport.scroll.current,L))return at(e);var U=Ie(e.viewport,L);return ot(e)?et({state:e,viewport:U}):Qe({state:e,viewport:U})}if("UPDATE_VIEWPORT_MAX_SCROLL"===t.type){if(!ze(e))return e;var F=t.payload.maxScroll;if(M(F,e.viewport.scroll.max))return e;var j=a({},e.viewport,{scroll:a({},e.viewport.scroll,{max:F})});return a({phase:"DRAGGING"},e,{viewport:j})}if("MOVE_UP"===t.type||"MOVE_DOWN"===t.type||"MOVE_LEFT"===t.type||"MOVE_RIGHT"===t.type){if("COLLECTING"===e.phase||"DROP_PENDING"===e.phase)return e;"DRAGGING"!==e.phase&&b(!1);var B=He({state:e,type:t.type});return B?Qe({state:e,impact:B.impact,clientSelection:B.clientSelection,scrollJumpRequest:B.scrollJumpRequest}):e}if("DROP_PENDING"===t.type){var V=t.payload.reason;return"COLLECTING"!==e.phase&&b(!1),a({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:V})}if("DROP_ANIMATE"===t.type){var H=t.payload,z=H.completed,G=H.dropDuration,K=H.newHomeClientOffset;return"DRAGGING"!==e.phase&&"DROP_PENDING"!==e.phase&&b(!1),{phase:"DROP_ANIMATING",completed:z,dropDuration:G,newHomeClientOffset:K,dimensions:e.dimensions}}return"DROP_COMPLETE"===t.type?{phase:"IDLE",completed:t.payload.completed,shouldFlush:!1}:e},dt=function(e){return{type:"LIFT",payload:e}},ut=function(e){return{type:"PUBLISH_WHILE_DRAGGING",payload:e}},mt=function(){return{type:"COLLECTION_STARTING",payload:null}},ht=function(e){return{type:"UPDATE_DROPPABLE_SCROLL",payload:e}},pt=function(e){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:e}},gt=function(e){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:e}},vt=function(e){return{type:"MOVE",payload:e}},_t=function(){return{type:"MOVE_UP",payload:null}},ft=function(){return{type:"MOVE_DOWN",payload:null}},yt=function(){return{type:"MOVE_RIGHT",payload:null}},Et=function(){return{type:"MOVE_LEFT",payload:null}},bt=function(){return{type:"FLUSH",payload:null}},wt=function(e){return{type:"DROP_COMPLETE",payload:e}},xt=function(e){return{type:"DROP",payload:e}},At=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}};var St="cubic-bezier(.2,1,.1,1)",Ct={drop:0,combining:.7},kt={drop:.75},Rt=.2+"s "+"cubic-bezier(0.2, 0, 0, 1)",It={fluid:"opacity "+Rt,snap:"transform "+Rt+", opacity "+Rt,drop:function(e){var t=e+"s "+St;return"transform "+t+", opacity "+t},outOfTheWay:"transform "+Rt,placeholder:"height "+Rt+", width "+Rt+", margin "+Rt},Tt=function(e){return M(e,P)?null:"translate("+e.x+"px, "+e.y+"px)"},Pt={moveTo:Tt,drop:function(e,t){var n=Tt(e);return n?t?n+" scale("+kt.drop+")":n:null}},Nt=.33,Dt=.55,Mt=Dt-Nt,Ot=function(e){var t=e.getState,n=e.dispatch;return function(e){return function(i){if("DROP"===i.type){var r=t(),o=i.payload.reason;if("COLLECTING"!==r.phase){if("IDLE"!==r.phase){"DROP_PENDING"===r.phase&&r.isWaiting&&b(!1),"DRAGGING"!==r.phase&&"DROP_PENDING"!==r.phase&&b(!1);var s=r.critical,l=r.dimensions,c=l.draggables[r.critical.draggable.id],d=function(e){var t=e.draggables,n=e.reason,i=e.lastImpact,r=e.home,o=e.viewport,s=e.onLiftImpact;return i.at&&"DROP"===n?"REORDER"===i.at.type?{impact:i,didDropInsideDroppable:!0}:{impact:a({},i,{displaced:oe}),didDropInsideDroppable:!0}:{impact:Ze({draggables:t,impact:s,destination:r,viewport:o,forceShouldAnimate:!0}),didDropInsideDroppable:!1}}({reason:o,lastImpact:r.impact,afterCritical:r.afterCritical,onLiftImpact:r.onLiftImpact,home:r.dimensions.droppables[r.critical.droppable.id],viewport:r.viewport,draggables:r.dimensions.draggables}),u=d.impact,m=d.didDropInsideDroppable,h=m?ee(u):null,p=m?te(u):null,g={index:s.draggable.index,droppableId:s.droppable.id},v={draggableId:c.descriptor.id,type:c.descriptor.type,source:g,reason:o,mode:r.movementMode,destination:h,combine:p},_=function(e){var t=e.impact,n=e.draggable,i=e.dimensions,r=e.viewport,o=e.afterCritical,s=i.draggables,a=i.droppables,l=Ve(t),c=l?a[l]:null,d=a[n.descriptor.droppableId],u=Xe({impact:t,draggable:n,draggables:s,afterCritical:o,droppable:c||d,viewport:r});return D(u,n.client.borderBox.center)}({impact:u,draggable:c,dimensions:l,viewport:r.viewport,afterCritical:r.afterCritical}),f={critical:r.critical,afterCritical:r.afterCritical,result:v,impact:u};if(!M(r.current.client.offset,_)||Boolean(v.combine)){var y=function(e){var t=e.current,n=e.destination,i=e.reason,r=U(t,n);if(r<=0)return Nt;if(r>=1500)return Dt;var o=Nt+Mt*(r/1500);return Number(("CANCEL"===i?.6*o:o).toFixed(2))}({current:r.current.client.offset,destination:_,reason:o});n(function(e){return{type:"DROP_ANIMATE",payload:e}}({newHomeClientOffset:_,dropDuration:y,completed:f}))}else n(wt({completed:f}))}}else n(function(e){return{type:"DROP_PENDING",payload:e}}({reason:o}))}else e(i)}}},Lt=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function Ut(e){var t=e.onWindowScroll;var n=h((function(){t(Lt())})),i=function(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(t){t.target!==window&&t.target!==window.document||e()}}}(n),r=v;function o(){return r!==v}return{start:function(){o()&&b(!1),r=_(window,[i])},stop:function(){o()||b(!1),n.cancel(),r(),r=v},isActive:o}}var Ft=function(e){var t=Ut({onWindowScroll:function(t){e.dispatch({type:"MOVE_BY_WINDOW_SCROLL",payload:{newScroll:t}})}});return function(e){return function(n){t.isActive()||"INITIAL_PUBLISH"!==n.type||t.start(),t.isActive()&&function(e){return"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type}(n)&&t.stop(),e(n)}}},jt=function(){var e=[];return{add:function(t){var n=setTimeout((function(){return function(t){var n=K(e,(function(e){return e.timerId===t}));-1===n&&b(!1),e.splice(n,1)[0].callback()}(n)})),i={timerId:n,callback:t};e.push(i)},flush:function(){if(e.length){var t=[].concat(e);e.length=0,t.forEach((function(e){clearTimeout(e.timerId),e.callback()}))}}}},Bt=function(e,t){nt(),t(),it()},Vt=function(e,t){return{draggableId:e.draggable.id,type:e.droppable.type,source:{droppableId:e.droppable.id,index:e.draggable.index},mode:t}},Ht=function(e,t,n,i){if(e){var r=function(e){var t=!1,n=!1,i=setTimeout((function(){n=!0})),r=function(r){t||n||(t=!0,e(r),clearTimeout(i))};return r.wasCalled=function(){return t},r}(n);e(t,{announce:r}),r.wasCalled()||n(i(t))}else n(i(t))},zt=function(e,t){var n=function(e,t){var n=jt(),i=null,r=function(n){i||b(!1),i=null,Bt(0,(function(){return Ht(e().onDragEnd,n,t,T)}))};return{beforeCapture:function(t,n){i&&b(!1),Bt(0,(function(){var i=e().onBeforeCapture;i&&i({draggableId:t,mode:n})}))},beforeStart:function(t,n){i&&b(!1),Bt(0,(function(){var i=e().onBeforeDragStart;i&&i(Vt(t,n))}))},start:function(r,o){i&&b(!1);var s=Vt(r,o);i={mode:o,lastCritical:r,lastLocation:s.source,lastCombine:null},n.add((function(){Bt(0,(function(){return Ht(e().onDragStart,s,t,R)}))}))},update:function(r,o){var s=ee(o),l=te(o);i||b(!1);var c=!function(e,t){if(e===t)return!0;var n=e.draggable.id===t.draggable.id&&e.draggable.droppableId===t.draggable.droppableId&&e.draggable.type===t.draggable.type&&e.draggable.index===t.draggable.index,i=e.droppable.id===t.droppable.id&&e.droppable.type===t.droppable.type;return n&&i}(r,i.lastCritical);c&&(i.lastCritical=r);var d,u,m=(u=s,!(null==(d=i.lastLocation)&&null==u||null!=d&&null!=u&&d.droppableId===u.droppableId&&d.index===u.index));m&&(i.lastLocation=s);var h=!function(e,t){return null==e&&null==t||null!=e&&null!=t&&e.draggableId===t.draggableId&&e.droppableId===t.droppableId}(i.lastCombine,l);if(h&&(i.lastCombine=l),c||m||h){var p=a({},Vt(r,i.mode),{combine:l,destination:s});n.add((function(){Bt(0,(function(){return Ht(e().onDragUpdate,p,t,I)}))}))}},flush:function(){i||b(!1),n.flush()},drop:r,abort:function(){if(i){var e=a({},Vt(i.lastCritical,i.mode),{combine:null,destination:null,reason:"CANCEL"});r(e)}}}}(e,t);return function(e){return function(t){return function(i){if("BEFORE_INITIAL_CAPTURE"!==i.type){if("INITIAL_PUBLISH"===i.type){var r=i.payload.critical;return n.beforeStart(r,i.payload.movementMode),t(i),void n.start(r,i.payload.movementMode)}if("DROP_COMPLETE"===i.type){var o=i.payload.completed.result;return n.flush(),t(i),void n.drop(o)}if(t(i),"FLUSH"!==i.type){var s=e.getState();"DRAGGING"===s.phase&&n.update(s.critical,s.impact)}else n.abort()}else n.beforeCapture(i.payload.draggableId,i.payload.movementMode)}}}},Wt=function(e){return function(t){return function(n){if("DROP_ANIMATION_FINISHED"===n.type){var i=e.getState();"DROP_ANIMATING"!==i.phase&&b(!1),e.dispatch(wt({completed:i.completed}))}else t(n)}}},Gt=function(e){var t=null,n=null;return function(i){return function(r){if("FLUSH"!==r.type&&"DROP_COMPLETE"!==r.type&&"DROP_ANIMATION_FINISHED"!==r.type||(n&&(cancelAnimationFrame(n),n=null),t&&(t(),t=null)),i(r),"DROP_ANIMATE"===r.type){var o={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){"DROP_ANIMATING"===e.getState().phase&&e.dispatch({type:"DROP_ANIMATION_FINISHED",payload:null})}};n=requestAnimationFrame((function(){n=null,t=_(window,[o])}))}}}},Kt=function(e){return function(t){return function(n){if(t(n),"PUBLISH_WHILE_DRAGGING"===n.type){var i=e.getState();"DROP_PENDING"===i.phase&&(i.isWaiting||e.dispatch(xt({reason:i.reason})))}}}},Jt=l.compose,qt=function(e){var t,n=e.dimensionMarshal,i=e.focusMarshal,r=e.styleMarshal,o=e.getResponders,s=e.announce,a=e.autoScroller;return l.createStore(ct,Jt(l.applyMiddleware((t=r,function(){return function(e){return function(n){"INITIAL_PUBLISH"===n.type&&t.dragging(),"DROP_ANIMATE"===n.type&&t.dropping(n.payload.completed.result.reason),"FLUSH"!==n.type&&"DROP_COMPLETE"!==n.type||t.resting(),e(n)}}}),function(e){return function(){return function(t){return function(n){"DROP_COMPLETE"!==n.type&&"FLUSH"!==n.type&&"DROP_ANIMATE"!==n.type||e.stopPublishing(),t(n)}}}}(n),function(e){return function(t){var n=t.getState,i=t.dispatch;return function(t){return function(r){if("LIFT"===r.type){var o=r.payload,s=o.id,a=o.clientSelection,l=o.movementMode,c=n();"DROP_ANIMATING"===c.phase&&i(wt({completed:c.completed})),"IDLE"!==n().phase&&b(!1),i(bt()),i({type:"BEFORE_INITIAL_CAPTURE",payload:{draggableId:s,movementMode:l}});var d={draggableId:s,scrollOptions:{shouldPublishImmediately:"SNAP"===l}},u=e.startPublishing(d),m=u.critical,h=u.dimensions,p=u.viewport;i({type:"INITIAL_PUBLISH",payload:{critical:m,dimensions:h,clientSelection:a,movementMode:l,viewport:p}})}else t(r)}}}}(n),Ot,Wt,Gt,Kt,function(e){return function(t){return function(n){return function(i){if(function(e){return"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type}(i))return e.stop(),void n(i);if("INITIAL_PUBLISH"===i.type){n(i);var r=t.getState();return"DRAGGING"!==r.phase&&b(!1),void e.start(r)}n(i),e.scroll(t.getState())}}}}(a),Ft,function(e){var t=!1;return function(){return function(n){return function(i){if("INITIAL_PUBLISH"===i.type)return t=!0,e.tryRecordFocus(i.payload.critical.draggable.id),n(i),void e.tryRestoreFocusRecorded();if(n(i),t){if("FLUSH"===i.type)return t=!1,void e.tryRestoreFocusRecorded();if("DROP_COMPLETE"===i.type){t=!1;var r=i.payload.completed.result;r.combine&&e.tryShiftRecord(r.draggableId,r.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}}(i),zt(o,s))))};var $t=function(e){var t=e.scrollHeight,n=e.scrollWidth,i=e.height,r=e.width,o=D({x:n,y:t},{x:r,y:i});return{x:Math.max(0,o.x),y:Math.max(0,o.y)}},Yt=function(){var e=document.documentElement;return e||b(!1),e},Qt=function(){var e=Yt();return $t({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight})},Zt=function(e){var t=e.critical,n=e.scrollOptions,i=e.registry;nt();var r=function(){var e=Lt(),t=Qt(),n=e.y,i=e.x,r=Yt(),o=i+r.clientWidth,s=n+r.clientHeight;return{frame:u.getRect({top:n,left:i,right:o,bottom:s}),scroll:{initial:e,current:e,max:t,diff:{value:P,displacement:P}}}}(),o=r.scroll.current,s=t.droppable,a=i.droppable.getAllByType(s.type).map((function(e){return e.callbacks.getDimensionAndWatchScroll(o,n)})),l=i.draggable.getAllByType(t.draggable.type).map((function(e){return e.getDimension(o)})),c={draggables:Y(l),droppables:$(a)};return it(),{dimensions:c,critical:t,viewport:r}};function Xt(e,t,n){return n.descriptor.id!==t.id&&(n.descriptor.type===t.type&&"virtual"===e.droppable.getById(n.descriptor.droppableId).descriptor.mode)}var en,tn,nn=function(e,t){var n=null,i=function(e){var t=e.registry,n=e.callbacks,i={additions:{},removals:{},modified:{}},r=null,o=function(){r||(n.collectionStarting(),r=requestAnimationFrame((function(){r=null,nt();var e=i,o=e.additions,s=e.removals,a=e.modified,l=Object.keys(o).map((function(e){return t.draggable.getById(e).getDimension(P)})).sort((function(e,t){return e.descriptor.index-t.descriptor.index})),c=Object.keys(a).map((function(e){return{droppableId:e,scroll:t.droppable.getById(e).callbacks.getScrollWhileDragging()}})),d={additions:l,removals:Object.keys(s),modified:c};i={additions:{},removals:{},modified:{}},it(),n.publish(d)})))};return{add:function(e){var t=e.descriptor.id;i.additions[t]=e,i.modified[e.descriptor.droppableId]=!0,i.removals[t]&&delete i.removals[t],o()},remove:function(e){var t=e.descriptor;i.removals[t.id]=!0,i.modified[t.droppableId]=!0,i.additions[t.id]&&delete i.additions[t.id],o()},stop:function(){r&&(cancelAnimationFrame(r),r=null,i={additions:{},removals:{},modified:{}})}}}({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),r=function(t){n||b(!1);var r=n.critical.draggable;"ADDITION"===t.type&&Xt(e,r,t.value)&&i.add(t.value),"REMOVAL"===t.type&&Xt(e,r,t.value)&&i.remove(t.value)},o={updateDroppableIsEnabled:function(i,r){e.droppable.exists(i)||b(!1),n&&t.updateDroppableIsEnabled({id:i,isEnabled:r})},updateDroppableIsCombineEnabled:function(i,r){n&&(e.droppable.exists(i)||b(!1),t.updateDroppableIsCombineEnabled({id:i,isCombineEnabled:r}))},scrollDroppable:function(t,i){n&&e.droppable.getById(t).callbacks.scroll(i)},updateDroppableScroll:function(i,r){n&&(e.droppable.exists(i)||b(!1),t.updateDroppableScroll({id:i,newScroll:r}))},startPublishing:function(t){n&&b(!1);var i=e.draggable.getById(t.draggableId),o=e.droppable.getById(i.descriptor.droppableId),s={draggable:i.descriptor,droppable:o.descriptor},a=e.subscribe(r);return n={critical:s,unsubscribe:a},Zt({critical:s,registry:e,scrollOptions:t.scrollOptions})},stopPublishing:function(){if(n){i.stop();var t=n.critical.droppable;e.droppable.getAllByType(t.type).forEach((function(e){return e.callbacks.dragStopped()})),n.unsubscribe(),n=null}}};return o},rn=function(e,t){return"IDLE"===e.phase||"DROP_ANIMATING"===e.phase&&(e.completed.result.draggableId!==t&&"DROP"===e.completed.result.reason)},on=function(e){window.scrollBy(e.x,e.y)},sn=m((function(e){return Q(e).filter((function(e){return!!e.isEnabled&&!!e.frame}))})),an=function(e){var t=e.center,n=e.destination,i=e.droppables;if(n){var r=i[n];return r.frame?r:null}var o=function(e,t){var n=J(sn(t),(function(t){return t.frame||b(!1),We(t.frame.pageMarginBox)(e)}));return n}(t,i);return o},ln=.25,cn=.05,dn=28,un=function(e){return Math.pow(e,2)},mn={stopDampeningAt:1200,accelerateAt:360},hn=function(e){var t=e.startOfRange,n=e.endOfRange,i=e.current,r=n-t;return 0===r?0:(i-t)/r},pn=mn.accelerateAt,gn=mn.stopDampeningAt,vn=function(e){var t=e.distanceToEdge,n=e.thresholds,i=e.dragStartTime,r=e.shouldUseTimeDampening,o=function(e,t){if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return dn;if(e===t.startScrollingFrom)return 1;var n=hn({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),i=dn*un(1-n);return Math.ceil(i)}(t,n);return 0===o?0:r?Math.max(function(e,t){var n=t,i=gn,r=Date.now()-n;if(r>=gn)return e;if(r<pn)return 1;var o=hn({startOfRange:pn,endOfRange:i,current:r}),s=e*un(o);return Math.ceil(s)}(o,i),1):o},_n=function(e){var t=e.container,n=e.distanceToEdges,i=e.dragStartTime,r=e.axis,o=e.shouldUseTimeDampening,s=function(e,t){return{startScrollingFrom:e[t.size]*ln,maxScrollValueAt:e[t.size]*cn}}(t,r);return n[r.end]<n[r.start]?vn({distanceToEdge:n[r.end],thresholds:s,dragStartTime:i,shouldUseTimeDampening:o}):-1*vn({distanceToEdge:n[r.start],thresholds:s,dragStartTime:i,shouldUseTimeDampening:o})},fn=j((function(e){return 0===e?0:e})),yn=function(e){var t=e.dragStartTime,n=e.container,i=e.subject,r=e.center,o=e.shouldUseTimeDampening,s={top:r.y-n.top,right:n.right-r.x,bottom:n.bottom-r.y,left:r.x-n.left},a=_n({container:n,distanceToEdges:s,dragStartTime:t,axis:de,shouldUseTimeDampening:o}),l=_n({container:n,distanceToEdges:s,dragStartTime:t,axis:ue,shouldUseTimeDampening:o}),c=fn({x:l,y:a});if(M(c,P))return null;var d=function(e){var t=e.container,n=e.subject,i=e.proposedScroll,r=n.height>t.height,o=n.width>t.width;return o||r?o&&r?null:{x:o?0:i.x,y:r?0:i.y}:i}({container:n,subject:i,proposedScroll:c});return d?M(d,P)?null:d:null},En=j((function(e){return 0===e?0:e>0?1:-1})),bn=(en=function(e,t){return e<0?e:e>t?e-t:0},function(e){var t=e.current,n=e.max,i=e.change,r=N(t,i),o={x:en(r.x,n.x),y:en(r.y,n.y)};return M(o,P)?null:o}),wn=function(e){var t=e.max,n=e.current,i=e.change,r={x:Math.max(n.x,t.x),y:Math.max(n.y,t.y)},o=En(i),s=bn({max:r,current:n,change:o});return!s||(0!==o.x&&0===s.x||0!==o.y&&0===s.y)},xn=function(e,t){return wn({current:e.scroll.current,max:e.scroll.max,change:t})},An=function(e,t){var n=e.frame;return!!n&&wn({current:n.scroll.current,max:n.scroll.max,change:t})},Sn=function(e){var t=e.state,n=e.dragStartTime,i=e.shouldUseTimeDampening,r=e.scrollWindow,o=e.scrollDroppable,s=t.current.page.borderBoxCenter,a=t.dimensions.draggables[t.critical.draggable.id].page.marginBox;if(t.isWindowScrollAllowed){var l=function(e){var t=e.viewport,n=e.subject,i=e.center,r=e.dragStartTime,o=e.shouldUseTimeDampening,s=yn({dragStartTime:r,container:t.frame,subject:n,center:i,shouldUseTimeDampening:o});return s&&xn(t,s)?s:null}({dragStartTime:n,viewport:t.viewport,subject:a,center:s,shouldUseTimeDampening:i});if(l)return void r(l)}var c=an({center:s,destination:Ve(t.impact),droppables:t.dimensions.droppables});if(c){var d=function(e){var t=e.droppable,n=e.subject,i=e.center,r=e.dragStartTime,o=e.shouldUseTimeDampening,s=t.frame;if(!s)return null;var a=yn({dragStartTime:r,container:s.pageMarginBox,subject:n,center:i,shouldUseTimeDampening:o});return a&&An(t,a)?a:null}({dragStartTime:n,droppable:c,subject:a,center:s,shouldUseTimeDampening:i});d&&o(c.descriptor.id,d)}},Cn=function(e){var t=e.move,n=e.scrollDroppable,i=e.scrollWindow,r=function(e,t){if(!An(e,t))return t;var i=function(e,t){var n=e.frame;return n&&An(e,t)?bn({current:n.scroll.current,max:n.scroll.max,change:t}):null}(e,t);if(!i)return n(e.descriptor.id,t),null;var r=D(t,i);return n(e.descriptor.id,r),D(t,r)},o=function(e,t,n){if(!e)return n;if(!xn(t,n))return n;var r=function(e,t){if(!xn(e,t))return null;var n=e.scroll.max,i=e.scroll.current;return bn({current:i,max:n,change:t})}(t,n);if(!r)return i(n),null;var o=D(n,r);return i(o),D(n,o)};return function(e){var n=e.scrollJumpRequest;if(n){var i=Ve(e.impact);i||b(!1);var s=r(e.dimensions.droppables[i],n);if(s){var a=e.viewport,l=o(e.isWindowScrollAllowed,a,s);l&&function(e,n){var i=N(e.current.client.selection,n);t({client:i})}(e,l)}}}},kn=function(e){var t=e.scrollDroppable,n=e.scrollWindow,i=e.move,r=function(e){var t=e.scrollWindow,n=e.scrollDroppable,i=h(t),r=h(n),o=null,s=function(e){o||b(!1);var t=o,n=t.shouldUseTimeDampening,s=t.dragStartTime;Sn({state:e,scrollWindow:i,scrollDroppable:r,dragStartTime:s,shouldUseTimeDampening:n})};return{start:function(e){nt(),o&&b(!1);var t=Date.now(),n=!1,i=function(){n=!0};Sn({state:e,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:i,scrollDroppable:i}),o={dragStartTime:t,shouldUseTimeDampening:n},it(),n&&s(e)},stop:function(){o&&(i.cancel(),r.cancel(),o=null)},scroll:s}}({scrollWindow:n,scrollDroppable:t}),o=Cn({move:i,scrollWindow:n,scrollDroppable:t});return{scroll:function(e){"DRAGGING"===e.phase&&("FLUID"!==e.movementMode?e.scrollJumpRequest&&o(e):r.scroll(e))},start:r.start,stop:r.stop}},Rn="data-rbd",In={base:tn=Rn+"-drag-handle",draggableId:tn+"-draggable-id",contextId:tn+"-context-id"},Tn=function(){var e=Rn+"-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),Pn=function(){var e=Rn+"-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),Nn={contextId:Rn+"-scroll-container-context-id"},Dn=function(e,t){return e.map((function(e){var n=e.styles[t];return n?e.selector+" { "+n+" }":""})).join(" ")},Mn=function(e){var t,n,i,r=(t=e,function(e){return"["+e+'="'+t+'"]'}),o=(n="\n      cursor: -webkit-grab;\n      cursor: grab;\n    ",{selector:r(In.contextId),styles:{always:"\n          -webkit-touch-callout: none;\n          -webkit-tap-highlight-color: rgba(0,0,0,0);\n          touch-action: manipulation;\n        ",resting:n,dragging:"pointer-events: none;",dropAnimating:n}}),s=[(i="\n      transition: "+It.outOfTheWay+";\n    ",{selector:r(Tn.contextId),styles:{dragging:i,dropAnimating:i,userCancel:i}}),o,{selector:r(Pn.contextId),styles:{always:"overflow-anchor: none;"}},{selector:"body",styles:{dragging:"\n        cursor: grabbing;\n        cursor: -webkit-grabbing;\n        user-select: none;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        overflow-anchor: none;\n      "}}];return{always:Dn(s,"always"),resting:Dn(s,"resting"),dragging:Dn(s,"dragging"),dropAnimating:Dn(s,"dropAnimating"),userCancel:Dn(s,"userCancel")}},On="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?r.useLayoutEffect:r.useEffect,Ln=function(){var e=document.querySelector("head");return e||b(!1),e},Un=function(e){var t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.type="text/css",t};var Fn=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function jn(e){return e instanceof Fn(e).HTMLElement}function Bn(e,t){var n="["+In.contextId+'="'+e+'"]',i=q(document.querySelectorAll(n));if(!i.length)return null;var r=J(i,(function(e){return e.getAttribute(In.draggableId)===t}));return r&&jn(r)?r:null}function Vn(){var e={draggables:{},droppables:{}},t=[];function n(e){t.length&&t.forEach((function(t){return t(e)}))}function i(t){return e.draggables[t]||null}function r(t){return e.droppables[t]||null}return{draggable:{register:function(t){e.draggables[t.descriptor.id]=t,n({type:"ADDITION",value:t})},update:function(t,n){var i=e.draggables[n.descriptor.id];i&&i.uniqueId===t.uniqueId&&(delete e.draggables[n.descriptor.id],e.draggables[t.descriptor.id]=t)},unregister:function(t){var r=t.descriptor.id,o=i(r);o&&t.uniqueId===o.uniqueId&&(delete e.draggables[r],n({type:"REMOVAL",value:t}))},getById:function(e){var t=i(e);return t||b(!1),t},findById:i,exists:function(e){return Boolean(i(e))},getAllByType:function(t){return G(e.draggables).filter((function(e){return e.descriptor.type===t}))}},droppable:{register:function(t){e.droppables[t.descriptor.id]=t},unregister:function(t){var n=r(t.descriptor.id);n&&t.uniqueId===n.uniqueId&&delete e.droppables[t.descriptor.id]},getById:function(e){var t=r(e);return t||b(!1),t},findById:r,exists:function(e){return Boolean(r(e))},getAllByType:function(t){return G(e.droppables).filter((function(e){return e.descriptor.type===t}))}},subscribe:function(e){return t.push(e),function(){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},clean:function(){e.draggables={},e.droppables={},t.length=0}}}var Hn=o.createContext(null),zn=function(){var e=document.body;return e||b(!1),e},Wn={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},Gn=function(e){return"rbd-announcement-"+e};var Kn=0,Jn={separator:"::"};function qn(e,t){return void 0===t&&(t=Jn),d.useMemo((function(){return""+e+t.separator+Kn++}),[t.separator,e])}var $n=o.createContext(null);function Yn(e){0}function Qn(e,t){Yn()}function Zn(e){var t=r.useRef(e);return r.useEffect((function(){t.current=e})),t}var Xn,ei=27,ti=32,ni=37,ii=38,ri=39,oi=40,si=((Xn={})[13]=!0,Xn[9]=!0,Xn),ai=function(e){si[e.keyCode]&&e.preventDefault()},li=function(){var e="visibilitychange";return"undefined"==typeof document?e:J([e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],(function(e){return"on"+e in document}))||e}(),ci=0,di=5;var ui,mi={type:"IDLE"};function hi(e){var t=e.cancel,n=e.completed,i=e.getPhase,r=e.setPhase;return[{eventName:"mousemove",fn:function(e){var t=e.button,n=e.clientX,o=e.clientY;if(t===ci){var s={x:n,y:o},a=i();if("DRAGGING"===a.type)return e.preventDefault(),void a.actions.move(s);"PENDING"!==a.type&&b(!1);var l=a.point;if(c=l,d=s,Math.abs(d.x-c.x)>=di||Math.abs(d.y-c.y)>=di){var c,d;e.preventDefault();var u=a.actions.fluidLift(s);r({type:"DRAGGING",actions:u})}}}},{eventName:"mouseup",fn:function(e){var r=i();"DRAGGING"===r.type?(e.preventDefault(),r.actions.drop({shouldBlockNextClick:!0}),n()):t()}},{eventName:"mousedown",fn:function(e){"DRAGGING"===i().type&&e.preventDefault(),t()}},{eventName:"keydown",fn:function(e){if("PENDING"!==i().type)return e.keyCode===ei?(e.preventDefault(),void t()):void ai(e);t()}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){"PENDING"===i().type&&t()}},{eventName:"webkitmouseforcedown",fn:function(e){var n=i();"IDLE"===n.type&&b(!1),n.actions.shouldRespectForcePress()?t():e.preventDefault()}},{eventName:li,fn:t}]}function pi(e){var t=r.useRef(mi),n=r.useRef(v),i=d.useMemo((function(){return{eventName:"mousedown",fn:function(t){if(!t.defaultPrevented&&t.button===ci&&!(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){var i=e.findClosestDraggableId(t);if(i){var r=e.tryGetLock(i,a,{sourceEvent:t});if(r){t.preventDefault();var o={x:t.clientX,y:t.clientY};n.current(),u(r,o)}}}}}}),[e]),o=d.useMemo((function(){return{eventName:"webkitmouseforcewillbegin",fn:function(t){if(!t.defaultPrevented){var n=e.findClosestDraggableId(t);if(n){var i=e.findOptionsForDraggable(n);i&&(i.shouldRespectForcePress||e.canGetLock(n)&&t.preventDefault())}}}}}),[e]),s=d.useCallback((function(){n.current=_(window,[o,i],{passive:!1,capture:!0})}),[o,i]),a=d.useCallback((function(){"IDLE"!==t.current.type&&(t.current=mi,n.current(),s())}),[s]),l=d.useCallback((function(){var e=t.current;a(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[a]),c=d.useCallback((function(){var e=hi({cancel:l,completed:a,getPhase:function(){return t.current},setPhase:function(e){t.current=e}});n.current=_(window,e,{capture:!0,passive:!1})}),[l,a]),u=d.useCallback((function(e,n){"IDLE"!==t.current.type&&b(!1),t.current={type:"PENDING",point:n,actions:e},c()}),[c]);On((function(){return s(),function(){n.current()}}),[s])}function gi(){}var vi=((ui={})[34]=!0,ui[33]=!0,ui[36]=!0,ui[35]=!0,ui);function _i(e,t){function n(){t(),e.cancel()}return[{eventName:"keydown",fn:function(i){return i.keyCode===ei?(i.preventDefault(),void n()):i.keyCode===ti?(i.preventDefault(),t(),void e.drop()):i.keyCode===oi?(i.preventDefault(),void e.moveDown()):i.keyCode===ii?(i.preventDefault(),void e.moveUp()):i.keyCode===ri?(i.preventDefault(),void e.moveRight()):i.keyCode===ni?(i.preventDefault(),void e.moveLeft()):void(vi[i.keyCode]?i.preventDefault():ai(i))}},{eventName:"mousedown",fn:n},{eventName:"mouseup",fn:n},{eventName:"click",fn:n},{eventName:"touchstart",fn:n},{eventName:"resize",fn:n},{eventName:"wheel",fn:n,options:{passive:!0}},{eventName:li,fn:n}]}function fi(e){var t=r.useRef(gi),n=d.useMemo((function(){return{eventName:"keydown",fn:function(n){if(!n.defaultPrevented&&n.keyCode===ti){var r=e.findClosestDraggableId(n);if(r){var o=e.tryGetLock(r,l,{sourceEvent:n});if(o){n.preventDefault();var s=!0,a=o.snapLift();t.current(),t.current=_(window,_i(a,l),{capture:!0,passive:!1})}}}function l(){s||b(!1),s=!1,t.current(),i()}}}}),[e]),i=d.useCallback((function(){t.current=_(window,[n],{passive:!1,capture:!0})}),[n]);On((function(){return i(),function(){t.current()}}),[i])}var yi={type:"IDLE"},Ei=.15;function bi(e){var t=r.useRef(yi),n=r.useRef(v),i=d.useCallback((function(){return t.current}),[]),o=d.useCallback((function(e){t.current=e}),[]),s=d.useMemo((function(){return{eventName:"touchstart",fn:function(t){if(!t.defaultPrevented){var i=e.findClosestDraggableId(t);if(i){var r=e.tryGetLock(i,l,{sourceEvent:t});if(r){var o=t.touches[0],s={x:o.clientX,y:o.clientY};n.current(),h(r,s)}}}}}}),[e]),a=d.useCallback((function(){n.current=_(window,[s],{capture:!0,passive:!1})}),[s]),l=d.useCallback((function(){var e=t.current;"IDLE"!==e.type&&("PENDING"===e.type&&clearTimeout(e.longPressTimerId),o(yi),n.current(),a())}),[a,o]),c=d.useCallback((function(){var e=t.current;l(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[l]),u=d.useCallback((function(){var e={capture:!0,passive:!1},t={cancel:c,completed:l,getPhase:i},r=_(window,function(e){var t=e.cancel,n=e.completed,i=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(e){var n=i();if("DRAGGING"===n.type){n.hasMoved=!0;var r=e.touches[0],o={x:r.clientX,y:r.clientY};e.preventDefault(),n.actions.move(o)}else t()}},{eventName:"touchend",fn:function(e){var r=i();"DRAGGING"===r.type?(e.preventDefault(),r.actions.drop({shouldBlockNextClick:!0}),n()):t()}},{eventName:"touchcancel",fn:function(e){"DRAGGING"===i().type?(e.preventDefault(),t()):t()}},{eventName:"touchforcechange",fn:function(e){var n=i();"IDLE"===n.type&&b(!1);var r=e.touches[0];if(r&&r.force>=Ei){var o=n.actions.shouldRespectForcePress();if("PENDING"!==n.type)return o?n.hasMoved?void e.preventDefault():void t():void e.preventDefault();o&&t()}}},{eventName:li,fn:t}]}(t),e),o=_(window,function(e){var t=e.cancel,n=e.getPhase;return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:function(e){e.preventDefault()}},{eventName:"keydown",fn:function(e){"DRAGGING"===n().type?(e.keyCode===ei&&e.preventDefault(),t()):t()}},{eventName:li,fn:t}]}(t),e);n.current=function(){r(),o()}}),[c,i,l]),m=d.useCallback((function(){var e=i();"PENDING"!==e.type&&b(!1);var t=e.actions.fluidLift(e.point);o({type:"DRAGGING",actions:t,hasMoved:!1})}),[i,o]),h=d.useCallback((function(e,t){"IDLE"!==i().type&&b(!1);var n=setTimeout(m,120);o({type:"PENDING",point:t,actions:e,longPressTimerId:n}),u()}),[u,i,o,m]);On((function(){return a(),function(){n.current();var e=i();"PENDING"===e.type&&(clearTimeout(e.longPressTimerId),o(yi))}}),[i,a,o]),On((function(){return _(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}])}),[])}var wi={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function xi(e,t){if(null==t)return!1;if(Boolean(wi[t.tagName.toLowerCase()]))return!0;var n=t.getAttribute("contenteditable");return"true"===n||""===n||t!==e&&xi(e,t.parentElement)}function Ai(e,t){var n=t.target;return!!jn(n)&&xi(e,n)}var Si=function(e){return u.getRect(e.getBoundingClientRect()).center};var Ci=function(){var e="matches";return"undefined"==typeof document?e:J([e,"msMatchesSelector","webkitMatchesSelector"],(function(e){return e in Element.prototype}))||e}();function ki(e,t){return null==e?null:e[Ci](t)?e:ki(e.parentElement,t)}function Ri(e,t){return e.closest?e.closest(t):ki(e,t)}function Ii(e,t){var n,i=t.target;if(!((n=i)instanceof Fn(n).Element))return null;var r=function(e){return"["+In.contextId+'="'+e+'"]'}(e),o=Ri(i,r);return o&&jn(o)?o:null}function Ti(e){e.preventDefault()}function Pi(e){var t=e.expected,n=e.phase,i=e.isLockActive;e.shouldWarn;return!!i()&&t===n}function Ni(e){var t=e.lockAPI,n=e.store,i=e.registry,r=e.draggableId;if(t.isClaimed())return!1;var o=i.draggable.findById(r);return!!o&&(!!o.options.isEnabled&&!!rn(n.getState(),r))}function Di(e){var t=e.lockAPI,n=e.contextId,i=e.store,r=e.registry,o=e.draggableId,s=e.forceSensorStop,l=e.sourceEvent;if(!Ni({lockAPI:t,store:i,registry:r,draggableId:o}))return null;var c=r.draggable.getById(o),d=function(e,t){var n="["+Tn.contextId+'="'+e+'"]',i=J(q(document.querySelectorAll(n)),(function(e){return e.getAttribute(Tn.id)===t}));return i&&jn(i)?i:null}(n,c.descriptor.id);if(!d)return null;if(l&&!c.options.canDragInteractiveElements&&Ai(d,l))return null;var u=t.claim(s||v),m="PRE_DRAG";function p(){return c.options.shouldRespectForcePress}function g(){return t.isActive(u)}var f=function(e,t){Pi({expected:e,phase:m,isLockActive:g,shouldWarn:!0})&&i.dispatch(t())}.bind(null,"DRAGGING");function y(e){function n(){t.release(),m="COMPLETED"}function r(t,r){if(void 0===r&&(r={shouldBlockNextClick:!1}),e.cleanup(),r.shouldBlockNextClick){var o=_(window,[{eventName:"click",fn:Ti,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(o)}n(),i.dispatch(xt({reason:t}))}return"PRE_DRAG"!==m&&(n(),"PRE_DRAG"!==m&&b(!1)),i.dispatch(dt(e.liftActionArgs)),m="DRAGGING",a({isActive:function(){return Pi({expected:"DRAGGING",phase:m,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:p,drop:function(e){return r("DROP",e)},cancel:function(e){return r("CANCEL",e)}},e.actions)}return{isActive:function(){return Pi({expected:"PRE_DRAG",phase:m,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:p,fluidLift:function(e){var t=h((function(e){f((function(){return vt({client:e})}))})),n=y({liftActionArgs:{id:o,clientSelection:e,movementMode:"FLUID"},cleanup:function(){return t.cancel()},actions:{move:t}});return a({},n,{move:t})},snapLift:function(){var e={moveUp:function(){return f(_t)},moveRight:function(){return f(yt)},moveDown:function(){return f(ft)},moveLeft:function(){return f(Et)}};return y({liftActionArgs:{id:o,clientSelection:Si(d),movementMode:"SNAP"},cleanup:v,actions:e})},abort:function(){Pi({expected:"PRE_DRAG",phase:m,isLockActive:g,shouldWarn:!0})&&t.release()}}}var Mi=[pi,fi,bi];function Oi(e){var t=e.contextId,n=e.store,i=e.registry,o=e.customSensors,s=e.enableDefaultSensors,a=[].concat(s?Mi:[],o||[]),l=r.useState((function(){return function(){var e=null;function t(){e||b(!1),e=null}return{isClaimed:function(){return Boolean(e)},isActive:function(t){return t===e},claim:function(t){e&&b(!1);var n={abandon:t};return e=n,n},release:t,tryAbandon:function(){e&&(e.abandon(),t())}}}()}))[0],c=d.useCallback((function(e,t){e.isDragging&&!t.isDragging&&l.tryAbandon()}),[l]);On((function(){var e=n.getState();return n.subscribe((function(){var t=n.getState();c(e,t),e=t}))}),[l,n,c]),On((function(){return l.tryAbandon}),[l.tryAbandon]);var u=d.useCallback((function(e){return Ni({lockAPI:l,registry:i,store:n,draggableId:e})}),[l,i,n]),m=d.useCallback((function(e,r,o){return Di({lockAPI:l,registry:i,contextId:t,store:n,draggableId:e,forceSensorStop:r,sourceEvent:o&&o.sourceEvent?o.sourceEvent:null})}),[t,l,i,n]),h=d.useCallback((function(e){return function(e,t){var n=Ii(e,t);return n?n.getAttribute(In.draggableId):null}(t,e)}),[t]),p=d.useCallback((function(e){var t=i.draggable.findById(e);return t?t.options:null}),[i.draggable]),g=d.useCallback((function(){l.isClaimed()&&(l.tryAbandon(),"IDLE"!==n.getState().phase&&n.dispatch(bt()))}),[l,n]),v=d.useCallback(l.isClaimed,[l]),_=d.useMemo((function(){return{canGetLock:u,tryGetLock:m,findClosestDraggableId:h,findOptionsForDraggable:p,tryReleaseLock:g,isLockClaimed:v}}),[u,m,h,p,g,v]);Yn();for(var f=0;f<a.length;f++)a[f](_)}var Li=function(e){return{onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDragUpdate:e.onDragUpdate}};function Ui(e){return e.current||b(!1),e.current}function Fi(e){var t=e.contextId,n=e.setCallbacks,i=e.sensors,s=e.nonce,u=e.dragHandleUsageInstructions,h=r.useRef(null);Qn();var p=Zn(e),g=d.useCallback((function(){return Li(p.current)}),[p]),v=function(e){var t=d.useMemo((function(){return Gn(e)}),[e]),n=r.useRef(null);return r.useEffect((function(){var e=document.createElement("div");return n.current=e,e.id=t,e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),a(e.style,Wn),zn().appendChild(e),function(){setTimeout((function(){var t=zn();t.contains(e)&&t.removeChild(e),e===n.current&&(n.current=null)}))}}),[t]),d.useCallback((function(e){var t=n.current;t&&(t.textContent=e)}),[])}(t),_=function(e){var t=e.contextId,n=e.text,i=qn("hidden-text",{separator:"-"}),o=d.useMemo((function(){return"rbd-hidden-text-"+(e={contextId:t,uniqueId:i}).contextId+"-"+e.uniqueId;var e}),[i,t]);return r.useEffect((function(){var e=document.createElement("div");return e.id=o,e.textContent=n,e.style.display="none",zn().appendChild(e),function(){var t=zn();t.contains(e)&&t.removeChild(e)}}),[o,n]),o}({contextId:t,text:u}),f=function(e,t){var n=d.useMemo((function(){return Mn(e)}),[e]),i=r.useRef(null),o=r.useRef(null),s=d.useCallback(m((function(e){var t=o.current;t||b(!1),t.textContent=e})),[]),a=d.useCallback((function(e){var t=i.current;t||b(!1),t.textContent=e}),[]);On((function(){(i.current||o.current)&&b(!1);var r=Un(t),l=Un(t);return i.current=r,o.current=l,r.setAttribute(Rn+"-always",e),l.setAttribute(Rn+"-dynamic",e),Ln().appendChild(r),Ln().appendChild(l),a(n.always),s(n.resting),function(){var e=function(e){var t=e.current;t||b(!1),Ln().removeChild(t),e.current=null};e(i),e(o)}}),[t,a,s,n.always,n.resting,e]);var l=d.useCallback((function(){return s(n.dragging)}),[s,n.dragging]),c=d.useCallback((function(e){s("DROP"!==e?n.userCancel:n.dropAnimating)}),[s,n.dropAnimating,n.userCancel]),u=d.useCallback((function(){o.current&&s(n.resting)}),[s,n.resting]);return d.useMemo((function(){return{dragging:l,dropping:c,resting:u}}),[l,c,u])}(t,s),y=d.useCallback((function(e){Ui(h).dispatch(e)}),[]),E=d.useMemo((function(){return l.bindActionCreators({publishWhileDragging:ut,updateDroppableScroll:ht,updateDroppableIsEnabled:pt,updateDroppableIsCombineEnabled:gt,collectionStarting:mt},y)}),[y]),w=function(){var e=d.useMemo(Vn,[]);return r.useEffect((function(){return function(){requestAnimationFrame(e.clean)}}),[e]),e}(),x=d.useMemo((function(){return nn(w,E)}),[w,E]),A=d.useMemo((function(){return kn(a({scrollWindow:on,scrollDroppable:x.scrollDroppable},l.bindActionCreators({move:vt},y)))}),[x.scrollDroppable,y]),S=function(e){var t=r.useRef({}),n=r.useRef(null),i=r.useRef(null),o=r.useRef(!1),s=d.useCallback((function(e,n){var i={id:e,focus:n};return t.current[e]=i,function(){var n=t.current;n[e]!==i&&delete n[e]}}),[]),a=d.useCallback((function(t){var n=Bn(e,t);n&&n!==document.activeElement&&n.focus()}),[e]),l=d.useCallback((function(e,t){n.current===e&&(n.current=t)}),[]),c=d.useCallback((function(){i.current||o.current&&(i.current=requestAnimationFrame((function(){i.current=null;var e=n.current;e&&a(e)})))}),[a]),u=d.useCallback((function(e){n.current=null;var t=document.activeElement;t&&t.getAttribute(In.draggableId)===e&&(n.current=e)}),[]);return On((function(){return o.current=!0,function(){o.current=!1;var e=i.current;e&&cancelAnimationFrame(e)}}),[]),d.useMemo((function(){return{register:s,tryRecordFocus:u,tryRestoreFocusRecorded:c,tryShiftRecord:l}}),[s,u,c,l])}(t),C=d.useMemo((function(){return qt({announce:v,autoScroller:A,dimensionMarshal:x,focusMarshal:S,getResponders:g,styleMarshal:f})}),[v,A,x,S,g,f]);h.current=C;var k=d.useCallback((function(){var e=Ui(h);"IDLE"!==e.getState().phase&&e.dispatch(bt())}),[]),R=d.useCallback((function(){var e=Ui(h).getState();return e.isDragging||"DROP_ANIMATING"===e.phase}),[]);n(d.useMemo((function(){return{isDragging:R,tryAbort:k}}),[R,k]));var I=d.useCallback((function(e){return rn(Ui(h).getState(),e)}),[]),T=d.useCallback((function(){return ze(Ui(h).getState())}),[]),P=d.useMemo((function(){return{marshal:x,focus:S,contextId:t,canLift:I,isMovementAllowed:T,dragHandleUsageInstructionsId:_,registry:w}}),[t,x,_,S,I,T,w]);return Oi({contextId:t,store:C,registry:w,customSensors:i,enableDefaultSensors:!1!==e.enableDefaultSensors}),r.useEffect((function(){return k}),[k]),o.createElement($n.Provider,{value:P},o.createElement(c.Provider,{context:Hn,store:C},e.children))}var ji=0;var Bi=function(e){return function(t){return e===t}},Vi=Bi("scroll"),Hi=Bi("auto"),zi=(Bi("visible"),function(e,t){return t(e.overflowX)||t(e.overflowY)}),Wi=function(e){var t=window.getComputedStyle(e),n={overflowX:t.overflowX,overflowY:t.overflowY};return zi(n,Vi)||zi(n,Hi)},Gi=function e(t){return null==t||t===document.body||t===document.documentElement?null:Wi(t)?t:e(t.parentElement)},Ki=function(e){return{x:e.scrollLeft,y:e.scrollTop}},Ji=function e(t){return!!t&&("fixed"===window.getComputedStyle(t).position||e(t.parentElement))},qi=function(e){return{closestScrollable:Gi(e),isFixedOnPage:Ji(e)}},$i=function(e){var t=e.ref,n=e.descriptor,i=e.env,r=e.windowScroll,o=e.direction,s=e.isDropDisabled,a=e.isCombineEnabled,l=e.shouldClipSubject,c=i.closestScrollable,d=function(e,t){var n=u.getBox(e);if(!t)return n;if(e!==t)return n;var i=n.paddingBox.top-t.scrollTop,r=n.paddingBox.left-t.scrollLeft,o=i+t.scrollHeight,s={top:i,right:r+t.scrollWidth,bottom:o,left:r},a=u.expand(s,n.border);return u.createBox({borderBox:a,margin:n.margin,border:n.border,padding:n.padding})}(t,c),m=u.withScroll(d,r),h=function(){if(!c)return null;var e=u.getBox(c),t={scrollHeight:c.scrollHeight,scrollWidth:c.scrollWidth};return{client:e,page:u.withScroll(e,r),scroll:Ki(c),scrollSize:t,shouldClipSubject:l}}(),p=function(e){var t=e.descriptor,n=e.isEnabled,i=e.isCombineEnabled,r=e.isFixedOnPage,o=e.direction,s=e.client,a=e.page,l=e.closest,c=function(){if(!l)return null;var e=l.scrollSize,t=l.client,n=$t({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,height:t.paddingBox.height,width:t.paddingBox.width});return{pageMarginBox:l.page.marginBox,frameClient:t,scrollSize:e,shouldClipSubject:l.shouldClipSubject,scroll:{initial:l.scroll,current:l.scroll,max:n,diff:{value:P,displacement:P}}}}(),d="vertical"===o?de:ue;return{descriptor:t,isCombineEnabled:i,isFixedOnPage:r,axis:d,isEnabled:n,client:s,page:a,frame:c,subject:z({page:a,withPlaceholder:null,axis:d,frame:c})}}({descriptor:n,isEnabled:!s,isCombineEnabled:a,isFixedOnPage:i.isFixedOnPage,direction:o,client:d,page:m,closest:h});return p},Yi={passive:!1},Qi={passive:!0},Zi=function(e){return e.shouldPublishImmediately?Yi:Qi};function Xi(e){var t=r.useContext(e);return t||b(!1),t}var er=function(e){return e&&e.env.closestScrollable||null};function tr(){}var nr={width:0,height:0,margin:{top:0,right:0,bottom:0,left:0}},ir=function(e){var t=e.isAnimatingOpenOnMount,n=e.placeholder,i=e.animate,r=function(e){var t=e.isAnimatingOpenOnMount,n=e.placeholder,i=e.animate;return t||"close"===i?nr:{height:n.client.borderBox.height,width:n.client.borderBox.width,margin:n.client.margin}}({isAnimatingOpenOnMount:t,placeholder:n,animate:i});return{display:n.display,boxSizing:"border-box",width:r.width,height:r.height,marginTop:r.margin.top,marginRight:r.margin.right,marginBottom:r.margin.bottom,marginLeft:r.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:"none"!==i?It.placeholder:null}};var rr=o.memo((function(e){var t=r.useRef(null),n=d.useCallback((function(){t.current&&(clearTimeout(t.current),t.current=null)}),[]),i=e.animate,s=e.onTransitionEnd,a=e.onClose,l=e.contextId,c=r.useState("open"===e.animate),u=c[0],m=c[1];r.useEffect((function(){return u?"open"!==i?(n(),m(!1),tr):t.current?tr:(t.current=setTimeout((function(){t.current=null,m(!1)})),n):tr}),[i,u,n]);var h=d.useCallback((function(e){"height"===e.propertyName&&(s(),"close"===i&&a())}),[i,a,s]),p=ir({isAnimatingOpenOnMount:u,animate:e.animate,placeholder:e.placeholder});return o.createElement(e.placeholder.tagName,{style:p,"data-rbd-placeholder-context-id":l,onTransitionEnd:h,ref:e.innerRef})})),or=o.createContext(null);var sr=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).state={isVisible:Boolean(t.props.on),data:t.props.on,animate:t.props.shouldAnimate&&t.props.on?"open":"none"},t.onClose=function(){"close"===t.state.animate&&t.setState({isVisible:!1})},t}return s(t,e),t.getDerivedStateFromProps=function(e,t){return e.shouldAnimate?e.on?{isVisible:!0,data:e.on,animate:"open"}:t.isVisible?{isVisible:!0,data:t.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:Boolean(e.on),data:e.on,animate:"none"}},t.prototype.render=function(){if(!this.state.isVisible)return null;var e={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(e)},t}(o.PureComponent),ar={dragging:5e3,dropAnimating:4500},lr=function(e,t){return t?It.drop(t.duration):e?It.snap:It.fluid},cr=function(e,t){return e?t?Ct.drop:Ct.combining:null},dr=function(e){return null!=e.forceShouldAnimate?e.forceShouldAnimate:"SNAP"===e.mode};function ur(e){return"DRAGGING"===e.type?(i=(n=e).dimension.client,r=n.offset,o=n.combineWith,s=n.dropping,a=Boolean(o),l=dr(n),c=Boolean(s),d=c?Pt.drop(r,a):Pt.moveTo(r),{position:"fixed",top:i.marginBox.top,left:i.marginBox.left,boxSizing:"border-box",width:i.borderBox.width,height:i.borderBox.height,transition:lr(l,s),transform:d,opacity:cr(a,c),zIndex:c?ar.dropAnimating:ar.dragging,pointerEvents:"none"}):(t=e,{transform:Pt.moveTo(t.offset),transition:t.shouldAnimateDisplacement?null:"none"});var t,n,i,r,o,s,a,l,c,d}function mr(e){var t=qn("draggable"),n=e.descriptor,i=e.registry,o=e.getDraggableRef,s=e.canDragInteractiveElements,a=e.shouldRespectForcePress,l=e.isEnabled,c=d.useMemo((function(){return{canDragInteractiveElements:s,shouldRespectForcePress:a,isEnabled:l}}),[s,l,a]),m=d.useCallback((function(e){var t=o();return t||b(!1),function(e,t,n){void 0===n&&(n=P);var i=window.getComputedStyle(t),r=t.getBoundingClientRect(),o=u.calculateBox(r,i),s=u.withScroll(o,n);return{descriptor:e,placeholder:{client:o,tagName:t.tagName.toLowerCase(),display:i.display},displaceBy:{x:o.marginBox.width,y:o.marginBox.height},client:o,page:s}}(n,t,e)}),[n,o]),h=d.useMemo((function(){return{uniqueId:t,descriptor:n,options:c,getDimension:m}}),[n,m,c,t]),p=r.useRef(h),g=r.useRef(!0);On((function(){return i.draggable.register(p.current),function(){return i.draggable.unregister(p.current)}}),[i.draggable]),On((function(){if(g.current)g.current=!1;else{var e=p.current;p.current=h,i.draggable.update(h,e)}}),[h,i.draggable])}function hr(e,t,n){Qn()}function pr(e){e.preventDefault()}var gr=function(e,t){return e===t},vr=function(e){var t=e.combine,n=e.destination;return n?n.droppableId:t?t.droppableId:null};function _r(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var fr={mapped:{type:"SECONDARY",offset:P,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:_r(null)}};var yr={dropAnimationFinished:At},Er=c.connect((function(){var e,t,n,i=(e=m((function(e,t){return{x:e,y:t}})),t=m((function(e,t,n,i,r){return{isDragging:!0,isClone:t,isDropAnimating:Boolean(r),dropAnimation:r,mode:e,draggingOver:n,combineWith:i,combineTargetFor:null}})),n=m((function(e,n,i,r,o,s,a){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:o,combineWith:s,mode:n,offset:e,dimension:i,forceShouldAnimate:a,snapshot:t(n,r,o,s,null)}}})),function(i,r){if(i.isDragging){if(i.critical.draggable.id!==r.draggableId)return null;var o=i.current.client.offset,s=i.dimensions.draggables[r.draggableId],a=Ve(i.impact),l=(d=i.impact).at&&"COMBINE"===d.at.type?d.at.combine.draggableId:null,c=i.forceShouldAnimate;return n(e(o.x,o.y),i.movementMode,s,r.isClone,a,l,c)}var d;if("DROP_ANIMATING"===i.phase){var u=i.completed;if(u.result.draggableId!==r.draggableId)return null;var m=r.isClone,h=i.dimensions.draggables[r.draggableId],p=u.result,g=p.mode,v=vr(p),_=function(e){return e.combine?e.combine.draggableId:null}(p),f={duration:i.dropDuration,curve:St,moveTo:i.newHomeClientOffset,opacity:_?Ct.drop:null,scale:_?kt.drop:null};return{mapped:{type:"DRAGGING",offset:i.newHomeClientOffset,dimension:h,dropping:f,draggingOver:v,combineWith:_,mode:g,forceShouldAnimate:null,snapshot:t(g,m,v,_,f)}}}return null}),r=function(){var e=m((function(e,t){return{x:e,y:t}})),t=m(_r),n=m((function(e,n,i){return void 0===n&&(n=null),{mapped:{type:"SECONDARY",offset:e,combineTargetFor:n,shouldAnimateDisplacement:i,snapshot:t(n)}}})),i=function(e){return e?n(P,e,!0):null},r=function(t,r,o,s){var a=o.displaced.visible[t],l=Boolean(s.inVirtualList&&s.effected[t]),c=te(o),d=c&&c.draggableId===t?r:null;if(!a){if(!l)return i(d);if(o.displaced.invisible[t])return null;var u=O(s.displacedBy.point),m=e(u.x,u.y);return n(m,d,!0)}if(l)return i(d);var h=o.displacedBy.point,p=e(h.x,h.y);return n(p,d,a.shouldAnimate)};return function(e,t){if(e.isDragging)return e.critical.draggable.id===t.draggableId?null:r(t.draggableId,e.critical.draggable.id,e.impact,e.afterCritical);if("DROP_ANIMATING"===e.phase){var n=e.completed;return n.result.draggableId===t.draggableId?null:r(t.draggableId,n.result.draggableId,n.impact,n.afterCritical)}return null}}();return function(e,t){return i(e,t)||r(e,t)||fr}}),yr,null,{context:Hn,pure:!0,areStatePropsEqual:gr})((function(e){var t=r.useRef(null),n=d.useCallback((function(e){t.current=e}),[]),i=d.useCallback((function(){return t.current}),[]),o=Xi($n),s=o.contextId,a=o.dragHandleUsageInstructionsId,l=o.registry,c=Xi(or),u=c.type,m=c.droppableId,h=d.useMemo((function(){return{id:e.draggableId,index:e.index,type:u,droppableId:m}}),[e.draggableId,e.index,u,m]),p=e.children,g=e.draggableId,v=e.isEnabled,_=e.shouldRespectForcePress,f=e.canDragInteractiveElements,y=e.isClone,E=e.mapped,b=e.dropAnimationFinished;hr(),Yn(),y||mr(d.useMemo((function(){return{descriptor:h,registry:l,getDraggableRef:i,canDragInteractiveElements:f,shouldRespectForcePress:_,isEnabled:v}}),[h,l,i,f,_,v]));var w=d.useMemo((function(){return v?{tabIndex:0,role:"button","aria-describedby":a,"data-rbd-drag-handle-draggable-id":g,"data-rbd-drag-handle-context-id":s,draggable:!1,onDragStart:pr}:null}),[s,a,g,v]),x=d.useCallback((function(e){"DRAGGING"===E.type&&E.dropping&&"transform"===e.propertyName&&b()}),[b,E]),A=d.useMemo((function(){var e=ur(E),t="DRAGGING"===E.type&&E.dropping?x:null;return{innerRef:n,draggableProps:{"data-rbd-draggable-context-id":s,"data-rbd-draggable-id":g,style:e,onTransitionEnd:t},dragHandleProps:w}}),[s,w,g,E,x,n]),S=d.useMemo((function(){return{draggableId:h.id,type:h.type,source:{index:h.index,droppableId:h.droppableId}}}),[h.droppableId,h.id,h.index,h.type]);return p(A,E.snapshot,S)}));function br(e){return Xi(or).isUsingCloneFor!==e.draggableId||e.isClone?o.createElement(Er,e):null}var wr=function(e,t){return e===t.droppable.type},xr=function(e,t){return t.draggables[e.draggable.id]},Ar={updateViewportMaxScroll:function(e){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:e}}};var Sr={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:function(){return document.body||b(!1),document.body}},Cr=c.connect((function(){var e={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t=a({},e,{shouldAnimatePlaceholder:!1}),n=m((function(e){return{draggableId:e.id,type:e.type,source:{index:e.index,droppableId:e.droppableId}}})),i=m((function(i,r,o,s,a,l){var c=a.descriptor.id;if(a.descriptor.droppableId===i){var d=l?{render:l,dragging:n(a.descriptor)}:null,u={isDraggingOver:o,draggingOverWith:o?c:null,draggingFromThisWith:c,isUsingPlaceholder:!0};return{placeholder:a.placeholder,shouldAnimatePlaceholder:!1,snapshot:u,useClone:d}}if(!r)return t;if(!s)return e;var m={isDraggingOver:o,draggingOverWith:c,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:a.placeholder,shouldAnimatePlaceholder:!0,snapshot:m,useClone:null}}));return function(n,r){var o=r.droppableId,s=r.type,a=!r.isDropDisabled,l=r.renderClone;if(n.isDragging){var c=n.critical;if(!wr(s,c))return t;var d=xr(c,n.dimensions),u=Ve(n.impact)===o;return i(o,a,u,u,d,l)}if("DROP_ANIMATING"===n.phase){var m=n.completed;if(!wr(s,m.critical))return t;var h=xr(m.critical,n.dimensions);return i(o,a,vr(m.result)===o,Ve(m.impact)===o,h,l)}if("IDLE"===n.phase&&n.completed&&!n.shouldFlush){var p=n.completed;if(!wr(s,p.critical))return t;var g=Ve(p.impact)===o,v=Boolean(p.impact.at&&"COMBINE"===p.impact.at.type),_=p.critical.droppable.id===o;return g?v?e:t:_?e:t}return t}}),Ar,null,{context:Hn,pure:!0,areStatePropsEqual:gr})((function(e){var t=r.useContext($n);t||b(!1);var n=t.contextId,i=t.isMovementAllowed,s=r.useRef(null),a=r.useRef(null),l=e.children,c=e.droppableId,u=e.type,g=e.mode,v=e.direction,_=e.ignoreContainerClipping,f=e.isDropDisabled,y=e.isCombineEnabled,E=e.snapshot,w=e.useClone,x=e.updateViewportMaxScroll,A=e.getContainerForClone,S=d.useCallback((function(){return s.current}),[]),C=d.useCallback((function(e){s.current=e}),[]),k=(d.useCallback((function(){return a.current}),[]),d.useCallback((function(e){a.current=e}),[]));Qn();var R=d.useCallback((function(){i()&&x({maxScroll:Qt()})}),[i,x]);!function(e){var t=r.useRef(null),n=Xi($n),i=qn("droppable"),o=n.registry,s=n.marshal,a=Zn(e),l=d.useMemo((function(){return{id:e.droppableId,type:e.type,mode:e.mode}}),[e.droppableId,e.mode,e.type]),c=r.useRef(l),u=d.useMemo((function(){return m((function(e,n){t.current||b(!1);var i={x:e,y:n};s.updateDroppableScroll(l.id,i)}))}),[l.id,s]),p=d.useCallback((function(){var e=t.current;return e&&e.env.closestScrollable?Ki(e.env.closestScrollable):P}),[]),g=d.useCallback((function(){var e=p();u(e.x,e.y)}),[p,u]),v=d.useMemo((function(){return h(g)}),[g]),_=d.useCallback((function(){var e=t.current,n=er(e);e&&n||b(!1),e.scrollOptions.shouldPublishImmediately?g():v()}),[v,g]),f=d.useCallback((function(e,i){t.current&&b(!1);var r=a.current,o=r.getDroppableRef();o||b(!1);var s=qi(o),c={ref:o,descriptor:l,env:s,scrollOptions:i};t.current=c;var d=$i({ref:o,descriptor:l,env:s,windowScroll:e,direction:r.direction,isDropDisabled:r.isDropDisabled,isCombineEnabled:r.isCombineEnabled,shouldClipSubject:!r.ignoreContainerClipping}),u=s.closestScrollable;return u&&(u.setAttribute(Nn.contextId,n.contextId),u.addEventListener("scroll",_,Zi(c.scrollOptions))),d}),[n.contextId,l,_,a]),y=d.useCallback((function(){var e=t.current,n=er(e);return e&&n||b(!1),Ki(n)}),[]),E=d.useCallback((function(){var e=t.current;e||b(!1);var n=er(e);t.current=null,n&&(v.cancel(),n.removeAttribute(Nn.contextId),n.removeEventListener("scroll",_,Zi(e.scrollOptions)))}),[_,v]),w=d.useCallback((function(e){var n=t.current;n||b(!1);var i=er(n);i||b(!1),i.scrollTop+=e.y,i.scrollLeft+=e.x}),[]),x=d.useMemo((function(){return{getDimensionAndWatchScroll:f,getScrollWhileDragging:y,dragStopped:E,scroll:w}}),[E,f,y,w]),A=d.useMemo((function(){return{uniqueId:i,descriptor:l,callbacks:x}}),[x,l,i]);On((function(){return c.current=A.descriptor,o.droppable.register(A),function(){t.current&&E(),o.droppable.unregister(A)}}),[x,l,E,A,s,o.droppable]),On((function(){t.current&&s.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)}),[e.isDropDisabled,s]),On((function(){t.current&&s.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)}),[e.isCombineEnabled,s])}({droppableId:c,type:u,mode:g,direction:v,isDropDisabled:f,isCombineEnabled:y,ignoreContainerClipping:_,getDroppableRef:S});var I=o.createElement(sr,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},(function(e){var t=e.onClose,i=e.data,r=e.animate;return o.createElement(rr,{placeholder:i,onClose:t,innerRef:k,animate:r,contextId:n,onTransitionEnd:R})})),T=d.useMemo((function(){return{innerRef:C,placeholder:I,droppableProps:{"data-rbd-droppable-id":c,"data-rbd-droppable-context-id":n}}}),[n,c,I,C]),N=w?w.dragging.draggableId:null,D=d.useMemo((function(){return{droppableId:c,type:u,isUsingCloneFor:N}}),[c,N,u]);return o.createElement(or.Provider,{value:D},l(T,E),function(){if(!w)return null;var e=w.dragging,t=w.render,n=o.createElement(br,{draggableId:e.draggableId,index:e.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(function(n,i){return t(n,i,e)}));return p.createPortal(n,A())}())}));Cr.defaultProps=Sr,t.JY=function(e){var t=d.useMemo((function(){return""+ji++}),[]),n=e.dragHandleUsageInstructions||k;return o.createElement(w,null,(function(i){return o.createElement(Fi,{nonce:e.nonce,contextId:t,setCallbacks:i,dragHandleUsageInstructions:n,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)}))},t.sx=function(e){var t="boolean"!=typeof e.isDragDisabled||!e.isDragDisabled,n=Boolean(e.disableInteractiveElementBlocking),i=Boolean(e.shouldRespectForcePress);return o.createElement(br,a({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:n,shouldRespectForcePress:i}))},t.gL=Cr},"./node_modules/react-beautiful-dnd/node_modules/memoize-one/dist/memoize-one.cjs.js":e=>{"use strict";var t=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function n(e,n){if(e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(r=e[i],o=n[i],!(r===o||t(r)&&t(o)))return!1;var r,o;return!0}e.exports=function(e,t){var i;void 0===t&&(t=n);var r,o=[],s=!1;return function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];return s&&i===this&&t(n,o)||(r=e.apply(this,n),s=!0,i=this,o=n),r}}},"./node_modules/react-dom/cjs/react-dom-server.browser.production.min.js":(e,t,n)=>{"use strict";var i=n("./node_modules/object-assign/index.js"),r=n("./node_modules/react/index.js");function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=60106,a=60107,l=60108,c=60114,d=60109,u=60110,m=60112,h=60113,p=60120,g=60115,v=60116,_=60121,f=60117,y=60119,E=60129,b=60131;if("function"==typeof Symbol&&Symbol.for){var w=Symbol.for;s=w("react.portal"),a=w("react.fragment"),l=w("react.strict_mode"),c=w("react.profiler"),d=w("react.provider"),u=w("react.context"),m=w("react.forward_ref"),h=w("react.suspense"),p=w("react.suspense_list"),g=w("react.memo"),v=w("react.lazy"),_=w("react.block"),f=w("react.fundamental"),y=w("react.scope"),E=w("react.debug_trace_mode"),b=w("react.legacy_hidden")}function x(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case a:return"Fragment";case s:return"Portal";case c:return"Profiler";case l:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case u:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case g:return x(e.type);case _:return x(e._render);case v:t=e._payload,e=e._init;try{return x(e(t))}catch(e){}}return null}var A=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S={};function C(e,t){for(var n=0|e._threadCount;n<=t;n++)e[n]=e._currentValue2,e._threadCount=n+1}for(var k=new Uint16Array(16),R=0;15>R;R++)k[R]=R+1;k[15]=0;var I=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,T=Object.prototype.hasOwnProperty,P={},N={};function D(e){return!!T.call(N,e)||!T.call(P,e)&&(I.test(e)?N[e]=!0:(P[e]=!0,!1))}function M(e,t,n,i,r,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var O={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){O[e]=new M(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];O[t]=new M(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){O[e]=new M(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){O[e]=new M(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){O[e]=new M(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){O[e]=new M(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){O[e]=new M(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){O[e]=new M(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){O[e]=new M(e,5,!1,e.toLowerCase(),null,!1,!1)}));var L=/[\-:]([a-z])/g;function U(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(L,U);O[t]=new M(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(L,U);O[t]=new M(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(L,U);O[t]=new M(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){O[e]=new M(e,1,!1,e.toLowerCase(),null,!1,!1)})),O.xlinkHref=new M("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){O[e]=new M(e,1,!1,e.toLowerCase(),null,!0,!0)}));var F=/["'&<>]/;function j(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=F.exec(e);if(t){var n,i="",r=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}r!==n&&(i+=e.substring(r,n)),r=n+1,i+=t}e=r!==n?i+e.substring(r,n):i}return e}function B(e,t){var n,i=O.hasOwnProperty(e)?O[e]:null;return(n="style"!==e)&&(n=null!==i?0===i.type:2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])),n||function(e,t,n,i){if(null==t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(e,t,i,!1)?"":null!==i?(e=i.attributeName,3===(n=i.type)||4===n&&!0===t?e+'=""':(i.sanitizeURL&&(t=""+t),e+'="'+j(t)+'"')):D(e)?e+'="'+j(t)+'"':""}var V="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},H=null,z=null,W=null,G=!1,K=!1,J=null,q=0;function $(){if(null===H)throw Error(o(321));return H}function Y(){if(0<q)throw Error(o(312));return{memoizedState:null,queue:null,next:null}}function Q(){return null===W?null===z?(G=!1,z=W=Y()):(G=!0,W=z):null===W.next?(G=!1,W=W.next=Y()):(G=!0,W=W.next),W}function Z(e,t,n,i){for(;K;)K=!1,q+=1,W=null,n=e(t,i);return X(),n}function X(){H=null,K=!1,z=null,q=0,W=J=null}function ee(e,t){return"function"==typeof t?t(e):t}function te(e,t,n){if(H=$(),W=Q(),G){var i=W.queue;if(t=i.dispatch,null!==J&&void 0!==(n=J.get(i))){J.delete(i),i=W.memoizedState;do{i=e(i,n.action),n=n.next}while(null!==n);return W.memoizedState=i,[i,t]}return[W.memoizedState,t]}return e=e===ee?"function"==typeof t?t():t:void 0!==n?n(t):t,W.memoizedState=e,e=(e=W.queue={last:null,dispatch:null}).dispatch=ie.bind(null,H,e),[W.memoizedState,e]}function ne(e,t){if(H=$(),t=void 0===t?null:t,null!==(W=Q())){var n=W.memoizedState;if(null!==n&&null!==t){var i=n[1];e:if(null===i)i=!1;else{for(var r=0;r<i.length&&r<t.length;r++)if(!V(t[r],i[r])){i=!1;break e}i=!0}if(i)return n[0]}}return e=e(),W.memoizedState=[e,t],e}function ie(e,t,n){if(!(25>q))throw Error(o(301));if(e===H)if(K=!0,e={action:n,next:null},null===J&&(J=new Map),void 0===(n=J.get(t)))J.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}}function re(){}var oe=null,se={readContext:function(e){var t=oe.threadID;return C(e,t),e[t]},useContext:function(e){$();var t=oe.threadID;return C(e,t),e[t]},useMemo:ne,useReducer:te,useRef:function(e){H=$();var t=(W=Q()).memoizedState;return null===t?(e={current:e},W.memoizedState=e):t},useState:function(e){return te(ee,e)},useLayoutEffect:function(){},useCallback:function(e,t){return ne((function(){return e}),t)},useImperativeHandle:re,useEffect:re,useDebugValue:re,useDeferredValue:function(e){return $(),e},useTransition:function(){return $(),[function(e){e()},!1]},useOpaqueIdentifier:function(){return(oe.identifierPrefix||"")+"R:"+(oe.uniqueID++).toString(36)},useMutableSource:function(e,t){return $(),t(e._source)}},ae="http://www.w3.org/1999/xhtml";function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}var ce={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},de=i({menuitem:!0},ce),ue={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];Object.keys(ue).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ue[t]=ue[e]}))}));var he=/([A-Z])/g,pe=/^ms-/,ge=r.Children.toArray,ve=A.ReactCurrentDispatcher,_e={listing:!0,pre:!0,textarea:!0},fe=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,ye={},Ee={};var be=Object.prototype.hasOwnProperty,we={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null,suppressHydrationWarning:null};function xe(e,t){if(void 0===e)throw Error(o(152,x(t)||"Component"))}function Ae(e,t,n){function s(r,s){var a=s.prototype&&s.prototype.isReactComponent,l=function(e,t,n,i){if(i&&"object"==typeof(i=e.contextType)&&null!==i)return C(i,n),i[n];if(e=e.contextTypes){for(var r in n={},e)n[r]=t[r];t=n}else t=S;return t}(s,t,n,a),c=[],d=!1,u={isMounted:function(){return!1},enqueueForceUpdate:function(){if(null===c)return null},enqueueReplaceState:function(e,t){d=!0,c=[t]},enqueueSetState:function(e,t){if(null===c)return null;c.push(t)}};if(a){if(a=new s(r.props,l,u),"function"==typeof s.getDerivedStateFromProps){var m=s.getDerivedStateFromProps.call(null,r.props,a.state);null!=m&&(a.state=i({},a.state,m))}}else if(H={},a=s(r.props,l,u),null==(a=Z(s,r.props,a,l))||null==a.render)return void xe(e=a,s);if(a.props=r.props,a.context=l,a.updater=u,void 0===(u=a.state)&&(a.state=u=null),"function"==typeof a.UNSAFE_componentWillMount||"function"==typeof a.componentWillMount)if("function"==typeof a.componentWillMount&&"function"!=typeof s.getDerivedStateFromProps&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&"function"!=typeof s.getDerivedStateFromProps&&a.UNSAFE_componentWillMount(),c.length){u=c;var h=d;if(c=null,d=!1,h&&1===u.length)a.state=u[0];else{m=h?u[0]:a.state;var p=!0;for(h=h?1:0;h<u.length;h++){var g=u[h];null!=(g="function"==typeof g?g.call(a,m,r.props,l):g)&&(p?(p=!1,m=i({},m,g)):i(m,g))}a.state=m}}else c=null;if(xe(e=a.render(),s),"function"==typeof a.getChildContext&&"object"==typeof(r=s.childContextTypes)){var v=a.getChildContext();for(var _ in v)if(!(_ in r))throw Error(o(108,x(s)||"Unknown",_))}v&&(t=i({},t,v))}for(;r.isValidElement(e);){var a=e,l=a.type;if("function"!=typeof l)break;s(a,l)}return{child:e,context:t}}var Se=function(){function e(e,t,n){r.isValidElement(e)?e.type!==a?e=[e]:(e=e.props.children,e=r.isValidElement(e)?[e]:ge(e)):e=ge(e),e={type:null,domNamespace:ae,children:e,childIndex:0,context:S,footer:""};var i=k[0];if(0===i){var s=k,l=2*(i=s.length);if(!(65536>=l))throw Error(o(304));var c=new Uint16Array(l);for(c.set(s),(k=c)[0]=i+1,s=i;s<l-1;s++)k[s]=s+1;k[l-1]=0}else k[0]=k[i];this.threadID=i,this.stack=[e],this.exhausted=!1,this.currentSelectValue=null,this.previousWasTextNode=!1,this.makeStaticMarkup=t,this.suspenseDepth=0,this.contextIndex=-1,this.contextStack=[],this.contextValueStack=[],this.uniqueID=0,this.identifierPrefix=n&&n.identifierPrefix||""}var t=e.prototype;return t.destroy=function(){if(!this.exhausted){this.exhausted=!0,this.clearProviders();var e=this.threadID;k[e]=k[0],k[0]=e}},t.pushProvider=function(e){var t=++this.contextIndex,n=e.type._context,i=this.threadID;C(n,i);var r=n[i];this.contextStack[t]=n,this.contextValueStack[t]=r,n[i]=e.props.value},t.popProvider=function(){var e=this.contextIndex,t=this.contextStack[e],n=this.contextValueStack[e];this.contextStack[e]=null,this.contextValueStack[e]=null,this.contextIndex--,t[this.threadID]=n},t.clearProviders=function(){for(var e=this.contextIndex;0<=e;e--)this.contextStack[e][this.threadID]=this.contextValueStack[e]},t.read=function(e){if(this.exhausted)return null;var t=oe;oe=this;var n=ve.current;ve.current=se;try{for(var i=[""],r=!1;i[0].length<e;){if(0===this.stack.length){this.exhausted=!0;var s=this.threadID;k[s]=k[0],k[0]=s;break}var a=this.stack[this.stack.length-1];if(r||a.childIndex>=a.children.length){var l=a.footer;if(""!==l&&(this.previousWasTextNode=!1),this.stack.pop(),"select"===a.type)this.currentSelectValue=null;else if(null!=a.type&&null!=a.type.type&&a.type.type.$$typeof===d)this.popProvider(a.type);else if(a.type===h){this.suspenseDepth--;var c=i.pop();if(r){r=!1;var u=a.fallbackFrame;if(!u)throw Error(o(303));this.stack.push(u),i[this.suspenseDepth]+="\x3c!--$!--\x3e";continue}i[this.suspenseDepth]+=c}i[this.suspenseDepth]+=l}else{var m=a.children[a.childIndex++],p="";try{p+=this.render(m,a.context,a.domNamespace)}catch(e){if(null!=e&&"function"==typeof e.then)throw Error(o(294));throw e}i.length<=this.suspenseDepth&&i.push(""),i[this.suspenseDepth]+=p}}return i[0]}finally{ve.current=n,oe=t,X()}},t.render=function(e,t,n){if("string"==typeof e||"number"==typeof e)return""===(n=""+e)?"":this.makeStaticMarkup?j(n):this.previousWasTextNode?"\x3c!-- --\x3e"+j(n):(this.previousWasTextNode=!0,j(n));if(e=(t=Ae(e,t,this.threadID)).child,t=t.context,null===e||!1===e)return"";if(!r.isValidElement(e)){if(null!=e&&null!=e.$$typeof){if((n=e.$$typeof)===s)throw Error(o(257));throw Error(o(258,n.toString()))}return e=ge(e),this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),""}var _=e.type;if("string"==typeof _)return this.renderDOM(e,t,n);switch(_){case b:case E:case l:case c:case p:case a:return e=ge(e.props.children),this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),"";case h:throw Error(o(294));case y:throw Error(o(343))}if("object"==typeof _&&null!==_)switch(_.$$typeof){case m:H={};var w=_.render(e.props,e.ref);return w=Z(_.render,e.props,w,e.ref),w=ge(w),this.stack.push({type:null,domNamespace:n,children:w,childIndex:0,context:t,footer:""}),"";case g:return e=[r.createElement(_.type,i({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),"";case d:return n={type:e,domNamespace:n,children:_=ge(e.props.children),childIndex:0,context:t,footer:""},this.pushProvider(e),this.stack.push(n),"";case u:_=e.type,w=e.props;var x=this.threadID;return C(_,x),_=ge(w.children(_[x])),this.stack.push({type:e,domNamespace:n,children:_,childIndex:0,context:t,footer:""}),"";case f:throw Error(o(338));case v:return _=(w=(_=e.type)._init)(_._payload),e=[r.createElement(_,i({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),""}throw Error(o(130,null==_?_:typeof _,""))},t.renderDOM=function(e,t,n){var s=e.type.toLowerCase();if(n===ae&&le(s),!ye.hasOwnProperty(s)){if(!fe.test(s))throw Error(o(65,s));ye[s]=!0}var a=e.props;if("input"===s)a=i({type:void 0},a,{defaultChecked:void 0,defaultValue:void 0,value:null!=a.value?a.value:a.defaultValue,checked:null!=a.checked?a.checked:a.defaultChecked});else if("textarea"===s){var l=a.value;if(null==l){l=a.defaultValue;var c=a.children;if(null!=c){if(null!=l)throw Error(o(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(o(93));c=c[0]}l=""+c}null==l&&(l="")}a=i({},a,{value:void 0,children:""+l})}else if("select"===s)this.currentSelectValue=null!=a.value?a.value:a.defaultValue,a=i({},a,{value:void 0});else if("option"===s){c=this.currentSelectValue;var d=function(e){if(null==e)return e;var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(a.children);if(null!=c){var u=null!=a.value?a.value+"":d;if(l=!1,Array.isArray(c)){for(var m=0;m<c.length;m++)if(""+c[m]===u){l=!0;break}}else l=""+c===u;a=i({selected:void 0,children:void 0},a,{selected:l,children:d})}}if(l=a){if(de[s]&&(null!=l.children||null!=l.dangerouslySetInnerHTML))throw Error(o(137,s));if(null!=l.dangerouslySetInnerHTML){if(null!=l.children)throw Error(o(60));if("object"!=typeof l.dangerouslySetInnerHTML||!("__html"in l.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=l.style&&"object"!=typeof l.style)throw Error(o(62))}l=a,c=this.makeStaticMarkup,d=1===this.stack.length,u="<"+e.type;e:if(-1===s.indexOf("-"))m="string"==typeof l.is;else switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":m=!1;break e;default:m=!0}for(b in l)if(be.call(l,b)){var h=l[b];if(null!=h){if("style"===b){var p=void 0,g="",v="";for(p in h)if(h.hasOwnProperty(p)){var _=0===p.indexOf("--"),f=h[p];if(null!=f){if(_)var y=p;else if(y=p,Ee.hasOwnProperty(y))y=Ee[y];else{var E=y.replace(he,"-$1").toLowerCase().replace(pe,"-ms-");y=Ee[y]=E}g+=v+y+":",v=p,g+=_=null==f||"boolean"==typeof f||""===f?"":_||"number"!=typeof f||0===f||ue.hasOwnProperty(v)&&ue[v]?(""+f).trim():f+"px",v=";"}}h=g||null}p=null,m?we.hasOwnProperty(b)||(p=D(p=b)&&null!=h?p+'="'+j(h)+'"':""):p=B(b,h),p&&(u+=" "+p)}}c||d&&(u+=' data-reactroot=""');var b=u;l="",ce.hasOwnProperty(s)?b+="/>":(b+=">",l="</"+e.type+">");e:{if(null!=(c=a.dangerouslySetInnerHTML)){if(null!=c.__html){c=c.__html;break e}}else if("string"==typeof(c=a.children)||"number"==typeof c){c=j(c);break e}c=null}return null!=c?(a=[],_e.hasOwnProperty(s)&&"\n"===c.charAt(0)&&(b+="\n"),b+=c):a=ge(a.children),e=e.type,n=null==n||"http://www.w3.org/1999/xhtml"===n?le(e):"http://www.w3.org/2000/svg"===n&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":n,this.stack.push({domNamespace:n,type:s,children:a,childIndex:0,context:t,footer:l}),this.previousWasTextNode=!1,b},e}();t.renderToStaticMarkup=function(e,t){e=new Se(e,!0,t);try{return e.read(1/0)}finally{e.destroy()}}},"./node_modules/react-dom/server.browser.js":(e,t,n)=>{"use strict";e.exports=n("./node_modules/react-dom/cjs/react-dom-server.browser.production.min.js")},"./node_modules/react-is/cjs/react-is.production.min.js":(e,t)=>{"use strict";var n="function"==typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,a=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,u=n?Symbol.for("react.concurrent_mode"):60111,m=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,p=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,_=n?Symbol.for("react.block"):60121,f=n?Symbol.for("react.fundamental"):60117,y=n?Symbol.for("react.responder"):60118,E=n?Symbol.for("react.scope"):60119;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case d:case u:case o:case a:case s:case h:return e;default:switch(e=e&&e.$$typeof){case c:case m:case v:case g:case l:return e;default:return t}}case r:return t}}}function w(e){return b(e)===u}t.AsyncMode=d,t.ConcurrentMode=u,t.ContextConsumer=c,t.ContextProvider=l,t.Element=i,t.ForwardRef=m,t.Fragment=o,t.Lazy=v,t.Memo=g,t.Portal=r,t.Profiler=a,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return w(e)||b(e)===d},t.isConcurrentMode=w,t.isContextConsumer=function(e){return b(e)===c},t.isContextProvider=function(e){return b(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return b(e)===m},t.isFragment=function(e){return b(e)===o},t.isLazy=function(e){return b(e)===v},t.isMemo=function(e){return b(e)===g},t.isPortal=function(e){return b(e)===r},t.isProfiler=function(e){return b(e)===a},t.isStrictMode=function(e){return b(e)===s},t.isSuspense=function(e){return b(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===u||e===a||e===s||e===h||e===p||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===g||e.$$typeof===l||e.$$typeof===c||e.$$typeof===m||e.$$typeof===f||e.$$typeof===y||e.$$typeof===E||e.$$typeof===_)},t.typeOf=b},"./node_modules/react-is/index.js":(e,t,n)=>{"use strict";e.exports=n("./node_modules/react-is/cjs/react-is.production.min.js")},"./node_modules/react-redux/lib/components/Context.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.default=t.ReactReduxContext=void 0;var r=i(n("./node_modules/react/index.js")).default.createContext(null);t.ReactReduxContext=r;var o=r;t.default=o},"./node_modules/react-redux/lib/components/Provider.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default,r=n("./node_modules/@babel/runtime/helpers/interopRequireWildcard.js").default;t.__esModule=!0,t.default=void 0;var o=r(n("./node_modules/react/index.js")),s=(i(n("./node_modules/prop-types/index.js")),n("./node_modules/react-redux/lib/components/Context.js")),a=n("./node_modules/react-redux/lib/utils/Subscription.js"),l=n("./node_modules/react-redux/lib/utils/useIsomorphicLayoutEffect.js");var c=function(e){var t=e.store,n=e.context,i=e.children,r=(0,o.useMemo)((function(){var e=(0,a.createSubscription)(t);return{store:t,subscription:e}}),[t]),c=(0,o.useMemo)((function(){return t.getState()}),[t]);(0,l.useIsomorphicLayoutEffect)((function(){var e=r.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),c!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[r,c]);var d=n||s.ReactReduxContext;return o.default.createElement(d.Provider,{value:r},i)};t.default=c},"./node_modules/react-redux/lib/components/connectAdvanced.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default,r=n("./node_modules/@babel/runtime/helpers/interopRequireWildcard.js").default;t.__esModule=!0,t.default=function(e,t){void 0===t&&(t={});var n=t,i=n.getDisplayName,r=void 0===i?function(e){return"ConnectAdvanced("+e+")"}:i,u=n.methodName,w=void 0===u?"connectAdvanced":u,x=n.renderCountProp,A=void 0===x?void 0:x,S=n.shouldHandleStateChanges,C=void 0===S||S,k=n.storeKey,R=void 0===k?"store":k,I=(n.withRef,n.forwardRef),T=void 0!==I&&I,P=n.context,N=void 0===P?m.ReactReduxContext:P,D=(0,s.default)(n,h);0;var M=N;return function(t){var n=t.displayName||t.name||"Component",i=r(n),u=(0,o.default)({},D,{getDisplayName:r,methodName:w,renderCountProp:A,shouldHandleStateChanges:C,storeKey:R,displayName:i,wrappedComponentName:n,WrappedComponent:t}),m=D.pure;var h=m?l.useMemo:function(e){return e()};function x(n){var i=(0,l.useMemo)((function(){var e=n.reactReduxForwardedRef,t=(0,s.default)(n,p);return[n.context,e,t]}),[n]),r=i[0],a=i[1],m=i[2],w=(0,l.useMemo)((function(){return r&&r.Consumer&&(0,c.isContextConsumer)(l.default.createElement(r.Consumer,null))?r:M}),[r,M]),x=(0,l.useContext)(w),A=Boolean(n.store)&&Boolean(n.store.getState)&&Boolean(n.store.dispatch);Boolean(x)&&Boolean(x.store);var S=A?n.store:x.store,k=(0,l.useMemo)((function(){return function(t){return e(t.dispatch,u)}(S)}),[S]),R=(0,l.useMemo)((function(){if(!C)return v;var e=(0,d.createSubscription)(S,A?null:x.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[S,A,x]),I=R[0],T=R[1],P=(0,l.useMemo)((function(){return A?x:(0,o.default)({},x,{subscription:I})}),[A,x,I]),N=(0,l.useReducer)(_,g,b),D=N[0][0],O=N[1];if(D&&D.error)throw D.error;var L=(0,l.useRef)(),U=(0,l.useRef)(m),F=(0,l.useRef)(),j=(0,l.useRef)(!1),B=h((function(){return F.current&&m===U.current?F.current:k(S.getState(),m)}),[S,D,m]);f(y,[U,L,j,m,B,F,T]),f(E,[C,S,I,k,U,L,j,F,T,O],[S,I,k]);var V=(0,l.useMemo)((function(){return l.default.createElement(t,(0,o.default)({},B,{ref:a}))}),[a,t,B]);return(0,l.useMemo)((function(){return C?l.default.createElement(w.Provider,{value:P},V):V}),[w,V,P])}var S=m?l.default.memo(x):x;if(S.WrappedComponent=t,S.displayName=x.displayName=i,T){var k=l.default.forwardRef((function(e,t){return l.default.createElement(S,(0,o.default)({},e,{reactReduxForwardedRef:t}))}));return k.displayName=i,k.WrappedComponent=t,(0,a.default)(k,t)}return(0,a.default)(S,t)}};var o=i(n("./node_modules/@babel/runtime/helpers/extends.js")),s=i(n("./node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js")),a=i(n("./node_modules/hoist-non-react-statics/dist/hoist-non-react-statics.cjs.js")),l=r(n("./node_modules/react/index.js")),c=n("./node_modules/react-redux/node_modules/react-is/index.js"),d=n("./node_modules/react-redux/lib/utils/Subscription.js"),u=n("./node_modules/react-redux/lib/utils/useIsomorphicLayoutEffect.js"),m=n("./node_modules/react-redux/lib/components/Context.js"),h=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],p=["reactReduxForwardedRef"],g=[],v=[null,null];function _(e,t){var n=e[1];return[t.payload,n+1]}function f(e,t,n){(0,u.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),n)}function y(e,t,n,i,r,o,s){e.current=i,t.current=r,n.current=!1,o.current&&(o.current=null,s())}function E(e,t,n,i,r,o,s,a,l,c){if(e){var d=!1,u=null,m=function(){if(!d){var e,n,m=t.getState();try{e=i(m,r.current)}catch(e){n=e,u=e}n||(u=null),e===o.current?s.current||l():(o.current=e,a.current=e,s.current=!0,c({type:"STORE_UPDATED",payload:{error:n}}))}};n.onStateChange=m,n.trySubscribe(),m();return function(){if(d=!0,n.tryUnsubscribe(),n.onStateChange=null,u)throw u}}}var b=function(){return[null,0]}},"./node_modules/react-redux/lib/connect/connect.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.createConnect=g,t.default=void 0;var r=i(n("./node_modules/@babel/runtime/helpers/extends.js")),o=i(n("./node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js")),s=i(n("./node_modules/react-redux/lib/components/connectAdvanced.js")),a=i(n("./node_modules/react-redux/lib/utils/shallowEqual.js")),l=i(n("./node_modules/react-redux/lib/connect/mapDispatchToProps.js")),c=i(n("./node_modules/react-redux/lib/connect/mapStateToProps.js")),d=i(n("./node_modules/react-redux/lib/connect/mergeProps.js")),u=i(n("./node_modules/react-redux/lib/connect/selectorFactory.js")),m=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function h(e,t,n){for(var i=t.length-1;i>=0;i--){var r=t[i](e);if(r)return r}return function(t,i){throw new Error("Invalid value of type "+typeof e+" for "+n+" argument when connecting component "+i.wrappedComponentName+".")}}function p(e,t){return e===t}function g(e){var t=void 0===e?{}:e,n=t.connectHOC,i=void 0===n?s.default:n,g=t.mapStateToPropsFactories,v=void 0===g?c.default:g,_=t.mapDispatchToPropsFactories,f=void 0===_?l.default:_,y=t.mergePropsFactories,E=void 0===y?d.default:y,b=t.selectorFactory,w=void 0===b?u.default:b;return function(e,t,n,s){void 0===s&&(s={});var l=s,c=l.pure,d=void 0===c||c,u=l.areStatesEqual,g=void 0===u?p:u,_=l.areOwnPropsEqual,y=void 0===_?a.default:_,b=l.areStatePropsEqual,x=void 0===b?a.default:b,A=l.areMergedPropsEqual,S=void 0===A?a.default:A,C=(0,o.default)(l,m),k=h(e,v,"mapStateToProps"),R=h(t,f,"mapDispatchToProps"),I=h(n,E,"mergeProps");return i(w,(0,r.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:k,initMapDispatchToProps:R,initMergeProps:I,pure:d,areStatesEqual:g,areOwnPropsEqual:y,areStatePropsEqual:x,areMergedPropsEqual:S},C))}}var v=g();t.default=v},"./node_modules/react-redux/lib/connect/mapDispatchToProps.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.default=void 0,t.whenMapDispatchToPropsIsFunction=s,t.whenMapDispatchToPropsIsMissing=a,t.whenMapDispatchToPropsIsObject=l;var r=i(n("./node_modules/react-redux/lib/utils/bindActionCreators.js")),o=n("./node_modules/react-redux/lib/connect/wrapMapToProps.js");function s(e){return"function"==typeof e?(0,o.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function a(e){return e?void 0:(0,o.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function l(e){return e&&"object"==typeof e?(0,o.wrapMapToPropsConstant)((function(t){return(0,r.default)(e,t)})):void 0}var c=[s,a,l];t.default=c},"./node_modules/react-redux/lib/connect/mapStateToProps.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.default=void 0,t.whenMapStateToPropsIsFunction=r,t.whenMapStateToPropsIsMissing=o;var i=n("./node_modules/react-redux/lib/connect/wrapMapToProps.js");function r(e){return"function"==typeof e?(0,i.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,i.wrapMapToPropsConstant)((function(){return{}}))}var s=[r,o];t.default=s},"./node_modules/react-redux/lib/connect/mergeProps.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.default=void 0,t.defaultMergeProps=o,t.whenMergePropsIsFunction=a,t.whenMergePropsIsOmitted=l,t.wrapMergePropsFunc=s;var r=i(n("./node_modules/@babel/runtime/helpers/extends.js"));i(n("./node_modules/react-redux/lib/utils/verifyPlainObject.js"));function o(e,t,n){return(0,r.default)({},n,e,t)}function s(e){return function(t,n){n.displayName;var i,r=n.pure,o=n.areMergedPropsEqual,s=!1;return function(t,n,a){var l=e(t,n,a);return s?r&&o(l,i)||(i=l):(s=!0,i=l),i}}}function a(e){return"function"==typeof e?s(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[a,l];t.default=c},"./node_modules/react-redux/lib/connect/selectorFactory.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.default=function(e,t){var n=t.initMapStateToProps,i=t.initMapDispatchToProps,l=t.initMergeProps,c=(0,r.default)(t,o),d=n(e,c),u=i(e,c),m=l(e,c);0;return(c.pure?a:s)(d,u,m,e,c)},t.impureFinalPropsSelectorFactory=s,t.pureFinalPropsSelectorFactory=a;var r=i(n("./node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js")),o=(i(n("./node_modules/react-redux/lib/connect/verifySubselectors.js")),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function s(e,t,n,i){return function(r,o){return n(e(r,o),t(i,o),o)}}function a(e,t,n,i,r){var o,s,a,l,c,d=r.areStatesEqual,u=r.areOwnPropsEqual,m=r.areStatePropsEqual,h=!1;function p(r,h){var p,g,v=!u(h,s),_=!d(r,o,h,s);return o=r,s=h,v&&_?(a=e(o,s),t.dependsOnOwnProps&&(l=t(i,s)),c=n(a,l,s)):v?(e.dependsOnOwnProps&&(a=e(o,s)),t.dependsOnOwnProps&&(l=t(i,s)),c=n(a,l,s)):_?(p=e(o,s),g=!m(p,a),a=p,g&&(c=n(a,l,s)),c):c}return function(r,d){return h?p(r,d):(a=e(o=r,s=d),l=t(i,s),c=n(a,l,s),h=!0,c)}}},"./node_modules/react-redux/lib/connect/verifySubselectors.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.default=function(e,t,n,i){o(e,"mapStateToProps",i),o(t,"mapDispatchToProps",i),o(n,"mergeProps",i)};var r=i(n("./node_modules/react-redux/lib/utils/warning.js"));function o(e,t,n){if(!e)throw new Error("Unexpected value for "+t+" in "+n+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,r.default)("The selector for "+t+" of "+n+" did not specify a value for dependsOnOwnProps.")}},"./node_modules/react-redux/lib/connect/wrapMapToProps.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.getDependsOnOwnProps=r,t.wrapMapToPropsConstant=function(e){return function(t,n){var i=e(t,n);function r(){return i}return r.dependsOnOwnProps=!1,r}},t.wrapMapToPropsFunc=function(e,t){return function(t,n){n.displayName;var i=function(e,t){return i.dependsOnOwnProps?i.mapToProps(e,t):i.mapToProps(e)};return i.dependsOnOwnProps=!0,i.mapToProps=function(t,n){i.mapToProps=e,i.dependsOnOwnProps=r(e);var o=i(t,n);return"function"==typeof o&&(i.mapToProps=o,i.dependsOnOwnProps=r(o),o=i(t,n)),o},i}};i(n("./node_modules/react-redux/lib/utils/verifyPlainObject.js"));function r(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},"./node_modules/react-redux/lib/exports.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0;var r=i(n("./node_modules/react-redux/lib/components/Provider.js"));t.Provider=r.default;var o=i(n("./node_modules/react-redux/lib/components/connectAdvanced.js"));t.connectAdvanced=o.default;var s=n("./node_modules/react-redux/lib/components/Context.js");t.ReactReduxContext=s.ReactReduxContext;var a=i(n("./node_modules/react-redux/lib/connect/connect.js"));t.connect=a.default;var l=n("./node_modules/react-redux/lib/hooks/useDispatch.js");t.useDispatch=l.useDispatch,t.createDispatchHook=l.createDispatchHook;var c=n("./node_modules/react-redux/lib/hooks/useSelector.js");t.useSelector=c.useSelector,t.createSelectorHook=c.createSelectorHook;var d=n("./node_modules/react-redux/lib/hooks/useStore.js");t.useStore=d.useStore,t.createStoreHook=d.createStoreHook;var u=i(n("./node_modules/react-redux/lib/utils/shallowEqual.js"));t.shallowEqual=u.default},"./node_modules/react-redux/lib/hooks/useDispatch.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.createDispatchHook=o,t.useDispatch=void 0;var i=n("./node_modules/react-redux/lib/components/Context.js"),r=n("./node_modules/react-redux/lib/hooks/useStore.js");function o(e){void 0===e&&(e=i.ReactReduxContext);var t=e===i.ReactReduxContext?r.useStore:(0,r.createStoreHook)(e);return function(){return t().dispatch}}var s=o();t.useDispatch=s},"./node_modules/react-redux/lib/hooks/useReduxContext.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.useReduxContext=function(){0;return(0,i.useContext)(r.ReactReduxContext)};var i=n("./node_modules/react/index.js"),r=n("./node_modules/react-redux/lib/components/Context.js")},"./node_modules/react-redux/lib/hooks/useSelector.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.createSelectorHook=c,t.useSelector=void 0;var i=n("./node_modules/react/index.js"),r=n("./node_modules/react-redux/lib/hooks/useReduxContext.js"),o=n("./node_modules/react-redux/lib/utils/Subscription.js"),s=n("./node_modules/react-redux/lib/utils/useIsomorphicLayoutEffect.js"),a=n("./node_modules/react-redux/lib/components/Context.js"),l=function(e,t){return e===t};function c(e){void 0===e&&(e=a.ReactReduxContext);var t=e===a.ReactReduxContext?r.useReduxContext:function(){return(0,i.useContext)(e)};return function(e,n){void 0===n&&(n=l);var r=t(),a=function(e,t,n,r){var a,l=(0,i.useReducer)((function(e){return e+1}),0)[1],c=(0,i.useMemo)((function(){return(0,o.createSubscription)(n,r)}),[n,r]),d=(0,i.useRef)(),u=(0,i.useRef)(),m=(0,i.useRef)(),h=(0,i.useRef)(),p=n.getState();try{if(e!==u.current||p!==m.current||d.current){var g=e(p);a=void 0!==h.current&&t(g,h.current)?h.current:g}else a=h.current}catch(e){throw d.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+d.current.stack+"\n\n"),e}return(0,s.useIsomorphicLayoutEffect)((function(){u.current=e,m.current=p,h.current=a,d.current=void 0})),(0,s.useIsomorphicLayoutEffect)((function(){function e(){try{var e=n.getState();if(e===m.current)return;var i=u.current(e);if(t(i,h.current))return;h.current=i,m.current=e}catch(e){d.current=e}l()}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[n,c]),a}(e,n,r.store,r.subscription);return(0,i.useDebugValue)(a),a}}var d=c();t.useSelector=d},"./node_modules/react-redux/lib/hooks/useStore.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.createStoreHook=s,t.useStore=void 0;var i=n("./node_modules/react/index.js"),r=n("./node_modules/react-redux/lib/components/Context.js"),o=n("./node_modules/react-redux/lib/hooks/useReduxContext.js");function s(e){void 0===e&&(e=r.ReactReduxContext);var t=e===r.ReactReduxContext?o.useReduxContext:function(){return(0,i.useContext)(e)};return function(){return t().store}}var a=s();t.useStore=a},"./node_modules/react-redux/lib/index.js":(e,t,n)=>{"use strict";t.__esModule=!0;var i={batch:!0},r=n("./node_modules/react-redux/lib/exports.js");Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===r[e]||(t[e]=r[e]))}));var o=n("./node_modules/react-redux/lib/utils/reactBatchedUpdates.js");t.batch=o.unstable_batchedUpdates,(0,n("./node_modules/react-redux/lib/utils/batch.js").setBatch)(o.unstable_batchedUpdates)},"./node_modules/react-redux/lib/utils/Subscription.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.createSubscription=function(e,t){var n,o=r;function s(){l.onStateChange&&l.onStateChange()}function a(){var r,a,l;n||(n=t?t.addNestedSub(s):e.subscribe(s),r=(0,i.getBatch)(),a=null,l=null,o={clear:function(){a=null,l=null},notify:function(){r((function(){for(var e=a;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],t=a;t;)e.push(t),t=t.next;return e},subscribe:function(e){var t=!0,n=l={callback:e,next:null,prev:l};return n.prev?n.prev.next=n:a=n,function(){t&&null!==a&&(t=!1,n.next?n.next.prev=n.prev:l=n.prev,n.prev?n.prev.next=n.next:a=n.next)}}})}var l={addNestedSub:function(e){return a(),o.subscribe(e)},notifyNestedSubs:function(){o.notify()},handleChangeWrapper:s,isSubscribed:function(){return Boolean(n)},trySubscribe:a,tryUnsubscribe:function(){n&&(n(),n=void 0,o.clear(),o=r)},getListeners:function(){return o}};return l};var i=n("./node_modules/react-redux/lib/utils/batch.js");var r={notify:function(){},get:function(){return[]}}},"./node_modules/react-redux/lib/utils/batch.js":(e,t)=>{"use strict";t.__esModule=!0,t.setBatch=t.getBatch=void 0;var n=function(e){e()};t.setBatch=function(e){return n=e};t.getBatch=function(){return n}},"./node_modules/react-redux/lib/utils/bindActionCreators.js":(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e,t){var n={},i=function(i){var r=e[i];"function"==typeof r&&(n[i]=function(){return t(r.apply(void 0,arguments))})};for(var r in e)i(r);return n}},"./node_modules/react-redux/lib/utils/isPlainObject.js":(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}},"./node_modules/react-redux/lib/utils/reactBatchedUpdates.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.unstable_batchedUpdates=void 0;var i=n("./node_modules/react-dom/index.js");t.unstable_batchedUpdates=i.unstable_batchedUpdates},"./node_modules/react-redux/lib/utils/shallowEqual.js":(e,t)=>{"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.__esModule=!0,t.default=function(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(var o=0;o<i.length;o++)if(!Object.prototype.hasOwnProperty.call(t,i[o])||!n(e[i[o]],t[i[o]]))return!1;return!0}},"./node_modules/react-redux/lib/utils/useIsomorphicLayoutEffect.js":(e,t,n)=>{"use strict";t.__esModule=!0,t.useIsomorphicLayoutEffect=void 0;var i=n("./node_modules/react/index.js"),r="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect;t.useIsomorphicLayoutEffect=r},"./node_modules/react-redux/lib/utils/verifyPlainObject.js":(e,t,n)=>{"use strict";var i=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js").default;t.__esModule=!0,t.default=function(e,t,n){(0,r.default)(e)||(0,o.default)(n+"() in "+t+" must return a plain object. Instead received "+e+".")};var r=i(n("./node_modules/react-redux/lib/utils/isPlainObject.js")),o=i(n("./node_modules/react-redux/lib/utils/warning.js"))},"./node_modules/react-redux/lib/utils/warning.js":(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},"./node_modules/react-redux/node_modules/react-is/cjs/react-is.production.min.js":(e,t)=>{"use strict";var n=60103,i=60106,r=60107,o=60108,s=60114,a=60109,l=60110,c=60112,d=60113,u=60120,m=60115,h=60116,p=60121,g=60122,v=60117,_=60129,f=60131;if("function"==typeof Symbol&&Symbol.for){var y=Symbol.for;n=y("react.element"),i=y("react.portal"),r=y("react.fragment"),o=y("react.strict_mode"),s=y("react.profiler"),a=y("react.provider"),l=y("react.context"),c=y("react.forward_ref"),d=y("react.suspense"),u=y("react.suspense_list"),m=y("react.memo"),h=y("react.lazy"),p=y("react.block"),g=y("react.server.block"),v=y("react.fundamental"),_=y("react.debug_trace_mode"),f=y("react.legacy_hidden")}function E(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case r:case s:case o:case d:case u:return e;default:switch(e=e&&e.$$typeof){case l:case c:case h:case m:case a:return e;default:return t}}case i:return t}}}var b=a,w=n,x=c,A=r,S=h,C=m,k=i,R=s,I=o,T=d;t.ContextConsumer=l,t.ContextProvider=b,t.Element=w,t.ForwardRef=x,t.Fragment=A,t.Lazy=S,t.Memo=C,t.Portal=k,t.Profiler=R,t.StrictMode=I,t.Suspense=T,t.isAsyncMode=function(){return!1},t.isConcurrentMode=function(){return!1},t.isContextConsumer=function(e){return E(e)===l},t.isContextProvider=function(e){return E(e)===a},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return E(e)===c},t.isFragment=function(e){return E(e)===r},t.isLazy=function(e){return E(e)===h},t.isMemo=function(e){return E(e)===m},t.isPortal=function(e){return E(e)===i},t.isProfiler=function(e){return E(e)===s},t.isStrictMode=function(e){return E(e)===o},t.isSuspense=function(e){return E(e)===d},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===s||e===_||e===o||e===d||e===u||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===h||e.$$typeof===m||e.$$typeof===a||e.$$typeof===l||e.$$typeof===c||e.$$typeof===v||e.$$typeof===p||e[0]===g)},t.typeOf=E},"./node_modules/react-redux/node_modules/react-is/index.js":(e,t,n)=>{"use strict";e.exports=n("./node_modules/react-redux/node_modules/react-is/cjs/react-is.production.min.js")},"./node_modules/redux/lib/redux.js":(e,t,n)=>{"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(n("./node_modules/@babel/runtime/helpers/objectSpread2.js"));function o(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var s="function"==typeof Symbol&&Symbol.observable||"@@observable",a=function(){return Math.random().toString(36).substring(7).split("").join(".")},l={INIT:"@@redux/INIT"+a(),REPLACE:"@@redux/REPLACE"+a(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+a()}};function c(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function d(e,t,n){var i;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(o(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(o(1));return n(d)(e,t)}if("function"!=typeof e)throw new Error(o(2));var r=e,a=t,u=[],m=u,h=!1;function p(){m===u&&(m=u.slice())}function g(){if(h)throw new Error(o(3));return a}function v(e){if("function"!=typeof e)throw new Error(o(4));if(h)throw new Error(o(5));var t=!0;return p(),m.push(e),function(){if(t){if(h)throw new Error(o(6));t=!1,p();var n=m.indexOf(e);m.splice(n,1),u=null}}}function _(e){if(!c(e))throw new Error(o(7));if(void 0===e.type)throw new Error(o(8));if(h)throw new Error(o(9));try{h=!0,a=r(a,e)}finally{h=!1}for(var t=u=m,n=0;n<t.length;n++){(0,t[n])()}return e}return _({type:l.INIT}),(i={dispatch:_,subscribe:v,getState:g,replaceReducer:function(e){if("function"!=typeof e)throw new Error(o(10));r=e,_({type:l.REPLACE})}})[s]=function(){var e,t=v;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(o(11));function n(){e.next&&e.next(g())}return n(),{unsubscribe:t(n)}}})[s]=function(){return this},e},i}var u=d;function m(e,t){return function(){return t(e.apply(this,arguments))}}function h(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}t.__DO_NOT_USE__ActionTypes=l,t.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),i=function(){throw new Error(o(15))},s={getState:n.getState,dispatch:function(){return i.apply(void 0,arguments)}},a=t.map((function(e){return e(s)}));return i=h.apply(void 0,a)(n.dispatch),r.default(r.default({},n),{},{dispatch:i})}}},t.bindActionCreators=function(e,t){if("function"==typeof e)return m(e,t);if("object"!=typeof e||null===e)throw new Error(o(16));var n={};for(var i in e){var r=e[i];"function"==typeof r&&(n[i]=m(r,t))}return n},t.combineReducers=function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++){var r=t[i];0,"function"==typeof e[r]&&(n[r]=e[r])}var s,a=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:l.INIT}))throw new Error(o(12));if(void 0===n(void 0,{type:l.PROBE_UNKNOWN_ACTION()}))throw new Error(o(13))}))}(n)}catch(e){s=e}return function(e,t){if(void 0===e&&(e={}),s)throw s;for(var i=!1,r={},l=0;l<a.length;l++){var c=a[l],d=n[c],u=e[c],m=d(u,t);if(void 0===m){t&&t.type;throw new Error(o(14))}r[c]=m,i=i||m!==u}return(i=i||a.length!==Object.keys(e).length)?r:e}},t.compose=h,t.createStore=d,t.legacy_createStore=u},"./node_modules/reflect-metadata/Reflect.js":(e,t,n)=>{var i,r=n("./node_modules/process/browser.js");!function(e){!function(){var t="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(n,i){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:i}),t&&t(n,i)}}void 0===t.Reflect?t.Reflect=e:i=o(t.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",s="function"==typeof Object.create,a={__proto__:[]}instanceof Array,l=!s&&!a,c={create:s?function(){return re(Object.create(null))}:a?function(){return re({__proto__:null})}:function(){return re({})},has:l?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:l?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},d=Object.getPrototypeOf(Function),u="object"==typeof r&&r.env&&"true"===r.env.REFLECT_METADATA_USE_MAP_POLYFILL,m=u||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?te():Map,h=u||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?ne():Set,p=new(u||"function"!=typeof WeakMap?ie():WeakMap);function g(e,t,n,i){if(L(n)){if(!G(e))throw new TypeError;if(!J(t))throw new TypeError;return S(e,t)}if(!G(e))throw new TypeError;if(!j(t))throw new TypeError;if(!j(i)&&!L(i)&&!U(i))throw new TypeError;return U(i)&&(i=void 0),C(e,t,n=W(n),i)}function v(e,t){function n(n,i){if(!j(n))throw new TypeError;if(!L(i)&&!q(i))throw new TypeError;N(e,t,n,i)}return n}function _(e,t,n,i){if(!j(n))throw new TypeError;return L(i)||(i=W(i)),N(e,t,n,i)}function f(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=W(n)),R(e,t,n)}function y(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=W(n)),I(e,t,n)}function E(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=W(n)),T(e,t,n)}function b(e,t,n){if(!j(t))throw new TypeError;return L(n)||(n=W(n)),P(e,t,n)}function w(e,t){if(!j(e))throw new TypeError;return L(t)||(t=W(t)),D(e,t)}function x(e,t){if(!j(e))throw new TypeError;return L(t)||(t=W(t)),M(e,t)}function A(e,t,n){if(!j(t))throw new TypeError;L(n)||(n=W(n));var i=k(t,n,!1);if(L(i))return!1;if(!i.delete(e))return!1;if(i.size>0)return!0;var r=p.get(t);return r.delete(n),r.size>0||p.delete(t),!0}function S(e,t){for(var n=e.length-1;n>=0;--n){var i=(0,e[n])(t);if(!L(i)&&!U(i)){if(!J(i))throw new TypeError;t=i}}return t}function C(e,t,n,i){for(var r=e.length-1;r>=0;--r){var o=(0,e[r])(t,n,i);if(!L(o)&&!U(o)){if(!j(o))throw new TypeError;i=o}}return i}function k(e,t,n){var i=p.get(e);if(L(i)){if(!n)return;i=new m,p.set(e,i)}var r=i.get(t);if(L(r)){if(!n)return;r=new m,i.set(t,r)}return r}function R(e,t,n){if(I(e,t,n))return!0;var i=ee(t);return!U(i)&&R(e,i,n)}function I(e,t,n){var i=k(t,n,!1);return!L(i)&&H(i.has(e))}function T(e,t,n){if(I(e,t,n))return P(e,t,n);var i=ee(t);return U(i)?void 0:T(e,i,n)}function P(e,t,n){var i=k(t,n,!1);if(!L(i))return i.get(e)}function N(e,t,n,i){k(n,i,!0).set(e,t)}function D(e,t){var n=M(e,t),i=ee(e);if(null===i)return n;var r=D(i,t);if(r.length<=0)return n;if(n.length<=0)return r;for(var o=new h,s=[],a=0,l=n;a<l.length;a++){var c=l[a];o.has(c)||(o.add(c),s.push(c))}for(var d=0,u=r;d<u.length;d++){c=u[d];o.has(c)||(o.add(c),s.push(c))}return s}function M(e,t){var n=[],i=k(e,t,!1);if(L(i))return n;for(var r=Y(i.keys()),o=0;;){var s=Z(r);if(!s)return n.length=o,n;var a=Q(s);try{n[o]=a}catch(e){try{X(r)}finally{throw e}}o++}}function O(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function L(e){return void 0===e}function U(e){return null===e}function F(e){return"symbol"==typeof e}function j(e){return"object"==typeof e?null!==e:"function"==typeof e}function B(e,t){switch(O(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=$(e,i);if(void 0!==r){var o=r.call(e,n);if(j(o))throw new TypeError;return o}return V(e,"default"===n?"number":n)}function V(e,t){if("string"===t){var n=e.toString;if(K(n))if(!j(r=n.call(e)))return r;if(K(i=e.valueOf))if(!j(r=i.call(e)))return r}else{var i;if(K(i=e.valueOf))if(!j(r=i.call(e)))return r;var r,o=e.toString;if(K(o))if(!j(r=o.call(e)))return r}throw new TypeError}function H(e){return!!e}function z(e){return""+e}function W(e){var t=B(e,3);return F(t)?t:z(t)}function G(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function K(e){return"function"==typeof e}function J(e){return"function"==typeof e}function q(e){switch(O(e)){case 3:case 4:return!0;default:return!1}}function $(e,t){var n=e[t];if(null!=n){if(!K(n))throw new TypeError;return n}}function Y(e){var t=$(e,o);if(!K(t))throw new TypeError;var n=t.call(e);if(!j(n))throw new TypeError;return n}function Q(e){return e.value}function Z(e){var t=e.next();return!t.done&&t}function X(e){var t=e.return;t&&t.call(e)}function ee(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===d)return t;if(t!==d)return t;var n=e.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return t;var r=i.constructor;return"function"!=typeof r||r===e?t:r}function te(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[o]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var i=this._keys.length,r=n+1;r<i;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,i)},t.prototype.values=function(){return new n(this._keys,this._values,r)},t.prototype.entries=function(){return new n(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[o]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function i(e,t){return e}function r(e,t){return t}function s(e,t){return[e,t]}}function ne(){return function(){function e(){this._map=new m}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[o]=function(){return this.keys()},e}()}function ie(){var e=16,n=c.create(),i=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var e;do{e="@@WeakMap@@"+l()}while(c.has(n,e));return n[e]=!0,e}function o(e,n){if(!t.call(e,i)){if(!n)return;Object.defineProperty(e,i,{value:c.create()})}return e[i]}function s(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function a(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):s(new Uint8Array(e),e):s(new Array(e),e)}function l(){var t=a(e);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",i=0;i<e;++i){var r=t[i];4!==i&&6!==i&&8!==i||(n+="-"),r<16&&(n+="0"),n+=r.toString(16).toLowerCase()}return n}}function re(e){return e.__=void 0,delete e.__,e}e("decorate",g),e("metadata",v),e("defineMetadata",_),e("hasMetadata",f),e("hasOwnMetadata",y),e("getMetadata",E),e("getOwnMetadata",b),e("getMetadataKeys",w),e("getOwnMetadataKeys",x),e("deleteMetadata",A)}(i)}()}(i||(i={}))},"./node_modules/sanitize-filename/index.js":(e,t,n)=>{"use strict";var i=n("./node_modules/truncate-utf8-bytes/browser.js"),r=/[\/\?<>\\:\*\|"]/g,o=/[\x00-\x1f\x80-\x9f]/g,s=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l=/[\. ]+$/;function c(e,t){if("string"!=typeof e)throw new Error("Input must be string");var n=e.replace(r,t).replace(o,t).replace(s,t).replace(a,t).replace(l,t);return i(n,255)}e.exports=function(e,t){var n=t&&t.replacement||"",i=c(e,n);return""===n?i:c(i,"")}},"./node_modules/seedrandom/index.js":(e,t,n)=>{var i=n("./node_modules/seedrandom/lib/alea.js"),r=n("./node_modules/seedrandom/lib/xor128.js"),o=n("./node_modules/seedrandom/lib/xorwow.js"),s=n("./node_modules/seedrandom/lib/xorshift7.js"),a=n("./node_modules/seedrandom/lib/xor4096.js"),l=n("./node_modules/seedrandom/lib/tychei.js"),c=n("./node_modules/seedrandom/seedrandom.js");c.alea=i,c.xor128=r,c.xorwow=o,c.xorshift7=s,c.xor4096=a,c.tychei=l,e.exports=c},"./node_modules/seedrandom/lib/alea.js":function(e,t,n){var i;!function(e,r){function o(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var n=new o(e),i=t&&t.state,r=n.next;return r.int32=function(){return 4294967296*n.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=a:n.amdD&&n.amdO?void 0===(i=function(){return a}.call(t,n,t,r))||(r.exports=i):this.alea=a}(0,e=n.nmd(e),n.amdD)},"./node_modules/seedrandom/lib/tychei.js":function(e,t,n){var i;!function(e,r){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,r=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=a:n.amdD&&n.amdO?void 0===(i=function(){return a}.call(t,n,t,r))||(r.exports=i):this.tychei=a}(0,e=n.nmd(e),n.amdD)},"./node_modules/seedrandom/lib/xor128.js":function(e,t,n){var i;!function(e,r){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=a:n.amdD&&n.amdO?void 0===(i=function(){return a}.call(t,n,t,r))||(r.exports=i):this.xor128=a}(0,e=n.nmd(e),n.amdD)},"./node_modules/seedrandom/lib/xor4096.js":function(e,t,n){var i;!function(e,r){function o(e){var t=this;t.next=function(){var e,n,i=t.w,r=t.X,o=t.i;return t.w=i=i+1640531527|0,n=r[o+34&127],e=r[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=r[o]=n^e,t.i=o,n+(i^i>>>16)|0},function(e,t){var n,i,r,o,s,a=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),r=0,o=-32;o<l;++o)t&&(i^=t.charCodeAt((o+32)%t.length)),0===o&&(s=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(s=s+1640531527|0,r=0==(n=a[127&o]^=i+s)?r+1:0);for(r>=128&&(a[127&(t&&t.length||0)]=-1),r=127,o=512;o>0;--o)i=a[r+34&127],n=a[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,a[r]=i^n;e.w=s,e.X=a,e.i=r}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.X&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=a:n.amdD&&n.amdO?void 0===(i=function(){return a}.call(t,n,t,r))||(r.exports=i):this.xor4096=a}(0,e=n.nmd(e),n.amdD)},"./node_modules/seedrandom/lib/xorshift7.js":function(e,t,n){var i;!function(e,r){function o(e){var t=this;t.next=function(){var e,n,i=t.x,r=t.i;return e=i[r],n=(e^=e>>>7)^e<<24,n^=(e=i[r+1&7])^e>>>10,n^=(e=i[r+3&7])^e>>>3,n^=(e=i[r+4&7])^e<<7,e=i[r+7&7],n^=(e^=e<<13)^e<<9,i[r]=n,t.i=r+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,n=0;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&(i.x&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=a:n.amdD&&n.amdO?void 0===(i=function(){return a}.call(t,n,t,r))||(r.exports=i):this.xorshift7=a}(0,e=n.nmd(e),n.amdD)},"./node_modules/seedrandom/lib/xorwow.js":function(e,t,n){var i;!function(e,r){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var n=new o(e),i=t&&t.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=n.next,r.quick=r,i&&("object"==typeof i&&s(i,n),r.state=function(){return s(n,{})}),r}r&&r.exports?r.exports=a:n.amdD&&n.amdO?void 0===(i=function(){return a}.call(t,n,t,r))||(r.exports=i):this.xorwow=a}(0,e=n.nmd(e),n.amdD)},"./node_modules/seedrandom/seedrandom.js":function(e,t,n){var i;!function(r,o,s){var a,l=256,c=s.pow(l,6),d=s.pow(2,52),u=2*d,m=l-1;function h(e,t,n){var i=[],m=_(v((t=1==t?{entropy:!0}:t||{}).entropy?[e,f(o)]:null==e?function(){try{var e;return a&&(e=a.randomBytes)?e=e(l):(e=new Uint8Array(l),(r.crypto||r.msCrypto).getRandomValues(e)),f(e)}catch(e){var t=r.navigator,n=t&&t.plugins;return[+new Date,r,n,r.screen,f(o)]}}():e,3),i),h=new p(i),y=function(){for(var e=h.g(6),t=c,n=0;e<d;)e=(e+n)*l,t*=l,n=h.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|h.g(4)},y.quick=function(){return h.g(4)/4294967296},y.double=y,_(f(h.S),o),(t.pass||n||function(e,t,n,i){return i&&(i.S&&g(i,h),e.state=function(){return g(h,{})}),n?(s.random=e,t):e})(y,m,"global"in t?t.global:this==s,t.state)}function p(e){var t,n=e.length,i=this,r=0,o=i.i=i.j=0,s=i.S=[];for(n||(e=[n++]);r<l;)s[r]=r++;for(r=0;r<l;r++)s[r]=s[o=m&o+e[r%n]+(t=s[r])],s[o]=t;(i.g=function(e){for(var t,n=0,r=i.i,o=i.j,s=i.S;e--;)t=s[r=m&r+1],n=n*l+s[m&(s[r]=s[o=m&o+t])+(s[o]=t)];return i.i=r,i.j=o,n})(l)}function g(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,i=[],r=typeof e;if(t&&"object"==r)for(n in e)try{i.push(v(e[n],t-1))}catch(e){}return i.length?i:"string"==r?e:e+"\0"}function _(e,t){for(var n,i=e+"",r=0;r<i.length;)t[m&r]=m&(n^=19*t[m&r])+i.charCodeAt(r++);return f(t)}function f(e){return String.fromCharCode.apply(0,e)}if(_(s.random(),o),e.exports){e.exports=h;try{a=n("?d4c0")}catch(e){}}else void 0===(i=function(){return h}.call(t,n,t,e))||(e.exports=i)}("undefined"!=typeof self?self:this,[],Math)},"./node_modules/tiny-invariant/dist/tiny-invariant.cjs.js":e=>{"use strict";var t="Invariant failed";e.exports=function(e,n){if(!e)throw new Error(t)}},"./node_modules/truncate-utf8-bytes/browser.js":(e,t,n)=>{"use strict";var i=n("./node_modules/truncate-utf8-bytes/lib/truncate.js"),r=n("./node_modules/utf8-byte-length/browser.js");e.exports=i.bind(null,r)},"./node_modules/truncate-utf8-bytes/lib/truncate.js":e=>{"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e,i,r){if("string"!=typeof i)throw new Error("Input must be string");for(var o,s,a=i.length,l=0,c=0;c<a;c+=1){if(o=i.charCodeAt(c),s=i[c],t(o)&&n(i.charCodeAt(c+1))&&(s+=i[c+=1]),(l+=e(s))===r)return i.slice(0,c+1);if(l>r)return i.slice(0,c-s.length+1)}return i}},"./node_modules/use-memo-one/dist/use-memo-one.cjs.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("./node_modules/react/index.js");function r(e,t){var n=i.useState((function(){return{inputs:t,result:e()}}))[0],r=i.useRef(!0),o=i.useRef(n),s=r.current||Boolean(t&&o.current.inputs&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,o.current.inputs))?o.current:{inputs:t,result:e()};return i.useEffect((function(){r.current=!1,o.current=s}),[s]),s.result}function o(e,t){return r((function(){return e}),t)}var s=r,a=o;t.useCallback=a,t.useCallbackOne=o,t.useMemo=s,t.useMemoOne=r},"./node_modules/utf8-byte-length/browser.js":e=>{"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var i=e.length,r=0,o=null,s=null,a=0;a<i;a++)n(o=e.charCodeAt(a))?null!=s&&t(s)?r+=1:r+=3:o<=127?r+=1:o>=128&&o<=2047?r+=2:o>=2048&&o<=65535&&(r+=3),s=o;return r}},"./node_modules/what-input/dist/what-input.js":function(e){var t;t=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t){"use strict";e.exports=function(){if("undefined"==typeof document||"undefined"==typeof window)return{ask:function(){return"initial"},element:function(){return null},ignoreKeys:function(){},specificKeys:function(){},registerOnChange:function(){},unRegisterOnChange:function(){}};var e=document.documentElement,t=null,n="initial",i=n,r=Date.now(),o=!1,s=["button","input","select","textarea"],a=[],l=[16,17,18,91,93],c=[],d={keydown:"keyboard",keyup:"keyboard",mousedown:"mouse",mousemove:"mouse",MSPointerDown:"pointer",MSPointerMove:"pointer",pointerdown:"pointer",pointermove:"pointer",touchstart:"touch",touchend:"touch"},u=!1,m={x:null,y:null},h={2:"touch",3:"touch",4:"mouse"},p=!1;try{var g=Object.defineProperty({},"passive",{get:function(){p=!0}});window.addEventListener("test",null,g)}catch(e){}var v=function(){var e=!p||{passive:!0,capture:!0};document.addEventListener("DOMContentLoaded",_,!0),window.PointerEvent?(window.addEventListener("pointerdown",f,!0),window.addEventListener("pointermove",E,!0)):window.MSPointerEvent?(window.addEventListener("MSPointerDown",f,!0),window.addEventListener("MSPointerMove",E,!0)):(window.addEventListener("mousedown",f,!0),window.addEventListener("mousemove",E,!0),"ontouchstart"in window&&(window.addEventListener("touchstart",f,e),window.addEventListener("touchend",f,!0))),window.addEventListener(C(),E,e),window.addEventListener("keydown",f,!0),window.addEventListener("keyup",f,!0),window.addEventListener("focusin",b,!0),window.addEventListener("focusout",w,!0)},_=function(){if(o=!("false"===e.getAttribute("data-whatpersist")||"false"===document.body.getAttribute("data-whatpersist")))try{window.sessionStorage.getItem("what-input")&&(n=window.sessionStorage.getItem("what-input")),window.sessionStorage.getItem("what-intent")&&(i=window.sessionStorage.getItem("what-intent"))}catch(e){}y("input"),y("intent")},f=function(e){var t=e.which,r=d[e.type];"pointer"===r&&(r=A(e));var o=!c.length&&-1===l.indexOf(t),a=c.length&&-1!==c.indexOf(t),u="keyboard"===r&&t&&(o||a)||"mouse"===r||"touch"===r;if(S(r)&&(u=!1),u&&n!==r&&(x("input",n=r),y("input")),u&&i!==r){var m=document.activeElement;m&&m.nodeName&&(-1===s.indexOf(m.nodeName.toLowerCase())||"button"===m.nodeName.toLowerCase()&&!I(m,"form"))&&(x("intent",i=r),y("intent"))}},y=function(t){e.setAttribute("data-what"+t,"input"===t?n:i),k(t)},E=function(e){var t=d[e.type];"pointer"===t&&(t=A(e)),R(e),(!u&&!S(t)||u&&"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type)&&i!==t&&(x("intent",i=t),y("intent"))},b=function(n){n.target.nodeName?(t=n.target.nodeName.toLowerCase(),e.setAttribute("data-whatelement",t),n.target.classList&&n.target.classList.length&&e.setAttribute("data-whatclasses",n.target.classList.toString().replace(" ",","))):w()},w=function(){t=null,e.removeAttribute("data-whatelement"),e.removeAttribute("data-whatclasses")},x=function(e,t){if(o)try{window.sessionStorage.setItem("what-"+e,t)}catch(e){}},A=function(e){return"number"==typeof e.pointerType?h[e.pointerType]:"pen"===e.pointerType?"touch":e.pointerType},S=function(e){var t=Date.now(),i="mouse"===e&&"touch"===n&&t-r<200;return r=t,i},C=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},k=function(e){for(var t=0,r=a.length;t<r;t++)a[t].type===e&&a[t].fn.call(void 0,"input"===e?n:i)},R=function(e){m.x!==e.screenX||m.y!==e.screenY?(u=!1,m.x=e.screenX,m.y=e.screenY):u=!0},I=function(e,t){var n=window.Element.prototype;if(n.matches||(n.matches=n.msMatchesSelector||n.webkitMatchesSelector),n.closest)return e.closest(t);do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null};return"addEventListener"in window&&Array.prototype.indexOf&&(d[C()]="mouse",v()),{ask:function(e){return"intent"===e?i:n},element:function(){return t},ignoreKeys:function(e){l=e},specificKeys:function(e){c=e},registerOnChange:function(e,t){a.push({fn:e,type:t||"input"})},unRegisterOnChange:function(e){var t=function(e){for(var t=0,n=a.length;t<n;t++)if(a[t].fn===e)return t}(e);(t||0===t)&&a.splice(t,1)},clearStorage:function(){window.sessionStorage.clear()}}}()}])},e.exports=t()},"./node_modules/xxhashjs/lib/index.js":(e,t,n)=>{e.exports={h32:n("./node_modules/xxhashjs/lib/xxhash.js"),h64:n("./node_modules/xxhashjs/lib/xxhash64.js")}},"./node_modules/xxhashjs/lib/xxhash.js":(e,t,n)=>{var i=n("./node_modules/buffer/index.js").hp,r=n("./node_modules/cuint/index.js").UINT32;r.prototype.xxh_update=function(e,t){var n,i,r=s._low,a=s._high;n=(i=e*r)>>>16,n+=t*r,n&=65535,n+=e*a;var l=this._low+(65535&i),c=l>>>16,d=(c+=this._high+(65535&n))<<16|65535&l;c=(d=d<<13|d>>>19)>>>16,n=(i=(l=65535&d)*(r=o._low))>>>16,n+=c*r,n&=65535,n+=l*(a=o._high),this._low=65535&i,this._high=65535&n};var o=r("2654435761"),s=r("2246822519"),a=r("3266489917"),l=r("668265263"),c=r("374761393");function d(){return 2==arguments.length?new d(arguments[1]).update(arguments[0]).digest():this instanceof d?void u.call(this,arguments[0]):new d(arguments[0])}function u(e){return this.seed=e instanceof r?e.clone():r(e),this.v1=this.seed.clone().add(o).add(s),this.v2=this.seed.clone().add(s),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(o),this.total_len=0,this.memsize=0,this.memory=null,this}d.prototype.init=u,d.prototype.update=function(e){var t,n="string"==typeof e;n&&(e=function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return new Uint8Array(t)}(e),n=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var r=0,o=e.length,s=r+o;if(0==o)return this;if(this.total_len+=o,0==this.memsize&&(this.memory=n?"":t?new Uint8Array(16):new i(16)),this.memsize+o<16)return n?this.memory+=e:t?this.memory.set(e.subarray(0,o),this.memsize):e.copy(this.memory,this.memsize,0,o),this.memsize+=o,this;if(this.memsize>0){n?this.memory+=e.slice(0,16-this.memsize):t?this.memory.set(e.subarray(0,16-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,16-this.memsize);var a=0;n?(this.v1.xxh_update(this.memory.charCodeAt(a+1)<<8|this.memory.charCodeAt(a),this.memory.charCodeAt(a+3)<<8|this.memory.charCodeAt(a+2)),a+=4,this.v2.xxh_update(this.memory.charCodeAt(a+1)<<8|this.memory.charCodeAt(a),this.memory.charCodeAt(a+3)<<8|this.memory.charCodeAt(a+2)),a+=4,this.v3.xxh_update(this.memory.charCodeAt(a+1)<<8|this.memory.charCodeAt(a),this.memory.charCodeAt(a+3)<<8|this.memory.charCodeAt(a+2)),a+=4,this.v4.xxh_update(this.memory.charCodeAt(a+1)<<8|this.memory.charCodeAt(a),this.memory.charCodeAt(a+3)<<8|this.memory.charCodeAt(a+2))):(this.v1.xxh_update(this.memory[a+1]<<8|this.memory[a],this.memory[a+3]<<8|this.memory[a+2]),a+=4,this.v2.xxh_update(this.memory[a+1]<<8|this.memory[a],this.memory[a+3]<<8|this.memory[a+2]),a+=4,this.v3.xxh_update(this.memory[a+1]<<8|this.memory[a],this.memory[a+3]<<8|this.memory[a+2]),a+=4,this.v4.xxh_update(this.memory[a+1]<<8|this.memory[a],this.memory[a+3]<<8|this.memory[a+2])),r+=16-this.memsize,this.memsize=0,n&&(this.memory="")}if(r<=s-16){var l=s-16;do{n?(this.v1.xxh_update(e.charCodeAt(r+1)<<8|e.charCodeAt(r),e.charCodeAt(r+3)<<8|e.charCodeAt(r+2)),r+=4,this.v2.xxh_update(e.charCodeAt(r+1)<<8|e.charCodeAt(r),e.charCodeAt(r+3)<<8|e.charCodeAt(r+2)),r+=4,this.v3.xxh_update(e.charCodeAt(r+1)<<8|e.charCodeAt(r),e.charCodeAt(r+3)<<8|e.charCodeAt(r+2)),r+=4,this.v4.xxh_update(e.charCodeAt(r+1)<<8|e.charCodeAt(r),e.charCodeAt(r+3)<<8|e.charCodeAt(r+2))):(this.v1.xxh_update(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2]),r+=4,this.v2.xxh_update(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2]),r+=4,this.v3.xxh_update(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2]),r+=4,this.v4.xxh_update(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2])),r+=4}while(r<=l)}return r<s&&(n?this.memory+=e.slice(r):t?this.memory.set(e.subarray(r,s),this.memsize):e.copy(this.memory,this.memsize,r,s),this.memsize=s-r),this},d.prototype.digest=function(){var e,t,n=this.memory,i="string"==typeof n,d=0,u=this.memsize,m=new r;for((e=this.total_len>=16?this.v1.rotl(1).add(this.v2.rotl(7).add(this.v3.rotl(12).add(this.v4.rotl(18)))):this.seed.clone().add(c)).add(m.fromNumber(this.total_len));d<=u-4;)i?m.fromBits(n.charCodeAt(d+1)<<8|n.charCodeAt(d),n.charCodeAt(d+3)<<8|n.charCodeAt(d+2)):m.fromBits(n[d+1]<<8|n[d],n[d+3]<<8|n[d+2]),e.add(m.multiply(a)).rotl(17).multiply(l),d+=4;for(;d<u;)m.fromBits(i?n.charCodeAt(d++):n[d++],0),e.add(m.multiply(c)).rotl(11).multiply(o);return t=e.clone().shiftRight(15),e.xor(t).multiply(s),t=e.clone().shiftRight(13),e.xor(t).multiply(a),t=e.clone().shiftRight(16),e.xor(t),this.init(this.seed),e},e.exports=d},"./node_modules/xxhashjs/lib/xxhash64.js":(e,t,n)=>{var i=n("./node_modules/buffer/index.js").hp,r=n("./node_modules/cuint/index.js").UINT64,o=r("11400714785074694791"),s=r("14029467366897019727"),a=r("1609587929392839161"),l=r("9650029242287828579"),c=r("2870177450012600261");function d(){return 2==arguments.length?new d(arguments[1]).update(arguments[0]).digest():this instanceof d?void u.call(this,arguments[0]):new d(arguments[0])}function u(e){return this.seed=e instanceof r?e.clone():r(e),this.v1=this.seed.clone().add(o).add(s),this.v2=this.seed.clone().add(s),this.v3=this.seed.clone(),this.v4=this.seed.clone().subtract(o),this.total_len=0,this.memsize=0,this.memory=null,this}d.prototype.init=u,d.prototype.update=function(e){var t,n="string"==typeof e;n&&(e=function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?t.push(192|r>>6,128|63&r):r<55296||r>=57344?t.push(224|r>>12,128|r>>6&63,128|63&r):(n++,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return new Uint8Array(t)}(e),n=!1,t=!0),"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&(t=!0,e=new Uint8Array(e));var a=0,l=e.length,c=a+l;if(0==l)return this;if(this.total_len+=l,0==this.memsize&&(this.memory=n?"":t?new Uint8Array(32):new i(32)),this.memsize+l<32)return n?this.memory+=e:t?this.memory.set(e.subarray(0,l),this.memsize):e.copy(this.memory,this.memsize,0,l),this.memsize+=l,this;if(this.memsize>0){n?this.memory+=e.slice(0,32-this.memsize):t?this.memory.set(e.subarray(0,32-this.memsize),this.memsize):e.copy(this.memory,this.memsize,0,32-this.memsize);var d=0;if(n)m=r(this.memory.charCodeAt(d+1)<<8|this.memory.charCodeAt(d),this.memory.charCodeAt(d+3)<<8|this.memory.charCodeAt(d+2),this.memory.charCodeAt(d+5)<<8|this.memory.charCodeAt(d+4),this.memory.charCodeAt(d+7)<<8|this.memory.charCodeAt(d+6)),this.v1.add(m.multiply(s)).rotl(31).multiply(o),d+=8,m=r(this.memory.charCodeAt(d+1)<<8|this.memory.charCodeAt(d),this.memory.charCodeAt(d+3)<<8|this.memory.charCodeAt(d+2),this.memory.charCodeAt(d+5)<<8|this.memory.charCodeAt(d+4),this.memory.charCodeAt(d+7)<<8|this.memory.charCodeAt(d+6)),this.v2.add(m.multiply(s)).rotl(31).multiply(o),d+=8,m=r(this.memory.charCodeAt(d+1)<<8|this.memory.charCodeAt(d),this.memory.charCodeAt(d+3)<<8|this.memory.charCodeAt(d+2),this.memory.charCodeAt(d+5)<<8|this.memory.charCodeAt(d+4),this.memory.charCodeAt(d+7)<<8|this.memory.charCodeAt(d+6)),this.v3.add(m.multiply(s)).rotl(31).multiply(o),d+=8,m=r(this.memory.charCodeAt(d+1)<<8|this.memory.charCodeAt(d),this.memory.charCodeAt(d+3)<<8|this.memory.charCodeAt(d+2),this.memory.charCodeAt(d+5)<<8|this.memory.charCodeAt(d+4),this.memory.charCodeAt(d+7)<<8|this.memory.charCodeAt(d+6)),this.v4.add(m.multiply(s)).rotl(31).multiply(o);else m=r(this.memory[d+1]<<8|this.memory[d],this.memory[d+3]<<8|this.memory[d+2],this.memory[d+5]<<8|this.memory[d+4],this.memory[d+7]<<8|this.memory[d+6]),this.v1.add(m.multiply(s)).rotl(31).multiply(o),d+=8,m=r(this.memory[d+1]<<8|this.memory[d],this.memory[d+3]<<8|this.memory[d+2],this.memory[d+5]<<8|this.memory[d+4],this.memory[d+7]<<8|this.memory[d+6]),this.v2.add(m.multiply(s)).rotl(31).multiply(o),d+=8,m=r(this.memory[d+1]<<8|this.memory[d],this.memory[d+3]<<8|this.memory[d+2],this.memory[d+5]<<8|this.memory[d+4],this.memory[d+7]<<8|this.memory[d+6]),this.v3.add(m.multiply(s)).rotl(31).multiply(o),d+=8,m=r(this.memory[d+1]<<8|this.memory[d],this.memory[d+3]<<8|this.memory[d+2],this.memory[d+5]<<8|this.memory[d+4],this.memory[d+7]<<8|this.memory[d+6]),this.v4.add(m.multiply(s)).rotl(31).multiply(o);a+=32-this.memsize,this.memsize=0,n&&(this.memory="")}if(a<=c-32){var u=c-32;do{var m;if(n)m=r(e.charCodeAt(a+1)<<8|e.charCodeAt(a),e.charCodeAt(a+3)<<8|e.charCodeAt(a+2),e.charCodeAt(a+5)<<8|e.charCodeAt(a+4),e.charCodeAt(a+7)<<8|e.charCodeAt(a+6)),this.v1.add(m.multiply(s)).rotl(31).multiply(o),a+=8,m=r(e.charCodeAt(a+1)<<8|e.charCodeAt(a),e.charCodeAt(a+3)<<8|e.charCodeAt(a+2),e.charCodeAt(a+5)<<8|e.charCodeAt(a+4),e.charCodeAt(a+7)<<8|e.charCodeAt(a+6)),this.v2.add(m.multiply(s)).rotl(31).multiply(o),a+=8,m=r(e.charCodeAt(a+1)<<8|e.charCodeAt(a),e.charCodeAt(a+3)<<8|e.charCodeAt(a+2),e.charCodeAt(a+5)<<8|e.charCodeAt(a+4),e.charCodeAt(a+7)<<8|e.charCodeAt(a+6)),this.v3.add(m.multiply(s)).rotl(31).multiply(o),a+=8,m=r(e.charCodeAt(a+1)<<8|e.charCodeAt(a),e.charCodeAt(a+3)<<8|e.charCodeAt(a+2),e.charCodeAt(a+5)<<8|e.charCodeAt(a+4),e.charCodeAt(a+7)<<8|e.charCodeAt(a+6)),this.v4.add(m.multiply(s)).rotl(31).multiply(o);else m=r(e[a+1]<<8|e[a],e[a+3]<<8|e[a+2],e[a+5]<<8|e[a+4],e[a+7]<<8|e[a+6]),this.v1.add(m.multiply(s)).rotl(31).multiply(o),m=r(e[(a+=8)+1]<<8|e[a],e[a+3]<<8|e[a+2],e[a+5]<<8|e[a+4],e[a+7]<<8|e[a+6]),this.v2.add(m.multiply(s)).rotl(31).multiply(o),m=r(e[(a+=8)+1]<<8|e[a],e[a+3]<<8|e[a+2],e[a+5]<<8|e[a+4],e[a+7]<<8|e[a+6]),this.v3.add(m.multiply(s)).rotl(31).multiply(o),m=r(e[(a+=8)+1]<<8|e[a],e[a+3]<<8|e[a+2],e[a+5]<<8|e[a+4],e[a+7]<<8|e[a+6]),this.v4.add(m.multiply(s)).rotl(31).multiply(o);a+=8}while(a<=u)}return a<c&&(n?this.memory+=e.slice(a):t?this.memory.set(e.subarray(a,c),this.memsize):e.copy(this.memory,this.memsize,a,c),this.memsize=c-a),this},d.prototype.digest=function(){var e,t,n=this.memory,i="string"==typeof n,d=0,u=this.memsize,m=new r;for(this.total_len>=32?((e=this.v1.clone().rotl(1)).add(this.v2.clone().rotl(7)),e.add(this.v3.clone().rotl(12)),e.add(this.v4.clone().rotl(18)),e.xor(this.v1.multiply(s).rotl(31).multiply(o)),e.multiply(o).add(l),e.xor(this.v2.multiply(s).rotl(31).multiply(o)),e.multiply(o).add(l),e.xor(this.v3.multiply(s).rotl(31).multiply(o)),e.multiply(o).add(l),e.xor(this.v4.multiply(s).rotl(31).multiply(o)),e.multiply(o).add(l)):e=this.seed.clone().add(c),e.add(m.fromNumber(this.total_len));d<=u-8;)i?m.fromBits(n.charCodeAt(d+1)<<8|n.charCodeAt(d),n.charCodeAt(d+3)<<8|n.charCodeAt(d+2),n.charCodeAt(d+5)<<8|n.charCodeAt(d+4),n.charCodeAt(d+7)<<8|n.charCodeAt(d+6)):m.fromBits(n[d+1]<<8|n[d],n[d+3]<<8|n[d+2],n[d+5]<<8|n[d+4],n[d+7]<<8|n[d+6]),m.multiply(s).rotl(31).multiply(o),e.xor(m).rotl(27).multiply(o).add(l),d+=8;for(d+4<=u&&(i?m.fromBits(n.charCodeAt(d+1)<<8|n.charCodeAt(d),n.charCodeAt(d+3)<<8|n.charCodeAt(d+2),0,0):m.fromBits(n[d+1]<<8|n[d],n[d+3]<<8|n[d+2],0,0),e.xor(m.multiply(o)).rotl(23).multiply(s).add(a),d+=4);d<u;)m.fromBits(i?n.charCodeAt(d++):n[d++],0,0,0),e.xor(m.multiply(c)).rotl(11).multiply(o);return t=e.clone().shiftRight(33),e.xor(t).multiply(s),t=e.clone().shiftRight(29),e.xor(t).multiply(a),t=e.clone().shiftRight(32),e.xor(t),this.init(this.seed),e},e.exports=d},"./node_modules/@babel/runtime/helpers/interopRequireWildcard.js":(e,t,n)=>{var i=n("./node_modules/@babel/runtime/helpers/typeof.js").default;function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}e.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=i(e)&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var o={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&{}.hasOwnProperty.call(e,a)){var l=s?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,n&&n.set(e,o),o},e.exports.__esModule=!0,e.exports.default=e.exports},"./node_modules/@babel/runtime/helpers/objectSpread2.js":(e,t,n)=>{var i=n("./node_modules/@babel/runtime/helpers/defineProperty.js");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},"./node_modules/bloom-filters/dist/api.js":function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ScalableBloomFilter=t.DeprecatedHashing=t.Hashing=t.Cell=t.InvertibleBloomFilter=t.CuckooFilter=t.MinHashFactory=t.MinHash=t.TopK=t.HyperLogLog=t.CountMinSketch=t.PartitionedBloomFilter=t.CountingBloomFilter=t.XorFilter=t.BitSet=t.BloomFilter=t.BaseFilter=void 0;var r=n("./node_modules/bloom-filters/dist/base-filter.js");Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return i(r).default}});var o=n("./node_modules/bloom-filters/dist/bloom/bloom-filter.js");Object.defineProperty(t,"BloomFilter",{enumerable:!0,get:function(){return i(o).default}});var s=n("./node_modules/bloom-filters/dist/bloom/bit-set.js");Object.defineProperty(t,"BitSet",{enumerable:!0,get:function(){return i(s).default}});var a=n("./node_modules/bloom-filters/dist/bloom/xor-filter.js");Object.defineProperty(t,"XorFilter",{enumerable:!0,get:function(){return i(a).default}});var l=n("./node_modules/bloom-filters/dist/bloom/counting-bloom-filter.js");Object.defineProperty(t,"CountingBloomFilter",{enumerable:!0,get:function(){return i(l).default}});var c=n("./node_modules/bloom-filters/dist/bloom/partitioned-bloom-filter.js");Object.defineProperty(t,"PartitionedBloomFilter",{enumerable:!0,get:function(){return i(c).default}});var d=n("./node_modules/bloom-filters/dist/sketch/count-min-sketch.js");Object.defineProperty(t,"CountMinSketch",{enumerable:!0,get:function(){return i(d).default}});var u=n("./node_modules/bloom-filters/dist/sketch/hyperloglog.js");Object.defineProperty(t,"HyperLogLog",{enumerable:!0,get:function(){return i(u).default}});var m=n("./node_modules/bloom-filters/dist/sketch/topk.js");Object.defineProperty(t,"TopK",{enumerable:!0,get:function(){return i(m).default}});var h=n("./node_modules/bloom-filters/dist/sketch/min-hash.js");Object.defineProperty(t,"MinHash",{enumerable:!0,get:function(){return h.MinHash}});var p=n("./node_modules/bloom-filters/dist/sketch/min-hash-factory.js");Object.defineProperty(t,"MinHashFactory",{enumerable:!0,get:function(){return i(p).default}});var g=n("./node_modules/bloom-filters/dist/cuckoo/cuckoo-filter.js");Object.defineProperty(t,"CuckooFilter",{enumerable:!0,get:function(){return i(g).default}});var v=n("./node_modules/bloom-filters/dist/iblt/invertible-bloom-lookup-tables.js");Object.defineProperty(t,"InvertibleBloomFilter",{enumerable:!0,get:function(){return i(v).default}});var _=n("./node_modules/bloom-filters/dist/iblt/cell.js");Object.defineProperty(t,"Cell",{enumerable:!0,get:function(){return i(_).default}});var f=n("./node_modules/bloom-filters/dist/hashing/hashing.js");Object.defineProperty(t,"Hashing",{enumerable:!0,get:function(){return i(f).default}});var y=n("./node_modules/bloom-filters/dist/hashing/deprecated_hashing.js");Object.defineProperty(t,"DeprecatedHashing",{enumerable:!0,get:function(){return i(y).default}});var E=n("./node_modules/bloom-filters/dist/bloom/scalable-bloom-filter.js");Object.defineProperty(t,"ScalableBloomFilter",{enumerable:!0,get:function(){return i(E).default}})},"./node_modules/bloom-filters/dist/base-filter.js":function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(n("./node_modules/seedrandom/index.js")),o=i(n("./node_modules/bloom-filters/dist/hashing/hashing.js")),s=n("./node_modules/bloom-filters/dist/utils.js"),a=function(){function e(){this._seed=(0,s.getDefaultSeed)(),this._rng=(0,r.default)("".concat(this._seed)),this._hashing=new o.default}return Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(e){this._seed=e,this._rng=(0,r.default)("".concat(this._seed))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"random",{get:function(){return this._rng},enumerable:!1,configurable:!0}),e.prototype.nextInt32=function(){return this._rng.int32()},e.prototype.saveAsJSON=function(){throw new Error("not-implemented")},e.fromJSON=function(e){throw new Error("not-implemented")},e}();t.default=a},"./node_modules/bloom-filters/dist/bloom/bit-set.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("./node_modules/base64-arraybuffer/dist/base64-arraybuffer.umd.js"),r=function(){function e(e){var t=8-e%8;this.size=e+([0,8].includes(t)?0:t),this.array=new Uint8Array(Math.ceil(this.size/8))}return e.prototype.has=function(e){var t=Math.floor(e/8),n=1<<e%8;return!!(this.array[t]&n)},e.prototype.add=function(e){var t=Math.floor(e/8),n=1<<e%8;this.array[t]=this.array[t]|n},e.prototype.max=function(){for(var t=this.array.length-1;t>=0;t--){var n=this.array[t];if(n)return e.highBit(n)+8*t}return 0},e.prototype.bitCount=function(){for(var t=0,n=0;n<this.array.length;n++)t+=e.countBits(this.array[n]);return t},e.prototype.equals=function(e){if(e.size!==this.size)return!1;for(var t=0;t<this.array.length;t++)if(this.array[t]!==e.array[t])return!1;return!0},e.prototype.export=function(){return{size:this.size,content:(0,i.encode)(this.array)}},e.import=function(t){if("number"!=typeof t.size)throw Error("BitSet missing size");if("string"!=typeof t.content)throw Error("BitSet: missing content");var n=new e(t.size),r=(0,i.decode)(t.content);return n.array=new Uint8Array(r),n},e.highBit=function(e){for(var t=7,n=1<<t;t>=0&&(n&e)!==n;)n>>>=1,t--;return t},e.countBits=function(e){for(var t=1&e;0!==e;)t+=1&(e>>>=1);return t},e}();t.default=r},"./node_modules/bloom-filters/dist/bloom/bloom-filter.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=l(n("./node_modules/bloom-filters/dist/base-filter.js")),d=l(n("./node_modules/bloom-filters/dist/bloom/bit-set.js")),u=n("./node_modules/bloom-filters/dist/exportable.js"),m=n("./node_modules/bloom-filters/dist/formulas.js"),h=function(e){function t(t,n){var i=e.call(this)||this;if(n<1)throw new Error("A BloomFilter cannot uses less than one hash function, while you tried to use ".concat(n,"."));return i._size=t,i._nbHashes=n,i._filter=new d.default(t),i}var n;return r(t,e),n=t,t.create=function(e,t){var n=(0,m.optimalFilterSize)(e,t);return new this(n,(0,m.optimalHashes)(n,e))},t.from=function(e,t,i){var r=Array.from(e),o=n.create(r.length,t);return"number"==typeof i&&(o.seed=i),r.forEach((function(e){return o.add(e)})),o},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._filter.bitCount()},enumerable:!1,configurable:!0}),t.prototype.add=function(e){for(var t=this._hashing.getIndexes(e,this._size,this._nbHashes,this.seed),n=0;n<t.length;n++)this._filter.add(t[n])},t.prototype.has=function(e){for(var t=this._hashing.getIndexes(e,this._size,this._nbHashes,this.seed),n=0;n<t.length;n++)if(!this._filter.has(t[n]))return!1;return!0},t.prototype.rate=function(){return Math.pow(1-Math.exp(-this.length/this._size),this._nbHashes)},t.prototype.equals=function(e){return this._size===e._size&&this._nbHashes===e._nbHashes&&this._filter.equals(e._filter)},o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_size",void 0),o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_nbHashes",void 0),o([(0,u.Field)((function(e){return e.export()}),(function(e){if(Array.isArray(e)){var t=new d.default(e.length);return e.forEach((function(e,n){0!==e&&t.add(n)})),t}return d.default.import(e)})),s("design:type",d.default)],t.prototype,"_filter",void 0),t=n=o([(0,u.AutoExportable)("BloomFilter",["_seed"]),a(0,(0,u.Parameter)("_size")),a(1,(0,u.Parameter)("_nbHashes")),s("design:paramtypes",[Number,Number])],t)}(c.default);t.default=h},"./node_modules/bloom-filters/dist/bloom/counting-bloom-filter.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=l(n("./node_modules/bloom-filters/dist/base-filter.js")),d=n("./node_modules/bloom-filters/dist/exportable.js"),u=n("./node_modules/bloom-filters/dist/formulas.js"),m=n("./node_modules/bloom-filters/dist/utils.js"),h=function(e){function t(t,n){var i=e.call(this)||this;if(n<1)throw new Error("A CountingBloomFilter must used at least one hash function, but you tried to use ".concat(n," functions. Consider increasing it."));return i._size=t,i._nbHashes=n,i._filter=(0,m.allocateArray)(i._size,(function(){return[0,0]})),i._length=0,i}var n;return r(t,e),n=t,t.create=function(e,t){var i=(0,u.optimalFilterSize)(e,t);return new n(i,(0,u.optimalHashes)(i,e))},t.from=function(e,t){var i=Array.from(e),r=n.create(i.length,t);return i.forEach((function(e){return r.add(e)})),r},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),t.prototype.add=function(e){for(var t=this._hashing.getIndexes(e,this._size,this._nbHashes,this.seed),n=0;n<t.length;n++)this._filter[t[n]][1]+=1,this._filter[t[n]][1]>0&&(this._filter[t[n]][0]=1);this._length++},t.prototype.remove=function(e){for(var t=this._hashing.getIndexes(e,this._size,this._nbHashes,this.seed),n=0;n<t.length;n++)this._filter[t[n]][1]-=1,this._filter[t[n]][1]<=0&&(this._filter[t[n]][0]=0);return this._length--,!0},t.prototype.has=function(e){for(var t=this._hashing.getIndexes(e,this._size,this._nbHashes,this.seed),n=0;n<t.length;n++)if(!this._filter[t[n]][0])return!1;return!0},t.prototype.rate=function(){return Math.pow(1-Math.exp(-this._nbHashes*this._length/this._size),this._nbHashes)},t.prototype.equals=function(e){return this._size===e._size&&this._nbHashes===e._nbHashes&&this._length===e._length&&this._filter.every((function(t,n){return e._filter[n][0]===t[0]&&e._filter[n][1]===t[1]}))},o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_size",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_nbHashes",void 0),o([(0,d.Field)(),s("design:type",Array)],t.prototype,"_filter",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_length",void 0),t=n=o([(0,d.AutoExportable)("CountingBloomFilter",["_seed"]),a(0,(0,d.Parameter)("_size")),a(1,(0,d.Parameter)("_nbHashes")),s("design:paramtypes",[Number,Number])],t)}(c.default);t.default=h},"./node_modules/bloom-filters/dist/bloom/partitioned-bloom-filter.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=l(n("./node_modules/bloom-filters/dist/base-filter.js")),d=n("./node_modules/bloom-filters/dist/exportable.js"),u=n("./node_modules/bloom-filters/dist/utils.js"),m=l(n("./node_modules/bloom-filters/dist/bloom/bit-set.js"));var h=function(e){function t(t,n,i,r){var o=e.call(this)||this;return o._size=t,o._nbHashes=n,o._loadFactor=i,o._m=Math.ceil(o._size/o._nbHashes),o._filter=(0,u.allocateArray)(o._nbHashes,(function(){return new m.default(o._m)})),o._capacity=void 0!==r?r:function(e,t,n){return Math.ceil(e*(Math.log(t)*Math.log(1-t))/(-n*Math.log(t)))}(o._size,i,n),o}var n;return r(t,e),n=t,t.create=function(e,t,i){void 0===i&&(i=.5);var r=function(e,t,n){return Math.ceil(e*-Math.log(t)/(Math.log(n)*Math.log(1-n)))}(e,t,i),o=function(e,t){return Math.ceil(Math.log(e)/Math.log(t))}(t,i);return new n(r,o,i,e)},t.from=function(e,t,i){void 0===i&&(i=.5);var r=Array.from(e),o=n.create(r.length,t,i);return r.forEach((function(e){return o.add(e)})),o},Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadFactor",{get:function(){return this._loadFactor},enumerable:!1,configurable:!0}),t.prototype.add=function(e){for(var t=this._hashing.getIndexes(e,this._m,this._nbHashes,this.seed),n=0;n<this._nbHashes;n++)this._filter[n].add(t[n])},t.prototype.has=function(e){for(var t=this._hashing.getIndexes(e,this._m,this._nbHashes,this.seed),n=0;n<this._nbHashes;n++)if(!this._filter[n].has(t[n]))return!1;return!0},t.prototype.rate=function(){var e=this._currentload();return Math.pow(e,this._nbHashes)},t.prototype.equals=function(e){return this._size===e._size&&this._nbHashes===e._nbHashes&&this._loadFactor===e._loadFactor&&this._filter.every((function(t,n){return e._filter[n].equals(t)}))},t.prototype._currentload=function(){return this._filter.map((function(e){return e.bitCount()})).reduce((function(e,t){return e+t}),0)/this._size},o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_size",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_nbHashes",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_loadFactor",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_m",void 0),o([(0,d.Field)((function(e){return e.map((function(e){return e.export()}))}),(function(e){return e.map((function(e){if(Array.isArray(e)){var t=new m.default(e.length);return e.forEach((function(e,n){0!==e&&t.add(n)})),t}return m.default.import(e)}))})),s("design:type",Array)],t.prototype,"_filter",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_capacity",void 0),t=n=o([(0,d.AutoExportable)("PartitionedBloomFilter",["_seed"]),a(0,(0,d.Parameter)("_size")),a(1,(0,d.Parameter)("_nbHashes")),a(2,(0,d.Parameter)("_loadFactor")),a(3,(0,d.Parameter)("_capacity")),s("design:paramtypes",[Number,Number,Number,Number])],t)}(c.default);t.default=h},"./node_modules/bloom-filters/dist/bloom/scalable-bloom-filter.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=l(n("./node_modules/bloom-filters/dist/base-filter.js")),d=n("./node_modules/bloom-filters/dist/exportable.js"),u=l(n("./node_modules/bloom-filters/dist/bloom/partitioned-bloom-filter.js")),m=l(n("./node_modules/seedrandom/index.js")),h=function(e){function t(t,n,i){void 0===t&&(t=8),void 0===n&&(n=.01),void 0===i&&(i=.5);var r=e.call(this)||this;return r._filters=[],r._initial_size=t,r._error_rate=n,r._ratio=i,r._filters.push(u.default.create(r._initial_size,r._error_rate,r._ratio)),r._filters[r._filters.length-1].seed=r.seed,r}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){var t=this;this._seed=e,this._rng=(0,m.default)("".concat(this._seed)),this._filters.forEach((function(e){e.seed=t.seed}))},enumerable:!1,configurable:!0}),t.prototype.add=function(e){var t=this._filters[this._filters.length-1];if(t._currentload()>t._loadFactor){var i=this._initial_size*Math.pow(n._s,this._filters.length+1)*Math.LN2,r=this._error_rate*Math.pow(this._ratio,this._filters.length);this._filters.push(u.default.create(i,r,this._ratio)),this._filters[this._filters.length-1].seed=this.seed}this._filters[this._filters.length-1].add(e)},t.prototype.has=function(e){return this._filters.some((function(t){return t.has(e)}))},t.prototype.capacity=function(){return this._filters.map((function(e){return e._capacity})).reduce((function(e,t){return e+t}),0)},t.prototype.rate=function(){return this._filters[this._filters.length-1].rate()},t.prototype.equals=function(e){return this.seed===e.seed&&this._ratio===e._ratio&&this.capacity()===e.capacity()&&this._filters.every((function(t,n){return e._filters[n].equals(t)}))},t.create=function(e,t,i){return void 0===i&&(i=.5),new n(e,t,i)},t._s=2,o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_initial_size",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_error_rate",void 0),o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_ratio",void 0),o([(0,d.Field)((function(e){return e.map((function(e){return e.saveAsJSON()}))}),(function(e){return e.map((function(e){return u.default.fromJSON(e)}))})),s("design:type",Array)],t.prototype,"_filters",void 0),t=n=o([(0,d.AutoExportable)("ScalableBloomFilter",["_seed"]),a(0,(0,d.Parameter)("_initial_size")),a(1,(0,d.Parameter)("_error_rate")),a(2,(0,d.Parameter)("_ratio")),s("design:paramtypes",[Object,Object,Object])],t)}(c.default);t.default=h},"./node_modules/bloom-filters/dist/bloom/xor-filter.js":function(e,t,n){"use strict";var i,r=n("./node_modules/buffer/index.js").hp,o=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=c(n("./node_modules/bloom-filters/dist/base-filter.js")),u=n("./node_modules/bloom-filters/dist/exportable.js"),m=n("./node_modules/bloom-filters/dist/utils.js"),h=c(n("./node_modules/xxhashjs/lib/index.js")),p=c(n("./node_modules/long/umd/index.js")),g=n("./node_modules/base64-arraybuffer/dist/base64-arraybuffer.umd.js"),v=new Map;v.set(8,255),v.set(16,65535);var _=function(e){function t(t,n){var i=e.call(this)||this;if(i.ALLOWED_FINGERPRINT_SIZES=[8,16],i.HASHES=3,i.OFFSET=32,i.FACTOR_TIMES_100=123,i._bits=8,!r)throw new Error(m.BufferError);if(n){if(!i.ALLOWED_FINGERPRINT_SIZES.includes(n))throw new Error("bits_per_fingerprint parameter must be one of: [".concat(i.ALLOWED_FINGERPRINT_SIZES.join(","),"], got: ").concat(n));i._bits=n}if(t<=0)throw new Error("a XorFilter must be calibrated for a given number of elements");i._size=t;var o=i._getOptimalFilterSize(i._size);return i._blockLength=o/i.HASHES,i._filter=(0,m.allocateArray)(o,(function(){return r.allocUnsafe(i._bits/8).fill(0)})),i}var n;return o(t,e),n=t,t.prototype.has=function(e){var t=this._hash64(e instanceof p.default?e:this._hashable_to_long(e,this.seed),this.seed),n=this._fingerprint(t).toInt(),i=p.default.fromInt(t.toInt()),r=p.default.fromInt(t.rotl(21).toInt()),o=p.default.fromInt(t.rotl(42).toInt()),s=this._reduce(i,this._blockLength),a=this._reduce(r,this._blockLength)+this._blockLength,l=this._reduce(o,this._blockLength)+2*this._blockLength;return!((n^this._readBuffer(this._filter[s])^this._readBuffer(this._filter[a])^this._readBuffer(this._filter[l]))&v.get(this._bits))},t.prototype.add=function(e){if(e.length!==this._size)throw new Error("This filter has been created for exactly ".concat(this._size," elements"));this._create(e,this._filter.length)},t.prototype.equals=function(e){if(this.seed!==e.seed)return!1;if(this._bits!==e._bits)return!1;if(this._size!==e._size)return!1;for(var t=!0,n=0;t&&n<this._filter.length;)e._filter[n].equals(this._filter[n])?n++:t=!1;return t},t.create=function(e,t){var i=new n(e.length,t);return i.add(e),i},t.prototype._getOptimalFilterSize=function(e){var t=p.default.ONE.multiply(this.FACTOR_TIMES_100).multiply(e).divide(100).add(this.OFFSET);return t.add(-t.mod(this.HASHES)).toInt()},t.prototype._readBuffer=function(e){var t;if(16===this._bits)t=e.readInt16LE();else t=e.readInt8();return t},t.prototype._fingerprint=function(e){return e.and((1<<this._bits)-1)},t.prototype._hashable_to_long=function(e,t){return p.default.fromString(h.default.h64(e,t).toString(10),10)},t.prototype._hash64=function(e,t){var n=e.add(t);return n=(n=n=(n=n.xor(n.shiftRightUnsigned(33)).multiply(p.default.fromString("0xff51afd7ed558ccd",16))).xor(n.shiftRightUnsigned(33)).multiply(p.default.fromString("0xc4ceb9fe1a85ec53",16))).xor(n.shiftRightUnsigned(33))},t.prototype._reduce=function(e,t){return e.and(p.default.fromString("0xffffffff",16)).multiply(t).shiftRightUnsigned(32).toInt()},t.prototype._getHash=function(e,t,n){var i=this._hash64(e,t).rotl(21*n);return this._reduce(i,this._blockLength)+n*this._blockLength},t.prototype._create=function(e,t){var n,i=this,o=(0,m.allocateArray)(this._size,p.default.ZERO),s=(0,m.allocateArray)(this._size,0),a=function(){l.seed=l.nextInt32();var r=(0,m.allocateArray)(t,0),a=(0,m.allocateArray)(t,p.default.ZERO);e.map((function(e){return e instanceof p.default?e:i._hashable_to_long(e,i.seed)})).forEach((function(e){for(var t=0;t<i.HASHES;t++){var n=i._getHash(e,i.seed,t);if(a[n]=a[n].xor(e),r[n]>120)throw new Error("Probably something wrong with the hash function, t2count[".concat(n,"]=").concat(r[n]));r[n]++}})),n=0;for(var c=(0,m.allocateArray)(l.HASHES,(function(){return(0,m.allocateArray)(i._blockLength,0)})),d=(0,m.allocateArray)(l.HASHES,0),u=0;u<l.HASHES;u++)for(var h=0;h<l._blockLength;h++)1===r[u*l._blockLength+h]&&(c[u][d[u]++]=u*l._blockLength+h);for(var g=-1,v=0;-1!==v;){v=-1;for(var _=0;_<l.HASHES;_++)if(d[_]>0){v=c[_][--d[_]],g=_;break}if(-1===v)break;if(!(r[v]<=0)){var f=a[v];if(1!==r[v])throw new Error("At this step, the count must not be different of 1");--r[v];for(_=0;_<l.HASHES;_++)if(_!==g){var y=l._getHash(f,l.seed,_);1===--r[y]&&(c[_][d[_]++]=y),a[y]=a[y].xor(f)}o[n]=f,s[n]=g,n++}}},l=this;do{a()}while(n!==this._size);for(var c=n-1;c>=0;c--){for(var d=o[c],u=s[c],h=-1,g=this._hash64(d,this.seed),v=this._fingerprint(g).toInt(),_=0;_<this.HASHES;_++){var f=this._getHash(d,this.seed,_);u===_?h=f:v^=this._readBuffer(this._filter[f])}var y=r.from((0,m.allocateArray)(4,0));y.writeInt32LE(v),this._filter[h]=y.slice(0,this._bits/8)}},s([(0,u.Field)((function(e){return e.map(g.encode)}),(function(e){return e.map((function(e){return r.from((0,g.decode)(e))}))})),a("design:type",Array)],t.prototype,"_filter",void 0),s([(0,u.Field)(),a("design:type",Object)],t.prototype,"_bits",void 0),s([(0,u.Field)(),a("design:type",Number)],t.prototype,"_size",void 0),s([(0,u.Field)(),a("design:type",Number)],t.prototype,"_blockLength",void 0),t=n=s([(0,u.AutoExportable)("XorFilter",["_seed"]),l(0,(0,u.Parameter)("_size")),l(1,(0,u.Parameter)("_bits")),a("design:paramtypes",[Number,Number])],t)}(d.default);t.default=_},"./node_modules/bloom-filters/dist/cuckoo/bucket.js":function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return r(t,e),t},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var l=n("./node_modules/lodash/lodash.js"),c=s(n("./node_modules/bloom-filters/dist/utils.js")),d=n("./node_modules/bloom-filters/dist/exportable.js"),u=n("./node_modules/bloom-filters/dist/exportable.js"),m=function(){function e(e){this._elements=c.allocateArray(e,null),this._size=e,this._length=0}var t;return t=e,Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),e.prototype.isFree=function(){return this._length<this._size},e.prototype.nextEmptySlot=function(){return(0,l.indexOf)(this._elements,null)},e.prototype.at=function(e){return this._elements[e]},e.prototype.add=function(e){return!(null===e||!this.isFree())&&(this.set(this.nextEmptySlot(),e),this._length++,!0)},e.prototype.remove=function(e){var t=(0,l.indexOf)(this._elements,e);return!(t<=-1)&&(this.unset(t),!0)},e.prototype.has=function(e){return(0,l.indexOf)(this._elements,e)>-1},e.prototype.set=function(e,t){this._elements[e]=t},e.prototype.unset=function(e){this._elements[e]=null,this._length--},e.prototype.swapRandom=function(e,t){void 0===t&&(t=Math.random);var n=c.randomInt(0,this._length-1,t),i=this._elements[n];return this._elements[n]=e,i},e.prototype.swap=function(e,t){var n=this._elements[e];return this._elements[e]=t,n},e.prototype.equals=function(e){return this._size===e.size&&this._length===e.length&&this._elements.every((function(t,n){return(0,l.eq)(e.at(n),t)}))},e=t=o([(0,d.Exportable)({export:(0,u.cloneObject)("Bucket","_size","_elements"),import:function(e){if(e.type,!("_elements"in e))throw new Error("Cannot create a Bucket from a JSON export which does not represent a bucket");var n=new t(e._size);return e._elements.forEach((function(e,t){null!==e&&(n._elements[t]=e,n._length++)})),n}}),a("design:paramtypes",[Number])],e)}();t.default=m},"./node_modules/bloom-filters/dist/cuckoo/cuckoo-filter.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=a(n("./node_modules/bloom-filters/dist/base-filter.js")),c=a(n("./node_modules/bloom-filters/dist/cuckoo/bucket.js")),d=n("./node_modules/bloom-filters/dist/exportable.js"),u=n("./node_modules/bloom-filters/dist/utils.js");var m=function(e){function t(t,n,i,r){void 0===r&&(r=500);var o=e.call(this)||this;return o._filter=(0,u.allocateArray)(t,(function(){return new c.default(i)})),o._size=t,o._bucketSize=i,o._fingerprintLength=n,o._length=0,o._maxKicks=r,o}var n;return r(t,e),n=t,t.create=function(e,t,i,r){void 0===i&&(i=4),void 0===r&&(r=500);var o=function(e,t){var n=Math.ceil(Math.log2(1/t)+Math.log2(2*e));return Math.ceil(n/8)}(i,t),s=Math.ceil(e/i/.955);return new n(s,o,i,r)},t.from=function(e,t,i,r){void 0===i&&(i=4),void 0===r&&(r=500);var o=Array.from(e),s=n.create(o.length,t,i,r);return o.forEach((function(e){return s.add(e)})),s},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullSize",{get:function(){return this.size*this.bucketSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fingerprintLength",{get:function(){return this._fingerprintLength},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucketSize",{get:function(){return this._bucketSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxKicks",{get:function(){return this._maxKicks},enumerable:!1,configurable:!0}),t.prototype.add=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=this._locations(e);if(this._filter[i.firstIndex].isFree())this._filter[i.firstIndex].add(i.fingerprint);else{if(!this._filter[i.secondIndex].isFree()){for(var r=this.random()<.5?i.firstIndex:i.secondIndex,o=i.fingerprint,s=[],a=0;a<this._maxKicks;a++){var l=(0,u.randomInt)(0,this._filter[r].length-1,this.random),c=this._filter[r].at(l);s.push([r,l,c]),this._filter[r].set(l,o),o=c;var d=this._hashing.hashAsInt(o,this.seed);if(r=Math.abs(r^Math.abs(d))%this._filter.length,this._filter[r].isFree())return this._filter[r].add(o),this._length++,!0}if(!n)for(var m=s.length-1;m>=0;m--){var h=s[m];this._filter[h[0]].set(h[1],h[2])}if(t)throw new Error('The Cuckoo Filter is full, cannot insert element "'.concat(e,'"'));return!1}this._filter[i.secondIndex].add(i.fingerprint)}return this._length++,!0},t.prototype.remove=function(e){var t=this._locations(e);return this._filter[t.firstIndex].has(t.fingerprint)?(this._filter[t.firstIndex].remove(t.fingerprint),this._length--,!0):!!this._filter[t.secondIndex].has(t.fingerprint)&&(this._filter[t.secondIndex].remove(t.fingerprint),this._length--,!0)},t.prototype.has=function(e){var t=this._locations(e);return this._filter[t.firstIndex].has(t.fingerprint)||this._filter[t.secondIndex].has(t.fingerprint)},t.prototype.rate=function(){var e=this._computeHashTableLoad(),t=this._fingerprintLength/e.load;return Math.pow(2,Math.log2(2*this._bucketSize)-e.load*t)},t.prototype._computeHashTableLoad=function(){var e=this._filter.length*this._bucketSize,t=this._filter.reduce((function(e,t){return e+t.length}),0);return{used:t,free:e-t,size:e,load:t/e}},t.prototype._locations=function(e){var t=this._hashing.hashIntAndString(e,this.seed),n=t.int;if(this._fingerprintLength>t.string.length)throw new Error("The fingerprint length (".concat(this._fingerprintLength,") is higher than the hash length (").concat(t.string.length,"). Please reduce the fingerprint length or report if it is an unexpected behavior."));var i=t.string.substring(0,this._fingerprintLength),r=Math.abs(n),o=Math.abs(this._hashing.hashAsInt(i,this.seed)),s=Math.abs(r^o);return{fingerprint:i,firstIndex:r%this._size,secondIndex:s%this._size}},t.prototype.equals=function(e){for(var t=0,n=!0;n&&t<this._filter.length;){var i=this._filter[t];e._filter[t].equals(i)||(n=!1),t++}return n},t=n=o([(0,d.Exportable)({export:(0,d.cloneObject)("CuckooFilter","_size","_fingerprintLength","_length","_maxKicks","_filter","_seed"),import:function(e){if(!("CuckooFilter"===e.type&&"_size"in e&&"_fingerprintLength"in e&&"_length"in e&&"_maxKicks"in e&&"_filter"in e&&"_seed"in e))throw new Error("Cannot create a CuckooFilter from a JSON export which does not represent a cuckoo filter");var t=new n(e._size,e._fingerprintLength,e._bucketSize,e._maxKicks);return t._length=e._length,t._filter=e._filter.map((function(e){var t=new c.default(e._size);return e._elements.forEach((function(e,n){null!==e&&(t._elements[n]=e,t._length++)})),t})),t.seed=e._seed,t}}),s("design:paramtypes",[Number,Number,Number,Object])],t)}(l.default);t.default=m},"./node_modules/bloom-filters/dist/exportable.js":function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s},r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};function o(e){return null==e?e:Array.isArray(e)?e.map(o):"object"==typeof e?"saveAsJSON"in e?e.saveAsJSON():Object.assign({},e):e}Object.defineProperty(t,"__esModule",{value:!0}),t.AutoExportable=t.Parameter=t.Field=t.Exportable=t.cloneObject=t.cloneField=void 0,n("./node_modules/reflect-metadata/Reflect.js"),t.cloneField=o,t.cloneObject=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return function(n){var i={type:e};return t.forEach((function(e){i[e]=o(n[e])})),i}},t.Exportable=function(e){return function(t){return t.prototype.saveAsJSON=function(){return e.export(this)},t.fromJSON=function(t){return e.import(t)},t}};var s=Symbol("bloom-filters:exportable:class-name"),a=Symbol("bloom-filters:exportable:fields"),l=Symbol("bloom-filters:exportable:constructor-parameters");t.Field=function(e,t){return void 0===e&&(e=o),void 0===t&&(t=function(e){return e}),function(n,i){var r=[];Reflect.hasMetadata(a,n)&&(r=Reflect.getMetadata(a,n)),r.push({name:i,exporter:e,importer:t}),Reflect.defineMetadata(a,r,n)}},t.Parameter=function(e){return function(t,n,i){var r=new Map;Reflect.hasMetadata(l,t)&&(r=Reflect.getMetadata(l,t)),r.set(e,i),Reflect.defineMetadata(l,r,t)}},t.AutoExportable=function(e,t){return void 0===t&&(t=[]),function(n){if(Reflect.defineMetadata(s,e,n.prototype),!Reflect.hasMetadata(a,n.prototype)||0===t.length)throw new SyntaxError("No exported fields declared when @AutoExportable is called");Reflect.hasMetadata(l,n)||Reflect.defineMetadata(l,new Map,n),n.prototype.saveAsJSON=function(){var e=this,i={type:Reflect.getMetadata(s,n.prototype)};return Reflect.getMetadata(a,n.prototype).forEach((function(t){i[t.name]=t.exporter(e[t.name])})),t.forEach((function(t){i[t]=o(e[t])})),i},n.fromJSON=function(e){var o=Reflect.getMetadata(s,n.prototype),c=Reflect.getMetadata(l,n),d=Reflect.getMetadata(a,n.prototype);if(e.type!==o)throw new Error("Cannot create an object ".concat(o,' from a JSON export with type "').concat(e.type,'"'));var u=[],m=[];t.map((function(e){return{name:e,importer:function(e){return e}}})).concat(d).forEach((function(t){if(!(t.name in e))throw new Error('Invalid import: required field "'.concat(t,'" not found in JSON export "').concat(e,'"'));c.has(t.name)?u[c.get(t.name)]=t.importer(e[t.name]):m.push({name:t.name,value:t.importer(e[t.name])})}));var h=new(n.bind.apply(n,r([void 0],i(u),!1)));return m.forEach((function(e){h[e.name]=e.value})),h}}}},"./node_modules/bloom-filters/dist/formulas.js":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.optimalHashes=t.optimalFilterSize=void 0,t.optimalFilterSize=function(e,t){return Math.ceil(-e*Math.log(t)/Math.pow(Math.log(2),2))},t.optimalHashes=function(e,t){return Math.ceil(e/t*Math.log(2))}},"./node_modules/bloom-filters/dist/hashing/deprecated_hashing.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=n("./node_modules/bloom-filters/dist/utils.js"),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.doubleHashing=function(e,t,n,i){return Math.abs((t+e*n)%i)},t}return r(t,e),t.prototype.getIndexes=function(e,t,n,i){return this.getDistinctIndexes(e,t,n,i)},t.prototype.getDistinctIndexes=function(e,t,n,i){var r=this;void 0===i&&(i=(0,s.getDefaultSeed)());var o=function(e,t,n,s,a){if(void 0===a&&(a=[]),a.length===s)return a;var l=r.hashTwice(t,i+n%e),c=r.doubleHashing(e,l.first,l.second,n);return a.includes(c)||a.push(c),o(e+1,t,n,s,a)};return o(1,e,t,n)},t}(o(n("./node_modules/bloom-filters/dist/hashing/hashing.js")).default);t.default=a},"./node_modules/bloom-filters/dist/hashing/hashing.js":function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s},r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(n("./node_modules/xxhashjs/lib/index.js")),a=n("./node_modules/bloom-filters/dist/utils.js"),l=function(){function e(){}return e.prototype.doubleHashing=function(e,t,n,i){return Math.abs((t+e*n+Math.floor((Math.pow(e,3)-e)/6))%i)},e.prototype.getDistinctIndexes=function(e,t,n,o){void 0===o&&(o=(0,a.getDefaultSeed)());for(var s=0,l=new Set,c=this.hashTwice(e,o);l.size<n;){var d=c.first%t;l.has(d)||l.add(d),c.first=(c.first+c.second)%t,c.second=(c.second+s)%t,++s>t&&(o++,c=this.hashTwice(e,o))}return r([],i(l.values()),!1)},e.prototype.getIndexes=function(e,t,n,i){void 0===i&&(i=(0,a.getDefaultSeed)());for(var r=[],o=this.hashTwice(e,i),s=0;s<n;s++)r.push(this.doubleHashing(s,o.first,o.second,t));return r},e.prototype.serialize=function(e,t){return t||(t=(0,a.getDefaultSeed)()),Number(s.default.h64(e,t).toNumber())},e.prototype.hashTwice=function(e,t){return void 0===t&&(t=(0,a.getDefaultSeed)()),{first:this.serialize(e,t+1),second:this.serialize(e,t+2)}},e.prototype.hashTwiceAsString=function(e,t){var n=this.hashTwice(e,t),i=n.first,r=n.second;return{first:(0,a.numberToHex)(i),second:(0,a.numberToHex)(r)}},e.prototype.hashTwiceIntAndString=function(e,t){void 0===t&&(t=(0,a.getDefaultSeed)());var n=this.hashIntAndString(e,t+1),i=this.hashIntAndString(e,t+2);return{int:{first:n.int,second:i.int},string:{first:n.string,second:i.string}}},e.prototype.hashAsInt=function(e,t){return void 0===t&&(t=(0,a.getDefaultSeed)()),this.serialize(e,t)},e.prototype.hashIntAndString=function(e,t){var n=this.hashAsInt(e,t);return{int:n,string:(0,a.numberToHex)(n)}},e}();t.default=l},"./node_modules/bloom-filters/dist/iblt/cell.js":function(e,t,n){"use strict";var i,r=n("./node_modules/buffer/index.js").hp,o=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=n("./node_modules/bloom-filters/dist/utils.js"),u=n("./node_modules/bloom-filters/dist/exportable.js"),m=c(n("./node_modules/bloom-filters/dist/base-filter.js")),h=Symbol.for("nodejs.util.inspect.custom"),p=function(e){function t(t,n,i){var r=e.call(this)||this;return r._idSum=t,r._hashSum=n,r._count=i,r}var n;return o(t,e),n=t,t.empty=function(){return new n(r.allocUnsafe(0).fill(0),r.allocUnsafe(0).fill(0),0)},t.prototype[h]=function(){return"Cell:<".concat(JSON.stringify(this._idSum.toJSON().data),", ").concat(JSON.stringify(this._hashSum.toJSON().data),", ").concat(this._count,">")},Object.defineProperty(t.prototype,"idSum",{get:function(){return this._idSum},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hashSum",{get:function(){return this._hashSum},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),t.prototype.add=function(e,t){this._idSum=(0,d.xorBuffer)(this._idSum,e),this._hashSum=(0,d.xorBuffer)(this._hashSum,t),this._count++},t.prototype.xorm=function(e){return new n((0,d.xorBuffer)(this._idSum,e.idSum),(0,d.xorBuffer)(this._hashSum,e.hashSum),this._count-e.count)},t.prototype.isEmpty=function(){return this._idSum.equals(r.from(""))&&this._hashSum.equals(r.from(""))&&0===this._count},t.prototype.equals=function(e){return this._count===e.count&&this._idSum.equals(e.idSum)&&this._hashSum.equals(e.hashSum)},t.prototype.isPure=function(){if(this.isEmpty()||1!==this._count&&-1!==this._count)return!1;var e=this._hashing.hashTwiceAsString(JSON.stringify(this._idSum.toJSON()),this.seed);return this._hashSum.equals(r.from(e.first))},s([(0,u.Field)((function(e){return e.toString()}),r.from),a("design:type",r)],t.prototype,"_idSum",void 0),s([(0,u.Field)((function(e){return e.toString()}),r.from),a("design:type",r)],t.prototype,"_hashSum",void 0),s([(0,u.Field)(),a("design:type",Number)],t.prototype,"_count",void 0),t=n=s([(0,u.AutoExportable)("Cell",["_seed"]),l(0,(0,u.Parameter)("_idSum")),l(1,(0,u.Parameter)("_hashSum")),l(2,(0,u.Parameter)("_count")),a("design:paramtypes",[r,r,Number])],t)}(m.default);t.default=p},"./node_modules/bloom-filters/dist/iblt/invertible-bloom-lookup-tables.js":function(e,t,n){"use strict";var i,r=n("./node_modules/buffer/index.js").hp,o=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},c=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=d(n("./node_modules/bloom-filters/dist/base-filter.js")),m=d(n("./node_modules/bloom-filters/dist/iblt/cell.js")),h=n("./node_modules/bloom-filters/dist/exportable.js"),p=n("./node_modules/bloom-filters/dist/utils.js"),g=n("./node_modules/bloom-filters/dist/formulas.js"),v=function(e){function t(t,n){void 0===n&&(n=3);var i=e.call(this)||this;if(void 0===r)throw new Error('No native Buffer implementation bound in your JavaScript env. If you are in a Web browser, consider importing the polyfill "feross/buffer" (https://github.com/feross/buffer).');if(n<=0)throw new Error("The hashCount must be a non-zero, positive integer");return i._size=t,i._hashCount=n,i._elements=(0,p.allocateArray)(i._size,(function(){return m.default.empty()})),i}var n;return o(t,e),n=t,t.create=function(e,t){var i=(0,g.optimalFilterSize)(e,t),r=(0,g.optimalHashes)(i,e);return new n(i,r)},t.from=function(e,t){var i=Array.from(e),r=n.create(i.length,t);return i.forEach((function(e){return r.add(e)})),r},Object.defineProperty(t.prototype,"hashCount",{get:function(){return this._hashCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._elements.reduce((function(e,t){return e+t.count}),0)/this._hashCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"elements",{get:function(){return this._elements},enumerable:!1,configurable:!0}),t.prototype.add=function(e){for(var t=this._hashing.hashTwiceAsString(JSON.stringify(e.toJSON()),this.seed),n=this._hashing.getDistinctIndexes(t.first,this._size,this._hashCount,this.seed),i=0;i<this._hashCount;++i)this._elements[n[i]].add(e,r.from(t.first))},t.prototype.remove=function(e){for(var t=this._hashing.hashTwiceAsString(JSON.stringify(e.toJSON()),this.seed),n=this._hashing.getDistinctIndexes(t.first,this._size,this._hashCount,this.seed),i=0;i<this._hashCount;++i)this._elements[n[i]]=this._elements[n[i]].xorm(new m.default(r.from(e),r.from(t.first),1));return!0},t.prototype.has=function(e){for(var t=this._hashing.hashTwiceAsString(JSON.stringify(e.toJSON()),this.seed),n=this._hashing.getDistinctIndexes(t.first,this._size,this._hashCount,this.seed),i=0;i<this._hashCount;++i){if(0===this._elements[n[i]].count)return!1;if(1===this._elements[n[i]].count)return!!this._elements[n[i]].idSum.equals(e)}return!0},t.prototype.listEntries=function(){var e=this,t=[];return function(){var n,i,r;return c(this,(function(o){switch(o.label){case 0:n=function(n){var i;return c(this,(function(r){switch(r.label){case 0:return(i=e._elements[n]).count>0&&-1===t.findIndex((function(e){return e.equals(i.idSum)}))?e.has(i.idSum)?(t.push(i.idSum),[4,i.idSum]):[3,2]:[3,3];case 1:return r.sent(),[3,3];case 2:return[2,{value:!1}];case 3:return[2]}}))},i=0,o.label=1;case 1:return i<e._elements.length-1?[5,n(i)]:[3,4];case 2:if("object"==typeof(r=o.sent()))return[2,r.value];o.label=3;case 3:return i++,[3,1];case 4:return[2,!0]}}))}()},t.prototype.substract=function(e){if(this.size!==e.size)throw new Error("The two Invertible Bloom Filters must be of the same size");var t=new n(e._size,e._hashCount);t.seed=this.seed;for(var i=0;i<this.size;++i)t._elements[i]=this._elements[i].xorm(e._elements[i]);return t},t.prototype.equals=function(e){if(e._size!==this._size||e._hashCount!==this._hashCount||e.seed!==this.seed)return!1;for(var t=0;t<e._elements.length;++t)if(!e._elements[t].equals(this._elements[t]))return!1;return!0},t.prototype.decode=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);for(var n=[],i=null,o=0;o<this._elements.length;++o)(i=this._elements[o]).isPure()&&n.push(o);for(;0!==n.length;){var s=(i=this._elements[n.pop()]).idSum,a=i.count;if(i.isPure()){if(1===a)e.push(s);else{if(-1!==a)throw new Error("Please report, not possible");t.push(s)}var l=this._hashing.hashTwiceAsString(JSON.stringify(s.toJSON()),this.seed),c=this._hashing.getDistinctIndexes(l.first,this._size,this._hashCount,this.seed);for(o=0;o<c.length;++o)this._elements[c[o]]=this._elements[c[o]].xorm(new m.default(s,r.from(l.first),a)),this._elements[c[o]].isPure()&&n.push(c[o])}}return this._elements.findIndex((function(e){return!e.isEmpty()}))>-1?{success:!1,reason:{cell:i,iblt:this},additional:e,missing:t}:{success:!0,additional:e,missing:t}},s([(0,h.Field)(),a("design:type",Number)],t.prototype,"_size",void 0),s([(0,h.Field)(),a("design:type",Number)],t.prototype,"_hashCount",void 0),s([(0,h.Field)(void 0,(function(e){return e.map((function(e){var t=new m.default(r.from(e._idSum),r.from(e._hashSum),e._count);return t.seed=e._seed,t}))})),a("design:type",Array)],t.prototype,"_elements",void 0),t=n=s([(0,h.AutoExportable)("InvertibleBloomFilter",["_seed"]),l(0,(0,h.Parameter)("_size")),l(1,(0,h.Parameter)("_hashCount")),a("design:paramtypes",[Number,Object])],t)}(u.default);t.default=v},"./node_modules/bloom-filters/dist/sketch/count-min-sketch.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=c(n("./node_modules/bloom-filters/dist/base-filter.js")),u=n("./node_modules/bloom-filters/dist/exportable.js"),m=n("./node_modules/bloom-filters/dist/utils.js"),h=function(e){function t(t,n){var i=e.call(this)||this;return i._columns=t,i._rows=n,i._matrix=(0,m.allocateArray)(i._rows,(function(){return(0,m.allocateArray)(i._columns,0)})),i._allSums=0,i}var n;return r(t,e),n=t,t.create=function(e,t){void 0===t&&(t=.999);var i=Math.ceil(Math.E/e),r=Math.ceil(Math.log(1/t));return new n(i,r)},t.from=function(e,t,i){var r,o;void 0===i&&(i=.999);var s=n.create(t,i);try{for(var a=l(e),c=a.next();!c.done;c=a.next()){var d=c.value;s.update(d)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return s},Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sum",{get:function(){return this._allSums},enumerable:!1,configurable:!0}),t.prototype.update=function(e,t){void 0===t&&(t=1),this._allSums+=t;for(var n=this._hashing.getIndexes(e,this._columns,this._rows,this.seed),i=0;i<this._rows;i++)this._matrix[i][n[i]]+=t},t.prototype.count=function(e){for(var t=1/0,n=this._hashing.getIndexes(e,this._columns,this._rows,this.seed),i=0;i<this._rows;i++){var r=this._matrix[i][n[i]];t=Math.min(r,t)}return t},t.prototype.equals=function(e){if(this._columns!==e._columns||this._rows!==e._rows)return!1;for(var t=0;t<this._rows;t++)for(var n=0;n<this._columns;n++)if(this._matrix[t][n]!==e._matrix[t][n])return!1;return!0},t.prototype.merge=function(e){if(this._columns!==e._columns)throw new Error("Cannot merge two sketches with different number of columns");if(this._rows!==e._rows)throw new Error("Cannot merge two sketches with different number of rows");for(var t=0;t<this._rows;t++)for(var n=0;n<this._columns;n++)this._matrix[t][n]+=e._matrix[t][n]},t.prototype.clone=function(){var e=new n(this._columns,this._rows);return e.merge(this),e.seed=this.seed,e},o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_columns",void 0),o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_rows",void 0),o([(0,u.Field)(),s("design:type",Array)],t.prototype,"_matrix",void 0),o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_allSums",void 0),t=n=o([(0,u.AutoExportable)("CountMinSketch",["_seed"]),a(0,(0,u.Parameter)("_columns")),a(1,(0,u.Parameter)("_rows")),s("design:paramtypes",[Number,Number])],t)}(d.default);t.default=h},"./node_modules/bloom-filters/dist/sketch/hyperloglog.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=l(n("./node_modules/xxhashjs/lib/index.js")),d=l(n("./node_modules/bloom-filters/dist/base-filter.js")),u=n("./node_modules/bloom-filters/dist/exportable.js"),m=n("./node_modules/bloom-filters/dist/utils.js"),h=Math.pow(2,32);var p=function(e){function t(t){var n,i=e.call(this)||this;if(t&t-1)throw new Error("The number of registers should be a power of 2");return i._nbRegisters=t,i._nbBytesPerHash=Math.ceil(Math.log2(t)),i._correctionBias=(n=t)<16?1:n<32?.673:n<64?.697:n<128?.709:.7213/(1+1.079/n),i._registers=(0,m.allocateArray)(i._nbRegisters,0),i}var n;return r(t,e),n=t,Object.defineProperty(t.prototype,"nbRegisters",{get:function(){return this._nbRegisters},enumerable:!1,configurable:!0}),t.prototype.update=function(e){for(var t=c.default.h64(e,this.seed).toString(2).padStart(64,"0"),n=64-this._nbBytesPerHash,i=parseInt(t.slice(n),2),r=t.slice(0,n),o=n-1,s=!1,a=0;!s&&a<r.length;)"1"===r[a]?(s=!0,o=a):a++;this._registers[i]=Math.max(this._registers[i],o)},t.prototype.count=function(e){void 0===e&&(e=!1);var t,n=this._registers.reduce((function(e,t){return e+Math.pow(2,-t)}),0),i=this._correctionBias*this._nbRegisters*this._nbRegisters*2/n;if(i<=2.5*this._nbRegisters){var r=this._registers.filter((function(e){return 0===e})).length;t=r>0?this._nbRegisters*Math.log(this._nbRegisters/r):i}else t=i<=h/30?i:-h*Math.log(1-i/h);return e?Math.round(t):t},t.prototype.accuracy=function(){return 1.04/Math.sqrt(this._nbRegisters)},t.prototype.merge=function(e){if(this.nbRegisters!==e.nbRegisters)throw new Error("Two HyperLogLog must have the same number of registers to be merged. Tried to merge two HyperLogLog with m = ".concat(this.nbRegisters," and m = ").concat(e.nbRegisters));for(var t=new n(this.nbRegisters),i=0;i<this.nbRegisters;i++)t._registers[i]=Math.max(this._registers[i],e._registers[i]);return t},t.prototype.equals=function(e){if(this.nbRegisters!==e.nbRegisters)return!1;for(var t=0;t<this.nbRegisters-1;t++)if(this._registers[t]!==e._registers[t])return!1;return!0},o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_nbRegisters",void 0),o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_nbBytesPerHash",void 0),o([(0,u.Field)(),s("design:type",Number)],t.prototype,"_correctionBias",void 0),o([(0,u.Field)(),s("design:type",Array)],t.prototype,"_registers",void 0),t=n=o([(0,u.AutoExportable)("HyperLogLog",["_seed"]),a(0,(0,u.Parameter)("_nbRegisters")),s("design:paramtypes",[Number])],t)}(d.default);t.default=p},"./node_modules/bloom-filters/dist/sketch/min-hash-factory.js":(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("./node_modules/bloom-filters/dist/sketch/min-hash.js"),r=n("./node_modules/lodash/lodash.js");function o(e){if(2!==e&&e%2==0)return!1;for(var t=2;t<Math.sqrt(e);t++)if(e%t==0)return!1;return!0}var s=function(){function e(e,t){this._nbHashes=e,this._maxValue=t,this._hashFunctions=[];for(var n=function(e){for(var t=0,n=!1,i=t;!n;)o(e+t)&&(i=e+t,n=!0),t++;return i}(this._maxValue),i=0;i<this._nbHashes;i++){var s=(0,r.random)(0,this._maxValue,!1),a=(0,r.random)(0,this._maxValue,!1);this._hashFunctions.push({a:s,b:a,c:n})}}return e.prototype.create=function(){return new i.MinHash(this._nbHashes,this._hashFunctions)},e}();t.default=s},"./node_modules/bloom-filters/dist/sketch/min-hash.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MinHash=void 0;var c=l(n("./node_modules/bloom-filters/dist/base-filter.js")),d=n("./node_modules/bloom-filters/dist/exportable.js"),u=n("./node_modules/bloom-filters/dist/utils.js"),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(Error);function h(e,t){return(t.a*e+t.b)%t.c}var p=function(e){function t(t,n){var i=e.call(this)||this;return i._nbHashes=t,i._hashFunctions=n,i._signature=(0,u.allocateArray)(i._nbHashes,1/0),i}return r(t,e),Object.defineProperty(t.prototype,"nbHashes",{get:function(){return this._nbHashes},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return this._signature[0]===1/0},t.prototype.add=function(e){for(var t=0;t<this._nbHashes;t++){var n=h(e,this._hashFunctions[t]);this._signature[t]=Math.min(this._signature[t],n)}},t.prototype.bulkLoad=function(e){for(var t=this,n=function(n){for(var r=e.map((function(e){return h(e,t._hashFunctions[n])})),o=r[0],s=1;s<r.length;s++)o>r[s]&&(o=r[s]);i._signature[n]=Math.min(i._signature[n],o)},i=this,r=0;r<this._nbHashes;r++)n(r)},t.prototype.compareWith=function(e){if(this.isEmpty()||e.isEmpty())throw new m("Cannot compute a Jaccard similairty with a MinHash that contains no values");for(var t=0,n=0;n<this._nbHashes;n++)this._signature[n]===e._signature[n]&&t++;return t/this._nbHashes},o([(0,d.Field)(),s("design:type",Number)],t.prototype,"_nbHashes",void 0),o([(0,d.Field)(),s("design:type",Array)],t.prototype,"_hashFunctions",void 0),o([(0,d.Field)(),s("design:type",Array)],t.prototype,"_signature",void 0),t=o([(0,d.AutoExportable)("MinHash",["_seed"]),a(0,(0,d.Parameter)("_nbHashes")),a(1,(0,d.Parameter)("_hashFunctions")),s("design:paramtypes",[Number,Array])],t)}(c.default);t.MinHash=p},"./node_modules/bloom-filters/dist/sketch/topk.js":function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,n,s):r(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,i){t(n,i,e)}},l=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var d=c(n("./node_modules/bloom-filters/dist/base-filter.js")),u=c(n("./node_modules/bloom-filters/dist/sketch/count-min-sketch.js")),m=n("./node_modules/bloom-filters/dist/exportable.js"),h=n("./node_modules/lodash/lodash.js"),p=function(){function e(){this._content=[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this._content.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._content=e},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this._content[e]},e.prototype.add=function(e){var t=(0,h.sortedIndexBy)(this._content,e,(function(e){return e.frequency}));this._content.splice(t,0,e)},e.prototype.remove=function(e){this._content.splice(e,1)},e.prototype.popMin=function(){return this._content.shift()},e.prototype.indexOf=function(e){return this._content.findIndex((function(t){return t.value===e}))},e.prototype.clear=function(){this._content=[]},e}(),g=function(e){function t(t,n,i){var r=e.call(this)||this;return r._k=t,r._errorRate=n,r._accuracy=i,r._sketch=u.default.create(n,i),r._heap=new p,r}return r(t,e),t.prototype.add=function(e,t){if(void 0===t&&(t=1),0>=t)throw"count must be > 0 (was ".concat(t,")");this._sketch.update(e,t);var n=this._sketch.count(e);if(this._heap.length<this._k||n>=this._heap.get(0).frequency){var i=this._heap.indexOf(e);i>-1&&this._heap.remove(i),this._heap.add({value:e,frequency:n}),this._heap.length>this._k&&this._heap.popMin()}},t.prototype.clear=function(){this._sketch=u.default.create(this._errorRate,this._accuracy),this._heap.clear()},t.prototype.values=function(){for(var e=[],t=this._heap.length-1;t>=0;t--){var n=this._heap.get(t);e.push({value:n.value,frequency:n.frequency,rank:this._heap.length-t})}return e},t.prototype.iterator=function(){var e=this._heap;return function(){var t,n;return l(this,(function(i){switch(i.label){case 0:t=e.length-1,i.label=1;case 1:return t>=0?[4,{value:(n=e.get(t)).value,frequency:n.frequency,rank:e.length-t}]:[3,4];case 2:i.sent(),i.label=3;case 3:return t--,[3,1];case 4:return[2]}}))}()},o([(0,m.Field)(),s("design:type",Number)],t.prototype,"_k",void 0),o([(0,m.Field)(),s("design:type",Number)],t.prototype,"_errorRate",void 0),o([(0,m.Field)(),s("design:type",Number)],t.prototype,"_accuracy",void 0),o([(0,m.Field)((function(e){return e.saveAsJSON()}),(function(e){return u.default.fromJSON(e)})),s("design:type",u.default)],t.prototype,"_sketch",void 0),o([(0,m.Field)((function(e){return e.content}),(function(e){var t=new p;return t.content=e,t})),s("design:type",p)],t.prototype,"_heap",void 0),t=o([(0,m.AutoExportable)("TopK",["_seed"]),a(0,(0,m.Parameter)("_k")),a(1,(0,m.Parameter)("_errorRate")),a(2,(0,m.Parameter)("_accuracy")),s("design:paramtypes",[Number,Number,Number])],t)}(d.default);t.default=g},"./node_modules/bloom-filters/dist/utils.js":function(e,t,n){"use strict";var i=n("./node_modules/buffer/index.js").hp,r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultSeed=t.isEmptyBuffer=t.xorBuffer=t.randomInt=t.numberToHex=t.allocateArray=t.BufferError=void 0,t.BufferError="The buffer class must be available, if you are a browser user use the buffer package (https://www.npmjs.com/package/buffer)",t.allocateArray=function(e,t){for(var n=new Array(e),i="function"==typeof t?t:function(){return t},r=0;r<e;r++)n[r]=i();return n},t.numberToHex=function(e){var t=Number(e).toString(16);return t.length%4!=0&&(t="0".repeat(4-t.length%4)+t),t},t.randomInt=function(e,t,n){void 0===n&&(n=Math.random),e=Math.ceil(e),t=Math.floor(t);var i=n();return Math.floor(i*(t-e+1))+e},t.xorBuffer=function(e,t){for(var n=Math.max(e.length,t.length),r=i.allocUnsafe(n).fill(0),o=0;o<n;++o)o<e.length&&o<t.length?r[n-o-1]=e[e.length-o-1]^t[t.length-o-1]:o<e.length&&o>=t.length?r[n-o-1]^=e[e.length-o-1]:o<t.length&&o>=e.length&&(r[n-o-1]^=t[t.length-o-1]);for(var s=0,a=r.values(),l=a.next();!l.done&&0===l.value;)s++,l=a.next();return r.slice(s)},t.isEmptyBuffer=function(e){var t,n;if(null===e||!e)return!0;try{for(var i=r(e),o=i.next();!o.done;o=i.next()){if(0!==o.value)return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0},t.getDefaultSeed=function(){return 78187493520}},"./node_modules/long/umd/index.js":(e,t)=>{var n,i=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}function r(e){var t=Math.clz32(e&-e);return e?31-t:t}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=i;var o={},s={};function a(e,t){var n,i,r;return t?(r=0<=(e>>>=0)&&e<256)&&(i=s[e])?i:(n=c(e,0,!0),r&&(s[e]=n),n):(r=-128<=(e|=0)&&e<128)&&(i=o[e])?i:(n=c(e,e<0?-1:0,!1),r&&(o[e]=n),n)}function l(e,t){if(isNaN(e))return t?f:_;if(t){if(e<0)return f;if(e>=p)return x}else{if(e<=-g)return A;if(e+1>=g)return w}return e<0?l(-e,t).neg():c(e%h|0,e/h|0,t)}function c(e,t,i){return new n(e,t,i)}n.fromInt=a,n.fromNumber=l,n.fromBits=c;var d=Math.pow;function u(e,t,n){if(0===e.length)throw Error("empty string");if("number"==typeof t?(n=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?f:_;if((n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(e.substring(1),t,n).neg();for(var r=l(d(n,8)),o=_,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),n);if(a<8){var m=l(d(n,a));o=o.mul(m).add(l(c))}else o=(o=o.mul(r)).add(l(c))}return o.unsigned=t,o}function m(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?u(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=u,n.fromValue=m;var h=4294967296,p=h*h,g=p/2,v=a(1<<24),_=a(0);n.ZERO=_;var f=a(0,!0);n.UZERO=f;var y=a(1);n.ONE=y;var E=a(1,!0);n.UONE=E;var b=a(-1);n.NEG_ONE=b;var w=c(-1,2147483647,!1);n.MAX_VALUE=w;var x=c(-1,-1,!0);n.MAX_UNSIGNED_VALUE=x;var A=c(0,-2147483648,!1);n.MIN_VALUE=A;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(A)){var t=l(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var r=l(d(e,6),this.unsigned),o=this,s="";;){var a=o.div(r),c=(o.sub(a.mul(r)).toInt()>>>0).toString(e);if((o=a).isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return!(1&~this.low)},S.isEven=function(){return!(1&this.low)},S.equals=function(e){return i(e)||(e=m(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(i(e)||(e=m(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(y)},S.neg=S.negate,S.add=function(e){i(e)||(e=m(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,l=e.low>>>16,d=0,u=0,h=0,p=0;return h+=(p+=o+(65535&e.low))>>>16,u+=(h+=r+l)>>>16,d+=(u+=n+a)>>>16,d+=t+s,c((h&=65535)<<16|(p&=65535),(d&=65535)<<16|(u&=65535),this.unsigned)},S.subtract=function(e){return i(e)||(e=m(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return this;if(i(e)||(e=m(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?f:_;if(this.eq(A))return e.isOdd()?A:_;if(e.eq(A))return this.isOdd()?A:_;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return l(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,d=65535&e.high,u=e.low>>>16,h=65535&e.low,p=0,g=0,y=0,E=0;return y+=(E+=s*h)>>>16,g+=(y+=o*h)>>>16,y&=65535,g+=(y+=s*u)>>>16,p+=(g+=r*h)>>>16,g&=65535,p+=(g+=o*u)>>>16,g&=65535,p+=(g+=s*d)>>>16,p+=n*h+r*u+o*d+s*a,c((y&=65535)<<16|(E&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(i(e)||(e=m(e)),e.isZero())throw Error("division by zero");var n,r,o;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?f:_;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return f;if(e.gt(this.shru(1)))return E;o=f}else{if(this.eq(A))return e.eq(y)||e.eq(b)?A:e.eq(A)?y:(n=this.shr(1).div(e).shl(1)).eq(_)?e.isNegative()?y:b:(r=this.sub(e.mul(n)),o=n.add(r.div(e)));if(e.eq(A))return this.unsigned?f:_;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=_}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),a=s<=48?1:d(2,s-48),u=l(n),h=u.mul(e);h.isNegative()||h.gt(r);)h=(u=l(n-=a,this.unsigned)).mul(e);u.isZero()&&(u=y),o=o.add(u),r=r.sub(h)}return o},S.div=S.divide,S.modulo=function(e){return i(e)||(e=m(e)),t?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return c(~this.low,~this.high,this.unsigned)},S.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},S.clz=S.countLeadingZeros,S.countTrailingZeros=function(){return this.low?r(this.low):r(this.high)+32},S.ctz=S.countTrailingZeros,S.and=function(e){return i(e)||(e=m(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return i(e)||(e=m(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return i(e)||(e=m(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):c(32===e?this.high:this.high>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.rotateLeft=function(e){var t;return i(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(t=32-(e-=32),c(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},S.rotl=S.rotateLeft,S.rotateRight=function(e){var t;return i(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(t=32-(e-=32),c(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},S.rotr=S.rotateRight,S.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,i){return i?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var C=n;return e.default=C,"default"in e?e.default:e}({});void 0===(n=function(){return i}.apply(t,[]))||(e.exports=n)}}]);
//# sourceMappingURL=1546.js.map